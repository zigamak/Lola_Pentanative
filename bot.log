2025-06-11 04:30:49,510 - __main__ - ERROR - Environment check failed. Please fix the issues above.
2025-06-11 04:31:12,065 - dotenv.main - WARNING - python-dotenv could not parse statement starting at line 1
2025-06-11 04:31:12,065 - dotenv.main - WARNING - python-dotenv could not parse statement starting at line 2
2025-06-11 04:31:12,066 - dotenv.main - WARNING - python-dotenv could not parse statement starting at line 4
2025-06-11 04:31:12,066 - dotenv.main - WARNING - python-dotenv could not parse statement starting at line 6
2025-06-11 04:31:12,066 - dotenv.main - WARNING - python-dotenv could not parse statement starting at line 7
2025-06-11 04:31:12,067 - dotenv.main - WARNING - python-dotenv could not parse statement starting at line 8
2025-06-11 04:31:12,067 - dotenv.main - WARNING - python-dotenv could not parse statement starting at line 9
2025-06-11 04:31:12,071 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 04:31:12,518 - dotenv.main - WARNING - python-dotenv could not parse statement starting at line 1
2025-06-11 04:31:12,518 - dotenv.main - WARNING - python-dotenv could not parse statement starting at line 2
2025-06-11 04:31:12,518 - dotenv.main - WARNING - python-dotenv could not parse statement starting at line 4
2025-06-11 04:31:12,519 - dotenv.main - WARNING - python-dotenv could not parse statement starting at line 6
2025-06-11 04:31:12,519 - dotenv.main - WARNING - python-dotenv could not parse statement starting at line 7
2025-06-11 04:31:12,519 - dotenv.main - WARNING - python-dotenv could not parse statement starting at line 8
2025-06-11 04:31:12,519 - dotenv.main - WARNING - python-dotenv could not parse statement starting at line 9
2025-06-11 04:31:13,005 - __main__ - ERROR - Import error: No module named 'handlers.session_manager'
2025-06-11 04:33:23,348 - dotenv.main - WARNING - python-dotenv could not parse statement starting at line 1
2025-06-11 04:33:23,349 - dotenv.main - WARNING - python-dotenv could not parse statement starting at line 2
2025-06-11 04:33:23,349 - dotenv.main - WARNING - python-dotenv could not parse statement starting at line 4
2025-06-11 04:33:23,349 - dotenv.main - WARNING - python-dotenv could not parse statement starting at line 6
2025-06-11 04:33:23,350 - dotenv.main - WARNING - python-dotenv could not parse statement starting at line 7
2025-06-11 04:33:23,350 - dotenv.main - WARNING - python-dotenv could not parse statement starting at line 8
2025-06-11 04:33:23,350 - dotenv.main - WARNING - python-dotenv could not parse statement starting at line 9
2025-06-11 04:33:23,355 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 04:33:23,517 - dotenv.main - WARNING - python-dotenv could not parse statement starting at line 1
2025-06-11 04:33:23,517 - dotenv.main - WARNING - python-dotenv could not parse statement starting at line 2
2025-06-11 04:33:23,517 - dotenv.main - WARNING - python-dotenv could not parse statement starting at line 4
2025-06-11 04:33:23,518 - dotenv.main - WARNING - python-dotenv could not parse statement starting at line 6
2025-06-11 04:33:23,518 - dotenv.main - WARNING - python-dotenv could not parse statement starting at line 7
2025-06-11 04:33:23,518 - dotenv.main - WARNING - python-dotenv could not parse statement starting at line 8
2025-06-11 04:33:23,519 - dotenv.main - WARNING - python-dotenv could not parse statement starting at line 9
2025-06-11 04:33:23,951 - __main__ - ERROR - Import error: No module named 'handlers.ai_service'
2025-06-11 04:34:20,835 - dotenv.main - WARNING - python-dotenv could not parse statement starting at line 1
2025-06-11 04:34:20,836 - dotenv.main - WARNING - python-dotenv could not parse statement starting at line 2
2025-06-11 04:34:20,836 - dotenv.main - WARNING - python-dotenv could not parse statement starting at line 4
2025-06-11 04:34:20,836 - dotenv.main - WARNING - python-dotenv could not parse statement starting at line 6
2025-06-11 04:34:20,837 - dotenv.main - WARNING - python-dotenv could not parse statement starting at line 7
2025-06-11 04:34:20,837 - dotenv.main - WARNING - python-dotenv could not parse statement starting at line 8
2025-06-11 04:34:20,837 - dotenv.main - WARNING - python-dotenv could not parse statement starting at line 9
2025-06-11 04:34:20,842 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 04:34:21,005 - dotenv.main - WARNING - python-dotenv could not parse statement starting at line 1
2025-06-11 04:34:21,005 - dotenv.main - WARNING - python-dotenv could not parse statement starting at line 2
2025-06-11 04:34:21,006 - dotenv.main - WARNING - python-dotenv could not parse statement starting at line 4
2025-06-11 04:34:21,006 - dotenv.main - WARNING - python-dotenv could not parse statement starting at line 6
2025-06-11 04:34:21,006 - dotenv.main - WARNING - python-dotenv could not parse statement starting at line 7
2025-06-11 04:34:21,007 - dotenv.main - WARNING - python-dotenv could not parse statement starting at line 8
2025-06-11 04:34:21,007 - dotenv.main - WARNING - python-dotenv could not parse statement starting at line 9
2025-06-11 04:34:22,478 - dotenv.main - WARNING - python-dotenv could not parse statement starting at line 1
2025-06-11 04:34:22,479 - dotenv.main - WARNING - python-dotenv could not parse statement starting at line 2
2025-06-11 04:34:22,479 - dotenv.main - WARNING - python-dotenv could not parse statement starting at line 4
2025-06-11 04:34:22,479 - dotenv.main - WARNING - python-dotenv could not parse statement starting at line 6
2025-06-11 04:34:22,480 - dotenv.main - WARNING - python-dotenv could not parse statement starting at line 7
2025-06-11 04:34:22,480 - dotenv.main - WARNING - python-dotenv could not parse statement starting at line 8
2025-06-11 04:34:22,480 - dotenv.main - WARNING - python-dotenv could not parse statement starting at line 9
2025-06-11 04:34:22,485 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-11 04:35:46,284 - dotenv.main - WARNING - python-dotenv could not parse statement starting at line 1
2025-06-11 04:35:46,285 - dotenv.main - WARNING - python-dotenv could not parse statement starting at line 2
2025-06-11 04:35:46,285 - dotenv.main - WARNING - python-dotenv could not parse statement starting at line 4
2025-06-11 04:35:46,285 - dotenv.main - WARNING - python-dotenv could not parse statement starting at line 6
2025-06-11 04:35:46,286 - dotenv.main - WARNING - python-dotenv could not parse statement starting at line 7
2025-06-11 04:35:46,286 - dotenv.main - WARNING - python-dotenv could not parse statement starting at line 8
2025-06-11 04:35:46,286 - dotenv.main - WARNING - python-dotenv could not parse statement starting at line 9
2025-06-11 04:35:46,290 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 04:35:46,472 - dotenv.main - WARNING - python-dotenv could not parse statement starting at line 1
2025-06-11 04:35:46,472 - dotenv.main - WARNING - python-dotenv could not parse statement starting at line 2
2025-06-11 04:35:46,472 - dotenv.main - WARNING - python-dotenv could not parse statement starting at line 4
2025-06-11 04:35:46,473 - dotenv.main - WARNING - python-dotenv could not parse statement starting at line 6
2025-06-11 04:35:46,473 - dotenv.main - WARNING - python-dotenv could not parse statement starting at line 7
2025-06-11 04:35:46,473 - dotenv.main - WARNING - python-dotenv could not parse statement starting at line 8
2025-06-11 04:35:46,474 - dotenv.main - WARNING - python-dotenv could not parse statement starting at line 9
2025-06-11 04:35:47,412 - dotenv.main - WARNING - python-dotenv could not parse statement starting at line 1
2025-06-11 04:35:47,412 - dotenv.main - WARNING - python-dotenv could not parse statement starting at line 2
2025-06-11 04:35:47,412 - dotenv.main - WARNING - python-dotenv could not parse statement starting at line 4
2025-06-11 04:35:47,413 - dotenv.main - WARNING - python-dotenv could not parse statement starting at line 6
2025-06-11 04:35:47,413 - dotenv.main - WARNING - python-dotenv could not parse statement starting at line 7
2025-06-11 04:35:47,413 - dotenv.main - WARNING - python-dotenv could not parse statement starting at line 8
2025-06-11 04:35:47,414 - dotenv.main - WARNING - python-dotenv could not parse statement starting at line 9
2025-06-11 04:35:47,417 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-11 04:38:33,673 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 04:38:35,577 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-11 04:39:30,877 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 04:39:31,896 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-11 04:40:52,460 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 04:40:53,501 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-11 04:42:29,997 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 04:42:31,029 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-11 04:44:22,495 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 04:44:23,517 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-11 04:46:36,344 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 04:46:37,373 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-11 04:47:58,676 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 04:47:59,730 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-11 04:52:34,150 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 04:52:35,211 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-11 04:55:55,378 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 04:55:56,447 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-11 05:02:14,461 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 05:02:15,569 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-11 05:05:50,225 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 05:05:51,461 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-11 05:07:04,480 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 05:07:05,547 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-11 05:11:15,643 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 05:11:17,190 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-11 05:13:45,055 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 05:13:46,527 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-11 05:17:36,938 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 05:17:38,925 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-11 05:22:02,866 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 05:22:04,132 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-11 05:24:18,068 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 05:24:19,243 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-11 05:30:01,541 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 05:30:02,627 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-11 05:32:00,807 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 05:32:01,908 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-11 05:33:59,572 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 05:34:01,342 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-11 05:41:20,905 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 05:41:23,001 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-11 05:43:29,099 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 05:43:30,807 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-11 05:46:38,034 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 05:46:39,761 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-11 05:52:41,651 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 05:52:43,370 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-11 05:57:53,408 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 05:57:54,898 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-11 06:00:43,697 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 06:00:44,418 - __main__ - ERROR - Unexpected error: name 'Dict' is not defined
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\Lola\app\run.py", line 151, in main
    from app import app
  File "C:\Users\zigam\Documents\Lola\Lola\app\app.py", line 7, in <module>
    from handlers.webhook_handler import WebhookHandler
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\webhook_handler.py", line 8, in <module>
    from handlers.message_processor import MessageProcessor
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 10, in <module>
    from handlers.location_address_handler import LocationAddressHandler
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\location_address_handler.py", line 7, in <module>
    class LocationAddressHandler:
    ...<589 lines>...
            return {"redirect": "order_handler", "redirect_message": "show_order_confirmation_from_location"}
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\location_address_handler.py", line 22, in LocationAddressHandler
    def initiate_address_collection(self, session_id: str) -> Dict: # Removed state parameter
                                                              ^^^^
NameError: name 'Dict' is not defined. Did you mean: 'dict'?
2025-06-11 06:02:50,651 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 06:02:51,517 - __main__ - ERROR - Unexpected error: name 'Dict' is not defined
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\Lola\app\run.py", line 151, in main
    from app import app
  File "C:\Users\zigam\Documents\Lola\Lola\app\app.py", line 7, in <module>
    from handlers.webhook_handler import WebhookHandler
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\webhook_handler.py", line 8, in <module>
    from handlers.message_processor import MessageProcessor
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 10, in <module>
    from handlers.location_address_handler import LocationAddressHandler
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\location_address_handler.py", line 7, in <module>
    class LocationAddressHandler:
    ...<589 lines>...
            return {"redirect": "order_handler", "redirect_message": "show_order_confirmation_from_location"}
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\location_address_handler.py", line 22, in LocationAddressHandler
    def initiate_address_collection(self, session_id: str) -> Dict: # Removed state parameter
                                                              ^^^^
NameError: name 'Dict' is not defined. Did you mean: 'dict'?
2025-06-11 06:05:03,019 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 06:05:04,157 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-11 06:06:25,510 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 06:06:26,571 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-11 06:07:38,446 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 06:07:39,498 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-11 06:08:46,196 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 06:08:46,788 - __main__ - ERROR - Unexpected error: '(' was never closed (message_processor.py, line 264)
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\Lola\app\run.py", line 151, in main
    from app import app
  File "C:\Users\zigam\Documents\Lola\Lola\app\app.py", line 7, in <module>
    from handlers.webhook_handler import WebhookHandler
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\webhook_handler.py", line 8, in <module>
    from handlers.message_processor import MessageProcessor
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 264
    return self.location_handler.handle_manual_address_entry(state, original_message, session_id
                                                            ^
SyntaxError: '(' was never closed
2025-06-11 06:09:38,616 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 06:09:39,768 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-11 06:10:29,577 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 06:10:29,740 - __main__ - ERROR - Import error: No module named 'services.session_manager'
2025-06-11 06:12:31,846 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 06:12:32,021 - __main__ - ERROR - Import error: No module named 'services.session_manager'
2025-06-11 06:12:55,094 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 06:12:55,257 - __main__ - ERROR - Import error: No module named 'services.session_manager'
2025-06-11 06:16:13,464 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 06:16:13,640 - __main__ - ERROR - Import error: No module named 'services.session_manager'
2025-06-11 06:17:54,804 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 06:17:54,962 - __main__ - ERROR - Import error: No module named 'services.session_manager'
2025-06-11 06:18:52,646 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 06:18:52,908 - __main__ - ERROR - Import error: No module named 'services.session_manager'
2025-06-11 06:19:21,066 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 06:19:21,324 - __main__ - ERROR - Import error: No module named 'services.session_manager'
2025-06-11 06:19:33,365 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 06:19:33,603 - __main__ - ERROR - Import error: No module named 'services.session_manager'
2025-06-11 06:20:59,143 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 11:25:56,483 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 11:25:56,850 - __main__ - ERROR - Import error: No module named 'services.session_manager'
2025-06-11 11:29:47,942 - __main__ - ERROR - Environment check failed. Please fix the issues above.
2025-06-11 11:31:17,876 - __main__ - ERROR - Environment check failed. Please fix the issues above.
2025-06-11 11:31:25,834 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 11:31:26,144 - __main__ - ERROR - Import error: No module named 'services.session_manager'
2025-06-11 11:31:43,053 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 11:31:43,807 - __main__ - ERROR - Unexpected error: invalid syntax (location_service.py, line 1)
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\Lola\app\run.py", line 151, in main
    from app import app
  File "C:\Users\zigam\Documents\Lola\Lola\app\app.py", line 7, in <module>
    from handlers.webhook_handler import WebhookHandler
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\webhook_handler.py", line 7, in <module>
    from services.location_service import LocationService
  File "C:\Users\zigam\Documents\Lola\Lola\app\services\location_service.py", line 1
    mport requests
          ^^^^^^^^
SyntaxError: invalid syntax
2025-06-11 11:34:02,380 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 11:34:04,402 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-11 11:35:04,891 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 11:35:06,395 - __main__ - ERROR - Import error: No module named 'services.llm_service'
2025-06-11 11:36:29,183 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 11:36:31,179 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-11 11:37:48,653 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 11:37:49,423 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-11 11:38:46,414 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 11:38:47,528 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-11 11:40:17,515 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 11:40:18,473 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-11 11:40:35,754 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 11:40:36,614 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-11 11:41:48,898 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 11:41:49,706 - __main__ - ERROR - Import error: No module named 'services.config_service'
2025-06-11 11:44:12,886 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 11:44:13,721 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-11 11:48:22,136 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 11:48:22,562 - __main__ - ERROR - Import error: cannot import name 'WebhookHandler' from partially initialized module 'handlers.webhook_handler' (most likely due to a circular import) (C:\Users\zigam\Documents\Lola\Lola\app\handlers\webhook_handler.py)
2025-06-11 11:50:14,097 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 11:50:15,065 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-11 11:51:04,396 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 11:51:05,470 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-11 11:53:27,495 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 11:53:28,308 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-11 11:54:52,337 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 11:54:53,285 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-11 11:59:52,963 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 11:59:52,965 - __main__ - ERROR - Import error: No module named 'app'
2025-06-11 12:00:01,212 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 12:00:01,214 - __main__ - ERROR - Import error: No module named 'app'
2025-06-11 12:00:10,088 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 12:00:10,090 - __main__ - ERROR - Import error: No module named 'app'
2025-06-11 12:01:18,859 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 12:01:18,860 - __main__ - ERROR - Import error: No module named 'app'
2025-06-11 12:07:59,314 - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-11 12:08:00,354 - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-11 12:08:47,197 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-11 12:09:36,623 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-11 12:09:38,055 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-11 12:12:44,754 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-11 12:16:40,568 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-11 12:17:22,188 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 12:17:23,121 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-11 12:17:42,257 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 12:17:43,032 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-11 12:43:47,765 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 12:43:49,233 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-11 12:54:51,166 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 12:54:52,679 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-11 12:58:14,165 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 12:58:15,213 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-11 13:04:50,177 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 13:04:51,407 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-11 13:16:49,157 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 13:16:50,309 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-11 13:25:52,539 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 13:25:53,911 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-11 13:39:34,972 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 13:39:36,053 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-11 14:09:14,706 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 14:09:17,151 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-11 14:11:51,631 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 14:11:52,681 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-11 14:13:22,195 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 14:13:23,379 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-11 14:23:45,145 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 14:23:46,167 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-11 14:25:21,801 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 14:25:22,814 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-11 14:29:54,000 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 14:29:55,706 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-11 14:50:53,384 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 14:50:53,939 - __main__ - ERROR - Unexpected error: name 'Dict' is not defined
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\app\run.py", line 151, in main
    from app import app
  File "C:\Users\zigam\Documents\Lola\app\app.py", line 7, in <module>
    from handlers.webhook_handler import WebhookHandler
  File "C:\Users\zigam\Documents\Lola\app\handlers\webhook_handler.py", line 8, in <module>
    from handlers.message_processor import MessageProcessor
  File "C:\Users\zigam\Documents\Lola\app\handlers\message_processor.py", line 9, in <module>
    from handlers.payment_handler import PaymentHandler
  File "C:\Users\zigam\Documents\Lola\app\handlers\payment_handler.py", line 7, in <module>
    class PaymentHandler(BaseHandler):
    ...<695 lines>...
                self.logger.error(f"Error initiating webhook feedback collection for order {order_id}: {e}")
  File "C:\Users\zigam\Documents\Lola\app\handlers\payment_handler.py", line 683, in PaymentHandler
    def _initiate_feedback_collection(self, state: Dict, session_id: str, order_id: str) -> None:
                                                   ^^^^
NameError: name 'Dict' is not defined. Did you mean: 'dict'?
2025-06-11 14:52:26,009 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 14:52:27,268 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-11 14:59:38,920 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 14:59:39,955 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-11 15:15:23,708 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 15:15:25,191 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-11 15:22:37,940 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 15:22:39,149 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-11 15:55:17,054 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 15:55:18,181 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-11 16:17:39,375 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 16:17:40,984 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-11 16:24:32,594 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 16:24:33,639 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-11 19:38:35,881 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 19:38:38,605 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-11 22:44:34,551 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 22:44:36,124 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-12 15:19:09,739 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-12 15:19:14,570 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-12 17:45:56,488 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-12 17:45:58,348 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-12 17:48:24,381 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-12 17:48:25,501 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-12 17:50:30,260 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-12 17:50:31,775 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-12 17:56:11,904 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-12 17:56:13,004 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-12 17:57:50,730 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-12 17:57:51,825 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-12 18:00:41,921 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-12 18:00:43,040 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-12 18:05:53,461 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-12 18:05:54,040 - __main__ - ERROR - Unexpected error: unindent does not match any outer indentation level (order_handler.py, line 47)
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\app\run.py", line 151, in main
    from app import app
  File "C:\Users\zigam\Documents\Lola\app\app.py", line 7, in <module>
    from handlers.webhook_handler import WebhookHandler
  File "C:\Users\zigam\Documents\Lola\app\handlers\webhook_handler.py", line 8, in <module>
    from handlers.message_processor import MessageProcessor
  File "C:\Users\zigam\Documents\Lola\app\handlers\message_processor.py", line 8, in <module>
    from handlers.order_handler import OrderHandler
  File "C:\Users\zigam\Documents\Lola\app\handlers\order_handler.py", line 47
    def handle_get_new_name_address_state(self, state: Dict, message: str, session_id: str) -> Dict:
                                                                                                    ^
IndentationError: unindent does not match any outer indentation level
2025-06-12 18:08:25,908 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-12 18:08:27,351 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-12 18:12:31,301 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-12 18:12:31,963 - __main__ - ERROR - Unexpected error: invalid syntax (message_processor.py, line 1)
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\app\run.py", line 151, in main
    from app import app
  File "C:\Users\zigam\Documents\Lola\app\app.py", line 7, in <module>
    from handlers.webhook_handler import WebhookHandler
  File "C:\Users\zigam\Documents\Lola\app\handlers\webhook_handler.py", line 8, in <module>
    from handlers.message_processor import MessageProcessor
  File "C:\Users\zigam\Documents\Lola\app\handlers\message_processor.py", line 1
    elif current_state == "confirm_details" or current_state == "confirm_and_pay":
    ^^^^
SyntaxError: invalid syntax
2025-06-12 18:14:21,637 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-12 18:14:23,076 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-12 18:15:42,925 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-12 18:15:43,966 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-12 18:18:13,050 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-12 18:18:13,675 - __main__ - ERROR - Unexpected error: expected 'except' or 'finally' block (order_handler.py, line 457)
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\app\run.py", line 151, in main
    from app import app
  File "C:\Users\zigam\Documents\Lola\app\app.py", line 7, in <module>
    from handlers.webhook_handler import WebhookHandler
  File "C:\Users\zigam\Documents\Lola\app\handlers\webhook_handler.py", line 8, in <module>
    from handlers.message_processor import MessageProcessor
  File "C:\Users\zigam\Documents\Lola\app\handlers\message_processor.py", line 8, in <module>
    from handlers.order_handler import OrderHandler
  File "C:\Users\zigam\Documents\Lola\app\handlers\order_handler.py", line 457
    def handle_get_new_name_address_state(self, state: Dict, message: str, session_id: str) -> Dict:
SyntaxError: expected 'except' or 'finally' block
2025-06-12 18:20:12,899 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-12 18:20:13,620 - __main__ - ERROR - Unexpected error: expected 'except' or 'finally' block (order_handler.py, line 457)
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\app\run.py", line 151, in main
    from app import app
  File "C:\Users\zigam\Documents\Lola\app\app.py", line 7, in <module>
    from handlers.webhook_handler import WebhookHandler
  File "C:\Users\zigam\Documents\Lola\app\handlers\webhook_handler.py", line 8, in <module>
    from handlers.message_processor import MessageProcessor
  File "C:\Users\zigam\Documents\Lola\app\handlers\message_processor.py", line 8, in <module>
    from handlers.order_handler import OrderHandler
  File "C:\Users\zigam\Documents\Lola\app\handlers\order_handler.py", line 457
    def handle_get_new_name_address_state(self, state: Dict, message: str, session_id: str) -> Dict:
SyntaxError: expected 'except' or 'finally' block
2025-06-12 18:22:04,860 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-12 18:22:06,249 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-12 18:25:10,257 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-12 18:25:11,553 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-12 18:27:25,859 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-12 18:27:26,645 - __main__ - ERROR - Unexpected error: unterminated string literal (detected at line 231) (order_handler.py, line 231)
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\app\run.py", line 151, in main
    from app import app
  File "C:\Users\zigam\Documents\Lola\app\app.py", line 7, in <module>
    from handlers.webhook_handler import WebhookHandler
  File "C:\Users\zigam\Documents\Lola\app\handlers\webhook_handler.py", line 8, in <module>
    from handlers.message_processor import MessageProcessor
  File "C:\Users\zigam\Documents\Lola\app\handlers\message_processor.py", line 8, in <module>
    from handlers.order_handler import OrderHandler
  File "C:\Users\zigam\Documents\Lola\app\handlers\order_handler.py", line 231
    )total_price": total_price,
                ^
SyntaxError: unterminated string literal (detected at line 231)
2025-06-12 18:28:08,472 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-12 18:28:09,537 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-12 18:31:23,829 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-12 18:31:24,891 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-12 18:40:51,822 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-12 18:40:52,007 - __main__ - ERROR - Unexpected error: invalid syntax (data_manager.py, line 63)
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\app\run.py", line 151, in main
    from app import app
  File "C:\Users\zigam\Documents\Lola\app\app.py", line 7, in <module>
    from handlers.webhook_handler import WebhookHandler
  File "C:\Users\zigam\Documents\Lola\app\handlers\webhook_handler.py", line 4, in <module>
    from utils.data_manager import DataManager
  File "C:\Users\zigam\Documents\Lola\app\utils\data_manager.py", line 63
    user_details_list.append({"phone_number": phone, *details})
                                                     ^
SyntaxError: invalid syntax
2025-06-12 18:41:55,215 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-12 18:41:55,381 - __main__ - ERROR - Unexpected error: invalid syntax (data_manager.py, line 63)
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\app\run.py", line 151, in main
    from app import app
  File "C:\Users\zigam\Documents\Lola\app\app.py", line 7, in <module>
    from handlers.webhook_handler import WebhookHandler
  File "C:\Users\zigam\Documents\Lola\app\handlers\webhook_handler.py", line 4, in <module>
    from utils.data_manager import DataManager
  File "C:\Users\zigam\Documents\Lola\app\utils\data_manager.py", line 63
    user_details_list.append({"phone_number": phone, *details})
                                                     ^
SyntaxError: invalid syntax
2025-06-12 18:42:04,936 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-12 18:42:05,188 - __main__ - ERROR - Unexpected error: invalid syntax (data_manager.py, line 63)
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\app\run.py", line 151, in main
    from app import app
  File "C:\Users\zigam\Documents\Lola\app\app.py", line 7, in <module>
    from handlers.webhook_handler import WebhookHandler
  File "C:\Users\zigam\Documents\Lola\app\handlers\webhook_handler.py", line 4, in <module>
    from utils.data_manager import DataManager
  File "C:\Users\zigam\Documents\Lola\app\utils\data_manager.py", line 63
    user_details_list.append({"phone_number": phone, *details})
                                                     ^
SyntaxError: invalid syntax
2025-06-12 18:42:11,853 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-12 18:42:12,017 - __main__ - ERROR - Unexpected error: invalid syntax (data_manager.py, line 63)
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\app\run.py", line 151, in main
    from app import app
  File "C:\Users\zigam\Documents\Lola\app\app.py", line 7, in <module>
    from handlers.webhook_handler import WebhookHandler
  File "C:\Users\zigam\Documents\Lola\app\handlers\webhook_handler.py", line 4, in <module>
    from utils.data_manager import DataManager
  File "C:\Users\zigam\Documents\Lola\app\utils\data_manager.py", line 63
    user_details_list.append({"phone_number": phone, *details})
                                                     ^
SyntaxError: invalid syntax
2025-06-12 18:47:45,514 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-12 18:47:46,090 - __main__ - ERROR - Unexpected error: invalid syntax (payment_service.py, line 72)
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\app\run.py", line 151, in main
    from app import app
  File "C:\Users\zigam\Documents\Lola\app\app.py", line 7, in <module>
    from handlers.webhook_handler import WebhookHandler
  File "C:\Users\zigam\Documents\Lola\app\handlers\webhook_handler.py", line 6, in <module>
    from services.payment_service import PaymentService
  File "C:\Users\zigam\Documents\Lola\app\services\payment_service.py", line 72
    *(metadata or {})
    ^
SyntaxError: invalid syntax
2025-06-12 18:48:20,823 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-12 18:48:22,098 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-12 18:48:41,658 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-12 18:48:42,695 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-12 18:55:04,625 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-12 18:55:05,775 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-12 18:58:48,119 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-12 18:58:49,160 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-12 19:01:12,555 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-12 19:01:13,712 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-12 19:04:28,054 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-12 19:04:29,169 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-12 19:05:08,668 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-12 19:05:10,125 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-12 19:10:05,085 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-12 19:10:06,119 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-12 19:12:26,779 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-12 19:12:27,892 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-12 19:17:11,276 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-12 19:17:12,347 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-12 19:19:41,323 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-12 19:19:42,510 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-12 19:21:10,055 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-12 19:21:11,140 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-12 19:22:46,347 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-12 19:22:47,409 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-12 19:25:28,698 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-12 19:25:29,853 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-12 19:29:59,413 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-12 19:30:00,541 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-12 19:31:35,564 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-12 19:31:36,598 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-12 19:35:15,163 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-12 19:35:15,716 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-12 19:38:34,837 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-12 19:38:35,951 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-12 19:42:36,244 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-12 19:42:37,299 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-12 19:43:53,327 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-12 19:43:54,335 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-19 10:44:11,587 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-19 10:44:14,082 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-19 13:14:17,944 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-19 13:14:19,434 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-19 13:16:17,228 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-19 13:16:18,303 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-19 13:18:24,990 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-19 13:18:26,078 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-19 13:24:31,799 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-19 13:24:32,842 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-19 13:28:46,380 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-19 13:28:47,669 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-19 13:35:21,971 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-19 13:35:23,224 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-19 13:43:00,759 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-19 13:43:01,842 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-19 13:48:47,208 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-19 13:48:48,309 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-19 13:51:21,913 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-19 13:51:22,991 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-19 13:53:01,572 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-19 13:53:02,656 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-19 14:05:36,195 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-19 14:05:37,275 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-19 14:32:29,698 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-19 14:32:30,964 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-19 14:33:33,637 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-19 14:33:34,717 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-19 14:39:03,993 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-19 14:39:05,255 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-19 14:41:00,392 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-19 14:41:01,565 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-19 14:43:06,997 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-19 14:43:07,603 - __main__ - ERROR - Import error: cannot import name 'AIHandler' from partially initialized module 'handlers.ai_handler' (most likely due to a circular import) (C:\Users\zigam\Documents\Lola\app\handlers\ai_handler.py)
2025-06-19 14:45:36,300 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-19 14:45:37,486 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-19 14:47:39,751 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-19 14:47:40,887 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-19 14:48:17,087 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-19 14:48:18,308 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-19 15:06:03,879 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-19 15:06:05,562 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-19 15:09:15,400 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-19 15:09:16,540 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-19 15:10:35,389 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-19 15:10:36,460 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-19 15:15:13,750 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-19 15:15:15,433 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-19 15:17:13,312 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-19 15:17:14,536 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-19 15:22:49,796 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-19 15:22:51,268 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-19 15:24:05,008 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-19 15:24:06,161 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-19 15:28:10,361 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-19 15:28:11,526 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-19 15:36:06,805 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-19 15:36:08,446 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-19 15:46:21,015 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-19 15:46:22,161 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-19 16:17:12,971 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-19 16:17:15,721 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-19 16:21:28,462 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-19 16:21:30,790 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-19 16:22:35,261 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-19 16:22:37,524 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-19 16:24:00,487 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-19 16:24:02,555 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-19 16:25:03,051 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-19 16:25:05,571 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-19 16:32:43,365 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-19 16:32:45,524 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-19 17:04:16,920 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-19 17:04:19,146 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-19 17:24:40,840 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-19 17:24:42,265 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-19 17:26:37,614 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-19 17:26:39,182 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-19 17:31:37,207 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-19 17:31:38,706 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-19 17:34:37,174 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-19 17:34:38,426 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-19 17:38:35,403 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-19 17:38:36,532 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-06-19 17:39:21,907 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-19 17:39:22,994 - root - INFO - Ensured data directory 'data' and logs directory 'logs' exist.
2025-07-03 18:13:20,960 - __main__ - INFO - Starting WhatsApp bot server...
2025-07-03 18:13:22,948 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-07-03 18:13:22,948 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-07-03 18:13:22,949 - services.payment_service - INFO - PaymentService initialized
2025-07-03 18:13:22,949 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-07-03 18:13:22,949 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-07-03 18:13:22,950 - services.payment_service - INFO - PaymentService initialized
2025-07-03 18:13:22,950 - services.lead_tracker - INFO - LeadTracker initialized
2025-07-03 18:13:22,950 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-07-03 18:13:22,951 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-07-03 18:13:22,951 - handlers.order_handler - INFO - OrderHandler initialized.
2025-07-03 18:13:22,951 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-07-03 18:13:22,952 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-07-03 18:13:23,454 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-07-03 18:13:23,454 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-07-03 18:13:23,455 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-07-03 18:13:23,455 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-07-03 18:13:23,486 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-07-03 18:13:23,487 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-07-03 18:51:27,765 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 18:51:27] "POST /webhook HTTP/1.1" 200 -
2025-07-03 19:07:07,443 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 19:07:07] "POST /webhook HTTP/1.1" 200 -
2025-07-03 19:07:45,540 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 19:07:45] "POST /webhook HTTP/1.1" 200 -
2025-07-03 19:08:05,778 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 19:08:05] "POST /webhook HTTP/1.1" 200 -
2025-07-03 19:16:19,136 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 19:16:19] "POST /webhook HTTP/1.1" 200 -
2025-07-03 19:17:07,639 - handlers.webhook_handler - WARNING - No valid message data extracted for 2348037674322. Message type: sticker
2025-07-03 19:17:07,640 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 19:17:07] "POST /webhook HTTP/1.1" 200 -
2025-07-03 19:24:59,763 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 19:24:59] "POST /webhook HTTP/1.1" 200 -
2025-07-03 19:40:20,383 - handlers.webhook_handler - INFO - Processing message from 254722356495 (User: Fiona Yiyah Nakitare): {'type': 'text', 'text': 'Please respond'}
2025-07-03 19:40:20,386 - utils.session_manager - INFO - New session 254722356495 initialized.
2025-07-03 19:40:20,411 - services.lead_tracker - INFO - New lead tracked: 254722356495 (Fiona Yiyah Nakitare)
2025-07-03 19:40:20,478 - handlers.base_handler - INFO - Session 254722356495 identified as guest, prompting for name and address.
2025-07-03 19:40:21,767 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"254722356495","wa_id":"254722356495"}],"messages":[{"id":"wamid.HBgMMjU0NzIyMzU2NDk1FQIAERgSNzZDOUQxQ0REQjUyMjFFOEJGAA=="}]}
2025-07-03 19:40:21,769 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '254722356495', 'wa_id': '254722356495'}], 'messages': [{'id': 'wamid.HBgMMjU0NzIyMzU2NDk1FQIAERgSNzZDOUQxQ0REQjUyMjFFOEJGAA=='}]}
2025-07-03 19:40:21,770 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 19:40:21] "POST /webhook HTTP/1.1" 200 -
2025-07-03 19:40:23,283 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 19:40:23] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:14:20,980 - __main__ - INFO - Starting WhatsApp bot server...
2025-07-03 21:14:22,798 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-07-03 21:14:22,800 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-07-03 21:14:22,800 - services.payment_service - INFO - PaymentService initialized
2025-07-03 21:14:22,800 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-07-03 21:14:22,801 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-07-03 21:14:22,801 - services.payment_service - INFO - PaymentService initialized
2025-07-03 21:14:22,802 - services.lead_tracker - INFO - LeadTracker initialized
2025-07-03 21:14:22,802 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-07-03 21:14:22,803 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-07-03 21:14:22,803 - handlers.order_handler - INFO - OrderHandler initialized.
2025-07-03 21:14:22,803 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-07-03 21:14:22,804 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-07-03 21:14:23,357 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-07-03 21:14:23,358 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-07-03 21:14:23,358 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-07-03 21:14:23,359 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-07-03 21:14:23,388 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-07-03 21:14:23,388 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-07-03 21:14:39,065 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-07-03 21:14:39,066 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-07-03 21:14:39,071 - handlers.base_handler - INFO - Session 2348055614455 recognized user 'Ziga'.
2025-07-03 21:14:42,693 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkI3RkE0OEZCNkQzNTZENDhBOAA="}]}
2025-07-03 21:14:42,694 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkI3RkE0OEZCNkQzNTZENDhBOAA='}]}
2025-07-03 21:14:42,695 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:14:42] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:14:45,545 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:14:45] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:14:46,468 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:14:46] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:45:45,298 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:45:45] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:45:47,988 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:45:47] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:45:53,730 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:45:53] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:47:39,137 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:47:39] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:47:41,523 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:47:41] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:47:45,489 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:47:45] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:48:40,829 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:48:40] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:48:43,650 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:48:43] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:48:43,971 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:48:43] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:48:44,009 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:48:44] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:48:45,049 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:48:45] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:48:45,409 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:48:45] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:48:46,504 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:48:46] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:48:46,658 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:48:46] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:48:48,876 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:48:48] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:48:49,025 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:48:49] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:48:49,163 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:48:49] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:48:52,665 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:48:52] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:48:52,825 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:48:52] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:48:53,845 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:48:53] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:48:54,297 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:48:54] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:48:55,582 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:48:55] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:48:56,384 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:48:56] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:48:57,260 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:48:57] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:48:57,722 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:48:57] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:48:58,065 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:48:58] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:48:58,369 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:48:58] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:48:59,741 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:48:59] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:48:59,898 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:48:59] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:49:01,759 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:49:01] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:49:03,130 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:49:03] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:49:04,429 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:49:04] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:49:04,571 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:49:04] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:49:04,933 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:49:04] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:49:06,496 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:49:06] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:49:06,987 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:49:06] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:49:08,273 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:49:08] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:49:08,704 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:49:08] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:49:10,754 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:49:10] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:49:12,900 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:49:12] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:49:13,946 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:49:13] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:49:14,569 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:49:14] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:49:15,445 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:49:15] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:49:15,603 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:49:15] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:49:16,628 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:49:16] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:49:18,429 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:49:18] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:49:18,995 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:49:18] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:49:20,327 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:49:20] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:49:23,243 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:49:23] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:49:23,690 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:49:23] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:49:24,168 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:49:24] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:49:24,404 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:49:24] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:49:24,504 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:49:24] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:49:25,649 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:49:25] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:49:25,724 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:49:25] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:49:28,067 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:49:28] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:49:29,113 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:49:29] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:49:30,431 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:49:30] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:49:31,937 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:49:31] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:49:33,112 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:49:33] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:49:33,251 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:49:33] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:49:33,448 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:49:33] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:49:34,412 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:49:34] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:49:35,019 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:49:35] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:49:35,327 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:49:35] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:49:37,600 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:49:37] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:49:38,615 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:49:38] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:49:40,061 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:49:40] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:49:40,948 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:49:40] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:49:43,671 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:49:43] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:49:44,300 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:49:44] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:49:44,557 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:49:44] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:49:44,703 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:49:44] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:49:46,479 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:49:46] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:49:46,831 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:49:46] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:49:47,290 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:49:47] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:49:47,458 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:49:47] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:49:50,372 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:49:50] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:49:50,713 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:49:50] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:49:51,531 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:49:51] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:49:53,346 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:49:53] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:49:53,483 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:49:53] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:49:53,661 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:49:53] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:49:53,681 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:49:53] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:49:55,281 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:49:55] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:49:55,436 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:49:55] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:49:56,116 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:49:56] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:49:56,870 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:49:56] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:49:57,744 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:49:57] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:49:59,338 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:49:59] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:50:00,326 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:50:00] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:50:00,758 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:50:00] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:50:01,631 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:50:01] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:50:03,446 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:50:03] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:50:05,001 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:50:05] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:50:05,309 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:50:05] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:50:05,847 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:50:05] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:50:06,661 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:50:06] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:50:07,025 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:50:07] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:50:09,382 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:50:09] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:50:10,710 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:50:10] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:50:12,330 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:50:12] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:50:12,790 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:50:12] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:50:12,869 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:50:12] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:50:14,594 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:50:14] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:50:15,378 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:50:15] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:50:15,715 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:50:15] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:50:15,849 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:50:15] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:50:15,994 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:50:15] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:50:16,147 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:50:16] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:50:16,910 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:50:16] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:50:18,665 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:50:18] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:50:18,930 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:50:18] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:50:19,607 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:50:19] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:50:21,002 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:50:21] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:50:22,457 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:50:22] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:50:23,695 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:50:23] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:50:24,403 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:50:24] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:50:24,404 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:50:24] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:50:24,486 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:50:24] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:50:25,766 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:50:25] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:50:27,109 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:50:27] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:50:27,723 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:50:27] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:50:29,011 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:50:29] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:50:29,573 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:50:29] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:50:32,252 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:50:32] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:50:32,636 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:50:32] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:50:32,797 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:50:32] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:50:33,021 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:50:33] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:50:34,015 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:50:34] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:50:34,081 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:50:34] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:50:35,389 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:50:35] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:50:35,560 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:50:35] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:50:38,529 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:50:38] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:50:38,572 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:50:38] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:50:38,887 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:50:38] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:50:39,683 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:50:39] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:50:41,632 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:50:41] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:50:41,838 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:50:41] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:50:44,878 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:50:44] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:50:46,828 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:50:46] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:50:46,942 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:50:46] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:50:47,364 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:50:47] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:50:47,539 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:50:47] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:50:52,838 - handlers.webhook_handler - INFO - Processing message from 2348039582985 (User: George Agu): {'type': 'text', 'text': 'I warned you here that I am not George Osuagwu. My name is George Agu'}
2025-07-03 21:50:52,840 - utils.session_manager - INFO - New session 2348039582985 initialized.
2025-07-03 21:50:52,859 - services.lead_tracker - INFO - New lead tracked: 2348039582985 (George Agu)
2025-07-03 21:50:52,880 - handlers.base_handler - INFO - Session 2348039582985 identified as guest, prompting for name and address.
2025-07-03 21:50:54,561 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348039582985","wa_id":"2348039582985"}],"messages":[{"id":"wamid.HBgNMjM0ODAzOTU4Mjk4NRUCABEYEjFDMDVFOUE1QjE1QUNDMjYzMQA="}]}
2025-07-03 21:50:54,562 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348039582985', 'wa_id': '2348039582985'}], 'messages': [{'id': 'wamid.HBgNMjM0ODAzOTU4Mjk4NRUCABEYEjFDMDVFOUE1QjE1QUNDMjYzMQA='}]}
2025-07-03 21:50:54,562 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:50:54] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:50:57,144 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:50:57] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:50:58,053 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:50:58] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:51:00,476 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:51:00] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:51:06,830 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:51:06] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:51:06,972 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:51:06] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:51:07,105 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:51:07] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:51:09,231 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:51:09] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:51:10,315 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:51:10] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:51:11,772 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:51:11] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:51:13,127 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:51:13] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:51:13,617 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:51:13] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:51:14,199 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:51:14] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:51:14,440 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:51:14] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:51:15,244 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:51:15] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:51:17,029 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:51:17] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:51:17,397 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:51:17] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:51:18,962 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:51:18] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:51:19,098 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:51:19] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:51:19,262 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:51:19] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:51:21,328 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:51:21] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:51:22,667 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:51:22] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:51:23,212 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:51:23] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:51:23,865 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:51:23] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:51:25,796 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:51:25] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:51:25,831 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:51:25] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:51:26,745 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:51:26] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:51:26,980 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:51:26] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:51:29,145 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:51:29] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:51:29,393 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:51:29] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:51:29,895 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:51:29] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:51:29,896 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:51:29] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:51:31,202 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:51:31] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:51:31,366 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:51:31] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:51:33,797 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:51:33] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:51:34,328 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:51:34] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:51:35,554 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:51:35] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:51:36,141 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:51:36] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:51:36,170 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:51:36] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:51:36,605 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:51:36] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:51:37,512 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:51:37] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:51:40,036 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:51:40] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:51:41,892 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:51:41] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:51:42,037 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:51:42] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:51:42,038 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:51:42] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:51:42,636 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:51:42] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:51:43,408 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:51:43] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:51:43,448 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:51:43] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:51:44,522 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:51:44] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:51:45,467 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:51:45] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:51:45,886 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:51:45] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:51:47,705 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:51:47] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:51:48,501 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:51:48] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:51:48,740 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:51:48] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:51:49,363 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:51:49] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:51:50,988 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:51:50] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:51:50,996 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:51:50] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:51:52,882 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:51:52] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:51:53,883 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:51:53] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:51:53,887 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:51:53] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:51:53,890 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:51:53] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:51:54,264 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:51:54] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:51:54,824 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:51:54] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:51:55,802 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:51:55] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:51:57,648 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:51:57] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:51:58,029 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:51:58] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:51:59,244 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:51:59] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:52:00,920 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:52:00] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:52:01,947 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:52:01] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:52:02,062 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:52:02] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:52:02,611 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:52:02] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:52:02,908 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:52:02] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:52:04,670 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:52:04] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:52:06,398 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:52:06] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:52:07,346 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:52:07] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:52:07,348 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:52:07] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:52:07,350 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:52:07] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:52:07,661 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:52:07] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:52:08,863 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:52:08] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:52:10,752 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:52:10] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:52:12,760 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:52:12] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:52:13,072 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:52:13] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:52:14,033 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:52:14] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:52:14,193 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:52:14] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:52:15,227 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:52:15] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:52:15,873 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:52:15] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:52:16,074 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:52:16] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:52:16,197 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:52:16] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:52:17,929 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:52:17] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:52:18,789 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:52:18] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:52:19,039 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:52:19] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:52:20,314 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:52:20] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:52:20,580 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:52:20] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:52:22,168 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:52:22] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:52:23,001 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:52:23] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:52:23,479 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:52:23] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:52:23,702 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:52:23] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:52:23,921 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:52:23] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:52:24,656 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:52:24] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:52:24,889 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:52:24] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:52:27,959 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:52:27] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:52:28,427 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:52:28] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:52:30,095 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:52:30] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:52:30,369 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:52:30] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:52:32,438 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:52:32] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:52:32,871 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:52:32] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:52:33,572 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:52:33] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:52:33,573 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:52:33] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:52:33,717 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:52:33] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:52:36,390 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:52:36] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:52:36,765 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:52:36] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:52:36,830 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:52:36] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:52:37,634 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:52:37] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:52:38,818 - handlers.webhook_handler - INFO - Processing message from 2347082706829 (User: Olusegun Adeniyi): {'type': 'text', 'text': 'Thank you. Acknowledged'}
2025-07-03 21:52:38,819 - utils.session_manager - INFO - New session 2347082706829 initialized.
2025-07-03 21:52:38,826 - services.lead_tracker - INFO - New lead tracked: 2347082706829 (Olusegun Adeniyi)
2025-07-03 21:52:38,838 - handlers.base_handler - INFO - Session 2347082706829 identified as guest, prompting for name and address.
2025-07-03 21:52:39,477 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:52:39] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:52:39,971 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082706829","wa_id":"2347082706829"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjcwNjgyORUCABEYEkEwRUZBMjg1MjkzRTBCMzQ1RgA="}]}
2025-07-03 21:52:39,972 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082706829', 'wa_id': '2347082706829'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjcwNjgyORUCABEYEkEwRUZBMjg1MjkzRTBCMzQ1RgA='}]}
2025-07-03 21:52:39,973 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:52:39] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:52:41,421 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:52:41] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:52:42,220 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:52:42] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:52:43,943 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:52:43] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:52:44,053 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:52:44] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:52:44,142 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:52:44] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:52:44,144 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:52:44] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:52:44,313 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:52:44] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:52:46,513 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:52:46] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:52:47,797 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:52:47] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:52:47,948 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:52:47] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:52:48,335 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:52:48] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:52:49,142 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:52:49] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:52:49,791 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:52:49] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:52:51,701 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:52:51] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:52:53,034 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:52:53] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:52:53,215 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:52:53] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:52:54,348 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:52:54] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:52:54,508 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:52:54] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:52:54,824 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:52:54] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:52:58,234 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:52:58] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:52:58,456 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:52:58] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:52:58,681 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:52:58] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:52:59,098 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:52:59] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:53:01,430 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:53:01] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:53:01,854 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:53:01] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:53:01,896 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:53:01] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:53:03,223 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:53:03] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:53:04,833 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:53:04] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:53:07,358 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:53:07] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:53:07,862 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:53:07] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:53:07,985 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:53:07] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:53:10,022 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:53:10] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:53:11,623 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:53:11] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:53:14,516 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:53:14] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:53:14,657 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:53:14] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:53:14,659 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:53:14] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:53:14,923 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:53:14] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:53:17,250 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:53:17] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:53:17,827 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:53:17] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:53:19,604 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:53:19] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:53:20,593 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:53:20] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:53:21,086 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:53:21] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:53:23,460 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:53:23] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:53:23,515 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:53:23] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:53:24,224 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:53:24] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:53:24,609 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:53:24] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:53:27,559 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:53:27] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:53:27,853 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:53:27] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:53:28,878 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:53:28] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:53:30,842 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:53:30] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:53:31,124 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:53:31] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:53:31,134 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:53:31] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:53:32,438 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:53:32] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:53:32,526 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:53:32] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:53:32,820 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:53:32] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:53:33,712 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:53:33] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:53:36,380 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:53:36] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:53:36,634 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:53:36] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:53:37,209 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:53:37] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:53:37,879 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:53:37] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:53:38,900 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:53:38] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:53:40,634 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:53:40] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:53:42,735 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:53:42] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:53:44,183 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:53:44] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:53:50,661 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:53:50] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:53:53,667 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:53:53] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:53:56,097 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:53:56] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:53:57,317 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:53:57] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:53:59,646 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:53:59] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:54:16,241 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:54:16] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:54:20,027 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:54:20] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:54:21,581 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:54:21] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:54:21,583 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:54:21] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:54:23,121 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:54:23] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:54:23,157 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:54:23] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:54:23,561 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:54:23] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:54:25,274 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:54:25] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:54:27,077 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:54:27] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:54:28,104 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:54:28] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:54:29,473 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:54:29] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:54:31,049 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:54:31] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:54:31,419 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:54:31] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:54:32,150 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:54:32] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:54:32,906 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:54:32] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:54:34,479 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:54:34] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:54:35,479 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:54:35] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:54:36,502 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:54:36] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:54:36,505 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:54:36] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:54:38,271 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:54:38] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:54:38,588 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:54:38] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:54:41,464 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:54:41] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:54:42,530 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:54:42] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:54:42,784 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:54:42] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:54:43,755 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:54:43] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:54:45,569 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:54:45] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:54:46,417 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:54:46] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:54:46,659 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:54:46] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:54:46,911 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:54:46] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:54:47,155 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:54:47] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:54:48,818 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:54:48] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:54:49,411 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:54:49] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:54:49,940 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:54:49] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:54:50,516 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:54:50] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:54:54,516 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:54:54] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:54:54,675 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:54:54] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:54:54,797 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:54:54] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:54:57,157 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:54:57] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:54:59,275 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:54:59] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:54:59,994 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:54:59] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:55:01,014 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:55:01] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:55:01,343 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:55:01] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:55:02,494 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:55:02] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:55:02,727 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:55:02] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:55:03,462 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:55:03] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:55:05,079 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:55:05] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:55:05,736 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:55:05] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:55:06,175 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:55:06] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:55:08,633 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:55:08] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:55:08,749 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:55:08] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:55:10,262 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:55:10] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:55:10,587 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:55:10] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:55:11,332 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:55:11] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:55:12,569 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:55:12] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:55:14,053 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:55:14] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:55:14,446 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:55:14] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:55:14,448 - handlers.webhook_handler - INFO - Processing message from 2348034111884 (User: Adewunmi Belo): {'type': 'text', 'text': 'Hello'}
2025-07-03 21:55:14,448 - utils.session_manager - INFO - New session 2348034111884 initialized.
2025-07-03 21:55:14,450 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:55:14] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:55:14,453 - services.lead_tracker - INFO - New lead tracked: 2348034111884 (Adewunmi Belo)
2025-07-03 21:55:14,462 - handlers.base_handler - INFO - Session 2348034111884 identified as guest, prompting for name and address.
2025-07-03 21:55:14,757 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:55:14] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:55:15,427 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:55:15] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:55:15,530 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348034111884","wa_id":"2348034111884"}],"messages":[{"id":"wamid.HBgNMjM0ODAzNDExMTg4NBUCABEYEkQ0RjY1MTg2OTgyQjVGNzY2MgA="}]}
2025-07-03 21:55:15,531 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348034111884', 'wa_id': '2348034111884'}], 'messages': [{'id': 'wamid.HBgNMjM0ODAzNDExMTg4NBUCABEYEkQ0RjY1MTg2OTgyQjVGNzY2MgA='}]}
2025-07-03 21:55:15,531 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:55:15] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:55:18,030 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:55:18] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:55:18,036 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:55:18] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:55:18,905 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:55:18] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:55:19,074 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:55:19] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:55:20,949 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:55:20] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:55:21,449 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:55:21] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:55:22,993 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:55:22] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:55:23,672 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:55:23] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:55:24,860 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:55:24] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:55:25,033 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:55:25] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:55:25,136 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:55:25] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:55:25,314 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:55:25] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:55:26,629 - handlers.webhook_handler - INFO - Processing message from 2348034111884 (User: Adewunmi Belo): {'type': 'text', 'text': 'Sure i will be attending'}
2025-07-03 21:55:26,634 - handlers.message_processor - WARNING - No specific handler or state match for handler 'greeting_handler', state 'guest_info_prompt', message 'sure i will be attending' for session 2348034111884. Resetting to greeting.
2025-07-03 21:55:26,634 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348034111884', 'type': 'text', 'text': {'body': "I'm sorry, I didn't quite understand that. Let's get back to the main menu."}}
2025-07-03 21:55:26,717 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:55:26] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:55:26,830 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:55:26] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:55:27,349 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348034111884","wa_id":"2348034111884"}],"messages":[{"id":"wamid.HBgNMjM0ODAzNDExMTg4NBUCABEYEkU5RUM0NjY5NTgwRjM0NUM0MQA="}]}
2025-07-03 21:55:28,049 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:55:28] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:55:28,066 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348034111884","wa_id":"2348034111884"}],"messages":[{"id":"wamid.HBgNMjM0ODAzNDExMTg4NBUCABEYEjM0NEJFOTc2QjE2Q0YzM0I0MgA="}]}
2025-07-03 21:55:28,067 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348034111884', 'wa_id': '2348034111884'}], 'messages': [{'id': 'wamid.HBgNMjM0ODAzNDExMTg4NBUCABEYEjM0NEJFOTc2QjE2Q0YzM0I0MgA='}]}
2025-07-03 21:55:28,067 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:55:28] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:55:28,682 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:55:28] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:55:29,027 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:55:29] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:55:29,825 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:55:29] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:55:31,308 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:55:31] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:55:32,757 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:55:32] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:55:33,658 - handlers.webhook_handler - INFO - Processing message from 2347053673669 (User: Yems): {'type': 'text', 'text': 'I already responded that I will be attending'}
2025-07-03 21:55:33,658 - utils.session_manager - INFO - New session 2347053673669 initialized.
2025-07-03 21:55:33,661 - services.lead_tracker - INFO - New lead tracked: 2347053673669 (Yems)
2025-07-03 21:55:33,674 - handlers.base_handler - INFO - Session 2347053673669 identified as guest, prompting for name and address.
2025-07-03 21:55:34,181 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:55:34] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:55:34,650 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347053673669","wa_id":"2347053673669"}],"messages":[{"id":"wamid.HBgNMjM0NzA1MzY3MzY2ORUCABEYEjg5RTI2Qjk2REFCMEIwNjlEMwA="}]}
2025-07-03 21:55:34,651 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347053673669', 'wa_id': '2347053673669'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA1MzY3MzY2ORUCABEYEjg5RTI2Qjk2REFCMEIwNjlEMwA='}]}
2025-07-03 21:55:34,651 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:55:34] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:55:35,022 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:55:35] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:55:35,702 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:55:35] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:55:37,554 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:55:37] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:55:37,636 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:55:37] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:55:38,449 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:55:38] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:55:40,119 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:55:40] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:55:40,641 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:55:40] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:55:41,755 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:55:41] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:55:42,187 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:55:42] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:55:43,680 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:55:43] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:55:43,853 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:55:43] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:55:45,033 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:55:45] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:55:45,129 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:55:45] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:55:45,734 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:55:45] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:55:46,956 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:55:46] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:55:48,439 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:55:48] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:55:49,046 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:55:49] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:55:49,382 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:55:49] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:55:50,827 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:55:50] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:55:53,678 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:55:53] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:55:54,051 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:55:54] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:55:54,402 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:55:54] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:55:54,901 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:55:54] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:55:56,294 - handlers.webhook_handler - INFO - Processing message from 2348035201120 (User: Kayode oladipupo): {'type': 'text', 'text': 'I did already check your record'}
2025-07-03 21:55:56,295 - utils.session_manager - INFO - New session 2348035201120 initialized.
2025-07-03 21:55:56,301 - services.lead_tracker - INFO - New lead tracked: 2348035201120 (Kayode oladipupo)
2025-07-03 21:55:56,320 - handlers.base_handler - INFO - Session 2348035201120 identified as guest, prompting for name and address.
2025-07-03 21:55:56,353 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:55:56] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:55:57,193 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:55:57] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:55:57,231 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348035201120","wa_id":"2348035201120"}],"messages":[{"id":"wamid.HBgNMjM0ODAzNTIwMTEyMBUCABEYEjY4RTBBMTAwRDVFREUyQTNFMAA="}]}
2025-07-03 21:55:57,233 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348035201120', 'wa_id': '2348035201120'}], 'messages': [{'id': 'wamid.HBgNMjM0ODAzNTIwMTEyMBUCABEYEjY4RTBBMTAwRDVFREUyQTNFMAA='}]}
2025-07-03 21:55:57,234 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:55:57] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:55:58,663 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:55:58] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:55:58,940 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:55:58] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:55:59,217 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:55:59] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:56:00,470 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:56:00] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:56:01,073 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:56:01] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:56:03,159 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:56:03] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:56:04,543 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:56:04] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:56:08,612 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:56:08] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:56:09,115 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:56:09] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:56:10,528 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:56:10] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:56:13,343 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:56:13] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:56:13,911 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:56:13] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:56:14,959 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:56:14] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:56:15,118 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:56:15] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:56:15,477 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:56:15] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:56:17,256 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:56:17] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:56:17,689 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:56:17] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:56:18,957 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:56:18] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:56:19,262 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:56:19] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:56:21,136 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:56:21] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:56:21,605 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:56:21] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:56:22,325 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:56:22] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:56:23,100 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:56:23] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:56:24,316 - handlers.webhook_handler - INFO - Processing message from 2348027283145 (User: Company): {'type': 'text', 'text': 'Yes------I will be there'}
2025-07-03 21:56:24,317 - utils.session_manager - INFO - New session 2348027283145 initialized.
2025-07-03 21:56:24,323 - services.lead_tracker - INFO - New lead tracked: 2348027283145 (Company)
2025-07-03 21:56:24,333 - handlers.base_handler - INFO - Session 2348027283145 identified as guest, prompting for name and address.
2025-07-03 21:56:25,298 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348027283145","wa_id":"2348027283145"}],"messages":[{"id":"wamid.HBgNMjM0ODAyNzI4MzE0NRUCABEYEjlBRTEyQUMxNzI0OTUyNjVFQwA="}]}
2025-07-03 21:56:25,299 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348027283145', 'wa_id': '2348027283145'}], 'messages': [{'id': 'wamid.HBgNMjM0ODAyNzI4MzE0NRUCABEYEjlBRTEyQUMxNzI0OTUyNjVFQwA='}]}
2025-07-03 21:56:25,299 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:56:25] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:56:26,215 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:56:26] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:56:27,019 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:56:27] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:56:27,199 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:56:27] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:56:27,205 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:56:27] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:56:29,101 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:56:29] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:56:29,375 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:56:29] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:56:32,184 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:56:32] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:56:33,206 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:56:33] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:56:33,354 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:56:33] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:56:33,502 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:56:33] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:56:35,305 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:56:35] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:56:36,749 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:56:36] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:56:37,413 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:56:37] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:56:37,929 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:56:37] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:56:38,713 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:56:38] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:56:39,146 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:56:39] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:56:41,155 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:56:41] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:56:41,379 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:56:41] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:56:43,753 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:56:43] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:56:45,264 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:56:45] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:56:47,659 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:56:47] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:56:48,885 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:56:48] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:56:48,932 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:56:48] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:56:49,002 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:56:49] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:56:49,208 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:56:49] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:56:50,309 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:56:50] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:56:51,815 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:56:51] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:56:53,347 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:56:53] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:56:53,724 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:56:53] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:56:54,991 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:56:54] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:56:57,028 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:56:57] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:56:57,436 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:56:57] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:56:58,548 - handlers.webhook_handler - INFO - Processing message from 2348034020426 (User: Ken Dibor): {'type': 'text', 'text': 'Ohh my apologies. I have moved back to UK and only visit Nigeria from time to time. \nI will not make it for the birthday. \nI wish her a happy birthday celebration is advance.'}
2025-07-03 21:56:58,548 - utils.session_manager - INFO - New session 2348034020426 initialized.
2025-07-03 21:56:58,551 - services.lead_tracker - INFO - New lead tracked: 2348034020426 (Ken Dibor)
2025-07-03 21:56:58,560 - handlers.base_handler - INFO - Session 2348034020426 identified as guest, prompting for name and address.
2025-07-03 21:56:59,279 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:56:59] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:56:59,321 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348034020426","wa_id":"2348034020426"}],"messages":[{"id":"wamid.HBgNMjM0ODAzNDAyMDQyNhUCABEYEjgxMzcyNzU0QzQ2NkNGMERCMQA="}]}
2025-07-03 21:56:59,321 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348034020426', 'wa_id': '2348034020426'}], 'messages': [{'id': 'wamid.HBgNMjM0ODAzNDAyMDQyNhUCABEYEjgxMzcyNzU0QzQ2NkNGMERCMQA='}]}
2025-07-03 21:56:59,322 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:56:59] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:56:59,574 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:56:59] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:57:00,548 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:57:00] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:57:00,601 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:57:00] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:57:00,798 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:57:00] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:57:00,945 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:57:00] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:57:01,703 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:57:01] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:57:03,216 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:57:03] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:57:03,971 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:57:03] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:57:05,657 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:57:05] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:57:06,803 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:57:06] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:57:07,608 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:57:07] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:57:09,160 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:57:09] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:57:09,888 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:57:09] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:57:09,973 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:57:09] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:57:10,843 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:57:10] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:57:12,106 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:57:12] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:57:12,361 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:57:12] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:57:14,760 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:57:14] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:57:16,426 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:57:16] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:57:16,760 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:57:16] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:57:17,014 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:57:17] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:57:18,382 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:57:18] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:57:18,480 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:57:18] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:57:19,892 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:57:19] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:57:22,607 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:57:22] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:57:22,640 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:57:22] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:57:26,219 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:57:26] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:57:26,416 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:57:26] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:57:26,780 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:57:26] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:57:28,232 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:57:28] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:57:28,586 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:57:28] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:57:29,456 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:57:29] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:57:30,529 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:57:30] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:57:31,394 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:57:31] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:57:33,711 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:57:33] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:57:33,713 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:57:33] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:57:34,534 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:57:34] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:57:35,407 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:57:35] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:57:35,563 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:57:35] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:57:36,491 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:57:36] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:57:37,377 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:57:37] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:57:37,558 - handlers.webhook_handler - INFO - Processing message from 2348058588888 (User: My Life Is My Message!!): {'type': 'text', 'text': 'I will be there! Thank you'}
2025-07-03 21:57:37,559 - utils.session_manager - INFO - New session 2348058588888 initialized.
2025-07-03 21:57:37,563 - services.lead_tracker - INFO - New lead tracked: 2348058588888 (My Life Is My Message!!)
2025-07-03 21:57:37,569 - handlers.base_handler - INFO - Session 2348058588888 identified as guest, prompting for name and address.
2025-07-03 21:57:38,257 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:57:38] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:57:38,889 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348058588888","wa_id":"2348058588888"}],"messages":[{"id":"wamid.HBgNMjM0ODA1ODU4ODg4OBUCABEYEkQ0QTgzMjQ1MDAzQzEyNzI2MQA="}]}
2025-07-03 21:57:38,889 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348058588888', 'wa_id': '2348058588888'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1ODU4ODg4OBUCABEYEkQ0QTgzMjQ1MDAzQzEyNzI2MQA='}]}
2025-07-03 21:57:38,890 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:57:38] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:57:39,913 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:57:39] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:57:40,911 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:57:40] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:57:41,801 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:57:41] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:57:42,088 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:57:42] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:57:42,989 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:57:42] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:57:45,580 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:57:45] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:57:45,585 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:57:45] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:57:47,364 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:57:47] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:57:47,538 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:57:47] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:57:47,695 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:57:47] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:57:48,936 - handlers.webhook_handler - INFO - Processing message from 2348034752265 (User: Omoo): {'type': 'text', 'text': 'Good evening. Done.'}
2025-07-03 21:57:48,936 - utils.session_manager - INFO - New session 2348034752265 initialized.
2025-07-03 21:57:48,940 - services.lead_tracker - INFO - New lead tracked: 2348034752265 (Omoo)
2025-07-03 21:57:48,949 - handlers.base_handler - INFO - Session 2348034752265 identified as guest, prompting for name and address.
2025-07-03 21:57:48,996 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:57:48] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:57:49,751 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348034752265","wa_id":"2348034752265"}],"messages":[{"id":"wamid.HBgNMjM0ODAzNDc1MjI2NRUCABEYEjQ1REM1NjExNUNGRkI3NTI2RAA="}]}
2025-07-03 21:57:49,752 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348034752265', 'wa_id': '2348034752265'}], 'messages': [{'id': 'wamid.HBgNMjM0ODAzNDc1MjI2NRUCABEYEjQ1REM1NjExNUNGRkI3NTI2RAA='}]}
2025-07-03 21:57:49,752 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:57:49] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:57:51,387 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:57:51] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:57:51,393 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:57:51] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:57:51,419 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:57:51] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:57:51,970 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:57:51] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:57:52,345 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:57:52] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:57:52,943 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:57:52] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:57:52,960 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:57:52] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:57:53,725 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:57:53] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:57:54,099 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:57:54] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:57:55,783 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:57:55] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:57:56,122 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:57:56] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:57:58,154 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:57:58] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:57:58,507 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:57:58] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:58:00,432 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:58:00] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:58:01,367 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:58:01] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:58:01,379 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:58:01] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:58:02,452 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:58:02] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:58:02,529 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:58:02] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:58:03,028 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:58:03] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:58:04,353 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:58:04] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:58:05,124 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:58:05] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:58:07,431 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:58:07] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:58:11,987 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:58:11] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:58:15,065 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:58:15] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:58:24,284 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:58:24] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:58:26,019 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:58:26] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:58:31,045 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:58:31] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:58:33,181 - handlers.webhook_handler - INFO - Processing message from 2349092157050 (User: Afolayan Abiodun): {'type': 'text', 'text': "Hello. I will not be able to attend this event. I'll be out of the country.  Thank you very much"}
2025-07-03 21:58:33,181 - utils.session_manager - INFO - New session 2349092157050 initialized.
2025-07-03 21:58:33,189 - services.lead_tracker - INFO - New lead tracked: 2349092157050 (Afolayan Abiodun)
2025-07-03 21:58:33,199 - handlers.base_handler - INFO - Session 2349092157050 identified as guest, prompting for name and address.
2025-07-03 21:58:34,018 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349092157050","wa_id":"2349092157050"}],"messages":[{"id":"wamid.HBgNMjM0OTA5MjE1NzA1MBUCABEYEjI2NjYwRUM2NUM1RjNEMEE4MgA="}]}
2025-07-03 21:58:34,019 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349092157050', 'wa_id': '2349092157050'}], 'messages': [{'id': 'wamid.HBgNMjM0OTA5MjE1NzA1MBUCABEYEjI2NjYwRUM2NUM1RjNEMEE4MgA='}]}
2025-07-03 21:58:34,020 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:58:34] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:58:38,001 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:58:38] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:58:43,450 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:58:43] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:59:19,135 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:59:19] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:59:24,701 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:59:24] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:59:31,623 - utils.session_manager - INFO - New session 2348023361055 initialized.
2025-07-03 21:59:31,629 - services.lead_tracker - INFO - New lead tracked: 2348023361055 (Sweet sixteen)
2025-07-03 21:59:31,637 - handlers.base_handler - INFO - Session 2348023361055 identified as guest, prompting for name and address.
2025-07-03 21:59:32,640 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348023361055","wa_id":"2348023361055"}],"messages":[{"id":"wamid.HBgNMjM0ODAyMzM2MTA1NRUCABEYEkIxNTMwN0U4QURBRTRDQzhFMwA="}]}
2025-07-03 21:59:32,641 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348023361055', 'wa_id': '2348023361055'}], 'messages': [{'id': 'wamid.HBgNMjM0ODAyMzM2MTA1NRUCABEYEkIxNTMwN0U4QURBRTRDQzhFMwA='}]}
2025-07-03 21:59:32,641 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:59:32] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:59:34,108 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:59:34] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:59:53,998 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:59:53] "POST /webhook HTTP/1.1" 200 -
2025-07-03 21:59:57,765 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 21:59:57] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:00:00,965 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:00:00] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:00:52,449 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:00:52] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:01:08,952 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:01:08] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:01:09,406 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:01:09] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:01:44,380 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:01:44] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:02:14,714 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:02:14] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:02:33,984 - handlers.webhook_handler - INFO - Processing message from 2348028373794 (User: toplargemakeover): {'type': 'text', 'text': 'Ive rsvp before'}
2025-07-03 22:02:33,987 - utils.session_manager - INFO - New session 2348028373794 initialized.
2025-07-03 22:02:33,993 - services.lead_tracker - INFO - New lead tracked: 2348028373794 (toplargemakeover)
2025-07-03 22:02:34,000 - handlers.base_handler - INFO - Session 2348028373794 identified as guest, prompting for name and address.
2025-07-03 22:02:34,816 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348028373794","wa_id":"2348028373794"}],"messages":[{"id":"wamid.HBgNMjM0ODAyODM3Mzc5NBUCABEYEjEzNkEwMzg3MDU4MkNDMzMxMQA="}]}
2025-07-03 22:02:34,817 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348028373794', 'wa_id': '2348028373794'}], 'messages': [{'id': 'wamid.HBgNMjM0ODAyODM3Mzc5NBUCABEYEjEzNkEwMzg3MDU4MkNDMzMxMQA='}]}
2025-07-03 22:02:34,817 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:02:34] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:02:36,910 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:02:36] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:02:40,663 - handlers.webhook_handler - INFO - Processing message from 2348028373794 (User: toplargemakeover): {'type': 'text', 'text': 'Im I doing it again'}
2025-07-03 22:02:40,669 - handlers.message_processor - WARNING - No specific handler or state match for handler 'greeting_handler', state 'guest_info_prompt', message 'im i doing it again' for session 2348028373794. Resetting to greeting.
2025-07-03 22:02:40,670 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348028373794', 'type': 'text', 'text': {'body': "I'm sorry, I didn't quite understand that. Let's get back to the main menu."}}
2025-07-03 22:02:41,351 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348028373794","wa_id":"2348028373794"}],"messages":[{"id":"wamid.HBgNMjM0ODAyODM3Mzc5NBUCABEYEkNDQTVDMzUyRkVEREVCOUUxOQA="}]}
2025-07-03 22:02:42,251 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:02:42] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:02:42,322 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348028373794","wa_id":"2348028373794"}],"messages":[{"id":"wamid.HBgNMjM0ODAyODM3Mzc5NBUCABEYEjU2QTQ4N0ZERkVFMjJBMUFFMgA="}]}
2025-07-03 22:02:42,322 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348028373794', 'wa_id': '2348028373794'}], 'messages': [{'id': 'wamid.HBgNMjM0ODAyODM3Mzc5NBUCABEYEjU2QTQ4N0ZERkVFMjJBMUFFMgA='}]}
2025-07-03 22:02:42,323 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:02:42] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:02:43,217 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:02:43] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:02:44,097 - handlers.webhook_handler - INFO - Processing message from 2348023056444 (User: Shemlash Shemlash): {'type': 'text', 'text': 'Confirmed'}
2025-07-03 22:02:44,098 - utils.session_manager - INFO - New session 2348023056444 initialized.
2025-07-03 22:02:44,104 - services.lead_tracker - INFO - New lead tracked: 2348023056444 (Shemlash Shemlash)
2025-07-03 22:02:44,111 - handlers.base_handler - INFO - Session 2348023056444 identified as guest, prompting for name and address.
2025-07-03 22:02:45,045 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348023056444","wa_id":"2348023056444"}],"messages":[{"id":"wamid.HBgNMjM0ODAyMzA1NjQ0NBUCABEYEjk1NTQzMTgxRTczMDUxMURFNAA="}]}
2025-07-03 22:02:45,046 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348023056444', 'wa_id': '2348023056444'}], 'messages': [{'id': 'wamid.HBgNMjM0ODAyMzA1NjQ0NBUCABEYEjk1NTQzMTgxRTczMDUxMURFNAA='}]}
2025-07-03 22:02:45,047 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:02:45] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:02:46,720 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:02:46] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:14:16,694 - __main__ - INFO - Starting WhatsApp bot server...
2025-07-03 22:14:18,851 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-07-03 22:14:18,851 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-07-03 22:14:22,918 - utils.data_manager - ERROR - Database error while loading menu data: connection to server at "localhost" (::1), port 5432 failed: Connection refused (0x0000274D/10061)
	Is the server running on that host and accepting TCP/IP connections?
connection to server at "localhost" (127.0.0.1), port 5432 failed: Connection refused (0x0000274D/10061)
	Is the server running on that host and accepting TCP/IP connections?

2025-07-03 22:14:22,920 - services.payment_service - INFO - PaymentService initialized
2025-07-03 22:14:22,920 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-07-03 22:14:22,921 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-07-03 22:14:27,008 - utils.data_manager - ERROR - Database error while loading menu data: connection to server at "localhost" (::1), port 5432 failed: Connection refused (0x0000274D/10061)
	Is the server running on that host and accepting TCP/IP connections?
connection to server at "localhost" (127.0.0.1), port 5432 failed: Connection refused (0x0000274D/10061)
	Is the server running on that host and accepting TCP/IP connections?

2025-07-03 22:14:27,009 - services.payment_service - INFO - PaymentService initialized
2025-07-03 22:14:27,009 - services.lead_tracker - INFO - LeadTracker initialized
2025-07-03 22:14:27,009 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-07-03 22:14:27,010 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-07-03 22:14:27,010 - handlers.order_handler - INFO - OrderHandler initialized.
2025-07-03 22:14:27,010 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-07-03 22:14:27,011 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-07-03 22:14:27,500 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-07-03 22:14:27,501 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-07-03 22:14:27,501 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-07-03 22:14:27,501 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-07-03 22:14:27,516 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-07-03 22:14:27,516 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-07-03 22:14:52,606 - handlers.webhook_handler - WARNING - No valid message data extracted for 2348098071242. Message type: reaction
2025-07-03 22:14:52,609 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:14:52] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:14:56,071 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:14:56] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:15:05,478 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:15:05] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:15:07,632 - handlers.webhook_handler - INFO - Processing message from 2348098071242 (User: Heritage): {'type': 'text', 'text': 'Done'}
2025-07-03 22:15:07,632 - utils.session_manager - INFO - New session 2348098071242 initialized.
2025-07-03 22:15:07,638 - services.lead_tracker - INFO - New lead tracked: 2348098071242 (Heritage)
2025-07-03 22:15:07,667 - handlers.base_handler - INFO - Session 2348098071242 identified as guest, prompting for name and address.
2025-07-03 22:15:08,535 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348098071242","wa_id":"2348098071242"}],"messages":[{"id":"wamid.HBgNMjM0ODA5ODA3MTI0MhUCABEYEjY4MjU0RUUxQkNFQ0JCRTBEMQA="}]}
2025-07-03 22:15:08,537 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348098071242', 'wa_id': '2348098071242'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA5ODA3MTI0MhUCABEYEjY4MjU0RUUxQkNFQ0JCRTBEMQA='}]}
2025-07-03 22:15:08,538 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:15:08] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:15:11,616 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:15:11] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:15:12,248 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:15:12] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:15:13,077 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:15:13] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:15:39,048 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:15:39] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:15:39,348 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:15:39] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:15:48,033 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:15:48] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:15:54,769 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:15:54] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:15:58,437 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:15:58] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:16:18,783 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:16:18] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:16:25,560 - handlers.webhook_handler - INFO - Processing message from 2348037181158 (User: jennifer): {'type': 'text', 'text': 'I did this earlier.'}
2025-07-03 22:16:25,561 - utils.session_manager - INFO - New session 2348037181158 initialized.
2025-07-03 22:16:25,564 - services.lead_tracker - INFO - New lead tracked: 2348037181158 (jennifer)
2025-07-03 22:16:25,573 - handlers.base_handler - INFO - Session 2348037181158 identified as guest, prompting for name and address.
2025-07-03 22:16:26,643 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348037181158","wa_id":"2348037181158"}],"messages":[{"id":"wamid.HBgNMjM0ODAzNzE4MTE1OBUCABEYEjU0OUJCRkQyOURBRDA3MDEzRAA="}]}
2025-07-03 22:16:26,644 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348037181158', 'wa_id': '2348037181158'}], 'messages': [{'id': 'wamid.HBgNMjM0ODAzNzE4MTE1OBUCABEYEjU0OUJCRkQyOURBRDA3MDEzRAA='}]}
2025-07-03 22:16:26,645 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:16:26] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:16:28,547 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:16:28] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:16:28,907 - handlers.webhook_handler - WARNING - No valid message data extracted for 2349038105300. Message type: sticker
2025-07-03 22:16:28,908 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:16:28] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:16:34,572 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:16:34] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:16:37,443 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:16:37] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:16:45,043 - __main__ - INFO - Starting WhatsApp bot server...
2025-07-03 22:16:46,288 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-07-03 22:16:46,289 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-07-03 22:16:48,188 - utils.data_manager - INFO - Successfully loaded 17 menu items from database
2025-07-03 22:16:48,409 - services.payment_service - INFO - PaymentService initialized
2025-07-03 22:16:48,409 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-07-03 22:16:48,410 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-07-03 22:16:50,144 - utils.data_manager - INFO - Successfully loaded 17 menu items from database
2025-07-03 22:16:50,345 - services.payment_service - INFO - PaymentService initialized
2025-07-03 22:16:50,346 - services.lead_tracker - INFO - LeadTracker initialized
2025-07-03 22:16:50,346 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-07-03 22:16:50,347 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-07-03 22:16:50,347 - handlers.order_handler - INFO - OrderHandler initialized.
2025-07-03 22:16:50,347 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-07-03 22:16:50,348 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-07-03 22:16:50,718 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-07-03 22:16:50,718 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-07-03 22:16:50,719 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-07-03 22:16:50,719 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-07-03 22:16:50,730 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-07-03 22:16:50,730 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-07-03 22:16:51,659 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:16:51] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:16:53,591 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:16:53] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:17:18,083 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:17:18] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:17:23,619 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:17:23] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:17:29,237 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-07-03 22:17:29,238 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-07-03 22:17:29,243 - handlers.base_handler - INFO - Session 2348055614455 recognized user 'Ziga'.
2025-07-03 22:17:29,364 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:17:29] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:17:29,991 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjdEMkQ2RjU0MzZBMzFERUJDRgA="}]}
2025-07-03 22:17:29,992 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjdEMkQ2RjU0MzZBMzFERUJDRgA='}]}
2025-07-03 22:17:29,992 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:17:29] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:17:30,896 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:17:30] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:17:32,006 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:17:32] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:17:34,803 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-07-03 22:17:34,806 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-07-03 22:17:34,806 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-07-03 22:17:34,807 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-07-03 22:17:34,807 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-07-03 22:17:34,807 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'image', 'image': {'link': 'https://test.mackennytutors.com/wp-content/uploads/2025/06/ganador.jpg', 'caption': 'Our Delicious Menu!'}}
2025-07-03 22:17:35,957 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkQ3NjI2NUYyNkE4QjkzMjA0QgA="}]}
2025-07-03 22:17:35,958 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Hi, I'm Lola from Ganador \n\nTake a look at the menu and type in your order\n\n"}}
2025-07-03 22:17:36,692 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjBENDU5MkYxMEFBM0RBNzMwOQA="}]}
2025-07-03 22:17:36,692 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjBENDU5MkYxMEFBM0RBNzMwOQA='}]}
2025-07-03 22:17:36,693 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:17:36] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:17:37,463 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:17:37] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:17:37,936 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:17:37] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:17:38,194 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:17:38] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:17:38,428 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:17:38] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:17:38,564 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:17:38] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:17:39,130 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:17:39] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:17:45,231 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Jellof rice'}
2025-07-03 22:17:45,234 - handlers.base_handler - INFO - AIHandler: Handling message 'jellof rice' in AI bulk order state for session 2348055614455. Original: 'Jellof rice'
2025-07-03 22:17:46,005 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkM2RDE3NEY1NEQ4RDQwQkY5MgA="}]}
2025-07-03 22:17:46,016 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkM2RDE3NEY1NEQ4RDQwQkY5MgA='}]}
2025-07-03 22:17:46,016 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:17:46] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:17:46,749 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:17:46] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:17:47,254 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:17:47] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:17:47,596 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:17:47] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:17:49,127 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:17:49] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:17:57,091 - handlers.webhook_handler - WARNING - No valid message data extracted for 2348183929999. Message type: reaction
2025-07-03 22:17:57,091 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:17:57] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:18:15,256 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:18:15] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:18:15,378 - handlers.webhook_handler - INFO - Processing message from 2348069405920 (User: Oluwaseun is Ewaoluwa): {'type': 'text', 'text': 'Good evening'}
2025-07-03 22:18:15,379 - utils.session_manager - INFO - New session 2348069405920 initialized.
2025-07-03 22:18:15,383 - services.lead_tracker - INFO - New lead tracked: 2348069405920 (Oluwaseun is Ewaoluwa)
2025-07-03 22:18:15,391 - handlers.base_handler - INFO - Session 2348069405920 identified as guest, prompting for name and address.
2025-07-03 22:18:16,197 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348069405920","wa_id":"2348069405920"}],"messages":[{"id":"wamid.HBgNMjM0ODA2OTQwNTkyMBUCABEYEkNDRjM2MDk3NjYxNjczNDA5RgA="}]}
2025-07-03 22:18:16,198 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348069405920', 'wa_id': '2348069405920'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA2OTQwNTkyMBUCABEYEkNDRjM2MDk3NjYxNjczNDA5RgA='}]}
2025-07-03 22:18:16,198 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:18:16] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:18:18,809 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:18:18] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:18:19,654 - handlers.webhook_handler - INFO - Processing message from 2348069405920 (User: Oluwaseun is Ewaoluwa): {'type': 'text', 'text': 'Done'}
2025-07-03 22:18:19,661 - handlers.message_processor - WARNING - No specific handler or state match for handler 'greeting_handler', state 'guest_info_prompt', message 'done' for session 2348069405920. Resetting to greeting.
2025-07-03 22:18:19,662 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348069405920', 'type': 'text', 'text': {'body': "I'm sorry, I didn't quite understand that. Let's get back to the main menu."}}
2025-07-03 22:18:19,808 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:18:19] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:18:20,288 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348069405920","wa_id":"2348069405920"}],"messages":[{"id":"wamid.HBgNMjM0ODA2OTQwNTkyMBUCABEYEjU1MzFEMEY3RUE0MzJGMDc3OQA="}]}
2025-07-03 22:18:20,849 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348069405920","wa_id":"2348069405920"}],"messages":[{"id":"wamid.HBgNMjM0ODA2OTQwNTkyMBUCABEYEkRFODdGMzNENjYyQUIxNDcxQgA="}]}
2025-07-03 22:18:20,849 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348069405920', 'wa_id': '2348069405920'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA2OTQwNTkyMBUCABEYEkRFODdGMzNENjYyQUIxNDcxQgA='}]}
2025-07-03 22:18:20,850 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:18:20] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:18:20,922 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:18:20] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:18:21,792 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:18:21] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:18:23,916 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:18:23] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:19:02,433 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:19:02] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:19:32,816 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:19:32] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:20:19,093 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:20:19] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:21:41,508 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:21:41] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:25:48,241 - __main__ - INFO - Starting WhatsApp bot server...
2025-07-03 22:25:49,742 - __main__ - ERROR - Import error: No module named 'product_sync_handler'
2025-07-03 22:27:18,900 - __main__ - INFO - Starting WhatsApp bot server...
2025-07-03 22:27:20,013 - __main__ - ERROR - Import error: No module named 'product_sync_handler'
2025-07-03 22:27:31,547 - __main__ - INFO - Starting WhatsApp bot server...
2025-07-03 22:27:32,812 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-07-03 22:27:32,813 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-07-03 22:27:32,814 - services.payment_service - INFO - PaymentService initialized
2025-07-03 22:27:36,422 - handlers.product_sync_handler - INFO - Successfully synced 17 products to data\products.json
2025-07-03 22:27:36,715 - app - INFO - Initial product sync successful on startup
2025-07-03 22:27:36,715 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-07-03 22:27:36,715 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-07-03 22:27:36,716 - services.payment_service - INFO - PaymentService initialized
2025-07-03 22:27:36,716 - services.lead_tracker - INFO - LeadTracker initialized
2025-07-03 22:27:36,716 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-07-03 22:27:36,717 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-07-03 22:27:36,717 - handlers.order_handler - INFO - OrderHandler initialized.
2025-07-03 22:27:36,718 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-07-03 22:27:36,718 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-07-03 22:27:37,174 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-07-03 22:27:37,175 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-07-03 22:27:37,175 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-07-03 22:27:37,175 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-07-03 22:27:37,191 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-07-03 22:27:37,191 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-07-03 22:28:08,110 - __main__ - INFO - Starting WhatsApp bot server...
2025-07-03 22:28:09,258 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-07-03 22:28:09,259 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-07-03 22:28:09,260 - services.payment_service - INFO - PaymentService initialized
2025-07-03 22:28:11,045 - handlers.product_sync_handler - INFO - Successfully synced 17 products to data\products.json
2025-07-03 22:28:11,264 - app - INFO - Initial product sync successful on startup
2025-07-03 22:28:11,264 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-07-03 22:28:11,265 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-07-03 22:28:11,266 - services.payment_service - INFO - PaymentService initialized
2025-07-03 22:28:11,266 - services.lead_tracker - INFO - LeadTracker initialized
2025-07-03 22:28:11,266 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-07-03 22:28:11,267 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-07-03 22:28:11,267 - handlers.order_handler - INFO - OrderHandler initialized.
2025-07-03 22:28:11,267 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-07-03 22:28:11,268 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-07-03 22:28:11,670 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-07-03 22:28:11,670 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-07-03 22:28:11,671 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-07-03 22:28:11,671 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-07-03 22:28:11,683 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-07-03 22:28:11,683 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-07-03 22:28:12,098 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:28:12] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:28:15,001 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-07-03 22:28:15,001 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-07-03 22:28:15,016 - handlers.base_handler - INFO - Session 2348055614455 recognized user 'Ziga'.
2025-07-03 22:28:15,838 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjUwMTJBNzA2MUU3MURBRDRCNwA="}]}
2025-07-03 22:28:15,839 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjUwMTJBNzA2MUU3MURBRDRCNwA='}]}
2025-07-03 22:28:15,839 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:28:15] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:28:16,673 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:28:16] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:28:16,910 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:28:16] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:28:17,280 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:28:17] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:28:18,587 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-07-03 22:28:18,590 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-07-03 22:28:18,590 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-07-03 22:28:18,591 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-07-03 22:28:18,591 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-07-03 22:28:18,592 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'image', 'image': {'link': 'https://test.mackennytutors.com/wp-content/uploads/2025/06/ganador.jpg', 'caption': 'Our Delicious Menu!'}}
2025-07-03 22:28:19,342 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjNDQ0Y5RDA2QUE5REFGREJCMgA="}]}
2025-07-03 22:28:19,343 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Hi, I'm Lola from Ganador \n\nTake a look at the menu and type in your order\n\n"}}
2025-07-03 22:28:20,142 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkI4QjQ1RjU3QkI1NjVCNTZFNAA="}]}
2025-07-03 22:28:20,143 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkI4QjQ1RjU3QkI1NjVCNTZFNAA='}]}
2025-07-03 22:28:20,143 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:28:20] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:28:20,969 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:28:20] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:28:21,197 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:28:21] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:28:21,555 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:28:21] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:28:21,812 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:28:21] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:28:21,821 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:28:21] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:28:22,407 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:28:22] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:28:25,396 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Fried rice'}
2025-07-03 22:28:25,399 - handlers.base_handler - INFO - AIHandler: Handling message 'fried rice' in AI bulk order state for session 2348055614455. Original: 'Fried rice'
2025-07-03 22:28:27,752 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-07-03 22:28:28,427 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQyN0JDRTg5OEY2MEYxNDNDOAA="}]}
2025-07-03 22:28:28,428 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQyN0JDRTg5OEY2MEYxNDNDOAA='}]}
2025-07-03 22:28:28,428 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:28:28] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:28:29,383 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:28:29] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:28:29,493 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:28:29] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:28:29,884 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:28:29] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:28:46,400 - __main__ - INFO - Starting WhatsApp bot server...
2025-07-03 22:28:47,675 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-07-03 22:28:47,676 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-07-03 22:28:47,676 - utils.data_manager - WARNING - File not found or empty: data\menu.json
2025-07-03 22:28:47,676 - utils.data_manager - WARNING - Menu data in data\menu.json is not a dictionary. Initializing as empty.
2025-07-03 22:28:47,677 - services.payment_service - INFO - PaymentService initialized
2025-07-03 22:28:49,519 - handlers.product_sync_handler - INFO - Successfully synced 17 products to data\products.json
2025-07-03 22:28:49,722 - app - INFO - Initial product sync successful on startup
2025-07-03 22:28:49,722 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-07-03 22:28:49,723 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-07-03 22:28:49,723 - utils.data_manager - WARNING - File not found or empty: data\menu.json
2025-07-03 22:28:49,723 - utils.data_manager - WARNING - Menu data in data\menu.json is not a dictionary. Initializing as empty.
2025-07-03 22:28:49,724 - services.payment_service - INFO - PaymentService initialized
2025-07-03 22:28:49,724 - services.lead_tracker - INFO - LeadTracker initialized
2025-07-03 22:28:49,724 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-07-03 22:28:49,725 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-07-03 22:28:49,725 - handlers.order_handler - INFO - OrderHandler initialized.
2025-07-03 22:28:49,725 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-07-03 22:28:49,726 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-07-03 22:28:50,107 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-07-03 22:28:50,107 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-07-03 22:28:50,107 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-07-03 22:28:50,108 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-07-03 22:28:50,119 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-07-03 22:28:50,119 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-07-03 22:28:52,237 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-07-03 22:28:52,237 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-07-03 22:28:52,243 - handlers.base_handler - INFO - Session 2348055614455 recognized user 'Ziga'.
2025-07-03 22:28:52,928 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjgwMTE4RkMwRERBNUNDRjdCQgA="}]}
2025-07-03 22:28:52,929 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjgwMTE4RkMwRERBNUNDRjdCQgA='}]}
2025-07-03 22:28:52,930 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:28:52] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:28:53,661 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:28:53] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:28:53,927 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:28:53] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:28:54,398 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:28:54] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:28:55,556 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-07-03 22:28:55,559 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-07-03 22:28:55,560 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-07-03 22:28:55,560 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-07-03 22:28:55,561 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-07-03 22:28:55,561 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'image', 'image': {'link': 'https://test.mackennytutors.com/wp-content/uploads/2025/06/ganador.jpg', 'caption': 'Our Delicious Menu!'}}
2025-07-03 22:28:56,220 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjZDODcyQTMzMUVCMzYxQ0UxRAA="}]}
2025-07-03 22:28:56,220 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Hi, I'm Lola from Ganador \n\nTake a look at the menu and type in your order\n\n"}}
2025-07-03 22:28:56,903 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjZBQzQ3NDlEQzM4QThFODNFRgA="}]}
2025-07-03 22:28:56,904 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjZBQzQ3NDlEQzM4QThFODNFRgA='}]}
2025-07-03 22:28:56,905 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:28:56] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:28:57,396 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:28:57] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:28:57,449 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:28:57] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:28:57,607 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:28:57] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:28:57,898 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:28:57] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:28:57,906 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:28:57] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:28:58,222 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:28:58] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:29:01,694 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Fried'}
2025-07-03 22:29:01,697 - handlers.base_handler - INFO - AIHandler: Handling message 'fried' in AI bulk order state for session 2348055614455. Original: 'Fried'
2025-07-03 22:29:01,697 - services.ai_service - WARNING - Menu data not available in DataManager for AI context.
2025-07-03 22:29:03,972 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-07-03 22:29:04,730 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjYxRjIxMTFDMEUwQ0NGNzdCRAA="}]}
2025-07-03 22:29:04,731 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjYxRjIxMTFDMEUwQ0NGNzdCRAA='}]}
2025-07-03 22:29:04,731 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:29:04] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:29:05,545 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:29:05] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:29:05,742 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:29:05] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:29:06,407 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:29:06] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:29:32,839 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:29:32] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:30:09,713 - __main__ - INFO - Starting WhatsApp bot server...
2025-07-03 22:30:10,898 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-07-03 22:30:10,899 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-07-03 22:30:10,899 - services.payment_service - INFO - PaymentService initialized
2025-07-03 22:30:13,097 - handlers.product_sync_handler - INFO - Successfully synced 17 products to data\products.json
2025-07-03 22:30:13,322 - app - INFO - Initial product sync successful on startup
2025-07-03 22:30:13,322 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-07-03 22:30:13,323 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-07-03 22:30:13,324 - services.payment_service - INFO - PaymentService initialized
2025-07-03 22:30:13,324 - services.lead_tracker - INFO - LeadTracker initialized
2025-07-03 22:30:13,324 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-07-03 22:30:13,325 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-07-03 22:30:13,325 - handlers.order_handler - INFO - OrderHandler initialized.
2025-07-03 22:30:13,326 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-07-03 22:30:13,326 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-07-03 22:30:13,713 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-07-03 22:30:13,714 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-07-03 22:30:13,714 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-07-03 22:30:13,714 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-07-03 22:30:13,726 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-07-03 22:30:13,726 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-07-03 22:30:16,434 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Chicken'}
2025-07-03 22:30:16,434 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-07-03 22:30:16,439 - handlers.base_handler - INFO - Session 2348055614455 recognized user 'Ziga'.
2025-07-03 22:30:17,165 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkRCQTlGNDU0MjE1Q0U2RjdDMAA="}]}
2025-07-03 22:30:17,165 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkRCQTlGNDU0MjE1Q0U2RjdDMAA='}]}
2025-07-03 22:30:17,166 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:30:17] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:30:18,120 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:30:18] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:30:18,716 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:30:18] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:30:18,723 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:30:18] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:30:18,759 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:30:18] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:30:20,163 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-07-03 22:30:20,166 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-07-03 22:30:20,166 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-07-03 22:30:20,167 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-07-03 22:30:20,167 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-07-03 22:30:20,168 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'image', 'image': {'link': 'https://test.mackennytutors.com/wp-content/uploads/2025/06/ganador.jpg', 'caption': 'Our Delicious Menu!'}}
2025-07-03 22:30:21,123 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjVBQ0FBMEM0MTFBNjFCRUEwNgA="}]}
2025-07-03 22:30:21,124 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Hi, I'm Lola from Ganador \n\nTake a look at the menu and type in your order\n\n"}}
2025-07-03 22:30:21,945 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkIwNERFMDIyRUZBM0VGQTYxRgA="}]}
2025-07-03 22:30:21,946 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkIwNERFMDIyRUZBM0VGQTYxRgA='}]}
2025-07-03 22:30:21,947 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:30:21] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:30:22,197 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:30:22] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:30:22,434 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:30:22] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:30:22,804 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:30:22] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:30:23,106 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:30:23] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:30:23,147 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:30:23] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:30:23,431 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:30:23] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:30:25,469 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Chicken'}
2025-07-03 22:30:25,472 - handlers.base_handler - INFO - AIHandler: Handling message 'chicken' in AI bulk order state for session 2348055614455. Original: 'Chicken'
2025-07-03 22:30:27,644 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-07-03 22:30:28,412 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkM0QkNGQUZDRjMxRjYzNzQyQQA="}]}
2025-07-03 22:30:28,413 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkM0QkNGQUZDRjMxRjYzNzQyQQA='}]}
2025-07-03 22:30:28,413 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:30:28] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:30:29,456 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:30:29] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:30:29,458 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:30:29] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:30:29,687 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:30:29] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:30:53,765 - handlers.webhook_handler - INFO - Processing message from 2348034363557 (User: Afolabi Abiodun): {'type': 'text', 'text': 'Thanks God, Big congratulations to family'}
2025-07-03 22:30:53,765 - utils.session_manager - INFO - New session 2348034363557 initialized.
2025-07-03 22:30:53,773 - services.lead_tracker - INFO - New lead tracked: 2348034363557 (Afolabi Abiodun)
2025-07-03 22:30:53,787 - handlers.base_handler - INFO - Session 2348034363557 identified as guest, prompting for name and address.
2025-07-03 22:30:54,533 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348034363557","wa_id":"2348034363557"}],"messages":[{"id":"wamid.HBgNMjM0ODAzNDM2MzU1NxUCABEYEkVFNTZDODdDRUQ5MjI2RUJDRQA="}]}
2025-07-03 22:30:54,534 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348034363557', 'wa_id': '2348034363557'}], 'messages': [{'id': 'wamid.HBgNMjM0ODAzNDM2MzU1NxUCABEYEkVFNTZDODdDRUQ5MjI2RUJDRQA='}]}
2025-07-03 22:30:54,535 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:30:54] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:30:55,599 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:30:55] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:31:23,134 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:31:23] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:31:31,327 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:31:31] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:39:01,511 - __main__ - INFO - Starting WhatsApp bot server...
2025-07-03 22:39:04,531 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-07-03 22:39:09,029 - utils.data_manager - INFO - Successfully loaded 4 user details from database
2025-07-03 22:39:09,240 - services.payment_service - INFO - PaymentService initialized
2025-07-03 22:39:11,158 - handlers.product_sync_handler - INFO - Successfully synced 17 products to data\products.json
2025-07-03 22:39:11,384 - app - INFO - Initial product sync successful on startup
2025-07-03 22:39:11,385 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-07-03 22:39:13,426 - utils.data_manager - INFO - Successfully loaded 4 user details from database
2025-07-03 22:39:13,829 - services.payment_service - INFO - PaymentService initialized
2025-07-03 22:39:13,829 - services.lead_tracker - INFO - LeadTracker initialized
2025-07-03 22:39:13,830 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-07-03 22:39:13,881 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-07-03 22:39:13,882 - handlers.order_handler - INFO - OrderHandler initialized.
2025-07-03 22:39:13,883 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-07-03 22:39:13,883 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-07-03 22:39:14,683 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-07-03 22:39:14,683 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-07-03 22:39:14,684 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-07-03 22:39:14,685 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-07-03 22:39:14,762 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-07-03 22:39:14,763 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-07-03 22:39:17,039 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-07-03 22:39:17,040 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-07-03 22:39:17,052 - handlers.base_handler - INFO - Session 2348055614455 identified as guest, prompting for name and address.
2025-07-03 22:39:18,357 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjlGMzUxMDUyNjUyNUQ3NDMwNwA="}]}
2025-07-03 22:39:18,359 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjlGMzUxMDUyNjUyNUQ3NDMwNwA='}]}
2025-07-03 22:39:18,361 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:39:18] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:39:19,102 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:39:19] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:39:19,564 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:39:19] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:39:19,746 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:39:19] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:39:21,266 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:39:21] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:39:27,183 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Victor,Makinde'}
2025-07-03 22:39:27,187 - handlers.message_processor - WARNING - No specific handler or state match for handler 'greeting_handler', state 'guest_info_prompt', message 'victor,makinde' for session 2348055614455. Resetting to greeting.
2025-07-03 22:39:27,188 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "I'm sorry, I didn't quite understand that. Let's get back to the main menu."}}
2025-07-03 22:39:28,039 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjBCMjU4QTUxNTBDNDU5M0M3QQA="}]}
2025-07-03 22:39:28,820 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkZCNDM0QjQ2ODcxMjdDRDAyQQA="}]}
2025-07-03 22:39:28,821 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkZCNDM0QjQ2ODcxMjdDRDAyQQA='}]}
2025-07-03 22:39:28,823 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:39:28] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:39:28,847 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:39:28] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:39:29,172 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:39:29] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:39:29,717 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:39:29] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:39:29,780 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:39:29] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:39:29,922 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:39:29] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:39:30,665 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 22:39:30] "POST /webhook HTTP/1.1" 200 -
2025-07-03 22:59:47,767 - __main__ - INFO - Starting WhatsApp bot server...
2025-07-03 22:59:48,692 - __main__ - ERROR - Import error: cannot import name 'OrderHandler' from 'handlers.order_handler' (C:\Users\zigam\Documents\Lola\app\handlers\order_handler.py)
2025-07-03 23:01:57,111 - __main__ - INFO - Starting WhatsApp bot server...
2025-07-03 23:01:59,013 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-07-03 23:02:01,802 - utils.data_manager - INFO - Successfully loaded 4 user details from database
2025-07-03 23:02:02,022 - utils.data_manager - WARNING - File not found or empty: data\menu.json
2025-07-03 23:02:02,022 - utils.data_manager - WARNING - Menu data in data\menu.json is not a dictionary. Initializing as empty.
2025-07-03 23:02:02,023 - services.payment_service - INFO - PaymentService initialized
2025-07-03 23:02:03,970 - handlers.product_sync_handler - INFO - Successfully synced 17 products to data\products.json
2025-07-03 23:02:04,191 - app - INFO - Initial product sync successful on startup
2025-07-03 23:02:04,192 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-07-03 23:02:06,064 - utils.data_manager - INFO - Successfully loaded 4 user details from database
2025-07-03 23:02:06,274 - utils.data_manager - WARNING - File not found or empty: data\menu.json
2025-07-03 23:02:06,274 - utils.data_manager - WARNING - Menu data in data\menu.json is not a dictionary. Initializing as empty.
2025-07-03 23:02:06,274 - services.payment_service - INFO - PaymentService initialized
2025-07-03 23:02:06,275 - services.lead_tracker - INFO - LeadTracker initialized
2025-07-03 23:02:06,275 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-07-03 23:02:06,277 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-07-03 23:02:06,277 - handlers.order_handler - INFO - OrderHandler initialized.
2025-07-03 23:02:06,277 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-07-03 23:02:06,277 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-07-03 23:02:06,750 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-07-03 23:02:06,750 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-07-03 23:02:06,750 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-07-03 23:02:06,751 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-07-03 23:02:06,778 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-07-03 23:02:06,778 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-07-03 23:02:40,267 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-07-03 23:02:40,268 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-07-03 23:02:42,601 - handlers.base_handler - INFO - Session 2348055614455 identified as guest, prompting for name and address.
2025-07-03 23:02:43,475 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjM5OEI3NTdBOUEzOTAwNDk5RAA="}]}
2025-07-03 23:02:43,476 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjM5OEI3NTdBOUEzOTAwNDk5RAA='}]}
2025-07-03 23:02:43,477 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:02:43] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:02:44,360 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:02:44] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:02:44,585 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:02:44] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:02:57,798 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Victor,'}
2025-07-03 23:02:57,801 - handlers.message_processor - WARNING - No specific handler or state match for handler 'greeting_handler', state 'guest_info_prompt', message 'victor,' for session 2348055614455. Resetting to greeting.
2025-07-03 23:02:57,801 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "I'm sorry, I didn't quite understand that. Let's get back to the main menu."}}
2025-07-03 23:02:58,498 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkZCQkQ1NzVEOTc5REI5MTdBNQA="}]}
2025-07-03 23:02:59,232 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjY3QkQ5MzA1OEY2RjZDOUUyMQA="}]}
2025-07-03 23:02:59,233 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjY3QkQ5MzA1OEY2RjZDOUUyMQA='}]}
2025-07-03 23:02:59,233 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:02:59] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:02:59,436 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:02:59] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:02:59,623 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:02:59] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:02:59,940 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:02:59] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:03:00,071 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:03:00] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:03:00,291 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:03:00] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:03:00,602 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:03:00] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:03:03,033 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-07-03 23:03:03,037 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-07-03 23:03:03,037 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-07-03 23:03:03,038 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-07-03 23:03:03,039 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-07-03 23:03:03,040 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'image', 'image': {'link': 'https://test.mackennytutors.com/wp-content/uploads/2025/06/ganador.jpg', 'caption': 'Our Delicious Menu!'}}
2025-07-03 23:03:04,050 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkYyRDAyNUU0OEVGMTVBQUYxOQA="}]}
2025-07-03 23:03:04,050 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Hi, I'm Lola from Ganador \n\nTake a look at the menu and type in your order\n\n"}}
2025-07-03 23:03:04,872 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjA5NjRCOTQwQ0E4NDQ1RDVFQwA="}]}
2025-07-03 23:03:04,873 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjA5NjRCOTQwQ0E4NDQ1RDVFQwA='}]}
2025-07-03 23:03:04,873 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:03:04] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:03:05,838 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:03:05] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:03:06,032 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:03:06] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:03:06,330 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:03:06] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:03:06,654 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:03:06] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:03:10,859 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Jellof rice'}
2025-07-03 23:03:10,863 - handlers.base_handler - INFO - AIHandler: Handling message 'jellof rice' in AI bulk order state for session 2348055614455. Original: 'Jellof rice'
2025-07-03 23:03:10,864 - services.ai_service - WARNING - Menu data not available in DataManager for AI context.
2025-07-03 23:03:13,487 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-07-03 23:03:14,144 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjBENjgxMzc4OURFREE5QUY2QQA="}]}
2025-07-03 23:03:14,145 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjBENjgxMzc4OURFREE5QUY2QQA='}]}
2025-07-03 23:03:14,145 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:03:14] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:03:15,094 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:03:15] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:03:15,170 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:03:15] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:03:15,407 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:03:15] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:04:39,963 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:04:39] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:04:49,694 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:04:49] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:05:14,937 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:05:14] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:05:31,994 - __main__ - INFO - Starting WhatsApp bot server...
2025-07-03 23:05:33,970 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-07-03 23:05:33,970 - app - ERROR - Error initializing a core service: 'Config' object has no attribute 'PRODUCTS_FILE'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\app\app.py", line 39, in <module>
    data_manager = DataManager(config)
  File "C:\Users\zigam\Documents\Lola\app\utils\data_manager.py", line 24, in __init__
    self._ensure_data_directory_exists()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\zigam\Documents\Lola\app\utils\data_manager.py", line 30, in _ensure_data_directory_exists
    data_dir = os.path.dirname(self.config.PRODUCTS_FILE) # Changed from MENU_FILE to PRODUCTS_FILE
                               ^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'Config' object has no attribute 'PRODUCTS_FILE'. Did you mean: 'PRODUCT_MENU_FILE'?
2025-07-03 23:06:48,494 - __main__ - INFO - Starting WhatsApp bot server...
2025-07-03 23:06:49,616 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-07-03 23:06:49,617 - app - ERROR - Error initializing a core service: 'Config' object has no attribute 'PRODUCTS_FILE'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\app\app.py", line 39, in <module>
    data_manager = DataManager(config)
  File "C:\Users\zigam\Documents\Lola\app\utils\data_manager.py", line 24, in __init__
    self._ensure_data_directory_exists()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\zigam\Documents\Lola\app\utils\data_manager.py", line 30, in _ensure_data_directory_exists
    data_dir = os.path.dirname(self.config.PRODUCTS_FILE) # Changed from MENU_FILE to PRODUCTS_FILE
                               ^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'Config' object has no attribute 'PRODUCTS_FILE'. Did you mean: 'PRODUCT_MENU_FILE'?
2025-07-03 23:07:20,210 - __main__ - INFO - Starting WhatsApp bot server...
2025-07-03 23:07:21,318 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-07-03 23:07:21,318 - app - ERROR - Error initializing a core service: 'Config' object has no attribute 'PRODUCTS_FILE'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\app\app.py", line 39, in <module>
    data_manager = DataManager(config)
  File "C:\Users\zigam\Documents\Lola\app\utils\data_manager.py", line 24, in __init__
    self._ensure_data_directory_exists()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\zigam\Documents\Lola\app\utils\data_manager.py", line 30, in _ensure_data_directory_exists
    data_dir = os.path.dirname(self.config.PRODUCTS_FILE) # Changed from MENU_FILE to PRODUCTS_FILE
                               ^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'Config' object has no attribute 'PRODUCTS_FILE'. Did you mean: 'PRODUCT_FILE'?
2025-07-03 23:09:22,482 - __main__ - INFO - Starting WhatsApp bot server...
2025-07-03 23:09:23,611 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-07-03 23:09:25,575 - utils.data_manager - INFO - Successfully loaded 4 user details from database
2025-07-03 23:09:25,788 - services.payment_service - INFO - PaymentService initialized
2025-07-03 23:09:25,788 - app - ERROR - Error initializing a core service: 'Config' object has no attribute 'MENU_FILE'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\app\app.py", line 43, in <module>
    product_sync_handler = ProductSyncHandler(config)
  File "C:\Users\zigam\Documents\Lola\app\handlers\product_sync_handler.py", line 22, in __init__
    self.json_file_path = os.path.join(os.path.dirname(self.config.MENU_FILE), 'products.json')
                                                       ^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'Config' object has no attribute 'MENU_FILE'
2025-07-03 23:12:05,583 - __main__ - INFO - Starting WhatsApp bot server...
2025-07-03 23:12:07,583 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-07-03 23:12:11,259 - utils.data_manager - INFO - Successfully loaded 4 user details from database
2025-07-03 23:12:11,514 - services.payment_service - INFO - PaymentService initialized
2025-07-03 23:12:13,358 - handlers.product_sync_handler - INFO - Successfully synced 17 products to data\products.json
2025-07-03 23:12:13,572 - app - INFO - Initial product sync successful on startup
2025-07-03 23:12:13,572 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-07-03 23:12:15,492 - utils.data_manager - INFO - Successfully loaded 4 user details from database
2025-07-03 23:12:15,707 - services.payment_service - INFO - PaymentService initialized
2025-07-03 23:12:15,707 - services.lead_tracker - INFO - LeadTracker initialized
2025-07-03 23:12:15,708 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-07-03 23:12:15,720 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-07-03 23:12:15,720 - handlers.order_handler - INFO - OrderHandler initialized.
2025-07-03 23:12:15,721 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-07-03 23:12:15,721 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-07-03 23:12:16,156 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-07-03 23:12:16,157 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-07-03 23:12:16,157 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-07-03 23:12:16,157 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-07-03 23:12:16,183 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-07-03 23:12:16,184 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-07-03 23:12:16,700 - handlers.webhook_handler - INFO - Processing message from 2348092166618 (User: 'Derin): {'type': 'text', 'text': 'I already did, vide your similar chat on 25 June. Please cross-check.'}
2025-07-03 23:12:16,700 - utils.session_manager - INFO - New session 2348092166618 initialized.
2025-07-03 23:12:16,703 - services.lead_tracker - INFO - New lead tracked: 2348092166618 ('Derin)
2025-07-03 23:12:18,750 - handlers.base_handler - INFO - Session 2348092166618 identified as guest, prompting for name and address.
2025-07-03 23:12:19,526 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348092166618","wa_id":"2348092166618"}],"messages":[{"id":"wamid.HBgNMjM0ODA5MjE2NjYxOBUCABEYEjBCRjZDQzYwQTQ4NDVCMjkwMwA="}]}
2025-07-03 23:12:19,527 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348092166618', 'wa_id': '2348092166618'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA5MjE2NjYxOBUCABEYEjBCRjZDQzYwQTQ4NDVCMjkwMwA='}]}
2025-07-03 23:12:19,528 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:12:19] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:12:21,708 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:12:21] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:12:42,599 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:12:42] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:17:18,404 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:17:18] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:18:07,006 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-07-03 23:18:07,008 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-07-03 23:18:11,665 - handlers.base_handler - INFO - Session 2348055614455 identified as guest, prompting for name and address.
2025-07-03 23:18:13,278 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkNBNDE0Njk1QTQxQjBDODUwQgA="}]}
2025-07-03 23:18:13,279 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkNBNDE0Njk1QTQxQjBDODUwQgA='}]}
2025-07-03 23:18:13,280 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:18:13] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:18:14,313 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:18:14] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:18:14,514 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:18:14] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:20:33,809 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:20:33] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:22:16,959 - __main__ - INFO - Starting WhatsApp bot server...
2025-07-03 23:22:18,430 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-07-03 23:22:20,896 - utils.data_manager - INFO - Successfully loaded 4 user details from database
2025-07-03 23:22:21,098 - services.payment_service - INFO - PaymentService initialized
2025-07-03 23:22:23,096 - handlers.product_sync_handler - INFO - Successfully synced 17 products to data\products.json
2025-07-03 23:22:23,290 - app - INFO - Initial product sync successful on startup
2025-07-03 23:22:23,290 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-07-03 23:22:25,063 - utils.data_manager - INFO - Successfully loaded 4 user details from database
2025-07-03 23:22:25,277 - services.payment_service - INFO - PaymentService initialized
2025-07-03 23:22:25,277 - services.lead_tracker - INFO - LeadTracker initialized
2025-07-03 23:22:25,277 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-07-03 23:22:25,280 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-07-03 23:22:25,281 - handlers.order_handler - INFO - OrderHandler initialized.
2025-07-03 23:22:25,281 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-07-03 23:22:25,282 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-07-03 23:22:25,719 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-07-03 23:22:25,719 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-07-03 23:22:25,719 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-07-03 23:22:25,720 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-07-03 23:22:25,753 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-07-03 23:22:25,753 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-07-03 23:22:32,953 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hell'}
2025-07-03 23:22:32,953 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-07-03 23:22:34,977 - handlers.base_handler - INFO - Session 2348055614455 identified as new or incomplete, prompting for name and address.
2025-07-03 23:22:35,740 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkNDMDgxMDREQTQ4NkZDMzc0NAA="}]}
2025-07-03 23:22:35,740 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkNDMDgxMDREQTQ4NkZDMzc0NAA='}]}
2025-07-03 23:22:35,741 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:22:35] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:22:36,670 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:22:36] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:22:36,881 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:22:36] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:22:36,987 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:22:36] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:22:39,940 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:22:39] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:23:39,473 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Victor Makinde,Lekki, Lagos'}
2025-07-03 23:23:39,477 - handlers.message_processor - WARNING - No specific handler or state match for handler 'greeting_handler', state 'guest_info_prompt', message 'victor makinde,lekki, lagos' for session 2348055614455. Resetting to greeting.
2025-07-03 23:23:39,478 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "I'm sorry, I didn't quite understand that. Let's get back to the main menu."}}
2025-07-03 23:23:40,375 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkFCMEQ0MUVGNDJEQ0ZDQTM4QgA="}]}
2025-07-03 23:23:41,073 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjIwMTYzRUNCOTg5QjUyRTk1RAA="}]}
2025-07-03 23:23:41,074 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjIwMTYzRUNCOTg5QjUyRTk1RAA='}]}
2025-07-03 23:23:41,075 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:23:41] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:23:41,452 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:23:41] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:23:41,462 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:23:41] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:23:41,601 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:23:41] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:23:41,920 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:23:41] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:23:41,953 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:23:41] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:23:42,002 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:23:42] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:23:59,049 - handlers.webhook_handler - INFO - Processing message from 2348033804161 (User: Boye Oloyede): {'type': 'text', 'text': "Blessed evening, I have RSVP my wife's attendance as I won't be around."}
2025-07-03 23:23:59,052 - utils.session_manager - INFO - New session 2348033804161 initialized.
2025-07-03 23:23:59,058 - services.lead_tracker - INFO - New lead tracked: 2348033804161 (Boye Oloyede)
2025-07-03 23:24:05,815 - handlers.base_handler - INFO - Session 2348033804161 identified as new or incomplete, prompting for name and address.
2025-07-03 23:24:06,771 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348033804161","wa_id":"2348033804161"}],"messages":[{"id":"wamid.HBgNMjM0ODAzMzgwNDE2MRUCABEYEjcwRUY0MUJEMUVCRTRFMUFDNwA="}]}
2025-07-03 23:24:06,772 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348033804161', 'wa_id': '2348033804161'}], 'messages': [{'id': 'wamid.HBgNMjM0ODAzMzgwNDE2MRUCABEYEjcwRUY0MUJEMUVCRTRFMUFDNwA='}]}
2025-07-03 23:24:06,772 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:24:06] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:24:09,633 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:24:09] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:24:10,705 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:24:10] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:24:33,663 - handlers.webhook_handler - WARNING - No valid message data extracted for 2348033804161. Message type: unsupported
2025-07-03 23:24:33,664 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:24:33] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:24:39,234 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:24:39] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:25:15,121 - __main__ - INFO - Starting WhatsApp bot server...
2025-07-03 23:25:16,478 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-07-03 23:25:18,912 - utils.data_manager - INFO - Successfully loaded 4 user details from database
2025-07-03 23:25:19,125 - services.payment_service - INFO - PaymentService initialized
2025-07-03 23:25:21,074 - handlers.product_sync_handler - INFO - Successfully synced 17 products to data\products.json
2025-07-03 23:25:21,281 - app - INFO - Initial product sync successful on startup
2025-07-03 23:25:21,281 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-07-03 23:25:24,300 - utils.data_manager - INFO - Successfully loaded 4 user details from database
2025-07-03 23:25:24,505 - services.payment_service - INFO - PaymentService initialized
2025-07-03 23:25:24,506 - services.lead_tracker - INFO - LeadTracker initialized
2025-07-03 23:25:24,506 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-07-03 23:25:24,507 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-07-03 23:25:24,507 - handlers.order_handler - INFO - OrderHandler initialized.
2025-07-03 23:25:24,508 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-07-03 23:25:24,508 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-07-03 23:25:24,922 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-07-03 23:25:24,922 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-07-03 23:25:24,922 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-07-03 23:25:24,923 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-07-03 23:25:24,950 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-07-03 23:25:24,951 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-07-03 23:25:30,370 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-07-03 23:25:30,371 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-07-03 23:25:32,341 - handlers.base_handler - INFO - Session 2348055614455 greeted user 'Victor'.
2025-07-03 23:25:33,171 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjJERUY0NUQ0Mzg1NkJFRjM3RAA="}]}
2025-07-03 23:25:33,172 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjJERUY0NUQ0Mzg1NkJFRjM3RAA='}]}
2025-07-03 23:25:33,173 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:25:33] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:25:34,098 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:25:34] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:25:34,496 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:25:34] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:25:34,678 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:25:34] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:25:35,802 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-07-03 23:25:35,808 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-07-03 23:25:35,808 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-07-03 23:25:35,809 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-07-03 23:25:35,809 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-07-03 23:25:35,810 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'image', 'image': {'link': 'https://test.mackennytutors.com/wp-content/uploads/2025/06/ganador.jpg', 'caption': 'Our Delicious Menu!'}}
2025-07-03 23:25:37,052 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjI2NUZCQkQ3MURCNEI5RDJBQwA="}]}
2025-07-03 23:25:37,053 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Hi, I'm Lola from Ganador \n\nTake a look at the menu and type in your order\n\n"}}
2025-07-03 23:25:38,085 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjAzQjFBMUE0NDAyRUEzRTI5RgA="}]}
2025-07-03 23:25:38,086 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjAzQjFBMUE0NDAyRUEzRTI5RgA='}]}
2025-07-03 23:25:38,087 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:25:38] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:25:38,633 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:25:38] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:25:39,112 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:25:39] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:25:39,116 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:25:39] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:25:39,142 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:25:39] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:25:39,281 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:25:39] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:25:39,286 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:25:39] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:25:44,108 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:25:44] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:25:50,824 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Jellof rice'}
2025-07-03 23:25:50,828 - handlers.base_handler - INFO - AIHandler: Handling message 'jellof rice' in AI bulk order state for session 2348055614455. Original: 'Jellof rice'
2025-07-03 23:25:53,372 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-07-03 23:25:54,187 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjIzODJGQkREQjBGN0YwQTQyMwA="}]}
2025-07-03 23:25:54,187 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjIzODJGQkREQjBGN0YwQTQyMwA='}]}
2025-07-03 23:25:54,188 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:25:54] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:25:55,002 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:25:55] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:25:55,147 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:25:55] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:25:55,393 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:25:55] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:25:57,136 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-07-03 23:25:57,139 - handlers.base_handler - INFO - AI order confirmed. Cart: {'Jollof Rice': {'item_id': 1, 'quantity': 1, 'price': 2500.0, 'total_price': 2500.0, 'variations': {}}}. Redirecting to order handler.
2025-07-03 23:25:57,140 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'order_handler' with message 'process_final_order'.
2025-07-03 23:25:57,140 - handlers.order_handler - INFO - AI initiated order processing for session 2348055614455.
2025-07-03 23:25:57,140 - handlers.order_handler - INFO - Address set, proceeding to confirm order for AI-initiated session 2348055614455.
2025-07-03 23:25:58,016 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkUwMjY2NDMyQjU5OEE0RDMwMwA="}]}
2025-07-03 23:25:58,046 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkUwMjY2NDMyQjU5OEE0RDMwMwA='}]}
2025-07-03 23:25:58,047 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:25:58] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:25:59,118 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:25:59] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:25:59,121 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:25:59] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:25:59,124 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:25:59] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:26:00,990 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'final_confirm'}
2025-07-03 23:26:00,993 - handlers.message_processor - ERROR - Error in message routing for handler 'order_handler', state 'confirm_order' for session 2348055614455: 'Config' object has no attribute 'MERCHANT_ID'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\app\handlers\message_processor.py", line 236, in _route_to_handler
    response = self.order_handler.handle_confirm_order_state(state, message, session_id)
  File "C:\Users\zigam\Documents\Lola\app\handlers\order_handler.py", line 438, in handle_confirm_order_state
    "merchant_id": self.config.MERCHANT_ID or "default_merchant",
                   ^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'Config' object has no attribute 'MERCHANT_ID'
2025-07-03 23:26:02,012 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjg4NDdDNTNFRjA0N0U3RjNBMwA="}]}
2025-07-03 23:26:02,025 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjg4NDdDNTNFRjA0N0U3RjNBMwA='}]}
2025-07-03 23:26:02,025 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:26:02] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:26:02,742 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:26:02] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:26:02,902 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:26:02] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:26:03,075 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:26:03] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:27:33,329 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:27:33] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:31:55,844 - __main__ - INFO - Starting WhatsApp bot server...
2025-07-03 23:31:57,384 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-07-03 23:31:59,061 - utils.data_manager - INFO - Successfully loaded 4 user details from database
2025-07-03 23:31:59,256 - services.payment_service - INFO - PaymentService initialized
2025-07-03 23:32:00,963 - handlers.product_sync_handler - INFO - Successfully synced 17 products to data\products.json
2025-07-03 23:32:01,244 - app - INFO - Initial product sync successful on startup
2025-07-03 23:32:01,245 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-07-03 23:32:03,223 - utils.data_manager - INFO - Successfully loaded 4 user details from database
2025-07-03 23:32:03,423 - services.payment_service - INFO - PaymentService initialized
2025-07-03 23:32:03,424 - services.lead_tracker - INFO - LeadTracker initialized
2025-07-03 23:32:03,424 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-07-03 23:32:03,426 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-07-03 23:32:03,427 - handlers.order_handler - INFO - OrderHandler initialized.
2025-07-03 23:32:03,427 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-07-03 23:32:03,427 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-07-03 23:32:04,079 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-07-03 23:32:04,079 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-07-03 23:32:04,080 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-07-03 23:32:04,080 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-07-03 23:32:04,099 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-07-03 23:32:04,099 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-07-03 23:32:11,346 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-07-03 23:32:11,347 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-07-03 23:32:14,634 - handlers.base_handler - INFO - Session 2348055614455 greeted user 'Victor'.
2025-07-03 23:32:15,699 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjYyNTFGQjlFNTc4RkU2NEUzQwA="}]}
2025-07-03 23:32:15,699 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjYyNTFGQjlFNTc4RkU2NEUzQwA='}]}
2025-07-03 23:32:15,700 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:32:15] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:32:16,404 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:32:16] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:32:16,519 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:32:16] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:32:16,654 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:32:16] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:32:18,541 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-07-03 23:32:18,545 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-07-03 23:32:18,545 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-07-03 23:32:18,545 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-07-03 23:32:18,546 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-07-03 23:32:18,546 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'image', 'image': {'link': 'https://test.mackennytutors.com/wp-content/uploads/2025/06/ganador.jpg', 'caption': 'Our Delicious Menu!'}}
2025-07-03 23:32:20,535 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQ1Rjg3NDcwQ0IwNDlFQjBBOAA="}]}
2025-07-03 23:32:20,536 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Hi, I'm Lola from Ganador \n\nTake a look at the menu and type in your order\n\n"}}
2025-07-03 23:32:21,654 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjJCQTlEQzE0M0UzRjdBNTJFOQA="}]}
2025-07-03 23:32:21,655 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjJCQTlEQzE0M0UzRjdBNTJFOQA='}]}
2025-07-03 23:32:21,655 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:32:21] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:32:21,702 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:32:21] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:32:21,858 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:32:21] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:32:21,864 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:32:21] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:32:22,630 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:32:22] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:32:22,888 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:32:22] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:32:22,935 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:32:22] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:32:25,869 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Jellof rice'}
2025-07-03 23:32:25,873 - handlers.base_handler - INFO - AIHandler: Handling message 'jellof rice' in AI bulk order state for session 2348055614455. Original: 'Jellof rice'
2025-07-03 23:32:29,314 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-07-03 23:32:30,466 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkExMjM3Rjg2RURBNTdFNTBEQQA="}]}
2025-07-03 23:32:30,468 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkExMjM3Rjg2RURBNTdFNTBEQQA='}]}
2025-07-03 23:32:30,468 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:32:30] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:32:31,206 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:32:31] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:32:31,241 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:32:31] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:32:31,472 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:32:31] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:32:32,490 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-07-03 23:32:32,493 - handlers.base_handler - INFO - AI order confirmed. Cart: {'Jollof Rice': {'item_id': '1', 'quantity': 1, 'price': 2500.0, 'total_price': 2500.0, 'variations': {}}}. Redirecting to order handler.
2025-07-03 23:32:32,493 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'order_handler' with message 'process_final_order'.
2025-07-03 23:32:32,494 - handlers.order_handler - INFO - AI initiated order processing for session 2348055614455.
2025-07-03 23:32:32,494 - handlers.order_handler - INFO - Address set, proceeding to confirm order for AI-initiated session 2348055614455.
2025-07-03 23:32:33,676 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjdDNzNEQ0Y4NjE4ODE0NTM0RQA="}]}
2025-07-03 23:32:33,694 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjdDNzNEQ0Y4NjE4ODE0NTM0RQA='}]}
2025-07-03 23:32:33,694 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:32:33] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:32:34,446 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:32:34] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:32:34,520 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:32:34] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:32:34,694 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:32:34] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:32:36,347 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'final_confirm'}
2025-07-03 23:32:37,595 - utils.data_manager - ERROR - Unexpected error while saving order ORDER_20250703_233236_78821979: 'Config' object has no attribute 'MERCHANT_ID'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\app\utils\data_manager.py", line 174, in save_user_order
    self.config.MERCHANT_ID or "default_merchant",
    ^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'Config' object has no attribute 'MERCHANT_ID'
2025-07-03 23:32:37,616 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'payment_handler' with message 'initiate_payment'.
2025-07-03 23:32:37,616 - handlers.base_handler - INFO - Handling payment processing for session 2348055614455, message: initiate_payment
2025-07-03 23:32:37,616 - handlers.base_handler - INFO - Creating payment link for session 2348055614455
2025-07-03 23:32:38,836 - utils.data_manager - ERROR - Unexpected error while saving order ORDER-20250703233237-3936: 'Config' object has no attribute 'MERCHANT_ID'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\app\utils\data_manager.py", line 174, in save_user_order
    self.config.MERCHANT_ID or "default_merchant",
    ^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'Config' object has no attribute 'MERCHANT_ID'
2025-07-03 23:32:38,838 - services.payment_service - INFO - Attempting to create payment link for reference: PAY-ORDER-20250703233237-3936 with amount: 250000.0, email: victor4455@foodorder.com
2025-07-03 23:32:39,711 - services.payment_service - INFO - Payment link created for Victor Victor (2348055614455), URL: https://checkout.paystack.com/hoa7ht43oa9cmnc
2025-07-03 23:32:39,712 - handlers.base_handler - INFO - Starting payment monitoring for order ORDER-20250703233237-3936, reference PAY-ORDER-20250703233237-3936
2025-07-03 23:32:39,713 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-ORDER-20250703233237-3936
2025-07-03 23:32:40,334 - services.payment_service - WARNING - Payment not successful for reference PAY-ORDER-20250703233237-3936. Paystack status: abandoned. Response: {'status': True, 'message': 'Verification successful', 'data': {'id': 5114518331, 'domain': 'test', 'status': 'abandoned', 'reference': 'PAY-ORDER-20250703233237-3936', 'receipt_number': None, 'amount': 250000, 'message': None, 'gateway_response': 'The transaction was not completed', 'paid_at': None, 'created_at': '2025-07-03T22:32:40.000Z', 'channel': 'card', 'currency': 'NGN', 'ip_address': '102.89.69.193, 172.71.178.103, 172.31.63.81', 'metadata': {'customer_name': 'Victor', 'customer_phone': '2348055614455', 'first_name': 'Victor', 'last_name': 'Victor', 'order_id': 'ORDER-20250703233237-3936', 'delivery_address': 'Howson Wright'}, 'log': None, 'fees': None, 'fees_split': None, 'authorization': {}, 'customer': {'id': 289584095, 'first_name': None, 'last_name': None, 'email': 'victor4455@foodorder.com', 'customer_code': 'CUS_zv03jf9h0rpamu3', 'phone': None, 'metadata': None, 'risk_action': 'default', 'international_format_phone': None}, 'plan': None, 'split': {}, 'order_id': None, 'paidAt': None, 'createdAt': '2025-07-03T22:32:40.000Z', 'requested_amount': 250000, 'pos_transaction_data': None, 'source': None, 'fees_breakdown': None, 'connect': None, 'transaction_date': '2025-07-03T22:32:40.000Z', 'plan_object': {}, 'subaccount': {}}}
2025-07-03 23:32:40,338 - handlers.base_handler - INFO - Payment not yet verified for order ORDER-20250703233237-3936, attempt 1/15
2025-07-03 23:32:40,338 - handlers.base_handler - INFO - Payment link created successfully for order ORDER-20250703233237-3936
2025-07-03 23:32:41,228 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkEwNkM5MkI4NThEODYwQzg2MwA="}]}
2025-07-03 23:32:41,243 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkEwNkM5MkI4NThEODYwQzg2MwA='}]}
2025-07-03 23:32:41,245 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:32:41] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:32:42,152 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:32:42] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:32:42,480 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:32:42] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:32:42,490 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:32:42] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:33:29,728 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Paid'}
2025-07-03 23:33:29,732 - handlers.base_handler - INFO - Received 'paid' command for session 2348055614455, attempting manual verification for ref: PAY-ORDER-20250703233237-3936
2025-07-03 23:33:29,733 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-ORDER-20250703233237-3936
2025-07-03 23:33:30,348 - services.payment_service - INFO - Payment verified successfully for reference PAY-ORDER-20250703233237-3936. Status: success
2025-07-03 23:33:32,337 - handlers.base_handler - ERROR - Order not found for payment reference PAY-ORDER-20250703233237-3936 during manual verification.
2025-07-03 23:33:33,182 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjYxRTdENTZFNEE2MDY1RjVBMgA="}]}
2025-07-03 23:33:33,197 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjYxRTdENTZFNEE2MDY1RjVBMgA='}]}
2025-07-03 23:33:33,197 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:33:33] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:33:34,141 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:33:34] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:33:34,167 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:33:34] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:33:34,490 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:33:34] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:33:40,347 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-ORDER-20250703233237-3936
2025-07-03 23:33:41,185 - services.payment_service - INFO - Payment verified successfully for reference PAY-ORDER-20250703233237-3936. Status: success
2025-07-03 23:33:41,186 - handlers.base_handler - INFO - Payment verified for order ORDER-20250703233237-3936 on attempt 2
2025-07-03 23:33:41,187 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-ORDER-20250703233237-3936
2025-07-03 23:33:41,775 - services.payment_service - INFO - Payment verified successfully for reference PAY-ORDER-20250703233237-3936. Status: success
2025-07-03 23:33:44,028 - handlers.base_handler - ERROR - Order data not found for payment reference PAY-ORDER-20250703233237-3936 during auto-payment handling.
2025-07-03 23:39:02,334 - __main__ - INFO - Starting WhatsApp bot server...
2025-07-03 23:39:03,683 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-07-03 23:39:08,724 - utils.data_manager - INFO - Successfully loaded 4 user details from database
2025-07-03 23:39:09,021 - services.payment_service - INFO - PaymentService initialized
2025-07-03 23:39:10,722 - handlers.product_sync_handler - INFO - Successfully synced 17 products to data\products.json
2025-07-03 23:39:10,922 - app - INFO - Initial product sync successful on startup
2025-07-03 23:39:10,923 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-07-03 23:39:13,697 - utils.data_manager - INFO - Successfully loaded 4 user details from database
2025-07-03 23:39:13,929 - services.payment_service - INFO - PaymentService initialized
2025-07-03 23:39:13,929 - services.lead_tracker - INFO - LeadTracker initialized
2025-07-03 23:39:13,929 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-07-03 23:39:13,930 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-07-03 23:39:13,930 - handlers.order_handler - INFO - OrderHandler initialized.
2025-07-03 23:39:13,931 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-07-03 23:39:13,931 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-07-03 23:39:14,322 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-07-03 23:39:14,322 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-07-03 23:39:14,322 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-07-03 23:39:14,323 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-07-03 23:39:14,334 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-07-03 23:39:14,334 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-07-03 23:39:17,542 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-07-03 23:39:17,542 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-07-03 23:39:19,981 - handlers.base_handler - INFO - Session 2348055614455: New user or missing details. Initiating onboarding.
2025-07-03 23:39:19,982 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': 'Hello victor, welcome to Lola!\nPlease enter your preferred name.'}}
2025-07-03 23:39:21,370 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjE3NzJEQTM1NEEyNzkzMjUzNQA="}]}
2025-07-03 23:39:21,370 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjE3NzJEQTM1NEEyNzkzMjUzNQA='}]}
2025-07-03 23:39:21,371 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:39:21] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:39:22,136 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:39:22] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:39:22,588 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:39:22] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:39:22,720 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:39:22] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:39:31,717 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Victor Makinde'}
2025-07-03 23:39:31,721 - handlers.message_processor - WARNING - No specific handler or state match for handler 'greeting_handler', state 'collect_preferred_name', message 'victor makinde' for session 2348055614455. Resetting to greeting.
2025-07-03 23:39:31,721 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "I'm sorry, I didn't quite understand that. Let's get back to the main menu."}}
2025-07-03 23:39:32,483 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkQ1MzU5RUEzOTExRjIyN0RDNAA="}]}
2025-07-03 23:39:33,364 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkEzQzFGNUFEM0JCNkRGMDJEMwA="}]}
2025-07-03 23:39:33,365 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkEzQzFGNUFEM0JCNkRGMDJEMwA='}]}
2025-07-03 23:39:33,365 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:39:33] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:39:33,407 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:39:33] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:39:33,556 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:39:33] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:39:33,789 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:39:33] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:39:34,273 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:39:34] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:39:34,383 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:39:34] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:39:34,647 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:39:34] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:43:53,807 - __main__ - INFO - Starting WhatsApp bot server...
2025-07-03 23:43:55,070 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-07-03 23:43:56,774 - utils.data_manager - INFO - Successfully loaded 4 user details from database
2025-07-03 23:43:57,156 - services.payment_service - INFO - PaymentService initialized
2025-07-03 23:43:58,901 - handlers.product_sync_handler - INFO - Successfully synced 17 products to data\products.json
2025-07-03 23:43:59,101 - app - INFO - Initial product sync successful on startup
2025-07-03 23:43:59,101 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-07-03 23:44:00,835 - utils.data_manager - INFO - Successfully loaded 4 user details from database
2025-07-03 23:44:01,047 - services.payment_service - INFO - PaymentService initialized
2025-07-03 23:44:01,048 - services.lead_tracker - INFO - LeadTracker initialized
2025-07-03 23:44:01,048 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-07-03 23:44:01,049 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-07-03 23:44:01,049 - handlers.order_handler - INFO - OrderHandler initialized.
2025-07-03 23:44:01,049 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-07-03 23:44:01,050 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-07-03 23:44:01,436 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-07-03 23:44:01,436 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-07-03 23:44:01,437 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-07-03 23:44:01,437 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-07-03 23:44:01,449 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-07-03 23:44:01,449 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-07-03 23:44:04,412 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-07-03 23:44:04,412 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-07-03 23:44:06,367 - handlers.base_handler - INFO - Session 2348055614455: New user or missing details. Initiating onboarding.
2025-07-03 23:44:06,367 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': 'Hello victor, welcome to Lola!\nPlease enter your preferred name.'}}
2025-07-03 23:44:07,452 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQyQjBFMEVBRjBDMDREQTQyRQA="}]}
2025-07-03 23:44:07,453 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQyQjBFMEVBRjBDMDREQTQyRQA='}]}
2025-07-03 23:44:07,454 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:44:07] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:44:08,266 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:44:08] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:44:08,625 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:44:08] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:44:08,694 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:44:08] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:44:17,083 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Victor Makinde'}
2025-07-03 23:44:17,086 - handlers.base_handler - INFO - Session 2348055614455: Preferred name received: 'victor makinde'.
2025-07-03 23:44:20,926 - utils.data_manager - INFO - User details for 2348055614455 saved to database
2025-07-03 23:44:20,927 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': 'Thanks, victor makinde! Now, please enter your delivery address.'}}
2025-07-03 23:44:22,197 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQ2QUZCODEwQTIxRTA3NUM4NwA="}]}
2025-07-03 23:44:22,197 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQ2QUZCODEwQTIxRTA3NUM4NwA='}]}
2025-07-03 23:44:22,198 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:44:22] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:44:23,091 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:44:23] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:44:23,481 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:44:23] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:44:23,618 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:44:23] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:44:31,329 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Howson Wright'}
2025-07-03 23:44:31,334 - handlers.base_handler - INFO - Session 2348055614455: Delivery address received: 'howson wright'.
2025-07-03 23:44:33,430 - utils.data_manager - INFO - User details for 2348055614455 saved to database
2025-07-03 23:44:33,431 - handlers.base_handler - INFO - Session 2348055614455 onboarding complete. Greeting victor makinde.
2025-07-03 23:44:34,207 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjRGNTNDNTU3OThFMzYxN0ZDOAA="}]}
2025-07-03 23:44:34,207 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjRGNTNDNTU3OThFMzYxN0ZDOAA='}]}
2025-07-03 23:44:34,208 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:44:34] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:44:35,291 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:44:35] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:44:35,293 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:44:35] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:44:35,295 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:44:35] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:44:38,196 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-07-03 23:44:38,199 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-07-03 23:44:38,200 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-07-03 23:44:38,200 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-07-03 23:44:38,200 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-07-03 23:44:38,201 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'image', 'image': {'link': 'https://test.mackennytutors.com/wp-content/uploads/2025/06/ganador.jpg', 'caption': 'Our Delicious Menu!'}}
2025-07-03 23:44:39,343 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkNCQ0RFMzRGNUI0RjYxNzlCQwA="}]}
2025-07-03 23:44:39,343 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Hi, I'm Lola from Ganador \n\nTake a look at the menu and type in your order\n\n"}}
2025-07-03 23:44:40,081 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjA0NzQ2NzBFMzFENjJFRUZGQQA="}]}
2025-07-03 23:44:40,082 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjA0NzQ2NzBFMzFENjJFRUZGQQA='}]}
2025-07-03 23:44:40,083 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:44:40] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:44:40,797 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:44:40] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:44:41,070 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:44:41] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:44:41,146 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:44:41] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:44:41,340 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:44:41] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:44:41,408 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:44:41] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:44:41,817 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:44:41] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:44:45,239 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Jellof rice'}
2025-07-03 23:44:45,243 - handlers.base_handler - INFO - AIHandler: Handling message 'jellof rice' in AI bulk order state for session 2348055614455. Original: 'Jellof rice'
2025-07-03 23:44:47,725 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-07-03 23:44:48,456 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjJDRDk1NTZFQTY5NEYwMkNDQQA="}]}
2025-07-03 23:44:48,457 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjJDRDk1NTZFQTY5NEYwMkNDQQA='}]}
2025-07-03 23:44:48,457 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:44:48] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:44:49,369 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:44:49] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:44:49,559 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:44:49] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:44:49,681 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:44:49] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:44:50,618 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-07-03 23:44:50,621 - handlers.base_handler - INFO - AI order confirmed. Cart: {'Jollof Rice': {'item_id': '1', 'quantity': 1, 'price': 2500.0, 'total_price': 2500.0, 'variations': {}}}. Redirecting to order handler.
2025-07-03 23:44:50,622 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'order_handler' with message 'process_final_order'.
2025-07-03 23:44:50,622 - handlers.order_handler - INFO - AI initiated order processing for session 2348055614455.
2025-07-03 23:44:50,623 - handlers.order_handler - INFO - Address set, proceeding to confirm order for AI-initiated session 2348055614455.
2025-07-03 23:44:51,519 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjE1QUQ4NjFDREQ1QjJDMEQ0MwA="}]}
2025-07-03 23:44:51,544 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjE1QUQ4NjFDREQ1QjJDMEQ0MwA='}]}
2025-07-03 23:44:51,545 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:44:51] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:44:52,339 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:44:52] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:44:52,509 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:44:52] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:44:53,883 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'final_confirm'}
2025-07-03 23:44:55,334 - utils.data_manager - ERROR - Unexpected error while saving order ORDER_20250703_234453_03205056: 'Config' object has no attribute 'MERCHANT_ID'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\app\utils\data_manager.py", line 174, in save_user_order
    self.config.MERCHANT_ID or "default_merchant",
    ^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'Config' object has no attribute 'MERCHANT_ID'
2025-07-03 23:44:55,370 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'payment_handler' with message 'initiate_payment'.
2025-07-03 23:44:55,370 - handlers.base_handler - INFO - Handling payment processing for session 2348055614455, message: initiate_payment
2025-07-03 23:44:55,370 - handlers.base_handler - INFO - Creating payment link for session 2348055614455
2025-07-03 23:44:56,592 - utils.data_manager - ERROR - Unexpected error while saving order ORDER-20250703234455-1544: 'Config' object has no attribute 'MERCHANT_ID'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\app\utils\data_manager.py", line 174, in save_user_order
    self.config.MERCHANT_ID or "default_merchant",
    ^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'Config' object has no attribute 'MERCHANT_ID'
2025-07-03 23:44:56,594 - services.payment_service - INFO - Attempting to create payment link for reference: PAY-ORDER-20250703234455-1544 with amount: 250000.0, email: victor4455@foodorder.com
2025-07-03 23:44:57,724 - services.payment_service - INFO - Payment link created for victor makinde (2348055614455), URL: https://checkout.paystack.com/9wsnkv2ly60dgv1
2025-07-03 23:44:57,731 - handlers.base_handler - INFO - Starting payment monitoring for order ORDER-20250703234455-1544, reference PAY-ORDER-20250703234455-1544
2025-07-03 23:44:57,731 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-ORDER-20250703234455-1544
2025-07-03 23:44:58,529 - services.payment_service - WARNING - Payment not successful for reference PAY-ORDER-20250703234455-1544. Paystack status: abandoned. Response: {'status': True, 'message': 'Verification successful', 'data': {'id': 5114529534, 'domain': 'test', 'status': 'abandoned', 'reference': 'PAY-ORDER-20250703234455-1544', 'receipt_number': None, 'amount': 250000, 'message': None, 'gateway_response': 'The transaction was not completed', 'paid_at': None, 'created_at': '2025-07-03T22:44:58.000Z', 'channel': 'card', 'currency': 'NGN', 'ip_address': '102.89.69.193, 172.69.195.27, 172.31.68.120', 'metadata': {'customer_name': 'victor makinde', 'customer_phone': '2348055614455', 'first_name': 'victor', 'last_name': 'makinde', 'order_id': 'ORDER-20250703234455-1544', 'delivery_address': 'Howson Wright'}, 'log': None, 'fees': None, 'fees_split': None, 'authorization': {}, 'customer': {'id': 289584095, 'first_name': None, 'last_name': None, 'email': 'victor4455@foodorder.com', 'customer_code': 'CUS_zv03jf9h0rpamu3', 'phone': None, 'metadata': None, 'risk_action': 'default', 'international_format_phone': None}, 'plan': None, 'split': {}, 'order_id': None, 'paidAt': None, 'createdAt': '2025-07-03T22:44:58.000Z', 'requested_amount': 250000, 'pos_transaction_data': None, 'source': None, 'fees_breakdown': None, 'connect': None, 'transaction_date': '2025-07-03T22:44:58.000Z', 'plan_object': {}, 'subaccount': {}}}
2025-07-03 23:44:58,530 - handlers.base_handler - INFO - Payment not yet verified for order ORDER-20250703234455-1544, attempt 1/15
2025-07-03 23:44:58,531 - handlers.base_handler - INFO - Payment link created successfully for order ORDER-20250703234455-1544
2025-07-03 23:44:59,321 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjNBODg5NUExREEwREZFMTA5MgA="}]}
2025-07-03 23:44:59,337 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjNBODg5NUExREEwREZFMTA5MgA='}]}
2025-07-03 23:44:59,338 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:44:59] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:45:00,320 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:45:00] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:45:00,443 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:45:00] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:45:00,445 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:45:00] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:45:17,752 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:45:17] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:45:18,651 - handlers.webhook_handler - INFO - Processing message from 2348028373794 (User: toplargemakeover): {'type': 'text', 'text': 'Done'}
2025-07-03 23:45:18,651 - utils.session_manager - INFO - New session 2348028373794 initialized.
2025-07-03 23:45:20,498 - handlers.base_handler - INFO - Session 2348028373794: New user or missing details. Initiating onboarding.
2025-07-03 23:45:20,499 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348028373794', 'type': 'text', 'text': {'body': 'Hello Guest, welcome to Lola!\nPlease enter your preferred name.'}}
2025-07-03 23:45:21,367 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348028373794","wa_id":"2348028373794"}],"messages":[{"id":"wamid.HBgNMjM0ODAyODM3Mzc5NBUCABEYEkYyNDE4RUYwOUNDN0FCRUJFOAA="}]}
2025-07-03 23:45:21,368 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348028373794', 'wa_id': '2348028373794'}], 'messages': [{'id': 'wamid.HBgNMjM0ODAyODM3Mzc5NBUCABEYEkYyNDE4RUYwOUNDN0FCRUJFOAA='}]}
2025-07-03 23:45:21,368 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:45:21] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:45:22,143 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:45:22] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:45:58,535 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-ORDER-20250703234455-1544
2025-07-03 23:45:59,205 - services.payment_service - WARNING - Payment not successful for reference PAY-ORDER-20250703234455-1544. Paystack status: abandoned. Response: {'status': True, 'message': 'Verification successful', 'data': {'id': 5114529534, 'domain': 'test', 'status': 'abandoned', 'reference': 'PAY-ORDER-20250703234455-1544', 'receipt_number': None, 'amount': 250000, 'message': None, 'gateway_response': 'The transaction was not completed', 'paid_at': None, 'created_at': '2025-07-03T22:44:58.000Z', 'channel': 'card', 'currency': 'NGN', 'ip_address': '102.89.69.193, 172.69.195.27, 172.31.68.120', 'metadata': {'customer_name': 'victor makinde', 'customer_phone': '2348055614455', 'first_name': 'victor', 'last_name': 'makinde', 'order_id': 'ORDER-20250703234455-1544', 'delivery_address': 'Howson Wright'}, 'log': None, 'fees': None, 'fees_split': None, 'authorization': {}, 'customer': {'id': 289584095, 'first_name': None, 'last_name': None, 'email': 'victor4455@foodorder.com', 'customer_code': 'CUS_zv03jf9h0rpamu3', 'phone': None, 'metadata': None, 'risk_action': 'default', 'international_format_phone': None}, 'plan': None, 'split': {}, 'order_id': None, 'paidAt': None, 'createdAt': '2025-07-03T22:44:58.000Z', 'requested_amount': 250000, 'pos_transaction_data': None, 'source': None, 'fees_breakdown': None, 'connect': None, 'transaction_date': '2025-07-03T22:44:58.000Z', 'plan_object': {}, 'subaccount': {}}}
2025-07-03 23:45:59,206 - handlers.base_handler - INFO - Payment not yet verified for order ORDER-20250703234455-1544, attempt 2/15
2025-07-03 23:46:52,003 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:46:52] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:46:59,215 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-ORDER-20250703234455-1544
2025-07-03 23:46:59,870 - services.payment_service - WARNING - Payment not successful for reference PAY-ORDER-20250703234455-1544. Paystack status: abandoned. Response: {'status': True, 'message': 'Verification successful', 'data': {'id': 5114529534, 'domain': 'test', 'status': 'abandoned', 'reference': 'PAY-ORDER-20250703234455-1544', 'receipt_number': None, 'amount': 250000, 'message': None, 'gateway_response': 'The transaction was not completed', 'paid_at': None, 'created_at': '2025-07-03T22:44:58.000Z', 'channel': 'card', 'currency': 'NGN', 'ip_address': '102.89.69.193, 172.69.195.27, 172.31.68.120', 'metadata': {'customer_name': 'victor makinde', 'customer_phone': '2348055614455', 'first_name': 'victor', 'last_name': 'makinde', 'order_id': 'ORDER-20250703234455-1544', 'delivery_address': 'Howson Wright'}, 'log': None, 'fees': None, 'fees_split': None, 'authorization': {}, 'customer': {'id': 289584095, 'first_name': None, 'last_name': None, 'email': 'victor4455@foodorder.com', 'customer_code': 'CUS_zv03jf9h0rpamu3', 'phone': None, 'metadata': None, 'risk_action': 'default', 'international_format_phone': None}, 'plan': None, 'split': {}, 'order_id': None, 'paidAt': None, 'createdAt': '2025-07-03T22:44:58.000Z', 'requested_amount': 250000, 'pos_transaction_data': None, 'source': None, 'fees_breakdown': None, 'connect': None, 'transaction_date': '2025-07-03T22:44:58.000Z', 'plan_object': {}, 'subaccount': {}}}
2025-07-03 23:46:59,870 - handlers.base_handler - INFO - Payment not yet verified for order ORDER-20250703234455-1544, attempt 3/15
2025-07-03 23:47:00,244 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:47:00] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:47:04,584 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Paid'}
2025-07-03 23:47:04,587 - handlers.base_handler - INFO - Received 'paid' command for session 2348055614455, attempting manual verification for ref: PAY-ORDER-20250703234455-1544
2025-07-03 23:47:04,587 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-ORDER-20250703234455-1544
2025-07-03 23:47:05,208 - services.payment_service - WARNING - Payment not successful for reference PAY-ORDER-20250703234455-1544. Paystack status: abandoned. Response: {'status': True, 'message': 'Verification successful', 'data': {'id': 5114529534, 'domain': 'test', 'status': 'abandoned', 'reference': 'PAY-ORDER-20250703234455-1544', 'receipt_number': None, 'amount': 250000, 'message': None, 'gateway_response': 'The transaction was not completed', 'paid_at': None, 'created_at': '2025-07-03T22:44:58.000Z', 'channel': 'card', 'currency': 'NGN', 'ip_address': '102.89.69.193, 172.69.195.27, 172.31.68.120', 'metadata': {'customer_name': 'victor makinde', 'customer_phone': '2348055614455', 'first_name': 'victor', 'last_name': 'makinde', 'order_id': 'ORDER-20250703234455-1544', 'delivery_address': 'Howson Wright'}, 'log': None, 'fees': None, 'fees_split': None, 'authorization': {}, 'customer': {'id': 289584095, 'first_name': None, 'last_name': None, 'email': 'victor4455@foodorder.com', 'customer_code': 'CUS_zv03jf9h0rpamu3', 'phone': None, 'metadata': None, 'risk_action': 'default', 'international_format_phone': None}, 'plan': None, 'split': {}, 'order_id': None, 'paidAt': None, 'createdAt': '2025-07-03T22:44:58.000Z', 'requested_amount': 250000, 'pos_transaction_data': None, 'source': None, 'fees_breakdown': None, 'connect': None, 'transaction_date': '2025-07-03T22:44:58.000Z', 'plan_object': {}, 'subaccount': {}}}
2025-07-03 23:47:07,301 - handlers.base_handler - INFO - Manual payment verification failed for reference PAY-ORDER-20250703234455-1544. Paystack status: abandoned
2025-07-03 23:47:08,205 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkU2NDVBMjEwNTQyMzJEQURCQQA="}]}
2025-07-03 23:47:08,219 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkU2NDVBMjEwNTQyMzJEQURCQQA='}]}
2025-07-03 23:47:08,219 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:47:08] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:47:09,056 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:47:09] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:47:09,133 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:47:09] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:47:09,336 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:47:09] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:47:22,909 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Paid'}
2025-07-03 23:47:22,912 - handlers.base_handler - INFO - Received 'paid' command for session 2348055614455, attempting manual verification for ref: PAY-ORDER-20250703234455-1544
2025-07-03 23:47:22,913 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-ORDER-20250703234455-1544
2025-07-03 23:47:23,501 - services.payment_service - INFO - Payment verified successfully for reference PAY-ORDER-20250703234455-1544. Status: success
2025-07-03 23:47:25,466 - handlers.base_handler - ERROR - Order not found for payment reference PAY-ORDER-20250703234455-1544 during manual verification.
2025-07-03 23:47:26,406 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjlFNjlFNkM1MDg5NjlGM0Q3RAA="}]}
2025-07-03 23:47:26,421 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjlFNjlFNkM1MDg5NjlGM0Q3RAA='}]}
2025-07-03 23:47:26,421 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:47:26] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:47:27,558 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:47:27] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:47:27,898 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:47:27] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:47:27,899 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:47:27] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:47:59,879 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-ORDER-20250703234455-1544
2025-07-03 23:48:00,529 - services.payment_service - INFO - Payment verified successfully for reference PAY-ORDER-20250703234455-1544. Status: success
2025-07-03 23:48:00,530 - handlers.base_handler - INFO - Payment verified for order ORDER-20250703234455-1544 on attempt 4
2025-07-03 23:48:00,530 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-ORDER-20250703234455-1544
2025-07-03 23:48:01,190 - services.payment_service - INFO - Payment verified successfully for reference PAY-ORDER-20250703234455-1544. Status: success
2025-07-03 23:48:03,307 - handlers.base_handler - ERROR - Order data not found for payment reference PAY-ORDER-20250703234455-1544 during auto-payment handling.
2025-07-03 23:48:22,505 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:48:22] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:52:46,804 - __main__ - INFO - Starting WhatsApp bot server...
2025-07-03 23:52:48,009 - __main__ - ERROR - Unexpected error: invalid syntax (order_handler.py, line 236)
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\app\run.py", line 151, in main
    from app import app
  File "C:\Users\zigam\Documents\Lola\app\app.py", line 7, in <module>
    from handlers.webhook_handler import WebhookHandler
  File "C:\Users\zigam\Documents\Lola\app\handlers\webhook_handler.py", line 8, in <module>
    from handlers.message_processor import MessageProcessor
  File "C:\Users\zigam\Documents\Lola\app\handlers\message_processor.py", line 8, in <module>
    from handlers.order_handler import OrderHandler
  File "C:\Users\zigam\Documents\Lola\app\handlers\order_handler.py", line 236
    user_name|
              ^
SyntaxError: invalid syntax
2025-07-03 23:53:28,673 - __main__ - INFO - Starting WhatsApp bot server...
2025-07-03 23:53:30,121 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-07-03 23:53:34,914 - utils.data_manager - INFO - Successfully loaded 4 user details from database
2025-07-03 23:53:35,111 - services.payment_service - INFO - PaymentService initialized
2025-07-03 23:53:36,872 - handlers.product_sync_handler - INFO - Successfully synced 17 products to data\products.json
2025-07-03 23:53:37,263 - app - INFO - Initial product sync successful on startup
2025-07-03 23:53:37,263 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-07-03 23:53:39,504 - utils.data_manager - INFO - Successfully loaded 4 user details from database
2025-07-03 23:53:39,703 - services.payment_service - INFO - PaymentService initialized
2025-07-03 23:53:39,704 - services.lead_tracker - INFO - LeadTracker initialized
2025-07-03 23:53:39,704 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-07-03 23:53:39,717 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-07-03 23:53:39,717 - handlers.order_handler - INFO - OrderHandler initialized.
2025-07-03 23:53:39,718 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-07-03 23:53:39,718 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-07-03 23:53:40,178 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-07-03 23:53:40,178 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-07-03 23:53:40,179 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-07-03 23:53:40,179 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-07-03 23:53:40,208 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-07-03 23:53:40,208 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-07-03 23:53:46,248 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-07-03 23:53:46,248 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-07-03 23:53:48,314 - handlers.base_handler - INFO - Session 2348055614455 greeted returning user 'victor makinde'.
2025-07-03 23:53:49,164 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjZERkNGRDMzNEIxQjlFQzRFNQA="}]}
2025-07-03 23:53:49,175 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjZERkNGRDMzNEIxQjlFQzRFNQA='}]}
2025-07-03 23:53:49,176 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:53:49] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:53:50,053 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:53:50] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:53:50,350 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:53:50] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:53:50,472 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:53:50] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:53:54,307 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:53:54] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:53:54,599 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-07-03 23:53:54,602 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-07-03 23:53:54,603 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-07-03 23:53:54,603 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-07-03 23:53:54,603 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-07-03 23:53:54,604 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'image', 'image': {'link': 'https://test.mackennytutors.com/wp-content/uploads/2025/06/ganador.jpg', 'caption': 'Our Delicious Menu!'}}
2025-07-03 23:53:55,046 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:53:55] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:53:55,565 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkJFMjJBRTMwNTkxMkQ2NjEzOAA="}]}
2025-07-03 23:53:55,565 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Hi, I'm Lola from Ganador \n\nTake a look at the menu and type in your order\n\n"}}
2025-07-03 23:53:56,348 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjA4OEVFNzZFNjFCQUNBMTZBMwA="}]}
2025-07-03 23:53:56,348 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjA4OEVFNzZFNjFCQUNBMTZBMwA='}]}
2025-07-03 23:53:56,349 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:53:56] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:53:56,828 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:53:56] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:53:56,962 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:53:56] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:53:57,276 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:53:57] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:53:57,399 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:53:57] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:53:57,430 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:53:57] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:53:57,754 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:53:57] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:54:03,829 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Fried rice'}
2025-07-03 23:54:03,832 - handlers.base_handler - INFO - AIHandler: Handling message 'fried rice' in AI bulk order state for session 2348055614455. Original: 'Fried rice'
2025-07-03 23:54:06,585 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-07-03 23:54:07,319 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjREOThBN0JGODA3MkYxOEUxOAA="}]}
2025-07-03 23:54:07,320 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjREOThBN0JGODA3MkYxOEUxOAA='}]}
2025-07-03 23:54:07,321 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:54:07] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:54:08,146 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:54:08] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:54:08,294 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:54:08] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:54:08,516 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:54:08] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:54:10,076 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-07-03 23:54:10,081 - handlers.base_handler - INFO - AI order confirmed. Cart: {'Fried Rice': {'item_id': 2, 'quantity': 1, 'price': 2700.0, 'total_price': 2700.0, 'variations': {}}}. Redirecting to order handler.
2025-07-03 23:54:10,082 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'order_handler' with message 'process_final_order'.
2025-07-03 23:54:10,082 - handlers.order_handler - INFO - AI initiated order processing for session 2348055614455.
2025-07-03 23:54:10,082 - handlers.order_handler - INFO - Address set, proceeding to confirm order for AI-initiated session 2348055614455.
2025-07-03 23:54:10,974 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjA1RDAyQ0ZBQjRFQzdCQUYxNwA="}]}
2025-07-03 23:54:11,003 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjA1RDAyQ0ZBQjRFQzdCQUYxNwA='}]}
2025-07-03 23:54:11,004 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:54:11] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:54:11,871 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:54:11] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:54:12,067 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:54:12] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:54:12,083 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:54:12] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:54:13,496 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:54:13] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:54:13,760 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'final_confirm'}
2025-07-03 23:54:15,139 - utils.data_manager - ERROR - Unexpected error while saving order ORDER_20250703_235413_a150a1c4: 'Config' object has no attribute 'MERCHANT_ID'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\app\utils\data_manager.py", line 174, in save_user_order
    self.config.MERCHANT_ID or "default_merchant",
    ^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'Config' object has no attribute 'MERCHANT_ID'
2025-07-03 23:54:15,141 - handlers.order_handler - INFO - Order ORDER_20250703_235413_a150a1c4 saved to database for session 2348055614455
2025-07-03 23:54:15,162 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'payment_handler' with message 'initiate_payment'.
2025-07-03 23:54:15,162 - handlers.base_handler - INFO - Handling payment processing for session 2348055614455, message: initiate_payment
2025-07-03 23:54:15,162 - handlers.base_handler - INFO - Creating payment link for session 2348055614455
2025-07-03 23:54:16,453 - utils.data_manager - ERROR - Unexpected error while saving order ORDER-20250703235415-1690: 'Config' object has no attribute 'MERCHANT_ID'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\app\utils\data_manager.py", line 174, in save_user_order
    self.config.MERCHANT_ID or "default_merchant",
    ^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'Config' object has no attribute 'MERCHANT_ID'
2025-07-03 23:54:16,455 - services.payment_service - INFO - Attempting to create payment link for reference: PAY-ORDER-20250703235415-1690 with amount: 270000.0, email: victor4455@foodorder.com
2025-07-03 23:54:17,147 - services.payment_service - INFO - Payment link created for victor makinde (2348055614455), URL: https://checkout.paystack.com/scrz91dc3q5ppdt
2025-07-03 23:54:17,148 - handlers.base_handler - INFO - Starting payment monitoring for order ORDER-20250703235415-1690, reference PAY-ORDER-20250703235415-1690
2025-07-03 23:54:17,148 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-ORDER-20250703235415-1690
2025-07-03 23:54:17,728 - services.payment_service - WARNING - Payment not successful for reference PAY-ORDER-20250703235415-1690. Paystack status: abandoned. Response: {'status': True, 'message': 'Verification successful', 'data': {'id': 5114536986, 'domain': 'test', 'status': 'abandoned', 'reference': 'PAY-ORDER-20250703235415-1690', 'receipt_number': None, 'amount': 270000, 'message': None, 'gateway_response': 'The transaction was not completed', 'paid_at': None, 'created_at': '2025-07-03T22:54:17.000Z', 'channel': 'card', 'currency': 'NGN', 'ip_address': '102.89.69.193, 172.69.224.73, 172.31.68.120', 'metadata': {'customer_name': 'victor makinde', 'customer_phone': '2348055614455', 'first_name': 'victor', 'last_name': 'makinde', 'order_id': 'ORDER-20250703235415-1690', 'delivery_address': 'Howson Wright'}, 'log': None, 'fees': None, 'fees_split': None, 'authorization': {}, 'customer': {'id': 289584095, 'first_name': None, 'last_name': None, 'email': 'victor4455@foodorder.com', 'customer_code': 'CUS_zv03jf9h0rpamu3', 'phone': None, 'metadata': None, 'risk_action': 'default', 'international_format_phone': None}, 'plan': None, 'split': {}, 'order_id': None, 'paidAt': None, 'createdAt': '2025-07-03T22:54:17.000Z', 'requested_amount': 270000, 'pos_transaction_data': None, 'source': None, 'fees_breakdown': None, 'connect': None, 'transaction_date': '2025-07-03T22:54:17.000Z', 'plan_object': {}, 'subaccount': {}}}
2025-07-03 23:54:17,729 - handlers.base_handler - INFO - Payment not yet verified for order ORDER-20250703235415-1690, attempt 1/15
2025-07-03 23:54:17,729 - handlers.base_handler - INFO - Payment link created successfully for order ORDER-20250703235415-1690
2025-07-03 23:54:18,467 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkVBRkQxOEMxQzc1RjY0N0I4QwA="}]}
2025-07-03 23:54:18,482 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkVBRkQxOEMxQzc1RjY0N0I4QwA='}]}
2025-07-03 23:54:18,482 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:54:18] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:54:19,542 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:54:19] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:54:19,544 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:54:19] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:54:19,546 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:54:19] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:54:27,813 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:54:27] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:55:17,732 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-ORDER-20250703235415-1690
2025-07-03 23:55:18,345 - services.payment_service - WARNING - Payment not successful for reference PAY-ORDER-20250703235415-1690. Paystack status: abandoned. Response: {'status': True, 'message': 'Verification successful', 'data': {'id': 5114536986, 'domain': 'test', 'status': 'abandoned', 'reference': 'PAY-ORDER-20250703235415-1690', 'receipt_number': None, 'amount': 270000, 'message': None, 'gateway_response': 'The transaction was not completed', 'paid_at': None, 'created_at': '2025-07-03T22:54:17.000Z', 'channel': 'card', 'currency': 'NGN', 'ip_address': '102.89.69.193, 172.69.224.73, 172.31.68.120', 'metadata': {'customer_name': 'victor makinde', 'customer_phone': '2348055614455', 'first_name': 'victor', 'last_name': 'makinde', 'order_id': 'ORDER-20250703235415-1690', 'delivery_address': 'Howson Wright'}, 'log': None, 'fees': None, 'fees_split': None, 'authorization': {}, 'customer': {'id': 289584095, 'first_name': None, 'last_name': None, 'email': 'victor4455@foodorder.com', 'customer_code': 'CUS_zv03jf9h0rpamu3', 'phone': None, 'metadata': None, 'risk_action': 'default', 'international_format_phone': None}, 'plan': None, 'split': {}, 'order_id': None, 'paidAt': None, 'createdAt': '2025-07-03T22:54:17.000Z', 'requested_amount': 270000, 'pos_transaction_data': None, 'source': None, 'fees_breakdown': None, 'connect': None, 'transaction_date': '2025-07-03T22:54:17.000Z', 'plan_object': {}, 'subaccount': {}}}
2025-07-03 23:55:18,345 - handlers.base_handler - INFO - Payment not yet verified for order ORDER-20250703235415-1690, attempt 2/15
2025-07-03 23:56:18,353 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-ORDER-20250703235415-1690
2025-07-03 23:56:18,986 - services.payment_service - WARNING - Payment not successful for reference PAY-ORDER-20250703235415-1690. Paystack status: abandoned. Response: {'status': True, 'message': 'Verification successful', 'data': {'id': 5114536986, 'domain': 'test', 'status': 'abandoned', 'reference': 'PAY-ORDER-20250703235415-1690', 'receipt_number': None, 'amount': 270000, 'message': None, 'gateway_response': 'The transaction was not completed', 'paid_at': None, 'created_at': '2025-07-03T22:54:17.000Z', 'channel': 'card', 'currency': 'NGN', 'ip_address': '102.89.69.193, 172.69.224.73, 172.31.68.120', 'metadata': {'customer_name': 'victor makinde', 'customer_phone': '2348055614455', 'first_name': 'victor', 'last_name': 'makinde', 'order_id': 'ORDER-20250703235415-1690', 'delivery_address': 'Howson Wright'}, 'log': None, 'fees': None, 'fees_split': None, 'authorization': {}, 'customer': {'id': 289584095, 'first_name': None, 'last_name': None, 'email': 'victor4455@foodorder.com', 'customer_code': 'CUS_zv03jf9h0rpamu3', 'phone': None, 'metadata': None, 'risk_action': 'default', 'international_format_phone': None}, 'plan': None, 'split': {}, 'order_id': None, 'paidAt': None, 'createdAt': '2025-07-03T22:54:17.000Z', 'requested_amount': 270000, 'pos_transaction_data': None, 'source': None, 'fees_breakdown': None, 'connect': None, 'transaction_date': '2025-07-03T22:54:17.000Z', 'plan_object': {}, 'subaccount': {}}}
2025-07-03 23:56:18,988 - handlers.base_handler - INFO - Payment not yet verified for order ORDER-20250703235415-1690, attempt 3/15
2025-07-03 23:56:30,716 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:56:30] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:56:44,289 - handlers.webhook_handler - INFO - Processing message from 2348039603043 (User: Labukz): {'type': 'text', 'text': 'I plan attending'}
2025-07-03 23:56:44,290 - utils.session_manager - INFO - New session 2348039603043 initialized.
2025-07-03 23:56:44,305 - services.lead_tracker - INFO - New lead tracked: 2348039603043 (Labukz)
2025-07-03 23:56:46,182 - handlers.base_handler - INFO - Session 2348039603043: New user or missing details. Initiating onboarding.
2025-07-03 23:56:46,182 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348039603043', 'type': 'text', 'text': {'body': 'Hello Guest, welcome to Lola!\nPlease enter your preferred name.'}}
2025-07-03 23:56:47,220 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348039603043","wa_id":"2348039603043"}],"messages":[{"id":"wamid.HBgNMjM0ODAzOTYwMzA0MxUCABEYEkM3MDIxMDMzMjk3NjlGOEJFRAA="}]}
2025-07-03 23:56:47,221 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348039603043', 'wa_id': '2348039603043'}], 'messages': [{'id': 'wamid.HBgNMjM0ODAzOTYwMzA0MxUCABEYEkM3MDIxMDMzMjk3NjlGOEJFRAA='}]}
2025-07-03 23:56:47,222 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:56:47] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:56:49,788 - werkzeug - INFO - 127.0.0.1 - - [03/Jul/2025 23:56:49] "POST /webhook HTTP/1.1" 200 -
2025-07-03 23:57:02,691 - __main__ - INFO - Starting WhatsApp bot server...
2025-07-03 23:57:04,270 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-07-23 21:10:41,679 - __main__ - INFO - Starting WhatsApp bot server...
2025-07-23 21:10:44,442 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-07-23 21:10:47,632 - utils.data_manager - INFO - Successfully loaded 1 user details from database
2025-07-23 21:10:47,833 - services.payment_service - INFO - PaymentService initialized
2025-07-23 21:10:49,681 - handlers.product_sync_handler - ERROR - Database error while syncing products: column "product_variant_id" does not exist
LINE 3:                             product_variant_id,
                                    ^

2025-07-23 21:10:49,682 - app - WARNING - Initial product sync failed on startup
2025-07-23 21:10:49,683 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-07-23 21:10:52,282 - utils.data_manager - INFO - Successfully loaded 1 user details from database
2025-07-23 21:10:52,473 - services.payment_service - INFO - PaymentService initialized
2025-07-23 21:10:52,473 - services.lead_tracker - INFO - LeadTracker initialized
2025-07-23 21:10:52,474 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-07-23 21:10:52,474 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-07-23 21:10:52,475 - handlers.order_handler - INFO - OrderHandler initialized.
2025-07-23 21:10:52,475 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-07-23 21:10:52,475 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-07-23 21:10:52,956 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-07-23 21:10:52,956 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-07-23 21:10:52,957 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-07-23 21:10:52,957 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-07-23 21:10:52,981 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-07-23 21:10:52,982 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-07-23 21:14:21,581 - __main__ - INFO - Starting WhatsApp bot server...
2025-07-23 21:14:23,236 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-07-23 21:14:25,099 - utils.data_manager - INFO - Successfully loaded 1 user details from database
2025-07-23 21:14:25,318 - services.payment_service - INFO - PaymentService initialized
2025-07-23 21:14:27,482 - handlers.product_sync_handler - INFO - Successfully synced 17 products to data\products.json
2025-07-23 21:14:27,688 - app - INFO - Initial product sync successful on startup
2025-07-23 21:14:27,688 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-07-23 21:14:29,968 - utils.data_manager - INFO - Successfully loaded 1 user details from database
2025-07-23 21:14:30,168 - services.payment_service - INFO - PaymentService initialized
2025-07-23 21:14:30,169 - services.lead_tracker - INFO - LeadTracker initialized
2025-07-23 21:14:30,169 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-07-23 21:14:30,171 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-07-23 21:14:30,171 - handlers.order_handler - INFO - OrderHandler initialized.
2025-07-23 21:14:30,171 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-07-23 21:14:30,172 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-07-23 21:14:30,626 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-07-23 21:14:30,626 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-07-23 21:14:30,626 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-07-23 21:14:30,626 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-07-23 21:14:30,651 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-07-23 21:14:30,651 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-07-24 22:47:02,897 - __main__ - ERROR - Environment check failed. Please fix the issues above.
2025-07-24 22:47:27,520 - __main__ - INFO - Starting WhatsApp bot server...
2025-07-24 22:47:30,309 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-07-24 22:47:32,344 - utils.data_manager - INFO - Successfully loaded 1 user details from database
2025-07-24 22:47:32,554 - services.payment_service - INFO - PaymentService initialized
2025-07-24 22:47:34,405 - handlers.product_sync_handler - ERROR - Unexpected error while syncing products: float() argument must be a string or a real number, not 'NoneType'
2025-07-24 22:47:34,406 - app - WARNING - Initial product sync failed on startup
2025-07-24 22:47:34,406 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-07-24 22:47:36,054 - utils.data_manager - INFO - Successfully loaded 1 user details from database
2025-07-24 22:47:36,255 - services.payment_service - INFO - PaymentService initialized
2025-07-24 22:47:36,256 - services.lead_tracker - INFO - LeadTracker initialized
2025-07-24 22:47:36,256 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-07-24 22:47:36,256 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-07-24 22:47:36,257 - handlers.order_handler - INFO - OrderHandler initialized.
2025-07-24 22:47:36,257 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-07-24 22:47:36,257 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-07-24 22:47:36,730 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-07-24 22:47:36,730 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-07-24 22:47:36,730 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-07-24 22:47:36,731 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-07-24 22:47:36,761 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-07-24 22:47:36,761 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-07-24 22:48:39,050 - __main__ - INFO - Starting WhatsApp bot server...
2025-07-24 22:48:40,294 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-07-24 22:48:41,901 - utils.data_manager - INFO - Successfully loaded 1 user details from database
2025-07-24 22:48:42,094 - services.payment_service - INFO - PaymentService initialized
2025-07-24 22:48:43,700 - handlers.product_sync_handler - INFO - Successfully synced 18 products to data\products.json
2025-07-24 22:48:43,907 - app - INFO - Initial product sync successful on startup
2025-07-24 22:48:43,907 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-07-24 22:48:45,534 - utils.data_manager - INFO - Successfully loaded 1 user details from database
2025-07-24 22:48:45,730 - services.payment_service - INFO - PaymentService initialized
2025-07-24 22:48:45,730 - services.lead_tracker - INFO - LeadTracker initialized
2025-07-24 22:48:45,730 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-07-24 22:48:45,731 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-07-24 22:48:45,731 - handlers.order_handler - INFO - OrderHandler initialized.
2025-07-24 22:48:45,731 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-07-24 22:48:45,732 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-07-24 22:48:46,108 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-07-24 22:48:46,109 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-07-24 22:48:46,109 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-07-24 22:48:46,109 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-07-24 22:48:46,121 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-07-24 22:48:46,121 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-07-30 21:17:02,673 - __main__ - ERROR - Environment check failed. Please fix the issues above.
2025-07-30 23:08:44,104 - __main__ - INFO - Starting WhatsApp bot server...
2025-07-30 23:08:46,264 - __main__ - ERROR - Import error: cannot import name 'LeadTrackingHandler' from 'handlers.lead_tracking_handler' (C:\Users\zigam\Documents\Pentanative\Lola Main\handlers\lead_tracking_handler.py)
2025-07-30 23:12:44,278 - __main__ - INFO - Starting WhatsApp bot server...
2025-07-30 23:12:45,160 - __main__ - ERROR - Import error: cannot import name 'AIService' from partially initialized module 'services.ai_service' (most likely due to a circular import) (C:\Users\zigam\Documents\Pentanative\Lola Main\services\ai_service.py)
2025-07-30 23:19:28,923 - __main__ - INFO - Starting WhatsApp bot server...
2025-07-30 23:19:29,654 - __main__ - ERROR - Import error: cannot import name 'OrderItem' from 'utils' (C:\Users\zigam\Documents\Pentanative\Lola Main\utils\__init__.py)
2025-07-30 23:20:52,720 - __main__ - INFO - Starting WhatsApp bot server...
2025-07-30 23:20:54,949 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-07-30 23:20:57,388 - utils.data_manager - INFO - Successfully loaded 11 user details from database
2025-07-30 23:20:57,584 - services.payment_service - INFO - PaymentService initialized
2025-07-30 23:20:59,146 - handlers.product_sync_handler - INFO - Successfully synced 15 products to data\products.json
2025-07-30 23:20:59,332 - app - INFO - Initial product sync successful on startup
2025-07-30 23:20:59,333 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-07-30 23:21:00,872 - utils.data_manager - INFO - Successfully loaded 11 user details from database
2025-07-30 23:21:01,062 - services.payment_service - INFO - PaymentService initialized
2025-07-30 23:21:01,074 - services.lead_tracker - INFO - Created lead tracking file: data/leads.json
2025-07-30 23:21:01,075 - services.lead_tracker - INFO - LeadTracker initialized
2025-07-30 23:21:01,075 - __main__ - ERROR - Unexpected error: LeadTrackingHandler.__init__() takes 3 positional arguments but 6 were given
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Pentanative\Lola Main\run.py", line 151, in main
    from app import app
  File "C:\Users\zigam\Documents\Pentanative\Lola Main\app.py", line 55, in <module>
    webhook_handler = WebhookHandler(config)
  File "C:\Users\zigam\Documents\Pentanative\Lola Main\handlers\webhook_handler.py", line 22, in __init__
    self.message_processor = MessageProcessor(
                             ~~~~~~~~~~~~~~~~^
        config,
        ^^^^^^^
    ...<4 lines>...
        self.location_service
        ^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\zigam\Documents\Pentanative\Lola Main\handlers\message_processor.py", line 31, in __init__
    self.lead_tracking_handler = LeadTrackingHandler(
                                 ~~~~~~~~~~~~~~~~~~~^
        config, session_manager, data_manager, whatsapp_service, self.lead_tracker
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: LeadTrackingHandler.__init__() takes 3 positional arguments but 6 were given
2025-07-30 23:21:20,203 - __main__ - INFO - Starting WhatsApp bot server...
2025-07-30 23:21:21,640 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-07-30 23:21:23,743 - utils.data_manager - INFO - Successfully loaded 11 user details from database
2025-07-30 23:21:23,932 - services.payment_service - INFO - PaymentService initialized
2025-07-30 23:21:25,524 - handlers.product_sync_handler - INFO - Successfully synced 15 products to data\products.json
2025-07-30 23:21:25,713 - app - INFO - Initial product sync successful on startup
2025-07-30 23:21:25,713 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-07-30 23:21:27,290 - utils.data_manager - INFO - Successfully loaded 11 user details from database
2025-07-30 23:21:27,485 - services.payment_service - INFO - PaymentService initialized
2025-07-30 23:21:27,486 - services.lead_tracker - INFO - LeadTracker initialized
2025-07-30 23:21:27,486 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-07-30 23:21:27,498 - handlers.feedback_handler - INFO - Created feedback file: data/feedback.json
2025-07-30 23:21:27,499 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-07-30 23:21:27,499 - handlers.order_handler - INFO - OrderHandler initialized.
2025-07-30 23:21:27,499 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-07-30 23:21:27,499 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-07-30 23:21:27,998 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-07-30 23:21:27,999 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-07-30 23:21:27,999 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-07-30 23:21:27,999 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-07-30 23:21:28,034 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-07-30 23:21:28,035 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-08-03 14:16:08,848 - __main__ - ERROR - Environment check failed. Please fix the issues above.
2025-08-03 14:16:29,725 - __main__ - INFO - Starting WhatsApp bot server...
2025-08-03 14:16:32,491 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-03 14:16:34,226 - utils.data_manager - INFO - Successfully loaded 11 user details from database
2025-08-03 14:16:34,428 - services.payment_service - INFO - PaymentService initialized
2025-08-03 14:16:35,969 - handlers.product_sync_handler - INFO - Successfully synced 15 products to data\products.json
2025-08-03 14:16:36,166 - app - INFO - Initial product sync successful on startup
2025-08-03 14:16:36,166 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-03 14:16:37,705 - utils.data_manager - INFO - Successfully loaded 11 user details from database
2025-08-03 14:16:37,897 - services.payment_service - INFO - PaymentService initialized
2025-08-03 14:16:37,910 - services.lead_tracker - INFO - LeadTracker initialized
2025-08-03 14:16:37,910 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-08-03 14:16:37,913 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-08-03 14:16:37,914 - handlers.order_handler - INFO - OrderHandler initialized.
2025-08-03 14:16:37,914 - handlers.base_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 95%
2025-08-03 14:16:37,914 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-08-03 14:16:38,399 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-08-03 14:16:38,400 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-08-03 14:16:38,400 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-08-03 14:16:38,400 - handlers.base_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 95%
2025-08-03 14:16:38,419 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-08-03 14:16:38,420 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-08-03 14:28:04,007 - __main__ - INFO - Starting WhatsApp bot server...
2025-08-03 14:28:05,885 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-03 14:28:07,940 - utils.data_manager - INFO - Successfully loaded 11 user details from database
2025-08-03 14:28:08,158 - services.payment_service - INFO - PaymentService initialized
2025-08-03 14:28:09,869 - handlers.product_sync_handler - INFO - Successfully synced 15 products to data\products.json
2025-08-03 14:28:10,065 - app - INFO - Initial product sync successful on startup
2025-08-03 14:28:10,065 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-03 14:28:11,693 - utils.data_manager - INFO - Successfully loaded 11 user details from database
2025-08-03 14:28:11,885 - services.payment_service - INFO - PaymentService initialized
2025-08-03 14:28:11,885 - services.lead_tracker - INFO - LeadTracker initialized
2025-08-03 14:28:11,886 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-08-03 14:28:11,888 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-08-03 14:28:11,888 - handlers.order_handler - INFO - OrderHandler initialized.
2025-08-03 14:28:11,888 - handlers.base_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 95%
2025-08-03 14:28:11,889 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-08-03 14:28:12,708 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-08-03 14:28:12,709 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-08-03 14:28:12,710 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-08-03 14:28:12,711 - handlers.base_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 95%
2025-08-03 14:28:12,731 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-08-03 14:28:12,732 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-08-03 15:41:04,812 - __main__ - ERROR - Environment check failed. Please fix the issues above.
2025-08-03 15:41:27,304 - __main__ - ERROR - Environment check failed. Please fix the issues above.
2025-08-03 15:41:49,087 - __main__ - INFO - Starting WhatsApp bot server...
2025-08-03 15:41:50,299 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-03 15:41:51,990 - utils.data_manager - INFO - Successfully loaded 11 user details from database
2025-08-03 15:41:52,180 - services.payment_service - INFO - PaymentService initialized
2025-08-03 15:41:53,724 - handlers.product_sync_handler - INFO - Successfully synced 15 products to data\products.json
2025-08-03 15:41:53,910 - app - INFO - Initial product sync successful on startup
2025-08-03 15:41:53,910 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-03 15:41:55,541 - utils.data_manager - INFO - Successfully loaded 11 user details from database
2025-08-03 15:41:55,730 - services.payment_service - INFO - PaymentService initialized
2025-08-03 15:41:55,731 - services.lead_tracker - INFO - LeadTracker initialized
2025-08-03 15:41:55,731 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-08-03 15:41:55,732 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-08-03 15:41:55,732 - handlers.order_handler - INFO - OrderHandler initialized.
2025-08-03 15:41:55,732 - handlers.base_handler - INFO - PaymentHandler initialized with subaccount ACCT_939kju7zdvsk76y, split percentage 1%
2025-08-03 15:41:55,733 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-08-03 15:41:56,111 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-08-03 15:41:56,111 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-08-03 15:41:56,112 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-08-03 15:41:56,112 - handlers.base_handler - INFO - PaymentHandler initialized with subaccount ACCT_939kju7zdvsk76y, split percentage 1%
2025-08-03 15:41:56,125 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-08-03 15:41:56,125 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-08-03 15:42:13,250 - __main__ - INFO - Starting WhatsApp bot server...
2025-08-03 15:42:14,322 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-03 15:42:15,910 - utils.data_manager - INFO - Successfully loaded 11 user details from database
2025-08-03 15:42:16,101 - utils.data_manager - ERROR - Error decoding JSON from data\products.json: Expecting value: line 1 column 1 (char 0)
2025-08-03 15:42:16,101 - utils.data_manager - WARNING - File not found or empty: data\products.json
2025-08-03 15:42:16,102 - utils.data_manager - WARNING - Product data in data\products.json is not a dictionary. Initializing as empty.
2025-08-03 15:42:16,102 - services.payment_service - INFO - PaymentService initialized
2025-08-03 15:42:17,622 - handlers.product_sync_handler - INFO - Successfully synced 15 products to data\products.json
2025-08-03 15:42:17,810 - app - INFO - Initial product sync successful on startup
2025-08-03 15:42:17,811 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-03 15:42:19,420 - utils.data_manager - INFO - Successfully loaded 11 user details from database
2025-08-03 15:42:19,616 - services.payment_service - INFO - PaymentService initialized
2025-08-03 15:42:19,616 - services.lead_tracker - INFO - LeadTracker initialized
2025-08-03 15:42:19,616 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-08-03 15:42:19,617 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-08-03 15:42:19,617 - handlers.order_handler - INFO - OrderHandler initialized.
2025-08-03 15:42:19,618 - handlers.base_handler - INFO - PaymentHandler initialized with subaccount ACCT_939kju7zdvsk76y, split percentage 1%
2025-08-03 15:42:19,618 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-08-03 15:42:19,980 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-08-03 15:42:19,980 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-08-03 15:42:19,981 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-08-03 15:42:19,981 - handlers.base_handler - INFO - PaymentHandler initialized with subaccount ACCT_939kju7zdvsk76y, split percentage 1%
2025-08-03 15:42:19,993 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-08-03 15:42:19,994 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-08-03 15:42:35,981 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-08-03 15:42:35,981 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-08-03 15:42:37,757 - handlers.base_handler - INFO - Session 2348055614455 greeted returning user 'ziga'.
2025-08-03 15:42:38,980 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkExNUY3QjFEQTA3MDZGRTI5NQA="}]}
2025-08-03 15:42:38,981 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkExNUY3QjFEQTA3MDZGRTI5NQA='}]}
2025-08-03 15:42:38,981 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 15:42:38] "POST /webhook HTTP/1.1" 200 -
2025-08-03 15:42:40,215 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 15:42:40] "POST /webhook HTTP/1.1" 200 -
2025-08-03 15:42:40,351 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 15:42:40] "POST /webhook HTTP/1.1" 200 -
2025-08-03 15:42:40,737 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 15:42:40] "POST /webhook HTTP/1.1" 200 -
2025-08-03 15:42:42,010 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-08-03 15:42:42,012 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-08-03 15:42:42,012 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-08-03 15:42:42,012 - handlers.message_processor - INFO - Session 2348055614455: Redirecting to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-08-03 15:42:42,013 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-08-03 15:42:42,013 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'image', 'image': {'link': 'https://test.mackennytutors.com/wp-content/uploads/2025/06/ganador.jpg', 'caption': 'Our Delicious Menu!'}}
2025-08-03 15:42:43,072 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkQzOEZENTIxREQ0Q0ZBQjJCNgA="}]}
2025-08-03 15:42:43,072 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Hi, I'm Lola from Ganador \n\nTake a look at the menu and type in your order\n\n"}}
2025-08-03 15:42:44,070 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjU2OTM1RjNDRTRBMDNBREY5OAA="}]}
2025-08-03 15:42:44,071 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjU2OTM1RjNDRTRBMDNBREY5OAA='}]}
2025-08-03 15:42:44,071 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 15:42:44] "POST /webhook HTTP/1.1" 200 -
2025-08-03 15:42:44,311 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 15:42:44] "POST /webhook HTTP/1.1" 200 -
2025-08-03 15:42:45,030 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 15:42:45] "POST /webhook HTTP/1.1" 200 -
2025-08-03 15:42:45,072 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 15:42:45] "POST /webhook HTTP/1.1" 200 -
2025-08-03 15:42:45,153 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 15:42:45] "POST /webhook HTTP/1.1" 200 -
2025-08-03 15:42:45,350 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 15:42:45] "POST /webhook HTTP/1.1" 200 -
2025-08-03 15:42:45,602 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 15:42:45] "POST /webhook HTTP/1.1" 200 -
2025-08-03 15:42:49,320 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Fried rice'}
2025-08-03 15:42:49,322 - handlers.base_handler - INFO - AIHandler: Handling message 'fried rice' in AI bulk order state for session 2348055614455. Original: 'Fried rice'
2025-08-03 15:42:51,760 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-08-03 15:42:52,821 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkJGNzMxMkQwODE3RTczODZCNwA="}]}
2025-08-03 15:42:52,822 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkJGNzMxMkQwODE3RTczODZCNwA='}]}
2025-08-03 15:42:52,822 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 15:42:52] "POST /webhook HTTP/1.1" 200 -
2025-08-03 15:42:53,811 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 15:42:53] "POST /webhook HTTP/1.1" 200 -
2025-08-03 15:42:54,132 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 15:42:54] "POST /webhook HTTP/1.1" 200 -
2025-08-03 15:42:54,717 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 15:42:54] "POST /webhook HTTP/1.1" 200 -
2025-08-03 15:42:55,901 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-08-03 15:42:55,903 - handlers.base_handler - INFO - AI order confirmed. Cart: {'Fried Rice': {'item_id': 100, 'quantity': 1, 'price': 1700.0, 'total_price': 1700.0, 'variations': {}}}. Redirecting to order handler.
2025-08-03 15:42:55,903 - handlers.message_processor - INFO - Session 2348055614455: Redirecting to handler 'order_handler' with message 'process_final_order'.
2025-08-03 15:42:55,904 - handlers.order_handler - INFO - AI initiated order processing for session 2348055614455.
2025-08-03 15:42:55,904 - handlers.order_handler - INFO - Address set, proceeding to confirm order for AI-initiated session 2348055614455.
2025-08-03 15:42:56,860 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQyMzRFNUQzOTA5QTFFNTQwMgA="}]}
2025-08-03 15:42:56,873 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQyMzRFNUQzOTA5QTFFNTQwMgA='}]}
2025-08-03 15:42:56,874 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 15:42:56] "POST /webhook HTTP/1.1" 200 -
2025-08-03 15:42:58,086 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 15:42:58] "POST /webhook HTTP/1.1" 200 -
2025-08-03 15:42:58,190 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 15:42:58] "POST /webhook HTTP/1.1" 200 -
2025-08-03 15:42:58,421 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 15:42:58] "POST /webhook HTTP/1.1" 200 -
2025-08-03 15:43:03,440 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'final_confirm'}
2025-08-03 15:43:05,420 - utils.data_manager - INFO - Order 64 and its details saved to database
2025-08-03 15:43:05,421 - handlers.order_handler - INFO - Order 64 saved to database for session 2348055614455
2025-08-03 15:43:07,221 - utils.data_manager - INFO - User details for 2348055614455 saved to database
2025-08-03 15:43:07,222 - handlers.order_handler - INFO - User details saved for session 2348055614455 during order confirmation.
2025-08-03 15:43:07,239 - handlers.message_processor - INFO - Session 2348055614455: Redirecting to handler 'payment_handler' with message 'initiate_payment'.
2025-08-03 15:43:07,240 - handlers.base_handler - INFO - Handling payment processing for session 2348055614455, message: initiate_payment
2025-08-03 15:43:07,240 - handlers.base_handler - INFO - Creating payment link for session 2348055614455
2025-08-03 15:43:11,089 - utils.data_manager - INFO - Order 64 status updated to pending_payment in database
2025-08-03 15:43:11,090 - services.payment_service - INFO - Adding subaccount split: code=ACCT_939kju7zdvsk76y, percentage=1%
2025-08-03 15:43:11,090 - services.payment_service - INFO - Attempting to create payment link for reference: PAY-64 with amount: 170000, email: ziga4455@lola.com
2025-08-03 15:43:12,060 - services.payment_service - INFO - Payment link created for ziga ziga (2348055614455), URL: https://checkout.paystack.com/g6ff4b5nam6sj61
2025-08-03 15:43:12,060 - handlers.base_handler - INFO - Starting payment monitoring for order 64, reference PAY-64
2025-08-03 15:43:12,060 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-64
2025-08-03 15:43:12,540 - services.payment_service - WARNING - Payment not successful for reference PAY-64. Paystack status: abandoned. Response: {'status': True, 'message': 'Verification successful', 'data': {'id': 5205691248, 'domain': 'live', 'status': 'abandoned', 'reference': 'PAY-64', 'receipt_number': None, 'amount': 170000, 'message': None, 'gateway_response': 'The transaction was not completed', 'paid_at': None, 'created_at': '2025-08-03T14:43:12.000Z', 'channel': 'card', 'currency': 'NGN', 'ip_address': '102.67.12.153, 172.70.91.28, 172.31.62.52', 'metadata': {'customer_name': 'ziga', 'customer_phone': '2348055614455', 'first_name': 'ziga', 'last_name': 'ziga', 'order_id': '64', 'delivery_address': 'lagos'}, 'log': None, 'fees': None, 'fees_split': {'paystack': 2550, 'integration': '1700', 'subaccount': 165750, 'params': {'bearer': 'subaccount', 'transaction_charge': '1700', 'percentage_charge': '10'}}, 'authorization': {}, 'customer': {'id': 296824332, 'first_name': None, 'last_name': None, 'email': 'ziga4455@lola.com', 'customer_code': 'CUS_w9xvma5yla4h6qb', 'phone': None, 'metadata': None, 'risk_action': 'default', 'international_format_phone': None}, 'plan': None, 'split': {}, 'order_id': None, 'paidAt': None, 'createdAt': '2025-08-03T14:43:12.000Z', 'requested_amount': 170000, 'pos_transaction_data': None, 'source': None, 'fees_breakdown': None, 'connect': None, 'transaction_date': '2025-08-03T14:43:12.000Z', 'plan_object': {}, 'subaccount': {'id': 1407580, 'subaccount_code': 'ACCT_939kju7zdvsk76y', 'business_name': 'VICTOR OLUWASEGUN MAKINDE', 'description': 'VICTOR OLUWASEGUN MAKINDE', 'primary_contact_name': None, 'primary_contact_email': None, 'primary_contact_phone': None, 'metadata': None, 'percentage_charge': 10, 'settlement_bank': 'OPay Digital Services Limited (OPay)', 'bank_id': 171, 'account_number': '8055614455', 'currency': 'NGN', 'active': True, 'is_verified': True}}}
2025-08-03 15:43:12,541 - handlers.base_handler - INFO - Payment not yet verified for order 64, attempt 1/15
2025-08-03 15:43:12,541 - handlers.base_handler - INFO - Payment link created successfully for order 64 with subaccount ACCT_939kju7zdvsk76y
2025-08-03 15:43:12,542 - handlers.base_handler - ERROR - Unexpected error while fetching order items for order 64: 'PaymentHandler' object has no attribute 'db_params'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\payment_handler.py", line 183, in _get_order_items_from_db
    with psycopg2.connect(**self.db_params) as conn:
                            ^^^^^^^^^^^^^^
AttributeError: 'PaymentHandler' object has no attribute 'db_params'
2025-08-03 15:43:13,580 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkNCMzI1MjU4N0UyRjk2MkY2MAA="}]}
2025-08-03 15:43:13,592 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkNCMzI1MjU4N0UyRjk2MkY2MAA='}]}
2025-08-03 15:43:13,592 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 15:43:13] "POST /webhook HTTP/1.1" 200 -
2025-08-03 15:43:14,577 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 15:43:14] "POST /webhook HTTP/1.1" 200 -
2025-08-03 15:43:15,142 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 15:43:15] "POST /webhook HTTP/1.1" 200 -
2025-08-03 15:43:15,362 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 15:43:15] "POST /webhook HTTP/1.1" 200 -
2025-08-03 15:56:57,494 - __main__ - INFO - Starting WhatsApp bot server...
2025-08-03 15:56:59,283 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-03 15:57:01,124 - utils.data_manager - INFO - Successfully loaded 11 user details from database
2025-08-03 15:57:01,329 - services.payment_service - INFO - PaymentService initialized
2025-08-03 15:57:03,471 - handlers.product_sync_handler - INFO - Successfully synced 15 products to data\products.json
2025-08-03 15:57:03,668 - app - INFO - Initial product sync successful on startup
2025-08-03 15:57:03,668 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-03 15:57:05,247 - utils.data_manager - INFO - Successfully loaded 11 user details from database
2025-08-03 15:57:05,448 - services.payment_service - INFO - PaymentService initialized
2025-08-03 15:57:05,448 - services.lead_tracker - INFO - LeadTracker initialized
2025-08-03 15:57:05,449 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-08-03 15:57:05,461 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-08-03 15:57:05,461 - handlers.order_handler - INFO - OrderHandler initialized.
2025-08-03 15:57:05,462 - handlers.base_handler - INFO - PaymentHandler initialized with subaccount SUBACCOUNT_CODE, split percentage SUBACCOUNT_PERCENTAGE%
2025-08-03 15:57:05,462 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-08-03 15:57:05,896 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-08-03 15:57:05,897 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-08-03 15:57:05,897 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-08-03 15:57:05,897 - handlers.base_handler - INFO - PaymentHandler initialized with subaccount SUBACCOUNT_CODE, split percentage SUBACCOUNT_PERCENTAGE%
2025-08-03 15:57:05,920 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-08-03 15:57:05,920 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-08-03 15:57:25,169 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-08-03 15:57:25,169 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-08-03 15:57:26,897 - handlers.base_handler - INFO - Session 2348055614455 greeted returning user 'ziga'.
2025-08-03 15:57:28,208 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkJGNUJFMkM0NEEzMEM3OTRGOQA="}]}
2025-08-03 15:57:28,219 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkJGNUJFMkM0NEEzMEM3OTRGOQA='}]}
2025-08-03 15:57:28,220 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 15:57:28] "POST /webhook HTTP/1.1" 200 -
2025-08-03 15:57:29,204 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 15:57:29] "POST /webhook HTTP/1.1" 200 -
2025-08-03 15:57:29,869 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 15:57:29] "POST /webhook HTTP/1.1" 200 -
2025-08-03 15:57:31,463 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-08-03 15:57:31,465 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-08-03 15:57:31,465 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-08-03 15:57:31,466 - handlers.message_processor - INFO - Session 2348055614455: Redirecting to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-08-03 15:57:31,466 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-08-03 15:57:31,467 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'image', 'image': {'link': 'https://test.mackennytutors.com/wp-content/uploads/2025/06/ganador.jpg', 'caption': 'Our Delicious Menu!'}}
2025-08-03 15:57:32,461 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkY0NTEzQ0NCNUJBQjNBODE3QwA="}]}
2025-08-03 15:57:32,462 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Hi, I'm Lola from Ganador \n\nTake a look at the menu and type in your order\n\n"}}
2025-08-03 15:57:33,477 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQ5MzVBODYzNjZENzA5QzY4NwA="}]}
2025-08-03 15:57:33,478 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQ5MzVBODYzNjZENzA5QzY4NwA='}]}
2025-08-03 15:57:33,479 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 15:57:33] "POST /webhook HTTP/1.1" 200 -
2025-08-03 15:57:33,800 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 15:57:33] "POST /webhook HTTP/1.1" 200 -
2025-08-03 15:57:34,456 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 15:57:34] "POST /webhook HTTP/1.1" 200 -
2025-08-03 15:57:34,559 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 15:57:34] "POST /webhook HTTP/1.1" 200 -
2025-08-03 15:57:34,811 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 15:57:34] "POST /webhook HTTP/1.1" 200 -
2025-08-03 15:57:34,812 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 15:57:34] "POST /webhook HTTP/1.1" 200 -
2025-08-03 15:57:35,058 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 15:57:35] "POST /webhook HTTP/1.1" 200 -
2025-08-03 15:57:37,828 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Jellof rice'}
2025-08-03 15:57:37,829 - handlers.base_handler - INFO - AIHandler: Handling message 'jellof rice' in AI bulk order state for session 2348055614455. Original: 'Jellof rice'
2025-08-03 15:57:40,268 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-08-03 15:57:41,258 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkI2N0NFNTA3OTg3QjAxMzQ2MwA="}]}
2025-08-03 15:57:41,258 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkI2N0NFNTA3OTg3QjAxMzQ2MwA='}]}
2025-08-03 15:57:41,259 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 15:57:41] "POST /webhook HTTP/1.1" 200 -
2025-08-03 15:57:42,255 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 15:57:42] "POST /webhook HTTP/1.1" 200 -
2025-08-03 15:57:42,559 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 15:57:42] "POST /webhook HTTP/1.1" 200 -
2025-08-03 15:57:42,999 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 15:57:42] "POST /webhook HTTP/1.1" 200 -
2025-08-03 15:57:44,849 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-08-03 15:57:44,851 - handlers.base_handler - INFO - AI order confirmed. Cart: {'Jollof Rice': {'item_id': '99', 'quantity': 1, 'price': 1500.0, 'total_price': 1500.0, 'variations': {}}}. Redirecting to order handler.
2025-08-03 15:57:44,852 - handlers.message_processor - INFO - Session 2348055614455: Redirecting to handler 'order_handler' with message 'process_final_order'.
2025-08-03 15:57:44,852 - handlers.order_handler - INFO - AI initiated order processing for session 2348055614455.
2025-08-03 15:57:44,853 - handlers.order_handler - INFO - Address set, proceeding to confirm order for AI-initiated session 2348055614455.
2025-08-03 15:57:45,977 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQ4NDJBMUI5OTE5RDhFRDk1MQA="}]}
2025-08-03 15:57:45,994 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQ4NDJBMUI5OTE5RDhFRDk1MQA='}]}
2025-08-03 15:57:45,995 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 15:57:45] "POST /webhook HTTP/1.1" 200 -
2025-08-03 15:57:46,949 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 15:57:46] "POST /webhook HTTP/1.1" 200 -
2025-08-03 15:57:47,440 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 15:57:47] "POST /webhook HTTP/1.1" 200 -
2025-08-03 15:57:47,634 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 15:57:47] "POST /webhook HTTP/1.1" 200 -
2025-08-03 15:57:48,980 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'final_confirm'}
2025-08-03 15:57:50,986 - utils.data_manager - INFO - Order 67 and its details saved to database
2025-08-03 15:57:50,987 - handlers.order_handler - INFO - Order 67 saved to database for session 2348055614455
2025-08-03 15:57:52,717 - utils.data_manager - INFO - User details for 2348055614455 saved to database
2025-08-03 15:57:52,718 - handlers.order_handler - INFO - User details saved for session 2348055614455 during order confirmation.
2025-08-03 15:57:52,736 - handlers.message_processor - INFO - Session 2348055614455: Redirecting to handler 'payment_handler' with message 'initiate_payment'.
2025-08-03 15:57:52,736 - handlers.base_handler - INFO - Handling payment processing for session 2348055614455, message: initiate_payment
2025-08-03 15:57:52,736 - handlers.base_handler - INFO - Creating payment link for session 2348055614455
2025-08-03 15:57:56,576 - utils.data_manager - INFO - Order 67 status updated to pending_payment in database
2025-08-03 15:57:56,577 - handlers.base_handler - ERROR - Error creating payment link for session 2348055614455: unsupported operand type(s) for /: 'str' and 'int'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\payment_handler.py", line 121, in create_payment_link
    payment_url = self.payment_service.create_payment_link(
        amount=total_amount_kobo,
    ...<9 lines>...
        split_percentage=self.subaccount_percentage
    )
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\services\payment_service.py", line 80, in create_payment_link
    data["transaction_charge"] = int(amount * (split_percentage / 100))  # Calculate subaccount share in kobo
                                               ~~~~~~~~~~~~~~~~~^~~~~
TypeError: unsupported operand type(s) for /: 'str' and 'int'
2025-08-03 15:57:57,528 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjRDOEVGNjczOTQyQ0NCODRBQgA="}]}
2025-08-03 15:57:57,542 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjRDOEVGNjczOTQyQ0NCODRBQgA='}]}
2025-08-03 15:57:57,543 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 15:57:57] "POST /webhook HTTP/1.1" 200 -
2025-08-03 15:57:58,770 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 15:57:58] "POST /webhook HTTP/1.1" 200 -
2025-08-03 15:57:59,129 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 15:57:59] "POST /webhook HTTP/1.1" 200 -
2025-08-03 15:59:35,304 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-08-03 15:59:35,306 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Please select 'Checkout', 'Order More', 'Other Options', or type 'remove' or 'cancel'."}}
2025-08-03 15:59:36,376 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjdBOTkwNzBFQzQzMDg2NDE4NQA="}]}
2025-08-03 15:59:36,389 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjdBOTkwNzBFQzQzMDg2NDE4NQA='}]}
2025-08-03 15:59:36,390 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 15:59:36] "POST /webhook HTTP/1.1" 200 -
2025-08-03 15:59:37,391 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 15:59:37] "POST /webhook HTTP/1.1" 200 -
2025-08-03 15:59:37,998 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 15:59:37] "POST /webhook HTTP/1.1" 200 -
2025-08-03 15:59:42,432 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Checkout'}
2025-08-03 15:59:42,434 - handlers.order_handler - INFO - User selected 'Checkout' for session 2348055614455.
2025-08-03 15:59:43,447 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkU4OTg1REFCQUFBMjg5M0UzRAA="}]}
2025-08-03 15:59:43,460 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkU4OTg1REFCQUFBMjg5M0UzRAA='}]}
2025-08-03 15:59:43,460 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 15:59:43] "POST /webhook HTTP/1.1" 200 -
2025-08-03 15:59:44,471 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 15:59:44] "POST /webhook HTTP/1.1" 200 -
2025-08-03 15:59:44,761 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 15:59:44] "POST /webhook HTTP/1.1" 200 -
2025-08-03 15:59:45,649 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 15:59:45] "POST /webhook HTTP/1.1" 200 -
2025-08-03 15:59:46,889 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'details_correct'}
2025-08-03 15:59:46,891 - handlers.order_handler - INFO - User confirmed details are correct for session 2348055614455.
2025-08-03 15:59:48,686 - utils.data_manager - INFO - User details for 2348055614455 saved to database
2025-08-03 15:59:48,686 - handlers.order_handler - INFO - User details saved for session 2348055614455 during checkout.
2025-08-03 15:59:48,687 - handlers.order_handler - INFO - Address set, proceeding to confirm order for manual session 2348055614455.
2025-08-03 15:59:49,667 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkVGNEU4NDFCRDEwNjE3QzYzQQA="}]}
2025-08-03 15:59:49,680 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkVGNEU4NDFCRDEwNjE3QzYzQQA='}]}
2025-08-03 15:59:49,681 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 15:59:49] "POST /webhook HTTP/1.1" 200 -
2025-08-03 15:59:50,675 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 15:59:50] "POST /webhook HTTP/1.1" 200 -
2025-08-03 15:59:50,967 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 15:59:50] "POST /webhook HTTP/1.1" 200 -
2025-08-03 15:59:51,589 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 15:59:51] "POST /webhook HTTP/1.1" 200 -
2025-08-03 15:59:52,261 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'final_confirm'}
2025-08-03 15:59:54,287 - utils.data_manager - INFO - Order 68 and its details saved to database
2025-08-03 15:59:54,287 - handlers.order_handler - INFO - Order 68 saved to database for session 2348055614455
2025-08-03 15:59:56,077 - utils.data_manager - INFO - User details for 2348055614455 saved to database
2025-08-03 15:59:56,078 - handlers.order_handler - INFO - User details saved for session 2348055614455 during order confirmation.
2025-08-03 15:59:56,097 - handlers.message_processor - INFO - Session 2348055614455: Redirecting to handler 'payment_handler' with message 'initiate_payment'.
2025-08-03 15:59:56,097 - handlers.base_handler - INFO - Handling payment processing for session 2348055614455, message: initiate_payment
2025-08-03 15:59:56,097 - handlers.base_handler - INFO - Creating payment link for session 2348055614455
2025-08-03 15:59:59,687 - utils.data_manager - INFO - Order 68 status updated to pending_payment in database
2025-08-03 15:59:59,687 - handlers.base_handler - ERROR - Error creating payment link for session 2348055614455: unsupported operand type(s) for /: 'str' and 'int'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\payment_handler.py", line 121, in create_payment_link
    payment_url = self.payment_service.create_payment_link(
        amount=total_amount_kobo,
    ...<9 lines>...
        split_percentage=self.subaccount_percentage
    )
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\services\payment_service.py", line 80, in create_payment_link
    data["transaction_charge"] = int(amount * (split_percentage / 100))  # Calculate subaccount share in kobo
                                               ~~~~~~~~~~~~~~~~~^~~~~
TypeError: unsupported operand type(s) for /: 'str' and 'int'
2025-08-03 16:00:00,687 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkZEMkNDMUMwQzNGNEQxQkIxMgA="}]}
2025-08-03 16:00:00,699 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkZEMkNDMUMwQzNGNEQxQkIxMgA='}]}
2025-08-03 16:00:00,700 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:00:00] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:00:01,741 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:00:01] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:00:02,253 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:00:02] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:04:41,571 - __main__ - INFO - Starting WhatsApp bot server...
2025-08-03 16:04:42,855 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-03 16:04:44,567 - utils.data_manager - INFO - Successfully loaded 11 user details from database
2025-08-03 16:04:44,748 - services.payment_service - INFO - PaymentService initialized
2025-08-03 16:04:46,516 - handlers.product_sync_handler - INFO - Successfully synced 15 products to data\products.json
2025-08-03 16:04:46,714 - app - INFO - Initial product sync successful on startup
2025-08-03 16:04:46,714 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-03 16:04:48,270 - utils.data_manager - INFO - Successfully loaded 11 user details from database
2025-08-03 16:04:48,481 - services.payment_service - INFO - PaymentService initialized
2025-08-03 16:04:48,482 - services.lead_tracker - INFO - LeadTracker initialized
2025-08-03 16:04:48,484 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-08-03 16:04:48,486 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-08-03 16:04:48,486 - handlers.order_handler - INFO - OrderHandler initialized.
2025-08-03 16:04:48,487 - handlers.base_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-03 16:04:48,499 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-08-03 16:04:49,480 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-08-03 16:04:49,481 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-08-03 16:04:49,482 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-08-03 16:04:49,482 - handlers.base_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-03 16:04:49,502 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-08-03 16:04:49,502 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-08-03 16:11:09,763 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-08-03 16:11:09,763 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-08-03 16:11:11,655 - handlers.base_handler - INFO - Session 2348055614455 greeted returning user 'ziga'.
2025-08-03 16:11:12,325 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 401 Client Error: Unauthorized for url: https://graph.facebook.com/v17.0/204426689424598/messages - {"error":{"message":"Error validating access token: Session has expired on Sunday, 03-Aug-25 08:00:00 PDT. The current time is Sunday, 03-Aug-25 08:11:12 PDT.","type":"OAuthException","code":190,"error_subcode":463,"fbtrace_id":"AtEfiknch5dSauLOB5VS2SC"}}
2025-08-03 16:11:12,327 - handlers.message_processor - WARNING - Session 2348055614455: No handler response for handler 'greeting_handler', state 'start', message 'hello'. Resetting to greeting.
2025-08-03 16:11:12,329 - handlers.base_handler - INFO - Session 2348055614455 greeted returning user 'ziga'.
2025-08-03 16:11:12,896 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 401 Client Error: Unauthorized for url: https://graph.facebook.com/v17.0/204426689424598/messages - {"error":{"message":"Error validating access token: Session has expired on Sunday, 03-Aug-25 08:00:00 PDT. The current time is Sunday, 03-Aug-25 08:11:13 PDT.","type":"OAuthException","code":190,"error_subcode":463,"fbtrace_id":"AyYWfrIE752vZAfH9I-cki8"}}
2025-08-03 16:11:12,901 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:11:12] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:11:29,857 - __main__ - INFO - Starting WhatsApp bot server...
2025-08-03 16:11:31,464 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-03 16:11:33,094 - utils.data_manager - INFO - Successfully loaded 11 user details from database
2025-08-03 16:11:33,285 - services.payment_service - INFO - PaymentService initialized
2025-08-03 16:11:34,906 - handlers.product_sync_handler - INFO - Successfully synced 15 products to data\products.json
2025-08-03 16:11:35,097 - app - INFO - Initial product sync successful on startup
2025-08-03 16:11:35,097 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-03 16:11:36,664 - utils.data_manager - INFO - Successfully loaded 11 user details from database
2025-08-03 16:11:36,854 - services.payment_service - INFO - PaymentService initialized
2025-08-03 16:11:36,855 - services.lead_tracker - INFO - LeadTracker initialized
2025-08-03 16:11:36,855 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-08-03 16:11:36,856 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-08-03 16:11:36,856 - handlers.order_handler - INFO - OrderHandler initialized.
2025-08-03 16:11:36,857 - handlers.base_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-03 16:11:36,857 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-08-03 16:11:37,311 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-08-03 16:11:37,311 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-08-03 16:11:37,312 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-08-03 16:11:37,312 - handlers.base_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-03 16:11:37,334 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-08-03 16:11:37,335 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-08-03 16:11:42,666 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-08-03 16:11:42,666 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-08-03 16:11:44,402 - handlers.base_handler - INFO - Session 2348055614455 greeted returning user 'ziga'.
2025-08-03 16:11:44,985 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 401 Client Error: Unauthorized for url: https://graph.facebook.com/v17.0/204426689424598/messages - {"error":{"message":"Error validating access token: Session has expired on Sunday, 03-Aug-25 08:00:00 PDT. The current time is Sunday, 03-Aug-25 08:11:45 PDT.","type":"OAuthException","code":190,"error_subcode":463,"fbtrace_id":"AeNALlX5Z2IEnZ8osK3UzUB"}}
2025-08-03 16:11:44,986 - handlers.message_processor - WARNING - Session 2348055614455: No handler response for handler 'greeting_handler', state 'start', message 'hello'. Resetting to greeting.
2025-08-03 16:11:44,986 - handlers.base_handler - INFO - Session 2348055614455 greeted returning user 'ziga'.
2025-08-03 16:11:45,525 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 401 Client Error: Unauthorized for url: https://graph.facebook.com/v17.0/204426689424598/messages - {"error":{"message":"Error validating access token: Session has expired on Sunday, 03-Aug-25 08:00:00 PDT. The current time is Sunday, 03-Aug-25 08:11:45 PDT.","type":"OAuthException","code":190,"error_subcode":463,"fbtrace_id":"AkgcBw-wECTDlnQ44c3v-70"}}
2025-08-03 16:11:45,526 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:11:45] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:12:38,008 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-08-03 16:12:38,010 - handlers.base_handler - INFO - GreetingHandler: Handling message 'hello' in greeting state for session 2348055614455.
2025-08-03 16:12:38,010 - handlers.base_handler - WARNING - Session 2348055614455: Invalid option 'hello' in greeting state for non-paid user.
2025-08-03 16:12:38,595 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 401 Client Error: Unauthorized for url: https://graph.facebook.com/v17.0/204426689424598/messages - {"error":{"message":"Error validating access token: Session has expired on Sunday, 03-Aug-25 08:00:00 PDT. The current time is Sunday, 03-Aug-25 08:12:38 PDT.","type":"OAuthException","code":190,"error_subcode":463,"fbtrace_id":"AA5VyL7VhjJ2uNFnNQHjsfS"}}
2025-08-03 16:12:38,596 - handlers.message_processor - WARNING - Session 2348055614455: No handler response for handler 'greeting_handler', state 'greeting', message 'hello'. Resetting to greeting.
2025-08-03 16:12:38,596 - handlers.base_handler - INFO - Session 2348055614455 greeted returning user 'ziga'.
2025-08-03 16:12:39,185 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 401 Client Error: Unauthorized for url: https://graph.facebook.com/v17.0/204426689424598/messages - {"error":{"message":"Error validating access token: Session has expired on Sunday, 03-Aug-25 08:00:00 PDT. The current time is Sunday, 03-Aug-25 08:12:39 PDT.","type":"OAuthException","code":190,"error_subcode":463,"fbtrace_id":"A0BjURDZ3QQfhWAWQkEIG8J"}}
2025-08-03 16:12:39,187 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:12:39] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:48:44,018 - __main__ - INFO - Starting WhatsApp bot server...
2025-08-03 16:48:45,679 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-03 16:48:47,468 - utils.data_manager - INFO - Successfully loaded 11 user details from database
2025-08-03 16:48:47,657 - services.payment_service - INFO - PaymentService initialized
2025-08-03 16:48:49,209 - handlers.product_sync_handler - INFO - Successfully synced 15 products to data\products.json
2025-08-03 16:48:49,398 - app - INFO - Initial product sync successful on startup
2025-08-03 16:48:49,398 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-03 16:48:50,997 - utils.data_manager - INFO - Successfully loaded 11 user details from database
2025-08-03 16:48:51,187 - services.payment_service - INFO - PaymentService initialized
2025-08-03 16:48:51,187 - services.lead_tracker - INFO - LeadTracker initialized
2025-08-03 16:48:51,188 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-08-03 16:48:51,191 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-08-03 16:48:51,191 - handlers.order_handler - INFO - OrderHandler initialized.
2025-08-03 16:48:51,192 - handlers.base_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-03 16:48:51,192 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-08-03 16:48:51,605 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-08-03 16:48:51,605 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-08-03 16:48:51,606 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-08-03 16:48:51,606 - handlers.base_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-03 16:48:51,631 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-08-03 16:48:51,631 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-08-03 16:49:01,144 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-08-03 16:49:01,144 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-08-03 16:49:03,287 - handlers.base_handler - INFO - Session 2348055614455 greeted returning user 'ziga'.
2025-08-03 16:49:04,948 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjRGOTgyMTgxMjJGMTNFQkJEQgA="}]}
2025-08-03 16:49:04,960 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjRGOTgyMTgxMjJGMTNFQkJEQgA='}]}
2025-08-03 16:49:04,962 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:49:04] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:49:05,970 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:49:05] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:49:06,369 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:49:06] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:49:06,771 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:49:06] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:49:11,818 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'complain'}
2025-08-03 16:49:11,819 - handlers.base_handler - INFO - GreetingHandler: Handling message 'complain' in greeting state for session 2348055614455.
2025-08-03 16:49:11,820 - handlers.base_handler - INFO - Session 2348055614455 entering complaint state.
2025-08-03 16:49:11,820 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "We're sorry to hear you're having an issue. Please tell us about your complaint and we'll address it promptly."}}
2025-08-03 16:49:12,809 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkE4QzgzRkMyQ0Q3Mzc5MThBQgA="}]}
2025-08-03 16:49:12,809 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkE4QzgzRkMyQ0Q3Mzc5MThBQgA='}]}
2025-08-03 16:49:12,810 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:49:12] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:49:13,998 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:49:13] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:49:14,129 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:49:14] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:49:14,599 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:49:14] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:49:19,034 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Your delivery is bad'}
2025-08-03 16:49:20,757 - utils.data_manager - ERROR - Database error while saving complaint: column "user_name" of relation "whatsapp_complaint_details" does not exist
LINE 4:                             timestamp, channel, user_name, u...
                                                        ^
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\utils\data_manager.py", line 368, in save_complaint_to_db
    cur.execute(query, (
    ~~~~~~~~~~~^^^^^^^^^
        merchant_id,
        ^^^^^^^^^^^^
    ...<5 lines>...
        complaint_data.get("user_id")
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ))
    ^^
psycopg2.errors.UndefinedColumn: column "user_name" of relation "whatsapp_complaint_details" does not exist
LINE 4:                             timestamp, channel, user_name, u...
                                                        ^

2025-08-03 16:49:20,770 - handlers.base_handler - ERROR - Session 2348055614455: Failed to save complaint to database.
2025-08-03 16:49:21,968 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQwRDM3NTY0REM2ODhFMkVGNgA="}]}
2025-08-03 16:49:21,969 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQwRDM3NTY0REM2ODhFMkVGNgA='}]}
2025-08-03 16:49:21,969 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:49:21] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:49:22,908 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:49:22] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:49:23,341 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:49:23] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:49:23,449 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:49:23] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:50:21,385 - __main__ - INFO - Starting WhatsApp bot server...
2025-08-03 16:50:22,618 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-03 16:50:24,197 - utils.data_manager - INFO - Successfully loaded 11 user details from database
2025-08-03 16:50:24,388 - services.payment_service - INFO - PaymentService initialized
2025-08-03 16:50:25,940 - handlers.product_sync_handler - INFO - Successfully synced 15 products to data\products.json
2025-08-03 16:50:26,139 - app - INFO - Initial product sync successful on startup
2025-08-03 16:50:26,139 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-03 16:50:27,698 - utils.data_manager - INFO - Successfully loaded 11 user details from database
2025-08-03 16:50:27,888 - services.payment_service - INFO - PaymentService initialized
2025-08-03 16:50:27,888 - services.lead_tracker - INFO - LeadTracker initialized
2025-08-03 16:50:27,888 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-08-03 16:50:27,889 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-08-03 16:50:27,889 - handlers.order_handler - INFO - OrderHandler initialized.
2025-08-03 16:50:27,889 - handlers.base_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-03 16:50:27,890 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-08-03 16:50:28,263 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-08-03 16:50:28,263 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-08-03 16:50:28,264 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-08-03 16:50:28,264 - handlers.base_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-03 16:50:28,274 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-08-03 16:50:28,274 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-08-03 16:50:31,825 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-08-03 16:50:31,826 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-08-03 16:50:33,587 - handlers.base_handler - INFO - Session 2348055614455 greeted returning user 'ziga'.
2025-08-03 16:50:34,928 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjgyREU3MkE3NTRFNTZENjQ3MAA="}]}
2025-08-03 16:50:34,928 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjgyREU3MkE3NTRFNTZENjQ3MAA='}]}
2025-08-03 16:50:34,929 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:50:34] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:50:35,938 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:50:35] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:50:36,351 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:50:36] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:50:36,469 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:50:36] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:50:38,294 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'complain'}
2025-08-03 16:50:38,295 - handlers.base_handler - INFO - GreetingHandler: Handling message 'complain' in greeting state for session 2348055614455.
2025-08-03 16:50:38,296 - handlers.base_handler - INFO - Session 2348055614455 entering complaint state.
2025-08-03 16:50:38,296 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "We're sorry to hear you're having an issue. Please tell us about your complaint and we'll address it promptly."}}
2025-08-03 16:50:39,388 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkM0MEQxNDg5MDZBMjEwMEIzRgA="}]}
2025-08-03 16:50:39,388 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkM0MEQxNDg5MDZBMjEwMEIzRgA='}]}
2025-08-03 16:50:39,389 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:50:39] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:50:40,398 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:50:40] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:50:40,728 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:50:40] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:50:40,851 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:50:40] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:50:46,493 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Your delivery is terrible'}
2025-08-03 16:50:48,216 - utils.data_manager - ERROR - Database error while saving complaint: column "user_name" of relation "whatsapp_complaint_details" does not exist
LINE 4:                             timestamp, channel, user_name, u...
                                                        ^
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\utils\data_manager.py", line 364, in save_complaint_to_db
    cur.execute(query, (
    ~~~~~~~~~~~^^^^^^^^^
        merchant_id,
        ^^^^^^^^^^^^
    ...<5 lines>...
        complaint_data.get("user_id")
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ))
    ^^
psycopg2.errors.UndefinedColumn: column "user_name" of relation "whatsapp_complaint_details" does not exist
LINE 4:                             timestamp, channel, user_name, u...
                                                        ^

2025-08-03 16:50:48,218 - handlers.base_handler - ERROR - Session 2348055614455: Failed to save complaint to database.
2025-08-03 16:50:49,568 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjRBM0EyQjNCNDVFRkQ5OTYxNAA="}]}
2025-08-03 16:50:49,568 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjRBM0EyQjNCNDVFRkQ5OTYxNAA='}]}
2025-08-03 16:50:49,569 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:50:49] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:50:50,479 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:50:50] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:50:50,959 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:50:50] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:50:51,043 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:50:51] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:51:48,459 - __main__ - INFO - Starting WhatsApp bot server...
2025-08-03 16:51:49,644 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-03 16:51:51,187 - utils.data_manager - INFO - Successfully loaded 11 user details from database
2025-08-03 16:51:51,388 - services.payment_service - INFO - PaymentService initialized
2025-08-03 16:51:52,919 - handlers.product_sync_handler - INFO - Successfully synced 15 products to data\products.json
2025-08-03 16:51:53,107 - app - INFO - Initial product sync successful on startup
2025-08-03 16:51:53,107 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-03 16:51:54,948 - utils.data_manager - INFO - Successfully loaded 11 user details from database
2025-08-03 16:51:55,132 - services.payment_service - INFO - PaymentService initialized
2025-08-03 16:51:55,132 - services.lead_tracker - INFO - LeadTracker initialized
2025-08-03 16:51:55,133 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-08-03 16:51:55,134 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-08-03 16:51:55,134 - handlers.order_handler - INFO - OrderHandler initialized.
2025-08-03 16:51:55,134 - handlers.base_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-03 16:51:55,134 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-08-03 16:51:55,528 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-08-03 16:51:55,529 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-08-03 16:51:55,529 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-08-03 16:51:55,529 - handlers.base_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-03 16:51:55,539 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-08-03 16:51:55,539 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-08-03 16:51:56,834 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-08-03 16:51:56,834 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-08-03 16:51:58,548 - handlers.base_handler - INFO - Session 2348055614455 greeted returning user 'ziga'.
2025-08-03 16:51:59,628 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjc3NzNCQTY1RTEzNEUzNDMyRQA="}]}
2025-08-03 16:51:59,629 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjc3NzNCQTY1RTEzNEUzNDMyRQA='}]}
2025-08-03 16:51:59,629 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:51:59] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:52:00,690 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:52:00] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:52:00,939 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:52:00] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:52:00,969 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:52:00] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:52:45,917 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:52:45] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:52:51,248 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'enquiry'}
2025-08-03 16:52:51,250 - handlers.base_handler - INFO - GreetingHandler: Handling message 'enquiry' in greeting state for session 2348055614455.
2025-08-03 16:52:51,250 - handlers.base_handler - INFO - Session 2348055614455 redirecting to EnquiryHandler for enquiry menu.
2025-08-03 16:52:51,251 - handlers.message_processor - INFO - Session 2348055614455: Redirecting to handler 'enquiry_handler' with message 'show_enquiry_menu'.
2025-08-03 16:52:51,251 - handlers.base_handler - INFO - Session 2348055614455: Displaying enquiry menu.
2025-08-03 16:52:52,368 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjU4MzQzREU5OTQ5RTc2RTM4RQA="}]}
2025-08-03 16:52:52,369 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjU4MzQzREU5OTQ5RTc2RTM4RQA='}]}
2025-08-03 16:52:52,369 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:52:52] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:52:53,340 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:52:53] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:52:53,672 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:52:53] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:52:53,788 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:52:53] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:52:56,622 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'back_to_main'}
2025-08-03 16:52:56,624 - handlers.base_handler - INFO - Session 2348055614455: Processing enquiry menu option 'back_to_main'.
2025-08-03 16:52:56,624 - handlers.base_handler - INFO - Session 2348055614455: Returning to main menu from enquiry menu.
2025-08-03 16:52:56,625 - handlers.base_handler - INFO - Session 2348055614455: Returned to main menu from enquiry handler.
2025-08-03 16:52:57,666 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjhGNzMyM0NBMUYzRDFENDhBNwA="}]}
2025-08-03 16:52:57,667 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjhGNzMyM0NBMUYzRDFENDhBNwA='}]}
2025-08-03 16:52:57,668 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:52:57] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:52:58,621 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:52:58] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:52:59,088 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:52:59] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:52:59,210 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:52:59] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:53:41,084 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-08-03 16:53:41,086 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-08-03 16:53:41,086 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-08-03 16:53:41,087 - handlers.message_processor - INFO - Session 2348055614455: Redirecting to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-08-03 16:53:41,087 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-08-03 16:53:41,088 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'image', 'image': {'link': 'https://test.mackennytutors.com/wp-content/uploads/2025/06/ganador.jpg', 'caption': 'Our Delicious Menu!'}}
2025-08-03 16:53:42,408 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkFFNEVBMjAwRDA5OEI1QTJEMgA="}]}
2025-08-03 16:53:42,409 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Hi, I'm Lola from Ganador \n\nTake a look at the menu and type in your order\n\n"}}
2025-08-03 16:53:43,429 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjREMkIxMjdBRDMyN0I1OTFBRQA="}]}
2025-08-03 16:53:43,430 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjREMkIxMjdBRDMyN0I1OTFBRQA='}]}
2025-08-03 16:53:43,430 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:53:43] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:53:44,388 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:53:44] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:53:44,943 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:53:44] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:53:44,959 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:53:44] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:53:45,209 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:53:45] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:53:45,288 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:53:45] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:53:45,418 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:53:45] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:53:49,686 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Jellof rice'}
2025-08-03 16:53:49,688 - handlers.base_handler - INFO - AIHandler: Handling message 'jellof rice' in AI bulk order state for session 2348055614455. Original: 'Jellof rice'
2025-08-03 16:53:52,398 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-08-03 16:53:53,358 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkY4QzkyNjRDNUYyOEVGQUQ3OQA="}]}
2025-08-03 16:53:53,359 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkY4QzkyNjRDNUYyOEVGQUQ3OQA='}]}
2025-08-03 16:53:53,359 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:53:53] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:53:54,307 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:53:54] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:53:54,620 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:53:54] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:53:54,746 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:53:54] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:53:56,719 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-08-03 16:53:56,720 - handlers.base_handler - INFO - AI order confirmed. Cart: {'Jollof Rice': {'item_id': '99', 'quantity': 1, 'price': 1500.0, 'total_price': 1500.0, 'variations': {}}}. Redirecting to order handler.
2025-08-03 16:53:56,721 - handlers.message_processor - INFO - Session 2348055614455: Redirecting to handler 'order_handler' with message 'process_final_order'.
2025-08-03 16:53:56,721 - handlers.order_handler - INFO - AI initiated order processing for session 2348055614455.
2025-08-03 16:53:56,722 - handlers.order_handler - INFO - Address set, proceeding to confirm order for AI-initiated session 2348055614455.
2025-08-03 16:53:57,836 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkExQTVGQTY1OENDN0FFODE4NQA="}]}
2025-08-03 16:53:57,850 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkExQTVGQTY1OENDN0FFODE4NQA='}]}
2025-08-03 16:53:57,851 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:53:57] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:53:59,038 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:53:59] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:53:59,160 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:53:59] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:53:59,290 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:53:59] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:54:00,492 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'final_confirm'}
2025-08-03 16:54:02,706 - utils.data_manager - INFO - Order 69 and its details saved to database
2025-08-03 16:54:02,707 - handlers.order_handler - INFO - Order 69 saved to database for session 2348055614455
2025-08-03 16:54:04,428 - utils.data_manager - INFO - User details for 2348055614455 saved to database
2025-08-03 16:54:04,428 - handlers.order_handler - INFO - User details saved for session 2348055614455 during order confirmation.
2025-08-03 16:54:04,445 - handlers.message_processor - INFO - Session 2348055614455: Redirecting to handler 'payment_handler' with message 'initiate_payment'.
2025-08-03 16:54:04,446 - handlers.base_handler - INFO - Handling payment processing for session 2348055614455, message: initiate_payment
2025-08-03 16:54:04,446 - handlers.base_handler - INFO - Creating payment link for session 2348055614455
2025-08-03 16:54:08,016 - utils.data_manager - INFO - Order 69 status updated to pending_payment in database
2025-08-03 16:54:08,017 - handlers.base_handler - ERROR - Error creating payment link for session 2348055614455: unsupported operand type(s) for /: 'str' and 'int'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\payment_handler.py", line 121, in create_payment_link
    payment_url = self.payment_service.create_payment_link(
        amount=total_amount_kobo,
    ...<9 lines>...
        split_percentage=self.subaccount_percentage
    )
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\services\payment_service.py", line 80, in create_payment_link
    data["transaction_charge"] = int(amount * (split_percentage / 100))  # Calculate subaccount share in kobo
                                               ~~~~~~~~~~~~~~~~~^~~~~
TypeError: unsupported operand type(s) for /: 'str' and 'int'
2025-08-03 16:54:08,984 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkMwRTE1QjcyM0UzQ0NGRkVFQwA="}]}
2025-08-03 16:54:08,998 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkMwRTE1QjcyM0UzQ0NGRkVFQwA='}]}
2025-08-03 16:54:08,999 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:54:08] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:54:09,964 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:54:09] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:54:10,659 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:54:10] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:54:10,661 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:54:10] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:57:32,253 - __main__ - INFO - Starting WhatsApp bot server...
2025-08-03 16:57:33,322 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-03 16:57:35,236 - utils.data_manager - INFO - Successfully loaded 11 user details from database
2025-08-03 16:57:35,426 - services.payment_service - INFO - PaymentService initialized
2025-08-03 16:57:36,990 - handlers.product_sync_handler - INFO - Successfully synced 15 products to data\products.json
2025-08-03 16:57:37,186 - app - INFO - Initial product sync successful on startup
2025-08-03 16:57:37,186 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-03 16:57:38,707 - utils.data_manager - INFO - Successfully loaded 11 user details from database
2025-08-03 16:57:38,896 - services.payment_service - INFO - PaymentService initialized
2025-08-03 16:57:38,897 - services.lead_tracker - INFO - LeadTracker initialized
2025-08-03 16:57:38,897 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-08-03 16:57:38,898 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-08-03 16:57:38,898 - handlers.order_handler - INFO - OrderHandler initialized.
2025-08-03 16:57:38,898 - handlers.base_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-03 16:57:38,898 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-08-03 16:57:39,261 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-08-03 16:57:39,262 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-08-03 16:57:39,262 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-08-03 16:57:39,262 - handlers.base_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-03 16:57:39,273 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-08-03 16:57:39,274 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-08-03 16:57:41,405 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-08-03 16:57:41,405 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-08-03 16:57:43,156 - handlers.base_handler - INFO - Session 2348055614455 greeted returning user 'ziga'.
2025-08-03 16:57:44,216 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkIxREIwMjhBRDNGODcxMzY0QwA="}]}
2025-08-03 16:57:44,217 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkIxREIwMjhBRDNGODcxMzY0QwA='}]}
2025-08-03 16:57:44,217 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:57:44] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:57:45,198 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:57:45] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:57:45,538 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:57:45] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:57:45,922 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:57:45] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:57:46,632 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-08-03 16:57:46,634 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-08-03 16:57:46,634 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-08-03 16:57:46,634 - handlers.message_processor - INFO - Session 2348055614455: Redirecting to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-08-03 16:57:46,635 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-08-03 16:57:46,635 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'image', 'image': {'link': 'https://test.mackennytutors.com/wp-content/uploads/2025/06/ganador.jpg', 'caption': 'Our Delicious Menu!'}}
2025-08-03 16:57:47,738 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjc1NUMxNUQwN0ZDMTg3ODVFRQA="}]}
2025-08-03 16:57:47,738 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Hi, I'm Lola from Ganador \n\nTake a look at the menu and type in your order\n\n"}}
2025-08-03 16:57:48,726 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkI3MzA3MzhDNkQ5NTQ2NTA3OQA="}]}
2025-08-03 16:57:48,727 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkI3MzA3MzhDNkQ5NTQ2NTA3OQA='}]}
2025-08-03 16:57:48,727 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:57:48] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:57:49,056 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:57:49] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:57:49,638 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:57:49] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:57:49,760 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:57:49] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:57:49,762 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:57:49] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:57:50,037 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:57:50] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:57:50,157 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:57:50] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:57:54,016 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Jellof rice'}
2025-08-03 16:57:54,018 - handlers.base_handler - INFO - AIHandler: Handling message 'jellof rice' in AI bulk order state for session 2348055614455. Original: 'Jellof rice'
2025-08-03 16:57:56,607 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-08-03 16:57:57,698 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQ4ODk1OTgyNTMxMzg4NjkwOAA="}]}
2025-08-03 16:57:57,698 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQ4ODk1OTgyNTMxMzg4NjkwOAA='}]}
2025-08-03 16:57:57,699 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:57:57] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:57:58,699 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:57:58] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:57:58,937 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:57:58] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:57:59,204 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:57:59] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:58:00,508 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-08-03 16:58:00,509 - handlers.base_handler - INFO - AI order confirmed. Cart: {'Jollof Rice': {'item_id': 99, 'quantity': 1, 'price': 1500.0, 'total_price': 1500.0, 'variations': {}}}. Redirecting to order handler.
2025-08-03 16:58:00,510 - handlers.message_processor - INFO - Session 2348055614455: Redirecting to handler 'order_handler' with message 'process_final_order'.
2025-08-03 16:58:00,510 - handlers.order_handler - INFO - AI initiated order processing for session 2348055614455.
2025-08-03 16:58:00,510 - handlers.order_handler - INFO - Address set, proceeding to confirm order for AI-initiated session 2348055614455.
2025-08-03 16:58:01,606 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkZGRUJCMTZDN0Q5MEE2MDE3MwA="}]}
2025-08-03 16:58:01,620 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkZGRUJCMTZDN0Q5MEE2MDE3MwA='}]}
2025-08-03 16:58:01,620 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:58:01] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:58:02,826 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:58:02] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:58:02,958 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:58:02] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:58:03,081 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:58:03] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:58:04,128 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'final_confirm'}
2025-08-03 16:58:06,126 - utils.data_manager - INFO - Order 70 and its details saved to database
2025-08-03 16:58:06,127 - handlers.order_handler - INFO - Order 70 saved to database for session 2348055614455
2025-08-03 16:58:07,856 - utils.data_manager - INFO - User details for 2348055614455 saved to database
2025-08-03 16:58:07,857 - handlers.order_handler - INFO - User details saved for session 2348055614455 during order confirmation.
2025-08-03 16:58:07,873 - handlers.message_processor - INFO - Session 2348055614455: Redirecting to handler 'payment_handler' with message 'initiate_payment'.
2025-08-03 16:58:07,874 - handlers.base_handler - INFO - Handling payment processing for session 2348055614455, message: initiate_payment
2025-08-03 16:58:07,874 - handlers.base_handler - INFO - Creating payment link for session 2348055614455
2025-08-03 16:58:11,418 - utils.data_manager - INFO - Order 70 status updated to pending_payment in database
2025-08-03 16:58:11,418 - handlers.base_handler - ERROR - Error creating payment link for session 2348055614455: unsupported operand type(s) for /: 'str' and 'int'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\payment_handler.py", line 121, in create_payment_link
    payment_url = self.payment_service.create_payment_link(
        amount=total_amount_kobo,
    ...<9 lines>...
        split_percentage=self.subaccount_percentage
    )
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\services\payment_service.py", line 80, in create_payment_link
    data["transaction_charge"] = int(amount * (split_percentage / 100))  # Calculate subaccount share in kobo
                                               ~~~~~~~~~~~~~~~~~^~~~~
TypeError: unsupported operand type(s) for /: 'str' and 'int'
2025-08-03 16:58:12,626 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkQ5QTMyOTY5OTMxNTE5RjI2QgA="}]}
2025-08-03 16:58:12,639 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkQ5QTMyOTY5OTMxNTE5RjI2QgA='}]}
2025-08-03 16:58:12,640 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:58:12] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:58:13,732 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:58:13] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:58:14,097 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:58:14] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:58:14,219 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:58:14] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:59:17,210 - __main__ - INFO - Starting WhatsApp bot server...
2025-08-03 16:59:18,281 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-03 16:59:19,965 - utils.data_manager - INFO - Successfully loaded 11 user details from database
2025-08-03 16:59:20,156 - services.payment_service - INFO - PaymentService initialized
2025-08-03 16:59:21,708 - handlers.product_sync_handler - INFO - Successfully synced 15 products to data\products.json
2025-08-03 16:59:21,906 - app - INFO - Initial product sync successful on startup
2025-08-03 16:59:21,906 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-03 16:59:23,436 - utils.data_manager - INFO - Successfully loaded 11 user details from database
2025-08-03 16:59:23,626 - services.payment_service - INFO - PaymentService initialized
2025-08-03 16:59:23,626 - services.lead_tracker - INFO - LeadTracker initialized
2025-08-03 16:59:23,627 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-08-03 16:59:23,627 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-08-03 16:59:23,627 - handlers.order_handler - INFO - OrderHandler initialized.
2025-08-03 16:59:23,628 - handlers.base_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-03 16:59:23,628 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-08-03 16:59:23,994 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-08-03 16:59:23,995 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-08-03 16:59:23,995 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-08-03 16:59:23,995 - handlers.base_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-03 16:59:24,006 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-08-03 16:59:24,006 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-08-03 16:59:25,686 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-08-03 16:59:25,687 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-08-03 16:59:27,425 - handlers.base_handler - INFO - Session 2348055614455 greeted returning user 'ziga'.
2025-08-03 16:59:28,626 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjg5MERCODUzOUM3NTQwRUZFRQA="}]}
2025-08-03 16:59:28,626 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjg5MERCODUzOUM3NTQwRUZFRQA='}]}
2025-08-03 16:59:28,627 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:59:28] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:59:29,617 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:59:29] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:59:29,957 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:59:29] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:59:30,330 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:59:30] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:59:34,142 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-08-03 16:59:34,143 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-08-03 16:59:34,144 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-08-03 16:59:34,144 - handlers.message_processor - INFO - Session 2348055614455: Redirecting to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-08-03 16:59:34,145 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-08-03 16:59:34,145 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'image', 'image': {'link': 'https://test.mackennytutors.com/wp-content/uploads/2025/06/ganador.jpg', 'caption': 'Our Delicious Menu!'}}
2025-08-03 16:59:35,245 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjlDMjkwNkE2NzE1NjdCRUFCMwA="}]}
2025-08-03 16:59:35,246 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Hi, I'm Lola from Ganador \n\nTake a look at the menu and type in your order\n\n"}}
2025-08-03 16:59:36,206 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkY2Q0Y1MEIyN0FGNzM2QTZCMAA="}]}
2025-08-03 16:59:36,207 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkY2Q0Y1MEIyN0FGNzM2QTZCMAA='}]}
2025-08-03 16:59:36,207 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:59:36] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:59:36,499 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:59:36] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:59:37,190 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:59:37] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:59:37,318 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:59:37] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:59:37,319 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:59:37] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:59:37,578 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:59:37] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:59:37,676 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:59:37] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:59:40,905 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Jellof rice'}
2025-08-03 16:59:40,907 - handlers.base_handler - INFO - AIHandler: Handling message 'jellof rice' in AI bulk order state for session 2348055614455. Original: 'Jellof rice'
2025-08-03 16:59:43,049 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-08-03 16:59:44,340 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjkyMjJBMEVGOEUzN0FGREQwQwA="}]}
2025-08-03 16:59:44,341 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjkyMjJBMEVGOEUzN0FGREQwQwA='}]}
2025-08-03 16:59:44,341 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:59:44] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:59:45,361 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:59:45] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:59:45,771 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:59:45] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:59:45,890 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:59:45] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:59:47,713 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-08-03 16:59:47,715 - handlers.base_handler - INFO - AI order confirmed. Cart: {'Jollof Rice': {'item_id': '99', 'quantity': 1, 'price': 1500.0, 'total_price': 1500.0, 'variations': {}}}. Redirecting to order handler.
2025-08-03 16:59:47,715 - handlers.message_processor - INFO - Session 2348055614455: Redirecting to handler 'order_handler' with message 'process_final_order'.
2025-08-03 16:59:47,716 - handlers.order_handler - INFO - AI initiated order processing for session 2348055614455.
2025-08-03 16:59:47,716 - handlers.order_handler - INFO - Address set, proceeding to confirm order for AI-initiated session 2348055614455.
2025-08-03 16:59:48,799 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQxNEMyRURBRDE5NTRDMDI5NAA="}]}
2025-08-03 16:59:48,812 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQxNEMyRURBRDE5NTRDMDI5NAA='}]}
2025-08-03 16:59:48,812 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:59:48] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:59:49,920 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:59:49] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:59:50,059 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:59:50] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:59:50,193 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 16:59:50] "POST /webhook HTTP/1.1" 200 -
2025-08-03 16:59:52,552 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'final_confirm'}
2025-08-03 16:59:54,485 - utils.data_manager - INFO - Order 71 and its details saved to database
2025-08-03 16:59:54,486 - handlers.order_handler - INFO - Order 71 saved to database for session 2348055614455
2025-08-03 16:59:56,195 - utils.data_manager - INFO - User details for 2348055614455 saved to database
2025-08-03 16:59:56,195 - handlers.order_handler - INFO - User details saved for session 2348055614455 during order confirmation.
2025-08-03 16:59:56,211 - handlers.message_processor - INFO - Session 2348055614455: Redirecting to handler 'payment_handler' with message 'initiate_payment'.
2025-08-03 16:59:56,211 - handlers.base_handler - INFO - Handling payment processing for session 2348055614455, message: initiate_payment
2025-08-03 16:59:56,212 - handlers.base_handler - INFO - Creating payment link for session 2348055614455
2025-08-03 16:59:59,645 - utils.data_manager - INFO - Order 71 status updated to pending_payment in database
2025-08-03 16:59:59,646 - services.payment_service - INFO - Adding subaccount split: code=ACCT_u9knhyzn5eq4iop, percentage=1%
2025-08-03 16:59:59,646 - services.payment_service - INFO - Attempting to create payment link for reference: PAY-71 with amount: 150000, email: ziga4455@lola.com
2025-08-03 17:00:00,515 - services.payment_service - INFO - Payment link created for ziga ziga (2348055614455), URL: https://checkout.paystack.com/50wbl4bge1tkmeo
2025-08-03 17:00:00,516 - handlers.base_handler - INFO - Starting payment monitoring for order 71, reference PAY-71
2025-08-03 17:00:00,516 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-71
2025-08-03 17:00:01,157 - services.payment_service - WARNING - Payment not successful for reference PAY-71. Paystack status: abandoned. Response: {'status': True, 'message': 'Verification successful', 'data': {'id': 5205817612, 'domain': 'test', 'status': 'abandoned', 'reference': 'PAY-71', 'receipt_number': None, 'amount': 150000, 'message': None, 'gateway_response': 'The transaction was not completed', 'paid_at': None, 'created_at': '2025-08-03T16:00:00.000Z', 'channel': 'card', 'currency': 'NGN', 'ip_address': '102.67.12.153, 172.70.162.232, 172.31.62.52', 'metadata': {'customer_name': 'ziga', 'customer_phone': '2348055614455', 'first_name': 'ziga', 'last_name': 'ziga', 'order_id': '71', 'delivery_address': 'lagos'}, 'log': None, 'fees': None, 'fees_split': {'paystack': 2250, 'integration': '1500', 'subaccount': 146250, 'params': {'bearer': 'subaccount', 'transaction_charge': '1500', 'percentage_charge': '0'}}, 'authorization': {}, 'customer': {'id': 296816511, 'first_name': None, 'last_name': None, 'email': 'ziga4455@lola.com', 'customer_code': 'CUS_3maokfy2as1d6qe', 'phone': None, 'metadata': None, 'risk_action': 'default', 'international_format_phone': None}, 'plan': None, 'split': {}, 'order_id': None, 'paidAt': None, 'createdAt': '2025-08-03T16:00:00.000Z', 'requested_amount': 150000, 'pos_transaction_data': None, 'source': None, 'fees_breakdown': None, 'connect': None, 'transaction_date': '2025-08-03T16:00:00.000Z', 'plan_object': {}, 'subaccount': {'id': 1381359, 'subaccount_code': 'ACCT_u9knhyzn5eq4iop', 'business_name': 'MAKINDE VICTOR OLUWASEGUN', 'description': 'MAKINDE VICTOR OLUWASEGUN', 'primary_contact_name': None, 'primary_contact_email': None, 'primary_contact_phone': None, 'metadata': None, 'percentage_charge': 0, 'settlement_bank': 'First City Monument Bank', 'bank_id': 8, 'account_number': '4955073017', 'currency': 'NGN', 'active': True, 'is_verified': True}}}
2025-08-03 17:00:01,157 - handlers.base_handler - INFO - Payment not yet verified for order 71, attempt 1/15
2025-08-03 17:00:01,158 - handlers.base_handler - INFO - Payment link created successfully for order 71 with subaccount ACCT_u9knhyzn5eq4iop
2025-08-03 17:00:01,158 - handlers.base_handler - ERROR - Unexpected error while fetching order items for order 71: 'PaymentHandler' object has no attribute 'db_params'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\payment_handler.py", line 183, in _get_order_items_from_db
    with psycopg2.connect(**self.db_params) as conn:
                            ^^^^^^^^^^^^^^
AttributeError: 'PaymentHandler' object has no attribute 'db_params'
2025-08-03 17:00:02,236 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkU5QUQ5MDZERkEwQzkzNjFERAA="}]}
2025-08-03 17:00:02,248 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkU5QUQ5MDZERkEwQzkzNjFERAA='}]}
2025-08-03 17:00:02,248 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 17:00:02] "POST /webhook HTTP/1.1" 200 -
2025-08-03 17:00:03,216 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 17:00:03] "POST /webhook HTTP/1.1" 200 -
2025-08-03 17:00:03,529 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 17:00:03] "POST /webhook HTTP/1.1" 200 -
2025-08-03 17:00:03,638 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 17:00:03] "POST /webhook HTTP/1.1" 200 -
2025-08-03 17:01:01,168 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-71
2025-08-03 17:01:02,287 - services.payment_service - INFO - Payment verified successfully for reference PAY-71. Status: success
2025-08-03 17:01:02,289 - handlers.base_handler - INFO - Payment verified for order 71 on attempt 2
2025-08-03 17:01:02,289 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-71
2025-08-03 17:01:02,839 - services.payment_service - INFO - Payment verified successfully for reference PAY-71. Status: success
2025-08-03 17:01:06,415 - utils.data_manager - INFO - Order 71 status updated to confirmed in database
2025-08-03 17:04:25,091 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Paid'}
2025-08-03 17:04:50,342 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Paid'}
2025-08-03 17:05:15,671 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Paid'}
2025-08-03 17:05:42,403 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Paid'}
2025-08-03 17:06:31,406 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Paid'}
2025-08-03 17:14:01,270 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Paid'}
2025-08-03 17:14:07,975 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-08-03 17:14:33,043 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-08-03 17:14:58,223 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-08-03 17:15:04,686 - __main__ - INFO - Starting WhatsApp bot server...
2025-08-03 17:15:06,261 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-03 17:15:07,977 - utils.data_manager - INFO - Successfully loaded 11 user details from database
2025-08-03 17:15:08,183 - services.payment_service - INFO - PaymentService initialized
2025-08-03 17:15:09,719 - handlers.product_sync_handler - INFO - Successfully synced 15 products to data\products.json
2025-08-03 17:15:09,912 - app - INFO - Initial product sync successful on startup
2025-08-03 17:15:09,913 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-03 17:15:11,463 - utils.data_manager - INFO - Successfully loaded 11 user details from database
2025-08-03 17:15:11,654 - services.payment_service - INFO - PaymentService initialized
2025-08-03 17:15:11,655 - services.lead_tracker - INFO - LeadTracker initialized
2025-08-03 17:15:11,656 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-08-03 17:15:11,668 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-08-03 17:15:11,668 - handlers.order_handler - INFO - OrderHandler initialized.
2025-08-03 17:15:11,669 - handlers.base_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-03 17:15:11,670 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-08-03 17:15:12,359 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-08-03 17:15:12,359 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-08-03 17:15:12,359 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-08-03 17:15:12,359 - handlers.base_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-03 17:15:12,372 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-08-03 17:15:12,372 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-08-03 17:15:31,066 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-08-03 17:15:31,067 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-08-03 17:15:32,853 - handlers.base_handler - INFO - Session 2348055614455 greeted returning user 'ziga'.
2025-08-03 17:15:34,564 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkFFMDBBQUZDODgyRjk0ODFGMwA="}]}
2025-08-03 17:15:34,565 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkFFMDBBQUZDODgyRjk0ODFGMwA='}]}
2025-08-03 17:15:34,567 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 17:15:34] "POST /webhook HTTP/1.1" 200 -
2025-08-03 17:15:35,747 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 17:15:35] "POST /webhook HTTP/1.1" 200 -
2025-08-03 17:15:35,854 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 17:15:35] "POST /webhook HTTP/1.1" 200 -
2025-08-03 17:15:36,082 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 17:15:36] "POST /webhook HTTP/1.1" 200 -
2025-08-03 17:15:41,853 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-08-03 17:15:41,855 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-08-03 17:15:41,856 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-08-03 17:15:41,856 - handlers.message_processor - INFO - Session 2348055614455: Redirecting to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-08-03 17:15:41,856 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-08-03 17:15:41,856 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'image', 'image': {'link': 'https://test.mackennytutors.com/wp-content/uploads/2025/06/ganador.jpg', 'caption': 'Our Delicious Menu!'}}
2025-08-03 17:15:43,043 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkY3QjA1NkY2NzM4QkYwNEREQQA="}]}
2025-08-03 17:15:43,045 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Hi, I'm Lola from Ganador \n\nTake a look at the menu and type in your order\n\n"}}
2025-08-03 17:15:44,132 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkMyQ0Q1Qjc4NDJEQTE1NUQwMQA="}]}
2025-08-03 17:15:44,133 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkMyQ0Q1Qjc4NDJEQTE1NUQwMQA='}]}
2025-08-03 17:15:44,134 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 17:15:44] "POST /webhook HTTP/1.1" 200 -
2025-08-03 17:15:44,866 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 17:15:44] "POST /webhook HTTP/1.1" 200 -
2025-08-03 17:15:45,435 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 17:15:45] "POST /webhook HTTP/1.1" 200 -
2025-08-03 17:15:45,475 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 17:15:45] "POST /webhook HTTP/1.1" 200 -
2025-08-03 17:15:45,555 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 17:15:45] "POST /webhook HTTP/1.1" 200 -
2025-08-03 17:15:45,896 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 17:15:45] "POST /webhook HTTP/1.1" 200 -
2025-08-03 17:15:46,235 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 17:15:46] "POST /webhook HTTP/1.1" 200 -
2025-08-03 17:21:15,699 - __main__ - INFO - Starting WhatsApp bot server...
2025-08-03 17:21:17,599 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-03 17:21:20,082 - utils.data_manager - INFO - Successfully loaded 11 user details from database
2025-08-03 17:21:20,283 - services.payment_service - INFO - PaymentService initialized
2025-08-03 17:21:22,437 - handlers.product_sync_handler - INFO - Successfully synced 15 products to data\products.json
2025-08-03 17:21:22,739 - app - INFO - Initial product sync successful on startup
2025-08-03 17:21:22,740 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-03 17:21:24,572 - utils.data_manager - INFO - Successfully loaded 11 user details from database
2025-08-03 17:21:24,765 - services.payment_service - INFO - PaymentService initialized
2025-08-03 17:21:24,765 - services.lead_tracker - INFO - LeadTracker initialized
2025-08-03 17:21:24,766 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-08-03 17:21:24,768 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-08-03 17:21:24,768 - handlers.order_handler - INFO - OrderHandler initialized.
2025-08-03 17:21:24,768 - handlers.base_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-03 17:21:24,769 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-08-03 17:21:25,777 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-08-03 17:21:25,777 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-08-03 17:21:25,778 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-08-03 17:21:25,779 - handlers.base_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-03 17:21:25,799 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-08-03 17:21:25,800 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-08-03 17:29:43,440 - __main__ - INFO - Starting WhatsApp bot server...
2025-08-03 17:29:45,387 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-03 17:29:47,985 - utils.data_manager - INFO - Successfully loaded 11 user details from database
2025-08-03 17:29:48,188 - services.payment_service - INFO - PaymentService initialized
2025-08-03 17:29:49,973 - handlers.product_sync_handler - INFO - Successfully synced 15 products to data\products.json
2025-08-03 17:29:50,170 - app - INFO - Initial product sync successful on startup
2025-08-03 17:29:50,171 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-03 17:29:53,312 - utils.data_manager - INFO - Successfully loaded 11 user details from database
2025-08-03 17:29:53,514 - services.payment_service - INFO - PaymentService initialized
2025-08-03 17:29:53,515 - services.lead_tracker - INFO - LeadTracker initialized
2025-08-03 17:29:53,516 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-08-03 17:29:53,517 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-08-03 17:29:53,517 - handlers.order_handler - INFO - OrderHandler initialized.
2025-08-03 17:29:53,518 - handlers.base_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-03 17:29:53,518 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-08-03 17:29:54,167 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-08-03 17:29:54,168 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-08-03 17:29:54,168 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-08-03 17:29:54,169 - handlers.base_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-03 17:29:54,190 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-08-03 17:29:54,191 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-08-03 17:29:55,620 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-08-03 17:29:55,620 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-08-03 17:29:57,685 - handlers.base_handler - INFO - Session 2348055614455 greeted returning user 'ziga'.
2025-08-03 17:29:58,813 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkJGRThBQkRCQTc5QkM0QzNGRQA="}]}
2025-08-03 17:29:58,814 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkJGRThBQkRCQTc5QkM0QzNGRQA='}]}
2025-08-03 17:29:58,817 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 17:29:58] "POST /webhook HTTP/1.1" 200 -
2025-08-03 17:30:00,074 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 17:30:00] "POST /webhook HTTP/1.1" 200 -
2025-08-03 17:30:00,370 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 17:30:00] "POST /webhook HTTP/1.1" 200 -
2025-08-03 17:30:00,707 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 17:30:00] "POST /webhook HTTP/1.1" 200 -
2025-08-03 17:31:08,299 - __main__ - INFO - Starting WhatsApp bot server...
2025-08-03 17:31:10,088 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-03 17:31:12,101 - utils.data_manager - INFO - Successfully loaded 11 user details from database
2025-08-03 17:31:12,292 - services.payment_service - INFO - PaymentService initialized
2025-08-03 17:31:14,318 - handlers.product_sync_handler - INFO - Successfully synced 15 products to data\products.json
2025-08-03 17:31:14,621 - app - INFO - Initial product sync successful on startup
2025-08-03 17:31:14,622 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-03 17:31:16,450 - utils.data_manager - INFO - Successfully loaded 11 user details from database
2025-08-03 17:31:16,666 - services.payment_service - INFO - PaymentService initialized
2025-08-03 17:31:16,667 - services.lead_tracker - INFO - LeadTracker initialized
2025-08-03 17:31:16,668 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-08-03 17:31:16,670 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-08-03 17:31:16,671 - handlers.order_handler - INFO - OrderHandler initialized.
2025-08-03 17:31:16,672 - handlers.base_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-03 17:31:16,673 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-08-03 17:31:17,402 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-08-03 17:31:17,403 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-08-03 17:31:17,403 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-08-03 17:31:17,404 - handlers.base_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-03 17:31:17,421 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-08-03 17:31:17,422 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-08-03 17:31:19,563 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-08-03 17:31:19,564 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-08-03 17:31:21,580 - handlers.base_handler - INFO - Session 2348055614455 greeted returning user 'ziga'.
2025-08-03 17:31:22,912 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjcyNDAxRjlDMzQ3QzJDQzMzMgA="}]}
2025-08-03 17:31:22,924 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjcyNDAxRjlDMzQ3QzJDQzMzMgA='}]}
2025-08-03 17:31:22,926 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 17:31:22] "POST /webhook HTTP/1.1" 200 -
2025-08-03 17:31:23,943 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 17:31:23] "POST /webhook HTTP/1.1" 200 -
2025-08-03 17:31:24,262 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 17:31:24] "POST /webhook HTTP/1.1" 200 -
2025-08-03 17:31:24,565 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 17:31:24] "POST /webhook HTTP/1.1" 200 -
2025-08-03 17:36:21,010 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-08-03 17:36:21,012 - handlers.base_handler - INFO - GreetingHandler: Handling message 'hello' in greeting state for session 2348055614455.
2025-08-03 17:36:21,012 - handlers.base_handler - WARNING - Session 2348055614455: Invalid option 'hello' in greeting state for non-paid user.
2025-08-03 17:36:22,299 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjg3MjhFMDNGMjIxOTkxNUQ0QgA="}]}
2025-08-03 17:36:22,300 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjg3MjhFMDNGMjIxOTkxNUQ0QgA='}]}
2025-08-03 17:36:22,301 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 17:36:22] "POST /webhook HTTP/1.1" 200 -
2025-08-03 17:36:23,480 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 17:36:23] "POST /webhook HTTP/1.1" 200 -
2025-08-03 17:36:23,952 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 17:36:23] "POST /webhook HTTP/1.1" 200 -
2025-08-03 17:36:54,897 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 17:36:54] "POST /webhook HTTP/1.1" 200 -
2025-08-03 17:39:41,895 - __main__ - INFO - Starting WhatsApp bot server...
2025-08-03 17:39:43,074 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-03 17:39:44,758 - utils.data_manager - INFO - Successfully loaded 11 user details from database
2025-08-03 17:39:44,949 - services.payment_service - INFO - PaymentService initialized
2025-08-03 17:39:46,470 - handlers.product_sync_handler - INFO - Successfully synced 15 products to data\products.json
2025-08-03 17:39:46,668 - app - INFO - Initial product sync successful on startup
2025-08-03 17:39:46,669 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-03 17:39:48,167 - utils.data_manager - INFO - Successfully loaded 11 user details from database
2025-08-03 17:39:48,363 - services.payment_service - INFO - PaymentService initialized
2025-08-03 17:39:48,363 - services.lead_tracker - INFO - LeadTracker initialized
2025-08-03 17:39:48,363 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-08-03 17:39:48,364 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-08-03 17:39:48,365 - handlers.order_handler - INFO - OrderHandler initialized.
2025-08-03 17:39:48,365 - handlers.base_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-03 17:39:48,365 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-08-03 17:39:48,761 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-08-03 17:39:48,761 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-08-03 17:39:48,762 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-08-03 17:39:48,762 - handlers.base_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-03 17:39:48,773 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-08-03 17:39:48,773 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-08-03 17:39:51,100 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-08-03 17:39:51,101 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-08-03 17:39:52,839 - handlers.base_handler - INFO - Session 2348055614455 greeted returning user 'ziga'.
2025-08-03 17:39:54,680 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjA0RjhFMjIyRkM5QTE0NkVBNwA="}]}
2025-08-03 17:39:54,680 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjA0RjhFMjIyRkM5QTE0NkVBNwA='}]}
2025-08-03 17:39:54,681 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 17:39:54] "POST /webhook HTTP/1.1" 200 -
2025-08-03 17:39:55,633 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 17:39:55] "POST /webhook HTTP/1.1" 200 -
2025-08-03 17:39:56,005 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 17:39:56] "POST /webhook HTTP/1.1" 200 -
2025-08-03 17:39:56,415 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 17:39:56] "POST /webhook HTTP/1.1" 200 -
2025-08-03 17:41:04,249 - __main__ - INFO - Starting WhatsApp bot server...
2025-08-03 17:41:05,551 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-03 17:41:07,108 - utils.data_manager - INFO - Successfully loaded 11 user details from database
2025-08-03 17:41:07,299 - services.payment_service - INFO - PaymentService initialized
2025-08-03 17:41:08,840 - handlers.product_sync_handler - INFO - Successfully synced 15 products to data\products.json
2025-08-03 17:41:09,039 - app - INFO - Initial product sync successful on startup
2025-08-03 17:41:09,040 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-03 17:41:10,608 - utils.data_manager - INFO - Successfully loaded 11 user details from database
2025-08-03 17:41:10,799 - services.payment_service - INFO - PaymentService initialized
2025-08-03 17:41:10,800 - services.lead_tracker - INFO - LeadTracker initialized
2025-08-03 17:41:10,800 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-08-03 17:41:10,801 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-08-03 17:41:10,801 - handlers.order_handler - INFO - OrderHandler initialized.
2025-08-03 17:41:10,802 - handlers.base_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-03 17:41:10,802 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-08-03 17:41:11,179 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-08-03 17:41:11,179 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-08-03 17:41:11,180 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-08-03 17:41:11,180 - handlers.base_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-03 17:41:11,191 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-08-03 17:41:11,191 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-08-03 17:41:12,380 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-08-03 17:41:12,380 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-08-03 17:41:14,128 - handlers.base_handler - INFO - Session 2348055614455 greeted returning user 'ziga'.
2025-08-03 17:41:15,289 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkIzMjMzQjNEQjg3NzI0QTU4MQA="}]}
2025-08-03 17:41:15,290 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkIzMjMzQjNEQjg3NzI0QTU4MQA='}]}
2025-08-03 17:41:15,291 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 17:41:15] "POST /webhook HTTP/1.1" 200 -
2025-08-03 17:41:16,338 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 17:41:16] "POST /webhook HTTP/1.1" 200 -
2025-08-03 17:41:16,671 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 17:41:16] "POST /webhook HTTP/1.1" 200 -
2025-08-03 17:41:16,969 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 17:41:16] "POST /webhook HTTP/1.1" 200 -
2025-08-03 17:45:58,421 - __main__ - INFO - Starting WhatsApp bot server...
2025-08-03 17:45:59,812 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-03 17:46:01,497 - utils.data_manager - INFO - Successfully loaded 11 user details from database
2025-08-03 17:46:02,109 - services.payment_service - INFO - PaymentService initialized
2025-08-03 17:46:03,649 - handlers.product_sync_handler - INFO - Successfully synced 15 products to data\products.json
2025-08-03 17:46:03,838 - app - INFO - Initial product sync successful on startup
2025-08-03 17:46:03,838 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-03 17:46:05,429 - utils.data_manager - INFO - Successfully loaded 11 user details from database
2025-08-03 17:46:05,629 - services.payment_service - INFO - PaymentService initialized
2025-08-03 17:46:05,629 - services.lead_tracker - INFO - LeadTracker initialized
2025-08-03 17:46:05,629 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-08-03 17:46:05,630 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-08-03 17:46:05,631 - handlers.order_handler - INFO - OrderHandler initialized.
2025-08-03 17:46:05,631 - handlers.base_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-03 17:46:05,631 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-08-03 17:46:06,047 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-08-03 17:46:06,047 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-08-03 17:46:06,047 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-08-03 17:46:06,048 - handlers.base_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-03 17:46:06,060 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-08-03 17:46:06,060 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-08-03 17:46:08,159 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-08-03 17:46:08,159 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-08-03 17:46:09,897 - handlers.base_handler - INFO - Session 2348055614455: New user or missing details. Initiating onboarding.
2025-08-03 17:46:09,898 - handlers.message_processor - ERROR - Session 2348055614455: Error in message routing for handler 'greeting_handler', state 'start': 'WhatsAppService' object has no attribute 'create_image_message'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\message_processor.py", line 185, in _route_to_handler
    response = self.greeting_handler.generate_initial_greeting(state, session_id, user_name)
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\greeting_handler.py", line 137, in generate_initial_greeting
    return self.whatsapp_service.create_image_message(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WhatsAppService' object has no attribute 'create_image_message'. Did you mean: 'create_list_message'?
2025-08-03 17:46:09,911 - handlers.message_processor - ERROR - Session 2348055614455: Error processing message: 'WhatsAppService' object has no attribute 'create_image_message'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\message_processor.py", line 185, in _route_to_handler
    response = self.greeting_handler.generate_initial_greeting(state, session_id, user_name)
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\greeting_handler.py", line 137, in generate_initial_greeting
    return self.whatsapp_service.create_image_message(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WhatsAppService' object has no attribute 'create_image_message'. Did you mean: 'create_list_message'?

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\message_processor.py", line 103, in process_message
    response = self._route_to_handler(state, message, original_message, session_id, user_name)
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\message_processor.py", line 325, in _route_to_handler
    return self.whatsapp_service.create_image_message(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WhatsAppService' object has no attribute 'create_image_message'. Did you mean: 'create_list_message'?
2025-08-03 17:46:09,914 - handlers.webhook_handler - ERROR - Error processing webhook: 'WhatsAppService' object has no attribute 'create_image_message'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\message_processor.py", line 185, in _route_to_handler
    response = self.greeting_handler.generate_initial_greeting(state, session_id, user_name)
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\greeting_handler.py", line 137, in generate_initial_greeting
    return self.whatsapp_service.create_image_message(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WhatsAppService' object has no attribute 'create_image_message'. Did you mean: 'create_list_message'?

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\message_processor.py", line 103, in process_message
    response = self._route_to_handler(state, message, original_message, session_id, user_name)
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\message_processor.py", line 325, in _route_to_handler
    return self.whatsapp_service.create_image_message(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WhatsAppService' object has no attribute 'create_image_message'. Did you mean: 'create_list_message'?

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\webhook_handler.py", line 80, in handle_webhook
    response_payload = self.message_processor.process_message(message_data, phone_number, user_name)
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\message_processor.py", line 117, in process_message
    return self.whatsapp_service.create_image_message(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WhatsAppService' object has no attribute 'create_image_message'. Did you mean: 'create_list_message'?
2025-08-03 17:46:09,919 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 17:46:09] "[35m[1mPOST /webhook HTTP/1.1[0m" 500 -
2025-08-03 17:46:10,498 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-08-03 17:46:10,502 - handlers.base_handler - INFO - GreetingHandler: Handling message 'hello' in greeting state for session 2348055614455.
2025-08-03 17:46:10,503 - handlers.base_handler - WARNING - Session 2348055614455: Invalid option 'hello' in greeting state.
2025-08-03 17:46:10,504 - handlers.message_processor - ERROR - Session 2348055614455: Error in message routing for handler 'greeting_handler', state 'greeting': 'WhatsAppService' object has no attribute 'create_image_message'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\message_processor.py", line 191, in _route_to_handler
    response = self.greeting_handler.handle_greeting_state(state, message, original_message, session_id)
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\greeting_handler.py", line 47, in handle_greeting_state
    return self._handle_invalid_option(state, session_id, message)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\greeting_handler.py", line 110, in _handle_invalid_option
    return self.send_main_menu(
           ~~~~~~~~~~~~~~~~~~~^
        session_id,
        ^^^^^^^^^^^
    ...<2 lines>...
        image_url="https://www.pexels.com/photo/person-holding-pastry-dishes-on-white-ceramic-plates-262978/"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\base_handler.py", line 50, in send_main_menu
    return self.whatsapp_service.create_image_message(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WhatsAppService' object has no attribute 'create_image_message'. Did you mean: 'create_list_message'?
2025-08-03 17:46:10,508 - handlers.message_processor - ERROR - Session 2348055614455: Error processing message: 'WhatsAppService' object has no attribute 'create_image_message'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\message_processor.py", line 191, in _route_to_handler
    response = self.greeting_handler.handle_greeting_state(state, message, original_message, session_id)
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\greeting_handler.py", line 47, in handle_greeting_state
    return self._handle_invalid_option(state, session_id, message)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\greeting_handler.py", line 110, in _handle_invalid_option
    return self.send_main_menu(
           ~~~~~~~~~~~~~~~~~~~^
        session_id,
        ^^^^^^^^^^^
    ...<2 lines>...
        image_url="https://www.pexels.com/photo/person-holding-pastry-dishes-on-white-ceramic-plates-262978/"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\base_handler.py", line 50, in send_main_menu
    return self.whatsapp_service.create_image_message(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WhatsAppService' object has no attribute 'create_image_message'. Did you mean: 'create_list_message'?

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\message_processor.py", line 103, in process_message
    response = self._route_to_handler(state, message, original_message, session_id, user_name)
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\message_processor.py", line 325, in _route_to_handler
    return self.whatsapp_service.create_image_message(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WhatsAppService' object has no attribute 'create_image_message'. Did you mean: 'create_list_message'?
2025-08-03 17:46:10,513 - handlers.webhook_handler - ERROR - Error processing webhook: 'WhatsAppService' object has no attribute 'create_image_message'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\message_processor.py", line 191, in _route_to_handler
    response = self.greeting_handler.handle_greeting_state(state, message, original_message, session_id)
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\greeting_handler.py", line 47, in handle_greeting_state
    return self._handle_invalid_option(state, session_id, message)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\greeting_handler.py", line 110, in _handle_invalid_option
    return self.send_main_menu(
           ~~~~~~~~~~~~~~~~~~~^
        session_id,
        ^^^^^^^^^^^
    ...<2 lines>...
        image_url="https://www.pexels.com/photo/person-holding-pastry-dishes-on-white-ceramic-plates-262978/"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\base_handler.py", line 50, in send_main_menu
    return self.whatsapp_service.create_image_message(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WhatsAppService' object has no attribute 'create_image_message'. Did you mean: 'create_list_message'?

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\message_processor.py", line 103, in process_message
    response = self._route_to_handler(state, message, original_message, session_id, user_name)
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\message_processor.py", line 325, in _route_to_handler
    return self.whatsapp_service.create_image_message(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WhatsAppService' object has no attribute 'create_image_message'. Did you mean: 'create_list_message'?

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\webhook_handler.py", line 80, in handle_webhook
    response_payload = self.message_processor.process_message(message_data, phone_number, user_name)
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\message_processor.py", line 117, in process_message
    return self.whatsapp_service.create_image_message(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WhatsAppService' object has no attribute 'create_image_message'. Did you mean: 'create_list_message'?
2025-08-03 17:46:10,519 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 17:46:10] "[35m[1mPOST /webhook HTTP/1.1[0m" 500 -
2025-08-03 17:46:11,171 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-08-03 17:46:11,173 - handlers.base_handler - INFO - GreetingHandler: Handling message 'hello' in greeting state for session 2348055614455.
2025-08-03 17:46:11,174 - handlers.base_handler - WARNING - Session 2348055614455: Invalid option 'hello' in greeting state.
2025-08-03 17:46:11,174 - handlers.message_processor - ERROR - Session 2348055614455: Error in message routing for handler 'greeting_handler', state 'greeting': 'WhatsAppService' object has no attribute 'create_image_message'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\message_processor.py", line 191, in _route_to_handler
    response = self.greeting_handler.handle_greeting_state(state, message, original_message, session_id)
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\greeting_handler.py", line 47, in handle_greeting_state
    return self._handle_invalid_option(state, session_id, message)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\greeting_handler.py", line 110, in _handle_invalid_option
    return self.send_main_menu(
           ~~~~~~~~~~~~~~~~~~~^
        session_id,
        ^^^^^^^^^^^
    ...<2 lines>...
        image_url="https://www.pexels.com/photo/person-holding-pastry-dishes-on-white-ceramic-plates-262978/"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\base_handler.py", line 50, in send_main_menu
    return self.whatsapp_service.create_image_message(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WhatsAppService' object has no attribute 'create_image_message'. Did you mean: 'create_list_message'?
2025-08-03 17:46:11,176 - handlers.message_processor - ERROR - Session 2348055614455: Error processing message: 'WhatsAppService' object has no attribute 'create_image_message'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\message_processor.py", line 191, in _route_to_handler
    response = self.greeting_handler.handle_greeting_state(state, message, original_message, session_id)
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\greeting_handler.py", line 47, in handle_greeting_state
    return self._handle_invalid_option(state, session_id, message)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\greeting_handler.py", line 110, in _handle_invalid_option
    return self.send_main_menu(
           ~~~~~~~~~~~~~~~~~~~^
        session_id,
        ^^^^^^^^^^^
    ...<2 lines>...
        image_url="https://www.pexels.com/photo/person-holding-pastry-dishes-on-white-ceramic-plates-262978/"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\base_handler.py", line 50, in send_main_menu
    return self.whatsapp_service.create_image_message(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WhatsAppService' object has no attribute 'create_image_message'. Did you mean: 'create_list_message'?

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\message_processor.py", line 103, in process_message
    response = self._route_to_handler(state, message, original_message, session_id, user_name)
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\message_processor.py", line 325, in _route_to_handler
    return self.whatsapp_service.create_image_message(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WhatsAppService' object has no attribute 'create_image_message'. Did you mean: 'create_list_message'?
2025-08-03 17:46:11,181 - handlers.webhook_handler - ERROR - Error processing webhook: 'WhatsAppService' object has no attribute 'create_image_message'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\message_processor.py", line 191, in _route_to_handler
    response = self.greeting_handler.handle_greeting_state(state, message, original_message, session_id)
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\greeting_handler.py", line 47, in handle_greeting_state
    return self._handle_invalid_option(state, session_id, message)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\greeting_handler.py", line 110, in _handle_invalid_option
    return self.send_main_menu(
           ~~~~~~~~~~~~~~~~~~~^
        session_id,
        ^^^^^^^^^^^
    ...<2 lines>...
        image_url="https://www.pexels.com/photo/person-holding-pastry-dishes-on-white-ceramic-plates-262978/"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\base_handler.py", line 50, in send_main_menu
    return self.whatsapp_service.create_image_message(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WhatsAppService' object has no attribute 'create_image_message'. Did you mean: 'create_list_message'?

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\message_processor.py", line 103, in process_message
    response = self._route_to_handler(state, message, original_message, session_id, user_name)
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\message_processor.py", line 325, in _route_to_handler
    return self.whatsapp_service.create_image_message(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WhatsAppService' object has no attribute 'create_image_message'. Did you mean: 'create_list_message'?

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\webhook_handler.py", line 80, in handle_webhook
    response_payload = self.message_processor.process_message(message_data, phone_number, user_name)
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\message_processor.py", line 117, in process_message
    return self.whatsapp_service.create_image_message(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WhatsAppService' object has no attribute 'create_image_message'. Did you mean: 'create_list_message'?
2025-08-03 17:46:11,186 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 17:46:11] "[35m[1mPOST /webhook HTTP/1.1[0m" 500 -
2025-08-03 17:46:13,313 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-08-03 17:46:13,316 - handlers.base_handler - INFO - GreetingHandler: Handling message 'hello' in greeting state for session 2348055614455.
2025-08-03 17:46:13,316 - handlers.base_handler - WARNING - Session 2348055614455: Invalid option 'hello' in greeting state.
2025-08-03 17:46:13,317 - handlers.message_processor - ERROR - Session 2348055614455: Error in message routing for handler 'greeting_handler', state 'greeting': 'WhatsAppService' object has no attribute 'create_image_message'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\message_processor.py", line 191, in _route_to_handler
    response = self.greeting_handler.handle_greeting_state(state, message, original_message, session_id)
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\greeting_handler.py", line 47, in handle_greeting_state
    return self._handle_invalid_option(state, session_id, message)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\greeting_handler.py", line 110, in _handle_invalid_option
    return self.send_main_menu(
           ~~~~~~~~~~~~~~~~~~~^
        session_id,
        ^^^^^^^^^^^
    ...<2 lines>...
        image_url="https://www.pexels.com/photo/person-holding-pastry-dishes-on-white-ceramic-plates-262978/"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\base_handler.py", line 50, in send_main_menu
    return self.whatsapp_service.create_image_message(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WhatsAppService' object has no attribute 'create_image_message'. Did you mean: 'create_list_message'?
2025-08-03 17:46:13,319 - handlers.message_processor - ERROR - Session 2348055614455: Error processing message: 'WhatsAppService' object has no attribute 'create_image_message'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\message_processor.py", line 191, in _route_to_handler
    response = self.greeting_handler.handle_greeting_state(state, message, original_message, session_id)
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\greeting_handler.py", line 47, in handle_greeting_state
    return self._handle_invalid_option(state, session_id, message)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\greeting_handler.py", line 110, in _handle_invalid_option
    return self.send_main_menu(
           ~~~~~~~~~~~~~~~~~~~^
        session_id,
        ^^^^^^^^^^^
    ...<2 lines>...
        image_url="https://www.pexels.com/photo/person-holding-pastry-dishes-on-white-ceramic-plates-262978/"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\base_handler.py", line 50, in send_main_menu
    return self.whatsapp_service.create_image_message(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WhatsAppService' object has no attribute 'create_image_message'. Did you mean: 'create_list_message'?

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\message_processor.py", line 103, in process_message
    response = self._route_to_handler(state, message, original_message, session_id, user_name)
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\message_processor.py", line 325, in _route_to_handler
    return self.whatsapp_service.create_image_message(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WhatsAppService' object has no attribute 'create_image_message'. Did you mean: 'create_list_message'?
2025-08-03 17:46:13,323 - handlers.webhook_handler - ERROR - Error processing webhook: 'WhatsAppService' object has no attribute 'create_image_message'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\message_processor.py", line 191, in _route_to_handler
    response = self.greeting_handler.handle_greeting_state(state, message, original_message, session_id)
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\greeting_handler.py", line 47, in handle_greeting_state
    return self._handle_invalid_option(state, session_id, message)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\greeting_handler.py", line 110, in _handle_invalid_option
    return self.send_main_menu(
           ~~~~~~~~~~~~~~~~~~~^
        session_id,
        ^^^^^^^^^^^
    ...<2 lines>...
        image_url="https://www.pexels.com/photo/person-holding-pastry-dishes-on-white-ceramic-plates-262978/"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\base_handler.py", line 50, in send_main_menu
    return self.whatsapp_service.create_image_message(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WhatsAppService' object has no attribute 'create_image_message'. Did you mean: 'create_list_message'?

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\message_processor.py", line 103, in process_message
    response = self._route_to_handler(state, message, original_message, session_id, user_name)
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\message_processor.py", line 325, in _route_to_handler
    return self.whatsapp_service.create_image_message(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WhatsAppService' object has no attribute 'create_image_message'. Did you mean: 'create_list_message'?

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\webhook_handler.py", line 80, in handle_webhook
    response_payload = self.message_processor.process_message(message_data, phone_number, user_name)
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\message_processor.py", line 117, in process_message
    return self.whatsapp_service.create_image_message(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WhatsAppService' object has no attribute 'create_image_message'. Did you mean: 'create_list_message'?
2025-08-03 17:46:13,328 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 17:46:13] "[35m[1mPOST /webhook HTTP/1.1[0m" 500 -
2025-08-03 17:46:37,468 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-08-03 17:46:37,472 - handlers.base_handler - INFO - GreetingHandler: Handling message 'hello' in greeting state for session 2348055614455.
2025-08-03 17:46:37,474 - handlers.base_handler - WARNING - Session 2348055614455: Invalid option 'hello' in greeting state.
2025-08-03 17:46:37,474 - handlers.message_processor - ERROR - Session 2348055614455: Error in message routing for handler 'greeting_handler', state 'greeting': 'WhatsAppService' object has no attribute 'create_image_message'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\message_processor.py", line 191, in _route_to_handler
    response = self.greeting_handler.handle_greeting_state(state, message, original_message, session_id)
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\greeting_handler.py", line 47, in handle_greeting_state
    return self._handle_invalid_option(state, session_id, message)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\greeting_handler.py", line 110, in _handle_invalid_option
    return self.send_main_menu(
           ~~~~~~~~~~~~~~~~~~~^
        session_id,
        ^^^^^^^^^^^
    ...<2 lines>...
        image_url="https://www.pexels.com/photo/person-holding-pastry-dishes-on-white-ceramic-plates-262978/"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\base_handler.py", line 50, in send_main_menu
    return self.whatsapp_service.create_image_message(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WhatsAppService' object has no attribute 'create_image_message'. Did you mean: 'create_list_message'?
2025-08-03 17:46:37,477 - handlers.message_processor - ERROR - Session 2348055614455: Error processing message: 'WhatsAppService' object has no attribute 'create_image_message'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\message_processor.py", line 191, in _route_to_handler
    response = self.greeting_handler.handle_greeting_state(state, message, original_message, session_id)
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\greeting_handler.py", line 47, in handle_greeting_state
    return self._handle_invalid_option(state, session_id, message)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\greeting_handler.py", line 110, in _handle_invalid_option
    return self.send_main_menu(
           ~~~~~~~~~~~~~~~~~~~^
        session_id,
        ^^^^^^^^^^^
    ...<2 lines>...
        image_url="https://www.pexels.com/photo/person-holding-pastry-dishes-on-white-ceramic-plates-262978/"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\base_handler.py", line 50, in send_main_menu
    return self.whatsapp_service.create_image_message(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WhatsAppService' object has no attribute 'create_image_message'. Did you mean: 'create_list_message'?

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\message_processor.py", line 103, in process_message
    response = self._route_to_handler(state, message, original_message, session_id, user_name)
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\message_processor.py", line 325, in _route_to_handler
    return self.whatsapp_service.create_image_message(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WhatsAppService' object has no attribute 'create_image_message'. Did you mean: 'create_list_message'?
2025-08-03 17:46:37,481 - handlers.webhook_handler - ERROR - Error processing webhook: 'WhatsAppService' object has no attribute 'create_image_message'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\message_processor.py", line 191, in _route_to_handler
    response = self.greeting_handler.handle_greeting_state(state, message, original_message, session_id)
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\greeting_handler.py", line 47, in handle_greeting_state
    return self._handle_invalid_option(state, session_id, message)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\greeting_handler.py", line 110, in _handle_invalid_option
    return self.send_main_menu(
           ~~~~~~~~~~~~~~~~~~~^
        session_id,
        ^^^^^^^^^^^
    ...<2 lines>...
        image_url="https://www.pexels.com/photo/person-holding-pastry-dishes-on-white-ceramic-plates-262978/"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\base_handler.py", line 50, in send_main_menu
    return self.whatsapp_service.create_image_message(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WhatsAppService' object has no attribute 'create_image_message'. Did you mean: 'create_list_message'?

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\message_processor.py", line 103, in process_message
    response = self._route_to_handler(state, message, original_message, session_id, user_name)
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\message_processor.py", line 325, in _route_to_handler
    return self.whatsapp_service.create_image_message(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WhatsAppService' object has no attribute 'create_image_message'. Did you mean: 'create_list_message'?

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\webhook_handler.py", line 80, in handle_webhook
    response_payload = self.message_processor.process_message(message_data, phone_number, user_name)
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\message_processor.py", line 117, in process_message
    return self.whatsapp_service.create_image_message(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WhatsAppService' object has no attribute 'create_image_message'. Did you mean: 'create_list_message'?
2025-08-03 17:46:37,489 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 17:46:37] "[35m[1mPOST /webhook HTTP/1.1[0m" 500 -
2025-08-03 17:52:48,820 - __main__ - INFO - Starting WhatsApp bot server...
2025-08-03 17:52:50,063 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-03 17:52:52,186 - utils.data_manager - INFO - Successfully loaded 11 user details from database
2025-08-03 17:52:52,376 - services.payment_service - INFO - PaymentService initialized
2025-08-03 17:52:53,969 - handlers.product_sync_handler - INFO - Successfully synced 15 products to data\products.json
2025-08-03 17:52:54,166 - app - INFO - Initial product sync successful on startup
2025-08-03 17:52:54,166 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-03 17:52:55,727 - utils.data_manager - INFO - Successfully loaded 11 user details from database
2025-08-03 17:52:55,917 - services.payment_service - INFO - PaymentService initialized
2025-08-03 17:52:55,918 - services.lead_tracker - INFO - LeadTracker initialized
2025-08-03 17:52:55,918 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-08-03 17:52:55,919 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-08-03 17:52:55,919 - handlers.order_handler - INFO - OrderHandler initialized.
2025-08-03 17:52:55,919 - handlers.base_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-03 17:52:55,920 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-08-03 17:52:56,333 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-08-03 17:52:56,334 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-08-03 17:52:56,334 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-08-03 17:52:56,334 - handlers.base_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-03 17:52:56,345 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-08-03 17:52:56,345 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-08-03 17:53:00,657 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-08-03 17:53:00,657 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-08-03 17:53:02,848 - handlers.base_handler - INFO - Session 2348055614455: New user or missing details. Initiating onboarding.
2025-08-03 17:53:04,156 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjIyOUY5N0M0MTRDRjkxMTgxNwA="}]}
2025-08-03 17:53:04,157 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjIyOUY5N0M0MTRDRjkxMTgxNwA='}]}
2025-08-03 17:53:04,158 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 17:53:04] "POST /webhook HTTP/1.1" 200 -
2025-08-03 17:53:05,327 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 17:53:05] "POST /webhook HTTP/1.1" 200 -
2025-08-03 17:53:30,907 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-08-03 17:53:30,909 - handlers.base_handler - INFO - Session 2348055614455: Preferred name received: 'Hello'.
2025-08-03 17:53:32,655 - utils.data_manager - INFO - User details for 2348055614455 saved to database
2025-08-03 17:53:32,656 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': 'Thanks, Hello! Now, please enter your delivery address.'}}
2025-08-03 17:53:33,737 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkFEMjQwNzMzMUIzQ0VGRkQ5QgA="}]}
2025-08-03 17:53:33,737 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkFEMjQwNzMzMUIzQ0VGRkQ5QgA='}]}
2025-08-03 17:53:33,738 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 17:53:33] "POST /webhook HTTP/1.1" 200 -
2025-08-03 17:53:35,048 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 17:53:35] "POST /webhook HTTP/1.1" 200 -
2025-08-03 17:53:35,165 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 17:53:35] "POST /webhook HTTP/1.1" 200 -
2025-08-03 17:53:35,648 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 17:53:35] "POST /webhook HTTP/1.1" 200 -
2025-08-03 17:54:47,187 - __main__ - INFO - Starting WhatsApp bot server...
2025-08-03 17:54:48,501 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-03 17:54:50,046 - utils.data_manager - INFO - Successfully loaded 11 user details from database
2025-08-03 17:54:50,236 - services.payment_service - INFO - PaymentService initialized
2025-08-03 17:54:51,837 - handlers.product_sync_handler - INFO - Successfully synced 15 products to data\products.json
2025-08-03 17:54:52,035 - app - INFO - Initial product sync successful on startup
2025-08-03 17:54:52,036 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-03 17:54:53,536 - utils.data_manager - INFO - Successfully loaded 11 user details from database
2025-08-03 17:54:53,726 - services.payment_service - INFO - PaymentService initialized
2025-08-03 17:54:53,726 - services.lead_tracker - INFO - LeadTracker initialized
2025-08-03 17:54:53,727 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-08-03 17:54:53,727 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-08-03 17:54:53,728 - handlers.order_handler - INFO - OrderHandler initialized.
2025-08-03 17:54:53,728 - handlers.base_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-03 17:54:53,728 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-08-03 17:54:54,109 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-08-03 17:54:54,109 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-08-03 17:54:54,109 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-08-03 17:54:54,110 - handlers.base_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-03 17:54:54,120 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-08-03 17:54:54,120 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-08-03 17:54:57,013 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-08-03 17:54:57,013 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-08-03 17:54:58,747 - handlers.base_handler - INFO - Session 2348055614455: New user or missing details. Initiating onboarding.
2025-08-03 17:54:59,576 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 400 Client Error: Bad Request for url: https://graph.facebook.com/v17.0/204426689424598/messages - {"error":{"message":"(#131008) Required parameter is missing","type":"OAuthException","code":131008,"error_data":{"messaging_product":"whatsapp","details":"action['name'] is required for catalog_message message."},"fbtrace_id":"AHyHDhO0iOyI_Pa1ECIUbjQ"}}
2025-08-03 17:54:59,577 - handlers.message_processor - WARNING - Session 2348055614455: No handler response for handler 'greeting_handler', state 'start', message 'hello'. Resetting to greeting.
2025-08-03 17:54:59,577 - handlers.base_handler - INFO - Session 2348055614455: New user or missing details. Initiating onboarding.
2025-08-03 17:55:00,446 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 400 Client Error: Bad Request for url: https://graph.facebook.com/v17.0/204426689424598/messages - {"error":{"message":"(#131008) Required parameter is missing","type":"OAuthException","code":131008,"error_data":{"messaging_product":"whatsapp","details":"action['name'] is required for catalog_message message."},"fbtrace_id":"AFnf9d82XjwsNzqqSJSBzko"}}
2025-08-03 17:55:00,447 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 17:55:00] "POST /webhook HTTP/1.1" 200 -
2025-08-03 17:56:19,997 - __main__ - INFO - Starting WhatsApp bot server...
2025-08-03 17:56:21,096 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-03 17:56:22,717 - utils.data_manager - INFO - Successfully loaded 11 user details from database
2025-08-03 17:56:22,926 - services.payment_service - INFO - PaymentService initialized
2025-08-03 17:56:24,467 - handlers.product_sync_handler - INFO - Successfully synced 15 products to data\products.json
2025-08-03 17:56:24,656 - app - INFO - Initial product sync successful on startup
2025-08-03 17:56:24,656 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-03 17:56:26,185 - utils.data_manager - INFO - Successfully loaded 11 user details from database
2025-08-03 17:56:26,376 - services.payment_service - INFO - PaymentService initialized
2025-08-03 17:56:26,376 - services.lead_tracker - INFO - LeadTracker initialized
2025-08-03 17:56:26,377 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-08-03 17:56:26,377 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-08-03 17:56:26,378 - handlers.order_handler - INFO - OrderHandler initialized.
2025-08-03 17:56:26,378 - handlers.base_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-03 17:56:26,378 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-08-03 17:56:26,768 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-08-03 17:56:26,769 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-08-03 17:56:26,769 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-08-03 17:56:26,770 - handlers.base_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-03 17:56:26,781 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-08-03 17:56:26,781 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-08-03 17:56:27,297 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-08-03 17:56:27,297 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-08-03 17:56:29,025 - handlers.base_handler - INFO - Session 2348055614455: New user or missing details. Initiating onboarding.
2025-08-03 17:56:29,816 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 400 Client Error: Bad Request for url: https://graph.facebook.com/v17.0/204426689424598/messages - {"error":{"message":"(#131008) Required parameter is missing","type":"OAuthException","code":131008,"error_data":{"messaging_product":"whatsapp","details":"action['name'] is required for catalog_message message."},"fbtrace_id":"AlAr-cXw8t9rT5ILwheGPey"}}
2025-08-03 17:56:29,817 - handlers.message_processor - WARNING - Session 2348055614455: No handler response for handler 'greeting_handler', state 'start', message 'hello'. Resetting to greeting.
2025-08-03 17:56:29,818 - handlers.base_handler - INFO - Session 2348055614455: New user or missing details. Initiating onboarding.
2025-08-03 17:56:31,066 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 400 Client Error: Bad Request for url: https://graph.facebook.com/v17.0/204426689424598/messages - {"error":{"message":"(#131008) Required parameter is missing","type":"OAuthException","code":131008,"error_data":{"messaging_product":"whatsapp","details":"action['name'] is required for catalog_message message."},"fbtrace_id":"AUH2itkIOE2EsPoru6D7g9B"}}
2025-08-03 17:56:31,067 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 17:56:31] "POST /webhook HTTP/1.1" 200 -
2025-08-03 17:57:14,326 - __main__ - INFO - Starting WhatsApp bot server...
2025-08-03 17:57:15,429 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-03 17:57:16,995 - utils.data_manager - INFO - Successfully loaded 11 user details from database
2025-08-03 17:57:17,185 - services.payment_service - INFO - PaymentService initialized
2025-08-03 17:57:18,757 - handlers.product_sync_handler - INFO - Successfully synced 15 products to data\products.json
2025-08-03 17:57:18,955 - app - INFO - Initial product sync successful on startup
2025-08-03 17:57:18,955 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-03 17:57:20,495 - utils.data_manager - INFO - Successfully loaded 11 user details from database
2025-08-03 17:57:20,686 - services.payment_service - INFO - PaymentService initialized
2025-08-03 17:57:20,686 - services.lead_tracker - INFO - LeadTracker initialized
2025-08-03 17:57:20,687 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-08-03 17:57:20,687 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-08-03 17:57:20,688 - handlers.order_handler - INFO - OrderHandler initialized.
2025-08-03 17:57:20,688 - handlers.base_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-03 17:57:20,688 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-08-03 17:57:21,067 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-08-03 17:57:21,068 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-08-03 17:57:21,068 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-08-03 17:57:21,069 - handlers.base_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-03 17:57:21,080 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-08-03 17:57:21,080 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-08-03 17:57:24,216 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-08-03 17:57:24,217 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-08-03 17:57:26,405 - handlers.base_handler - INFO - Session 2348055614455: New user or missing details. Initiating onboarding.
2025-08-03 17:57:27,196 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 400 Client Error: Bad Request for url: https://graph.facebook.com/v17.0/204426689424598/messages - {"error":{"message":"(#131009) Parameter value is not valid","type":"OAuthException","code":131009,"error_data":{"messaging_product":"whatsapp","details":"The parameter interactive['header'] is not allows for catalog messages."},"fbtrace_id":"Az76bxwfStz0j2jlBQVvVoZ"}}
2025-08-03 17:57:27,197 - handlers.message_processor - WARNING - Session 2348055614455: No handler response for handler 'greeting_handler', state 'start', message 'hello'. Resetting to greeting.
2025-08-03 17:57:27,197 - handlers.base_handler - INFO - Session 2348055614455: New user or missing details. Initiating onboarding.
2025-08-03 17:57:27,946 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 400 Client Error: Bad Request for url: https://graph.facebook.com/v17.0/204426689424598/messages - {"error":{"message":"(#131009) Parameter value is not valid","type":"OAuthException","code":131009,"error_data":{"messaging_product":"whatsapp","details":"The parameter interactive['header'] is not allows for catalog messages."},"fbtrace_id":"A__GsP-uFBmGXbSk5KTwIAl"}}
2025-08-03 17:57:27,947 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 17:57:27] "POST /webhook HTTP/1.1" 200 -
2025-08-03 17:58:30,831 - __main__ - INFO - Starting WhatsApp bot server...
2025-08-03 17:58:31,941 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-03 17:58:33,687 - utils.data_manager - INFO - Successfully loaded 11 user details from database
2025-08-03 17:58:33,885 - services.payment_service - INFO - PaymentService initialized
2025-08-03 17:58:35,447 - handlers.product_sync_handler - INFO - Successfully synced 15 products to data\products.json
2025-08-03 17:58:35,635 - app - INFO - Initial product sync successful on startup
2025-08-03 17:58:35,635 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-03 17:58:38,175 - utils.data_manager - INFO - Successfully loaded 11 user details from database
2025-08-03 17:58:38,365 - services.payment_service - INFO - PaymentService initialized
2025-08-03 17:58:38,365 - services.lead_tracker - INFO - LeadTracker initialized
2025-08-03 17:58:38,366 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-08-03 17:58:38,366 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-08-03 17:58:38,366 - handlers.order_handler - INFO - OrderHandler initialized.
2025-08-03 17:58:38,367 - handlers.base_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-03 17:58:38,367 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-08-03 17:58:38,739 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-08-03 17:58:38,739 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-08-03 17:58:38,740 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-08-03 17:58:38,740 - handlers.base_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-03 17:58:38,751 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-08-03 17:58:38,751 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-08-03 17:58:41,196 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-08-03 17:58:41,197 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-08-03 17:58:42,935 - handlers.base_handler - INFO - Session 2348055614455: New user or missing details. Initiating onboarding.
2025-08-03 17:58:44,955 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkMyMjgzM0Y0QzBBMjQ4OEU2MAA="}]}
2025-08-03 17:58:45,895 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkNGMTMxNUJFNkRBMjRFNjc2NAA="}]}
2025-08-03 17:58:45,896 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkNGMTMxNUJFNkRBMjRFNjc2NAA='}]}
2025-08-03 17:58:45,897 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 17:58:45] "POST /webhook HTTP/1.1" 200 -
2025-08-03 17:58:46,473 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 17:58:46] "POST /webhook HTTP/1.1" 200 -
2025-08-03 17:58:47,153 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 17:58:47] "POST /webhook HTTP/1.1" 200 -
2025-08-03 17:58:47,288 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 17:58:47] "POST /webhook HTTP/1.1" 200 -
2025-08-03 17:58:47,628 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 17:58:47] "POST /webhook HTTP/1.1" 200 -
2025-08-03 17:59:15,527 - __main__ - INFO - Starting WhatsApp bot server...
2025-08-03 17:59:16,645 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-03 17:59:18,285 - utils.data_manager - INFO - Successfully loaded 11 user details from database
2025-08-03 17:59:18,486 - services.payment_service - INFO - PaymentService initialized
2025-08-03 17:59:20,118 - handlers.product_sync_handler - INFO - Successfully synced 15 products to data\products.json
2025-08-03 17:59:20,315 - app - INFO - Initial product sync successful on startup
2025-08-03 17:59:20,316 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-03 17:59:22,136 - utils.data_manager - INFO - Successfully loaded 11 user details from database
2025-08-03 17:59:22,326 - services.payment_service - INFO - PaymentService initialized
2025-08-03 17:59:22,326 - services.lead_tracker - INFO - LeadTracker initialized
2025-08-03 17:59:22,327 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-08-03 17:59:22,327 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-08-03 17:59:22,327 - handlers.order_handler - INFO - OrderHandler initialized.
2025-08-03 17:59:22,328 - handlers.base_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-03 17:59:22,328 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-08-03 17:59:22,772 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-08-03 17:59:22,772 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-08-03 17:59:22,773 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-08-03 17:59:22,773 - handlers.base_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-03 17:59:22,784 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-08-03 17:59:22,784 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-08-03 17:59:28,164 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-08-03 17:59:28,165 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-08-03 17:59:29,916 - handlers.base_handler - INFO - Session 2348055614455 greeted returning user 'ziga'.
2025-08-03 17:59:31,065 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjVDRjIwMUExNDkyRTJFNjZERAA="}]}
2025-08-03 17:59:31,066 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjVDRjIwMUExNDkyRTJFNjZERAA='}]}
2025-08-03 17:59:31,066 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 17:59:31] "POST /webhook HTTP/1.1" 200 -
2025-08-03 17:59:32,028 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 17:59:32] "POST /webhook HTTP/1.1" 200 -
2025-08-03 17:59:32,465 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 17:59:32] "POST /webhook HTTP/1.1" 200 -
2025-08-03 17:59:32,983 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 17:59:32] "POST /webhook HTTP/1.1" 200 -
2025-08-03 17:59:47,076 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'complain'}
2025-08-03 17:59:47,078 - handlers.base_handler - INFO - GreetingHandler: Handling message 'complain' in greeting state for session 2348055614455.
2025-08-03 17:59:47,078 - handlers.base_handler - INFO - Session 2348055614455 entering complaint state.
2025-08-03 17:59:47,079 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "We're sorry to hear you're having an issue. Please tell us about your complaint and we'll address it promptly."}}
2025-08-03 17:59:48,095 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkZBMEU1MUY1MkZGQzJGMUM5NgA="}]}
2025-08-03 17:59:48,097 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkZBMEU1MUY1MkZGQzJGMUM5NgA='}]}
2025-08-03 17:59:48,098 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 17:59:48] "POST /webhook HTTP/1.1" 200 -
2025-08-03 17:59:49,055 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 17:59:49] "POST /webhook HTTP/1.1" 200 -
2025-08-03 17:59:49,736 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 17:59:49] "POST /webhook HTTP/1.1" 200 -
2025-08-03 17:59:50,025 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 17:59:50] "POST /webhook HTTP/1.1" 200 -
2025-08-03 17:59:55,221 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Your delivery is terrible'}
2025-08-03 17:59:57,095 - utils.data_manager - ERROR - Database error while saving complaint: column "user_name" of relation "whatsapp_complaint_details" does not exist
LINE 4:                             timestamp, channel, user_name, u...
                                                        ^
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\utils\data_manager.py", line 364, in save_complaint_to_db
    cur.execute(query, (
    ~~~~~~~~~~~^^^^^^^^^
        merchant_id,
        ^^^^^^^^^^^^
    ...<5 lines>...
        complaint_data.get("user_id")
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ))
    ^^
psycopg2.errors.UndefinedColumn: column "user_name" of relation "whatsapp_complaint_details" does not exist
LINE 4:                             timestamp, channel, user_name, u...
                                                        ^

2025-08-03 17:59:57,097 - handlers.base_handler - ERROR - Session 2348055614455: Failed to save complaint to database.
2025-08-03 17:59:58,055 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjkyNTc2MDcwREM5NjRFNjcwRAA="}]}
2025-08-03 17:59:58,056 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjkyNTc2MDcwREM5NjRFNjcwRAA='}]}
2025-08-03 17:59:58,056 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 17:59:58] "POST /webhook HTTP/1.1" 200 -
2025-08-03 17:59:59,066 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 17:59:59] "POST /webhook HTTP/1.1" 200 -
2025-08-03 17:59:59,396 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 17:59:59] "POST /webhook HTTP/1.1" 200 -
2025-08-03 17:59:59,863 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 17:59:59] "POST /webhook HTTP/1.1" 200 -
2025-08-03 18:05:00,727 - __main__ - INFO - Starting WhatsApp bot server...
2025-08-03 18:05:01,829 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-03 18:05:03,624 - utils.data_manager - INFO - Successfully loaded 11 user details from database
2025-08-03 18:05:03,826 - services.payment_service - INFO - PaymentService initialized
2025-08-03 18:05:05,385 - handlers.product_sync_handler - INFO - Successfully synced 15 products to data\products.json
2025-08-03 18:05:05,578 - app - INFO - Initial product sync successful on startup
2025-08-03 18:05:05,578 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-03 18:05:07,276 - utils.data_manager - INFO - Successfully loaded 11 user details from database
2025-08-03 18:05:07,466 - services.payment_service - INFO - PaymentService initialized
2025-08-03 18:05:07,467 - services.lead_tracker - INFO - LeadTracker initialized
2025-08-03 18:05:07,467 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-08-03 18:05:07,468 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-08-03 18:05:07,468 - handlers.order_handler - INFO - OrderHandler initialized.
2025-08-03 18:05:07,469 - handlers.base_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-03 18:05:07,469 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-08-03 18:05:07,845 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-08-03 18:05:07,845 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-08-03 18:05:07,846 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-08-03 18:05:07,846 - handlers.base_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-03 18:05:07,858 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-08-03 18:05:07,859 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-08-03 18:05:10,122 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-08-03 18:05:10,122 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-08-03 18:05:11,864 - handlers.base_handler - INFO - Session 2348055614455 greeted returning user 'ziga'.
2025-08-03 18:05:12,475 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 401 Client Error: Unauthorized for url: https://graph.facebook.com/v17.0/204426689424598/messages - {"error":{"message":"Error validating access token: Session has expired on Sunday, 03-Aug-25 10:00:00 PDT. The current time is Sunday, 03-Aug-25 10:05:12 PDT.","type":"OAuthException","code":190,"error_subcode":463,"fbtrace_id":"AZu1241Bb0m7u4kgjGfIDOw"}}
2025-08-03 18:05:12,476 - handlers.message_processor - WARNING - Session 2348055614455: No handler response for handler 'greeting_handler', state 'start', message 'hello'. Resetting to greeting.
2025-08-03 18:05:12,476 - handlers.base_handler - INFO - Session 2348055614455 greeted returning user 'ziga'.
2025-08-03 18:05:13,104 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 401 Client Error: Unauthorized for url: https://graph.facebook.com/v17.0/204426689424598/messages - {"error":{"message":"Error validating access token: Session has expired on Sunday, 03-Aug-25 10:00:00 PDT. The current time is Sunday, 03-Aug-25 10:05:13 PDT.","type":"OAuthException","code":190,"error_subcode":463,"fbtrace_id":"A8IyuqJqA_Q4qFkjbS1yLDo"}}
2025-08-03 18:05:13,105 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 18:05:13] "POST /webhook HTTP/1.1" 200 -
2025-08-03 18:09:24,696 - __main__ - INFO - Starting WhatsApp bot server...
2025-08-03 18:09:25,773 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-03 18:09:27,434 - utils.data_manager - INFO - Successfully loaded 11 user details from database
2025-08-03 18:09:27,623 - services.payment_service - INFO - PaymentService initialized
2025-08-03 18:09:29,789 - handlers.product_sync_handler - INFO - Successfully synced 15 products to data\products.json
2025-08-03 18:09:30,502 - app - INFO - Initial product sync successful on startup
2025-08-03 18:09:30,503 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-03 18:09:32,225 - utils.data_manager - INFO - Successfully loaded 11 user details from database
2025-08-03 18:09:32,420 - services.payment_service - INFO - PaymentService initialized
2025-08-03 18:09:32,420 - services.lead_tracker - INFO - LeadTracker initialized
2025-08-03 18:09:32,420 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-08-03 18:09:32,421 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-08-03 18:09:32,422 - handlers.order_handler - INFO - OrderHandler initialized.
2025-08-03 18:09:32,422 - handlers.base_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-03 18:09:32,422 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-08-03 18:09:32,835 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-08-03 18:09:32,835 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-08-03 18:09:32,836 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-08-03 18:09:32,836 - handlers.base_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-03 18:09:32,847 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-08-03 18:09:32,847 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-08-03 18:09:36,226 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-08-03 18:09:36,226 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-08-03 18:09:38,194 - handlers.base_handler - INFO - Session 2348055614455 greeted returning user 'ziga'.
2025-08-03 18:09:39,244 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjkzMzA4RTczMjcyRDhFMkRFMwA="}]}
2025-08-03 18:09:39,245 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjkzMzA4RTczMjcyRDhFMkRFMwA='}]}
2025-08-03 18:09:39,246 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 18:09:39] "POST /webhook HTTP/1.1" 200 -
2025-08-03 18:09:40,654 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 18:09:40] "POST /webhook HTTP/1.1" 200 -
2025-08-03 18:09:41,329 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 18:09:41] "POST /webhook HTTP/1.1" 200 -
2025-08-03 18:09:43,005 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'complain'}
2025-08-03 18:09:43,006 - handlers.base_handler - INFO - GreetingHandler: Handling message 'complain' in greeting state for session 2348055614455.
2025-08-03 18:09:43,006 - handlers.base_handler - INFO - Session 2348055614455 entering complaint state.
2025-08-03 18:09:43,007 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "We're sorry to hear you're having an issue. Please tell us about your complaint and we'll address it promptly."}}
2025-08-03 18:09:43,985 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjBFNjI2NDBCMkVGNDhEMzM5NAA="}]}
2025-08-03 18:09:43,986 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjBFNjI2NDBCMkVGNDhEMzM5NAA='}]}
2025-08-03 18:09:43,986 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 18:09:43] "POST /webhook HTTP/1.1" 200 -
2025-08-03 18:09:45,015 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 18:09:45] "POST /webhook HTTP/1.1" 200 -
2025-08-03 18:09:45,355 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 18:09:45] "POST /webhook HTTP/1.1" 200 -
2025-08-03 18:09:45,705 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 18:09:45] "POST /webhook HTTP/1.1" 200 -
2025-08-03 18:09:52,045 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Your delivery is terrible'}
2025-08-03 18:09:53,785 - utils.data_manager - ERROR - Database error while saving complaint: column "user_id" of relation "whatsapp_complaint_details" does not exist
LINE 4: ...                      timestamp, channel, user_name, user_id
                                                                ^
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\utils\data_manager.py", line 364, in save_complaint_to_db
    cur.execute(query, (
    ~~~~~~~~~~~^^^^^^^^^
        merchant_id,
        ^^^^^^^^^^^^
    ...<5 lines>...
        complaint_data.get("user_id")
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ))
    ^^
psycopg2.errors.UndefinedColumn: column "user_id" of relation "whatsapp_complaint_details" does not exist
LINE 4: ...                      timestamp, channel, user_name, user_id
                                                                ^

2025-08-03 18:09:53,786 - handlers.base_handler - ERROR - Session 2348055614455: Failed to save complaint to database.
2025-08-03 18:09:54,871 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkU2MEM3REJFNTkzRUFGQzNGOQA="}]}
2025-08-03 18:09:54,871 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkU2MEM3REJFNTkzRUFGQzNGOQA='}]}
2025-08-03 18:09:54,872 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 18:09:54] "POST /webhook HTTP/1.1" 200 -
2025-08-03 18:09:56,163 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 18:09:56] "POST /webhook HTTP/1.1" 200 -
2025-08-03 18:09:56,296 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 18:09:56] "POST /webhook HTTP/1.1" 200 -
2025-08-03 18:09:56,514 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 18:09:56] "POST /webhook HTTP/1.1" 200 -
2025-08-03 18:13:13,622 - __main__ - INFO - Starting WhatsApp bot server...
2025-08-03 18:13:14,744 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-03 18:13:16,624 - utils.data_manager - INFO - Successfully loaded 11 user details from database
2025-08-03 18:13:16,823 - services.payment_service - INFO - PaymentService initialized
2025-08-03 18:13:18,410 - handlers.product_sync_handler - INFO - Successfully synced 15 products to data\products.json
2025-08-03 18:13:18,612 - app - INFO - Initial product sync successful on startup
2025-08-03 18:13:18,613 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-03 18:13:20,212 - utils.data_manager - INFO - Successfully loaded 11 user details from database
2025-08-03 18:13:20,403 - services.payment_service - INFO - PaymentService initialized
2025-08-03 18:13:20,404 - services.lead_tracker - INFO - LeadTracker initialized
2025-08-03 18:13:20,404 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-08-03 18:13:20,405 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-08-03 18:13:20,405 - handlers.order_handler - INFO - OrderHandler initialized.
2025-08-03 18:13:20,405 - handlers.base_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-03 18:13:20,406 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-08-03 18:13:20,783 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-08-03 18:13:20,783 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-08-03 18:13:20,783 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-08-03 18:13:20,784 - handlers.base_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-03 18:13:20,794 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-08-03 18:13:20,794 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-08-03 18:13:23,273 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-08-03 18:13:23,274 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-08-03 18:13:23,275 - handlers.message_processor - ERROR - Session 2348055614455: Error processing message: 'DataManager' object has no attribute 'get_address_from_order_details'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\message_processor.py", line 94, in process_message
    self._update_user_info(state, session_id, user_name)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\message_processor.py", line 151, in _update_user_info
    retrieved_address = self.data_manager.get_address_from_order_details(session_id)
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'DataManager' object has no attribute 'get_address_from_order_details'
2025-08-03 18:13:24,803 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkM3OTk3OTlDQ0MzM0M2QTAwNQA="}]}
2025-08-03 18:13:24,803 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkM3OTk3OTlDQ0MzM0M2QTAwNQA='}]}
2025-08-03 18:13:24,804 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 18:13:24] "POST /webhook HTTP/1.1" 200 -
2025-08-03 18:13:25,784 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 18:13:25] "POST /webhook HTTP/1.1" 200 -
2025-08-03 18:13:26,618 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 18:13:26] "POST /webhook HTTP/1.1" 200 -
2025-08-03 18:14:27,497 - __main__ - INFO - Starting WhatsApp bot server...
2025-08-03 18:14:28,609 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-03 18:14:30,215 - utils.data_manager - INFO - Successfully loaded 11 user details from database
2025-08-03 18:14:30,412 - services.payment_service - INFO - PaymentService initialized
2025-08-03 18:14:31,945 - handlers.product_sync_handler - INFO - Successfully synced 15 products to data\products.json
2025-08-03 18:14:32,131 - app - INFO - Initial product sync successful on startup
2025-08-03 18:14:32,132 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-03 18:14:33,722 - utils.data_manager - INFO - Successfully loaded 11 user details from database
2025-08-03 18:14:33,912 - services.payment_service - INFO - PaymentService initialized
2025-08-03 18:14:33,913 - services.lead_tracker - INFO - LeadTracker initialized
2025-08-03 18:14:33,913 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-08-03 18:14:33,914 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-08-03 18:14:33,914 - handlers.order_handler - INFO - OrderHandler initialized.
2025-08-03 18:14:33,914 - handlers.base_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-03 18:14:33,915 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-08-03 18:14:34,292 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-08-03 18:14:34,293 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-08-03 18:14:34,293 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-08-03 18:14:34,294 - handlers.base_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-03 18:14:34,305 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-08-03 18:14:34,305 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-08-03 18:14:36,629 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-08-03 18:14:36,630 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-08-03 18:14:39,502 - handlers.base_handler - INFO - Session 2348055614455 greeted returning user 'ziga'.
2025-08-03 18:14:40,574 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjJGOThDMDc0N0QwNjk1QkY4OQA="}]}
2025-08-03 18:14:40,574 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjJGOThDMDc0N0QwNjk1QkY4OQA='}]}
2025-08-03 18:14:40,575 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 18:14:40] "POST /webhook HTTP/1.1" 200 -
2025-08-03 18:14:41,548 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 18:14:41] "POST /webhook HTTP/1.1" 200 -
2025-08-03 18:14:41,949 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 18:14:41] "POST /webhook HTTP/1.1" 200 -
2025-08-03 18:14:42,543 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 18:14:42] "POST /webhook HTTP/1.1" 200 -
2025-08-03 18:14:45,003 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'complain'}
2025-08-03 18:14:45,005 - handlers.base_handler - INFO - GreetingHandler: Handling message 'complain' in greeting state for session 2348055614455.
2025-08-03 18:14:45,005 - handlers.base_handler - INFO - Session 2348055614455 entering complaint state.
2025-08-03 18:14:45,006 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "We're sorry to hear you're having an issue. Please tell us about your complaint and we'll address it promptly."}}
2025-08-03 18:14:46,052 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQyRkFCQTY1MTQ2NDZCNjJDMAA="}]}
2025-08-03 18:14:46,053 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQyRkFCQTY1MTQ2NDZCNjJDMAA='}]}
2025-08-03 18:14:46,054 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 18:14:46] "POST /webhook HTTP/1.1" 200 -
2025-08-03 18:14:47,259 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 18:14:47] "POST /webhook HTTP/1.1" 200 -
2025-08-03 18:14:47,374 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 18:14:47] "POST /webhook HTTP/1.1" 200 -
2025-08-03 18:14:47,762 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 18:14:47] "POST /webhook HTTP/1.1" 200 -
2025-08-03 18:14:51,725 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Your delivery is terrible'}
2025-08-03 18:14:53,475 - utils.data_manager - INFO - Complaint None saved to database
2025-08-03 18:14:53,476 - handlers.base_handler - ERROR - Session 2348055614455: Failed to save complaint to database.
2025-08-03 18:14:54,573 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjA5QzA5OTI5MzYyNjU4NTk1NQA="}]}
2025-08-03 18:14:54,573 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjA5QzA5OTI5MzYyNjU4NTk1NQA='}]}
2025-08-03 18:14:54,575 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 18:14:54] "POST /webhook HTTP/1.1" 200 -
2025-08-03 18:14:55,733 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 18:14:55] "POST /webhook HTTP/1.1" 200 -
2025-08-03 18:14:55,846 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 18:14:55] "POST /webhook HTTP/1.1" 200 -
2025-08-03 18:14:56,385 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 18:14:56] "POST /webhook HTTP/1.1" 200 -
2025-08-03 18:18:43,871 - __main__ - INFO - Starting WhatsApp bot server...
2025-08-03 18:18:44,994 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-03 18:18:46,713 - utils.data_manager - INFO - Successfully loaded 11 user details from database
2025-08-03 18:18:46,902 - services.payment_service - INFO - PaymentService initialized
2025-08-03 18:18:48,454 - handlers.product_sync_handler - INFO - Successfully synced 15 products to data\products.json
2025-08-03 18:18:48,684 - app - INFO - Initial product sync successful on startup
2025-08-03 18:18:48,684 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-03 18:18:50,211 - utils.data_manager - INFO - Successfully loaded 11 user details from database
2025-08-03 18:18:50,402 - services.payment_service - INFO - PaymentService initialized
2025-08-03 18:18:50,402 - services.lead_tracker - INFO - LeadTracker initialized
2025-08-03 18:18:50,403 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-08-03 18:18:50,403 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-08-03 18:18:50,404 - handlers.order_handler - INFO - OrderHandler initialized.
2025-08-03 18:18:50,404 - handlers.base_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-03 18:18:50,404 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-08-03 18:18:50,776 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-08-03 18:18:50,776 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-08-03 18:18:50,776 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-08-03 18:18:50,777 - handlers.base_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-03 18:18:50,788 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-08-03 18:18:50,788 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-08-03 18:18:54,072 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-08-03 18:18:54,073 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-08-03 18:18:55,801 - handlers.base_handler - INFO - Session 2348055614455 greeted returning user 'ziga'.
2025-08-03 18:18:57,772 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkEwMjQ2Rjg4ODJCNjY5NDUxNgA="}]}
2025-08-03 18:18:57,773 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkEwMjQ2Rjg4ODJCNjY5NDUxNgA='}]}
2025-08-03 18:18:57,773 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 18:18:57] "POST /webhook HTTP/1.1" 200 -
2025-08-03 18:18:58,723 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 18:18:58] "POST /webhook HTTP/1.1" 200 -
2025-08-03 18:18:59,188 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 18:18:59] "POST /webhook HTTP/1.1" 200 -
2025-08-03 18:19:00,743 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'complain'}
2025-08-03 18:19:00,745 - handlers.base_handler - INFO - GreetingHandler: Handling message 'complain' in greeting state for session 2348055614455.
2025-08-03 18:19:00,746 - handlers.base_handler - INFO - Session 2348055614455 entering complaint state.
2025-08-03 18:19:00,746 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "We're sorry to hear you're having an issue. Please tell us about your complaint and we'll address it promptly."}}
2025-08-03 18:19:01,761 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQ3QUVEQURBRjlBODQ0RDUyMQA="}]}
2025-08-03 18:19:01,762 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQ3QUVEQURBRjlBODQ0RDUyMQA='}]}
2025-08-03 18:19:01,763 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 18:19:01] "POST /webhook HTTP/1.1" 200 -
2025-08-03 18:19:02,873 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 18:19:02] "POST /webhook HTTP/1.1" 200 -
2025-08-03 18:19:03,153 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 18:19:03] "POST /webhook HTTP/1.1" 200 -
2025-08-03 18:19:03,422 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 18:19:03] "POST /webhook HTTP/1.1" 200 -
2025-08-03 18:19:11,038 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Your delivery is terrible'}
2025-08-03 18:19:12,811 - utils.data_manager - INFO - Complaint None saved to database
2025-08-03 18:19:12,811 - handlers.base_handler - ERROR - Session 2348055614455: Failed to save complaint to database.
2025-08-03 18:19:14,451 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjJFQzY2MkFCQjFGNzVDQzZFOQA="}]}
2025-08-03 18:19:14,452 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjJFQzY2MkFCQjFGNzVDQzZFOQA='}]}
2025-08-03 18:19:14,453 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 18:19:14] "POST /webhook HTTP/1.1" 200 -
2025-08-03 18:19:15,355 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 18:19:15] "POST /webhook HTTP/1.1" 200 -
2025-08-03 18:19:15,698 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 18:19:15] "POST /webhook HTTP/1.1" 200 -
2025-08-03 18:19:16,059 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 18:19:16] "POST /webhook HTTP/1.1" 200 -
2025-08-03 19:03:15,847 - __main__ - INFO - Starting WhatsApp bot server...
2025-08-03 19:03:17,641 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-03 19:03:19,963 - utils.data_manager - INFO - Successfully loaded 11 user details from database
2025-08-03 19:03:20,168 - services.payment_service - INFO - PaymentService initialized
2025-08-03 19:03:21,937 - handlers.product_sync_handler - INFO - Successfully synced 15 products to data\products.json
2025-08-03 19:03:22,123 - app - INFO - Initial product sync successful on startup
2025-08-03 19:03:22,124 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-03 19:03:23,675 - utils.data_manager - INFO - Successfully loaded 11 user details from database
2025-08-03 19:03:23,864 - services.payment_service - INFO - PaymentService initialized
2025-08-03 19:03:23,865 - services.lead_tracker - INFO - LeadTracker initialized
2025-08-03 19:03:23,865 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-08-03 19:03:23,866 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-08-03 19:03:23,867 - handlers.order_handler - INFO - OrderHandler initialized.
2025-08-03 19:03:23,867 - handlers.base_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-03 19:03:23,867 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-08-03 19:03:24,288 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-08-03 19:03:24,289 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-08-03 19:03:24,289 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-08-03 19:03:24,289 - handlers.base_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-03 19:03:24,303 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-08-03 19:03:24,304 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-08-03 19:03:36,391 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-08-03 19:03:36,392 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-08-03 19:03:38,204 - handlers.base_handler - INFO - Session 2348055614455 greeted returning user 'ziga'.
2025-08-03 19:03:39,594 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkRCOEIxQjdDRUU4NzI5NzBBQgA="}]}
2025-08-03 19:03:39,594 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkRCOEIxQjdDRUU4NzI5NzBBQgA='}]}
2025-08-03 19:03:39,595 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 19:03:39] "POST /webhook HTTP/1.1" 200 -
2025-08-03 19:03:40,568 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 19:03:40] "POST /webhook HTTP/1.1" 200 -
2025-08-03 19:03:40,909 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 19:03:40] "POST /webhook HTTP/1.1" 200 -
2025-08-03 19:03:41,097 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 19:03:41] "POST /webhook HTTP/1.1" 200 -
2025-08-03 19:03:42,640 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'complain'}
2025-08-03 19:03:42,644 - handlers.base_handler - INFO - GreetingHandler: Handling message 'complain' in greeting state for session 2348055614455.
2025-08-03 19:03:42,644 - handlers.base_handler - INFO - Session 2348055614455 entering complaint state.
2025-08-03 19:03:42,645 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "We're sorry to hear you're having an issue. Please tell us about your complaint and we'll address it promptly."}}
2025-08-03 19:03:43,645 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkFEMzkzOUJGNzAyMDFDNzI0RQA="}]}
2025-08-03 19:03:43,645 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkFEMzkzOUJGNzAyMDFDNzI0RQA='}]}
2025-08-03 19:03:43,646 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 19:03:43] "POST /webhook HTTP/1.1" 200 -
2025-08-03 19:03:44,635 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 19:03:44] "POST /webhook HTTP/1.1" 200 -
2025-08-03 19:03:45,136 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 19:03:45] "POST /webhook HTTP/1.1" 200 -
2025-08-03 19:03:45,251 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 19:03:45] "POST /webhook HTTP/1.1" 200 -
2025-08-03 19:03:51,494 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Your delivery is outrageous'}
2025-08-03 19:03:51,496 - handlers.base_handler - ERROR - Session 2348055614455: Error handling complaint submission: 'DataManager' object has no attribute 'save_complaint'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\complaint_handler.py", line 87, in handle_complaint_state
    ref_id = self.data_manager.save_complaint(complaint_data)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'DataManager' object has no attribute 'save_complaint'
2025-08-03 19:03:52,643 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkNBMTRGQjk3QTA1OUNCQTQ0OQA="}]}
2025-08-03 19:03:52,644 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkNBMTRGQjk3QTA1OUNCQTQ0OQA='}]}
2025-08-03 19:03:52,645 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 19:03:52] "POST /webhook HTTP/1.1" 200 -
2025-08-03 19:03:53,838 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 19:03:53] "POST /webhook HTTP/1.1" 200 -
2025-08-03 19:03:54,107 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 19:03:54] "POST /webhook HTTP/1.1" 200 -
2025-08-03 19:03:54,326 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 19:03:54] "POST /webhook HTTP/1.1" 200 -
2025-08-03 19:04:19,110 - __main__ - INFO - Starting WhatsApp bot server...
2025-08-03 19:04:20,321 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-03 19:04:21,951 - utils.data_manager - INFO - Successfully loaded 11 user details from database
2025-08-03 19:04:22,149 - services.payment_service - INFO - PaymentService initialized
2025-08-03 19:04:24,815 - handlers.product_sync_handler - INFO - Successfully synced 15 products to data\products.json
2025-08-03 19:04:25,006 - app - INFO - Initial product sync successful on startup
2025-08-03 19:04:25,007 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-03 19:04:26,564 - utils.data_manager - INFO - Successfully loaded 11 user details from database
2025-08-03 19:04:26,755 - services.payment_service - INFO - PaymentService initialized
2025-08-03 19:04:26,755 - services.lead_tracker - INFO - LeadTracker initialized
2025-08-03 19:04:26,756 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-08-03 19:04:26,757 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-08-03 19:04:26,757 - handlers.order_handler - INFO - OrderHandler initialized.
2025-08-03 19:04:26,757 - handlers.base_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-03 19:04:26,758 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-08-03 19:04:27,129 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-08-03 19:04:27,129 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-08-03 19:04:27,129 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-08-03 19:04:27,130 - handlers.base_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-03 19:04:27,142 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-08-03 19:04:27,142 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-08-03 19:04:28,962 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-08-03 19:04:28,963 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-08-03 19:04:31,108 - handlers.base_handler - INFO - Session 2348055614455 greeted returning user 'ziga'.
2025-08-03 19:04:32,224 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjNGMjk2OEQxRkMwQTRFMjY5MwA="}]}
2025-08-03 19:04:32,225 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjNGMjk2OEQxRkMwQTRFMjY5MwA='}]}
2025-08-03 19:04:32,226 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 19:04:32] "POST /webhook HTTP/1.1" 200 -
2025-08-03 19:04:33,156 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 19:04:33] "POST /webhook HTTP/1.1" 200 -
2025-08-03 19:04:33,576 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 19:04:33] "POST /webhook HTTP/1.1" 200 -
2025-08-03 19:04:33,866 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 19:04:33] "POST /webhook HTTP/1.1" 200 -
2025-08-03 19:04:35,231 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'complain'}
2025-08-03 19:04:35,233 - handlers.base_handler - INFO - GreetingHandler: Handling message 'complain' in greeting state for session 2348055614455.
2025-08-03 19:04:35,233 - handlers.base_handler - INFO - Session 2348055614455 entering complaint state.
2025-08-03 19:04:35,234 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "We're sorry to hear you're having an issue. Please tell us about your complaint and we'll address it promptly."}}
2025-08-03 19:04:36,355 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjU4OUJEMDAyNzBEMTc4Q0MxNwA="}]}
2025-08-03 19:04:36,355 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjU4OUJEMDAyNzBEMTc4Q0MxNwA='}]}
2025-08-03 19:04:36,356 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 19:04:36] "POST /webhook HTTP/1.1" 200 -
2025-08-03 19:04:37,546 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 19:04:37] "POST /webhook HTTP/1.1" 200 -
2025-08-03 19:04:37,837 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 19:04:37] "POST /webhook HTTP/1.1" 200 -
2025-08-03 19:04:37,934 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 19:04:37] "POST /webhook HTTP/1.1" 200 -
2025-08-03 19:04:44,833 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Your delivery is terrible'}
2025-08-03 19:04:46,593 - utils.data_manager - ERROR - Database error while saving complaint: column "ref_id" does not exist
LINE 7:                         RETURNING ref_id
                                          ^
HINT:  Perhaps you meant to reference the column "whatsapp_complaint_details.user_id".
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\utils\data_manager.py", line 374, in save_complaint_to_db
    cur.execute(query, (
    ~~~~~~~~~~~^^^^^^^^^
        merchant_id,
        ^^^^^^^^^^^^
    ...<6 lines>...
        priority
        ^^^^^^^^
    ))
    ^^
psycopg2.errors.UndefinedColumn: column "ref_id" does not exist
LINE 7:                         RETURNING ref_id
                                          ^
HINT:  Perhaps you meant to reference the column "whatsapp_complaint_details.user_id".

2025-08-03 19:04:46,595 - handlers.base_handler - ERROR - Session 2348055614455: Failed to save complaint to database.
2025-08-03 19:04:47,694 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjk3NzA1RDEyMDY5MkY5Q0FFQgA="}]}
2025-08-03 19:04:47,695 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjk3NzA1RDEyMDY5MkY5Q0FFQgA='}]}
2025-08-03 19:04:47,696 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 19:04:47] "POST /webhook HTTP/1.1" 200 -
2025-08-03 19:04:48,658 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 19:04:48] "POST /webhook HTTP/1.1" 200 -
2025-08-03 19:04:48,984 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 19:04:48] "POST /webhook HTTP/1.1" 200 -
2025-08-03 19:04:49,175 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 19:04:49] "POST /webhook HTTP/1.1" 200 -
2025-08-03 19:12:21,892 - __main__ - INFO - Starting WhatsApp bot server...
2025-08-03 19:12:23,617 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-03 19:12:25,742 - utils.data_manager - INFO - Successfully loaded 11 user details from database
2025-08-03 19:12:25,933 - services.payment_service - INFO - PaymentService initialized
2025-08-03 19:12:27,634 - handlers.product_sync_handler - INFO - Successfully synced 15 products to data\products.json
2025-08-03 19:12:27,833 - app - INFO - Initial product sync successful on startup
2025-08-03 19:12:27,833 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-03 19:12:29,364 - utils.data_manager - INFO - Successfully loaded 11 user details from database
2025-08-03 19:12:29,552 - services.payment_service - INFO - PaymentService initialized
2025-08-03 19:12:29,553 - services.lead_tracker - INFO - LeadTracker initialized
2025-08-03 19:12:29,553 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-08-03 19:12:29,565 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-08-03 19:12:29,565 - handlers.order_handler - INFO - OrderHandler initialized.
2025-08-03 19:12:29,565 - handlers.base_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-03 19:12:29,566 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-08-03 19:12:29,971 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-08-03 19:12:29,972 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-08-03 19:12:29,972 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-08-03 19:12:29,972 - handlers.base_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-03 19:12:29,995 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-08-03 19:12:29,995 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-08-03 19:12:57,704 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-08-03 19:12:57,706 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-08-03 19:12:59,532 - handlers.base_handler - INFO - Session 2348055614455 greeted returning user 'ziga'.
2025-08-03 19:13:00,993 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkJEOEYxMTZCNDlBM0YyODA5QwA="}]}
2025-08-03 19:13:00,994 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkJEOEYxMTZCNDlBM0YyODA5QwA='}]}
2025-08-03 19:13:00,995 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 19:13:00] "POST /webhook HTTP/1.1" 200 -
2025-08-03 19:13:01,985 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 19:13:01] "POST /webhook HTTP/1.1" 200 -
2025-08-03 19:13:02,323 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 19:13:02] "POST /webhook HTTP/1.1" 200 -
2025-08-03 19:13:02,762 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 19:13:02] "POST /webhook HTTP/1.1" 200 -
2025-08-03 19:13:11,959 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'complain'}
2025-08-03 19:13:11,961 - handlers.base_handler - INFO - GreetingHandler: Handling message 'complain' in greeting state for session 2348055614455.
2025-08-03 19:13:11,962 - handlers.base_handler - INFO - Session 2348055614455 entering complaint state.
2025-08-03 19:13:11,962 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "We're sorry to hear you're having an issue. Please tell us about your complaint and we'll address it promptly."}}
2025-08-03 19:13:13,152 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkVGNDRCM0I5NDUyODBGOTVGRAA="}]}
2025-08-03 19:13:13,153 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkVGNDRCM0I5NDUyODBGOTVGRAA='}]}
2025-08-03 19:13:13,153 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 19:13:13] "POST /webhook HTTP/1.1" 200 -
2025-08-03 19:13:14,113 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 19:13:14] "POST /webhook HTTP/1.1" 200 -
2025-08-03 19:13:14,775 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 19:13:14] "POST /webhook HTTP/1.1" 200 -
2025-08-03 19:13:15,097 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 19:13:15] "POST /webhook HTTP/1.1" 200 -
2025-08-03 19:13:18,102 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Your delivery is terrible'}
2025-08-03 19:13:20,672 - utils.data_manager - ERROR - Unexpected error while saving complaint: tuple indices must be integers or slices, not str
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\utils\data_manager.py", line 388, in save_complaint_to_db
    complaint_id = cur.fetchone()['complaint_id']
                   ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^
TypeError: tuple indices must be integers or slices, not str
2025-08-03 19:13:20,674 - handlers.base_handler - ERROR - Session 2348055614455: Failed to save complaint to database.
2025-08-03 19:13:21,786 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkJBQ0I0NzM3OUYzNkIzNzY4NwA="}]}
2025-08-03 19:13:21,787 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkJBQ0I0NzM3OUYzNkIzNzY4NwA='}]}
2025-08-03 19:13:21,787 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 19:13:21] "POST /webhook HTTP/1.1" 200 -
2025-08-03 19:13:22,774 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 19:13:22] "POST /webhook HTTP/1.1" 200 -
2025-08-03 19:13:23,084 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 19:13:23] "POST /webhook HTTP/1.1" 200 -
2025-08-03 19:13:23,740 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 19:13:23] "POST /webhook HTTP/1.1" 200 -
2025-08-03 19:16:54,274 - __main__ - INFO - Starting WhatsApp bot server...
2025-08-03 19:16:55,430 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-03 19:16:57,002 - utils.data_manager - INFO - Successfully loaded 11 user details from database
2025-08-03 19:16:57,203 - services.payment_service - INFO - PaymentService initialized
2025-08-03 19:16:59,243 - handlers.product_sync_handler - INFO - Successfully synced 15 products to data\products.json
2025-08-03 19:16:59,431 - app - INFO - Initial product sync successful on startup
2025-08-03 19:16:59,432 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-03 19:17:02,301 - utils.data_manager - INFO - Successfully loaded 11 user details from database
2025-08-03 19:17:02,491 - services.payment_service - INFO - PaymentService initialized
2025-08-03 19:17:02,492 - services.lead_tracker - INFO - LeadTracker initialized
2025-08-03 19:17:02,492 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-08-03 19:17:02,493 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-08-03 19:17:02,493 - handlers.order_handler - INFO - OrderHandler initialized.
2025-08-03 19:17:02,494 - handlers.base_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-03 19:17:02,494 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-08-03 19:17:02,874 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-08-03 19:17:02,874 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-08-03 19:17:02,874 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-08-03 19:17:02,875 - handlers.base_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-03 19:17:02,893 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-08-03 19:17:02,893 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-08-03 19:17:19,384 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-08-03 19:17:19,384 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-08-03 19:17:21,112 - handlers.base_handler - INFO - Session 2348055614455 greeted returning user 'ziga'.
2025-08-03 19:17:22,591 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjMwQUVEMzQwRDYxMzZDNjRENAA="}]}
2025-08-03 19:17:22,591 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjMwQUVEMzQwRDYxMzZDNjRENAA='}]}
2025-08-03 19:17:22,592 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 19:17:22] "POST /webhook HTTP/1.1" 200 -
2025-08-03 19:17:23,574 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 19:17:23] "POST /webhook HTTP/1.1" 200 -
2025-08-03 19:17:23,915 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 19:17:23] "POST /webhook HTTP/1.1" 200 -
2025-08-03 19:17:24,287 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 19:17:24] "POST /webhook HTTP/1.1" 200 -
2025-08-03 19:17:25,440 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'complain'}
2025-08-03 19:17:25,442 - handlers.base_handler - INFO - GreetingHandler: Handling message 'complain' in greeting state for session 2348055614455.
2025-08-03 19:17:25,442 - handlers.base_handler - INFO - Session 2348055614455 entering complaint state.
2025-08-03 19:17:25,443 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "We're sorry to hear you're having an issue. Please tell us about your complaint and we'll address it promptly."}}
2025-08-03 19:17:27,231 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkY2RjdGREMxMjYxMEU0MDg3QgA="}]}
2025-08-03 19:17:27,232 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkY2RjdGREMxMjYxMEU0MDg3QgA='}]}
2025-08-03 19:17:27,232 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 19:17:27] "POST /webhook HTTP/1.1" 200 -
2025-08-03 19:17:28,352 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 19:17:28] "POST /webhook HTTP/1.1" 200 -
2025-08-03 19:17:28,814 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 19:17:28] "POST /webhook HTTP/1.1" 200 -
2025-08-03 19:17:28,922 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 19:17:28] "POST /webhook HTTP/1.1" 200 -
2025-08-03 19:17:40,408 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': "You're terrible customer service"}
2025-08-03 19:17:42,311 - utils.data_manager - INFO - Complaint 2 saved to database
2025-08-03 19:17:42,312 - handlers.base_handler - INFO - Session 2348055614455: Complaint 2 saved for user ziga (phone: 2348055614455) with text: You're terrible customer service
2025-08-03 19:17:42,312 - handlers.base_handler - INFO - Session 2348055614455: Returned to main menu from complaint handler.
2025-08-03 19:17:43,471 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjY0RUQxQzc1QkEwQUE4RjlFOAA="}]}
2025-08-03 19:17:43,472 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjY0RUQxQzc1QkEwQUE4RjlFOAA='}]}
2025-08-03 19:17:43,473 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 19:17:43] "POST /webhook HTTP/1.1" 200 -
2025-08-03 19:17:44,684 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 19:17:44] "POST /webhook HTTP/1.1" 200 -
2025-08-03 19:17:44,842 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 19:17:44] "POST /webhook HTTP/1.1" 200 -
2025-08-03 19:17:45,157 - werkzeug - INFO - 127.0.0.1 - - [03/Aug/2025 19:17:45] "POST /webhook HTTP/1.1" 200 -
2025-08-04 21:27:10,603 - __main__ - INFO - Starting WhatsApp bot server...
2025-08-04 21:27:11,416 - __main__ - ERROR - Import error: No module named 'handlers.data_manager'
2025-08-04 21:30:20,524 - __main__ - INFO - Starting WhatsApp bot server...
2025-08-04 21:30:21,380 - __main__ - ERROR - Import error: No module named 'handlers.data_manager'
2025-08-04 21:34:49,427 - __main__ - INFO - Starting WhatsApp bot server...
2025-08-04 21:34:50,093 - __main__ - ERROR - Import error: No module named 'handlers.data_manager'
2025-08-04 21:37:45,933 - __main__ - INFO - Starting WhatsApp bot server...
2025-08-04 21:37:46,719 - __main__ - ERROR - Import error: cannot import name 'LeadTrackingHandler' from 'handlers.lead_tracking_handler' (C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\lead_tracking_handler.py)
2025-08-04 21:38:13,603 - __main__ - INFO - Starting WhatsApp bot server...
2025-08-04 21:38:15,320 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-04 21:38:17,743 - utils.data_manager - INFO - Successfully loaded 12 user details from database
2025-08-04 21:38:17,931 - services.payment_service - INFO - PaymentService initialized
2025-08-04 21:38:20,122 - handlers.product_sync_handler - INFO - Successfully synced 15 products to data\products.json
2025-08-04 21:38:20,318 - app - INFO - Initial product sync successful on startup
2025-08-04 21:38:20,318 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-04 21:38:21,882 - utils.data_manager - INFO - Successfully loaded 12 user details from database
2025-08-04 21:38:22,067 - services.payment_service - INFO - PaymentService initialized
2025-08-04 21:38:22,067 - services.lead_tracker - INFO - LeadTracker initialized
2025-08-04 21:38:22,067 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-08-04 21:38:22,068 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-08-04 21:38:22,068 - handlers.order_handler - INFO - OrderHandler initialized.
2025-08-04 21:38:22,068 - handlers.base_handler - INFO - PaymentHandler initialized with subaccount ACCT_939kju7zdvsk76y, split percentage 1%
2025-08-04 21:38:22,069 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-08-04 21:38:22,533 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-08-04 21:38:22,533 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-08-04 21:38:22,534 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-08-04 21:38:22,534 - handlers.base_handler - INFO - PaymentHandler initialized with subaccount ACCT_939kju7zdvsk76y, split percentage 1%
2025-08-04 21:38:22,554 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-08-04 21:38:22,554 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-08-04 21:39:37,181 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-08-04 21:39:37,181 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-08-04 21:39:39,220 - handlers.base_handler - INFO - Session 2348055614455 greeted returning user 'ziga'.
2025-08-04 21:39:43,271 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 400 Client Error: Bad Request for url: https://graph.facebook.com/v17.0/204426689424598/messages - {"error":{"message":"(#10) Application does not have permission for this action","type":"OAuthException","code":10,"error_data":{"messaging_product":"whatsapp","details":"There was a problem with the access token or permissions you are using for the API call."},"fbtrace_id":"AQV4YOfQtmPCSARC7nNT5dH"}}
2025-08-04 21:39:43,272 - handlers.message_processor - WARNING - Session 2348055614455: No handler response for handler 'greeting_handler', state 'start', message 'hello'. Resetting to greeting.
2025-08-04 21:39:43,272 - handlers.base_handler - INFO - Session 2348055614455 greeted returning user 'ziga'.
2025-08-04 21:39:44,967 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 400 Client Error: Bad Request for url: https://graph.facebook.com/v17.0/204426689424598/messages - {"error":{"message":"(#10) Application does not have permission for this action","type":"OAuthException","code":10,"error_data":{"messaging_product":"whatsapp","details":"There was a problem with the access token or permissions you are using for the API call."},"fbtrace_id":"AckLKThHvn-Z3QoM953RsyR"}}
2025-08-04 21:39:44,969 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 21:39:44] "POST /webhook HTTP/1.1" 200 -
2025-08-04 21:41:56,480 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-08-04 21:41:56,482 - handlers.base_handler - INFO - GreetingHandler: Handling message 'hello' in greeting state for session 2348055614455.
2025-08-04 21:41:56,482 - handlers.base_handler - WARNING - Session 2348055614455: Invalid option 'hello' in greeting state for non-paid user.
2025-08-04 21:41:57,639 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 400 Client Error: Bad Request for url: https://graph.facebook.com/v17.0/204426689424598/messages - {"error":{"message":"(#10) Application does not have permission for this action","type":"OAuthException","code":10,"error_data":{"messaging_product":"whatsapp","details":"There was a problem with the access token or permissions you are using for the API call."},"fbtrace_id":"AO7J1mfcsw0U6cAzhnHJ1_r"}}
2025-08-04 21:41:57,639 - handlers.message_processor - WARNING - Session 2348055614455: No handler response for handler 'greeting_handler', state 'greeting', message 'hello'. Resetting to greeting.
2025-08-04 21:41:57,640 - handlers.base_handler - INFO - Session 2348055614455 greeted returning user 'ziga'.
2025-08-04 21:41:58,600 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 400 Client Error: Bad Request for url: https://graph.facebook.com/v17.0/204426689424598/messages - {"error":{"message":"(#10) Application does not have permission for this action","type":"OAuthException","code":10,"error_data":{"messaging_product":"whatsapp","details":"There was a problem with the access token or permissions you are using for the API call."},"fbtrace_id":"ASX-S9W5Tr1_fvfI53dxol1"}}
2025-08-04 21:41:58,601 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 21:41:58] "POST /webhook HTTP/1.1" 200 -
2025-08-04 21:42:02,929 - __main__ - INFO - Starting WhatsApp bot server...
2025-08-04 21:42:04,504 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-04 21:42:06,099 - utils.data_manager - INFO - Successfully loaded 12 user details from database
2025-08-04 21:42:06,286 - services.payment_service - INFO - PaymentService initialized
2025-08-04 21:42:08,326 - handlers.product_sync_handler - INFO - Successfully synced 15 products to data\products.json
2025-08-04 21:42:08,515 - app - INFO - Initial product sync successful on startup
2025-08-04 21:42:08,515 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-04 21:42:10,053 - utils.data_manager - INFO - Successfully loaded 12 user details from database
2025-08-04 21:42:10,239 - services.payment_service - INFO - PaymentService initialized
2025-08-04 21:42:10,240 - services.lead_tracker - INFO - LeadTracker initialized
2025-08-04 21:42:10,240 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-08-04 21:42:10,241 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-08-04 21:42:10,241 - handlers.order_handler - INFO - OrderHandler initialized.
2025-08-04 21:42:10,242 - handlers.base_handler - INFO - PaymentHandler initialized with subaccount ACCT_939kju7zdvsk76y, split percentage 1%
2025-08-04 21:42:10,242 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-08-04 21:42:10,734 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-08-04 21:42:10,734 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-08-04 21:42:10,734 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-08-04 21:42:10,735 - handlers.base_handler - INFO - PaymentHandler initialized with subaccount ACCT_939kju7zdvsk76y, split percentage 1%
2025-08-04 21:42:10,746 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-08-04 21:42:10,746 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-08-04 21:43:08,852 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-08-04 21:43:08,853 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-08-04 21:43:10,621 - handlers.base_handler - INFO - Session 2348055614455 greeted returning user 'ziga'.
2025-08-04 21:43:12,125 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkNDMUZCREJEQzU1OUI1RTgyQQA="}]}
2025-08-04 21:43:12,126 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkNDMUZCREJEQzU1OUI1RTgyQQA='}]}
2025-08-04 21:43:12,126 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 21:43:12] "POST /webhook HTTP/1.1" 200 -
2025-08-04 21:43:13,050 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 21:43:13] "POST /webhook HTTP/1.1" 200 -
2025-08-04 21:43:13,229 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 21:43:13] "POST /webhook HTTP/1.1" 200 -
2025-08-04 21:43:13,679 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 21:43:13] "POST /webhook HTTP/1.1" 200 -
2025-08-04 21:43:17,199 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'complain'}
2025-08-04 21:43:17,202 - handlers.base_handler - INFO - GreetingHandler: Handling message 'complain' in greeting state for session 2348055614455.
2025-08-04 21:43:17,202 - handlers.base_handler - INFO - Session 2348055614455 entering complaint state.
2025-08-04 21:43:17,203 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "We're sorry to hear you're having an issue. Please tell us about your complaint and we'll address it promptly."}}
2025-08-04 21:43:19,420 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkRFQ0RFNUUyNkFGOTMyRkU3OAA="}]}
2025-08-04 21:43:19,420 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkRFQ0RFNUUyNkFGOTMyRkU3OAA='}]}
2025-08-04 21:43:19,421 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 21:43:19] "POST /webhook HTTP/1.1" 200 -
2025-08-04 21:43:20,517 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 21:43:20] "POST /webhook HTTP/1.1" 200 -
2025-08-04 21:43:20,519 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 21:43:20] "POST /webhook HTTP/1.1" 200 -
2025-08-04 21:43:21,143 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 21:43:21] "POST /webhook HTTP/1.1" 200 -
2025-08-04 21:43:25,720 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Your delivery is bad'}
2025-08-04 21:43:27,447 - utils.data_manager - ERROR - Database error while saving complaint: duplicate key value violates unique constraint "idx_complaint_user_phone"
DETAIL:  Key (user_id, phone_number)=(2348055614455, 2348055614455) already exists.
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\utils\data_manager.py", line 376, in save_complaint_to_db
    cur.execute(query, (
    ~~~~~~~~~~~^^^^^^^^^
        merchant_id,
        ^^^^^^^^^^^^
    ...<8 lines>...
        priority
        ^^^^^^^^
    ))
    ^^
  File "C:\Users\zigam\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\extras.py", line 236, in execute
    return super().execute(query, vars)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.UniqueViolation: duplicate key value violates unique constraint "idx_complaint_user_phone"
DETAIL:  Key (user_id, phone_number)=(2348055614455, 2348055614455) already exists.

2025-08-04 21:43:27,450 - handlers.base_handler - ERROR - Session 2348055614455: Failed to save complaint to database.
2025-08-04 21:43:28,509 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkE4NDdEODZEMDE3NUM1NDdGQQA="}]}
2025-08-04 21:43:28,510 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkE4NDdEODZEMDE3NUM1NDdGQQA='}]}
2025-08-04 21:43:28,511 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 21:43:28] "POST /webhook HTTP/1.1" 200 -
2025-08-04 21:43:29,602 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 21:43:29] "POST /webhook HTTP/1.1" 200 -
2025-08-04 21:43:29,604 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 21:43:29] "POST /webhook HTTP/1.1" 200 -
2025-08-04 21:43:30,834 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 21:43:30] "POST /webhook HTTP/1.1" 200 -
2025-08-04 21:45:22,091 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-08-04 21:45:23,923 - utils.data_manager - INFO - Complaint 4 saved to database
2025-08-04 21:45:23,924 - handlers.base_handler - INFO - Session 2348055614455: Complaint 4 saved for user ziga (phone: 2348055614455) with text: Hello
2025-08-04 21:45:23,924 - handlers.base_handler - INFO - Session 2348055614455: Returned to main menu from complaint handler.
2025-08-04 21:45:25,795 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjI1NEUxMDg4QTY1M0YzQ0FGNgA="}]}
2025-08-04 21:45:25,795 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjI1NEUxMDg4QTY1M0YzQ0FGNgA='}]}
2025-08-04 21:45:25,796 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 21:45:25] "POST /webhook HTTP/1.1" 200 -
2025-08-04 21:45:26,642 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 21:45:26] "POST /webhook HTTP/1.1" 200 -
2025-08-04 21:45:27,107 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 21:45:27] "POST /webhook HTTP/1.1" 200 -
2025-08-04 21:45:50,802 - __main__ - INFO - Starting WhatsApp bot server...
2025-08-04 21:45:52,081 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-04 21:45:53,744 - utils.data_manager - INFO - Successfully loaded 12 user details from database
2025-08-04 21:45:53,942 - services.payment_service - INFO - PaymentService initialized
2025-08-04 21:45:55,565 - handlers.product_sync_handler - INFO - Successfully synced 15 products to data\products.json
2025-08-04 21:45:55,786 - app - INFO - Initial product sync successful on startup
2025-08-04 21:45:55,786 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-04 21:45:58,049 - utils.data_manager - INFO - Successfully loaded 12 user details from database
2025-08-04 21:45:58,301 - services.payment_service - INFO - PaymentService initialized
2025-08-04 21:45:58,302 - services.lead_tracker - INFO - LeadTracker initialized
2025-08-04 21:45:58,302 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-08-04 21:45:58,303 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-08-04 21:45:58,303 - handlers.order_handler - INFO - OrderHandler initialized.
2025-08-04 21:45:58,303 - handlers.base_handler - INFO - PaymentHandler initialized with subaccount ACCT_939kju7zdvsk76y, split percentage 1%
2025-08-04 21:45:58,304 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-08-04 21:45:58,712 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-08-04 21:45:58,712 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-08-04 21:45:58,713 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-08-04 21:45:58,713 - handlers.base_handler - INFO - PaymentHandler initialized with subaccount ACCT_939kju7zdvsk76y, split percentage 1%
2025-08-04 21:45:58,733 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-08-04 21:45:58,734 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-08-04 21:45:59,223 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 21:45:59] "POST /webhook HTTP/1.1" 200 -
2025-08-04 21:47:59,671 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-08-04 21:47:59,672 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-08-04 21:48:01,649 - handlers.base_handler - INFO - Session 2348055614455 greeted returning user 'ziga'.
2025-08-04 21:48:03,515 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQxMEUxNDlDRUU5NEYxNkY3RQA="}]}
2025-08-04 21:48:03,517 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQxMEUxNDlDRUU5NEYxNkY3RQA='}]}
2025-08-04 21:48:03,518 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 21:48:03] "POST /webhook HTTP/1.1" 200 -
2025-08-04 21:48:04,559 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 21:48:04] "POST /webhook HTTP/1.1" 200 -
2025-08-04 21:48:04,638 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 21:48:04] "POST /webhook HTTP/1.1" 200 -
2025-08-04 21:48:05,488 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 21:48:05] "POST /webhook HTTP/1.1" 200 -
2025-08-04 21:48:08,015 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-08-04 21:48:08,017 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-08-04 21:48:08,018 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-08-04 21:48:08,018 - handlers.message_processor - INFO - Session 2348055614455: Redirecting to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-08-04 21:48:08,019 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-08-04 21:48:08,019 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'image', 'image': {'link': 'https://test.mackennytutors.com/wp-content/uploads/2025/06/ganador.jpg', 'caption': 'Our Delicious Menu!'}}
2025-08-04 21:48:09,299 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkY3RjZGREQzODA0QTA5QzhCQgA="}]}
2025-08-04 21:48:09,300 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Hi, I'm Lola from Ganador \n\nTake a look at the menu and type in your order\n\n"}}
2025-08-04 21:48:10,643 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkIxQjU2QkRGRkNEOEVENkUxQwA="}]}
2025-08-04 21:48:10,644 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkIxQjU2QkRGRkNEOEVENkUxQwA='}]}
2025-08-04 21:48:10,645 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 21:48:10] "POST /webhook HTTP/1.1" 200 -
2025-08-04 21:48:10,819 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 21:48:10] "POST /webhook HTTP/1.1" 200 -
2025-08-04 21:48:11,743 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 21:48:11] "POST /webhook HTTP/1.1" 200 -
2025-08-04 21:48:11,991 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 21:48:11] "POST /webhook HTTP/1.1" 200 -
2025-08-04 21:48:11,995 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 21:48:11] "POST /webhook HTTP/1.1" 200 -
2025-08-04 21:48:11,997 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 21:48:11] "POST /webhook HTTP/1.1" 200 -
2025-08-04 21:48:11,999 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 21:48:11] "POST /webhook HTTP/1.1" 200 -
2025-08-04 21:51:22,384 - __main__ - INFO - Starting WhatsApp bot server...
2025-08-04 21:51:24,227 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-04 21:51:26,083 - utils.data_manager - INFO - Successfully loaded 12 user details from database
2025-08-04 21:51:26,289 - services.payment_service - INFO - PaymentService initialized
2025-08-04 21:51:27,878 - handlers.product_sync_handler - INFO - Successfully synced 15 products to data\products.json
2025-08-04 21:51:28,065 - app - INFO - Initial product sync successful on startup
2025-08-04 21:51:28,065 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-04 21:51:30,537 - utils.data_manager - INFO - Successfully loaded 12 user details from database
2025-08-04 21:51:30,734 - services.payment_service - INFO - PaymentService initialized
2025-08-04 21:51:30,735 - __main__ - ERROR - Unexpected error: LeadTracker.__init__() missing 1 required positional argument: 'data_manager'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\run.py", line 151, in main
    from app import app
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\app.py", line 55, in <module>
    webhook_handler = WebhookHandler(config)
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\webhook_handler.py", line 22, in __init__
    self.message_processor = MessageProcessor(
                             ~~~~~~~~~~~~~~~~^
        config,
        ^^^^^^^
    ...<4 lines>...
        self.location_service
        ^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\message_processor.py", line 30, in __init__
    self.lead_tracker = LeadTracker(config)
                        ~~~~~~~~~~~^^^^^^^^
TypeError: LeadTracker.__init__() missing 1 required positional argument: 'data_manager'
2025-08-04 22:10:57,189 - __main__ - INFO - Starting WhatsApp bot server...
2025-08-04 22:10:58,925 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-04 22:11:02,065 - utils.data_manager - INFO - Successfully loaded 12 user details from database
2025-08-04 22:11:02,265 - services.payment_service - INFO - PaymentService initialized
2025-08-04 22:11:04,027 - handlers.product_sync_handler - INFO - Successfully synced 15 products to data\products.json
2025-08-04 22:11:04,229 - app - INFO - Initial product sync successful on startup
2025-08-04 22:11:04,229 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-04 22:11:05,857 - utils.data_manager - INFO - Successfully loaded 12 user details from database
2025-08-04 22:11:06,052 - services.payment_service - INFO - PaymentService initialized
2025-08-04 22:11:06,052 - services.lead_tracker - INFO - LeadTracker initialized with DataManager
2025-08-04 22:11:06,053 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-08-04 22:11:06,054 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-08-04 22:11:06,054 - handlers.order_handler - INFO - OrderHandler initialized.
2025-08-04 22:11:06,054 - handlers.base_handler - INFO - PaymentHandler initialized with subaccount ACCT_939kju7zdvsk76y, split percentage 1%
2025-08-04 22:11:06,054 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-08-04 22:11:06,671 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-08-04 22:11:06,672 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-08-04 22:11:06,672 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-08-04 22:11:06,672 - handlers.base_handler - INFO - PaymentHandler initialized with subaccount ACCT_939kju7zdvsk76y, split percentage 1%
2025-08-04 22:11:06,704 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-08-04 22:11:06,705 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-08-04 22:11:29,644 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-08-04 22:11:29,645 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-08-04 22:11:33,099 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 22:11:33,099 - services.lead_tracker - INFO - Updated lead interaction: 2348055614455
2025-08-04 22:11:34,872 - handlers.base_handler - INFO - Session 2348055614455 greeted returning user 'ziga'.
2025-08-04 22:11:37,434 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjBCRENCNTBGMDA1NkVCNTI2NwA="}]}
2025-08-04 22:11:37,445 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjBCRENCNTBGMDA1NkVCNTI2NwA='}]}
2025-08-04 22:11:37,446 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:11:37] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:11:38,309 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:11:38] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:11:39,007 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:11:39] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:11:45,405 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-08-04 22:11:47,540 - utils.data_manager - ERROR - Unexpected error while fetching lead for 2348055614455: float() argument must be a string or a real number, not 'NoneType'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\utils\data_manager.py", line 643, in get_lead_by_phone_number
    result['total_cart_value'] = float(result['total_cart_value'])
                                 ~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: float() argument must be a string or a real number, not 'NoneType'
2025-08-04 22:11:47,544 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-08-04 22:11:47,544 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-08-04 22:11:47,544 - handlers.message_processor - INFO - Session 2348055614455: Redirecting to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-08-04 22:11:47,545 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-08-04 22:11:47,545 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'image', 'image': {'link': 'https://test.mackennytutors.com/wp-content/uploads/2025/06/ganador.jpg', 'caption': 'Our Delicious Menu!'}}
2025-08-04 22:11:48,843 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkI3RUE0Mzg0NTA1QUIwNjEyMgA="}]}
2025-08-04 22:11:48,843 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Hi, I'm Lola from Ganador \n\nTake a look at the menu and type in your order\n\n"}}
2025-08-04 22:11:50,006 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkI4QUMzNUM4RDlBRkIwREEzNAA="}]}
2025-08-04 22:11:50,006 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkI4QUMzNUM4RDlBRkIwREEzNAA='}]}
2025-08-04 22:11:50,007 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:11:50] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:11:50,831 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:11:50] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:11:51,437 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:11:51] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:11:51,649 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:11:51] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:11:51,654 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:11:51] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:11:52,085 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:11:52] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:11:52,478 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:11:52] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:11:59,314 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Jellof rice'}
2025-08-04 22:12:02,298 - utils.data_manager - ERROR - Unexpected error while fetching lead for 2348055614455: float() argument must be a string or a real number, not 'NoneType'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\utils\data_manager.py", line 643, in get_lead_by_phone_number
    result['total_cart_value'] = float(result['total_cart_value'])
                                 ~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: float() argument must be a string or a real number, not 'NoneType'
2025-08-04 22:12:02,299 - handlers.base_handler - INFO - AIHandler: Handling message 'jellof rice' in AI bulk order state for session 2348055614455. Original: 'Jellof rice'
2025-08-04 22:12:05,330 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-08-04 22:12:06,413 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjZEQzEyNjMzNkFEMEJCQ0Q2RAA="}]}
2025-08-04 22:12:06,414 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjZEQzEyNjMzNkFEMEJCQ0Q2RAA='}]}
2025-08-04 22:12:06,414 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:12:06] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:12:07,584 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:12:07] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:12:07,993 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:12:07] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:12:10,482 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-08-04 22:12:12,269 - utils.data_manager - ERROR - Unexpected error while fetching lead for 2348055614455: float() argument must be a string or a real number, not 'NoneType'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\utils\data_manager.py", line 643, in get_lead_by_phone_number
    result['total_cart_value'] = float(result['total_cart_value'])
                                 ~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: float() argument must be a string or a real number, not 'NoneType'
2025-08-04 22:12:12,270 - handlers.base_handler - INFO - AI order confirmed. Cart: {'Jollof Rice': {'item_id': '99', 'quantity': 1, 'price': 1500.0, 'total_price': 1500.0, 'variations': {}}}. Redirecting to order handler.
2025-08-04 22:12:12,271 - handlers.message_processor - INFO - Session 2348055614455: Redirecting to handler 'order_handler' with message 'process_final_order'.
2025-08-04 22:12:12,271 - handlers.order_handler - INFO - AI initiated order processing for session 2348055614455.
2025-08-04 22:12:12,272 - handlers.order_handler - INFO - Address set, proceeding to confirm order for AI-initiated session 2348055614455.
2025-08-04 22:12:14,245 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkE5OTZEQkE2RDNGMEU4MDk1RAA="}]}
2025-08-04 22:12:15,071 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:12:15] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:12:15,534 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:12:15] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:12:15,725 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:12:15] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:12:16,051 - utils.data_manager - ERROR - Unexpected error while fetching lead for 2348055614455: float() argument must be a string or a real number, not 'NoneType'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\utils\data_manager.py", line 643, in get_lead_by_phone_number
    result['total_cart_value'] = float(result['total_cart_value'])
                                 ~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: float() argument must be a string or a real number, not 'NoneType'
2025-08-04 22:12:18,222 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 22:12:18,239 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkE5OTZEQkE2RDNGMEU4MDk1RAA='}]}
2025-08-04 22:12:18,240 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:12:18] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:12:19,659 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'final_confirm'}
2025-08-04 22:12:21,338 - utils.data_manager - ERROR - Unexpected error while fetching lead for 2348055614455: float() argument must be a string or a real number, not 'NoneType'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\utils\data_manager.py", line 644, in get_lead_by_phone_number
    result['final_order_value'] = float(result['final_order_value'])
                                  ~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: float() argument must be a string or a real number, not 'NoneType'
2025-08-04 22:12:23,263 - utils.data_manager - INFO - Order 77 and its details saved to database
2025-08-04 22:12:23,264 - handlers.order_handler - INFO - Order 77 saved to database for session 2348055614455
2025-08-04 22:12:25,600 - utils.data_manager - INFO - User details for 2348055614455 saved to database
2025-08-04 22:12:25,601 - handlers.order_handler - INFO - User details saved for session 2348055614455 during order confirmation.
2025-08-04 22:12:27,315 - utils.data_manager - ERROR - Unexpected error while fetching lead for 2348055614455: float() argument must be a string or a real number, not 'NoneType'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\utils\data_manager.py", line 644, in get_lead_by_phone_number
    result['final_order_value'] = float(result['final_order_value'])
                                  ~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: float() argument must be a string or a real number, not 'NoneType'
2025-08-04 22:12:29,061 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 22:12:29,067 - handlers.message_processor - INFO - Session 2348055614455: Redirecting to handler 'payment_handler' with message 'initiate_payment'.
2025-08-04 22:12:29,067 - handlers.base_handler - INFO - Handling payment processing for session 2348055614455, message: initiate_payment
2025-08-04 22:12:29,068 - handlers.base_handler - INFO - Creating payment link for session 2348055614455
2025-08-04 22:12:32,609 - utils.data_manager - INFO - Order 77 status updated to pending_payment in database
2025-08-04 22:12:32,610 - services.payment_service - INFO - Adding subaccount split: code=ACCT_939kju7zdvsk76y, percentage=1%
2025-08-04 22:12:32,610 - services.payment_service - INFO - Attempting to create payment link for reference: PAY-77 with amount: 150000, email: ziga4455@lola.com
2025-08-04 22:12:33,920 - services.payment_service - ERROR - HTTP error creating Paystack payment link for PAY-77: 404 Client Error: Not Found for url: https://api.paystack.co/transaction/initialize. Response: {"status":false,"message":"Invalid Subaccount.","meta":{"nextStep":"Ensure that the value(s) you're passing are valid."},"type":"validation_error","code":"invalid_params"}
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\services\payment_service.py", line 87, in create_payment_link
    response.raise_for_status()  # Raise HTTPError for bad responses (4xx or 5xx)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\zigam\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 404 Client Error: Not Found for url: https://api.paystack.co/transaction/initialize
2025-08-04 22:12:33,923 - handlers.base_handler - ERROR - Failed to generate payment link for order 77
2025-08-04 22:12:35,234 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjIxMjQxOTRFNTM5RkVCMjI0MgA="}]}
2025-08-04 22:12:36,252 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:12:36] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:12:36,348 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:12:36] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:12:36,707 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:12:36] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:12:36,998 - utils.data_manager - ERROR - Unexpected error while fetching lead for 2348055614455: float() argument must be a string or a real number, not 'NoneType'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\utils\data_manager.py", line 643, in get_lead_by_phone_number
    result['total_cart_value'] = float(result['total_cart_value'])
                                 ~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: float() argument must be a string or a real number, not 'NoneType'
2025-08-04 22:12:38,806 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 22:12:38,812 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjIxMjQxOTRFNTM5RkVCMjI0MgA='}]}
2025-08-04 22:12:38,812 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:12:38] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:13:18,226 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'bad'}
2025-08-04 22:13:20,110 - utils.data_manager - ERROR - Unexpected error while fetching lead for 2348055614455: float() argument must be a string or a real number, not 'NoneType'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\utils\data_manager.py", line 644, in get_lead_by_phone_number
    result['final_order_value'] = float(result['final_order_value'])
                                  ~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: float() argument must be a string or a real number, not 'NoneType'
2025-08-04 22:13:20,112 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Please select 'Checkout', 'Order More', 'Other Options', or type 'remove' or 'cancel'."}}
2025-08-04 22:13:21,200 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjJEOTY2MEExRDU1NEE0MkFCMAA="}]}
2025-08-04 22:13:22,185 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:13:22] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:13:22,882 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:13:22] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:13:23,476 - utils.data_manager - ERROR - Unexpected error while fetching lead for 2348055614455: float() argument must be a string or a real number, not 'NoneType'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\utils\data_manager.py", line 644, in get_lead_by_phone_number
    result['final_order_value'] = float(result['final_order_value'])
                                  ~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: float() argument must be a string or a real number, not 'NoneType'
2025-08-04 22:13:25,862 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 22:13:25,868 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjJEOTY2MEExRDU1NEE0MkFCMAA='}]}
2025-08-04 22:13:25,868 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:13:25] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:13:28,874 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:13:28] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:13:52,215 - __main__ - INFO - Starting WhatsApp bot server...
2025-08-04 22:13:53,405 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-04 22:13:55,920 - utils.data_manager - INFO - Successfully loaded 12 user details from database
2025-08-04 22:13:56,120 - services.payment_service - INFO - PaymentService initialized
2025-08-04 22:13:57,764 - handlers.product_sync_handler - INFO - Successfully synced 15 products to data\products.json
2025-08-04 22:13:57,969 - app - INFO - Initial product sync successful on startup
2025-08-04 22:13:57,969 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-04 22:13:59,586 - utils.data_manager - INFO - Successfully loaded 12 user details from database
2025-08-04 22:13:59,780 - services.payment_service - INFO - PaymentService initialized
2025-08-04 22:13:59,781 - services.lead_tracker - INFO - LeadTracker initialized with DataManager
2025-08-04 22:13:59,781 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-08-04 22:13:59,783 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-08-04 22:13:59,783 - handlers.order_handler - INFO - OrderHandler initialized.
2025-08-04 22:13:59,784 - handlers.base_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-04 22:13:59,784 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-08-04 22:14:00,456 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-08-04 22:14:00,456 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-08-04 22:14:00,456 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-08-04 22:14:00,457 - handlers.base_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-04 22:14:00,469 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-08-04 22:14:00,469 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-08-04 22:14:30,577 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-08-04 22:14:30,578 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-08-04 22:14:32,818 - utils.data_manager - ERROR - Unexpected error while fetching lead for 2348055614455: float() argument must be a string or a real number, not 'NoneType'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\utils\data_manager.py", line 644, in get_lead_by_phone_number
    result['final_order_value'] = float(result['final_order_value'])
                                  ~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: float() argument must be a string or a real number, not 'NoneType'
2025-08-04 22:14:36,231 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 22:14:36,232 - services.lead_tracker - INFO - Updated lead interaction: 2348055614455
2025-08-04 22:14:38,759 - handlers.base_handler - INFO - Session 2348055614455 greeted returning user 'ziga'.
2025-08-04 22:14:40,332 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkYwMEJFRDEyRUM0OUFERTBCOQA="}]}
2025-08-04 22:14:40,333 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkYwMEJFRDEyRUM0OUFERTBCOQA='}]}
2025-08-04 22:14:40,333 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:14:40] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:14:41,238 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:14:41] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:14:41,814 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:14:41] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:14:46,305 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-08-04 22:14:48,084 - utils.data_manager - ERROR - Unexpected error while fetching lead for 2348055614455: float() argument must be a string or a real number, not 'NoneType'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\utils\data_manager.py", line 643, in get_lead_by_phone_number
    result['total_cart_value'] = float(result['total_cart_value'])
                                 ~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: float() argument must be a string or a real number, not 'NoneType'
2025-08-04 22:14:48,085 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-08-04 22:14:48,085 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-08-04 22:14:48,086 - handlers.message_processor - INFO - Session 2348055614455: Redirecting to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-08-04 22:14:48,086 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-08-04 22:14:48,086 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'image', 'image': {'link': 'https://test.mackennytutors.com/wp-content/uploads/2025/06/ganador.jpg', 'caption': 'Our Delicious Menu!'}}
2025-08-04 22:14:49,246 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjg4QjI3M0FCNDQ4MUU0RTRBRAA="}]}
2025-08-04 22:14:49,247 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Hi, I'm Lola from Ganador \n\nTake a look at the menu and type in your order\n\n"}}
2025-08-04 22:14:50,290 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQ5RDI1OEU0NzQ1QTcxMzc2QwA="}]}
2025-08-04 22:14:50,290 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQ5RDI1OEU0NzQ1QTcxMzc2QwA='}]}
2025-08-04 22:14:50,291 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:14:50] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:14:50,381 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:14:50] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:14:50,847 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:14:50] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:14:51,249 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:14:51] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:14:51,449 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:14:51] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:14:51,629 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:14:51] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:14:52,160 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:14:52] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:14:59,771 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Fried rice'}
2025-08-04 22:15:01,574 - utils.data_manager - ERROR - Unexpected error while fetching lead for 2348055614455: float() argument must be a string or a real number, not 'NoneType'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\utils\data_manager.py", line 643, in get_lead_by_phone_number
    result['total_cart_value'] = float(result['total_cart_value'])
                                 ~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: float() argument must be a string or a real number, not 'NoneType'
2025-08-04 22:15:01,576 - handlers.base_handler - INFO - AIHandler: Handling message 'fried rice' in AI bulk order state for session 2348055614455. Original: 'Fried rice'
2025-08-04 22:15:04,415 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-08-04 22:15:05,472 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjMzQUMyODJEM0I1OTBGMjU1QQA="}]}
2025-08-04 22:15:05,473 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjMzQUMyODJEM0I1OTBGMjU1QQA='}]}
2025-08-04 22:15:05,474 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:15:05] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:15:06,299 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:15:06] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:15:06,975 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:15:06] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:15:08,821 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-08-04 22:15:10,545 - utils.data_manager - ERROR - Unexpected error while fetching lead for 2348055614455: float() argument must be a string or a real number, not 'NoneType'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\utils\data_manager.py", line 643, in get_lead_by_phone_number
    result['total_cart_value'] = float(result['total_cart_value'])
                                 ~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: float() argument must be a string or a real number, not 'NoneType'
2025-08-04 22:15:10,546 - handlers.base_handler - INFO - AI order confirmed. Cart: {'Fried Rice': {'item_id': '100', 'quantity': 1, 'price': 1700.0, 'total_price': 1700.0, 'variations': {}}}. Redirecting to order handler.
2025-08-04 22:15:10,547 - handlers.message_processor - INFO - Session 2348055614455: Redirecting to handler 'order_handler' with message 'process_final_order'.
2025-08-04 22:15:10,547 - handlers.order_handler - INFO - AI initiated order processing for session 2348055614455.
2025-08-04 22:15:10,547 - handlers.order_handler - INFO - Address set, proceeding to confirm order for AI-initiated session 2348055614455.
2025-08-04 22:15:11,622 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjk4QzNCRjIzNDREOTM0NjQ2RAA="}]}
2025-08-04 22:15:12,521 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:15:12] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:15:12,715 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:15:12] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:15:13,391 - utils.data_manager - ERROR - Unexpected error while fetching lead for 2348055614455: float() argument must be a string or a real number, not 'NoneType'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\utils\data_manager.py", line 643, in get_lead_by_phone_number
    result['total_cart_value'] = float(result['total_cart_value'])
                                 ~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: float() argument must be a string or a real number, not 'NoneType'
2025-08-04 22:15:13,406 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:15:13] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:15:14,684 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'final_confirm'}
2025-08-04 22:15:15,119 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 22:15:15,125 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjk4QzNCRjIzNDREOTM0NjQ2RAA='}]}
2025-08-04 22:15:15,126 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:15:15] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:15:16,455 - utils.data_manager - ERROR - Unexpected error while fetching lead for 2348055614455: float() argument must be a string or a real number, not 'NoneType'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\utils\data_manager.py", line 644, in get_lead_by_phone_number
    result['final_order_value'] = float(result['final_order_value'])
                                  ~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: float() argument must be a string or a real number, not 'NoneType'
2025-08-04 22:15:18,373 - utils.data_manager - INFO - Order 78 and its details saved to database
2025-08-04 22:15:18,373 - handlers.order_handler - INFO - Order 78 saved to database for session 2348055614455
2025-08-04 22:15:20,155 - utils.data_manager - INFO - User details for 2348055614455 saved to database
2025-08-04 22:15:20,156 - handlers.order_handler - INFO - User details saved for session 2348055614455 during order confirmation.
2025-08-04 22:15:21,870 - utils.data_manager - ERROR - Unexpected error while fetching lead for 2348055614455: float() argument must be a string or a real number, not 'NoneType'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\utils\data_manager.py", line 644, in get_lead_by_phone_number
    result['final_order_value'] = float(result['final_order_value'])
                                  ~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: float() argument must be a string or a real number, not 'NoneType'
2025-08-04 22:15:23,606 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 22:15:23,612 - handlers.message_processor - INFO - Session 2348055614455: Redirecting to handler 'payment_handler' with message 'initiate_payment'.
2025-08-04 22:15:23,612 - handlers.base_handler - INFO - Handling payment processing for session 2348055614455, message: initiate_payment
2025-08-04 22:15:23,612 - handlers.base_handler - INFO - Creating payment link for session 2348055614455
2025-08-04 22:15:27,302 - utils.data_manager - INFO - Order 78 status updated to pending_payment in database
2025-08-04 22:15:27,303 - services.payment_service - INFO - Adding subaccount split: code=ACCT_u9knhyzn5eq4iop, percentage=1%
2025-08-04 22:15:27,303 - services.payment_service - INFO - Attempting to create payment link for reference: PAY-78 with amount: 170000, email: ziga4455@lola.com
2025-08-04 22:15:28,194 - services.payment_service - INFO - Payment link created for ziga ziga (2348055614455), URL: https://checkout.paystack.com/2sholiw2o2f77ay
2025-08-04 22:15:28,195 - handlers.base_handler - INFO - Starting payment monitoring for order 78, reference PAY-78
2025-08-04 22:15:28,195 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-78
2025-08-04 22:15:29,146 - services.payment_service - WARNING - Payment not successful for reference PAY-78. Paystack status: abandoned. Response: {'status': True, 'message': 'Verification successful', 'data': {'id': 5209269350, 'domain': 'test', 'status': 'abandoned', 'reference': 'PAY-78', 'receipt_number': None, 'amount': 170000, 'message': None, 'gateway_response': 'The transaction was not completed', 'paid_at': None, 'created_at': '2025-08-04T21:15:28.000Z', 'channel': 'card', 'currency': 'NGN', 'ip_address': '216.131.83.116, 104.23.187.86, 172.31.62.52', 'metadata': {'customer_name': 'ziga', 'customer_phone': '2348055614455', 'first_name': 'ziga', 'last_name': 'ziga', 'order_id': '78', 'delivery_address': 'lagos'}, 'log': None, 'fees': None, 'fees_split': {'paystack': 2550, 'integration': '1700', 'subaccount': 165750, 'params': {'bearer': 'subaccount', 'transaction_charge': '1700', 'percentage_charge': '0'}}, 'authorization': {}, 'customer': {'id': 296816511, 'first_name': None, 'last_name': None, 'email': 'ziga4455@lola.com', 'customer_code': 'CUS_3maokfy2as1d6qe', 'phone': None, 'metadata': None, 'risk_action': 'default', 'international_format_phone': None}, 'plan': None, 'split': {}, 'order_id': None, 'paidAt': None, 'createdAt': '2025-08-04T21:15:28.000Z', 'requested_amount': 170000, 'pos_transaction_data': None, 'source': None, 'fees_breakdown': None, 'connect': None, 'transaction_date': '2025-08-04T21:15:28.000Z', 'plan_object': {}, 'subaccount': {'id': 1381359, 'subaccount_code': 'ACCT_u9knhyzn5eq4iop', 'business_name': 'MAKINDE VICTOR OLUWASEGUN', 'description': 'MAKINDE VICTOR OLUWASEGUN', 'primary_contact_name': None, 'primary_contact_email': None, 'primary_contact_phone': None, 'metadata': None, 'percentage_charge': 0, 'settlement_bank': 'First City Monument Bank', 'bank_id': 8, 'account_number': '4955073017', 'currency': 'NGN', 'active': True, 'is_verified': True}}}
2025-08-04 22:15:29,147 - handlers.base_handler - INFO - Payment not yet verified for order 78, attempt 1/15
2025-08-04 22:15:29,148 - handlers.base_handler - INFO - Payment link created successfully for order 78 with subaccount ACCT_u9knhyzn5eq4iop
2025-08-04 22:15:29,148 - handlers.base_handler - ERROR - Unexpected error while fetching order items for order 78: 'PaymentHandler' object has no attribute 'db_params'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\payment_handler.py", line 183, in _get_order_items_from_db
    with psycopg2.connect(**self.db_params) as conn:
                            ^^^^^^^^^^^^^^
AttributeError: 'PaymentHandler' object has no attribute 'db_params'
2025-08-04 22:15:30,249 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkJGNERCRkI0RjI3MDI4MzNGMQA="}]}
2025-08-04 22:15:31,124 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:15:31] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:15:31,810 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:15:31] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:15:31,958 - utils.data_manager - ERROR - Unexpected error while fetching lead for 2348055614455: float() argument must be a string or a real number, not 'NoneType'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\utils\data_manager.py", line 643, in get_lead_by_phone_number
    result['total_cart_value'] = float(result['total_cart_value'])
                                 ~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: float() argument must be a string or a real number, not 'NoneType'
2025-08-04 22:15:33,632 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 22:15:33,638 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkJGNERCRkI0RjI3MDI4MzNGMQA='}]}
2025-08-04 22:15:33,639 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:15:33] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:15:52,725 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Paid'}
2025-08-04 22:15:54,429 - utils.data_manager - ERROR - Unexpected error while fetching lead for 2348055614455: float() argument must be a string or a real number, not 'NoneType'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\utils\data_manager.py", line 644, in get_lead_by_phone_number
    result['final_order_value'] = float(result['final_order_value'])
                                  ~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: float() argument must be a string or a real number, not 'NoneType'
2025-08-04 22:15:54,430 - handlers.base_handler - INFO - Received 'paid' command for session 2348055614455, attempting manual verification for ref: PAY-78
2025-08-04 22:15:54,430 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-78
2025-08-04 22:15:55,261 - services.payment_service - INFO - Payment verified successfully for reference PAY-78. Status: success
2025-08-04 22:15:57,006 - handlers.base_handler - INFO - Manual payment verification successful for order 78
2025-08-04 22:15:57,006 - handlers.base_handler - INFO - Payment monitoring stopped for session 2348055614455
2025-08-04 22:15:58,711 - utils.data_manager - INFO - Order 78 status updated to confirmed in database
2025-08-04 22:16:00,405 - utils.data_manager - ERROR - Unexpected error while fetching lead for 2348055614455: float() argument must be a string or a real number, not 'NoneType'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\utils\data_manager.py", line 644, in get_lead_by_phone_number
    result['final_order_value'] = float(result['final_order_value'])
                                  ~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: float() argument must be a string or a real number, not 'NoneType'
2025-08-04 22:16:02,563 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 22:16:02,569 - handlers.base_handler - ERROR - Unexpected error while fetching order items for order 78: 'PaymentHandler' object has no attribute 'db_params'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\payment_handler.py", line 183, in _get_order_items_from_db
    with psycopg2.connect(**self.db_params) as conn:
                            ^^^^^^^^^^^^^^
AttributeError: 'PaymentHandler' object has no attribute 'db_params'
2025-08-04 22:16:04,389 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkFDQzg2QkQwRTVDOTZGNkJCNAA="}]}
2025-08-04 22:16:04,390 - handlers.feedback_handler - INFO - Initiated feedback collection for order 78, session 2348055614455
2025-08-04 22:16:05,235 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:16:05] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:16:05,820 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:16:05] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:16:06,061 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkRFNzkwOEQ4Qzc4MDhFRDk0OAA="}]}
2025-08-04 22:16:06,062 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'message': 'Payment confirmed and feedback initiated'}
2025-08-04 22:16:06,062 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:16:06] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:16:06,374 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:16:06] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:16:06,630 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:16:06] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:16:07,002 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:16:07] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:29:09,486 - __main__ - INFO - Starting WhatsApp bot server...
2025-08-04 22:29:11,452 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-04 22:29:13,743 - utils.data_manager - INFO - Successfully loaded 12 user details from database
2025-08-04 22:29:13,923 - services.payment_service - INFO - PaymentService initialized
2025-08-04 22:29:15,475 - handlers.product_sync_handler - INFO - Successfully synced 15 products to data\products.json
2025-08-04 22:29:15,666 - app - INFO - Initial product sync successful on startup
2025-08-04 22:29:15,667 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-04 22:29:17,235 - utils.data_manager - INFO - Successfully loaded 12 user details from database
2025-08-04 22:29:17,431 - services.payment_service - INFO - PaymentService initialized
2025-08-04 22:29:17,431 - services.lead_tracker - INFO - LeadTracker initialized with DataManager
2025-08-04 22:29:17,432 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-08-04 22:29:17,443 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-08-04 22:29:17,443 - handlers.order_handler - INFO - OrderHandler initialized.
2025-08-04 22:29:17,444 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-04 22:29:17,444 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-08-04 22:29:17,889 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-08-04 22:29:17,889 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-08-04 22:29:17,890 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-08-04 22:29:17,890 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-04 22:29:17,922 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-08-04 22:29:17,922 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-08-04 22:29:22,926 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-08-04 22:29:22,927 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-08-04 22:29:26,651 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 22:29:26,651 - services.lead_tracker - INFO - Updated lead interaction: 2348055614455
2025-08-04 22:29:28,359 - handlers.base_handler - INFO - Session 2348055614455 greeted returning user 'ziga'.
2025-08-04 22:29:29,637 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjExNTJCNzJCQ0RBMUNDNEZBNwA="}]}
2025-08-04 22:29:29,638 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjExNTJCNzJCQ0RBMUNDNEZBNwA='}]}
2025-08-04 22:29:29,639 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:29:29] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:29:30,709 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:29:30] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:29:30,915 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:29:30] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:29:31,730 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:29:31] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:29:37,768 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-08-04 22:29:41,120 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 22:29:41,121 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-04 22:29:41,121 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-08-04 22:29:41,122 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-08-04 22:29:41,122 - handlers.message_processor - INFO - Session 2348055614455: Redirecting to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-08-04 22:29:41,122 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-08-04 22:29:41,122 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'image', 'image': {'link': 'https://test.mackennytutors.com/wp-content/uploads/2025/06/ganador.jpg', 'caption': 'Our Delicious Menu!'}}
2025-08-04 22:29:42,390 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkQwRENBNjE1QzNDMjM3MzhDQgA="}]}
2025-08-04 22:29:42,392 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Hi, I'm Lola from Ganador \n\nTake a look at the menu and type in your order\n\n"}}
2025-08-04 22:29:43,414 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkNEOUMzNTQ5OTg5OTk5M0U2MwA="}]}
2025-08-04 22:29:43,415 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkNEOUMzNTQ5OTg5OTk5M0U2MwA='}]}
2025-08-04 22:29:43,415 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:29:43] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:29:44,560 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:29:44] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:29:44,954 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:29:44] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:29:45,060 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:29:45] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:29:45,342 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:29:45] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:29:45,440 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:29:45] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:29:45,816 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:29:45] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:29:50,755 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Jellof rice'}
2025-08-04 22:29:54,171 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 22:29:54,172 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-04 22:29:54,172 - handlers.base_handler - INFO - AIHandler: Handling message 'jellof rice' in AI bulk order state for session 2348055614455. Original: 'Jellof rice'
2025-08-04 22:29:57,192 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-08-04 22:29:58,539 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjUxQUE0QzY5QTdGM0Y3OUNDOQA="}]}
2025-08-04 22:29:58,540 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjUxQUE0QzY5QTdGM0Y3OUNDOQA='}]}
2025-08-04 22:29:58,541 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:29:58] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:29:59,224 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:29:59] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:29:59,409 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:29:59] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:29:59,888 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:29:59] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:30:04,089 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-08-04 22:30:07,664 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 22:30:07,664 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-04 22:30:07,665 - handlers.base_handler - INFO - AI order confirmed. Cart: {'Jollof Rice': {'item_id': '99', 'quantity': 1, 'price': 1500.0, 'total_price': 1500.0, 'variations': {}}}. Redirecting to order handler.
2025-08-04 22:30:07,665 - handlers.message_processor - INFO - Session 2348055614455: Redirecting to handler 'order_handler' with message 'process_final_order'.
2025-08-04 22:30:07,665 - handlers.order_handler - INFO - AI initiated order processing for session 2348055614455.
2025-08-04 22:30:07,666 - handlers.order_handler - INFO - Address set, proceeding to confirm order for AI-initiated session 2348055614455.
2025-08-04 22:30:08,839 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkRENTJFNzIyMjFFRjhENEMyNQA="}]}
2025-08-04 22:30:09,936 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:30:09] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:30:09,938 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:30:09] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:30:10,850 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:30:10] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:30:13,012 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 22:30:13,019 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkRENTJFNzIyMjFFRjhENEMyNQA='}]}
2025-08-04 22:30:13,019 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:30:13] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:30:13,086 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'final_confirm'}
2025-08-04 22:30:16,486 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 22:30:16,486 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-04 22:30:18,518 - utils.data_manager - INFO - Order 79 and its details saved to database
2025-08-04 22:30:18,519 - handlers.order_handler - INFO - Order 79 saved to database for session 2348055614455
2025-08-04 22:30:20,201 - utils.data_manager - INFO - User details for 2348055614455 saved to database
2025-08-04 22:30:20,202 - handlers.order_handler - INFO - User details saved for session 2348055614455 during order confirmation.
2025-08-04 22:30:23,597 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 22:30:23,603 - handlers.message_processor - INFO - Session 2348055614455: Redirecting to handler 'payment_handler' with message 'initiate_payment'.
2025-08-04 22:30:23,603 - handlers.payment_handler - INFO - Handling payment processing for session 2348055614455, message: initiate_payment
2025-08-04 22:30:23,603 - handlers.payment_handler - INFO - Creating payment link for session 2348055614455
2025-08-04 22:30:28,977 - utils.data_manager - INFO - Order 79 status updated to pending_payment in database
2025-08-04 22:30:28,978 - services.payment_service - INFO - Adding subaccount split: code=ACCT_u9knhyzn5eq4iop, percentage=1%
2025-08-04 22:30:28,978 - services.payment_service - INFO - Attempting to create payment link for reference: PAY-79 with amount: 150000, email: ziga4455@lola.com
2025-08-04 22:30:30,197 - services.payment_service - INFO - Payment link created for ziga ziga (2348055614455), URL: https://checkout.paystack.com/ft1md6qctr5nkva
2025-08-04 22:30:30,197 - handlers.payment_handler - INFO - Starting payment monitoring for order 79, reference PAY-79
2025-08-04 22:30:30,197 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-79
2025-08-04 22:30:31,152 - services.payment_service - WARNING - Payment not successful for reference PAY-79. Paystack status: abandoned. Response: {'status': True, 'message': 'Verification successful', 'data': {'id': 5209290767, 'domain': 'test', 'status': 'abandoned', 'reference': 'PAY-79', 'receipt_number': None, 'amount': 150000, 'message': None, 'gateway_response': 'The transaction was not completed', 'paid_at': None, 'created_at': '2025-08-04T21:30:30.000Z', 'channel': 'card', 'currency': 'NGN', 'ip_address': '216.131.83.116, 172.70.231.62, 172.31.63.81', 'metadata': {'customer_name': 'ziga', 'customer_phone': '2348055614455', 'first_name': 'ziga', 'last_name': 'ziga', 'order_id': '79', 'delivery_address': 'lagos'}, 'log': None, 'fees': None, 'fees_split': {'paystack': 2250, 'integration': '1500', 'subaccount': 146250, 'params': {'bearer': 'subaccount', 'transaction_charge': '1500', 'percentage_charge': '0'}}, 'authorization': {}, 'customer': {'id': 296816511, 'first_name': None, 'last_name': None, 'email': 'ziga4455@lola.com', 'customer_code': 'CUS_3maokfy2as1d6qe', 'phone': None, 'metadata': None, 'risk_action': 'default', 'international_format_phone': None}, 'plan': None, 'split': {}, 'order_id': None, 'paidAt': None, 'createdAt': '2025-08-04T21:30:30.000Z', 'requested_amount': 150000, 'pos_transaction_data': None, 'source': None, 'fees_breakdown': None, 'connect': None, 'transaction_date': '2025-08-04T21:30:30.000Z', 'plan_object': {}, 'subaccount': {'id': 1381359, 'subaccount_code': 'ACCT_u9knhyzn5eq4iop', 'business_name': 'MAKINDE VICTOR OLUWASEGUN', 'description': 'MAKINDE VICTOR OLUWASEGUN', 'primary_contact_name': None, 'primary_contact_email': None, 'primary_contact_phone': None, 'metadata': None, 'percentage_charge': 0, 'settlement_bank': 'First City Monument Bank', 'bank_id': 8, 'account_number': '4955073017', 'currency': 'NGN', 'active': True, 'is_verified': True}}}
2025-08-04 22:30:31,153 - handlers.payment_handler - INFO - Payment not yet verified for order 79, attempt 1/15
2025-08-04 22:30:31,154 - handlers.payment_handler - INFO - Payment link created successfully for order 79 with subaccount ACCT_u9knhyzn5eq4iop
2025-08-04 22:30:32,835 - handlers.payment_handler - ERROR - Error retrieving order 79: 'DataManager' object has no attribute 'get_order_items'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\payment_handler.py", line 190, in _get_order_items_from_db
    order_data['items'] = self.data_manager.get_order_items(order_id)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'DataManager' object has no attribute 'get_order_items'. Did you mean: 'get_order_by_id'?
2025-08-04 22:30:32,838 - handlers.payment_handler - ERROR - Error creating payment link for session 2348055614455: 'NoneType' object has no attribute 'get'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\payment_handler.py", line 149, in create_payment_link
    formatted_items = self._format_order_items(order_data.get("items", []))
                                               ^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'get'
2025-08-04 22:30:34,139 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjI1Njg5RTUzNEE4NTQ2NjUyRgA="}]}
2025-08-04 22:30:35,177 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:30:35] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:30:35,180 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:30:35] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:30:35,841 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:30:35] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:30:37,463 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 22:30:37,488 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjI1Njg5RTUzNEE4NTQ2NjUyRgA='}]}
2025-08-04 22:30:37,489 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:30:37] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:31:31,165 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-79
2025-08-04 22:31:32,264 - services.payment_service - WARNING - Payment not successful for reference PAY-79. Paystack status: abandoned. Response: {'status': True, 'message': 'Verification successful', 'data': {'id': 5209290767, 'domain': 'test', 'status': 'abandoned', 'reference': 'PAY-79', 'receipt_number': None, 'amount': 150000, 'message': None, 'gateway_response': 'The transaction was not completed', 'paid_at': None, 'created_at': '2025-08-04T21:30:30.000Z', 'channel': 'card', 'currency': 'NGN', 'ip_address': '216.131.83.116, 172.70.231.62, 172.31.63.81', 'metadata': {'customer_name': 'ziga', 'customer_phone': '2348055614455', 'first_name': 'ziga', 'last_name': 'ziga', 'order_id': '79', 'delivery_address': 'lagos'}, 'log': None, 'fees': None, 'fees_split': {'paystack': 2250, 'integration': '1500', 'subaccount': 146250, 'params': {'bearer': 'subaccount', 'transaction_charge': '1500', 'percentage_charge': '0'}}, 'authorization': {}, 'customer': {'id': 296816511, 'first_name': None, 'last_name': None, 'email': 'ziga4455@lola.com', 'customer_code': 'CUS_3maokfy2as1d6qe', 'phone': None, 'metadata': None, 'risk_action': 'default', 'international_format_phone': None}, 'plan': None, 'split': {}, 'order_id': None, 'paidAt': None, 'createdAt': '2025-08-04T21:30:30.000Z', 'requested_amount': 150000, 'pos_transaction_data': None, 'source': None, 'fees_breakdown': None, 'connect': None, 'transaction_date': '2025-08-04T21:30:30.000Z', 'plan_object': {}, 'subaccount': {'id': 1381359, 'subaccount_code': 'ACCT_u9knhyzn5eq4iop', 'business_name': 'MAKINDE VICTOR OLUWASEGUN', 'description': 'MAKINDE VICTOR OLUWASEGUN', 'primary_contact_name': None, 'primary_contact_email': None, 'primary_contact_phone': None, 'metadata': None, 'percentage_charge': 0, 'settlement_bank': 'First City Monument Bank', 'bank_id': 8, 'account_number': '4955073017', 'currency': 'NGN', 'active': True, 'is_verified': True}}}
2025-08-04 22:31:32,265 - handlers.payment_handler - INFO - Payment not yet verified for order 79, attempt 2/15
2025-08-04 22:32:32,268 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-79
2025-08-04 22:32:33,454 - services.payment_service - WARNING - Payment not successful for reference PAY-79. Paystack status: abandoned. Response: {'status': True, 'message': 'Verification successful', 'data': {'id': 5209290767, 'domain': 'test', 'status': 'abandoned', 'reference': 'PAY-79', 'receipt_number': None, 'amount': 150000, 'message': None, 'gateway_response': 'The transaction was not completed', 'paid_at': None, 'created_at': '2025-08-04T21:30:30.000Z', 'channel': 'card', 'currency': 'NGN', 'ip_address': '216.131.83.116, 172.70.231.62, 172.31.63.81', 'metadata': {'customer_name': 'ziga', 'customer_phone': '2348055614455', 'first_name': 'ziga', 'last_name': 'ziga', 'order_id': '79', 'delivery_address': 'lagos'}, 'log': None, 'fees': None, 'fees_split': {'paystack': 2250, 'integration': '1500', 'subaccount': 146250, 'params': {'bearer': 'subaccount', 'transaction_charge': '1500', 'percentage_charge': '0'}}, 'authorization': {}, 'customer': {'id': 296816511, 'first_name': None, 'last_name': None, 'email': 'ziga4455@lola.com', 'customer_code': 'CUS_3maokfy2as1d6qe', 'phone': None, 'metadata': None, 'risk_action': 'default', 'international_format_phone': None}, 'plan': None, 'split': {}, 'order_id': None, 'paidAt': None, 'createdAt': '2025-08-04T21:30:30.000Z', 'requested_amount': 150000, 'pos_transaction_data': None, 'source': None, 'fees_breakdown': None, 'connect': None, 'transaction_date': '2025-08-04T21:30:30.000Z', 'plan_object': {}, 'subaccount': {'id': 1381359, 'subaccount_code': 'ACCT_u9knhyzn5eq4iop', 'business_name': 'MAKINDE VICTOR OLUWASEGUN', 'description': 'MAKINDE VICTOR OLUWASEGUN', 'primary_contact_name': None, 'primary_contact_email': None, 'primary_contact_phone': None, 'metadata': None, 'percentage_charge': 0, 'settlement_bank': 'First City Monument Bank', 'bank_id': 8, 'account_number': '4955073017', 'currency': 'NGN', 'active': True, 'is_verified': True}}}
2025-08-04 22:32:33,455 - handlers.payment_handler - INFO - Payment not yet verified for order 79, attempt 3/15
2025-08-04 22:33:33,459 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-79
2025-08-04 22:33:34,238 - services.payment_service - WARNING - Payment not successful for reference PAY-79. Paystack status: abandoned. Response: {'status': True, 'message': 'Verification successful', 'data': {'id': 5209290767, 'domain': 'test', 'status': 'abandoned', 'reference': 'PAY-79', 'receipt_number': None, 'amount': 150000, 'message': None, 'gateway_response': 'The transaction was not completed', 'paid_at': None, 'created_at': '2025-08-04T21:30:30.000Z', 'channel': 'card', 'currency': 'NGN', 'ip_address': '216.131.83.116, 172.70.231.62, 172.31.63.81', 'metadata': {'customer_name': 'ziga', 'customer_phone': '2348055614455', 'first_name': 'ziga', 'last_name': 'ziga', 'order_id': '79', 'delivery_address': 'lagos'}, 'log': None, 'fees': None, 'fees_split': {'paystack': 2250, 'integration': '1500', 'subaccount': 146250, 'params': {'bearer': 'subaccount', 'transaction_charge': '1500', 'percentage_charge': '0'}}, 'authorization': {}, 'customer': {'id': 296816511, 'first_name': None, 'last_name': None, 'email': 'ziga4455@lola.com', 'customer_code': 'CUS_3maokfy2as1d6qe', 'phone': None, 'metadata': None, 'risk_action': 'default', 'international_format_phone': None}, 'plan': None, 'split': {}, 'order_id': None, 'paidAt': None, 'createdAt': '2025-08-04T21:30:30.000Z', 'requested_amount': 150000, 'pos_transaction_data': None, 'source': None, 'fees_breakdown': None, 'connect': None, 'transaction_date': '2025-08-04T21:30:30.000Z', 'plan_object': {}, 'subaccount': {'id': 1381359, 'subaccount_code': 'ACCT_u9knhyzn5eq4iop', 'business_name': 'MAKINDE VICTOR OLUWASEGUN', 'description': 'MAKINDE VICTOR OLUWASEGUN', 'primary_contact_name': None, 'primary_contact_email': None, 'primary_contact_phone': None, 'metadata': None, 'percentage_charge': 0, 'settlement_bank': 'First City Monument Bank', 'bank_id': 8, 'account_number': '4955073017', 'currency': 'NGN', 'active': True, 'is_verified': True}}}
2025-08-04 22:33:34,239 - handlers.payment_handler - INFO - Payment not yet verified for order 79, attempt 4/15
2025-08-04 22:34:34,254 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-79
2025-08-04 22:34:34,989 - services.payment_service - WARNING - Payment not successful for reference PAY-79. Paystack status: abandoned. Response: {'status': True, 'message': 'Verification successful', 'data': {'id': 5209290767, 'domain': 'test', 'status': 'abandoned', 'reference': 'PAY-79', 'receipt_number': None, 'amount': 150000, 'message': None, 'gateway_response': 'The transaction was not completed', 'paid_at': None, 'created_at': '2025-08-04T21:30:30.000Z', 'channel': 'card', 'currency': 'NGN', 'ip_address': '216.131.83.116, 172.70.231.62, 172.31.63.81', 'metadata': {'customer_name': 'ziga', 'customer_phone': '2348055614455', 'first_name': 'ziga', 'last_name': 'ziga', 'order_id': '79', 'delivery_address': 'lagos'}, 'log': None, 'fees': None, 'fees_split': {'paystack': 2250, 'integration': '1500', 'subaccount': 146250, 'params': {'bearer': 'subaccount', 'transaction_charge': '1500', 'percentage_charge': '0'}}, 'authorization': {}, 'customer': {'id': 296816511, 'first_name': None, 'last_name': None, 'email': 'ziga4455@lola.com', 'customer_code': 'CUS_3maokfy2as1d6qe', 'phone': None, 'metadata': None, 'risk_action': 'default', 'international_format_phone': None}, 'plan': None, 'split': {}, 'order_id': None, 'paidAt': None, 'createdAt': '2025-08-04T21:30:30.000Z', 'requested_amount': 150000, 'pos_transaction_data': None, 'source': None, 'fees_breakdown': None, 'connect': None, 'transaction_date': '2025-08-04T21:30:30.000Z', 'plan_object': {}, 'subaccount': {'id': 1381359, 'subaccount_code': 'ACCT_u9knhyzn5eq4iop', 'business_name': 'MAKINDE VICTOR OLUWASEGUN', 'description': 'MAKINDE VICTOR OLUWASEGUN', 'primary_contact_name': None, 'primary_contact_email': None, 'primary_contact_phone': None, 'metadata': None, 'percentage_charge': 0, 'settlement_bank': 'First City Monument Bank', 'bank_id': 8, 'account_number': '4955073017', 'currency': 'NGN', 'active': True, 'is_verified': True}}}
2025-08-04 22:34:34,990 - handlers.payment_handler - INFO - Payment not yet verified for order 79, attempt 5/15
2025-08-04 22:34:36,960 - services.payment_service - INFO - Adding subaccount split: code=ACCT_u9knhyzn5eq4iop, percentage=1%
2025-08-04 22:34:36,960 - services.payment_service - INFO - Attempting to create payment link for reference: PAY-79 with amount: 150000, email: ziga4455@lola.com
2025-08-04 22:34:37,950 - services.payment_service - ERROR - HTTP error creating Paystack payment link for PAY-79: 400 Client Error: Bad Request for url: https://api.paystack.co/transaction/initialize. Response: {"status":false,"message":"Duplicate Transaction Reference","meta":{"nextStep":"Try and create the Transaction or Charge with a new reference"},"type":"validation_error","code":"duplicate_reference"}
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\services\payment_service.py", line 87, in create_payment_link
    response.raise_for_status()  # Raise HTTPError for bad responses (4xx or 5xx)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\zigam\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://api.paystack.co/transaction/initialize
2025-08-04 22:34:37,977 - handlers.payment_handler - WARNING - Could not generate new payment link for reminder for order 79.
2025-08-04 22:35:34,392 - __main__ - INFO - Starting WhatsApp bot server...
2025-08-04 22:35:35,746 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-04 22:35:37,466 - utils.data_manager - INFO - Successfully loaded 12 user details from database
2025-08-04 22:35:37,646 - services.payment_service - INFO - PaymentService initialized
2025-08-04 22:35:39,135 - handlers.product_sync_handler - INFO - Successfully synced 15 products to data\products.json
2025-08-04 22:35:39,314 - app - INFO - Initial product sync successful on startup
2025-08-04 22:35:39,314 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-04 22:35:41,448 - utils.data_manager - INFO - Successfully loaded 12 user details from database
2025-08-04 22:35:41,628 - services.payment_service - INFO - PaymentService initialized
2025-08-04 22:35:41,629 - services.lead_tracker - INFO - LeadTracker initialized with DataManager
2025-08-04 22:35:41,629 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-08-04 22:35:41,630 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-08-04 22:35:41,630 - handlers.order_handler - INFO - OrderHandler initialized.
2025-08-04 22:35:41,630 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-04 22:35:41,630 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-08-04 22:35:42,056 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-08-04 22:35:42,056 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-08-04 22:35:42,056 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-08-04 22:35:42,056 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-04 22:35:42,072 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-08-04 22:35:42,072 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-08-04 22:35:52,582 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-08-04 22:35:52,583 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-08-04 22:35:56,040 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 22:35:56,040 - services.lead_tracker - INFO - Updated lead interaction: 2348055614455
2025-08-04 22:35:57,784 - handlers.base_handler - INFO - Session 2348055614455 greeted returning user 'ziga'.
2025-08-04 22:35:59,409 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkU2NjRENEVCMTMwQTYyODlGRgA="}]}
2025-08-04 22:35:59,409 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkU2NjRENEVCMTMwQTYyODlGRgA='}]}
2025-08-04 22:35:59,410 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:35:59] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:36:00,472 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:36:00] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:36:00,525 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:36:00] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:36:00,855 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:36:00] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:36:02,883 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-08-04 22:36:06,301 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 22:36:06,301 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-04 22:36:06,302 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-08-04 22:36:06,302 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-08-04 22:36:06,302 - handlers.message_processor - INFO - Session 2348055614455: Redirecting to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-08-04 22:36:06,303 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-08-04 22:36:06,303 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'image', 'image': {'link': 'https://test.mackennytutors.com/wp-content/uploads/2025/06/ganador.jpg', 'caption': 'Our Delicious Menu!'}}
2025-08-04 22:36:07,649 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjUwQzAxOERGQzZDNTkyQjQyNAA="}]}
2025-08-04 22:36:07,650 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Hi, I'm Lola from Ganador \n\nTake a look at the menu and type in your order\n\n"}}
2025-08-04 22:36:08,866 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjVBQzdDMTlFQ0U1MzM4RkM5NQA="}]}
2025-08-04 22:36:08,867 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjVBQzdDMTlFQ0U1MzM4RkM5NQA='}]}
2025-08-04 22:36:08,868 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:36:08] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:36:08,916 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:36:08] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:36:08,921 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:36:08] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:36:09,688 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:36:09] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:36:09,880 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:36:09] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:36:10,027 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:36:10] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:36:10,769 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:36:10] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:36:12,015 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Jellof rice'}
2025-08-04 22:36:15,416 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 22:36:15,416 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-04 22:36:15,417 - handlers.base_handler - INFO - AIHandler: Handling message 'jellof rice' in AI bulk order state for session 2348055614455. Original: 'Jellof rice'
2025-08-04 22:36:17,904 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-08-04 22:36:19,385 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjgwRkVGMzQwMzVBOTk2ODFEMAA="}]}
2025-08-04 22:36:19,386 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjgwRkVGMzQwMzVBOTk2ODFEMAA='}]}
2025-08-04 22:36:19,387 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:36:19] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:36:20,565 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:36:20] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:36:20,750 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:36:20] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:36:20,957 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:36:20] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:36:22,718 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-08-04 22:36:26,171 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 22:36:26,172 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-04 22:36:26,172 - handlers.base_handler - INFO - AI order confirmed. Cart: {'Jollof Rice': {'item_id': '99', 'quantity': 1, 'price': 1500.0, 'total_price': 1500.0, 'variations': {}}}. Redirecting to order handler.
2025-08-04 22:36:26,172 - handlers.message_processor - INFO - Session 2348055614455: Redirecting to handler 'order_handler' with message 'process_final_order'.
2025-08-04 22:36:26,172 - handlers.order_handler - INFO - AI initiated order processing for session 2348055614455.
2025-08-04 22:36:26,173 - handlers.order_handler - INFO - Address set, proceeding to confirm order for AI-initiated session 2348055614455.
2025-08-04 22:36:27,435 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkY0RUVFNkJCMDE5RDMzMUM3MAA="}]}
2025-08-04 22:36:28,314 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:36:28] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:36:28,494 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:36:28] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:36:29,009 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:36:29] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:36:30,848 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 22:36:30,854 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkY0RUVFNkJCMDE5RDMzMUM3MAA='}]}
2025-08-04 22:36:30,854 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:36:30] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:36:31,700 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'final_confirm'}
2025-08-04 22:36:35,018 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 22:36:35,018 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-04 22:36:36,849 - utils.data_manager - INFO - Order 80 and its details saved to database
2025-08-04 22:36:36,850 - handlers.order_handler - INFO - Order 80 saved to database for session 2348055614455
2025-08-04 22:36:38,498 - utils.data_manager - INFO - User details for 2348055614455 saved to database
2025-08-04 22:36:38,499 - handlers.order_handler - INFO - User details saved for session 2348055614455 during order confirmation.
2025-08-04 22:36:41,834 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 22:36:41,841 - handlers.message_processor - INFO - Session 2348055614455: Redirecting to handler 'payment_handler' with message 'initiate_payment'.
2025-08-04 22:36:41,841 - handlers.payment_handler - INFO - Handling payment processing for session 2348055614455, message: initiate_payment
2025-08-04 22:36:41,841 - handlers.payment_handler - INFO - Creating payment link for session 2348055614455
2025-08-04 22:36:45,393 - utils.data_manager - INFO - Order 80 status updated to pending_payment in database
2025-08-04 22:36:45,394 - services.payment_service - INFO - Adding subaccount split: code=ACCT_u9knhyzn5eq4iop, percentage=1%
2025-08-04 22:36:45,395 - services.payment_service - INFO - Attempting to create payment link for reference: PAY-80 with amount: 150000, email: ziga4455@lola.com
2025-08-04 22:36:46,825 - services.payment_service - INFO - Payment link created for ziga ziga (2348055614455), URL: https://checkout.paystack.com/pgqbhz01s3oi4lg
2025-08-04 22:36:46,826 - handlers.payment_handler - INFO - Starting payment monitoring for order 80, reference PAY-80
2025-08-04 22:36:46,826 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-80
2025-08-04 22:36:47,769 - services.payment_service - WARNING - Payment not successful for reference PAY-80. Paystack status: abandoned. Response: {'status': True, 'message': 'Verification successful', 'data': {'id': 5209304063, 'domain': 'test', 'status': 'abandoned', 'reference': 'PAY-80', 'receipt_number': None, 'amount': 150000, 'message': None, 'gateway_response': 'The transaction was not completed', 'paid_at': None, 'created_at': '2025-08-04T21:36:46.000Z', 'channel': 'card', 'currency': 'NGN', 'ip_address': '216.131.83.116, 162.158.62.128, 172.31.68.120', 'metadata': {'customer_name': 'ziga', 'customer_phone': '2348055614455', 'first_name': 'ziga', 'last_name': 'ziga', 'order_id': '80', 'delivery_address': 'lagos'}, 'log': None, 'fees': None, 'fees_split': {'paystack': 2250, 'integration': '1500', 'subaccount': 146250, 'params': {'bearer': 'subaccount', 'transaction_charge': '1500', 'percentage_charge': '0'}}, 'authorization': {}, 'customer': {'id': 296816511, 'first_name': None, 'last_name': None, 'email': 'ziga4455@lola.com', 'customer_code': 'CUS_3maokfy2as1d6qe', 'phone': None, 'metadata': None, 'risk_action': 'default', 'international_format_phone': None}, 'plan': None, 'split': {}, 'order_id': None, 'paidAt': None, 'createdAt': '2025-08-04T21:36:46.000Z', 'requested_amount': 150000, 'pos_transaction_data': None, 'source': None, 'fees_breakdown': None, 'connect': None, 'transaction_date': '2025-08-04T21:36:46.000Z', 'plan_object': {}, 'subaccount': {'id': 1381359, 'subaccount_code': 'ACCT_u9knhyzn5eq4iop', 'business_name': 'MAKINDE VICTOR OLUWASEGUN', 'description': 'MAKINDE VICTOR OLUWASEGUN', 'primary_contact_name': None, 'primary_contact_email': None, 'primary_contact_phone': None, 'metadata': None, 'percentage_charge': 0, 'settlement_bank': 'First City Monument Bank', 'bank_id': 8, 'account_number': '4955073017', 'currency': 'NGN', 'active': True, 'is_verified': True}}}
2025-08-04 22:36:47,769 - handlers.payment_handler - INFO - Payment not yet verified for order 80, attempt 1/15
2025-08-04 22:36:47,770 - handlers.payment_handler - INFO - Payment link created successfully for order 80 with subaccount ACCT_u9knhyzn5eq4iop
2025-08-04 22:36:52,706 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjBDRThFRTA4MTRERDYxN0E2OQA="}]}
2025-08-04 22:36:53,571 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:36:53] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:36:53,759 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:36:53] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:36:54,402 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:36:54] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:36:56,082 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 22:36:56,088 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjBDRThFRTA4MTRERDYxN0E2OQA='}]}
2025-08-04 22:36:56,089 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:36:56] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:37:20,560 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Oaid'}
2025-08-04 22:37:24,433 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 22:37:24,433 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-04 22:37:26,282 - handlers.payment_handler - INFO - User sent message while still awaiting payment for order 80.
2025-08-04 22:37:31,840 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkQ2NTQ4NTVCRTMyMjFEOUY5NgA="}]}
2025-08-04 22:37:33,158 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:37:33] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:37:33,926 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:37:33] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:37:34,501 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:37:34] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:37:35,218 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 22:37:35,224 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkQ2NTQ4NTVCRTMyMjFEOUY5NgA='}]}
2025-08-04 22:37:35,224 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:37:35] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:37:39,565 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Paid'}
2025-08-04 22:37:43,280 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 22:37:43,281 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-04 22:37:43,281 - handlers.payment_handler - INFO - Received 'paid' command for session 2348055614455, attempting manual verification for ref: PAY-80
2025-08-04 22:37:43,281 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-80
2025-08-04 22:37:44,079 - services.payment_service - INFO - Payment verified successfully for reference PAY-80. Status: success
2025-08-04 22:37:45,743 - handlers.payment_handler - INFO - Manual payment verification successful for order 80
2025-08-04 22:37:45,743 - handlers.payment_handler - INFO - Payment monitoring stopped for session 2348055614455
2025-08-04 22:37:47,412 - utils.data_manager - INFO - Order 80 status updated to confirmed in database
2025-08-04 22:37:51,939 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 22:37:56,610 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjhERDIzNUZDQjQ1OTY2OUVBRQA="}]}
2025-08-04 22:37:56,611 - handlers.feedback_handler - INFO - Initiated feedback collection for order 80, session 2348055614455
2025-08-04 22:37:57,724 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:37:57] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:37:57,832 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkVDM0FDNzFGRkJFNzQzQkMxMAA="}]}
2025-08-04 22:37:57,833 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'message': 'Payment confirmed and feedback initiated'}
2025-08-04 22:37:57,833 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:37:57] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:37:57,908 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:37:57] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:37:58,896 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:37:58] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:37:59,079 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:37:59] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:37:59,081 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:37:59] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:37:59,497 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:37:59] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:56:33,455 - __main__ - INFO - Starting WhatsApp bot server...
2025-08-04 22:56:35,272 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-04 22:56:39,495 - utils.data_manager - INFO - Successfully loaded 12 user details from database
2025-08-04 22:56:39,698 - services.payment_service - INFO - PaymentService initialized
2025-08-04 22:56:42,182 - handlers.product_sync_handler - INFO - Successfully synced 15 products to data\products.json
2025-08-04 22:56:42,381 - app - INFO - Initial product sync successful on startup
2025-08-04 22:56:42,381 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-04 22:56:45,588 - utils.data_manager - INFO - Successfully loaded 12 user details from database
2025-08-04 22:56:45,828 - services.payment_service - INFO - PaymentService initialized
2025-08-04 22:56:45,828 - services.lead_tracker - INFO - LeadTracker initialized with DataManager
2025-08-04 22:56:45,828 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-08-04 22:56:45,829 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-08-04 22:56:45,830 - handlers.order_handler - INFO - OrderHandler initialized.
2025-08-04 22:56:45,830 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_939kju7zdvsk76y, split percentage 1%
2025-08-04 22:56:45,830 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-08-04 22:56:46,264 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-08-04 22:56:46,265 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-08-04 22:56:46,265 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-08-04 22:56:46,265 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_939kju7zdvsk76y, split percentage 1%
2025-08-04 22:56:46,294 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-08-04 22:56:46,294 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-08-04 22:56:55,424 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-08-04 22:56:55,424 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-08-04 22:56:58,935 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 22:56:58,935 - services.lead_tracker - INFO - Updated lead interaction: 2348055614455
2025-08-04 22:57:01,814 - handlers.base_handler - INFO - Session 2348055614455 greeted returning user 'ziga'.
2025-08-04 22:57:03,380 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkEwNDY5MEMxOTdGNkYyNDEyRgA="}]}
2025-08-04 22:57:03,382 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkEwNDY5MEMxOTdGNkYyNDEyRgA='}]}
2025-08-04 22:57:03,383 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:57:03] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:57:04,270 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:57:04] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:57:04,458 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:57:04] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:57:05,170 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:57:05] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:57:17,096 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-08-04 22:57:20,496 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 22:57:20,496 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-04 22:57:20,496 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-08-04 22:57:20,497 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-08-04 22:57:20,497 - handlers.message_processor - INFO - Session 2348055614455: Redirecting to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-08-04 22:57:20,497 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-08-04 22:57:20,497 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'image', 'image': {'link': 'https://test.mackennytutors.com/wp-content/uploads/2025/06/ganador.jpg', 'caption': 'Our Delicious Menu!'}}
2025-08-04 22:57:21,649 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkMwQTQ5OTRFRjc5QzlDMzBDNAA="}]}
2025-08-04 22:57:21,650 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Hi, I'm Lola from Ganador \n\nTake a look at the menu and type in your order\n\n"}}
2025-08-04 22:57:22,942 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:57:22] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:57:23,113 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjdBRTQ3Q0YyRkY3MUM2ODk0NgA="}]}
2025-08-04 22:57:23,114 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjdBRTQ3Q0YyRkY3MUM2ODk0NgA='}]}
2025-08-04 22:57:23,114 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:57:23] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:57:23,130 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:57:23] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:57:23,965 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:57:23] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:57:24,166 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:57:24] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:57:24,378 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:57:24] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:57:24,584 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:57:24] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:57:30,011 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Jellof rice and yam'}
2025-08-04 22:57:33,429 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 22:57:33,429 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-04 22:57:33,429 - handlers.base_handler - INFO - AIHandler: Handling message 'jellof rice and yam' in AI bulk order state for session 2348055614455. Original: 'Jellof rice and yam'
2025-08-04 22:57:37,090 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-08-04 22:57:38,135 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkUxRUIyNTE4NkQ5NkJENUEyMwA="}]}
2025-08-04 22:57:38,136 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkUxRUIyNTE4NkQ5NkJENUEyMwA='}]}
2025-08-04 22:57:38,136 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:57:38] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:57:39,065 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:57:39] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:57:39,250 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:57:39] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:57:39,944 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:57:39] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:57:41,309 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-08-04 22:57:44,794 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 22:57:44,794 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-04 22:57:46,066 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjAzQ0I5OUIyRkZGNjhFNzhDNAA="}]}
2025-08-04 22:57:46,066 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjAzQ0I5OUIyRkZGNjhFNzhDNAA='}]}
2025-08-04 22:57:46,067 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:57:46] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:57:46,954 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:57:46] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:57:47,175 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:57:47] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:57:47,672 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:57:47] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:57:49,137 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'plantain'}
2025-08-04 22:57:52,747 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 22:57:52,748 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-04 22:57:53,815 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjdEODJBM0Y3MzU0OTZENDRDMgA="}]}
2025-08-04 22:57:53,815 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjdEODJBM0Y3MzU0OTZENDRDMgA='}]}
2025-08-04 22:57:53,816 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:57:53] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:57:54,872 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:57:54] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:57:55,065 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:57:55] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:57:55,358 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:57:55] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:57:57,578 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-08-04 22:58:01,436 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 22:58:01,437 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-04 22:58:01,437 - handlers.base_handler - INFO - AI order confirmed. Cart: {'Jollof Rice': {'item_id': '99', 'quantity': 1, 'price': 1500.0, 'total_price': 1500.0, 'variations': {}}, 'Plantain': {'item_id': '107', 'quantity': 1, 'price': 100.0, 'total_price': 100.0, 'variations': {}}}. Redirecting to order handler.
2025-08-04 22:58:01,437 - handlers.message_processor - INFO - Session 2348055614455: Redirecting to handler 'order_handler' with message 'process_final_order'.
2025-08-04 22:58:01,438 - handlers.order_handler - INFO - AI initiated order processing for session 2348055614455.
2025-08-04 22:58:01,438 - handlers.order_handler - INFO - Address set, proceeding to confirm order for AI-initiated session 2348055614455.
2025-08-04 22:58:02,547 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkM1NDEwQ0VGQUVDODIwOTMxQwA="}]}
2025-08-04 22:58:03,596 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:58:03] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:58:03,795 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:58:03] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:58:04,195 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:58:04] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:58:05,998 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 22:58:06,006 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkM1NDEwQ0VGQUVDODIwOTMxQwA='}]}
2025-08-04 22:58:06,007 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:58:06] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:58:10,227 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'final_confirm'}
2025-08-04 22:58:13,763 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 22:58:13,764 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-04 22:58:15,893 - utils.data_manager - INFO - Order 81 and its details saved to database
2025-08-04 22:58:15,894 - handlers.order_handler - INFO - Order 81 saved to database for session 2348055614455
2025-08-04 22:58:17,631 - utils.data_manager - INFO - User details for 2348055614455 saved to database
2025-08-04 22:58:17,631 - handlers.order_handler - INFO - User details saved for session 2348055614455 during order confirmation.
2025-08-04 22:58:21,059 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 22:58:21,066 - handlers.message_processor - INFO - Session 2348055614455: Redirecting to handler 'payment_handler' with message 'initiate_payment'.
2025-08-04 22:58:21,066 - handlers.payment_handler - INFO - Handling payment processing for session 2348055614455, message: initiate_payment
2025-08-04 22:58:21,066 - handlers.payment_handler - INFO - Creating payment link for session 2348055614455
2025-08-04 22:58:24,611 - utils.data_manager - INFO - Order 81 status updated to pending_payment in database
2025-08-04 22:58:24,611 - services.payment_service - INFO - Adding subaccount split: code=ACCT_939kju7zdvsk76y, percentage=1%
2025-08-04 22:58:24,612 - services.payment_service - INFO - Attempting to create payment link for reference: PAY-81 with amount: 160000, email: ziga4455@lola.com
2025-08-04 22:58:25,724 - services.payment_service - ERROR - HTTP error creating Paystack payment link for PAY-81: 404 Client Error: Not Found for url: https://api.paystack.co/transaction/initialize. Response: {"status":false,"message":"Invalid Subaccount.","meta":{"nextStep":"Ensure that the value(s) you're passing are valid."},"type":"validation_error","code":"invalid_params"}
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\services\payment_service.py", line 87, in create_payment_link
    response.raise_for_status()  # Raise HTTPError for bad responses (4xx or 5xx)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\zigam\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 404 Client Error: Not Found for url: https://api.paystack.co/transaction/initialize
2025-08-04 22:58:25,729 - handlers.payment_handler - ERROR - Failed to generate payment link for order 81
2025-08-04 22:58:27,126 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkM4OThDODY3MUMzMDI2RDkwMAA="}]}
2025-08-04 22:58:28,017 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:58:28] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:58:28,384 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:58:28] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:58:28,679 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:58:28] "POST /webhook HTTP/1.1" 200 -
2025-08-04 22:58:30,453 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 22:58:30,458 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkM4OThDODY3MUMzMDI2RDkwMAA='}]}
2025-08-04 22:58:30,459 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 22:58:30] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:15:58,994 - __main__ - INFO - Starting WhatsApp bot server...
2025-08-04 23:16:00,592 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-04 23:16:04,320 - utils.data_manager - INFO - Successfully loaded 12 user details from database
2025-08-04 23:16:04,513 - services.payment_service - INFO - PaymentService initialized
2025-08-04 23:16:06,051 - handlers.product_sync_handler - INFO - Successfully synced 15 products to data\products.json
2025-08-04 23:16:06,240 - app - INFO - Initial product sync successful on startup
2025-08-04 23:16:06,240 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-04 23:16:09,596 - utils.data_manager - INFO - Successfully loaded 12 user details from database
2025-08-04 23:16:09,785 - services.payment_service - INFO - PaymentService initialized
2025-08-04 23:16:09,786 - services.lead_tracker - INFO - LeadTracker initialized with DataManager
2025-08-04 23:16:09,786 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-08-04 23:16:09,787 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-08-04 23:16:09,787 - handlers.order_handler - INFO - OrderHandler initialized.
2025-08-04 23:16:09,788 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-04 23:16:09,788 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-08-04 23:16:10,217 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-08-04 23:16:10,217 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-08-04 23:16:10,217 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-08-04 23:16:10,218 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-04 23:16:10,234 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-08-04 23:16:10,234 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-08-04 23:17:17,133 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-08-04 23:17:17,134 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-08-04 23:17:21,116 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 23:17:21,117 - services.lead_tracker - INFO - Updated lead interaction: 2348055614455
2025-08-04 23:17:22,815 - handlers.base_handler - INFO - Session 2348055614455 greeted returning user 'ziga'.
2025-08-04 23:17:23,637 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 401 Client Error: Unauthorized for url: https://graph.facebook.com/v17.0/204426689424598/messages - {"error":{"message":"Error validating access token: Session has expired on Monday, 04-Aug-25 15:00:00 PDT. The current time is Monday, 04-Aug-25 15:17:23 PDT.","type":"OAuthException","code":190,"error_subcode":463,"fbtrace_id":"AzuXS7WCgye87hY7mLYPEWj"}}
2025-08-04 23:17:23,638 - handlers.message_processor - WARNING - Session 2348055614455: No handler response for handler 'greeting_handler', state 'start', message 'hello'. Resetting to greeting.
2025-08-04 23:17:23,639 - handlers.base_handler - INFO - Session 2348055614455 greeted returning user 'ziga'.
2025-08-04 23:17:24,235 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 401 Client Error: Unauthorized for url: https://graph.facebook.com/v17.0/204426689424598/messages - {"error":{"message":"Error validating access token: Session has expired on Monday, 04-Aug-25 15:00:00 PDT. The current time is Monday, 04-Aug-25 15:17:24 PDT.","type":"OAuthException","code":190,"error_subcode":463,"fbtrace_id":"ACeKKBoyz03RYzS_R2niDnm"}}
2025-08-04 23:17:24,236 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:17:24] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:18:23,855 - __main__ - INFO - Starting WhatsApp bot server...
2025-08-04 23:18:25,032 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-04 23:18:28,584 - utils.data_manager - INFO - Successfully loaded 12 user details from database
2025-08-04 23:18:28,775 - services.payment_service - INFO - PaymentService initialized
2025-08-04 23:18:30,268 - handlers.product_sync_handler - INFO - Successfully synced 15 products to data\products.json
2025-08-04 23:18:30,456 - app - INFO - Initial product sync successful on startup
2025-08-04 23:18:30,456 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-04 23:18:33,578 - utils.data_manager - INFO - Successfully loaded 12 user details from database
2025-08-04 23:18:33,775 - services.payment_service - INFO - PaymentService initialized
2025-08-04 23:18:33,775 - services.lead_tracker - INFO - LeadTracker initialized with DataManager
2025-08-04 23:18:33,776 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-08-04 23:18:33,776 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-08-04 23:18:33,776 - handlers.order_handler - INFO - OrderHandler initialized.
2025-08-04 23:18:33,777 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-04 23:18:33,777 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-08-04 23:18:34,223 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-08-04 23:18:34,223 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-08-04 23:18:34,224 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-08-04 23:18:34,224 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-04 23:18:34,237 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-08-04 23:18:34,237 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-08-04 23:19:17,533 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-08-04 23:19:17,534 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-08-04 23:19:21,137 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 23:19:21,138 - services.lead_tracker - INFO - Updated lead interaction: 2348055614455
2025-08-04 23:19:23,369 - handlers.base_handler - INFO - Session 2348055614455 greeted returning user 'ziga'.
2025-08-04 23:19:24,965 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjMzQzVCQTgyNjQxMTA1QkY2MQA="}]}
2025-08-04 23:19:24,966 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjMzQzVCQTgyNjQxMTA1QkY2MQA='}]}
2025-08-04 23:19:24,966 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:19:24] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:19:25,832 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:19:25] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:19:26,013 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:19:26] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:19:26,556 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:19:26] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:19:28,826 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-08-04 23:19:32,174 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 23:19:32,174 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-04 23:19:32,175 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-08-04 23:19:32,175 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-08-04 23:19:32,175 - handlers.message_processor - INFO - Session 2348055614455: Redirecting to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-08-04 23:19:32,175 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-08-04 23:19:32,176 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'image', 'image': {'link': 'https://eventio.africa/wp-content/uploads/2025/08/ganador-monday.jpg', 'caption': 'Our Delicious Menu!'}}
2025-08-04 23:19:33,553 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjZBQzI1RUQyMzE3NUU0QTQ5RgA="}]}
2025-08-04 23:19:33,553 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Hi, I'm Lola from Ganador \n\nTake a look at the menu and type in your order\n\n"}}
2025-08-04 23:19:34,630 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjJCNUY0QTg4NTBFNDUwOEYyQwA="}]}
2025-08-04 23:19:34,631 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjJCNUY0QTg4NTBFNDUwOEYyQwA='}]}
2025-08-04 23:19:34,631 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:19:34] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:19:35,307 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:19:35] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:19:35,948 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:19:35] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:19:36,370 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:19:36] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:19:36,371 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:19:36] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:19:36,374 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:19:36] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:19:36,534 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:19:36] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:20:19,070 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Jellof rice and fried rice'}
2025-08-04 23:20:22,624 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 23:20:22,624 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-04 23:20:22,625 - handlers.base_handler - INFO - AIHandler: Handling message 'jellof rice and fried rice' in AI bulk order state for session 2348055614455. Original: 'Jellof rice and fried rice'
2025-08-04 23:20:25,659 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-08-04 23:20:26,792 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkNGOTgwMUY0MUI3MEFBRjhFQgA="}]}
2025-08-04 23:20:26,793 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkNGOTgwMUY0MUI3MEFBRjhFQgA='}]}
2025-08-04 23:20:26,794 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:20:26] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:20:27,705 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:20:27] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:20:28,137 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:20:28] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:20:28,518 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:20:28] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:20:30,896 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-08-04 23:20:34,484 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 23:20:34,485 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-04 23:20:34,485 - handlers.base_handler - INFO - AI order confirmed. Cart: {'Jollof Rice': {'item_id': '99', 'quantity': 1, 'price': 1500.0, 'total_price': 1500.0, 'variations': {}}, 'Fried Rice': {'item_id': '100', 'quantity': 1, 'price': 1700.0, 'total_price': 1700.0, 'variations': {}}}. Redirecting to order handler.
2025-08-04 23:20:34,485 - handlers.message_processor - INFO - Session 2348055614455: Redirecting to handler 'order_handler' with message 'process_final_order'.
2025-08-04 23:20:34,486 - handlers.order_handler - INFO - AI initiated order processing for session 2348055614455.
2025-08-04 23:20:34,486 - handlers.order_handler - INFO - Address set, proceeding to confirm order for AI-initiated session 2348055614455.
2025-08-04 23:20:36,227 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjA5QTk1QjU2Q0VCOEU0ODZBQwA="}]}
2025-08-04 23:20:36,691 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:20:36] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:20:36,895 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:20:36] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:20:37,335 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:20:37] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:20:38,563 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'final_confirm'}
2025-08-04 23:20:39,884 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 23:20:39,905 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjA5QTk1QjU2Q0VCOEU0ODZBQwA='}]}
2025-08-04 23:20:39,906 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:20:39] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:20:41,930 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 23:20:41,931 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-04 23:20:45,074 - utils.data_manager - INFO - Order 83 and its details saved to database
2025-08-04 23:20:45,074 - handlers.order_handler - INFO - Order 83 saved to database for session 2348055614455
2025-08-04 23:20:46,755 - utils.data_manager - INFO - User details for 2348055614455 saved to database
2025-08-04 23:20:46,755 - handlers.order_handler - INFO - User details saved for session 2348055614455 during order confirmation.
2025-08-04 23:20:50,540 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 23:20:50,546 - handlers.message_processor - INFO - Session 2348055614455: Redirecting to handler 'payment_handler' with message 'initiate_payment'.
2025-08-04 23:20:50,546 - handlers.payment_handler - INFO - Handling payment processing for session 2348055614455, message: initiate_payment
2025-08-04 23:20:50,546 - handlers.payment_handler - INFO - Creating payment link for session 2348055614455
2025-08-04 23:20:53,900 - utils.data_manager - INFO - Order 83 status updated to pending_payment in database
2025-08-04 23:20:53,900 - services.payment_service - INFO - Adding subaccount split: code=ACCT_u9knhyzn5eq4iop, percentage=1%
2025-08-04 23:20:53,901 - services.payment_service - INFO - Attempting to create payment link for reference: PAY-83 with amount: 320000, email: ziga4455@lola.com
2025-08-04 23:20:55,117 - services.payment_service - INFO - Payment link created for ziga ziga (2348055614455), URL: https://checkout.paystack.com/oij0t52wwtzikvg
2025-08-04 23:20:55,118 - handlers.payment_handler - INFO - Starting payment monitoring for order 83, reference PAY-83
2025-08-04 23:20:55,118 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-83
2025-08-04 23:20:55,863 - services.payment_service - WARNING - Payment not successful for reference PAY-83. Paystack status: abandoned. Response: {'status': True, 'message': 'Verification successful', 'data': {'id': 5209386161, 'domain': 'test', 'status': 'abandoned', 'reference': 'PAY-83', 'receipt_number': None, 'amount': 320000, 'message': None, 'gateway_response': 'The transaction was not completed', 'paid_at': None, 'created_at': '2025-08-04T22:20:54.000Z', 'channel': 'card', 'currency': 'NGN', 'ip_address': '216.131.83.116, 172.70.115.184, 172.31.68.120', 'metadata': {'customer_name': 'ziga', 'customer_phone': '2348055614455', 'first_name': 'ziga', 'last_name': 'ziga', 'order_id': '83', 'delivery_address': 'lagos'}, 'log': None, 'fees': None, 'fees_split': {'paystack': 14800, 'integration': '3200', 'subaccount': 302000, 'params': {'bearer': 'subaccount', 'transaction_charge': '3200', 'percentage_charge': '0'}}, 'authorization': {}, 'customer': {'id': 296816511, 'first_name': None, 'last_name': None, 'email': 'ziga4455@lola.com', 'customer_code': 'CUS_3maokfy2as1d6qe', 'phone': None, 'metadata': None, 'risk_action': 'default', 'international_format_phone': None}, 'plan': None, 'split': {}, 'order_id': None, 'paidAt': None, 'createdAt': '2025-08-04T22:20:54.000Z', 'requested_amount': 320000, 'pos_transaction_data': None, 'source': None, 'fees_breakdown': None, 'connect': None, 'transaction_date': '2025-08-04T22:20:54.000Z', 'plan_object': {}, 'subaccount': {'id': 1381359, 'subaccount_code': 'ACCT_u9knhyzn5eq4iop', 'business_name': 'MAKINDE VICTOR OLUWASEGUN', 'description': 'MAKINDE VICTOR OLUWASEGUN', 'primary_contact_name': None, 'primary_contact_email': None, 'primary_contact_phone': None, 'metadata': None, 'percentage_charge': 0, 'settlement_bank': 'First City Monument Bank', 'bank_id': 8, 'account_number': '4955073017', 'currency': 'NGN', 'active': True, 'is_verified': True}}}
2025-08-04 23:20:55,864 - handlers.payment_handler - INFO - Payment not yet verified for order 83, attempt 1/15
2025-08-04 23:20:55,865 - handlers.payment_handler - INFO - Payment link created successfully for order 83 with subaccount ACCT_u9knhyzn5eq4iop
2025-08-04 23:21:00,695 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkVGOENBNEEyRDE3N0M4MDNBQwA="}]}
2025-08-04 23:21:01,731 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:21:01] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:21:01,911 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:21:01] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:21:02,455 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:21:02] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:21:03,720 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'final_confirm'}
2025-08-04 23:21:05,134 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 23:21:05,140 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkVGOENBNEEyRDE3N0M4MDNBQwA='}]}
2025-08-04 23:21:05,141 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:21:05] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:21:07,219 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 23:21:07,221 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-04 23:21:08,928 - handlers.payment_handler - INFO - User sent message while still awaiting payment for order 83.
2025-08-04 23:21:13,615 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjUxMzc2REE5ODg5RkM2RkNGRgA="}]}
2025-08-04 23:21:14,481 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:21:14] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:21:14,676 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:21:14] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:21:15,195 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:21:15] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:21:17,233 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 23:21:17,238 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjUxMzc2REE5ODg5RkM2RkNGRgA='}]}
2025-08-04 23:21:17,239 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:21:17] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:21:55,871 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-83
2025-08-04 23:21:56,867 - services.payment_service - WARNING - Payment not successful for reference PAY-83. Paystack status: abandoned. Response: {'status': True, 'message': 'Verification successful', 'data': {'id': 5209386161, 'domain': 'test', 'status': 'abandoned', 'reference': 'PAY-83', 'receipt_number': None, 'amount': 320000, 'message': None, 'gateway_response': 'The transaction was not completed', 'paid_at': None, 'created_at': '2025-08-04T22:20:54.000Z', 'channel': 'card', 'currency': 'NGN', 'ip_address': '216.131.83.116, 172.70.115.184, 172.31.68.120', 'metadata': {'customer_name': 'ziga', 'customer_phone': '2348055614455', 'first_name': 'ziga', 'last_name': 'ziga', 'order_id': '83', 'delivery_address': 'lagos'}, 'log': None, 'fees': None, 'fees_split': {'paystack': 14800, 'integration': '3200', 'subaccount': 302000, 'params': {'bearer': 'subaccount', 'transaction_charge': '3200', 'percentage_charge': '0'}}, 'authorization': {}, 'customer': {'id': 296816511, 'first_name': None, 'last_name': None, 'email': 'ziga4455@lola.com', 'customer_code': 'CUS_3maokfy2as1d6qe', 'phone': None, 'metadata': None, 'risk_action': 'default', 'international_format_phone': None}, 'plan': None, 'split': {}, 'order_id': None, 'paidAt': None, 'createdAt': '2025-08-04T22:20:54.000Z', 'requested_amount': 320000, 'pos_transaction_data': None, 'source': None, 'fees_breakdown': None, 'connect': None, 'transaction_date': '2025-08-04T22:20:54.000Z', 'plan_object': {}, 'subaccount': {'id': 1381359, 'subaccount_code': 'ACCT_u9knhyzn5eq4iop', 'business_name': 'MAKINDE VICTOR OLUWASEGUN', 'description': 'MAKINDE VICTOR OLUWASEGUN', 'primary_contact_name': None, 'primary_contact_email': None, 'primary_contact_phone': None, 'metadata': None, 'percentage_charge': 0, 'settlement_bank': 'First City Monument Bank', 'bank_id': 8, 'account_number': '4955073017', 'currency': 'NGN', 'active': True, 'is_verified': True}}}
2025-08-04 23:21:56,868 - handlers.payment_handler - INFO - Payment not yet verified for order 83, attempt 2/15
2025-08-04 23:22:56,881 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-83
2025-08-04 23:22:57,694 - services.payment_service - WARNING - Payment not successful for reference PAY-83. Paystack status: abandoned. Response: {'status': True, 'message': 'Verification successful', 'data': {'id': 5209386161, 'domain': 'test', 'status': 'abandoned', 'reference': 'PAY-83', 'receipt_number': None, 'amount': 320000, 'message': None, 'gateway_response': 'The transaction was not completed', 'paid_at': None, 'created_at': '2025-08-04T22:20:54.000Z', 'channel': 'card', 'currency': 'NGN', 'ip_address': '216.131.83.116, 172.70.115.184, 172.31.68.120', 'metadata': {'customer_name': 'ziga', 'customer_phone': '2348055614455', 'first_name': 'ziga', 'last_name': 'ziga', 'order_id': '83', 'delivery_address': 'lagos'}, 'log': None, 'fees': None, 'fees_split': {'paystack': 14800, 'integration': '3200', 'subaccount': 302000, 'params': {'bearer': 'subaccount', 'transaction_charge': '3200', 'percentage_charge': '0'}}, 'authorization': {}, 'customer': {'id': 296816511, 'first_name': None, 'last_name': None, 'email': 'ziga4455@lola.com', 'customer_code': 'CUS_3maokfy2as1d6qe', 'phone': None, 'metadata': None, 'risk_action': 'default', 'international_format_phone': None}, 'plan': None, 'split': {}, 'order_id': None, 'paidAt': None, 'createdAt': '2025-08-04T22:20:54.000Z', 'requested_amount': 320000, 'pos_transaction_data': None, 'source': None, 'fees_breakdown': None, 'connect': None, 'transaction_date': '2025-08-04T22:20:54.000Z', 'plan_object': {}, 'subaccount': {'id': 1381359, 'subaccount_code': 'ACCT_u9knhyzn5eq4iop', 'business_name': 'MAKINDE VICTOR OLUWASEGUN', 'description': 'MAKINDE VICTOR OLUWASEGUN', 'primary_contact_name': None, 'primary_contact_email': None, 'primary_contact_phone': None, 'metadata': None, 'percentage_charge': 0, 'settlement_bank': 'First City Monument Bank', 'bank_id': 8, 'account_number': '4955073017', 'currency': 'NGN', 'active': True, 'is_verified': True}}}
2025-08-04 23:22:57,694 - handlers.payment_handler - INFO - Payment not yet verified for order 83, attempt 3/15
2025-08-04 23:23:57,708 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-83
2025-08-04 23:23:58,642 - services.payment_service - WARNING - Payment not successful for reference PAY-83. Paystack status: abandoned. Response: {'status': True, 'message': 'Verification successful', 'data': {'id': 5209386161, 'domain': 'test', 'status': 'abandoned', 'reference': 'PAY-83', 'receipt_number': None, 'amount': 320000, 'message': None, 'gateway_response': 'The transaction was not completed', 'paid_at': None, 'created_at': '2025-08-04T22:20:54.000Z', 'channel': 'card', 'currency': 'NGN', 'ip_address': '216.131.83.116, 172.70.115.184, 172.31.68.120', 'metadata': {'customer_name': 'ziga', 'customer_phone': '2348055614455', 'first_name': 'ziga', 'last_name': 'ziga', 'order_id': '83', 'delivery_address': 'lagos'}, 'log': None, 'fees': None, 'fees_split': {'paystack': 14800, 'integration': '3200', 'subaccount': 302000, 'params': {'bearer': 'subaccount', 'transaction_charge': '3200', 'percentage_charge': '0'}}, 'authorization': {}, 'customer': {'id': 296816511, 'first_name': None, 'last_name': None, 'email': 'ziga4455@lola.com', 'customer_code': 'CUS_3maokfy2as1d6qe', 'phone': None, 'metadata': None, 'risk_action': 'default', 'international_format_phone': None}, 'plan': None, 'split': {}, 'order_id': None, 'paidAt': None, 'createdAt': '2025-08-04T22:20:54.000Z', 'requested_amount': 320000, 'pos_transaction_data': None, 'source': None, 'fees_breakdown': None, 'connect': None, 'transaction_date': '2025-08-04T22:20:54.000Z', 'plan_object': {}, 'subaccount': {'id': 1381359, 'subaccount_code': 'ACCT_u9knhyzn5eq4iop', 'business_name': 'MAKINDE VICTOR OLUWASEGUN', 'description': 'MAKINDE VICTOR OLUWASEGUN', 'primary_contact_name': None, 'primary_contact_email': None, 'primary_contact_phone': None, 'metadata': None, 'percentage_charge': 0, 'settlement_bank': 'First City Monument Bank', 'bank_id': 8, 'account_number': '4955073017', 'currency': 'NGN', 'active': True, 'is_verified': True}}}
2025-08-04 23:23:58,643 - handlers.payment_handler - INFO - Payment not yet verified for order 83, attempt 4/15
2025-08-04 23:24:41,265 - __main__ - INFO - Starting WhatsApp bot server...
2025-08-04 23:24:42,623 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-04 23:24:45,815 - utils.data_manager - INFO - Successfully loaded 12 user details from database
2025-08-04 23:24:45,993 - services.payment_service - INFO - PaymentService initialized
2025-08-04 23:24:47,729 - handlers.product_sync_handler - INFO - Successfully synced 15 products to data\products.json
2025-08-04 23:24:48,804 - app - INFO - Initial product sync successful on startup
2025-08-04 23:24:48,805 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-04 23:24:53,134 - utils.data_manager - INFO - Successfully loaded 12 user details from database
2025-08-04 23:24:53,315 - services.payment_service - INFO - PaymentService initialized
2025-08-04 23:24:53,315 - services.lead_tracker - INFO - LeadTracker initialized with DataManager
2025-08-04 23:24:53,315 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-08-04 23:24:53,316 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-08-04 23:24:53,316 - handlers.order_handler - INFO - OrderHandler initialized.
2025-08-04 23:24:53,316 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-04 23:24:53,317 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-08-04 23:24:53,683 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-08-04 23:24:53,683 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-08-04 23:24:53,684 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-08-04 23:24:53,684 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-04 23:24:53,695 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-08-04 23:24:53,695 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-08-04 23:25:04,399 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-08-04 23:25:04,400 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-08-04 23:25:07,970 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 23:25:07,971 - services.lead_tracker - INFO - Updated lead interaction: 2348055614455
2025-08-04 23:25:09,660 - handlers.base_handler - INFO - Session 2348055614455 greeted returning user 'ziga'.
2025-08-04 23:25:11,004 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjNBMkExNkNBQUQ0RTFGMzI0MwA="}]}
2025-08-04 23:25:11,005 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjNBMkExNkNBQUQ0RTFGMzI0MwA='}]}
2025-08-04 23:25:11,005 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:25:11] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:25:11,905 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:25:11] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:25:12,191 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:25:12] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:25:12,699 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:25:12] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:25:16,489 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-08-04 23:25:20,204 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 23:25:20,205 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-04 23:25:20,205 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-08-04 23:25:20,206 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-08-04 23:25:20,206 - handlers.message_processor - INFO - Session 2348055614455: Redirecting to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-08-04 23:25:20,206 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-08-04 23:25:20,207 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'image', 'image': {'link': 'https://eventio.africa/wp-content/uploads/2025/08/ganador-monday.jpg', 'caption': 'Our Delicious Menu!'}}
2025-08-04 23:25:21,514 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkQzMUQ5N0I3RDI0RUE4NzdFQwA="}]}
2025-08-04 23:25:21,515 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Hi, I'm Lola from Ganador \n\nTake a look at the menu and type in your order\n\n"}}
2025-08-04 23:25:22,677 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjIzNzE1MEI5MjQ5REEyQTdGQgA="}]}
2025-08-04 23:25:22,677 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjIzNzE1MEI5MjQ5REEyQTdGQgA='}]}
2025-08-04 23:25:22,678 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:25:22] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:25:22,759 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:25:22] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:25:23,038 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:25:23] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:25:23,614 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:25:23] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:25:23,846 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:25:23] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:25:23,956 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:25:23] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:25:24,352 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:25:24] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:25:25,338 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Jellof rice'}
2025-08-04 23:25:29,426 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 23:25:29,427 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-04 23:25:29,427 - handlers.base_handler - INFO - AIHandler: Handling message 'jellof rice' in AI bulk order state for session 2348055614455. Original: 'Jellof rice'
2025-08-04 23:25:31,982 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-08-04 23:25:33,314 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjEzRkZFRDJBQ0EyQUFEQTZFQQA="}]}
2025-08-04 23:25:33,315 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjEzRkZFRDJBQ0EyQUFEQTZFQQA='}]}
2025-08-04 23:25:33,316 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:25:33] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:25:34,407 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:25:34] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:25:34,603 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:25:34] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:25:34,783 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:25:34] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:25:36,785 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-08-04 23:25:40,189 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 23:25:40,189 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-04 23:25:40,190 - handlers.base_handler - INFO - AI order confirmed. Cart: {'Jollof Rice': {'item_id': '99', 'quantity': 1, 'price': 1500.0, 'total_price': 1500.0, 'variations': {}}}. Redirecting to order handler.
2025-08-04 23:25:40,190 - handlers.message_processor - INFO - Session 2348055614455: Redirecting to handler 'order_handler' with message 'process_final_order'.
2025-08-04 23:25:40,190 - handlers.order_handler - INFO - AI initiated order processing for session 2348055614455.
2025-08-04 23:25:40,191 - handlers.order_handler - INFO - Address set, proceeding to confirm order for AI-initiated session 2348055614455.
2025-08-04 23:25:41,414 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjg2NjExMDUwMkRCODM3RkZENwA="}]}
2025-08-04 23:25:42,354 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:25:42] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:25:42,540 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:25:42] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:25:42,835 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:25:42] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:25:44,923 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 23:25:44,929 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjg2NjExMDUwMkRCODM3RkZENwA='}]}
2025-08-04 23:25:44,930 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:25:44] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:32:39,658 - __main__ - INFO - Starting WhatsApp bot server...
2025-08-04 23:32:41,437 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-04 23:32:44,908 - utils.data_manager - INFO - Successfully loaded 12 user details from database
2025-08-04 23:32:45,093 - services.payment_service - INFO - PaymentService initialized
2025-08-04 23:32:46,609 - handlers.product_sync_handler - INFO - Successfully synced 15 products to data\products.json
2025-08-04 23:32:46,793 - app - INFO - Initial product sync successful on startup
2025-08-04 23:32:46,793 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-08-04 23:32:50,643 - utils.data_manager - INFO - Successfully loaded 12 user details from database
2025-08-04 23:32:50,823 - services.payment_service - INFO - PaymentService initialized
2025-08-04 23:32:50,823 - services.lead_tracker - INFO - LeadTracker initialized with DataManager
2025-08-04 23:32:50,823 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-08-04 23:32:50,824 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-08-04 23:32:50,824 - handlers.order_handler - INFO - OrderHandler initialized.
2025-08-04 23:32:50,825 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-04 23:32:50,825 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-08-04 23:32:51,252 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-08-04 23:32:51,253 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-08-04 23:32:51,253 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-08-04 23:32:51,253 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-04 23:32:51,285 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-08-04 23:32:51,285 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-08-04 23:32:56,067 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-08-04 23:32:56,067 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-08-04 23:33:00,183 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 23:33:00,183 - services.lead_tracker - INFO - Updated lead interaction: 2348055614455
2025-08-04 23:33:01,982 - handlers.base_handler - INFO - Session 2348055614455 greeted returning user 'ziga'.
2025-08-04 23:33:03,341 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkJDMEU3QjBGQjM2M0Q5MjlDNAA="}]}
2025-08-04 23:33:03,341 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkJDMEU3QjBGQjM2M0Q5MjlDNAA='}]}
2025-08-04 23:33:03,342 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:33:03] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:33:04,255 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:33:04] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:33:04,441 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:33:04] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:33:04,922 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:33:04] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:33:07,105 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-08-04 23:33:10,633 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 23:33:10,634 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-04 23:33:10,634 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-08-04 23:33:10,635 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-08-04 23:33:10,635 - handlers.message_processor - INFO - Session 2348055614455: Redirecting to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-08-04 23:33:10,635 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-08-04 23:33:10,636 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'image', 'image': {'link': 'https://eventio.africa/wp-content/uploads/2025/08/ganador-monday.jpg', 'caption': 'Our Delicious Menu!'}}
2025-08-04 23:33:11,842 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjYxNzRGODdFNjdCRkVGNkQ2NgA="}]}
2025-08-04 23:33:11,843 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Hi, I'm Lola from Ganador \n\nTake a look at the menu and type in your order\n\n"}}
2025-08-04 23:33:12,870 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkMyQkQ4Q0I0RDY2RTU1MEZFMwA="}]}
2025-08-04 23:33:12,871 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkMyQkQ4Q0I0RDY2RTU1MEZFMwA='}]}
2025-08-04 23:33:12,872 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:33:12] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:33:13,512 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:33:13] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:33:13,896 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:33:13] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:33:14,083 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:33:14] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:33:14,085 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:33:14] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:33:14,194 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:33:14] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:33:14,672 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:33:14] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:33:18,153 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Jellof rice'}
2025-08-04 23:33:21,753 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 23:33:21,753 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-04 23:33:21,754 - handlers.base_handler - INFO - AIHandler: Handling message 'jellof rice' in AI bulk order state for session 2348055614455. Original: 'Jellof rice'
2025-08-04 23:33:24,381 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-08-04 23:33:25,774 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjlBNDQ0Nzg2NzU4NkY5MEM5MwA="}]}
2025-08-04 23:33:25,775 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjlBNDQ0Nzg2NzU4NkY5MEM5MwA='}]}
2025-08-04 23:33:25,775 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:33:25] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:33:26,649 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:33:26] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:33:26,829 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:33:26] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:33:27,755 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:33:27] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:33:29,374 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-08-04 23:33:32,809 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 23:33:32,810 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-04 23:33:32,810 - handlers.base_handler - INFO - AI order confirmed. Cart: {'Jollof Rice': {'item_id': '99', 'quantity': 1, 'price': 1500.0, 'total_price': 1500.0, 'variations': {}}}. Redirecting to order handler.
2025-08-04 23:33:32,811 - handlers.message_processor - INFO - Session 2348055614455: Redirecting to handler 'order_handler' with message 'process_final_order'.
2025-08-04 23:33:32,811 - handlers.order_handler - INFO - AI initiated order processing for session 2348055614455.
2025-08-04 23:33:32,811 - handlers.order_handler - INFO - Prompting for note after AI order confirmation for session 2348055614455.
2025-08-04 23:33:34,093 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkQ4RDRFMERFRUNDMTQ4NDVCRQA="}]}
2025-08-04 23:33:34,951 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:33:34] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:33:35,194 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:33:35] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:33:35,618 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:33:35] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:33:37,674 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 23:33:37,680 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkQ4RDRFMERFRUNDMTQ4NDVCRQA='}]}
2025-08-04 23:33:37,681 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:33:37] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:33:38,404 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'add_note'}
2025-08-04 23:33:42,078 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 23:33:42,078 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-04 23:33:42,079 - handlers.message_processor - WARNING - Session 2348055614455: Unhandled order_handler state 'prompt_add_note'.
2025-08-04 23:33:42,079 - handlers.base_handler - INFO - Session 2348055614455 returned to main menu (greeting state).
2025-08-04 23:33:43,265 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkUwMUM0QjBCQkVFMjZDNDM4RgA="}]}
2025-08-04 23:33:43,265 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkUwMUM0QjBCQkVFMjZDNDM4RgA='}]}
2025-08-04 23:33:43,266 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:33:43] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:33:44,211 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:33:44] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:33:44,283 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:33:44] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:33:44,825 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:33:44] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:37:16,643 - __main__ - INFO - Starting WhatsApp bot server...
2025-08-04 23:37:17,809 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-08-04 23:37:21,222 - utils.data_manager - INFO - Successfully loaded 12 user details from database
2025-08-04 23:37:21,407 - services.payment_service - INFO - PaymentService initialized
2025-08-04 23:37:23,105 - handlers.product_sync_handler - INFO - Successfully synced 15 products to data\products.json
2025-08-04 23:37:23,301 - app - INFO - Initial product sync successful on startup
2025-08-04 23:37:23,301 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-08-04 23:37:27,215 - utils.data_manager - INFO - Successfully loaded 12 user details from database
2025-08-04 23:37:27,455 - services.payment_service - INFO - PaymentService initialized
2025-08-04 23:37:27,456 - services.lead_tracker - INFO - LeadTracker initialized with DataManager
2025-08-04 23:37:27,456 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-08-04 23:37:27,456 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-08-04 23:37:27,457 - handlers.order_handler - INFO - OrderHandler initialized.
2025-08-04 23:37:27,457 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-04 23:37:27,457 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-08-04 23:37:27,852 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-08-04 23:37:27,852 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-08-04 23:37:27,852 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-08-04 23:37:27,853 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-04 23:37:27,870 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-08-04 23:37:27,871 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-08-04 23:37:32,298 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-08-04 23:37:32,299 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-08-04 23:37:35,615 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 23:37:35,616 - services.lead_tracker - INFO - Updated lead interaction: 2348055614455
2025-08-04 23:37:37,311 - handlers.base_handler - INFO - Session 2348055614455 greeted returning user 'ziga'.
2025-08-04 23:37:38,587 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjY4MjQxQzBGMzNCMUNCOTA5RQA="}]}
2025-08-04 23:37:38,587 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjY4MjQxQzBGMzNCMUNCOTA5RQA='}]}
2025-08-04 23:37:38,588 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:37:38] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:37:39,667 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:37:39] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:37:39,765 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:37:39] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:37:40,250 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:37:40] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:37:41,902 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-08-04 23:37:45,682 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 23:37:45,682 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-04 23:37:45,683 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-08-04 23:37:45,683 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-08-04 23:37:45,683 - handlers.message_processor - INFO - Session 2348055614455: Redirecting to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-08-04 23:37:45,684 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-08-04 23:37:45,684 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'image', 'image': {'link': 'https://eventio.africa/wp-content/uploads/2025/08/ganador-monday.jpg', 'caption': 'Our Delicious Menu!'}}
2025-08-04 23:37:46,925 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjg1QTdBODcyOUJCOEZBMDAyQwA="}]}
2025-08-04 23:37:46,925 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Hi, I'm Lola from Ganador \n\nTake a look at the menu and type in your order\n\n"}}
2025-08-04 23:37:48,169 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:37:48] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:37:48,218 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjcwRTc4NjZCMjM5OUE0MDM5QQA="}]}
2025-08-04 23:37:48,218 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjcwRTc4NjZCMjM5OUE0MDM5QQA='}]}
2025-08-04 23:37:48,219 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:37:48] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:37:48,408 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:37:48] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:37:49,329 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:37:49] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:37:49,513 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:37:49] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:37:49,643 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:37:49] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:37:50,141 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:37:50] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:37:54,653 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Jellof rice'}
2025-08-04 23:37:58,172 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 23:37:58,173 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-04 23:37:58,173 - handlers.base_handler - INFO - AIHandler: Handling message 'jellof rice' in AI bulk order state for session 2348055614455. Original: 'Jellof rice'
2025-08-04 23:38:02,511 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-08-04 23:38:03,822 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkUyMENGNUU5MDAxMUYyRjM3NAA="}]}
2025-08-04 23:38:03,823 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkUyMENGNUU5MDAxMUYyRjM3NAA='}]}
2025-08-04 23:38:03,824 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:38:03] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:38:04,726 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:38:04] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:38:05,134 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:38:05] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:38:05,543 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:38:05] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:38:08,415 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-08-04 23:38:09,073 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'cancel_ai_order'}
2025-08-04 23:38:11,805 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 23:38:11,806 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-04 23:38:11,807 - handlers.base_handler - INFO - AI order confirmed. Cart: {'Jollof Rice': {'item_id': '99', 'quantity': 1, 'price': 1500.0, 'total_price': 1500.0, 'variations': {}}}. Redirecting to order handler.
2025-08-04 23:38:11,807 - handlers.message_processor - INFO - Session 2348055614455: Redirecting to handler 'order_handler' with message 'process_final_order'.
2025-08-04 23:38:11,807 - handlers.order_handler - INFO - AI initiated order processing for session 2348055614455.
2025-08-04 23:38:11,808 - handlers.order_handler - INFO - Prompting for note after AI order confirmation for session 2348055614455.
2025-08-04 23:38:12,412 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 23:38:12,412 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-04 23:38:12,944 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkVCRTUwNTU4QTdGNkJCNjg0QwA="}]}
2025-08-04 23:38:13,488 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjk0NTc1MjAyNkQ5MjMyQkM5QwA="}]}
2025-08-04 23:38:14,009 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:38:14] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:38:14,584 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:38:14] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:38:14,758 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:38:14] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:38:14,759 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:38:14] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:38:14,761 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:38:14] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:38:15,206 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:38:15] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:38:16,332 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 23:38:16,338 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkVCRTUwNTU4QTdGNkJCNjg0QwA='}]}
2025-08-04 23:38:16,338 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:38:16] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:38:16,936 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 23:38:16,942 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjk0NTc1MjAyNkQ5MjMyQkM5QwA='}]}
2025-08-04 23:38:16,942 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:38:16] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:38:18,548 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'add_note'}
2025-08-04 23:38:19,723 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'proceed_to_confirmation'}
2025-08-04 23:38:22,261 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 23:38:22,262 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-04 23:38:22,262 - handlers.order_handler - INFO - User chose to add a note after AI confirmation for session 2348055614455.
2025-08-04 23:38:22,262 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Please type your note for the order (e.g., 'Please deliver after 5 PM'). Type 'back' to skip adding a note."}}
2025-08-04 23:38:23,102 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 23:38:23,103 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-04 23:38:23,103 - handlers.order_handler - INFO - Note 'proceed_to_confirmation' added for session 2348055614455.
2025-08-04 23:38:23,533 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkUwOUQyNTJFMTQwMjQ1MkJDQwA="}]}
2025-08-04 23:38:24,683 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkQyREUxMzMxMUREQzE4M0ExNAA="}]}
2025-08-04 23:38:25,064 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:38:25] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:38:25,119 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:38:25] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:38:25,581 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:38:25] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:38:25,764 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:38:25] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:38:25,904 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:38:25] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:38:26,089 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:38:26] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:38:26,414 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:38:26] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:38:26,598 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:38:26] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:38:27,202 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 23:38:27,207 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkUwOUQyNTJFMTQwMjQ1MkJDQwA='}]}
2025-08-04 23:38:27,207 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:38:27] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:38:28,188 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 23:38:28,194 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkQyREUxMzMxMUREQzE4M0ExNAA='}]}
2025-08-04 23:38:28,194 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:38:28] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:38:44,124 - __main__ - INFO - Starting WhatsApp bot server...
2025-08-04 23:38:45,256 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-08-04 23:38:48,458 - utils.data_manager - INFO - Successfully loaded 12 user details from database
2025-08-04 23:38:48,652 - services.payment_service - INFO - PaymentService initialized
2025-08-04 23:38:50,133 - handlers.product_sync_handler - INFO - Successfully synced 15 products to data\products.json
2025-08-04 23:38:50,322 - app - INFO - Initial product sync successful on startup
2025-08-04 23:38:50,322 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-08-04 23:38:53,497 - utils.data_manager - INFO - Successfully loaded 12 user details from database
2025-08-04 23:38:53,692 - services.payment_service - INFO - PaymentService initialized
2025-08-04 23:38:53,692 - services.lead_tracker - INFO - LeadTracker initialized with DataManager
2025-08-04 23:38:53,692 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-08-04 23:38:53,693 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-08-04 23:38:53,693 - handlers.order_handler - INFO - OrderHandler initialized.
2025-08-04 23:38:53,693 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-04 23:38:53,694 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-08-04 23:38:54,095 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-08-04 23:38:54,095 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-08-04 23:38:54,095 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-08-04 23:38:54,096 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-04 23:38:54,106 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-08-04 23:38:54,107 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-08-04 23:39:01,251 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-08-04 23:39:01,251 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-08-04 23:39:04,692 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 23:39:04,693 - services.lead_tracker - INFO - Updated lead interaction: 2348055614455
2025-08-04 23:39:06,442 - handlers.base_handler - INFO - Session 2348055614455 greeted returning user 'ziga'.
2025-08-04 23:39:07,962 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjgyMEQzNTYxMzY0NjhCNzI1NAA="}]}
2025-08-04 23:39:07,963 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjgyMEQzNTYxMzY0NjhCNzI1NAA='}]}
2025-08-04 23:39:07,963 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:39:07] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:39:08,778 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:39:08] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:39:09,344 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:39:09] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:39:09,530 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:39:09] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:39:14,982 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-08-04 23:39:18,381 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 23:39:18,381 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-04 23:39:18,382 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-08-04 23:39:18,382 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-08-04 23:39:18,382 - handlers.message_processor - INFO - Session 2348055614455: Redirecting to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-08-04 23:39:18,382 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-08-04 23:39:18,383 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'image', 'image': {'link': 'https://eventio.africa/wp-content/uploads/2025/08/ganador-monday.jpg', 'caption': 'Our Delicious Menu!'}}
2025-08-04 23:39:19,673 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkFDQkVGQTAzNzRGMjM2NzNDMgA="}]}
2025-08-04 23:39:19,674 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Hi, I'm Lola from Ganador \n\nTake a look at the menu and type in your order\n\n"}}
2025-08-04 23:39:20,932 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:39:20] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:39:21,117 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjI1RDZGMEUyOTkxREIxRTcwRQA="}]}
2025-08-04 23:39:21,118 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:39:21] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:39:21,118 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjI1RDZGMEUyOTkxREIxRTcwRQA='}]}
2025-08-04 23:39:21,119 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:39:21] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:39:22,152 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:39:22] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:39:22,322 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:39:22] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:39:22,324 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:39:22] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:39:22,699 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:39:22] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:39:25,702 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Jellof rice'}
2025-08-04 23:39:29,352 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 23:39:29,352 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-04 23:39:29,353 - handlers.base_handler - INFO - AIHandler: Handling message 'jellof rice' in AI bulk order state for session 2348055614455. Original: 'Jellof rice'
2025-08-04 23:39:31,969 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-08-04 23:39:33,242 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjJGQ0NGQzk5Mjc0NTM1MkNGMQA="}]}
2025-08-04 23:39:33,243 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjJGQ0NGQzk5Mjc0NTM1MkNGMQA='}]}
2025-08-04 23:39:33,243 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:39:33] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:39:34,040 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:39:34] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:39:34,355 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:39:34] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:39:34,794 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:39:34] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:39:37,381 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-08-04 23:39:40,791 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 23:39:40,792 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-04 23:39:40,792 - handlers.base_handler - INFO - AI order confirmed. Cart: {'Jollof Rice': {'item_id': '99', 'quantity': 1, 'price': 1500.0, 'total_price': 1500.0, 'variations': {}}}. Redirecting to order handler.
2025-08-04 23:39:40,792 - handlers.message_processor - INFO - Session 2348055614455: Redirecting to handler 'order_handler' with message 'process_final_order'.
2025-08-04 23:39:40,793 - handlers.order_handler - INFO - AI initiated order processing for session 2348055614455.
2025-08-04 23:39:40,793 - handlers.order_handler - INFO - Prompting for note after AI order confirmation for session 2348055614455.
2025-08-04 23:39:41,932 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjM4QUNCODY4RkYyODQ4MEQ5MQA="}]}
2025-08-04 23:39:42,839 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:39:42] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:39:43,036 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:39:43] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:39:43,696 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:39:43] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:39:44,913 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'add_note'}
2025-08-04 23:39:45,301 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 23:39:45,307 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjM4QUNCODY4RkYyODQ4MEQ5MQA='}]}
2025-08-04 23:39:45,307 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:39:45] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:39:48,702 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 23:39:48,702 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-04 23:39:48,703 - handlers.order_handler - INFO - User chose to add a note after AI confirmation for session 2348055614455.
2025-08-04 23:39:48,703 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Please type your note for the order (e.g., 'Please deliver after 5 PM'). Type 'back' to skip adding a note."}}
2025-08-04 23:39:49,882 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjU1MjRFQkE3NjdBQzMwMERCRQA="}]}
2025-08-04 23:39:50,802 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:39:50] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:39:50,897 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:39:50] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:39:51,404 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:39:51] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:39:53,251 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 23:39:53,255 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjU1MjRFQkE3NjdBQzMwMERCRQA='}]}
2025-08-04 23:39:53,256 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:39:53] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:40:01,091 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Seperate the rice and moi moi'}
2025-08-04 23:40:04,651 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 23:40:04,652 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-04 23:40:04,652 - handlers.order_handler - INFO - Note 'seperate the rice and moi moi' added for session 2348055614455.
2025-08-04 23:40:05,797 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjZGQTc2REY4OThDNjJFM0FFNwA="}]}
2025-08-04 23:40:06,682 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:40:06] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:40:07,059 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:40:07] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:40:07,364 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:40:07] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:40:09,194 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 23:40:09,199 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjZGQTc2REY4OThDNjJFM0FFNwA='}]}
2025-08-04 23:40:09,200 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:40:09] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:40:11,689 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'final_confirm'}
2025-08-04 23:40:15,051 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 23:40:15,052 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-04 23:40:17,135 - utils.data_manager - INFO - Order 85 and its details saved to database
2025-08-04 23:40:17,136 - handlers.order_handler - INFO - Order 85 saved to database for session 2348055614455
2025-08-04 23:40:18,830 - utils.data_manager - INFO - User details for 2348055614455 saved to database
2025-08-04 23:40:18,831 - handlers.order_handler - INFO - User details saved for session 2348055614455 during order confirmation.
2025-08-04 23:40:22,331 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 23:40:22,337 - handlers.message_processor - INFO - Session 2348055614455: Redirecting to handler 'payment_handler' with message 'initiate_payment'.
2025-08-04 23:40:22,338 - handlers.payment_handler - INFO - Handling payment processing for session 2348055614455, message: initiate_payment
2025-08-04 23:40:22,338 - handlers.payment_handler - INFO - Creating payment link for session 2348055614455
2025-08-04 23:40:25,927 - utils.data_manager - INFO - Order 85 status updated to pending_payment in database
2025-08-04 23:40:25,928 - services.payment_service - INFO - Adding subaccount split: code=ACCT_u9knhyzn5eq4iop, percentage=1%
2025-08-04 23:40:25,928 - services.payment_service - INFO - Attempting to create payment link for reference: PAY-85 with amount: 150000, email: ziga4455@lola.com
2025-08-04 23:40:26,922 - services.payment_service - INFO - Payment link created for ziga ziga (2348055614455), URL: https://checkout.paystack.com/ovgcdkp5ei1npto
2025-08-04 23:40:26,922 - handlers.payment_handler - INFO - Starting payment monitoring for order 85, reference PAY-85
2025-08-04 23:40:26,922 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-85
2025-08-04 23:40:27,693 - services.payment_service - WARNING - Payment not successful for reference PAY-85. Paystack status: abandoned. Response: {'status': True, 'message': 'Verification successful', 'data': {'id': 5209404680, 'domain': 'test', 'status': 'abandoned', 'reference': 'PAY-85', 'receipt_number': None, 'amount': 150000, 'message': None, 'gateway_response': 'The transaction was not completed', 'paid_at': None, 'created_at': '2025-08-04T22:40:26.000Z', 'channel': 'card', 'currency': 'NGN', 'ip_address': '216.131.83.116, 104.23.187.66, 172.31.62.52', 'metadata': {'customer_name': 'ziga', 'customer_phone': '2348055614455', 'first_name': 'ziga', 'last_name': 'ziga', 'order_id': '85', 'delivery_address': 'lagos'}, 'log': None, 'fees': None, 'fees_split': {'paystack': 2250, 'integration': '1500', 'subaccount': 146250, 'params': {'bearer': 'subaccount', 'transaction_charge': '1500', 'percentage_charge': '0'}}, 'authorization': {}, 'customer': {'id': 296816511, 'first_name': None, 'last_name': None, 'email': 'ziga4455@lola.com', 'customer_code': 'CUS_3maokfy2as1d6qe', 'phone': None, 'metadata': None, 'risk_action': 'default', 'international_format_phone': None}, 'plan': None, 'split': {}, 'order_id': None, 'paidAt': None, 'createdAt': '2025-08-04T22:40:26.000Z', 'requested_amount': 150000, 'pos_transaction_data': None, 'source': None, 'fees_breakdown': None, 'connect': None, 'transaction_date': '2025-08-04T22:40:26.000Z', 'plan_object': {}, 'subaccount': {'id': 1381359, 'subaccount_code': 'ACCT_u9knhyzn5eq4iop', 'business_name': 'MAKINDE VICTOR OLUWASEGUN', 'description': 'MAKINDE VICTOR OLUWASEGUN', 'primary_contact_name': None, 'primary_contact_email': None, 'primary_contact_phone': None, 'metadata': None, 'percentage_charge': 0, 'settlement_bank': 'First City Monument Bank', 'bank_id': 8, 'account_number': '4955073017', 'currency': 'NGN', 'active': True, 'is_verified': True}}}
2025-08-04 23:40:27,694 - handlers.payment_handler - INFO - Payment not yet verified for order 85, attempt 1/15
2025-08-04 23:40:27,695 - handlers.payment_handler - INFO - Payment link created successfully for order 85 with subaccount ACCT_u9knhyzn5eq4iop
2025-08-04 23:40:33,500 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjI1NTk3MTE2MjMwQTQ3MTI5RgA="}]}
2025-08-04 23:40:34,422 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:40:34] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:40:34,632 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:40:34] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:40:35,262 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:40:35] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:40:36,873 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 23:40:36,878 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjI1NTk3MTE2MjMwQTQ3MTI5RgA='}]}
2025-08-04 23:40:36,878 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:40:36] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:40:50,089 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Paid'}
2025-08-04 23:40:53,531 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 23:40:53,532 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-04 23:40:53,532 - handlers.payment_handler - INFO - Received 'paid' command for session 2348055614455, attempting manual verification for ref: PAY-85
2025-08-04 23:40:53,532 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-85
2025-08-04 23:40:54,452 - services.payment_service - INFO - Payment verified successfully for reference PAY-85. Status: success
2025-08-04 23:40:56,135 - handlers.payment_handler - INFO - Manual payment verification successful for order 85
2025-08-04 23:40:56,135 - handlers.payment_handler - INFO - Payment monitoring stopped for session 2348055614455
2025-08-04 23:40:58,066 - utils.data_manager - INFO - Order 85 status updated to confirmed in database
2025-08-04 23:41:01,761 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 23:41:06,451 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjg2QjUxRUI0RjBFMUYwRkVFRAA="}]}
2025-08-04 23:41:06,452 - handlers.feedback_handler - INFO - Initiated feedback collection for order 85, session 2348055614455
2025-08-04 23:41:07,394 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:41:07] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:41:07,564 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:41:07] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:41:07,654 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjZDQTkzRDQxNDlENzU3RURBQgA="}]}
2025-08-04 23:41:07,655 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'message': 'Payment confirmed and feedback initiated'}
2025-08-04 23:41:07,655 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:41:07] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:41:08,475 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:41:08] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:41:08,663 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:41:08] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:41:08,853 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:41:08] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:41:09,235 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:41:09] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:45:36,853 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'final_confirm'}
2025-08-04 23:45:40,505 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 23:45:40,506 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-04 23:45:41,786 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjU0QkZCMDE3M0I1OENGNzRGMAA="}]}
2025-08-04 23:45:41,787 - handlers.feedback_handler - INFO - Initiated feedback collection for order 85, session 2348055614455
2025-08-04 23:45:42,715 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:45:42] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:45:42,867 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjcyOEEzM0JCNzFFNDMwNkU2NQA="}]}
2025-08-04 23:45:42,867 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjcyOEEzM0JCNzFFNDMwNkU2NQA='}]}
2025-08-04 23:45:42,868 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:45:42] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:45:42,890 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:45:42] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:45:43,711 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:45:43] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:45:43,951 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:45:43] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:46:28,941 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:46:28] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:46:29,175 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:46:29] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:46:32,865 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'good'}
2025-08-04 23:46:36,501 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 23:46:36,502 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-04 23:46:36,502 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Thank you for your feedback! Please tell us more about your experience.\n\nType your message or 'skip' to finish."}}
2025-08-04 23:46:37,776 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkJGNTNGOEU2RDgzRkRGMjkwNwA="}]}
2025-08-04 23:46:37,776 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkJGNTNGOEU2RDgzRkRGMjkwNwA='}]}
2025-08-04 23:46:37,777 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:46:37] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:46:38,658 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:46:38] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:46:38,792 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:46:38] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:46:39,445 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:46:39] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:58:20,373 - __main__ - INFO - Starting WhatsApp bot server...
2025-08-04 23:58:21,764 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-08-04 23:58:25,439 - utils.data_manager - INFO - Successfully loaded 12 user details from database
2025-08-04 23:58:25,632 - services.payment_service - INFO - PaymentService initialized
2025-08-04 23:58:27,157 - handlers.product_sync_handler - INFO - Successfully synced 15 products to data\products.json
2025-08-04 23:58:27,335 - app - INFO - Initial product sync successful on startup
2025-08-04 23:58:27,335 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-08-04 23:58:31,039 - utils.data_manager - INFO - Successfully loaded 12 user details from database
2025-08-04 23:58:31,222 - services.payment_service - INFO - PaymentService initialized
2025-08-04 23:58:31,222 - services.lead_tracker - INFO - LeadTracker initialized with DataManager
2025-08-04 23:58:31,222 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-08-04 23:58:31,223 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-08-04 23:58:31,223 - handlers.order_handler - INFO - OrderHandler initialized.
2025-08-04 23:58:31,224 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-04 23:58:31,224 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-08-04 23:58:31,655 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-08-04 23:58:31,656 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-08-04 23:58:31,656 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-08-04 23:58:31,656 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-04 23:58:31,683 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-08-04 23:58:31,684 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-08-04 23:58:35,820 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-08-04 23:58:35,820 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-08-04 23:58:39,265 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 23:58:39,266 - services.lead_tracker - INFO - Updated lead interaction: 2348055614455
2025-08-04 23:58:40,969 - handlers.base_handler - INFO - Session 2348055614455 greeted returning user 'ziga'.
2025-08-04 23:58:42,301 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjU3NTUwQUYwNjUwMzg5MjM1OAA="}]}
2025-08-04 23:58:42,302 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjU3NTUwQUYwNjUwMzg5MjM1OAA='}]}
2025-08-04 23:58:42,302 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:58:42] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:58:43,395 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:58:43] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:58:43,572 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:58:43] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:58:43,918 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:58:43] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:58:44,173 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-08-04 23:58:46,950 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-08-04 23:58:47,669 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 23:58:47,669 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-04 23:58:47,670 - handlers.base_handler - INFO - GreetingHandler: Handling message 'hello' in greeting state for session 2348055614455.
2025-08-04 23:58:47,670 - handlers.base_handler - WARNING - Session 2348055614455: Invalid option 'hello' in greeting state for non-paid user.
2025-08-04 23:58:48,714 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjUxQTFERkQ1RjM4ODVFRUNFMgA="}]}
2025-08-04 23:58:48,715 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjUxQTFERkQ1RjM4ODVFRUNFMgA='}]}
2025-08-04 23:58:48,716 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:58:48] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:58:49,559 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:58:49] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:58:49,979 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:58:49] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:58:50,351 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:58:50] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:58:50,428 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 23:58:50,428 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-04 23:58:50,429 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-08-04 23:58:50,429 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-08-04 23:58:50,429 - handlers.message_processor - INFO - Session 2348055614455: Redirecting to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-08-04 23:58:50,429 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-08-04 23:58:50,430 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'image', 'image': {'link': 'https://eventio.africa/wp-content/uploads/2025/08/ganador-monday.jpg', 'caption': 'Our Delicious Menu!'}}
2025-08-04 23:58:51,499 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjJCQTZGNjNEMjQ1OURDNjBCQgA="}]}
2025-08-04 23:58:51,500 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Hi, I'm Lola from Ganador \n\nTake a look at the menu and type in your order\n\n"}}
2025-08-04 23:58:52,671 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkYwNDQ5N0Y3QkI3NzJDMkNBNQA="}]}
2025-08-04 23:58:52,672 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkYwNDQ5N0Y3QkI3NzJDMkNBNQA='}]}
2025-08-04 23:58:52,673 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:58:52] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:58:52,794 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:58:52] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:58:53,186 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-08-04 23:58:53,916 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:58:53] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:58:54,051 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:58:54] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:58:54,133 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:58:54] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:58:54,231 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:58:54] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:58:54,815 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:58:54] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:58:56,527 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 23:58:56,528 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-04 23:58:56,528 - handlers.base_handler - INFO - AIHandler: Handling message 'ai_bulk_order_direct' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-08-04 23:58:58,046 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Jellof rice'}
2025-08-04 23:58:59,305 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-08-04 23:59:00,629 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkU3ODJDNDNGMkVBMjJFMkUyRgA="}]}
2025-08-04 23:59:00,630 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkU3ODJDNDNGMkVBMjJFMkUyRgA='}]}
2025-08-04 23:59:00,630 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:59:00] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:59:01,468 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 23:59:01,469 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-04 23:59:01,469 - handlers.base_handler - INFO - AIHandler: Handling message 'jellof rice' in AI bulk order state for session 2348055614455. Original: 'Jellof rice'
2025-08-04 23:59:01,629 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:59:01] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:59:01,807 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:59:01] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:59:02,291 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:59:02] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:59:02,453 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-08-04 23:59:03,515 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjIxNjM4NUM2Qjg1N0ZENjdGOQA="}]}
2025-08-04 23:59:03,515 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjIxNjM4NUM2Qjg1N0ZENjdGOQA='}]}
2025-08-04 23:59:03,516 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:59:03] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:59:04,410 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:59:04] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:59:04,620 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:59:04] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:59:05,086 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:59:05] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:59:09,439 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-08-04 23:59:12,809 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 23:59:12,810 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-04 23:59:12,810 - handlers.base_handler - INFO - AI order confirmed. Cart: {'Jollof Rice': {'item_id': '99', 'quantity': 1, 'price': 1500.0, 'total_price': 1500.0, 'variations': {}}}. Redirecting to order handler.
2025-08-04 23:59:12,811 - handlers.message_processor - INFO - Session 2348055614455: Redirecting to handler 'order_handler' with message 'process_final_order'.
2025-08-04 23:59:12,811 - handlers.order_handler - INFO - AI initiated order processing for session 2348055614455.
2025-08-04 23:59:12,811 - handlers.order_handler - INFO - Prompting for note after AI order confirmation for session 2348055614455.
2025-08-04 23:59:13,906 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkEwOThDODE5Mjg5N0IwMTM5QQA="}]}
2025-08-04 23:59:14,825 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:59:14] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:59:15,006 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:59:15] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:59:15,541 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:59:15] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:59:17,308 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 23:59:17,314 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkEwOThDODE5Mjg5N0IwMTM5QQA='}]}
2025-08-04 23:59:17,315 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:59:17] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:59:18,890 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'proceed_to_confirmation'}
2025-08-04 23:59:22,447 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 23:59:22,448 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-04 23:59:22,448 - handlers.order_handler - INFO - User chose to proceed to final confirmation without adding a note for session 2348055614455.
2025-08-04 23:59:23,589 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkI5QTVDODlGOUM2ODIyRUZFQQA="}]}
2025-08-04 23:59:24,490 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:59:24] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:59:24,921 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:59:24] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:59:25,126 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:59:25] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:59:27,086 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 23:59:27,092 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkI5QTVDODlGOUM2ODIyRUZFQQA='}]}
2025-08-04 23:59:27,093 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:59:27] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:59:30,166 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'final_confirm'}
2025-08-04 23:59:33,839 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 23:59:33,839 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-04 23:59:35,720 - utils.data_manager - INFO - Order 86 and its details saved to database
2025-08-04 23:59:35,721 - handlers.order_handler - INFO - Order 86 saved to database for session 2348055614455
2025-08-04 23:59:37,458 - utils.data_manager - INFO - User details for 2348055614455 saved to database
2025-08-04 23:59:37,459 - handlers.order_handler - INFO - User details saved for session 2348055614455 during order confirmation.
2025-08-04 23:59:40,969 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 23:59:40,975 - handlers.message_processor - INFO - Session 2348055614455: Redirecting to handler 'payment_handler' with message 'initiate_payment'.
2025-08-04 23:59:40,975 - handlers.payment_handler - INFO - Handling payment processing for session 2348055614455, message: initiate_payment
2025-08-04 23:59:40,976 - handlers.payment_handler - INFO - Creating payment link for session 2348055614455
2025-08-04 23:59:44,403 - utils.data_manager - INFO - Order 86 status updated to pending_payment in database
2025-08-04 23:59:44,403 - services.payment_service - INFO - Adding subaccount split: code=ACCT_u9knhyzn5eq4iop, percentage=1%
2025-08-04 23:59:44,403 - services.payment_service - INFO - Attempting to create payment link for reference: PAY-86 with amount: 150000, email: ziga4455@lola.com
2025-08-04 23:59:45,470 - services.payment_service - INFO - Payment link created for ziga ziga (2348055614455), URL: https://checkout.paystack.com/8xgn1rrodju5ib4
2025-08-04 23:59:45,470 - handlers.payment_handler - INFO - Starting payment monitoring for order 86, reference PAY-86
2025-08-04 23:59:45,470 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-86
2025-08-04 23:59:47,200 - services.payment_service - WARNING - Payment not successful for reference PAY-86. Paystack status: abandoned. Response: {'status': True, 'message': 'Verification successful', 'data': {'id': 5209424037, 'domain': 'test', 'status': 'abandoned', 'reference': 'PAY-86', 'receipt_number': None, 'amount': 150000, 'message': None, 'gateway_response': 'The transaction was not completed', 'paid_at': None, 'created_at': '2025-08-04T22:59:45.000Z', 'channel': 'card', 'currency': 'NGN', 'ip_address': '216.131.83.116, 104.23.187.67, 172.31.62.52', 'metadata': {'customer_name': 'ziga', 'customer_phone': '2348055614455', 'first_name': 'ziga', 'last_name': 'ziga', 'order_id': '86', 'delivery_address': 'lagos'}, 'log': None, 'fees': None, 'fees_split': {'paystack': 2250, 'integration': '1500', 'subaccount': 146250, 'params': {'bearer': 'subaccount', 'transaction_charge': '1500', 'percentage_charge': '0'}}, 'authorization': {}, 'customer': {'id': 296816511, 'first_name': None, 'last_name': None, 'email': 'ziga4455@lola.com', 'customer_code': 'CUS_3maokfy2as1d6qe', 'phone': None, 'metadata': None, 'risk_action': 'default', 'international_format_phone': None}, 'plan': None, 'split': {}, 'order_id': None, 'paidAt': None, 'createdAt': '2025-08-04T22:59:45.000Z', 'requested_amount': 150000, 'pos_transaction_data': None, 'source': None, 'fees_breakdown': None, 'connect': None, 'transaction_date': '2025-08-04T22:59:45.000Z', 'plan_object': {}, 'subaccount': {'id': 1381359, 'subaccount_code': 'ACCT_u9knhyzn5eq4iop', 'business_name': 'MAKINDE VICTOR OLUWASEGUN', 'description': 'MAKINDE VICTOR OLUWASEGUN', 'primary_contact_name': None, 'primary_contact_email': None, 'primary_contact_phone': None, 'metadata': None, 'percentage_charge': 0, 'settlement_bank': 'First City Monument Bank', 'bank_id': 8, 'account_number': '4955073017', 'currency': 'NGN', 'active': True, 'is_verified': True}}}
2025-08-04 23:59:47,200 - handlers.payment_handler - INFO - Payment not yet verified for order 86, attempt 1/15
2025-08-04 23:59:47,201 - handlers.payment_handler - INFO - Payment link created successfully for order 86 with subaccount ACCT_u9knhyzn5eq4iop
2025-08-04 23:59:52,556 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjdBQ0Q2MUE3NEIwRUUzMjdBQgA="}]}
2025-08-04 23:59:53,617 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:59:53] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:59:53,801 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:59:53] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:59:54,179 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:59:54] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:59:55,212 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'final_confirm'}
2025-08-04 23:59:55,934 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 23:59:55,940 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjdBQ0Q2MUE3NEIwRUUzMjdBQgA='}]}
2025-08-04 23:59:55,941 - werkzeug - INFO - 127.0.0.1 - - [04/Aug/2025 23:59:55] "POST /webhook HTTP/1.1" 200 -
2025-08-04 23:59:58,772 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-04 23:59:58,773 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-05 00:00:00,460 - handlers.payment_handler - INFO - User sent message while still awaiting payment for order 86.
2025-08-05 00:00:05,199 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjFDMUM3NkQ0MkQxNDMwNjFCMAA="}]}
2025-08-05 00:00:06,227 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:00:06] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:00:06,408 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:00:06] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:00:08,669 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-05 00:00:08,674 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjFDMUM3NkQ0MkQxNDMwNjFCMAA='}]}
2025-08-05 00:00:08,675 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:00:08] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:00:10,050 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:00:10] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:00:14,975 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'PAID'}
2025-08-05 00:00:18,407 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-05 00:00:18,408 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-05 00:00:18,408 - handlers.payment_handler - INFO - Received 'paid' command for session 2348055614455, attempting manual verification for ref: PAY-86
2025-08-05 00:00:18,409 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-86
2025-08-05 00:00:19,373 - services.payment_service - INFO - Payment verified successfully for reference PAY-86. Status: success
2025-08-05 00:00:21,059 - handlers.payment_handler - INFO - Manual payment verification successful for order 86
2025-08-05 00:00:21,059 - handlers.payment_handler - INFO - Payment monitoring stopped for session 2348055614455
2025-08-05 00:00:22,749 - utils.data_manager - INFO - Order 86 status updated to confirmed in database
2025-08-05 00:00:22,750 - handlers.payment_handler - ERROR - Error in manual payment verification for reference PAY-86: 'DataManager' object has no attribute 'reduce_inventory_quantity'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\payment_handler.py", line 521, in _handle_manual_payment_verification
    self.data_manager.reduce_inventory_quantity(order_data["order_id"], order_data["merchant_id"])
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'DataManager' object has no attribute 'reduce_inventory_quantity'
2025-08-05 00:00:23,863 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjlERTdDMUREMjE1QTY2MjRFMgA="}]}
2025-08-05 00:00:24,918 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:00:24] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:00:25,041 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:00:25] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:00:25,520 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:00:25] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:00:27,397 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-05 00:00:27,403 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjlERTdDMUREMjE1QTY2MjRFMgA='}]}
2025-08-05 00:00:27,404 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:00:27] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:00:41,599 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Paid'}
2025-08-05 00:00:45,104 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-05 00:00:45,105 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-05 00:00:45,105 - handlers.payment_handler - INFO - Received 'paid' command for session 2348055614455, attempting manual verification for ref: PAY-86
2025-08-05 00:00:45,105 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-86
2025-08-05 00:00:46,022 - services.payment_service - INFO - Payment verified successfully for reference PAY-86. Status: success
2025-08-05 00:00:47,728 - handlers.payment_handler - INFO - Manual payment verification successful for order 86
2025-08-05 00:00:49,438 - utils.data_manager - INFO - Order 86 status updated to confirmed in database
2025-08-05 00:00:49,439 - handlers.payment_handler - ERROR - Error in manual payment verification for reference PAY-86: 'DataManager' object has no attribute 'reduce_inventory_quantity'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\payment_handler.py", line 521, in _handle_manual_payment_verification
    self.data_manager.reduce_inventory_quantity(order_data["order_id"], order_data["merchant_id"])
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'DataManager' object has no attribute 'reduce_inventory_quantity'
2025-08-05 00:00:50,558 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjA2NjM5RDlERDhDQzVCODUxMQA="}]}
2025-08-05 00:00:52,063 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:00:52] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:00:52,349 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:00:52] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:00:52,535 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:00:52] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:00:54,160 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-05 00:00:54,165 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjA2NjM5RDlERDhDQzVCODUxMQA='}]}
2025-08-05 00:00:54,166 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:00:54] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:02:43,679 - __main__ - INFO - Starting WhatsApp bot server...
2025-08-05 00:02:44,934 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-08-05 00:02:48,572 - utils.data_manager - INFO - Successfully loaded 12 user details from database
2025-08-05 00:02:48,759 - services.payment_service - INFO - PaymentService initialized
2025-08-05 00:02:50,280 - handlers.product_sync_handler - INFO - Successfully synced 15 products to data\products.json
2025-08-05 00:02:50,481 - app - INFO - Initial product sync successful on startup
2025-08-05 00:02:50,481 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-08-05 00:02:53,889 - utils.data_manager - INFO - Successfully loaded 12 user details from database
2025-08-05 00:02:54,078 - services.payment_service - INFO - PaymentService initialized
2025-08-05 00:02:54,078 - services.lead_tracker - INFO - LeadTracker initialized with DataManager
2025-08-05 00:02:54,078 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-08-05 00:02:54,079 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-08-05 00:02:54,079 - handlers.order_handler - INFO - OrderHandler initialized.
2025-08-05 00:02:54,080 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-05 00:02:54,080 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-08-05 00:02:54,453 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-08-05 00:02:54,454 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-08-05 00:02:54,454 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-08-05 00:02:54,454 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-05 00:02:54,464 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-08-05 00:02:54,465 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-08-05 00:02:57,671 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-08-05 00:02:57,671 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-08-05 00:03:01,086 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-05 00:03:01,086 - services.lead_tracker - INFO - Updated lead interaction: 2348055614455
2025-08-05 00:03:02,867 - handlers.base_handler - INFO - Session 2348055614455 greeted returning user 'ziga'.
2025-08-05 00:03:04,220 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjNBNTNGMzBGRUNERjQ0MUI1NgA="}]}
2025-08-05 00:03:04,220 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjNBNTNGMzBGRUNERjQ0MUI1NgA='}]}
2025-08-05 00:03:04,221 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:03:04] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:03:05,085 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:03:05] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:03:05,350 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:03:05] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:03:05,620 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:03:05] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:03:08,579 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-08-05 00:03:11,937 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-05 00:03:11,938 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-05 00:03:11,938 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-08-05 00:03:11,938 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-08-05 00:03:11,938 - handlers.message_processor - INFO - Session 2348055614455: Redirecting to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-08-05 00:03:11,939 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-08-05 00:03:11,939 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'image', 'image': {'link': 'https://eventio.africa/wp-content/uploads/2025/08/ganador-tuesday.webp', 'caption': 'Our Delicious Menu!'}}
2025-08-05 00:03:13,268 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjE2OTQ2REUwNDY3M0ExQjMyMQA="}]}
2025-08-05 00:03:13,268 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Hi, I'm Lola from Ganador \n\nTake a look at the menu and type in your order\n\n"}}
2025-08-05 00:03:14,249 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:03:14] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:03:14,329 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjIwNUY4NTdBNkYzNDk2ODNBMQA="}]}
2025-08-05 00:03:14,330 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjIwNUY4NTdBNkYzNDk2ODNBMQA='}]}
2025-08-05 00:03:14,331 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:03:14] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:03:15,378 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:03:15] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:03:15,488 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:03:15] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:03:15,830 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:03:15] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:03:26,374 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Jellof rice'}
2025-08-05 00:03:30,631 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-05 00:03:30,631 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-05 00:03:30,631 - handlers.base_handler - INFO - AIHandler: Handling message 'jellof rice' in AI bulk order state for session 2348055614455. Original: 'Jellof rice'
2025-08-05 00:03:33,020 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-08-05 00:03:34,138 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjY0M0I2QjVBMkFGOUNCNjJBNwA="}]}
2025-08-05 00:03:34,139 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjY0M0I2QjVBMkFGOUNCNjJBNwA='}]}
2025-08-05 00:03:34,139 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:03:34] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:03:35,072 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:03:35] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:03:35,211 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:03:35] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:03:35,552 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:03:35] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:03:52,758 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-08-05 00:03:56,135 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-05 00:03:56,136 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-05 00:03:56,137 - handlers.base_handler - INFO - AI order confirmed. Cart: {'Jollof Rice': {'item_id': '99', 'quantity': 1, 'price': 1500.0, 'total_price': 1500.0, 'variations': {}}}. Redirecting to order handler.
2025-08-05 00:03:56,137 - handlers.message_processor - INFO - Session 2348055614455: Redirecting to handler 'order_handler' with message 'process_final_order'.
2025-08-05 00:03:56,138 - handlers.order_handler - INFO - AI initiated order processing for session 2348055614455.
2025-08-05 00:03:56,138 - handlers.order_handler - INFO - Prompting for note after AI order confirmation for session 2348055614455.
2025-08-05 00:03:59,749 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjcxRURDRTJBQUVEOEQ3NEY2RgA="}]}
2025-08-05 00:04:00,568 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:04:00] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:04:00,742 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:04:00] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:04:01,427 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:04:01] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:04:03,178 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-05 00:04:03,183 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjcxRURDRTJBQUVEOEQ3NEY2RgA='}]}
2025-08-05 00:04:03,184 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:04:03] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:04:03,572 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'proceed_to_confirmation'}
2025-08-05 00:04:06,958 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-05 00:04:06,958 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-05 00:04:06,959 - handlers.order_handler - INFO - User chose to proceed to final confirmation without adding a note for session 2348055614455.
2025-08-05 00:04:08,038 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjE1MjVGNUExQkZFNTJFMDJERQA="}]}
2025-08-05 00:04:08,936 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:04:08] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:04:09,114 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:04:09] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:04:09,670 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:04:09] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:04:11,498 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-05 00:04:11,503 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjE1MjVGNUExQkZFNTJFMDJERQA='}]}
2025-08-05 00:04:11,503 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:04:11] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:04:21,289 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'final_confirm'}
2025-08-05 00:04:24,677 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-05 00:04:24,678 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-05 00:04:26,770 - utils.data_manager - INFO - Order 87 and its details saved to database
2025-08-05 00:04:26,771 - handlers.order_handler - INFO - Order 87 saved to database for session 2348055614455
2025-08-05 00:04:28,457 - utils.data_manager - INFO - User details for 2348055614455 saved to database
2025-08-05 00:04:28,458 - handlers.order_handler - INFO - User details saved for session 2348055614455 during order confirmation.
2025-08-05 00:04:32,580 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-05 00:04:32,586 - handlers.message_processor - INFO - Session 2348055614455: Redirecting to handler 'payment_handler' with message 'initiate_payment'.
2025-08-05 00:04:32,586 - handlers.payment_handler - INFO - Handling payment processing for session 2348055614455, message: initiate_payment
2025-08-05 00:04:32,586 - handlers.payment_handler - INFO - Creating payment link for session 2348055614455
2025-08-05 00:04:36,551 - utils.data_manager - INFO - Order 87 status updated to pending_payment in database
2025-08-05 00:04:36,551 - services.payment_service - INFO - Adding subaccount split: code=ACCT_u9knhyzn5eq4iop, percentage=1%
2025-08-05 00:04:36,552 - services.payment_service - INFO - Attempting to create payment link for reference: PAY-87 with amount: 150000, email: ziga4455@lola.com
2025-08-05 00:04:37,415 - services.payment_service - INFO - Payment link created for ziga ziga (2348055614455), URL: https://checkout.paystack.com/eju3xwncemkbi63
2025-08-05 00:04:37,416 - handlers.payment_handler - INFO - Starting payment monitoring for order 87, reference PAY-87
2025-08-05 00:04:37,416 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-87
2025-08-05 00:04:38,190 - services.payment_service - WARNING - Payment not successful for reference PAY-87. Paystack status: abandoned. Response: {'status': True, 'message': 'Verification successful', 'data': {'id': 5209429523, 'domain': 'test', 'status': 'abandoned', 'reference': 'PAY-87', 'receipt_number': None, 'amount': 150000, 'message': None, 'gateway_response': 'The transaction was not completed', 'paid_at': None, 'created_at': '2025-08-04T23:04:37.000Z', 'channel': 'card', 'currency': 'NGN', 'ip_address': '216.131.83.116, 104.23.190.175, 172.31.68.120', 'metadata': {'customer_name': 'ziga', 'customer_phone': '2348055614455', 'first_name': 'ziga', 'last_name': 'ziga', 'order_id': '87', 'delivery_address': 'lagos'}, 'log': None, 'fees': None, 'fees_split': {'paystack': 2250, 'integration': '1500', 'subaccount': 146250, 'params': {'bearer': 'subaccount', 'transaction_charge': '1500', 'percentage_charge': '0'}}, 'authorization': {}, 'customer': {'id': 296816511, 'first_name': None, 'last_name': None, 'email': 'ziga4455@lola.com', 'customer_code': 'CUS_3maokfy2as1d6qe', 'phone': None, 'metadata': None, 'risk_action': 'default', 'international_format_phone': None}, 'plan': None, 'split': {}, 'order_id': None, 'paidAt': None, 'createdAt': '2025-08-04T23:04:37.000Z', 'requested_amount': 150000, 'pos_transaction_data': None, 'source': None, 'fees_breakdown': None, 'connect': None, 'transaction_date': '2025-08-04T23:04:37.000Z', 'plan_object': {}, 'subaccount': {'id': 1381359, 'subaccount_code': 'ACCT_u9knhyzn5eq4iop', 'business_name': 'MAKINDE VICTOR OLUWASEGUN', 'description': 'MAKINDE VICTOR OLUWASEGUN', 'primary_contact_name': None, 'primary_contact_email': None, 'primary_contact_phone': None, 'metadata': None, 'percentage_charge': 0, 'settlement_bank': 'First City Monument Bank', 'bank_id': 8, 'account_number': '4955073017', 'currency': 'NGN', 'active': True, 'is_verified': True}}}
2025-08-05 00:04:38,191 - handlers.payment_handler - INFO - Payment not yet verified for order 87, attempt 1/15
2025-08-05 00:04:38,191 - handlers.payment_handler - INFO - Payment link created successfully for order 87 with subaccount ACCT_u9knhyzn5eq4iop
2025-08-05 00:04:42,728 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjhCNzZFNkRDMTZEQkY2ODg4OAA="}]}
2025-08-05 00:04:43,782 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:04:43] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:04:43,955 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:04:43] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:04:44,502 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:04:44] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:04:45,629 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'final_confirm'}
2025-08-05 00:04:46,044 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-05 00:04:46,050 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjhCNzZFNkRDMTZEQkY2ODg4OAA='}]}
2025-08-05 00:04:46,050 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:04:46] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:04:49,107 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-05 00:04:49,108 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-05 00:04:50,778 - handlers.payment_handler - INFO - User sent message while still awaiting payment for order 87.
2025-08-05 00:04:55,446 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjVDRDdEQ0Q5QTkwNEU5NkU1RQA="}]}
2025-08-05 00:04:56,328 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:04:56] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:04:56,723 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:04:56] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:04:59,385 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-05 00:04:59,391 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjVDRDdEQ0Q5QTkwNEU5NkU1RQA='}]}
2025-08-05 00:04:59,391 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:04:59] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:05:00,140 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:05:00] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:05:02,549 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Paid'}
2025-08-05 00:05:06,056 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-05 00:05:06,057 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-05 00:05:06,057 - handlers.payment_handler - INFO - Received 'paid' command for session 2348055614455, attempting manual verification for ref: PAY-87
2025-08-05 00:05:06,058 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-87
2025-08-05 00:05:07,250 - services.payment_service - INFO - Payment verified successfully for reference PAY-87. Status: success
2025-08-05 00:05:08,997 - handlers.payment_handler - INFO - Manual payment verification successful for order 87
2025-08-05 00:05:08,998 - handlers.payment_handler - INFO - Payment monitoring stopped for session 2348055614455
2025-08-05 00:05:10,976 - utils.data_manager - INFO - Order 87 status updated to confirmed in database
2025-08-05 00:05:14,467 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-05 00:05:19,153 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjE0NTgyMzQwMEM5NkJGQzBFQwA="}]}
2025-08-05 00:05:19,154 - handlers.feedback_handler - INFO - Initiated feedback collection for order 87, session 2348055614455
2025-08-05 00:05:20,005 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:05:20] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:05:20,174 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:05:20] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:05:20,186 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkE2MzQ1ODE4REM5MkExNkIwMgA="}]}
2025-08-05 00:05:20,187 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'message': 'Payment confirmed and feedback initiated'}
2025-08-05 00:05:20,189 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:05:20] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:05:21,089 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:05:21] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:05:21,440 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:05:21] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:05:22,208 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:05:22] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:05:22,229 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:05:22] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:05:34,210 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'good'}
2025-08-05 00:05:37,777 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-05 00:05:37,778 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-05 00:05:37,778 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': 'Thank you for your feedback!'}}
2025-08-05 00:05:39,298 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkQwMTE3OTZENjM3NDg1OEY5MAA="}]}
2025-08-05 00:05:39,298 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkQwMTE3OTZENjM3NDg1OEY5MAA='}]}
2025-08-05 00:05:39,299 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:05:39] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:05:40,187 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:05:40] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:05:40,319 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:05:40] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:05:40,902 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:05:40] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:05:45,160 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-08-05 00:05:48,750 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-05 00:05:48,750 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-05 00:05:48,752 - handlers.feedback_handler - INFO - Feedback saved to data/feedback.json
2025-08-05 00:05:48,752 - handlers.feedback_handler - INFO - Feedback saved for order 87: good
2025-08-05 00:05:48,752 - utils.session_manager - INFO - Full session 2348055614455 cleared.
2025-08-05 00:05:48,753 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': 'Thank you for your feedback!'}}
2025-08-05 00:05:49,848 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQ1RkY2MEUxNDY0RDA5M0E5MgA="}]}
2025-08-05 00:05:49,849 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQ1RkY2MEUxNDY0RDA5M0E5MgA='}]}
2025-08-05 00:05:49,849 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:05:49] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:05:50,758 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:05:50] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:05:51,170 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:05:51] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:05:51,345 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:05:51] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:11:38,192 - __main__ - INFO - Starting WhatsApp bot server...
2025-08-05 00:11:39,515 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-08-05 00:11:43,861 - utils.data_manager - INFO - Successfully loaded 12 user details from database
2025-08-05 00:11:44,039 - services.payment_service - INFO - PaymentService initialized
2025-08-05 00:11:45,583 - handlers.product_sync_handler - INFO - Successfully synced 15 products to data\products.json
2025-08-05 00:11:45,778 - app - INFO - Initial product sync successful on startup
2025-08-05 00:11:45,779 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-08-05 00:11:49,006 - utils.data_manager - INFO - Successfully loaded 12 user details from database
2025-08-05 00:11:49,198 - services.payment_service - INFO - PaymentService initialized
2025-08-05 00:11:49,198 - services.lead_tracker - INFO - LeadTracker initialized with DataManager
2025-08-05 00:11:49,198 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-08-05 00:11:49,210 - __main__ - ERROR - Unexpected error: FeedbackHandler.__init__() missing 1 required positional argument: 'greeting_handler'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\run.py", line 151, in main
    from app import app
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\app.py", line 55, in <module>
    webhook_handler = WebhookHandler(config)
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\webhook_handler.py", line 22, in __init__
    self.message_processor = MessageProcessor(
                             ~~~~~~~~~~~~~~~~^
        config,
        ^^^^^^^
    ...<4 lines>...
        self.location_service
        ^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\message_processor.py", line 42, in __init__
    self.feedback_handler = FeedbackHandler(config, session_manager, data_manager, whatsapp_service)
                            ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: FeedbackHandler.__init__() missing 1 required positional argument: 'greeting_handler'
2025-08-05 00:13:39,417 - __main__ - INFO - Starting WhatsApp bot server...
2025-08-05 00:13:40,595 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-08-05 00:13:44,636 - utils.data_manager - INFO - Successfully loaded 12 user details from database
2025-08-05 00:13:44,821 - services.payment_service - INFO - PaymentService initialized
2025-08-05 00:13:46,323 - handlers.product_sync_handler - INFO - Successfully synced 15 products to data\products.json
2025-08-05 00:13:46,526 - app - INFO - Initial product sync successful on startup
2025-08-05 00:13:46,527 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-08-05 00:13:49,857 - utils.data_manager - INFO - Successfully loaded 12 user details from database
2025-08-05 00:13:50,035 - services.payment_service - INFO - PaymentService initialized
2025-08-05 00:13:50,035 - services.lead_tracker - INFO - LeadTracker initialized with DataManager
2025-08-05 00:13:50,035 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-08-05 00:13:50,036 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-08-05 00:13:50,036 - handlers.order_handler - INFO - OrderHandler initialized.
2025-08-05 00:13:50,036 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-05 00:13:50,036 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-08-05 00:13:50,771 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-08-05 00:13:50,771 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-08-05 00:13:50,771 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-08-05 00:13:50,771 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-05 00:13:50,799 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-08-05 00:13:50,800 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-08-05 00:13:57,357 - __main__ - INFO - Starting WhatsApp bot server...
2025-08-05 00:13:58,498 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-08-05 00:14:01,776 - utils.data_manager - INFO - Successfully loaded 12 user details from database
2025-08-05 00:14:01,973 - services.payment_service - INFO - PaymentService initialized
2025-08-05 00:14:03,921 - handlers.product_sync_handler - INFO - Successfully synced 15 products to data\products.json
2025-08-05 00:14:04,116 - app - INFO - Initial product sync successful on startup
2025-08-05 00:14:04,116 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-08-05 00:14:07,455 - utils.data_manager - INFO - Successfully loaded 12 user details from database
2025-08-05 00:14:07,648 - services.payment_service - INFO - PaymentService initialized
2025-08-05 00:14:07,648 - services.lead_tracker - INFO - LeadTracker initialized with DataManager
2025-08-05 00:14:07,649 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-08-05 00:14:07,649 - __main__ - ERROR - Unexpected error: FeedbackHandler.__init__() missing 1 required positional argument: 'greeting_handler'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\run.py", line 151, in main
    from app import app
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\app.py", line 55, in <module>
    webhook_handler = WebhookHandler(config)
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\webhook_handler.py", line 22, in __init__
    self.message_processor = MessageProcessor(
                             ~~~~~~~~~~~~~~~~^
        config,
        ^^^^^^^
    ...<4 lines>...
        self.location_service
        ^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\zigam\Documents\Pentanative\Lola_Pentanative\handlers\message_processor.py", line 42, in __init__
    self.feedback_handler = FeedbackHandler(config, session_manager, data_manager, whatsapp_service)
                            ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: FeedbackHandler.__init__() missing 1 required positional argument: 'greeting_handler'
2025-08-05 00:24:29,547 - __main__ - INFO - Starting WhatsApp bot server...
2025-08-05 00:24:30,980 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-08-05 00:24:35,084 - utils.data_manager - INFO - Successfully loaded 12 user details from database
2025-08-05 00:24:35,265 - services.payment_service - INFO - PaymentService initialized
2025-08-05 00:24:36,860 - handlers.product_sync_handler - INFO - Successfully synced 15 products to data\products.json
2025-08-05 00:24:37,054 - app - INFO - Initial product sync successful on startup
2025-08-05 00:24:37,054 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-08-05 00:24:40,354 - utils.data_manager - INFO - Successfully loaded 12 user details from database
2025-08-05 00:24:40,545 - services.payment_service - INFO - PaymentService initialized
2025-08-05 00:24:40,545 - services.lead_tracker - INFO - LeadTracker initialized with DataManager
2025-08-05 00:24:40,545 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-08-05 00:24:40,546 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-08-05 00:24:40,547 - handlers.order_handler - INFO - OrderHandler initialized.
2025-08-05 00:24:40,547 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-05 00:24:40,547 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-08-05 00:24:41,023 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-08-05 00:24:41,023 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-08-05 00:24:41,023 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-08-05 00:24:41,024 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-05 00:24:41,055 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-08-05 00:24:41,056 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-08-05 00:24:51,835 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-08-05 00:24:51,836 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-08-05 00:24:55,346 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-05 00:24:55,347 - services.lead_tracker - INFO - Updated lead interaction: 2348055614455
2025-08-05 00:24:57,337 - handlers.base_handler - INFO - Session 2348055614455 greeted returning user 'ziga'.
2025-08-05 00:24:59,429 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 400 Client Error: Bad Request for url: https://graph.facebook.com/v17.0/204426689424598/messages - {"error":{"message":"(#10) Application does not have permission for this action","type":"OAuthException","code":10,"error_data":{"messaging_product":"whatsapp","details":"There was a problem with the access token or permissions you are using for the API call."},"fbtrace_id":"AE7-BgztvKFZGohkR6lKcCo"}}
2025-08-05 00:24:59,430 - handlers.message_processor - WARNING - Session 2348055614455: No handler response for handler 'greeting_handler', state 'start', message 'hello'. Resetting to greeting.
2025-08-05 00:24:59,430 - handlers.base_handler - INFO - Session 2348055614455 greeted returning user 'ziga'.
2025-08-05 00:25:00,187 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 400 Client Error: Bad Request for url: https://graph.facebook.com/v17.0/204426689424598/messages - {"error":{"message":"(#10) Application does not have permission for this action","type":"OAuthException","code":10,"error_data":{"messaging_product":"whatsapp","details":"There was a problem with the access token or permissions you are using for the API call."},"fbtrace_id":"ALvu_59NRBxLeaR2TCt0elF"}}
2025-08-05 00:25:00,188 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:25:00] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:25:49,539 - __main__ - INFO - Starting WhatsApp bot server...
2025-08-05 00:25:50,685 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-08-05 00:25:54,234 - utils.data_manager - INFO - Successfully loaded 12 user details from database
2025-08-05 00:25:54,425 - services.payment_service - INFO - PaymentService initialized
2025-08-05 00:25:55,966 - handlers.product_sync_handler - INFO - Successfully synced 15 products to data\products.json
2025-08-05 00:25:56,155 - app - INFO - Initial product sync successful on startup
2025-08-05 00:25:56,155 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-08-05 00:25:59,414 - utils.data_manager - INFO - Successfully loaded 12 user details from database
2025-08-05 00:25:59,605 - services.payment_service - INFO - PaymentService initialized
2025-08-05 00:25:59,605 - services.lead_tracker - INFO - LeadTracker initialized with DataManager
2025-08-05 00:25:59,605 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-08-05 00:25:59,605 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-08-05 00:25:59,606 - handlers.order_handler - INFO - OrderHandler initialized.
2025-08-05 00:25:59,606 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-05 00:25:59,607 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-08-05 00:25:59,982 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-08-05 00:25:59,982 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-08-05 00:25:59,982 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-08-05 00:25:59,983 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-05 00:25:59,993 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-08-05 00:25:59,993 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-08-05 00:26:03,631 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-08-05 00:26:03,631 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-08-05 00:26:07,314 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-05 00:26:07,315 - services.lead_tracker - INFO - Updated lead interaction: 2348055614455
2025-08-05 00:26:09,064 - handlers.base_handler - INFO - Session 2348055614455 greeted returning user 'ziga'.
2025-08-05 00:26:10,415 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQ0QTExRjcyNTg3RDM5NkYzMAA="}]}
2025-08-05 00:26:10,415 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQ0QTExRjcyNTg3RDM5NkYzMAA='}]}
2025-08-05 00:26:10,416 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:26:10] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:26:11,422 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:26:11] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:26:12,117 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:26:12] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:26:14,124 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-08-05 00:26:17,655 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-05 00:26:17,656 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-05 00:26:17,657 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-08-05 00:26:17,657 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-08-05 00:26:17,657 - handlers.message_processor - INFO - Session 2348055614455: Redirecting to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-08-05 00:26:17,658 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-08-05 00:26:17,658 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'image', 'image': {'link': 'https://eventio.africa/wp-content/uploads/2025/08/ganador-tuesday.webp', 'caption': 'Our Delicious Menu!'}}
2025-08-05 00:26:18,798 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjczREE4QjMyOEQ3QThFM0NCMwA="}]}
2025-08-05 00:26:18,798 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Hi, I'm Lola from Ganador \n\nTake a look at the menu and type in your order\n\n"}}
2025-08-05 00:26:19,545 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:26:19] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:26:19,911 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQ4Q0VFQTJCRjIyOTZFRTZCQQA="}]}
2025-08-05 00:26:19,912 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQ4Q0VFQTJCRjIyOTZFRTZCQQA='}]}
2025-08-05 00:26:19,912 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:26:19] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:26:20,917 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:26:20] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:26:21,407 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:26:21] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:26:21,828 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:26:21] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:26:27,575 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Jellof rice'}
2025-08-05 00:26:31,034 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-05 00:26:31,034 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-05 00:26:31,035 - handlers.base_handler - INFO - AIHandler: Handling message 'jellof rice' in AI bulk order state for session 2348055614455. Original: 'Jellof rice'
2025-08-05 00:26:34,005 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-08-05 00:26:35,814 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjNFOEJGNkE1RjIwQjVERTZENAA="}]}
2025-08-05 00:26:35,815 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjNFOEJGNkE1RjIwQjVERTZENAA='}]}
2025-08-05 00:26:35,815 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:26:35] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:26:37,069 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:26:37] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:26:37,609 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:26:37] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:26:40,089 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-08-05 00:26:43,644 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-05 00:26:43,644 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-05 00:26:43,645 - handlers.base_handler - INFO - AI order confirmed. Cart: {'Jollof Rice': {'item_id': '99', 'quantity': 1, 'price': 1500.0, 'total_price': 1500.0, 'variations': {}}}. Redirecting to order handler.
2025-08-05 00:26:43,645 - handlers.message_processor - INFO - Session 2348055614455: Redirecting to handler 'order_handler' with message 'process_final_order'.
2025-08-05 00:26:43,645 - handlers.order_handler - INFO - AI initiated order processing for session 2348055614455.
2025-08-05 00:26:43,646 - handlers.order_handler - INFO - Prompting for note after AI order confirmation for session 2348055614455.
2025-08-05 00:26:44,864 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjREQzlFREQ5MUJEQ0Q1NjgzQgA="}]}
2025-08-05 00:26:45,881 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:26:45] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:26:46,237 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:26:46] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:26:46,626 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:26:46] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:26:48,303 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-05 00:26:48,321 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjREQzlFREQ5MUJEQ0Q1NjgzQgA='}]}
2025-08-05 00:26:48,322 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:26:48] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:26:48,427 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'proceed_to_confirmation'}
2025-08-05 00:26:51,916 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-05 00:26:51,917 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-05 00:26:51,917 - handlers.order_handler - INFO - User chose to proceed to final confirmation without adding a note for session 2348055614455.
2025-08-05 00:26:52,976 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjlCNEEyOTgwNkY0QjI5OTYyOAA="}]}
2025-08-05 00:26:54,152 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:26:54] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:26:54,537 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:26:54] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:26:54,886 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:26:54] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:26:56,356 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'final_confirm'}
2025-08-05 00:26:56,463 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-05 00:26:56,469 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjlCNEEyOTgwNkY0QjI5OTYyOAA='}]}
2025-08-05 00:26:56,469 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:26:56] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:26:59,875 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-05 00:26:59,876 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-05 00:27:01,834 - utils.data_manager - INFO - Order 88 and its details saved to database
2025-08-05 00:27:01,835 - handlers.order_handler - INFO - Order 88 saved to database for session 2348055614455
2025-08-05 00:27:03,554 - utils.data_manager - INFO - User details for 2348055614455 saved to database
2025-08-05 00:27:03,554 - handlers.order_handler - INFO - User details saved for session 2348055614455 during order confirmation.
2025-08-05 00:27:07,039 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-05 00:27:07,046 - handlers.message_processor - INFO - Session 2348055614455: Redirecting to handler 'payment_handler' with message 'initiate_payment'.
2025-08-05 00:27:07,046 - handlers.payment_handler - INFO - Handling payment processing for session 2348055614455, message: initiate_payment
2025-08-05 00:27:07,046 - handlers.payment_handler - INFO - Creating payment link for session 2348055614455
2025-08-05 00:27:10,574 - utils.data_manager - INFO - Order 88 status updated to pending_payment in database
2025-08-05 00:27:10,574 - services.payment_service - INFO - Adding subaccount split: code=ACCT_u9knhyzn5eq4iop, percentage=1%
2025-08-05 00:27:10,575 - services.payment_service - INFO - Attempting to create payment link for reference: PAY-88 with amount: 150000, email: ziga4455@lola.com
2025-08-05 00:27:11,396 - services.payment_service - INFO - Payment link created for ziga ziga (2348055614455), URL: https://checkout.paystack.com/frjkmv4goyovnt9
2025-08-05 00:27:11,397 - handlers.payment_handler - INFO - Starting payment monitoring for order 88, reference PAY-88
2025-08-05 00:27:11,397 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-88
2025-08-05 00:27:11,883 - services.payment_service - WARNING - Payment not successful for reference PAY-88. Paystack status: abandoned. Response: {'status': True, 'message': 'Verification successful', 'data': {'id': 5209450577, 'domain': 'test', 'status': 'abandoned', 'reference': 'PAY-88', 'receipt_number': None, 'amount': 150000, 'message': None, 'gateway_response': 'The transaction was not completed', 'paid_at': None, 'created_at': '2025-08-04T23:27:11.000Z', 'channel': 'card', 'currency': 'NGN', 'ip_address': '102.67.12.153, 172.69.224.88, 172.31.68.120', 'metadata': {'customer_name': 'ziga', 'customer_phone': '2348055614455', 'first_name': 'ziga', 'last_name': 'ziga', 'order_id': '88', 'delivery_address': 'lagos'}, 'log': None, 'fees': None, 'fees_split': {'paystack': 2250, 'integration': '1500', 'subaccount': 146250, 'params': {'bearer': 'subaccount', 'transaction_charge': '1500', 'percentage_charge': '0'}}, 'authorization': {}, 'customer': {'id': 296816511, 'first_name': None, 'last_name': None, 'email': 'ziga4455@lola.com', 'customer_code': 'CUS_3maokfy2as1d6qe', 'phone': None, 'metadata': None, 'risk_action': 'default', 'international_format_phone': None}, 'plan': None, 'split': {}, 'order_id': None, 'paidAt': None, 'createdAt': '2025-08-04T23:27:11.000Z', 'requested_amount': 150000, 'pos_transaction_data': None, 'source': None, 'fees_breakdown': None, 'connect': None, 'transaction_date': '2025-08-04T23:27:11.000Z', 'plan_object': {}, 'subaccount': {'id': 1381359, 'subaccount_code': 'ACCT_u9knhyzn5eq4iop', 'business_name': 'MAKINDE VICTOR OLUWASEGUN', 'description': 'MAKINDE VICTOR OLUWASEGUN', 'primary_contact_name': None, 'primary_contact_email': None, 'primary_contact_phone': None, 'metadata': None, 'percentage_charge': 0, 'settlement_bank': 'First City Monument Bank', 'bank_id': 8, 'account_number': '4955073017', 'currency': 'NGN', 'active': True, 'is_verified': True}}}
2025-08-05 00:27:11,884 - handlers.payment_handler - INFO - Payment not yet verified for order 88, attempt 1/15
2025-08-05 00:27:11,885 - handlers.payment_handler - INFO - Payment link created successfully for order 88 with subaccount ACCT_u9knhyzn5eq4iop
2025-08-05 00:27:16,364 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkVGRUIzMDAwQjJGNDIyQzdBMwA="}]}
2025-08-05 00:27:17,325 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:27:17] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:27:18,125 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:27:18] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:27:19,853 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-05 00:27:19,859 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkVGRUIzMDAwQjJGNDIyQzdBMwA='}]}
2025-08-05 00:27:19,859 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:27:19] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:27:33,460 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Paid'}
2025-08-05 00:27:37,133 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-05 00:27:37,134 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-05 00:27:37,134 - handlers.payment_handler - INFO - Received 'paid' command for session 2348055614455, attempting manual verification for ref: PAY-88
2025-08-05 00:27:37,134 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-88
2025-08-05 00:27:37,635 - services.payment_service - INFO - Payment verified successfully for reference PAY-88. Status: success
2025-08-05 00:27:39,374 - handlers.payment_handler - INFO - Manual payment verification successful for order 88
2025-08-05 00:27:39,374 - handlers.payment_handler - INFO - Payment monitoring stopped for session 2348055614455
2025-08-05 00:27:41,134 - utils.data_manager - INFO - Order 88 status updated to confirmed in database
2025-08-05 00:27:44,563 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-05 00:27:49,604 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkJCOEM1NkI2ODdFN0I0NkIxOQA="}]}
2025-08-05 00:27:49,604 - handlers.feedback_handler - INFO - Initiated feedback collection for order 88, session 2348055614455
2025-08-05 00:27:50,670 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:27:50] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:27:50,748 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjI2MUVGNEYxNUQ4NjBBOEI4MQA="}]}
2025-08-05 00:27:50,750 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'message': 'Payment confirmed and feedback initiated'}
2025-08-05 00:27:50,752 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:27:50] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:27:51,766 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:27:51] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:27:51,888 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:27:51] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:27:51,926 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:27:51] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:27:52,146 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:27:52] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:27:52,480 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:27:52] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:27:54,414 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'good'}
2025-08-05 00:27:57,863 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-05 00:27:57,864 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-05 00:27:57,866 - handlers.feedback_handler - INFO - Feedback saved to data/feedback.json
2025-08-05 00:27:57,866 - handlers.feedback_handler - INFO - Feedback saved for order 88: good
2025-08-05 00:27:57,867 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': 'Thank you for your feedback!'}}
2025-08-05 00:27:58,887 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjlGOTRGOTgwNzFGREY2QzU5OAA="}]}
2025-08-05 00:27:58,888 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjlGOTRGOTgwNzFGREY2QzU5OAA='}]}
2025-08-05 00:27:58,888 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:27:58] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:28:00,132 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:28:00] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:28:00,274 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:28:00] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:28:00,592 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:28:00] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:28:06,645 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-08-05 00:28:10,104 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-05 00:28:10,105 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-05 00:28:10,105 - handlers.feedback_handler - INFO - Session 2348055614455: User sent a message after feedback. Redirecting to main menu.
2025-08-05 00:28:10,105 - handlers.base_handler - INFO - Session 2348055614455 returned to main menu (greeting state).
2025-08-05 00:28:11,145 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkFCQjcwNUZDNzk4MEYwMzFGRQA="}]}
2025-08-05 00:28:11,146 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkFCQjcwNUZDNzk4MEYwMzFGRQA='}]}
2025-08-05 00:28:11,146 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:28:11] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:28:12,178 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:28:12] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:28:12,911 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:28:12] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:33:27,061 - __main__ - INFO - Starting WhatsApp bot server...
2025-08-05 00:33:28,835 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-08-05 00:33:33,373 - utils.data_manager - INFO - Successfully loaded 12 user details from database
2025-08-05 00:33:33,563 - services.payment_service - INFO - PaymentService initialized
2025-08-05 00:33:35,118 - handlers.product_sync_handler - INFO - Successfully synced 15 products to data\products.json
2025-08-05 00:33:35,313 - app - INFO - Initial product sync successful on startup
2025-08-05 00:33:35,313 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-08-05 00:33:38,963 - utils.data_manager - INFO - Successfully loaded 12 user details from database
2025-08-05 00:33:39,163 - services.payment_service - INFO - PaymentService initialized
2025-08-05 00:33:39,163 - services.lead_tracker - INFO - LeadTracker initialized with DataManager
2025-08-05 00:33:39,163 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-08-05 00:33:39,164 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-08-05 00:33:39,165 - handlers.order_handler - INFO - OrderHandler initialized.
2025-08-05 00:33:39,165 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-05 00:33:39,165 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-08-05 00:33:39,585 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-08-05 00:33:39,585 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-08-05 00:33:39,585 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-08-05 00:33:39,586 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-05 00:33:39,613 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-08-05 00:33:39,613 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-08-05 00:34:36,860 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-08-05 00:34:36,861 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-08-05 00:34:40,332 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-05 00:34:40,333 - services.lead_tracker - INFO - Updated lead interaction: 2348055614455
2025-08-05 00:34:42,123 - handlers.base_handler - INFO - Session 2348055614455 greeted returning user 'ziga'.
2025-08-05 00:34:44,053 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjY5OTlDOEUwRTUwRUU0MkU0QwA="}]}
2025-08-05 00:34:44,054 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjY5OTlDOEUwRTUwRUU0MkU0QwA='}]}
2025-08-05 00:34:44,055 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:34:44] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:34:45,125 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:34:45] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:34:45,655 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:34:45] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:34:48,166 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-08-05 00:34:52,166 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-05 00:34:52,166 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-05 00:34:52,167 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-08-05 00:34:52,167 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-08-05 00:34:52,167 - handlers.message_processor - INFO - Session 2348055614455: Redirecting to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-08-05 00:34:52,168 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-08-05 00:34:52,168 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'image', 'image': {'link': 'https://eventio.africa/wp-content/uploads/2025/08/ganador-tuesday.webp', 'caption': 'Our Delicious Menu!'}}
2025-08-05 00:34:53,233 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjgxOEE4Q0UxQzVFNkRCRkQ2NQA="}]}
2025-08-05 00:34:53,234 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Hi, I'm Lola from Ganador \n\nTake a look at the menu and type in your order\n\n"}}
2025-08-05 00:34:54,029 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:34:54] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:34:55,113 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQ2N0VBNzFGNkIxQjBGRkJFNgA="}]}
2025-08-05 00:34:55,114 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQ2N0VBNzFGNkIxQjBGRkJFNgA='}]}
2025-08-05 00:34:55,115 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:34:55] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:34:56,380 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:34:56] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:34:56,546 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:34:56] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:34:56,813 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:34:56] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:35:34,761 - __main__ - INFO - Starting WhatsApp bot server...
2025-08-05 00:35:36,118 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-08-05 00:35:39,363 - utils.data_manager - INFO - Successfully loaded 12 user details from database
2025-08-05 00:35:39,553 - services.payment_service - INFO - PaymentService initialized
2025-08-05 00:35:41,262 - handlers.product_sync_handler - INFO - Successfully synced 15 products to data\products.json
2025-08-05 00:35:41,453 - app - INFO - Initial product sync successful on startup
2025-08-05 00:35:41,454 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-08-05 00:35:44,773 - utils.data_manager - INFO - Successfully loaded 12 user details from database
2025-08-05 00:35:44,963 - services.payment_service - INFO - PaymentService initialized
2025-08-05 00:35:44,963 - services.lead_tracker - INFO - LeadTracker initialized with DataManager
2025-08-05 00:35:44,963 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-08-05 00:35:44,963 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-08-05 00:35:44,964 - handlers.order_handler - INFO - OrderHandler initialized.
2025-08-05 00:35:44,964 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-05 00:35:44,965 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-08-05 00:35:45,342 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-08-05 00:35:45,342 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-08-05 00:35:45,342 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-08-05 00:35:45,343 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-05 00:35:45,353 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-08-05 00:35:45,353 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-08-05 00:35:48,864 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-08-05 00:35:48,865 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-08-05 00:35:52,412 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-05 00:35:52,413 - services.lead_tracker - INFO - Updated lead interaction: 2348055614455
2025-08-05 00:35:54,173 - handlers.base_handler - INFO - Session 2348055614455 greeted returning user 'ziga'.
2025-08-05 00:35:55,594 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkM1QjA3N0E1NjJBRDQ1NDJCQQA="}]}
2025-08-05 00:35:55,595 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkM1QjA3N0E1NjJBRDQ1NDJCQQA='}]}
2025-08-05 00:35:55,596 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:35:55] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:35:56,869 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:35:56] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:35:57,314 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:35:57] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:35:59,675 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-08-05 00:36:03,233 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-05 00:36:03,234 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-05 00:36:03,234 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-08-05 00:36:03,234 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-08-05 00:36:03,235 - handlers.message_processor - INFO - Session 2348055614455: Redirecting to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-08-05 00:36:03,235 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-08-05 00:36:03,235 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'image', 'image': {'link': 'https://test.mackennytutors.com/wp-content/uploads/2025/06/ganador.jpg', 'caption': 'Our Delicious Menu!'}}
2025-08-05 00:36:05,563 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkEyQ0JBODMxOEZCMEQyQ0EzQwA="}]}
2025-08-05 00:36:05,563 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Hi, I'm Lola from Ganador \n\nTake a look at the menu and type in your order\n\n"}}
2025-08-05 00:36:07,323 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjNEQkFBNzI5MTZEODM2RjRGQgA="}]}
2025-08-05 00:36:07,324 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjNEQkFBNzI5MTZEODM2RjRGQgA='}]}
2025-08-05 00:36:07,324 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:36:07] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:36:07,953 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:36:07] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:36:08,585 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:36:08] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:36:08,623 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:36:08] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:36:08,922 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:36:08] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:36:09,005 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:36:09] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:36:09,464 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:36:09] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:36:13,478 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Jellof rice'}
2025-08-05 00:36:17,432 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-05 00:36:17,433 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-05 00:36:17,433 - handlers.base_handler - INFO - AIHandler: Handling message 'jellof rice' in AI bulk order state for session 2348055614455. Original: 'Jellof rice'
2025-08-05 00:36:20,213 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-08-05 00:36:21,313 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkFENkIyMDVBMThFNjQ5NDhGRgA="}]}
2025-08-05 00:36:21,314 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkFENkIyMDVBMThFNjQ5NDhGRgA='}]}
2025-08-05 00:36:21,314 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:36:21] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:36:22,374 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:36:22] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:36:22,833 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:36:22] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:36:25,245 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-08-05 00:36:28,683 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-05 00:36:28,684 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-05 00:36:28,684 - handlers.base_handler - INFO - AI order confirmed. Cart: {'Jollof Rice': {'item_id': 99, 'quantity': 1, 'price': 1500.0, 'total_price': 1500.0, 'variations': {}}}. Redirecting to order handler.
2025-08-05 00:36:28,684 - handlers.message_processor - INFO - Session 2348055614455: Redirecting to handler 'order_handler' with message 'process_final_order'.
2025-08-05 00:36:28,685 - handlers.order_handler - INFO - AI initiated order processing for session 2348055614455.
2025-08-05 00:36:28,685 - handlers.order_handler - INFO - Prompting for note after AI order confirmation for session 2348055614455.
2025-08-05 00:36:29,712 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjczMUY4MjE0MjhFMTk4NDIyNAA="}]}
2025-08-05 00:36:30,758 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:36:30] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:36:31,151 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:36:31] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:36:31,486 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:36:31] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:36:32,939 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'proceed_to_confirmation'}
2025-08-05 00:36:33,152 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-05 00:36:33,171 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjczMUY4MjE0MjhFMTk4NDIyNAA='}]}
2025-08-05 00:36:33,172 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:36:33] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:36:36,442 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-05 00:36:36,443 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-05 00:36:36,443 - handlers.order_handler - INFO - User chose to proceed to final confirmation without adding a note for session 2348055614455.
2025-08-05 00:36:37,463 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkM3RjU0MjEzQ0QxRjVFQ0VBOQA="}]}
2025-08-05 00:36:38,528 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:36:38] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:36:38,923 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:36:38] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:36:39,602 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:36:39] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:36:41,095 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-05 00:36:41,102 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkM3RjU0MjEzQ0QxRjVFQ0VBOQA='}]}
2025-08-05 00:36:41,103 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:36:41] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:36:41,175 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'final_confirm'}
2025-08-05 00:36:44,652 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-05 00:36:44,653 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-05 00:36:46,673 - utils.data_manager - INFO - Order 89 and its details saved to database
2025-08-05 00:36:46,674 - handlers.order_handler - INFO - Order 89 saved to database for session 2348055614455
2025-08-05 00:36:48,533 - utils.data_manager - INFO - User details for 2348055614455 saved to database
2025-08-05 00:36:48,533 - handlers.order_handler - INFO - User details saved for session 2348055614455 during order confirmation.
2025-08-05 00:36:52,192 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-05 00:36:52,198 - handlers.message_processor - INFO - Session 2348055614455: Redirecting to handler 'payment_handler' with message 'initiate_payment'.
2025-08-05 00:36:52,198 - handlers.payment_handler - INFO - Handling payment processing for session 2348055614455, message: initiate_payment
2025-08-05 00:36:52,199 - handlers.payment_handler - INFO - Creating payment link for session 2348055614455
2025-08-05 00:36:55,982 - utils.data_manager - INFO - Order 89 status updated to pending_payment in database
2025-08-05 00:36:55,982 - services.payment_service - INFO - Adding subaccount split: code=ACCT_u9knhyzn5eq4iop, percentage=1%
2025-08-05 00:36:55,983 - services.payment_service - INFO - Attempting to create payment link for reference: PAY-89 with amount: 150000, email: ziga4455@lola.com
2025-08-05 00:36:56,747 - services.payment_service - INFO - Payment link created for ziga ziga (2348055614455), URL: https://checkout.paystack.com/xgug5hmos7dj0jy
2025-08-05 00:36:56,748 - handlers.payment_handler - INFO - Starting payment monitoring for order 89, reference PAY-89
2025-08-05 00:36:56,748 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-89
2025-08-05 00:36:57,243 - services.payment_service - WARNING - Payment not successful for reference PAY-89. Paystack status: abandoned. Response: {'status': True, 'message': 'Verification successful', 'data': {'id': 5209458856, 'domain': 'test', 'status': 'abandoned', 'reference': 'PAY-89', 'receipt_number': None, 'amount': 150000, 'message': None, 'gateway_response': 'The transaction was not completed', 'paid_at': None, 'created_at': '2025-08-04T23:36:56.000Z', 'channel': 'card', 'currency': 'NGN', 'ip_address': '102.67.12.153, 172.69.195.123, 172.31.63.81', 'metadata': {'customer_name': 'ziga', 'customer_phone': '2348055614455', 'first_name': 'ziga', 'last_name': 'ziga', 'order_id': '89', 'delivery_address': 'lagos'}, 'log': None, 'fees': None, 'fees_split': {'paystack': 2250, 'integration': '1500', 'subaccount': 146250, 'params': {'bearer': 'subaccount', 'transaction_charge': '1500', 'percentage_charge': '0'}}, 'authorization': {}, 'customer': {'id': 296816511, 'first_name': None, 'last_name': None, 'email': 'ziga4455@lola.com', 'customer_code': 'CUS_3maokfy2as1d6qe', 'phone': None, 'metadata': None, 'risk_action': 'default', 'international_format_phone': None}, 'plan': None, 'split': {}, 'order_id': None, 'paidAt': None, 'createdAt': '2025-08-04T23:36:56.000Z', 'requested_amount': 150000, 'pos_transaction_data': None, 'source': None, 'fees_breakdown': None, 'connect': None, 'transaction_date': '2025-08-04T23:36:56.000Z', 'plan_object': {}, 'subaccount': {'id': 1381359, 'subaccount_code': 'ACCT_u9knhyzn5eq4iop', 'business_name': 'MAKINDE VICTOR OLUWASEGUN', 'description': 'MAKINDE VICTOR OLUWASEGUN', 'primary_contact_name': None, 'primary_contact_email': None, 'primary_contact_phone': None, 'metadata': None, 'percentage_charge': 0, 'settlement_bank': 'First City Monument Bank', 'bank_id': 8, 'account_number': '4955073017', 'currency': 'NGN', 'active': True, 'is_verified': True}}}
2025-08-05 00:36:57,244 - handlers.payment_handler - INFO - Payment not yet verified for order 89, attempt 1/15
2025-08-05 00:36:57,245 - handlers.payment_handler - INFO - Payment link created successfully for order 89 with subaccount ACCT_u9knhyzn5eq4iop
2025-08-05 00:37:01,992 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkQ2ODFFNzQ4MjQyREJGMUI4NgA="}]}
2025-08-05 00:37:02,990 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:37:02] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:37:03,869 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:37:03] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:37:05,602 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-05 00:37:05,608 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkQ2ODFFNzQ4MjQyREJGMUI4NgA='}]}
2025-08-05 00:37:05,608 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:37:05] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:37:06,449 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'final_confirm'}
2025-08-05 00:37:09,932 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-05 00:37:09,933 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-05 00:37:11,782 - handlers.payment_handler - INFO - User sent message while still awaiting payment for order 89.
2025-08-05 00:37:16,833 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjg2QTVGOTdCNkZBRUI2NDNDMAA="}]}
2025-08-05 00:37:18,022 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:37:18] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:37:18,835 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Paid'}
2025-08-05 00:37:18,904 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:37:18] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:37:19,024 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:37:19] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:37:20,313 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-05 00:37:20,319 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjg2QTVGOTdCNkZBRUI2NDNDMAA='}]}
2025-08-05 00:37:20,320 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:37:20] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:37:22,362 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-05 00:37:22,363 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-05 00:37:22,363 - handlers.payment_handler - INFO - Received 'paid' command for session 2348055614455, attempting manual verification for ref: PAY-89
2025-08-05 00:37:22,363 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-89
2025-08-05 00:37:22,853 - services.payment_service - INFO - Payment verified successfully for reference PAY-89. Status: success
2025-08-05 00:37:24,573 - handlers.payment_handler - INFO - Manual payment verification successful for order 89
2025-08-05 00:37:24,573 - handlers.payment_handler - INFO - Payment monitoring stopped for session 2348055614455
2025-08-05 00:37:26,292 - utils.data_manager - INFO - Order 89 status updated to confirmed in database
2025-08-05 00:37:29,752 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-05 00:37:34,603 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkVFNUMxQzE1MDRBRjdFNTg4RgA="}]}
2025-08-05 00:37:34,604 - handlers.feedback_handler - INFO - Initiated feedback collection for order 89, session 2348055614455
2025-08-05 00:37:35,532 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjhCQTE2MTA5MjZBMDczOERGRgA="}]}
2025-08-05 00:37:35,533 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'message': 'Payment confirmed and feedback initiated'}
2025-08-05 00:37:35,533 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:37:35] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:37:35,578 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:37:35] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:37:36,609 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:37:36] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:37:36,723 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:37:36] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:37:37,044 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:37:37] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:37:37,463 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:37:37] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:37:39,145 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'good'}
2025-08-05 00:37:42,692 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-05 00:37:42,692 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-05 00:37:42,694 - handlers.feedback_handler - INFO - Feedback saved to data/feedback.json
2025-08-05 00:37:42,694 - handlers.feedback_handler - INFO - Feedback saved for order 89: good
2025-08-05 00:37:42,695 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': 'Thank you for your feedback!'}}
2025-08-05 00:37:43,883 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjU2MjkxQkFDRUE2Q0NDREEzMQA="}]}
2025-08-05 00:37:43,884 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjU2MjkxQkFDRUE2Q0NDREEzMQA='}]}
2025-08-05 00:37:43,884 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:37:43] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:37:45,149 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:37:45] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:37:45,404 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:37:45] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:37:45,666 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:37:45] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:37:50,629 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-08-05 00:37:54,215 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-05 00:37:54,216 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-05 00:37:54,216 - handlers.feedback_handler - INFO - Session 2348055614455: User sent a message after feedback. Redirecting to main menu.
2025-08-05 00:37:54,216 - handlers.feedback_handler - INFO - Session 2348055614455: User has no active paid session, redirecting to standard menu.
2025-08-05 00:37:55,923 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjU2QTdDQ0MzMjlCNDk0N0Y2NwA="}]}
2025-08-05 00:37:55,923 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjU2QTdDQ0MzMjlCNDk0N0Y2NwA='}]}
2025-08-05 00:37:55,924 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:37:55] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:37:56,863 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:37:56] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:37:57,914 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:37:57] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:46:04,352 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Paid'}
2025-08-05 00:46:07,810 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-05 00:46:07,811 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-05 00:46:07,811 - handlers.base_handler - INFO - GreetingHandler: Handling message 'paid' in greeting state for session 2348055614455.
2025-08-05 00:46:07,812 - handlers.base_handler - WARNING - Session 2348055614455: Invalid option 'paid' in greeting state for non-paid user.
2025-08-05 00:46:09,331 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjJCOEVCRDIyODM2NjM1MTVFOQA="}]}
2025-08-05 00:46:09,332 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjJCOEVCRDIyODM2NjM1MTVFOQA='}]}
2025-08-05 00:46:09,332 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:46:09] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:46:10,437 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:46:10] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:46:11,725 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:46:11] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:55:12,953 - __main__ - INFO - Starting WhatsApp bot server...
2025-08-05 00:55:14,845 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-08-05 00:55:19,231 - utils.data_manager - INFO - Successfully loaded 12 user details from database
2025-08-05 00:55:19,422 - services.payment_service - INFO - PaymentService initialized
2025-08-05 00:55:21,013 - handlers.product_sync_handler - INFO - Successfully synced 15 products to data\products.json
2025-08-05 00:55:21,211 - app - INFO - Initial product sync successful on startup
2025-08-05 00:55:21,212 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-08-05 00:55:24,613 - utils.data_manager - INFO - Successfully loaded 12 user details from database
2025-08-05 00:55:24,817 - services.payment_service - INFO - PaymentService initialized
2025-08-05 00:55:24,818 - services.lead_tracker - INFO - LeadTracker initialized with DataManager
2025-08-05 00:55:24,819 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-08-05 00:55:24,821 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-08-05 00:55:24,823 - handlers.order_handler - INFO - OrderHandler initialized.
2025-08-05 00:55:24,824 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-05 00:55:24,825 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-08-05 00:55:25,484 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-08-05 00:55:25,484 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-08-05 00:55:25,485 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-08-05 00:55:25,486 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-05 00:55:25,507 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-08-05 00:55:25,508 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-08-05 00:55:29,193 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-08-05 00:55:29,194 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-08-05 00:55:33,329 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-05 00:55:33,331 - services.lead_tracker - INFO - Updated lead interaction: 2348055614455
2025-08-05 00:55:35,140 - handlers.base_handler - INFO - Session 2348055614455 greeted returning user 'ziga'.
2025-08-05 00:55:37,502 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjEwNEFGREFFNDEwQURBRjAwRQA="}]}
2025-08-05 00:55:37,503 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjEwNEFGREFFNDEwQURBRjAwRQA='}]}
2025-08-05 00:55:37,505 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:55:37] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:55:38,482 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:55:38] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:55:39,212 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:55:39] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:55:40,842 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-08-05 00:55:44,300 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-05 00:55:44,301 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-05 00:55:44,301 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-08-05 00:55:44,302 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-08-05 00:55:44,302 - handlers.message_processor - INFO - Session 2348055614455: Redirecting to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-08-05 00:55:44,303 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-08-05 00:55:44,303 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'image', 'image': {'link': 'https://test.mackennytutors.com/wp-content/uploads/2025/06/ganador.jpg', 'caption': 'Our Delicious Menu!'}}
2025-08-05 00:55:45,266 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:55:45] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:55:45,451 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkNFQjczNDc3NTFGMzFEQzlCMwA="}]}
2025-08-05 00:55:45,453 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Hi, I'm Lola from Ganador \n\nTake a look at the menu and type in your order\n\n"}}
2025-08-05 00:55:46,653 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjNDQ0ZGOUNEOEI5ODNBOEU3QwA="}]}
2025-08-05 00:55:46,654 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjNDQ0ZGOUNEOEI5ODNBOEU3QwA='}]}
2025-08-05 00:55:46,655 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:55:46] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:55:47,735 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:55:47] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:55:48,295 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:55:48] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:55:48,416 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:55:48] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:55:48,431 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:55:48] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:55:48,922 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:55:48] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:55:49,234 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:55:49] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:55:52,702 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Jellof rice'}
2025-08-05 00:55:56,243 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-05 00:55:56,244 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-05 00:55:56,245 - handlers.base_handler - INFO - AIHandler: Handling message 'jellof rice' in AI bulk order state for session 2348055614455. Original: 'Jellof rice'
2025-08-05 00:55:58,802 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-08-05 00:55:59,981 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkQ4QTE0NzMyMUVBRjc5MTRCMAA="}]}
2025-08-05 00:55:59,982 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkQ4QTE0NzMyMUVBRjc5MTRCMAA='}]}
2025-08-05 00:55:59,983 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:55:59] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:56:01,208 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:56:01] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:56:01,931 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:56:01] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:56:03,432 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-08-05 00:56:06,883 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-05 00:56:06,884 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-05 00:56:06,884 - handlers.base_handler - INFO - AI order confirmed. Cart: {'Jollof Rice': {'item_id': '99', 'quantity': 1, 'price': 1500.0, 'total_price': 1500.0, 'variations': {}}}. Redirecting to order handler.
2025-08-05 00:56:06,884 - handlers.message_processor - INFO - Session 2348055614455: Redirecting to handler 'order_handler' with message 'process_final_order'.
2025-08-05 00:56:06,885 - handlers.order_handler - INFO - AI initiated order processing for session 2348055614455.
2025-08-05 00:56:06,885 - handlers.order_handler - INFO - Prompting for note after AI order confirmation for session 2348055614455.
2025-08-05 00:56:07,942 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjFEMENFRDYzQTc3RDk5MjdFNgA="}]}
2025-08-05 00:56:08,960 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:56:08] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:56:09,314 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:56:09] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:56:09,642 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:56:09] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:56:11,404 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-05 00:56:11,410 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjFEMENFRDYzQTc3RDk5MjdFNgA='}]}
2025-08-05 00:56:11,411 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:56:11] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:56:11,842 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'proceed_to_confirmation'}
2025-08-05 00:56:15,329 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-05 00:56:15,330 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-05 00:56:15,330 - handlers.order_handler - INFO - User chose to proceed to final confirmation without adding a note for session 2348055614455.
2025-08-05 00:56:16,377 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjU4RkE4Njk0ODZBRDIzODMyQwA="}]}
2025-08-05 00:56:17,524 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:56:17] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:56:17,791 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:56:17] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:56:18,052 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:56:18] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:56:19,702 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'final_confirm'}
2025-08-05 00:56:19,790 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-05 00:56:19,796 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjU4RkE4Njk0ODZBRDIzODMyQwA='}]}
2025-08-05 00:56:19,796 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:56:19] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:56:23,122 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-05 00:56:23,123 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-05 00:56:25,032 - utils.data_manager - INFO - Order 90 and its details saved to database
2025-08-05 00:56:25,033 - handlers.order_handler - INFO - Order 90 saved to database for session 2348055614455
2025-08-05 00:56:27,141 - utils.data_manager - INFO - User details for 2348055614455 saved to database
2025-08-05 00:56:27,142 - handlers.order_handler - INFO - User details saved for session 2348055614455 during order confirmation.
2025-08-05 00:56:30,633 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-05 00:56:30,640 - handlers.message_processor - INFO - Session 2348055614455: Redirecting to handler 'payment_handler' with message 'initiate_payment'.
2025-08-05 00:56:30,640 - handlers.payment_handler - INFO - Handling payment processing for session 2348055614455, message: initiate_payment
2025-08-05 00:56:30,640 - handlers.payment_handler - INFO - Creating payment link for session 2348055614455
2025-08-05 00:56:34,029 - utils.data_manager - INFO - Order 90 status updated to pending_payment in database
2025-08-05 00:56:34,030 - services.payment_service - INFO - Adding subaccount split: code=ACCT_u9knhyzn5eq4iop, percentage=1%
2025-08-05 00:56:34,030 - services.payment_service - INFO - Attempting to create payment link for reference: PAY-90 with amount: 150000, email: ziga4455@lola.com
2025-08-05 00:56:34,852 - services.payment_service - INFO - Payment link created for ziga ziga (2348055614455), URL: https://checkout.paystack.com/ndp5gj8w6n19xl1
2025-08-05 00:56:34,853 - handlers.payment_handler - INFO - Starting payment monitoring for order 90, reference PAY-90
2025-08-05 00:56:34,853 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-90
2025-08-05 00:56:35,410 - services.payment_service - WARNING - Payment not successful for reference PAY-90. Paystack status: abandoned. Response: {'status': True, 'message': 'Verification successful', 'data': {'id': 5209474431, 'domain': 'test', 'status': 'abandoned', 'reference': 'PAY-90', 'receipt_number': None, 'amount': 150000, 'message': None, 'gateway_response': 'The transaction was not completed', 'paid_at': None, 'created_at': '2025-08-04T23:56:34.000Z', 'channel': 'card', 'currency': 'NGN', 'ip_address': '102.67.12.153, 172.70.91.85, 172.31.62.52', 'metadata': {'customer_name': 'ziga', 'customer_phone': '2348055614455', 'first_name': 'ziga', 'last_name': 'ziga', 'order_id': '90', 'delivery_address': 'lagos'}, 'log': None, 'fees': None, 'fees_split': {'paystack': 2250, 'integration': '1500', 'subaccount': 146250, 'params': {'bearer': 'subaccount', 'transaction_charge': '1500', 'percentage_charge': '0'}}, 'authorization': {}, 'customer': {'id': 296816511, 'first_name': None, 'last_name': None, 'email': 'ziga4455@lola.com', 'customer_code': 'CUS_3maokfy2as1d6qe', 'phone': None, 'metadata': None, 'risk_action': 'default', 'international_format_phone': None}, 'plan': None, 'split': {}, 'order_id': None, 'paidAt': None, 'createdAt': '2025-08-04T23:56:34.000Z', 'requested_amount': 150000, 'pos_transaction_data': None, 'source': None, 'fees_breakdown': None, 'connect': None, 'transaction_date': '2025-08-04T23:56:34.000Z', 'plan_object': {}, 'subaccount': {'id': 1381359, 'subaccount_code': 'ACCT_u9knhyzn5eq4iop', 'business_name': 'MAKINDE VICTOR OLUWASEGUN', 'description': 'MAKINDE VICTOR OLUWASEGUN', 'primary_contact_name': None, 'primary_contact_email': None, 'primary_contact_phone': None, 'metadata': None, 'percentage_charge': 0, 'settlement_bank': 'First City Monument Bank', 'bank_id': 8, 'account_number': '4955073017', 'currency': 'NGN', 'active': True, 'is_verified': True}}}
2025-08-05 00:56:35,411 - handlers.payment_handler - INFO - Payment not yet verified for order 90, attempt 1/15
2025-08-05 00:56:35,411 - handlers.payment_handler - INFO - Payment link created successfully for order 90 with subaccount ACCT_u9knhyzn5eq4iop
2025-08-05 00:56:39,930 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjhBOTc2QUE4RTc2N0Q1MzUwNwA="}]}
2025-08-05 00:56:40,998 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:56:40] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:56:41,600 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:56:41] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:56:43,441 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-05 00:56:43,448 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjhBOTc2QUE4RTc2N0Q1MzUwNwA='}]}
2025-08-05 00:56:43,448 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 00:56:43] "POST /webhook HTTP/1.1" 200 -
2025-08-05 00:56:56,855 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Paid'}
2025-08-05 00:57:00,300 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-05 00:57:00,301 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-05 00:57:00,301 - handlers.payment_handler - INFO - Received 'paid' command for session 2348055614455, attempting manual verification for ref: PAY-90
2025-08-05 00:57:00,301 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-90
2025-08-05 00:57:00,784 - services.payment_service - INFO - Payment verified successfully for reference PAY-90. Status: success
2025-08-05 00:57:02,479 - handlers.payment_handler - INFO - Manual payment verification successful for order 90
2025-08-05 00:57:02,479 - handlers.payment_handler - INFO - Payment monitoring stopped for session 2348055614455
2025-08-05 00:57:04,260 - utils.data_manager - INFO - Order 90 status updated to confirmed in database
2025-08-05 00:57:22,031 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Paid'}
2025-08-05 00:57:47,271 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Paid'}
2025-08-05 00:58:01,915 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Paid'}
2025-08-05 00:58:13,985 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Paid'}
2025-08-05 00:58:27,081 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Paid'}
2025-08-05 00:58:52,271 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Paid'}
2025-08-05 00:59:02,960 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Paid'}
2025-08-05 00:59:18,863 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Paid'}
2025-08-05 01:00:07,800 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Paid'}
2025-08-05 01:03:03,170 - __main__ - INFO - Starting WhatsApp bot server...
2025-08-05 01:03:04,451 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-08-05 01:03:08,506 - utils.data_manager - INFO - Successfully loaded 12 user details from database
2025-08-05 01:03:08,817 - services.payment_service - INFO - PaymentService initialized
2025-08-05 01:03:10,511 - handlers.product_sync_handler - INFO - Successfully synced 15 products to data\products.json
2025-08-05 01:03:10,692 - app - INFO - Initial product sync successful on startup
2025-08-05 01:03:10,693 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-08-05 01:03:14,179 - utils.data_manager - INFO - Successfully loaded 12 user details from database
2025-08-05 01:03:14,380 - services.payment_service - INFO - PaymentService initialized
2025-08-05 01:03:14,381 - services.lead_tracker - INFO - LeadTracker initialized with DataManager
2025-08-05 01:03:14,381 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-08-05 01:03:14,381 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-08-05 01:03:14,382 - handlers.order_handler - INFO - OrderHandler initialized.
2025-08-05 01:03:14,382 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-05 01:03:14,383 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-08-05 01:03:14,769 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-08-05 01:03:14,770 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-08-05 01:03:14,770 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-08-05 01:03:14,770 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_u9knhyzn5eq4iop, split percentage 1%
2025-08-05 01:03:14,791 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-08-05 01:03:14,791 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-08-05 01:03:29,813 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-08-05 01:03:29,813 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-08-05 01:03:33,246 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-05 01:03:33,247 - services.lead_tracker - INFO - Updated lead interaction: 2348055614455
2025-08-05 01:03:35,099 - handlers.base_handler - INFO - Session 2348055614455 greeted returning user 'ziga'.
2025-08-05 01:03:36,129 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkJDNEM4OURGOUU2OTI5QUJGOAA="}]}
2025-08-05 01:03:36,129 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkJDNEM4OURGOUU2OTI5QUJGOAA='}]}
2025-08-05 01:03:36,130 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 01:03:36] "POST /webhook HTTP/1.1" 200 -
2025-08-05 01:03:37,353 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 01:03:37] "POST /webhook HTTP/1.1" 200 -
2025-08-05 01:03:38,097 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 01:03:38] "POST /webhook HTTP/1.1" 200 -
2025-08-05 01:03:40,706 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-08-05 01:03:44,263 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-05 01:03:44,264 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-05 01:03:44,264 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-08-05 01:03:44,265 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-08-05 01:03:44,265 - handlers.message_processor - INFO - Session 2348055614455: Redirecting to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-08-05 01:03:44,265 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-08-05 01:03:44,265 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'image', 'image': {'link': 'https://test.mackennytutors.com/wp-content/uploads/2025/06/ganador.jpg', 'caption': 'Our Delicious Menu!'}}
2025-08-05 01:03:45,628 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkQ2NjZBMTBEMTMzRUU4QkNGOQA="}]}
2025-08-05 01:03:45,628 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Hi, I'm Lola from Ganador \n\nTake a look at the menu and type in your order\n\n"}}
2025-08-05 01:03:46,625 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjkxQTk5QTQxMkU2QjU0NTA5RQA="}]}
2025-08-05 01:03:46,626 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjkxQTk5QTQxMkU2QjU0NTA5RQA='}]}
2025-08-05 01:03:46,626 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 01:03:46] "POST /webhook HTTP/1.1" 200 -
2025-08-05 01:03:47,084 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 01:03:47] "POST /webhook HTTP/1.1" 200 -
2025-08-05 01:03:47,710 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 01:03:47] "POST /webhook HTTP/1.1" 200 -
2025-08-05 01:03:47,810 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 01:03:47] "POST /webhook HTTP/1.1" 200 -
2025-08-05 01:03:47,812 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 01:03:47] "POST /webhook HTTP/1.1" 200 -
2025-08-05 01:03:48,240 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 01:03:48] "POST /webhook HTTP/1.1" 200 -
2025-08-05 01:03:48,313 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 01:03:48] "POST /webhook HTTP/1.1" 200 -
2025-08-05 01:03:51,351 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Jellof rice'}
2025-08-05 01:03:54,727 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-05 01:03:54,728 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-05 01:03:54,728 - handlers.base_handler - INFO - AIHandler: Handling message 'jellof rice' in AI bulk order state for session 2348055614455. Original: 'Jellof rice'
2025-08-05 01:03:57,503 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-08-05 01:03:58,820 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkJBRTJFNEQ2RkJEMDBENkM5MgA="}]}
2025-08-05 01:03:58,821 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkJBRTJFNEQ2RkJEMDBENkM5MgA='}]}
2025-08-05 01:03:58,821 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 01:03:58] "POST /webhook HTTP/1.1" 200 -
2025-08-05 01:03:59,892 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 01:03:59] "POST /webhook HTTP/1.1" 200 -
2025-08-05 01:04:00,488 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 01:04:00] "POST /webhook HTTP/1.1" 200 -
2025-08-05 01:04:02,632 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-08-05 01:04:06,222 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-05 01:04:06,222 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-05 01:04:06,223 - handlers.base_handler - INFO - AI order confirmed. Cart: {'Jollof Rice': {'item_id': '99', 'quantity': 1, 'price': 1500.0, 'total_price': 1500.0, 'variations': {}}}. Redirecting to order handler.
2025-08-05 01:04:06,223 - handlers.message_processor - INFO - Session 2348055614455: Redirecting to handler 'order_handler' with message 'process_final_order'.
2025-08-05 01:04:06,223 - handlers.order_handler - INFO - AI initiated order processing for session 2348055614455.
2025-08-05 01:04:06,223 - handlers.order_handler - INFO - Prompting for note after AI order confirmation for session 2348055614455.
2025-08-05 01:04:07,345 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjY5MUY4NkJGNzQyQTY3MkNDRQA="}]}
2025-08-05 01:04:08,357 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 01:04:08] "POST /webhook HTTP/1.1" 200 -
2025-08-05 01:04:08,751 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 01:04:08] "POST /webhook HTTP/1.1" 200 -
2025-08-05 01:04:09,197 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 01:04:09] "POST /webhook HTTP/1.1" 200 -
2025-08-05 01:04:10,789 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-05 01:04:10,795 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjY5MUY4NkJGNzQyQTY3MkNDRQA='}]}
2025-08-05 01:04:10,796 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 01:04:10] "POST /webhook HTTP/1.1" 200 -
2025-08-05 01:04:11,558 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'proceed_to_confirmation'}
2025-08-05 01:04:14,985 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-05 01:04:14,985 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-05 01:04:14,986 - handlers.order_handler - INFO - User chose to proceed to final confirmation without adding a note for session 2348055614455.
2025-08-05 01:04:16,151 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjI0NEM3MjI3MzY2NTYyNEY0QwA="}]}
2025-08-05 01:04:17,335 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 01:04:17] "POST /webhook HTTP/1.1" 200 -
2025-08-05 01:04:17,518 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 01:04:17] "POST /webhook HTTP/1.1" 200 -
2025-08-05 01:04:17,931 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 01:04:17] "POST /webhook HTTP/1.1" 200 -
2025-08-05 01:04:20,157 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-05 01:04:20,163 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjI0NEM3MjI3MzY2NTYyNEY0QwA='}]}
2025-08-05 01:04:20,163 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 01:04:20] "POST /webhook HTTP/1.1" 200 -
2025-08-05 01:04:20,248 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'final_confirm'}
2025-08-05 01:04:23,728 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-05 01:04:23,728 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-05 01:04:25,646 - utils.data_manager - INFO - Order 91 and its details saved to database
2025-08-05 01:04:25,647 - handlers.order_handler - INFO - Order 91 saved to database for session 2348055614455
2025-08-05 01:04:27,351 - utils.data_manager - INFO - User details for 2348055614455 saved to database
2025-08-05 01:04:27,352 - handlers.order_handler - INFO - User details saved for session 2348055614455 during order confirmation.
2025-08-05 01:04:30,796 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-05 01:04:30,801 - handlers.message_processor - INFO - Session 2348055614455: Redirecting to handler 'payment_handler' with message 'initiate_payment'.
2025-08-05 01:04:30,801 - handlers.payment_handler - INFO - Handling payment processing for session 2348055614455, message: initiate_payment
2025-08-05 01:04:30,802 - handlers.payment_handler - INFO - Creating payment link for session 2348055614455
2025-08-05 01:04:34,382 - utils.data_manager - INFO - Order 91 status updated to pending_payment in database
2025-08-05 01:04:34,383 - services.payment_service - INFO - Adding subaccount split: code=ACCT_u9knhyzn5eq4iop, percentage=1%
2025-08-05 01:04:34,383 - services.payment_service - INFO - Attempting to create payment link for reference: PAY-91 with amount: 150000, email: ziga4455@lola.com
2025-08-05 01:04:35,024 - services.payment_service - INFO - Payment link created for ziga ziga (2348055614455), URL: https://checkout.paystack.com/ehp9zg2fsviz6j3
2025-08-05 01:04:35,025 - handlers.payment_handler - INFO - Starting payment monitoring for order 91, reference PAY-91
2025-08-05 01:04:35,025 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-91
2025-08-05 01:04:35,549 - services.payment_service - WARNING - Payment not successful for reference PAY-91. Paystack status: abandoned. Response: {'status': True, 'message': 'Verification successful', 'data': {'id': 5209483729, 'domain': 'test', 'status': 'abandoned', 'reference': 'PAY-91', 'receipt_number': None, 'amount': 150000, 'message': None, 'gateway_response': 'The transaction was not completed', 'paid_at': None, 'created_at': '2025-08-05T00:04:34.000Z', 'channel': 'card', 'currency': 'NGN', 'ip_address': '102.67.12.153, 172.68.229.171, 172.31.63.81', 'metadata': {'customer_name': 'ziga', 'customer_phone': '2348055614455', 'first_name': 'ziga', 'last_name': 'ziga', 'order_id': '91', 'delivery_address': 'lagos'}, 'log': None, 'fees': None, 'fees_split': {'paystack': 2250, 'integration': '1500', 'subaccount': 146250, 'params': {'bearer': 'subaccount', 'transaction_charge': '1500', 'percentage_charge': '0'}}, 'authorization': {}, 'customer': {'id': 296816511, 'first_name': None, 'last_name': None, 'email': 'ziga4455@lola.com', 'customer_code': 'CUS_3maokfy2as1d6qe', 'phone': None, 'metadata': None, 'risk_action': 'default', 'international_format_phone': None}, 'plan': None, 'split': {}, 'order_id': None, 'paidAt': None, 'createdAt': '2025-08-05T00:04:34.000Z', 'requested_amount': 150000, 'pos_transaction_data': None, 'source': None, 'fees_breakdown': None, 'connect': None, 'transaction_date': '2025-08-05T00:04:34.000Z', 'plan_object': {}, 'subaccount': {'id': 1381359, 'subaccount_code': 'ACCT_u9knhyzn5eq4iop', 'business_name': 'MAKINDE VICTOR OLUWASEGUN', 'description': 'MAKINDE VICTOR OLUWASEGUN', 'primary_contact_name': None, 'primary_contact_email': None, 'primary_contact_phone': None, 'metadata': None, 'percentage_charge': 0, 'settlement_bank': 'First City Monument Bank', 'bank_id': 8, 'account_number': '4955073017', 'currency': 'NGN', 'active': True, 'is_verified': True}}}
2025-08-05 01:04:35,550 - handlers.payment_handler - INFO - Payment not yet verified for order 91, attempt 1/15
2025-08-05 01:04:35,550 - handlers.payment_handler - INFO - Payment link created successfully for order 91 with subaccount ACCT_u9knhyzn5eq4iop
2025-08-05 01:04:41,861 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjU2NzNCNTk2NUMwNzYxQTZBNgA="}]}
2025-08-05 01:04:42,879 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 01:04:42] "POST /webhook HTTP/1.1" 200 -
2025-08-05 01:04:43,641 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 01:04:43] "POST /webhook HTTP/1.1" 200 -
2025-08-05 01:04:45,290 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-05 01:04:45,296 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjU2NzNCNTk2NUMwNzYxQTZBNgA='}]}
2025-08-05 01:04:45,297 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 01:04:45] "POST /webhook HTTP/1.1" 200 -
2025-08-05 01:04:45,523 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'final_confirm'}
2025-08-05 01:04:49,028 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-05 01:04:49,029 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-05 01:04:50,822 - handlers.payment_handler - INFO - User sent message while still awaiting payment for order 91.
2025-08-05 01:04:55,388 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjMyM0EwN0IwRTc3N0REMzc4NAA="}]}
2025-08-05 01:04:56,599 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 01:04:56] "POST /webhook HTTP/1.1" 200 -
2025-08-05 01:04:56,898 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 01:04:56] "POST /webhook HTTP/1.1" 200 -
2025-08-05 01:04:57,398 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 01:04:57] "POST /webhook HTTP/1.1" 200 -
2025-08-05 01:04:58,164 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Paid'}
2025-08-05 01:04:59,018 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-05 01:04:59,023 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjMyM0EwN0IwRTc3N0REMzc4NAA='}]}
2025-08-05 01:04:59,024 - werkzeug - INFO - 127.0.0.1 - - [05/Aug/2025 01:04:59] "POST /webhook HTTP/1.1" 200 -
2025-08-05 01:05:01,530 - utils.data_manager - INFO - Lead details for 2348055614455 saved/updated in database.
2025-08-05 01:05:01,531 - services.lead_tracker - INFO - Updated ongoing interaction: 2348055614455
2025-08-05 01:05:01,532 - handlers.payment_handler - INFO - Received 'paid' command for session 2348055614455, attempting manual verification for ref: PAY-91
2025-08-05 01:05:01,532 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-91
2025-08-05 01:05:02,246 - services.payment_service - INFO - Payment verified successfully for reference PAY-91. Status: success
2025-08-05 01:05:03,960 - handlers.payment_handler - INFO - Manual payment verification successful for order 91
2025-08-05 01:05:03,961 - handlers.payment_handler - INFO - Payment monitoring stopped for session 2348055614455
2025-08-05 01:05:05,679 - utils.data_manager - INFO - Order 91 status updated to confirmed in database
2025-08-05 01:05:23,254 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Paid'}
2025-08-05 01:05:48,471 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Paid'}
2025-08-05 01:05:57,457 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Paid'}
2025-08-05 01:06:06,087 - __main__ - INFO - Starting WhatsApp bot server...
2025-08-05 01:06:07,870 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
