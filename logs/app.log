2025-06-11 04:34:22,487 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-11 04:34:22,487 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 04:34:22,488 - utils.data_manager - ERROR - Error decoding data\user_details.json. Starting with empty user details.
2025-06-11 04:34:22,489 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 04:34:22,489 - services.payment_service - INFO - PaymentService initialized
2025-06-11 04:34:22,489 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 04:34:22,490 - utils.data_manager - ERROR - Error decoding data\user_details.json. Starting with empty user details.
2025-06-11 04:34:22,491 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 04:34:22,491 - services.payment_service - INFO - PaymentService initialized
2025-06-11 04:34:22,492 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-11 04:34:22,492 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-11 04:34:22,492 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 04:34:22,493 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-11 04:34:22,493 - __main__ - ERROR - Unexpected error: 'Config' object has no attribute 'get'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\Lola\app\run.py", line 151, in main
    from app import app
  File "C:\Users\zigam\Documents\Lola\Lola\app\app.py", line 64, in <module>
    webhook_handler = WebhookHandler(config) # WebhookHandler was modified to initialize its own services
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\webhook_handler.py", line 22, in __init__
    self.message_processor = MessageProcessor(
                             ~~~~~~~~~~~~~~~~^
        config,
        ^^^^^^^
    ...<4 lines>...
        self.location_service
        ^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 41, in __init__
    self.ai_handler = AIHandler(config, session_manager, data_manager, whatsapp_service) # Initialize AIHandler
                      ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\ai_handler.py", line 30, in __init__
    self.ai_service = AIService(config, data_manager)
                      ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Lola\Lola\app\services\ai_service.py", line 47, in __init__
    self.azure_api_key = config.get("azure_api_key")
                         ^^^^^^^^^^
AttributeError: 'Config' object has no attribute 'get'
2025-06-11 04:35:47,418 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-11 04:35:47,419 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 04:35:47,419 - utils.data_manager - ERROR - Error decoding data\user_details.json. Starting with empty user details.
2025-06-11 04:35:47,420 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 04:35:47,420 - services.payment_service - INFO - PaymentService initialized
2025-06-11 04:35:47,420 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 04:35:47,421 - utils.data_manager - ERROR - Error decoding data\user_details.json. Starting with empty user details.
2025-06-11 04:35:47,421 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 04:35:47,422 - services.payment_service - INFO - PaymentService initialized
2025-06-11 04:35:47,422 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-11 04:35:47,422 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-11 04:35:47,423 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 04:35:47,423 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-11 04:35:47,423 - services.ai_service - WARNING - AI features disabled in AIService - missing Azure OpenAI configuration or client initialization failed.
2025-06-11 04:35:47,423 - handlers.ai_handler - WARNING - AIHandler: AI features disabled as AIService could not be initialized.
2025-06-11 04:35:47,424 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-11 04:35:47,424 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 04:35:47,427 - dotenv.main - WARNING - python-dotenv could not parse statement starting at line 1
2025-06-11 04:35:47,427 - dotenv.main - WARNING - python-dotenv could not parse statement starting at line 2
2025-06-11 04:35:47,427 - dotenv.main - WARNING - python-dotenv could not parse statement starting at line 4
2025-06-11 04:35:47,428 - dotenv.main - WARNING - python-dotenv could not parse statement starting at line 6
2025-06-11 04:35:47,428 - dotenv.main - WARNING - python-dotenv could not parse statement starting at line 7
2025-06-11 04:35:47,428 - dotenv.main - WARNING - python-dotenv could not parse statement starting at line 8
2025-06-11 04:35:47,428 - dotenv.main - WARNING - python-dotenv could not parse statement starting at line 9
2025-06-11 04:35:47,446 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-11 04:35:47,446 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-11 04:36:20,935 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-11 04:36:20,935 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-11 04:36:20,938 - utils.data_manager - INFO - User details saved to data\user_details.json
2025-06-11 04:36:20,939 - handlers.base_handler - INFO - Session 2348055614455 initialized with greeting state for user 'Ziga'.
2025-06-11 04:36:21,529 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 400 Client Error: Bad Request for url: https://graph.facebook.com/v17.0/608867502309431/messages - {"error":{"message":"(#131009) Parameter value is not valid","type":"OAuthException","code":131009,"error_data":{"messaging_product":"whatsapp","details":"Invalid buttons count. Min allowed buttons: 1, Max allowed buttons: 3"},"fbtrace_id":"AmtPbueR8HOC2QOaI9yOoLf"}}
2025-06-11 04:36:21,530 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 04:36:21] "POST /webhook HTTP/1.1" 200 -
2025-06-11 04:38:35,578 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-11 04:38:35,579 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 04:38:35,580 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 04:38:35,580 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 04:38:35,581 - services.payment_service - INFO - PaymentService initialized
2025-06-11 04:38:35,581 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 04:38:35,582 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 04:38:35,583 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 04:38:35,583 - services.payment_service - INFO - PaymentService initialized
2025-06-11 04:38:35,584 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-11 04:38:35,585 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-11 04:38:35,585 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 04:38:35,585 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-11 04:38:35,585 - services.ai_service - WARNING - AI features disabled in AIService - missing Azure OpenAI configuration or client initialization failed.
2025-06-11 04:38:35,586 - handlers.ai_handler - WARNING - AIHandler: AI features disabled as AIService could not be initialized.
2025-06-11 04:38:35,586 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-11 04:38:35,586 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 04:38:35,604 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-11 04:38:35,605 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-11 04:38:43,704 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-11 04:38:43,705 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-11 04:38:43,708 - handlers.base_handler - INFO - Session 2348055614455 initialized with greeting state for user 'Ziga'.
2025-06-11 04:38:44,958 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkEwMzZCQzNEOUY5MEZEMERDQgA="}]}
2025-06-11 04:38:44,959 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 04:38:44] "POST /webhook HTTP/1.1" 200 -
2025-06-11 04:38:45,869 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 04:38:45] "POST /webhook HTTP/1.1" 200 -
2025-06-11 04:38:46,839 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 04:38:46] "POST /webhook HTTP/1.1" 200 -
2025-06-11 04:38:48,983 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-11 04:38:48,986 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-06-11 04:38:48,986 - handlers.message_processor - ERROR - Error in message routing for handler 'greeting_handler', state 'greeting' for session 2348055614455: name 'message' is not defined
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 145, in _route_to_handler
    response = self.greeting_handler.handle_greeting_state(state, message, original_message, session_id)
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\greeting_handler.py", line 26, in handle_greeting_state
    return self._handle_invalid_option(state, session_id)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\greeting_handler.py", line 85, in _handle_invalid_option
    self.logger.warning(f"Session {session_id}: Invalid option '{message}' in greeting state.")
                                                                 ^^^^^^^
NameError: name 'message' is not defined
2025-06-11 04:38:49,888 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkU1QTM2QTEyRTQxQ0ZFRjI2NQA="}]}
2025-06-11 04:38:49,889 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 04:38:49] "POST /webhook HTTP/1.1" 200 -
2025-06-11 04:38:50,770 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 04:38:50] "POST /webhook HTTP/1.1" 200 -
2025-06-11 04:38:51,200 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 04:38:51] "POST /webhook HTTP/1.1" 200 -
2025-06-11 04:38:51,661 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 04:38:51] "POST /webhook HTTP/1.1" 200 -
2025-06-11 04:39:31,898 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-11 04:39:31,898 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 04:39:31,898 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 04:39:31,899 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 04:39:31,899 - services.payment_service - INFO - PaymentService initialized
2025-06-11 04:39:31,900 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 04:39:31,900 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 04:39:31,900 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 04:39:31,901 - services.payment_service - INFO - PaymentService initialized
2025-06-11 04:39:31,901 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-11 04:39:31,902 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-11 04:39:31,902 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 04:39:31,902 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-11 04:39:31,902 - services.ai_service - WARNING - AI features disabled in AIService - missing Azure OpenAI configuration or client initialization failed.
2025-06-11 04:39:31,902 - handlers.ai_handler - WARNING - AIHandler: AI features disabled as AIService could not be initialized.
2025-06-11 04:39:31,903 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-11 04:39:31,903 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 04:39:31,916 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-11 04:39:31,916 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-11 04:39:35,613 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-11 04:39:35,614 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-11 04:39:35,617 - handlers.base_handler - INFO - Session 2348055614455 initialized with greeting state for user 'Ziga'.
2025-06-11 04:39:36,991 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjI2ODY5RUM0M0NBODRBOUI4OAA="}]}
2025-06-11 04:39:36,992 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 04:39:36] "POST /webhook HTTP/1.1" 200 -
2025-06-11 04:39:37,870 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 04:39:37] "POST /webhook HTTP/1.1" 200 -
2025-06-11 04:39:38,454 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 04:39:38] "POST /webhook HTTP/1.1" 200 -
2025-06-11 04:39:39,580 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-11 04:39:39,583 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-06-11 04:39:39,583 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order.
2025-06-11 04:39:39,584 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-06-11 04:39:39,584 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-06-11 04:39:40,468 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjI3QkMxNEMzMTJBODQyQzJGOAA="}]}
2025-06-11 04:39:40,469 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 04:39:40] "POST /webhook HTTP/1.1" 200 -
2025-06-11 04:39:41,544 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 04:39:41] "POST /webhook HTTP/1.1" 200 -
2025-06-11 04:39:41,749 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 04:39:41] "POST /webhook HTTP/1.1" 200 -
2025-06-11 04:39:42,060 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 04:39:42] "POST /webhook HTTP/1.1" 200 -
2025-06-11 04:40:53,502 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-11 04:40:53,502 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 04:40:53,503 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 04:40:53,503 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 04:40:53,504 - services.payment_service - INFO - PaymentService initialized
2025-06-11 04:40:53,504 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 04:40:53,504 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 04:40:53,505 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 04:40:53,505 - services.payment_service - INFO - PaymentService initialized
2025-06-11 04:40:53,505 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-11 04:40:53,506 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-11 04:40:53,506 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 04:40:53,506 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-11 04:40:53,507 - services.ai_service - WARNING - AI features disabled in AIService - missing Azure OpenAI configuration or client initialization failed.
2025-06-11 04:40:53,507 - handlers.ai_handler - WARNING - AIHandler: AI features disabled as AIService could not be initialized.
2025-06-11 04:40:53,507 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-11 04:40:53,507 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 04:40:53,520 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-11 04:40:53,521 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-11 04:42:31,030 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-11 04:42:31,031 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 04:42:31,031 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 04:42:31,032 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 04:42:31,033 - services.payment_service - INFO - PaymentService initialized
2025-06-11 04:42:31,033 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 04:42:31,034 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 04:42:31,034 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 04:42:31,034 - services.payment_service - INFO - PaymentService initialized
2025-06-11 04:42:31,035 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-11 04:42:31,035 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-11 04:42:31,036 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 04:42:31,036 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-11 04:42:31,036 - services.ai_service - WARNING - AI features disabled in AIService - missing Azure OpenAI configuration or client initialization failed.
2025-06-11 04:42:31,036 - handlers.ai_handler - WARNING - AIHandler: AI features disabled as AIService could not be initialized.
2025-06-11 04:42:31,037 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-11 04:42:31,037 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 04:42:31,049 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-11 04:42:31,050 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-11 04:44:23,519 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-11 04:44:23,519 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 04:44:23,519 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 04:44:23,520 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 04:44:23,520 - services.payment_service - INFO - PaymentService initialized
2025-06-11 04:44:23,520 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 04:44:23,521 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 04:44:23,521 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 04:44:23,522 - services.payment_service - INFO - PaymentService initialized
2025-06-11 04:44:23,522 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-11 04:44:23,522 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-11 04:44:23,523 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 04:44:23,523 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-11 04:44:23,949 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-11 04:44:23,950 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-11 04:44:23,950 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-11 04:44:23,950 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 04:44:23,963 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-11 04:44:23,964 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-11 04:44:34,984 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-11 04:44:34,984 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-11 04:44:34,987 - handlers.base_handler - INFO - Session 2348055614455 initialized with greeting state for user 'Ziga'.
2025-06-11 04:44:35,969 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjMxQkEwMEVCOTNEODA1MTU1OAA="}]}
2025-06-11 04:44:35,970 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 04:44:35] "POST /webhook HTTP/1.1" 200 -
2025-06-11 04:44:36,959 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 04:44:36] "POST /webhook HTTP/1.1" 200 -
2025-06-11 04:44:37,609 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 04:44:37] "POST /webhook HTTP/1.1" 200 -
2025-06-11 04:44:38,547 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-11 04:44:38,549 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-06-11 04:44:38,550 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order.
2025-06-11 04:44:38,551 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-06-11 04:44:38,551 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-06-11 04:44:39,437 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjZGRDlGNzk2NjRFMjdGODNGRQA="}]}
2025-06-11 04:44:39,438 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 04:44:39] "POST /webhook HTTP/1.1" 200 -
2025-06-11 04:44:40,412 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 04:44:40] "POST /webhook HTTP/1.1" 200 -
2025-06-11 04:44:40,678 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 04:44:40] "POST /webhook HTTP/1.1" 200 -
2025-06-11 04:44:40,871 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 04:44:40] "POST /webhook HTTP/1.1" 200 -
2025-06-11 04:44:47,042 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': '2 puff puff'}
2025-06-11 04:44:47,045 - handlers.base_handler - INFO - AIHandler: Handling message '2 puff puff' in AI bulk order state for session 2348055614455. Original: '2 puff puff'
2025-06-11 04:44:49,667 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-11 04:44:50,227 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 400 Client Error: Bad Request for url: https://graph.facebook.com/v17.0/608867502309431/messages - {"error":{"message":"(#100) Unexpected key \"title\" on param \"interactive['action']['buttons'][0]\".","type":"OAuthException","code":100,"fbtrace_id":"A2fNCsQ3iz8NYy8Bq2v-5Sy"}}
2025-06-11 04:44:50,228 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 04:44:50] "POST /webhook HTTP/1.1" 200 -
2025-06-11 04:46:37,374 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-11 04:46:37,374 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 04:46:37,375 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 04:46:37,375 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 04:46:37,375 - services.payment_service - INFO - PaymentService initialized
2025-06-11 04:46:37,376 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 04:46:37,376 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 04:46:37,377 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 04:46:37,377 - services.payment_service - INFO - PaymentService initialized
2025-06-11 04:46:37,377 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-11 04:46:37,378 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-11 04:46:37,378 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 04:46:37,378 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-11 04:46:37,726 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-11 04:46:37,726 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-11 04:46:37,727 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-11 04:46:37,727 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 04:46:37,744 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-11 04:46:37,744 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-11 04:46:43,013 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-11 04:46:43,013 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-11 04:46:43,016 - handlers.base_handler - INFO - Session 2348055614455 initialized with greeting state for user 'Ziga'.
2025-06-11 04:46:43,936 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjg1QjM1MThCMDQwNzkwMzg1NgA="}]}
2025-06-11 04:46:43,937 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 04:46:43] "POST /webhook HTTP/1.1" 200 -
2025-06-11 04:46:44,817 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 04:46:44] "POST /webhook HTTP/1.1" 200 -
2025-06-11 04:46:45,438 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 04:46:45] "POST /webhook HTTP/1.1" 200 -
2025-06-11 04:46:46,637 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-11 04:46:46,639 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-06-11 04:46:46,639 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order.
2025-06-11 04:46:46,639 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-06-11 04:46:46,640 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-06-11 04:46:47,547 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkQ0MUI1NUYzNjBCMkZBNEI0NwA="}]}
2025-06-11 04:46:47,548 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 04:46:47] "POST /webhook HTTP/1.1" 200 -
2025-06-11 04:46:48,427 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 04:46:48] "POST /webhook HTTP/1.1" 200 -
2025-06-11 04:46:48,697 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 04:46:48] "POST /webhook HTTP/1.1" 200 -
2025-06-11 04:46:49,007 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 04:46:49] "POST /webhook HTTP/1.1" 200 -
2025-06-11 04:46:53,941 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': '2 puff puff'}
2025-06-11 04:46:53,942 - handlers.base_handler - INFO - AIHandler: Handling message '2 puff puff' in AI bulk order state for session 2348055614455. Original: '2 puff puff'
2025-06-11 04:46:56,307 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-11 04:46:56,777 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 400 Client Error: Bad Request for url: https://graph.facebook.com/v17.0/608867502309431/messages - {"error":{"message":"(#100) Unexpected key \"title\" on param \"interactive['action']['buttons'][0]\".","type":"OAuthException","code":100,"fbtrace_id":"AowpDQ7GXxLwIzSDHIkJoy5"}}
2025-06-11 04:46:56,778 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 04:46:56] "POST /webhook HTTP/1.1" 200 -
2025-06-11 04:47:59,731 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-11 04:47:59,732 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 04:47:59,732 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 04:47:59,733 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 04:47:59,733 - services.payment_service - INFO - PaymentService initialized
2025-06-11 04:47:59,734 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 04:47:59,734 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 04:47:59,735 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 04:47:59,735 - services.payment_service - INFO - PaymentService initialized
2025-06-11 04:47:59,735 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-11 04:47:59,736 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-11 04:47:59,736 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 04:47:59,736 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-11 04:48:00,096 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-11 04:48:00,096 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-11 04:48:00,096 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-11 04:48:00,097 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 04:48:00,110 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-11 04:48:00,110 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-11 04:48:03,113 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-11 04:48:03,113 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-11 04:48:03,116 - handlers.base_handler - INFO - Session 2348055614455 initialized with greeting state for user 'Ziga'.
2025-06-11 04:48:04,060 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjc5QzVEOEFCMkZBNzhBQzMwRAA="}]}
2025-06-11 04:48:04,061 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 04:48:04] "POST /webhook HTTP/1.1" 200 -
2025-06-11 04:48:04,888 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 04:48:04] "POST /webhook HTTP/1.1" 200 -
2025-06-11 04:48:05,658 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 04:48:05] "POST /webhook HTTP/1.1" 200 -
2025-06-11 04:48:06,289 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-11 04:48:06,291 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-06-11 04:48:06,292 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order.
2025-06-11 04:48:06,292 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-06-11 04:48:06,293 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-06-11 04:48:07,226 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkFGNDMxQkQ2QjYzNzYzNDMyRQA="}]}
2025-06-11 04:48:07,227 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 04:48:07] "POST /webhook HTTP/1.1" 200 -
2025-06-11 04:48:08,163 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 04:48:08] "POST /webhook HTTP/1.1" 200 -
2025-06-11 04:48:08,733 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 04:48:08] "POST /webhook HTTP/1.1" 200 -
2025-06-11 04:48:08,798 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 04:48:08] "POST /webhook HTTP/1.1" 200 -
2025-06-11 04:48:14,502 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': '2 puff puff'}
2025-06-11 04:48:14,504 - handlers.base_handler - INFO - AIHandler: Handling message '2 puff puff' in AI bulk order state for session 2348055614455. Original: '2 puff puff'
2025-06-11 04:48:16,809 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-11 04:48:17,736 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjIyNTdCMTM2RjI5ODM1QTk2QwA="}]}
2025-06-11 04:48:17,737 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 04:48:17] "POST /webhook HTTP/1.1" 200 -
2025-06-11 04:48:18,639 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 04:48:18] "POST /webhook HTTP/1.1" 200 -
2025-06-11 04:48:18,928 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 04:48:18] "POST /webhook HTTP/1.1" 200 -
2025-06-11 04:48:19,440 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 04:48:19] "POST /webhook HTTP/1.1" 200 -
2025-06-11 04:48:20,615 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-06-11 04:48:20,618 - handlers.base_handler - INFO - AI order confirmed. Cart: [{'item_id': 'Puff Puff', 'name': 'Puff Puff', 'quantity': 2, 'price': 200, 'total_price': 400, 'variations': {}}]. Redirecting to order handler.
2025-06-11 04:48:20,618 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'order_handler' with message 'process_final_order'.
2025-06-11 04:48:20,618 - handlers.base_handler - ERROR - Error tracking cart activity: 'list' object has no attribute 'values'
2025-06-11 04:48:21,557 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkZCQURFQzNBNzE2OTdGRDIyMwA="}]}
2025-06-11 04:48:21,558 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 04:48:21] "POST /webhook HTTP/1.1" 200 -
2025-06-11 04:48:22,398 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 04:48:22] "POST /webhook HTTP/1.1" 200 -
2025-06-11 04:48:22,956 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 04:48:22] "POST /webhook HTTP/1.1" 200 -
2025-06-11 04:48:23,086 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 04:48:23] "POST /webhook HTTP/1.1" 200 -
2025-06-11 04:52:35,212 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-11 04:52:35,212 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 04:52:35,213 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 04:52:35,214 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 04:52:35,214 - services.payment_service - INFO - PaymentService initialized
2025-06-11 04:52:35,214 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 04:52:35,215 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 04:52:35,215 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 04:52:35,215 - services.payment_service - INFO - PaymentService initialized
2025-06-11 04:52:35,216 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-11 04:52:35,216 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-11 04:52:35,217 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 04:52:35,217 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-11 04:52:35,572 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-11 04:52:35,572 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-11 04:52:35,573 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-11 04:52:35,573 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 04:52:35,587 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-11 04:52:35,587 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-11 04:52:44,086 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-11 04:52:44,087 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-11 04:52:44,090 - handlers.base_handler - INFO - Session 2348055614455 initialized with greeting state for user 'Ziga'.
2025-06-11 04:52:45,038 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjlFRDhGNzFBMTMxQTgxOEE3RAA="}]}
2025-06-11 04:52:45,039 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 04:52:45] "POST /webhook HTTP/1.1" 200 -
2025-06-11 04:52:45,967 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 04:52:45] "POST /webhook HTTP/1.1" 200 -
2025-06-11 04:52:46,526 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 04:52:46] "POST /webhook HTTP/1.1" 200 -
2025-06-11 04:52:47,647 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-11 04:52:47,649 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-06-11 04:52:47,649 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order.
2025-06-11 04:52:47,650 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-06-11 04:52:47,650 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-06-11 04:52:48,565 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQ3MThEMEZDOUQ5OTIwNkY2NgA="}]}
2025-06-11 04:52:48,566 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 04:52:48] "POST /webhook HTTP/1.1" 200 -
2025-06-11 04:52:49,412 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 04:52:49] "POST /webhook HTTP/1.1" 200 -
2025-06-11 04:52:49,728 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 04:52:49] "POST /webhook HTTP/1.1" 200 -
2025-06-11 04:52:50,128 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 04:52:50] "POST /webhook HTTP/1.1" 200 -
2025-06-11 04:52:55,101 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': '2 puff puff'}
2025-06-11 04:52:55,103 - handlers.base_handler - INFO - AIHandler: Handling message '2 puff puff' in AI bulk order state for session 2348055614455. Original: '2 puff puff'
2025-06-11 04:52:57,319 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-11 04:52:58,260 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjFGQzRENUFGMjZENUMwNUNCQQA="}]}
2025-06-11 04:52:58,261 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 04:52:58] "POST /webhook HTTP/1.1" 200 -
2025-06-11 04:52:59,390 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 04:52:59] "POST /webhook HTTP/1.1" 200 -
2025-06-11 04:52:59,816 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 04:52:59] "POST /webhook HTTP/1.1" 200 -
2025-06-11 04:52:59,889 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 04:52:59] "POST /webhook HTTP/1.1" 200 -
2025-06-11 04:53:00,523 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-06-11 04:53:00,525 - handlers.base_handler - INFO - AI order confirmed. Cart: [{'item_id': 'Puff Puff', 'name': 'Puff Puff', 'quantity': 2, 'price': 200, 'total_price': 400, 'variations': {}}]. Redirecting to order handler.
2025-06-11 04:53:00,525 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'order_handler' with message 'process_final_order'.
2025-06-11 04:53:00,526 - handlers.base_handler - ERROR - Error tracking cart activity: 'list' object has no attribute 'values'
2025-06-11 04:53:01,438 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkQyMjYwOTc4OEI0Qzc2RDlFMgA="}]}
2025-06-11 04:53:01,439 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 04:53:01] "POST /webhook HTTP/1.1" 200 -
2025-06-11 04:53:02,169 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 04:53:02] "POST /webhook HTTP/1.1" 200 -
2025-06-11 04:53:02,846 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 04:53:02] "POST /webhook HTTP/1.1" 200 -
2025-06-11 04:53:03,107 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 04:53:03] "POST /webhook HTTP/1.1" 200 -
2025-06-11 04:55:56,448 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-11 04:55:56,449 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 04:55:56,449 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 04:55:56,450 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 04:55:56,450 - services.payment_service - INFO - PaymentService initialized
2025-06-11 04:55:56,450 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 04:55:56,451 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 04:55:56,451 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 04:55:56,451 - services.payment_service - INFO - PaymentService initialized
2025-06-11 04:55:56,452 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-11 04:55:56,452 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-11 04:55:56,452 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 04:55:56,453 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-11 04:55:56,809 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-11 04:55:56,809 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-11 04:55:56,810 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-11 04:55:56,810 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 04:55:56,828 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-11 04:55:56,828 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-11 04:56:03,432 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-11 04:56:03,433 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-11 04:56:03,436 - handlers.base_handler - INFO - Session 2348055614455 initialized with greeting state for user 'Ziga'.
2025-06-11 04:56:04,444 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjlCRkY0MjQyQ0JDMkNDNzFGMAA="}]}
2025-06-11 04:56:04,445 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 04:56:04] "POST /webhook HTTP/1.1" 200 -
2025-06-11 04:56:05,407 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 04:56:05] "POST /webhook HTTP/1.1" 200 -
2025-06-11 04:56:05,630 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 04:56:05] "POST /webhook HTTP/1.1" 200 -
2025-06-11 04:56:05,996 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 04:56:05] "POST /webhook HTTP/1.1" 200 -
2025-06-11 04:56:06,837 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-11 04:56:06,839 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-06-11 04:56:06,839 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order.
2025-06-11 04:56:06,840 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-06-11 04:56:06,840 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-06-11 04:56:07,769 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjVDQUExMEExNjBEQTNDMTA5RAA="}]}
2025-06-11 04:56:07,770 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 04:56:07] "POST /webhook HTTP/1.1" 200 -
2025-06-11 04:56:08,686 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 04:56:08] "POST /webhook HTTP/1.1" 200 -
2025-06-11 04:56:08,936 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 04:56:08] "POST /webhook HTTP/1.1" 200 -
2025-06-11 04:56:09,459 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 04:56:09] "POST /webhook HTTP/1.1" 200 -
2025-06-11 04:56:15,590 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': '2 puff puff'}
2025-06-11 04:56:15,592 - handlers.base_handler - INFO - AIHandler: Handling message '2 puff puff' in AI bulk order state for session 2348055614455. Original: '2 puff puff'
2025-06-11 04:56:17,945 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-11 04:56:18,905 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkZFQTBFM0JCQjE3NUYyODgxNAA="}]}
2025-06-11 04:56:18,905 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 04:56:18] "POST /webhook HTTP/1.1" 200 -
2025-06-11 04:56:19,665 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 04:56:19] "POST /webhook HTTP/1.1" 200 -
2025-06-11 04:56:20,080 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 04:56:20] "POST /webhook HTTP/1.1" 200 -
2025-06-11 04:56:20,640 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 04:56:20] "POST /webhook HTTP/1.1" 200 -
2025-06-11 04:56:21,447 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-06-11 04:56:21,460 - handlers.base_handler - INFO - AI order confirmed. Cart: [{'item_id': 'Puff Puff', 'name': 'Puff Puff', 'quantity': 2, 'price': 200, 'total_price': 400, 'variations': {}}]. Redirecting to order handler.
2025-06-11 04:56:21,461 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'order_handler' with message 'process_final_order'.
2025-06-11 04:56:21,461 - handlers.order_handler - INFO - User confirmed details (or AI initiated) for session 2348055614455.
2025-06-11 04:56:21,461 - handlers.order_handler - INFO - Address set, proceeding to confirm order for session 2348055614455.
2025-06-11 04:56:21,462 - handlers.message_processor - ERROR - Error in message routing for handler 'order_handler', state 'confirm_details' for session 2348055614455: 'list' object has no attribute 'items'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 194, in _route_to_handler
    response = self.order_handler.handle_confirm_details_state(state, message, session_id)
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\order_handler.py", line 264, in handle_confirm_details_state
    return self._show_order_confirmation(state, session_id)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\order_handler.py", line 313, in _show_order_confirmation
    cart_content = format_cart(state.get('cart', {}))
  File "C:\Users\zigam\Documents\Lola\Lola\app\utils\helpers.py", line 25, in format_cart
    for item, details in cart.items():
                         ^^^^^^^^^^
AttributeError: 'list' object has no attribute 'items'
2025-06-11 04:56:21,466 - handlers.base_handler - ERROR - Error tracking cart activity: 'list' object has no attribute 'values'
2025-06-11 04:56:22,438 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjVDMDU4QTUxQkZENjNEQzcwMwA="}]}
2025-06-11 04:56:22,439 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 04:56:22] "POST /webhook HTTP/1.1" 200 -
2025-06-11 04:56:23,516 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 04:56:23] "POST /webhook HTTP/1.1" 200 -
2025-06-11 04:56:23,812 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 04:56:23] "POST /webhook HTTP/1.1" 200 -
2025-06-11 04:56:23,873 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 04:56:23] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:02:15,570 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-11 05:02:15,570 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 05:02:15,570 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 05:02:15,571 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 05:02:15,571 - services.payment_service - INFO - PaymentService initialized
2025-06-11 05:02:15,571 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 05:02:15,572 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 05:02:15,572 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 05:02:15,572 - services.payment_service - INFO - PaymentService initialized
2025-06-11 05:02:15,572 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-11 05:02:15,573 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-11 05:02:15,573 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 05:02:15,573 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-11 05:02:15,989 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-11 05:02:15,990 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-11 05:02:15,990 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-11 05:02:15,990 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 05:02:16,005 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-11 05:02:16,006 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-11 05:02:22,301 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-11 05:02:22,302 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-11 05:02:22,305 - handlers.base_handler - INFO - Session 2348055614455 initialized with greeting state for user 'Ziga'.
2025-06-11 05:02:23,494 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjFCOEM2OTZEMjhBQjVENzlGMgA="}]}
2025-06-11 05:02:23,495 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:02:23] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:02:24,496 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:02:24] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:02:24,764 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:02:24] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:02:25,247 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:02:25] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:02:25,525 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-11 05:02:25,528 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-06-11 05:02:25,528 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order.
2025-06-11 05:02:25,529 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-06-11 05:02:25,529 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-06-11 05:02:26,523 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjk0M0U2OEI0MDZCNjA0QzNFMQA="}]}
2025-06-11 05:02:26,524 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:02:26] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:02:27,579 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:02:27] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:02:27,726 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:02:27] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:02:27,875 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:02:27] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:02:32,525 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Roll'}
2025-06-11 05:02:32,527 - handlers.base_handler - INFO - AIHandler: Handling message 'roll' in AI bulk order state for session 2348055614455. Original: 'Roll'
2025-06-11 05:02:33,337 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': '1 puff puff'}
2025-06-11 05:02:33,339 - handlers.base_handler - INFO - AIHandler: Handling message '1 puff puff' in AI bulk order state for session 2348055614455. Original: '1 puff puff'
2025-06-11 05:02:34,934 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-11 05:02:35,104 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-11 05:02:35,533 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 400 Client Error: Bad Request for url: https://graph.facebook.com/v17.0/608867502309431/messages - {"error":{"message":"(#131009) Parameter value is not valid","type":"OAuthException","code":131009,"error_data":{"messaging_product":"whatsapp","details":"Invalid buttons count. Min allowed buttons: 1, Max allowed buttons: 3"},"fbtrace_id":"AD6HpyI5R0u3WJIpeeMJO5u"}}
2025-06-11 05:02:35,534 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:02:35] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:02:36,063 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjg1RkVGRDc1RkM3NDI0N0RENQA="}]}
2025-06-11 05:02:36,064 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:02:36] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:02:36,833 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:02:36] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:02:37,245 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:02:37] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:02:37,486 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:02:37] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:02:38,629 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-06-11 05:02:38,631 - handlers.base_handler - INFO - AI order confirmed. Cart: [{'item_id': 'Puff Puff', 'name': 'Puff Puff', 'quantity': 1, 'price': 200, 'total_price': 200, 'variations': {}}]. Redirecting to order handler.
2025-06-11 05:02:38,631 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'order_handler' with message 'process_final_order'.
2025-06-11 05:02:38,632 - handlers.base_handler - ERROR - Error tracking cart activity: 'list' object has no attribute 'values'
2025-06-11 05:02:39,603 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkE5NEM2RDRCRURCMzNFNEI4MQA="}]}
2025-06-11 05:02:39,604 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:02:39] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:02:40,497 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:02:40] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:02:40,794 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:02:40] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:02:41,065 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:02:41] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:05:51,464 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-11 05:05:51,464 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 05:05:51,465 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 05:05:51,465 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 05:05:51,465 - services.payment_service - INFO - PaymentService initialized
2025-06-11 05:05:51,466 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 05:05:51,466 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 05:05:51,467 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 05:05:51,467 - services.payment_service - INFO - PaymentService initialized
2025-06-11 05:05:51,467 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-11 05:05:51,468 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-11 05:05:51,468 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 05:05:51,468 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-11 05:05:51,901 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-11 05:05:51,901 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-11 05:05:51,902 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-11 05:05:51,902 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 05:05:51,921 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-11 05:05:51,921 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-11 05:07:05,548 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-11 05:07:05,548 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 05:07:05,549 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 05:07:05,550 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 05:07:05,550 - services.payment_service - INFO - PaymentService initialized
2025-06-11 05:07:05,550 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 05:07:05,551 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 05:07:05,551 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 05:07:05,552 - services.payment_service - INFO - PaymentService initialized
2025-06-11 05:07:05,552 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-11 05:07:05,553 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-11 05:07:05,553 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 05:07:05,554 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-11 05:07:05,902 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-11 05:07:05,902 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-11 05:07:05,902 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-11 05:07:05,903 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 05:07:05,915 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-11 05:07:05,915 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-11 05:07:13,579 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-11 05:07:13,579 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-11 05:07:13,582 - handlers.base_handler - INFO - Session 2348055614455 initialized with greeting state for user 'Ziga'.
2025-06-11 05:07:14,612 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjEzQ0JBRDMxQ0FFQjRFRTREMwA="}]}
2025-06-11 05:07:14,613 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:07:14] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:07:15,799 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:07:15] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:07:15,932 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:07:15] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:07:16,134 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:07:16] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:07:17,173 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-11 05:07:17,175 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-06-11 05:07:17,175 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order.
2025-06-11 05:07:17,176 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-06-11 05:07:17,176 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-06-11 05:07:18,064 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjVBQjg3Q0Q1NDRFQjM2RThGNAA="}]}
2025-06-11 05:07:18,065 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:07:18] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:07:18,983 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:07:18] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:07:19,385 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:07:19] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:07:19,492 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:07:19] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:07:24,170 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': '2 puff puff'}
2025-06-11 05:07:24,173 - handlers.base_handler - INFO - AIHandler: Handling message '2 puff puff' in AI bulk order state for session 2348055614455. Original: '2 puff puff'
2025-06-11 05:07:26,514 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-11 05:07:27,462 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjgyNzIzMDMxMEM4NkEyNUQ1NgA="}]}
2025-06-11 05:07:27,463 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:07:27] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:07:28,284 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:07:28] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:07:28,624 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:07:28] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:07:29,227 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:07:29] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:07:29,704 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-06-11 05:07:29,706 - handlers.base_handler - INFO - AI order confirmed. Cart: [{'item_id': 'Puff Puff', 'name': 'Puff Puff', 'quantity': 2, 'price': 200, 'total_price': 400, 'variations': {}}]. Redirecting to order handler.
2025-06-11 05:07:29,707 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'order_handler' with message 'process_final_order'.
2025-06-11 05:07:29,707 - handlers.base_handler - ERROR - Error tracking cart activity: 'list' object has no attribute 'values'
2025-06-11 05:07:30,682 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjkwNDM3MjA1NEE5NkI5MDhGMwA="}]}
2025-06-11 05:07:30,682 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:07:30] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:07:31,594 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:07:31] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:07:32,033 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:07:32] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:07:32,106 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:07:32] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:07:36,693 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Correct'}
2025-06-11 05:07:36,695 - handlers.base_handler - ERROR - Error tracking cart activity: 'list' object has no attribute 'values'
2025-06-11 05:07:37,665 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkI2ODhDNDlFQURGNUI5RUY3MAA="}]}
2025-06-11 05:07:37,665 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:07:37] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:07:38,465 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:07:38] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:07:38,854 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:07:38] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:07:39,257 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:07:39] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:11:17,191 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-11 05:11:17,191 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 05:11:17,192 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 05:11:17,192 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 05:11:17,192 - services.payment_service - INFO - PaymentService initialized
2025-06-11 05:11:17,193 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 05:11:17,193 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 05:11:17,194 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 05:11:17,194 - services.payment_service - INFO - PaymentService initialized
2025-06-11 05:11:17,194 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-11 05:11:17,194 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-11 05:11:17,195 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-11 05:11:17,195 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 05:11:17,196 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-11 05:11:17,636 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-11 05:11:17,636 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-11 05:11:17,636 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-11 05:11:17,637 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 05:11:17,651 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-11 05:11:17,651 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-11 05:13:46,528 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-11 05:13:46,529 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 05:13:46,529 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 05:13:46,530 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 05:13:46,530 - services.payment_service - INFO - PaymentService initialized
2025-06-11 05:13:46,530 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 05:13:46,531 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 05:13:46,531 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 05:13:46,532 - services.payment_service - INFO - PaymentService initialized
2025-06-11 05:13:46,532 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-11 05:13:46,532 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-11 05:13:46,533 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-11 05:13:46,533 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 05:13:46,533 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-11 05:13:47,030 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-11 05:13:47,030 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-11 05:13:47,031 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-11 05:13:47,031 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 05:13:47,045 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-11 05:13:47,045 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-11 05:13:55,241 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-11 05:13:55,242 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-11 05:13:55,246 - handlers.base_handler - INFO - Session 2348055614455 initialized with greeting state for user 'Ziga'.
2025-06-11 05:13:56,342 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjJFRTY2MTg5QkUxRjg5OEQzMwA="}]}
2025-06-11 05:13:56,343 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:13:56] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:13:57,237 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:13:57] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:13:57,815 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:13:57] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:13:57,969 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:13:57] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:13:58,647 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-11 05:13:58,652 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-06-11 05:13:58,653 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order.
2025-06-11 05:13:58,653 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-06-11 05:13:58,654 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-06-11 05:13:59,699 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjU5QUZGMDgwMjUyNzI5MjY4MQA="}]}
2025-06-11 05:13:59,700 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:13:59] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:14:00,610 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:14:00] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:14:00,875 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:14:00] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:14:01,186 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:14:01] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:14:06,980 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': '2 puff puff'}
2025-06-11 05:14:06,983 - handlers.base_handler - INFO - AIHandler: Handling message '2 puff puff' in AI bulk order state for session 2348055614455. Original: '2 puff puff'
2025-06-11 05:14:09,182 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-11 05:14:10,231 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkZGMTZEMTgxNjAyOTMzQjI3MgA="}]}
2025-06-11 05:14:10,232 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:14:10] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:14:11,122 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:14:11] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:14:11,531 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:14:11] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:14:11,951 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:14:11] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:14:13,007 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-06-11 05:14:13,008 - handlers.base_handler - INFO - AI order confirmed. Cart: [{'item_id': 'Puff Puff', 'name': 'Puff Puff', 'quantity': 2, 'price': 200, 'total_price': 400, 'variations': {}}]. Redirecting to order handler checkout.
2025-06-11 05:14:13,009 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'order_handler' with message 'handle_checkout'.
2025-06-11 05:14:13,013 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦400 (1 items)
2025-06-11 05:14:13,013 - handlers.base_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦400.00
2025-06-11 05:14:13,941 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkI4MjUyRTBGQjVBNzA3QUJGMwA="}]}
2025-06-11 05:14:13,942 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:14:13] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:14:14,802 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:14:14] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:14:15,515 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:14:15] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:14:15,549 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:14:15] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:14:54,928 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Correct'}
2025-06-11 05:14:54,933 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦400 (1 items)
2025-06-11 05:14:54,934 - handlers.base_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦400.00
2025-06-11 05:14:55,883 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjE2ODdEMDgzREI3RDMyMUNDMgA="}]}
2025-06-11 05:14:55,884 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:14:55] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:14:56,810 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:14:56] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:14:57,109 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:14:57] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:14:57,333 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:14:57] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:17:38,928 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-11 05:17:38,929 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 05:17:38,930 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 05:17:38,930 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 05:17:38,931 - services.payment_service - INFO - PaymentService initialized
2025-06-11 05:17:38,931 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 05:17:38,932 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 05:17:38,933 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 05:17:38,933 - services.payment_service - INFO - PaymentService initialized
2025-06-11 05:17:38,934 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-11 05:17:38,934 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-11 05:17:38,936 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-11 05:17:38,936 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 05:17:38,937 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-11 05:17:39,614 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-11 05:17:39,615 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-11 05:17:39,615 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-11 05:17:39,616 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 05:17:39,633 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-11 05:17:39,633 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-11 05:17:45,403 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-11 05:17:45,404 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-11 05:17:45,408 - handlers.base_handler - INFO - Session 2348055614455 initialized with greeting state for user 'Ziga'.
2025-06-11 05:17:46,400 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkU1NjM4OTE0NTNGNzI3NDRGQgA="}]}
2025-06-11 05:17:46,401 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:17:46] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:17:47,433 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:17:47] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:17:47,742 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:17:47] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:17:47,892 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:17:47] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:17:49,472 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-11 05:17:49,475 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-06-11 05:17:49,477 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order.
2025-06-11 05:17:49,477 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-06-11 05:17:49,477 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-06-11 05:17:50,461 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkQ4MUVGRkIxQTNGNjkzQkY1RQA="}]}
2025-06-11 05:17:50,462 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:17:50] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:17:51,392 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:17:51] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:17:51,644 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:17:51] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:17:51,901 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:17:51] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:17:56,679 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': '2 puff puff'}
2025-06-11 05:17:56,682 - handlers.base_handler - INFO - AIHandler: Handling message '2 puff puff' in AI bulk order state for session 2348055614455. Original: '2 puff puff'
2025-06-11 05:17:59,104 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-11 05:18:00,210 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkQ1QzQ0ODZFMUMwODk1QTY4OQA="}]}
2025-06-11 05:18:00,211 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:18:00] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:18:01,074 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:18:01] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:18:01,402 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:18:01] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:18:01,747 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:18:01] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:18:02,393 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-06-11 05:18:02,398 - handlers.base_handler - INFO - AI Bulk Order processed successfully: {
  "session_id": "2348055614455",
  "user_name": "Ziga",
  "phone_number": "2348055614455",
  "address": "Howson Wright",
  "cart": [
    {
      "item_id": "Puff Puff",
      "name": "Puff Puff",
      "quantity": 2,
      "price": 200,
      "total_price": 400,
      "variations": {}
    }
  ],
  "total_price": 400.0,
  "order_time": "2025-06-11T05:18:02.398075",
  "order_type": "ai_bulk_order"
}
2025-06-11 05:18:03,352 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkQ0MjExNDBBRTM4MDZEQkYxNAA="}]}
2025-06-11 05:18:03,353 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:18:03] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:18:04,203 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:18:04] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:18:04,526 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:18:04] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:18:04,974 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:18:04] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:22:04,133 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-11 05:22:04,134 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 05:22:04,134 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 05:22:04,135 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 05:22:04,135 - services.payment_service - INFO - PaymentService initialized
2025-06-11 05:22:04,135 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 05:22:04,136 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 05:22:04,136 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 05:22:04,137 - services.payment_service - INFO - PaymentService initialized
2025-06-11 05:22:04,137 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-11 05:22:04,137 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-11 05:22:04,138 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-11 05:22:04,138 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 05:22:04,138 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-11 05:22:04,524 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-11 05:22:04,525 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-11 05:22:04,525 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-11 05:22:04,525 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 05:22:04,538 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-11 05:22:04,539 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-11 05:22:30,357 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-11 05:22:30,358 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-11 05:22:30,360 - handlers.base_handler - INFO - Session 2348055614455 initialized with greeting state for user 'Ziga'.
2025-06-11 05:22:31,499 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjk4RjY2MzY2NzkxNjAxQkMzQwA="}]}
2025-06-11 05:22:31,500 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:22:31] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:22:32,490 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:22:32] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:22:33,063 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:22:33] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:22:33,795 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-11 05:22:33,798 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-06-11 05:22:33,798 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order.
2025-06-11 05:22:33,799 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-06-11 05:22:33,799 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-06-11 05:22:34,810 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjhDQzkxRDg0NThGQkJBODU1QgA="}]}
2025-06-11 05:22:34,811 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:22:34] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:22:35,735 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:22:35] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:22:36,062 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:22:36] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:22:36,190 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:22:36] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:22:41,807 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': '2 puff puff'}
2025-06-11 05:22:41,809 - handlers.base_handler - INFO - AIHandler: Handling message '2 puff puff' in AI bulk order state for session 2348055614455. Original: '2 puff puff'
2025-06-11 05:22:43,921 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-11 05:22:44,890 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkMxRTRENTY0OTZFM0E0NEQzMAA="}]}
2025-06-11 05:22:44,892 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:22:44] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:22:45,874 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:22:45] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:22:46,090 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:22:46] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:22:46,473 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:22:46] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:22:47,315 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-06-11 05:22:47,317 - handlers.base_handler - INFO - AI order confirmed. Cart: 1 items. Transitioning to OrderHandler.
2025-06-11 05:22:47,320 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦400 (1 items)
2025-06-11 05:22:47,321 - handlers.base_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦400.00
2025-06-11 05:22:48,243 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjEzMjQxMzdBMzNCQzdBQjI1NgA="}]}
2025-06-11 05:22:48,244 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:22:48] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:22:49,041 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:22:49] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:22:49,363 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:22:49] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:22:49,834 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:22:49] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:22:52,185 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'checkout'}
2025-06-11 05:22:52,187 - handlers.order_handler - INFO - User proceeding to checkout for session 2348055614455.
2025-06-11 05:22:52,190 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦400 (1 items)
2025-06-11 05:22:52,190 - handlers.base_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦400.00
2025-06-11 05:22:53,130 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjk4MkVGQTA5RTEwQjdDQzk2QQA="}]}
2025-06-11 05:22:53,130 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:22:53] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:22:53,925 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:22:53] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:22:55,316 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:22:55] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:22:56,081 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'details_correct'}
2025-06-11 05:22:56,083 - handlers.order_handler - INFO - Order processed successfully: {
  "session_id": "2348055614455",
  "user_name": "Ziga",
  "phone_number": "2348055614455",
  "address": "Howson Wright",
  "cart": [
    {
      "item_id": "Puff Puff",
      "name": "Puff Puff",
      "quantity": 2,
      "price": 200,
      "total_price": 400,
      "variations": {}
    }
  ],
  "total_price": 400,
  "order_time": "2025-06-11T05:22:56.083888"
}
2025-06-11 05:22:57,000 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjBDREM0Nzg2RUJEOEFGQ0QxRQA="}]}
2025-06-11 05:22:57,001 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:22:57] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:22:57,753 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:22:57] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:22:58,082 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:22:58] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:22:58,455 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:22:58] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:24:19,244 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-11 05:24:19,244 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 05:24:19,245 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 05:24:19,245 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 05:24:19,246 - services.payment_service - INFO - PaymentService initialized
2025-06-11 05:24:19,246 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 05:24:19,246 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 05:24:19,247 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 05:24:19,247 - services.payment_service - INFO - PaymentService initialized
2025-06-11 05:24:19,247 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-11 05:24:19,248 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-11 05:24:19,248 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-11 05:24:19,248 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 05:24:19,248 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-11 05:24:19,629 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-11 05:24:19,629 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-11 05:24:19,629 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-11 05:24:19,629 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 05:24:19,654 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-11 05:24:19,655 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-11 05:24:32,112 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-11 05:24:32,113 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-11 05:24:32,116 - handlers.base_handler - INFO - Session 2348055614455 initialized with greeting state for user 'Ziga'.
2025-06-11 05:24:33,100 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkIwOEI3NjU5NEE1QjVCMDk5RQA="}]}
2025-06-11 05:24:33,101 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:24:33] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:24:34,003 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:24:34] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:24:34,914 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:24:34] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:24:36,241 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-11 05:24:36,243 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-06-11 05:24:36,244 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order.
2025-06-11 05:24:36,245 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-06-11 05:24:36,245 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-06-11 05:24:37,192 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkY2RTExNDBFMUIyOUY1MDE1MQA="}]}
2025-06-11 05:24:37,193 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:24:37] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:24:38,068 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:24:38] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:24:38,572 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:24:38] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:24:38,950 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:24:38] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:24:45,459 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': '3 puff pudd'}
2025-06-11 05:24:45,461 - handlers.base_handler - INFO - AIHandler: Handling message '3 puff pudd' in AI bulk order state for session 2348055614455. Original: '3 puff pudd'
2025-06-11 05:24:47,799 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-11 05:24:48,791 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkYzMUEwRjY3NkVFNTdFQzAxOQA="}]}
2025-06-11 05:24:48,792 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:24:48] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:24:49,843 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:24:49] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:24:49,984 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:24:49] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:24:50,302 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:24:50] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:24:52,564 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-06-11 05:24:52,567 - handlers.base_handler - INFO - AI order confirmed. Cart: 1 items. Going directly to checkout.
2025-06-11 05:24:52,570 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦600 (1 items)
2025-06-11 05:24:52,570 - handlers.base_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦600.00
2025-06-11 05:24:53,440 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkQ5RjNCMjc5NTdFMjY4MjlFQQA="}]}
2025-06-11 05:24:53,441 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:24:53] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:24:54,242 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:24:54] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:24:55,004 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:24:55] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:24:56,531 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'details_correct'}
2025-06-11 05:24:56,533 - handlers.order_handler - INFO - Order processed successfully: {
  "session_id": "2348055614455",
  "user_name": "Ziga",
  "phone_number": "2348055614455",
  "address": "Howson Wright",
  "cart": [
    {
      "item_id": "Puff Puff",
      "name": "Puff Puff",
      "quantity": 3,
      "price": 200,
      "total_price": 600,
      "variations": {}
    }
  ],
  "total_price": 600,
  "order_time": "2025-06-11T05:24:56.533457"
}
2025-06-11 05:24:57,469 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjlCMjRGREZENzlENzcyQkNFNwA="}]}
2025-06-11 05:24:57,469 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:24:57] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:24:58,512 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:24:58] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:24:58,592 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:24:58] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:24:59,140 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:24:59] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:25:17,690 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-11 05:25:17,693 - handlers.message_processor - WARNING - No specific handler or state match for handler 'main_handler', state 'main_menu', message 'hello' for session 2348055614455. Resetting to greeting.
2025-06-11 05:25:18,689 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkZGOUJFOEU4OEUwMjUyQUJFOAA="}]}
2025-06-11 05:25:18,690 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:25:18] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:25:19,579 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:25:19] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:25:20,630 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:25:20] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:26:00,598 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-11 05:26:00,602 - handlers.base_handler - INFO - GreetingHandler: Handling message 'hello' in greeting state for session 2348055614455.
2025-06-11 05:26:00,603 - handlers.base_handler - WARNING - Session 2348055614455: Invalid option 'hello' in greeting state.
2025-06-11 05:26:01,754 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkJGRjkxMjcwMkI1NTlEMUMzNAA="}]}
2025-06-11 05:26:01,755 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:26:01] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:26:02,634 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:26:02] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:26:03,920 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:26:03] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:28:48,363 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:28:48] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:28:48,370 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:28:48] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:28:50,469 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'lola_chatbot_direct'}
2025-06-11 05:28:50,471 - handlers.base_handler - INFO - GreetingHandler: Handling message 'lola_chatbot_direct' in greeting state for session 2348055614455.
2025-06-11 05:28:50,471 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for Lola Chatbot.
2025-06-11 05:28:50,472 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'start_lola_chat'.
2025-06-11 05:28:50,472 - handlers.base_handler - INFO - AIHandler: Handling message 'start_lola_chat' in Lola chat state for session 2348055614455. Original: 'lola_chatbot_direct'
2025-06-11 05:28:51,512 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjUzNDU3N0YyRUY3RjUwMDBFOAA="}]}
2025-06-11 05:28:51,515 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:28:51] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:28:52,399 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:28:52] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:28:52,760 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:28:52] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:28:53,039 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:28:53] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:29:08,229 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': "Order assistance \nWhat's your menu for today?"}
2025-06-11 05:29:08,230 - handlers.base_handler - INFO - AIHandler: Handling message 'order assistance 
what's your menu for today?' in Lola chat state for session 2348055614455. Original: 'Order assistance 
What's your menu for today?'
2025-06-11 05:29:10,336 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-11 05:29:11,260 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjI1QTBERTJBQjk4REU2RTNDNAA="}]}
2025-06-11 05:29:11,261 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:29:11] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:29:12,060 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:29:12] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:29:12,780 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:29:12] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:30:02,628 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-11 05:30:02,629 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 05:30:02,630 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 05:30:02,630 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 05:30:02,631 - services.payment_service - INFO - PaymentService initialized
2025-06-11 05:30:02,631 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 05:30:02,631 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 05:30:02,632 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 05:30:02,632 - services.payment_service - INFO - PaymentService initialized
2025-06-11 05:30:02,633 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-11 05:30:02,633 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-11 05:30:02,634 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-11 05:30:02,634 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 05:30:02,634 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-11 05:30:02,995 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-11 05:30:02,996 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-11 05:30:02,996 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-11 05:30:02,996 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 05:30:03,009 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-11 05:30:03,009 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-11 05:30:18,457 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-11 05:30:18,457 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-11 05:30:18,460 - handlers.base_handler - INFO - Session 2348055614455 initialized with greeting state for user 'Ziga'.
2025-06-11 05:30:19,398 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkFDN0ZDNzIyRDU4N0RBRkIwOAA="}]}
2025-06-11 05:30:19,399 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:30:19] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:30:20,450 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:30:20] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:30:20,880 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:30:20] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:30:22,248 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-11 05:30:22,250 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-06-11 05:30:22,250 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order.
2025-06-11 05:30:22,251 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-06-11 05:30:22,251 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-06-11 05:30:23,178 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjYwRDM5RDQ4MjQ1OUZCRDVCRgA="}]}
2025-06-11 05:30:23,179 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:30:23] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:30:24,197 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:30:24] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:30:24,645 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:30:24] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:30:24,703 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:30:24] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:30:29,636 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': '2 puff puff'}
2025-06-11 05:30:29,638 - handlers.base_handler - INFO - AIHandler: Handling message '2 puff puff' in AI bulk order state for session 2348055614455. Original: '2 puff puff'
2025-06-11 05:30:32,118 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-11 05:30:33,010 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkVERTNEOUQ5OUMwQTc2OTBDNAA="}]}
2025-06-11 05:30:33,011 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:30:33] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:30:33,988 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:30:33] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:30:34,149 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:30:34] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:30:34,542 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:30:34] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:30:35,598 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-06-11 05:30:35,600 - handlers.base_handler - INFO - AI order confirmed. Cart: 1 items. Going directly to checkout.
2025-06-11 05:30:35,604 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦400 (1 items)
2025-06-11 05:30:35,604 - handlers.base_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦400.00
2025-06-11 05:30:36,528 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjI3OTA4NUI4QkIyRkYyNDdENwA="}]}
2025-06-11 05:30:36,529 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:30:36] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:30:37,279 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:30:37] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:30:37,770 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:30:37] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:30:37,959 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:30:37] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:30:39,009 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'details_correct'}
2025-06-11 05:30:39,011 - handlers.order_handler - INFO - Order details confirmed. Redirecting to payment handler for session 2348055614455.
2025-06-11 05:30:39,012 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'payment_handler' with message 'show_payment_options'.
2025-06-11 05:30:39,012 - handlers.message_processor - WARNING - No specific handler or state match for handler 'payment_handler', state 'payment_options', message 'show_payment_options' for session 2348055614455. Resetting to greeting.
2025-06-11 05:30:39,016 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦400 (1 items)
2025-06-11 05:30:39,017 - handlers.base_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦400.00
2025-06-11 05:30:39,968 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjE3QzNCMTgxQ0EzNDA2Njc3RQA="}]}
2025-06-11 05:30:39,969 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:30:39] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:30:40,937 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:30:40] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:30:41,611 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:30:41] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:32:01,909 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-11 05:32:01,909 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 05:32:01,910 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 05:32:01,911 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 05:32:01,911 - services.payment_service - INFO - PaymentService initialized
2025-06-11 05:32:01,911 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 05:32:01,912 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 05:32:01,912 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 05:32:01,913 - services.payment_service - INFO - PaymentService initialized
2025-06-11 05:32:01,913 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-11 05:32:01,913 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-11 05:32:01,914 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-11 05:32:01,914 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 05:32:01,914 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-11 05:32:02,258 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-11 05:32:02,259 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-11 05:32:02,259 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-11 05:32:02,260 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 05:32:02,273 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-11 05:32:02,273 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-11 05:32:09,428 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-11 05:32:09,428 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-11 05:32:09,431 - handlers.base_handler - INFO - Session 2348055614455 initialized with greeting state for user 'Ziga'.
2025-06-11 05:32:10,408 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjkzRUM4MDNGNkU0MjRBMjc4QgA="}]}
2025-06-11 05:32:10,409 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:32:10] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:32:11,298 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:32:11] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:32:12,121 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:32:12] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:32:13,000 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-11 05:32:13,002 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-06-11 05:32:13,002 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order.
2025-06-11 05:32:13,002 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-06-11 05:32:13,003 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-06-11 05:32:13,679 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-11 05:32:13,682 - handlers.base_handler - INFO - AIHandler: Handling message 'hello' in AI bulk order state for session 2348055614455. Original: 'Hello'
2025-06-11 05:32:13,937 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjBFMDI3QUY5QTlFNDhGN0MyMQA="}]}
2025-06-11 05:32:13,938 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:32:13] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:32:14,743 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:32:14] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:32:15,398 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:32:15] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:32:15,580 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:32:15] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:32:15,698 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-11 05:32:16,596 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjI3RkRFMDFGRkIwRDEwNDQ3MgA="}]}
2025-06-11 05:32:16,596 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:32:16] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:32:17,255 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-11 05:32:17,258 - handlers.base_handler - INFO - AIHandler: Handling message 'hello' in AI bulk order state for session 2348055614455. Original: 'Hello'
2025-06-11 05:32:17,408 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:32:17] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:32:18,053 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:32:18] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:32:18,167 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-11 05:32:18,177 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:32:18] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:32:19,067 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQyMkI2MTlEMEIyNTJDMzZFQgA="}]}
2025-06-11 05:32:19,068 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:32:19] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:32:20,004 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:32:20] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:32:20,310 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:32:20] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:32:20,630 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:32:20] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:32:22,220 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Puff puff'}
2025-06-11 05:32:22,223 - handlers.base_handler - INFO - AIHandler: Handling message 'puff puff' in AI bulk order state for session 2348055614455. Original: 'Puff puff'
2025-06-11 05:32:23,341 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-11 05:32:24,230 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjRDNzJENEVBRTJDQjI4QjhEMAA="}]}
2025-06-11 05:32:24,231 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:32:24] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:32:25,257 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:32:25] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:32:25,416 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:32:25] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:32:25,730 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:32:25] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:32:27,270 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-06-11 05:32:27,273 - handlers.base_handler - INFO - AI order confirmed. Cart: 1 items. Going directly to checkout.
2025-06-11 05:32:27,277 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦200 (1 items)
2025-06-11 05:32:27,278 - handlers.base_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦200.00
2025-06-11 05:32:28,158 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkY2ODc0OEVBQjU4M0JDMDg3MQA="}]}
2025-06-11 05:32:28,159 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:32:28] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:32:28,950 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:32:28] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:32:29,513 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:32:29] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:32:29,532 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:32:29] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:32:31,863 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'details_correct'}
2025-06-11 05:32:31,866 - handlers.order_handler - INFO - User confirmed details are correct for session 2348055614455.
2025-06-11 05:32:31,866 - handlers.order_handler - INFO - Address set, proceeding to confirm order for manual session 2348055614455.
2025-06-11 05:32:31,866 - handlers.message_processor - ERROR - Error in message routing for handler 'order_handler', state 'confirm_details' for session 2348055614455: 'OrderHandler' object has no attribute '_show_order_confirmation'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 194, in _route_to_handler
    response = self.order_handler.handle_confirm_details_state(state, message, session_id)
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\order_handler.py", line 288, in handle_confirm_details_state
    return self._show_order_confirmation(state, session_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'OrderHandler' object has no attribute '_show_order_confirmation'
2025-06-11 05:32:31,873 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦200 (1 items)
2025-06-11 05:32:31,873 - handlers.base_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦200.00
2025-06-11 05:32:33,627 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjUxNDBFOTZGNERCMDU0ODMzRQA="}]}
2025-06-11 05:32:33,628 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:32:33] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:32:34,434 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:32:34] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:32:35,220 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:32:35] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:34:01,344 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-11 05:34:01,345 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 05:34:01,346 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 05:34:01,347 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 05:34:01,348 - services.payment_service - INFO - PaymentService initialized
2025-06-11 05:34:01,348 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 05:34:01,349 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 05:34:01,350 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 05:34:01,351 - services.payment_service - INFO - PaymentService initialized
2025-06-11 05:34:01,351 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-11 05:34:01,352 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-11 05:34:01,353 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-11 05:34:01,354 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 05:34:01,354 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-11 05:34:02,105 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-11 05:34:02,106 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-11 05:34:02,106 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-11 05:34:02,107 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 05:34:02,133 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-11 05:34:02,134 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-11 05:34:09,259 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-11 05:34:09,260 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-11 05:34:09,266 - handlers.base_handler - INFO - Session 2348055614455 initialized with greeting state for user 'Ziga'.
2025-06-11 05:34:10,249 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjJDOTYwNzhEODFDREEyREE1RAA="}]}
2025-06-11 05:34:10,253 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:34:10] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:34:11,169 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:34:11] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:34:11,865 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:34:11] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:34:12,738 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-11 05:34:12,743 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-06-11 05:34:12,743 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order.
2025-06-11 05:34:12,744 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-06-11 05:34:12,745 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-06-11 05:34:13,618 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjczOTFENjIyQ0RBNzcxRjYwMwA="}]}
2025-06-11 05:34:13,619 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:34:13] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:34:14,507 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:34:14] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:34:14,934 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:34:14] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:34:15,010 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:34:15] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:34:21,446 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': '2 puff puff'}
2025-06-11 05:34:21,449 - handlers.base_handler - INFO - AIHandler: Handling message '2 puff puff' in AI bulk order state for session 2348055614455. Original: '2 puff puff'
2025-06-11 05:34:24,180 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-11 05:34:25,128 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjk2QkQxRjdEMEZBRjY1ODEzNgA="}]}
2025-06-11 05:34:25,130 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:34:25] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:34:25,933 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:34:25] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:34:26,482 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:34:26] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:34:26,840 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:34:26] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:34:28,024 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-06-11 05:34:28,031 - handlers.base_handler - INFO - AI order confirmed. Cart: {'Puff Puff': {'item_id': 'Puff Puff', 'quantity': 2, 'price': 200, 'total_price': 400, 'variations': {}}}. Redirecting to order handler.
2025-06-11 05:34:28,032 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'order_handler' with message 'process_final_order'.
2025-06-11 05:34:28,033 - handlers.order_handler - INFO - AI initiated order processing for session 2348055614455.
2025-06-11 05:34:28,034 - handlers.order_handler - INFO - Address set, proceeding to confirm order for AI-initiated session 2348055614455.
2025-06-11 05:34:28,036 - handlers.message_processor - ERROR - Error in message routing for handler 'order_handler', state 'confirm_details' for session 2348055614455: 'OrderHandler' object has no attribute '_show_order_confirmation'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 194, in _route_to_handler
    response = self.order_handler.handle_confirm_details_state(state, message, session_id)
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\order_handler.py", line 263, in handle_confirm_details_state
    return self._show_order_confirmation(state, session_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'OrderHandler' object has no attribute '_show_order_confirmation'
2025-06-11 05:34:28,045 - handlers.base_handler - ERROR - Error tracking cart activity for 2348055614455: 'str' object has no attribute 'get'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\lead_tracking_handler.py", line 68, in track_cart_activity
    total_value = sum(item.get("price", 0.0) * item.get("quantity", 0) for item in cart)
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\lead_tracking_handler.py", line 68, in <genexpr>
    total_value = sum(item.get("price", 0.0) * item.get("quantity", 0) for item in cart)
                      ^^^^^^^^
AttributeError: 'str' object has no attribute 'get'
2025-06-11 05:34:28,917 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjFEREExQkIwMjY1RDYxRDk0QwA="}]}
2025-06-11 05:34:28,919 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:34:28] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:34:29,741 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:34:29] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:34:30,097 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:34:30] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:34:30,462 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:34:30] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:41:23,003 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-11 05:41:23,003 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 05:41:23,005 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 05:41:23,006 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 05:41:23,006 - services.payment_service - INFO - PaymentService initialized
2025-06-11 05:41:23,007 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 05:41:23,008 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 05:41:23,009 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 05:41:23,009 - services.payment_service - INFO - PaymentService initialized
2025-06-11 05:41:23,010 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-11 05:41:23,010 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-11 05:41:23,012 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-11 05:41:23,012 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 05:41:23,013 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-11 05:41:23,595 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-11 05:41:23,595 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-11 05:41:23,596 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-11 05:41:23,597 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 05:41:23,620 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-11 05:41:23,621 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-11 05:41:30,769 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-11 05:41:30,770 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-11 05:41:30,775 - handlers.base_handler - INFO - Session 2348055614455 initialized with greeting state for user 'Ziga'.
2025-06-11 05:41:31,765 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjM0OTk2OTU1NzdBRDYwQzA3OQA="}]}
2025-06-11 05:41:31,767 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:41:31] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:41:32,550 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:41:32] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:41:33,209 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:41:33] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:41:34,541 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-11 05:41:34,544 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-06-11 05:41:34,545 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order.
2025-06-11 05:41:34,546 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-06-11 05:41:34,547 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-06-11 05:41:35,476 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjg3N0FGODY0QkI3OUI4OEZERAA="}]}
2025-06-11 05:41:35,478 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:41:35] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:41:36,276 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:41:36] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:41:36,742 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:41:36] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:41:36,979 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:41:36] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:41:40,784 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Puff puff'}
2025-06-11 05:41:40,791 - handlers.base_handler - INFO - AIHandler: Handling message 'puff puff' in AI bulk order state for session 2348055614455. Original: 'Puff puff'
2025-06-11 05:41:43,494 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-11 05:41:44,417 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjI1MEMxQ0UzODJCMjRCMzU0MAA="}]}
2025-06-11 05:41:44,421 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:41:44] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:41:45,265 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:41:45] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:41:45,749 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:41:45] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:41:45,948 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:41:45] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:41:48,467 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-06-11 05:41:48,471 - handlers.base_handler - INFO - AI order confirmed. Cart: [{'item_id': 'Puff Puff', 'name': 'Puff Puff', 'quantity': 1, 'price': 200, 'total_price': 200, 'variations': {}}]. Redirecting to order handler.
2025-06-11 05:41:48,472 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'order_handler' with message 'process_final_order'.
2025-06-11 05:41:48,472 - handlers.order_handler - INFO - AI initiated order processing for session 2348055614455.
2025-06-11 05:41:48,473 - handlers.order_handler - INFO - Address set, proceeding to confirm order for AI-initiated session 2348055614455.
2025-06-11 05:41:48,474 - handlers.message_processor - ERROR - Error in message routing for handler 'order_handler', state 'confirm_details' for session 2348055614455: 'OrderHandler' object has no attribute '_show_order_confirmation'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 194, in _route_to_handler
    response = self.order_handler.handle_confirm_details_state(state, message, session_id)
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\order_handler.py", line 263, in handle_confirm_details_state
    return self._show_order_confirmation(state, session_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'OrderHandler' object has no attribute '_show_order_confirmation'
2025-06-11 05:41:48,487 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦200 (1 items)
2025-06-11 05:41:48,487 - handlers.base_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦200.00
2025-06-11 05:41:49,477 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkEyMUJENkVCMjQzRkEyQTZCQgA="}]}
2025-06-11 05:41:49,480 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:41:49] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:41:50,248 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:41:50] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:41:50,817 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:41:50] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:41:51,375 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:41:51] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:42:34,845 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Test'}
2025-06-11 05:42:34,852 - handlers.base_handler - INFO - GreetingHandler: Handling message 'test' in greeting state for session 2348055614455.
2025-06-11 05:42:34,852 - handlers.base_handler - WARNING - Session 2348055614455: Invalid option 'test' in greeting state.
2025-06-11 05:42:34,859 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦200 (1 items)
2025-06-11 05:42:34,860 - handlers.base_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦200.00
2025-06-11 05:42:36,020 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkQwNDM2MzJFNjVBMjY1M0Q1OAA="}]}
2025-06-11 05:42:36,022 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:42:36] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:42:36,726 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:42:36] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:42:37,271 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:42:37] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:43:30,809 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-11 05:43:30,809 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 05:43:30,810 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 05:43:30,811 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 05:43:30,811 - services.payment_service - INFO - PaymentService initialized
2025-06-11 05:43:30,812 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 05:43:30,813 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 05:43:30,814 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 05:43:30,814 - services.payment_service - INFO - PaymentService initialized
2025-06-11 05:43:30,815 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-11 05:43:30,815 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-11 05:43:30,817 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-11 05:43:30,817 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 05:43:30,817 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-11 05:43:31,348 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-11 05:43:31,348 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-11 05:43:31,349 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-11 05:43:31,350 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 05:43:31,368 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-11 05:43:31,369 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-11 05:43:40,937 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-11 05:43:40,938 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-11 05:43:40,944 - handlers.base_handler - INFO - Session 2348055614455 initialized with greeting state for user 'Ziga'.
2025-06-11 05:43:41,928 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkJGOUE3RDQyQ0Q1NUEzNEEyNwA="}]}
2025-06-11 05:43:41,932 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:43:41] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:43:42,749 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:43:42] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:43:43,356 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:43:43] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:43:44,736 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-11 05:43:44,743 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-06-11 05:43:44,744 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order.
2025-06-11 05:43:44,745 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-06-11 05:43:44,746 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-06-11 05:43:46,037 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjVEMjM1MzNEQTBDMjQ3QzRBQQA="}]}
2025-06-11 05:43:46,041 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:43:46] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:43:47,229 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:43:47] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:43:47,450 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:43:47] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:43:47,806 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:43:47] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:43:51,876 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Puff puff'}
2025-06-11 05:43:51,880 - handlers.base_handler - INFO - AIHandler: Handling message 'puff puff' in AI bulk order state for session 2348055614455. Original: 'Puff puff'
2025-06-11 05:43:54,679 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-11 05:43:55,688 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjNCQUQ3QkQxRjMzOTg1OTQ3NQA="}]}
2025-06-11 05:43:55,690 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:43:55] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:43:56,552 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:43:56] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:43:56,994 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:43:56] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:43:57,400 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:43:57] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:43:59,542 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-06-11 05:43:59,545 - handlers.base_handler - INFO - AI order confirmed. Cart: [{'item_id': 'Puff Puff', 'name': 'Puff Puff', 'quantity': 1, 'price': 200, 'total_price': 200, 'variations': {}}]. Redirecting to order handler.
2025-06-11 05:43:59,546 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'order_handler' with message 'process_final_order'.
2025-06-11 05:43:59,547 - handlers.order_handler - INFO - AI initiated order processing for session 2348055614455.
2025-06-11 05:43:59,548 - handlers.order_handler - INFO - Address set, proceeding to confirm order for AI-initiated session 2348055614455.
2025-06-11 05:43:59,548 - handlers.message_processor - ERROR - Error in message routing for handler 'order_handler', state 'confirm_details' for session 2348055614455: 'list' object has no attribute 'items'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 194, in _route_to_handler
    response = self.order_handler.handle_confirm_details_state(state, message, session_id)
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\order_handler.py", line 300, in handle_confirm_details_state
    return self._show_order_confirmation(state, session_id)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\order_handler.py", line 42, in _show_order_confirmation
    cart_content = format_cart(state.get('cart', {}))
  File "C:\Users\zigam\Documents\Lola\Lola\app\utils\helpers.py", line 25, in format_cart
    for item, details in cart.items():
                         ^^^^^^^^^^
AttributeError: 'list' object has no attribute 'items'
2025-06-11 05:43:59,560 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦200 (1 items)
2025-06-11 05:43:59,561 - handlers.base_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦200.00
2025-06-11 05:44:00,466 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjk4RUQ0NzM0N0U4OEEwREI3OAA="}]}
2025-06-11 05:44:00,468 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:44:00] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:44:01,480 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:44:01] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:44:01,876 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:44:01] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:44:01,962 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:44:01] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:46:39,762 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-11 05:46:39,763 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 05:46:39,764 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 05:46:39,765 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 05:46:39,765 - services.payment_service - INFO - PaymentService initialized
2025-06-11 05:46:39,766 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 05:46:39,767 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 05:46:39,768 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 05:46:39,769 - services.payment_service - INFO - PaymentService initialized
2025-06-11 05:46:39,769 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-11 05:46:39,770 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-11 05:46:39,771 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-11 05:46:39,771 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 05:46:39,772 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-11 05:46:40,339 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-11 05:46:40,340 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-11 05:46:40,340 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-11 05:46:40,341 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 05:46:40,363 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-11 05:46:40,364 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-11 05:46:46,754 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-11 05:46:46,755 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-11 05:46:46,760 - handlers.base_handler - INFO - Session 2348055614455 initialized with greeting state for user 'Ziga'.
2025-06-11 05:46:47,725 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkJFQTY0MjYzMTkzMjJBODYzNgA="}]}
2025-06-11 05:46:47,727 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:46:47] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:46:48,943 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:46:48] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:46:49,508 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:46:49] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:46:50,678 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-11 05:46:50,690 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-06-11 05:46:50,691 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order.
2025-06-11 05:46:50,692 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-06-11 05:46:50,692 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-06-11 05:46:51,615 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjE4NjY3RUVBNjBFNTA2RTdGQwA="}]}
2025-06-11 05:46:51,616 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:46:51] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:46:52,453 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:46:52] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:46:52,861 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:46:52] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:46:53,348 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:46:53] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:47:01,177 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': '2 Puff puff'}
2025-06-11 05:47:01,179 - handlers.base_handler - INFO - AIHandler: Handling message '2 puff puff' in AI bulk order state for session 2348055614455. Original: '2 Puff puff'
2025-06-11 05:47:03,600 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-11 05:47:04,616 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjZDMzBCMkQxRENGMDNCOTBFNgA="}]}
2025-06-11 05:47:04,619 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:47:04] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:47:05,724 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:47:05] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:47:06,032 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:47:06] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:47:06,098 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:47:06] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:47:07,572 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-06-11 05:47:07,576 - handlers.base_handler - INFO - AI order confirmed. Cart: [{'item_id': 'Puff Puff', 'name': 'Puff Puff', 'quantity': 2, 'price': 200, 'total_price': 400, 'variations': {}}]. Redirecting to order handler.
2025-06-11 05:47:07,577 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'order_handler' with message 'process_final_order'.
2025-06-11 05:47:07,578 - handlers.order_handler - INFO - AI initiated order processing for session 2348055614455.
2025-06-11 05:47:07,579 - handlers.order_handler - WARNING - Cart is empty or not a dictionary during AI-initiated confirm_details state for session 2348055614455. Redirecting to greeting.
2025-06-11 05:47:07,585 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦400 (1 items)
2025-06-11 05:47:07,586 - handlers.base_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦400.00
2025-06-11 05:47:08,516 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjgzOTNBM0QyRjIzQ0ZCMkNFOQA="}]}
2025-06-11 05:47:08,518 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:47:08] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:47:09,478 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:47:09] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:47:10,003 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:47:10] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:47:12,729 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-11 05:47:12,731 - handlers.base_handler - INFO - GreetingHandler: Handling message 'hello' in greeting state for session 2348055614455.
2025-06-11 05:47:12,732 - handlers.base_handler - WARNING - Session 2348055614455: Invalid option 'hello' in greeting state.
2025-06-11 05:47:12,736 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦400 (1 items)
2025-06-11 05:47:12,737 - handlers.base_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦400.00
2025-06-11 05:47:13,656 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkVGMkI3RUJDMkExRTY0MDQwNgA="}]}
2025-06-11 05:47:13,659 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:47:13] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:47:14,386 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:47:14] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:47:14,902 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:47:14] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:47:15,172 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:47:15] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:52:43,372 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-11 05:52:43,373 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 05:52:43,374 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 05:52:43,375 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 05:52:43,375 - services.payment_service - INFO - PaymentService initialized
2025-06-11 05:52:43,375 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 05:52:43,376 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 05:52:43,377 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 05:52:43,378 - services.payment_service - INFO - PaymentService initialized
2025-06-11 05:52:43,378 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-11 05:52:43,379 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-11 05:52:43,380 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-11 05:52:43,381 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 05:52:43,381 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-11 05:52:43,923 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-11 05:52:43,924 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-11 05:52:43,925 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-11 05:52:43,925 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 05:52:43,947 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-11 05:52:43,948 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-11 05:52:47,384 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-11 05:52:47,384 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-11 05:52:47,388 - handlers.base_handler - INFO - Session 2348055614455 initialized with greeting state for user 'Ziga'.
2025-06-11 05:52:48,481 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkNFNEIwQTJDN0VEMzcwRDk3MAA="}]}
2025-06-11 05:52:48,483 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:52:48] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:52:49,212 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:52:49] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:52:50,051 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:52:50] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:52:52,017 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-11 05:52:52,021 - handlers.base_handler - INFO - GreetingHandler: Handling message 'hello' in greeting state for session 2348055614455.
2025-06-11 05:52:52,022 - handlers.base_handler - WARNING - Session 2348055614455: Invalid option 'hello' in greeting state.
2025-06-11 05:52:52,915 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQzOEE0NjgyODNCQkU2NzM1NAA="}]}
2025-06-11 05:52:52,916 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:52:52] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:52:53,815 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:52:53] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:52:54,628 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:52:54] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:52:54,631 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:52:54] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:52:56,027 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-11 05:52:56,031 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-06-11 05:52:56,031 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order.
2025-06-11 05:52:56,032 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-06-11 05:52:56,033 - handlers.message_processor - ERROR - Error in message routing for handler 'ai_handler', state 'ai_bulk_order' for session 2348055614455: AIHandler.handle_ai_bulk_order_state() takes 4 positional arguments but 5 were given
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 154, in _route_to_handler
    response = self.ai_handler.handle_ai_bulk_order_state(state, message, original_message, session_id)
TypeError: AIHandler.handle_ai_bulk_order_state() takes 4 positional arguments but 5 were given
2025-06-11 05:52:57,495 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjUxQzNCNTQ5RjUyQUQ3MzMyMwA="}]}
2025-06-11 05:52:57,497 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:52:57] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:52:58,220 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:52:58] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:52:58,723 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:52:58] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:52:58,874 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:52:58] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:54:31,176 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 05:54:31] "POST /webhook HTTP/1.1" 200 -
2025-06-11 05:57:54,900 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-11 05:57:54,900 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 05:57:54,901 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 05:57:54,901 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 05:57:54,902 - services.payment_service - INFO - PaymentService initialized
2025-06-11 05:57:54,902 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 05:57:54,902 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 05:57:54,903 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 05:57:54,903 - services.payment_service - INFO - PaymentService initialized
2025-06-11 05:57:54,904 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-11 05:57:54,904 - __main__ - ERROR - Unexpected error: name 'LeadTrackingHandler' is not defined
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\Lola\app\run.py", line 151, in main
    from app import app
  File "C:\Users\zigam\Documents\Lola\Lola\app\app.py", line 64, in <module>
    webhook_handler = WebhookHandler(config) # WebhookHandler was modified to initialize its own services
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\webhook_handler.py", line 22, in __init__
    self.message_processor = MessageProcessor(
                             ~~~~~~~~~~~~~~~~^
        config,
        ^^^^^^^
    ...<4 lines>...
        self.location_service
        ^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 29, in __init__
    self.lead_tracking_handler = LeadTrackingHandler(config, session_manager, data_manager, whatsapp_service, self.lead_tracker)
                                 ^^^^^^^^^^^^^^^^^^^
NameError: name 'LeadTrackingHandler' is not defined
2025-06-11 06:05:04,158 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-11 06:05:04,159 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 06:05:04,159 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 06:05:04,160 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 06:05:04,160 - services.payment_service - INFO - PaymentService initialized
2025-06-11 06:05:04,160 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 06:05:04,161 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 06:05:04,161 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 06:05:04,161 - services.payment_service - INFO - PaymentService initialized
2025-06-11 06:05:04,162 - handlers.base_handler - INFO - BaseHandler initialized.
2025-06-11 06:05:04,162 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 06:05:04,162 - __main__ - ERROR - Unexpected error: MessageProcessor.__init__() takes 7 positional arguments but 8 were given
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\Lola\app\run.py", line 151, in main
    from app import app
  File "C:\Users\zigam\Documents\Lola\Lola\app\app.py", line 64, in <module>
    webhook_handler = WebhookHandler(config) # WebhookHandler was modified to initialize its own services
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\webhook_handler.py", line 34, in __init__
    self.message_processor = MessageProcessor(
                             ~~~~~~~~~~~~~~~~^
        config,
        ^^^^^^^
    ...<5 lines>...
        self.payment_handler # Pass payment_handler to message_processor if it needs to call it
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: MessageProcessor.__init__() takes 7 positional arguments but 8 were given
2025-06-11 06:06:26,572 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-11 06:06:26,572 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 06:06:26,573 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 06:06:26,573 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 06:06:26,574 - services.payment_service - INFO - PaymentService initialized
2025-06-11 06:06:26,574 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 06:06:26,575 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 06:06:26,575 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 06:06:26,575 - services.payment_service - INFO - PaymentService initialized
2025-06-11 06:06:26,576 - handlers.base_handler - INFO - BaseHandler initialized.
2025-06-11 06:06:26,576 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 06:06:26,576 - __main__ - ERROR - Unexpected error: MessageProcessor.__init__() takes 7 positional arguments but 8 were given
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\Lola\app\run.py", line 151, in main
    from app import app
  File "C:\Users\zigam\Documents\Lola\Lola\app\app.py", line 64, in <module>
    webhook_handler = WebhookHandler(config) # WebhookHandler was modified to initialize its own services
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\webhook_handler.py", line 35, in __init__
    self.message_processor = MessageProcessor(
                             ~~~~~~~~~~~~~~~~^
        config,
        ^^^^^^^
    ...<5 lines>...
        self.payment_handler # This is the crucial argument being passed
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: MessageProcessor.__init__() takes 7 positional arguments but 8 were given
2025-06-11 06:07:39,499 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-11 06:07:39,500 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 06:07:39,500 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 06:07:39,501 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 06:07:39,501 - services.payment_service - INFO - PaymentService initialized
2025-06-11 06:07:39,501 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 06:07:39,502 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 06:07:39,502 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 06:07:39,502 - services.payment_service - INFO - PaymentService initialized
2025-06-11 06:07:39,502 - handlers.base_handler - INFO - BaseHandler initialized.
2025-06-11 06:07:39,503 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 06:07:39,503 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-11 06:07:39,503 - handlers.base_handler - INFO - BaseHandler initialized.
2025-06-11 06:07:39,503 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-11 06:07:39,504 - handlers.base_handler - INFO - BaseHandler initialized.
2025-06-11 06:07:39,504 - __main__ - ERROR - Unexpected error: EnquiryHandler.__init__() missing 1 required positional argument: 'llm_service'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\Lola\app\run.py", line 151, in main
    from app import app
  File "C:\Users\zigam\Documents\Lola\Lola\app\app.py", line 64, in <module>
    webhook_handler = WebhookHandler(config) # WebhookHandler was modified to initialize its own services
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\webhook_handler.py", line 35, in __init__
    self.message_processor = MessageProcessor(
                             ~~~~~~~~~~~~~~~~^
        config,
        ^^^^^^^
    ...<5 lines>...
        self.payment_handler # This is the crucial argument being passed
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 37, in __init__
    self.enquiry_handler = EnquiryHandler(config, session_manager, data_manager, whatsapp_service)
                           ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: EnquiryHandler.__init__() missing 1 required positional argument: 'llm_service'
2025-06-11 06:09:39,769 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-11 06:09:39,770 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 06:09:39,770 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 06:09:39,771 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 06:09:39,771 - services.payment_service - INFO - PaymentService initialized
2025-06-11 06:09:39,771 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 06:09:39,772 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 06:09:39,772 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 06:09:39,772 - services.payment_service - INFO - PaymentService initialized
2025-06-11 06:09:39,772 - handlers.base_handler - INFO - BaseHandler initialized.
2025-06-11 06:09:39,773 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 06:09:39,773 - __main__ - ERROR - Unexpected error: MessageProcessor.__init__() missing 1 required positional argument: 'llm_service'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\Lola\app\run.py", line 151, in main
    from app import app
  File "C:\Users\zigam\Documents\Lola\Lola\app\app.py", line 64, in <module>
    webhook_handler = WebhookHandler(config) # WebhookHandler was modified to initialize its own services
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\webhook_handler.py", line 35, in __init__
    self.message_processor = MessageProcessor(
                             ~~~~~~~~~~~~~~~~^
        config,
        ^^^^^^^
    ...<5 lines>...
        self.payment_handler # This is the crucial argument being passed
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: MessageProcessor.__init__() missing 1 required positional argument: 'llm_service'
2025-06-11 11:34:04,403 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-11 11:34:04,404 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 11:34:04,405 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 11:34:04,406 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 11:34:04,407 - services.payment_service - INFO - PaymentService initialized
2025-06-11 11:34:04,407 - services.location_service - INFO - LocationService initialized.
2025-06-11 11:34:04,408 - services.location_service - WARNING - Google Maps API key is not configured. Location services may not function.
2025-06-11 11:34:04,408 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 11:34:04,409 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 11:34:04,410 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 11:34:04,410 - services.payment_service - INFO - PaymentService initialized
2025-06-11 11:34:04,411 - services.location_service - INFO - LocationService initialized.
2025-06-11 11:34:04,411 - services.location_service - WARNING - Google Maps API key is not configured. Location services may not function.
2025-06-11 11:34:04,412 - handlers.base_handler - INFO - BaseHandler initialized.
2025-06-11 11:34:04,412 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 11:34:04,413 - __main__ - ERROR - Unexpected error: MessageProcessor.__init__() missing 1 required positional argument: 'llm_service'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\Lola\app\run.py", line 151, in main
    from app import app
  File "C:\Users\zigam\Documents\Lola\Lola\app\app.py", line 64, in <module>
    webhook_handler = WebhookHandler(config) # WebhookHandler was modified to initialize its own services
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\webhook_handler.py", line 35, in __init__
    self.message_processor = MessageProcessor(
                             ~~~~~~~~~~~~~~~~^
        config,
        ^^^^^^^
    ...<5 lines>...
        self.payment_handler # This is the crucial argument being passed
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: MessageProcessor.__init__() missing 1 required positional argument: 'llm_service'
2025-06-11 11:36:31,181 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-11 11:36:31,181 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 11:36:31,182 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 11:36:31,183 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 11:36:31,183 - services.payment_service - INFO - PaymentService initialized
2025-06-11 11:36:31,184 - services.location_service - INFO - LocationService initialized.
2025-06-11 11:36:31,184 - services.location_service - WARNING - Google Maps API key is not configured. Location services may not function.
2025-06-11 11:36:31,185 - services.llm_service - INFO - LLMService initialized with model: gemini-2.0-flash
2025-06-11 11:36:31,185 - __main__ - ERROR - Unexpected error: WebhookHandler.__init__() takes 2 positional arguments but 6 were given
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\Lola\app\run.py", line 151, in main
    from app import app
  File "C:\Users\zigam\Documents\Lola\Lola\app\app.py", line 70, in <module>
    webhook_handler = WebhookHandler(
        config,
    ...<3 lines>...
        llm_service       # NEW: Pass the initialized LLMService to WebhookHandler
    )
TypeError: WebhookHandler.__init__() takes 2 positional arguments but 6 were given
2025-06-11 11:37:49,425 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-11 11:37:49,425 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 11:37:49,426 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 11:37:49,427 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 11:37:49,427 - services.payment_service - INFO - PaymentService initialized
2025-06-11 11:37:49,428 - services.location_service - INFO - LocationService initialized.
2025-06-11 11:37:49,428 - services.location_service - WARNING - Google Maps API key is not configured. Location services may not function.
2025-06-11 11:37:49,428 - services.llm_service - INFO - LLMService initialized with model: gemini-2.0-flash
2025-06-11 11:37:50,210 - __main__ - ERROR - Unexpected error: MessageProcessor.__init__() missing 3 required positional arguments: 'payment_service', 'location_service', and 'payment_handler'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\Lola\app\run.py", line 151, in main
    from app import app
  File "C:\Users\zigam\Documents\Lola\Lola\app\app.py", line 70, in <module>
    webhook_handler = WebhookHandler(
        config,
    ...<3 lines>...
        llm_service       # NEW: Pass the initialized LLMService to WebhookHandler
    )
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\webhook_handler.py", line 39, in __init__
    self.message_processor = MessageProcessor(
                             ~~~~~~~~~~~~~~~~^
        config=self.config,
        ^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
        llm_service=self.llm_service # Pass the LLM service to the message processor
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: MessageProcessor.__init__() missing 3 required positional arguments: 'payment_service', 'location_service', and 'payment_handler'
2025-06-11 11:38:47,530 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-11 11:38:47,530 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 11:38:47,531 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 11:38:47,532 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 11:38:47,532 - services.payment_service - INFO - PaymentService initialized
2025-06-11 11:38:47,533 - services.location_service - INFO - LocationService initialized.
2025-06-11 11:38:47,533 - services.location_service - WARNING - Google Maps API key is not configured. Location services may not function.
2025-06-11 11:38:47,534 - services.llm_service - INFO - LLMService initialized with model: gemini-2.0-flash
2025-06-11 11:38:47,534 - __main__ - ERROR - Unexpected error: WebhookHandler.__init__() missing 3 required positional arguments: 'payment_service', 'location_service', and 'payment_handler'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\Lola\app\run.py", line 151, in main
    from app import app
  File "C:\Users\zigam\Documents\Lola\Lola\app\app.py", line 70, in <module>
    webhook_handler = WebhookHandler(
        config,
    ...<3 lines>...
        llm_service       # NEW: Pass the initialized LLMService to WebhookHandler
    )
TypeError: WebhookHandler.__init__() missing 3 required positional arguments: 'payment_service', 'location_service', and 'payment_handler'
2025-06-11 11:40:18,475 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-11 11:40:18,476 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 11:40:18,477 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 11:40:18,478 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 11:40:18,478 - services.payment_service - INFO - PaymentService initialized
2025-06-11 11:40:18,479 - services.location_service - INFO - LocationService initialized.
2025-06-11 11:40:18,479 - services.location_service - WARNING - Google Maps API key is not configured. Location services may not function.
2025-06-11 11:40:18,480 - services.llm_service - INFO - LLMService initialized with model: gemini-2.0-flash
2025-06-11 11:40:18,480 - __main__ - ERROR - Unexpected error: WebhookHandler.__init__() missing 3 required positional arguments: 'payment_service', 'location_service', and 'payment_handler'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\Lola\app\run.py", line 151, in main
    from app import app
  File "C:\Users\zigam\Documents\Lola\Lola\app\app.py", line 70, in <module>
    webhook_handler = WebhookHandler(
        config,
    ...<3 lines>...
        llm_service       # NEW: Pass the initialized LLMService to WebhookHandler
    )
TypeError: WebhookHandler.__init__() missing 3 required positional arguments: 'payment_service', 'location_service', and 'payment_handler'
2025-06-11 11:40:36,616 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-11 11:40:36,616 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 11:40:36,617 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 11:40:36,618 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 11:40:36,619 - services.payment_service - INFO - PaymentService initialized
2025-06-11 11:40:36,619 - services.location_service - INFO - LocationService initialized.
2025-06-11 11:40:36,620 - services.location_service - WARNING - Google Maps API key is not configured. Location services may not function.
2025-06-11 11:40:36,620 - services.llm_service - INFO - LLMService initialized with model: gemini-2.0-flash
2025-06-11 11:40:36,621 - __main__ - ERROR - Unexpected error: WebhookHandler.__init__() missing 3 required positional arguments: 'payment_service', 'location_service', and 'payment_handler'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\Lola\app\run.py", line 151, in main
    from app import app
  File "C:\Users\zigam\Documents\Lola\Lola\app\app.py", line 70, in <module>
    webhook_handler = WebhookHandler(
        config,
    ...<3 lines>...
        llm_service       # NEW: Pass the initialized LLMService to WebhookHandler
    )
TypeError: WebhookHandler.__init__() missing 3 required positional arguments: 'payment_service', 'location_service', and 'payment_handler'
2025-06-11 11:44:13,723 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-11 11:44:13,724 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 11:44:13,725 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 11:44:13,726 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 11:44:13,726 - services.payment_service - INFO - PaymentService initialized
2025-06-11 11:44:13,727 - services.location_service - INFO - LocationService initialized.
2025-06-11 11:44:13,727 - services.location_service - WARNING - Google Maps API key is not configured. Location services may not function.
2025-06-11 11:44:13,728 - services.llm_service - INFO - LLMService initialized with model: gemini-2.0-flash
2025-06-11 11:44:13,728 - handlers.base_handler - INFO - BaseHandler initialized.
2025-06-11 11:44:13,729 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 11:44:13,747 - app - ERROR - Error initializing WebhookHandler: 'PaymentHandler' object has no attribute 'load_menu'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\Lola\app\app.py", line 86, in <module>
    webhook_handler = WebhookHandler(
        config,
    ...<6 lines>...
        llm_service         # NEW: Pass the initialized LLMService to WebhookHandler
    )
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\webhook_handler.py", line 52, in __init__
    self.message_processor = MessageProcessor(
                             ~~~~~~~~~~~~~~~~^
        config=self.config,
        ^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
        payment_handler=self.payment_handler # Pass payment handler
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 54, in __init__
    self.menu_data = self.data_manager.load_menu()
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'PaymentHandler' object has no attribute 'load_menu'
2025-06-11 11:50:15,067 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-11 11:50:15,068 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 11:50:15,069 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 11:50:15,069 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 11:50:15,070 - services.payment_service - INFO - PaymentService initialized
2025-06-11 11:50:15,070 - services.location_service - INFO - LocationService initialized.
2025-06-11 11:50:15,070 - services.location_service - WARNING - Google Maps API key is not configured. Location services may not function.
2025-06-11 11:50:15,071 - services.llm_service - INFO - LLMService initialized with model: gemini-2.0-flash
2025-06-11 11:50:15,071 - handlers.base_handler - INFO - BaseHandler initialized.
2025-06-11 11:50:15,072 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 11:50:15,073 - app - ERROR - Error initializing WebhookHandler: 'PaymentHandler' object has no attribute 'load_menu'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\Lola\app\app.py", line 86, in <module>
    webhook_handler = WebhookHandler(
        config,
    ...<6 lines>...
        llm_service         # LLM service for AI responses
    )
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\webhook_handler.py", line 53, in __init__
    self.message_processor = MessageProcessor(
                             ~~~~~~~~~~~~~~~~^
        config=self.config,
        ^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
        payment_handler=self.payment_handler # Pass payment handler
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 54, in __init__
    self.menu_data = self.data_manager.load_menu()
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'PaymentHandler' object has no attribute 'load_menu'
2025-06-11 11:51:05,472 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-11 11:51:05,472 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 11:51:05,473 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 11:51:05,474 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 11:51:05,475 - services.payment_service - INFO - PaymentService initialized
2025-06-11 11:51:05,475 - services.location_service - INFO - LocationService initialized.
2025-06-11 11:51:05,476 - services.location_service - WARNING - Google Maps API key is not configured. Location services may not function.
2025-06-11 11:51:05,476 - services.llm_service - INFO - LLMService initialized with model: gemini-2.0-flash
2025-06-11 11:51:05,477 - handlers.base_handler - INFO - BaseHandler initialized.
2025-06-11 11:51:05,477 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 11:51:05,479 - app - ERROR - Error initializing WebhookHandler: 'PaymentHandler' object has no attribute 'load_menu'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\Lola\app\app.py", line 86, in <module>
    webhook_handler = WebhookHandler(
        config,
    ...<6 lines>...
        llm_service         # LLM service for AI responses
    )
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\webhook_handler.py", line 54, in __init__
    self.message_processor = MessageProcessor(
                             ~~~~~~~~~~~~~~~~^
        self.config,              # 1st: config
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
        self.payment_handler      # 8th: payment_handler
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 54, in __init__
    self.menu_data = self.data_manager.load_menu()
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'PaymentHandler' object has no attribute 'load_menu'
2025-06-11 11:53:28,310 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-11 11:53:28,311 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 11:53:28,311 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 11:53:28,312 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 11:53:28,313 - services.payment_service - INFO - PaymentService initialized
2025-06-11 11:53:28,313 - services.location_service - INFO - LocationService initialized.
2025-06-11 11:53:28,313 - services.location_service - WARNING - Google Maps API key is not configured. Location services may not function.
2025-06-11 11:53:28,314 - services.llm_service - INFO - LLMService initialized with model: gemini-2.0-flash
2025-06-11 11:53:28,314 - handlers.base_handler - INFO - BaseHandler initialized.
2025-06-11 11:53:28,315 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 11:53:28,329 - handlers.message_processor - INFO - MessageProcessor initializing with data_manager type: <class 'handlers.payment_handler.PaymentHandler'>
2025-06-11 11:53:28,329 - handlers.message_processor - INFO - data_manager has load_menu method: False
2025-06-11 11:53:28,330 - handlers.message_processor - ERROR - ERROR: data_manager object does not have 'load_menu' method. Type: <class 'handlers.payment_handler.PaymentHandler'>
2025-06-11 11:53:28,330 - handlers.message_processor - WARNING - MessageProcessor initialized with empty menu data due to missing load_menu method.
2025-06-11 11:53:28,331 - handlers.webhook_handler - INFO - WebhookHandler initialized successfully.
2025-06-11 11:53:28,425 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-11 11:53:28,426 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-11 11:54:53,287 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-11 11:54:53,288 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 11:54:53,289 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 11:54:53,290 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 11:54:53,290 - services.payment_service - INFO - PaymentService initialized
2025-06-11 11:54:53,291 - services.location_service - INFO - LocationService initialized.
2025-06-11 11:54:53,291 - services.location_service - WARNING - Google Maps API key is not configured. Location services may not function.
2025-06-11 11:54:53,292 - services.llm_service - INFO - LLMService initialized with model: gemini-2.0-flash
2025-06-11 11:54:53,292 - handlers.base_handler - INFO - BaseHandler initialized.
2025-06-11 11:54:53,293 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 11:54:53,295 - handlers.message_processor - INFO - MessageProcessor initializing with data_manager type: <class 'utils.data_manager.DataManager'>
2025-06-11 11:54:53,295 - handlers.message_processor - INFO - data_manager has load_menu method: False
2025-06-11 11:54:53,296 - handlers.message_processor - ERROR - ERROR: data_manager object does not have 'load_menu' method. Type: <class 'utils.data_manager.DataManager'>
2025-06-11 11:54:53,296 - handlers.message_processor - WARNING - MessageProcessor initialized with empty menu data due to missing load_menu method.
2025-06-11 11:54:53,297 - handlers.webhook_handler - INFO - WebhookHandler initialized successfully.
2025-06-11 11:54:53,327 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-11 11:54:53,327 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-11 11:55:17,048 - handlers.message_processor - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-11 11:55:17,049 - handlers.webhook_handler - ERROR - Error processing webhook data: 'SessionManager' object has no attribute 'get_session'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\webhook_handler.py", line 109, in handle_webhook
    self.message_processor.process_webhook_data(data)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 93, in process_webhook_data
    self._process_message(message_data, phone_number, user_name)
    ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 110, in _process_message
    user_session = self.session_manager.get_session(phone_number)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'SessionManager' object has no attribute 'get_session'
2025-06-11 11:55:17,054 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 11:55:17] "[35m[1mPOST /webhook HTTP/1.1[0m" 500 -
2025-06-11 11:55:17,893 - handlers.message_processor - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-11 11:55:17,894 - handlers.webhook_handler - ERROR - Error processing webhook data: 'SessionManager' object has no attribute 'get_session'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\webhook_handler.py", line 109, in handle_webhook
    self.message_processor.process_webhook_data(data)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 93, in process_webhook_data
    self._process_message(message_data, phone_number, user_name)
    ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 110, in _process_message
    user_session = self.session_manager.get_session(phone_number)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'SessionManager' object has no attribute 'get_session'
2025-06-11 11:55:17,898 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 11:55:17] "[35m[1mPOST /webhook HTTP/1.1[0m" 500 -
2025-06-11 11:55:18,608 - handlers.message_processor - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-11 11:55:18,609 - handlers.webhook_handler - ERROR - Error processing webhook data: 'SessionManager' object has no attribute 'get_session'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\webhook_handler.py", line 109, in handle_webhook
    self.message_processor.process_webhook_data(data)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 93, in process_webhook_data
    self._process_message(message_data, phone_number, user_name)
    ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 110, in _process_message
    user_session = self.session_manager.get_session(phone_number)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'SessionManager' object has no attribute 'get_session'
2025-06-11 11:55:18,614 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 11:55:18] "[35m[1mPOST /webhook HTTP/1.1[0m" 500 -
2025-06-11 11:55:20,868 - handlers.message_processor - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-11 11:55:20,868 - handlers.webhook_handler - ERROR - Error processing webhook data: 'SessionManager' object has no attribute 'get_session'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\webhook_handler.py", line 109, in handle_webhook
    self.message_processor.process_webhook_data(data)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 93, in process_webhook_data
    self._process_message(message_data, phone_number, user_name)
    ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 110, in _process_message
    user_session = self.session_manager.get_session(phone_number)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'SessionManager' object has no attribute 'get_session'
2025-06-11 11:55:20,872 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 11:55:20] "[35m[1mPOST /webhook HTTP/1.1[0m" 500 -
2025-06-11 12:07:59,316 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-11 12:07:59,317 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 12:07:59,318 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 12:07:59,319 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 12:07:59,319 - services.payment_service - INFO - PaymentService initialized
2025-06-11 12:07:59,320 - services.location_service - INFO - LocationService initialized.
2025-06-11 12:07:59,320 - services.location_service - WARNING - Google Maps API key is not configured. Location services may not function.
2025-06-11 12:07:59,321 - services.llm_service - INFO - LLMService initialized with model: gemini-2.0-flash
2025-06-11 12:07:59,321 - handlers.base_handler - INFO - BaseHandler initialized.
2025-06-11 12:07:59,322 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 12:07:59,332 - handlers.message_processor - INFO - MessageProcessor initializing with data_manager type: <class 'utils.data_manager.DataManager'>
2025-06-11 12:07:59,332 - handlers.message_processor - INFO - data_manager has load_menu method: False
2025-06-11 12:07:59,333 - handlers.message_processor - ERROR - ERROR: data_manager object does not have 'load_menu' method. Type: <class 'utils.data_manager.DataManager'>
2025-06-11 12:07:59,333 - handlers.message_processor - WARNING - MessageProcessor initialized with empty menu data due to missing load_menu method.
2025-06-11 12:07:59,334 - handlers.webhook_handler - INFO - WebhookHandler initialized successfully.
2025-06-11 12:07:59,336 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 12:07:59,500 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-11 12:07:59,500 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-11 12:07:59,504 - werkzeug - INFO -  * Restarting with stat
2025-06-11 12:08:00,357 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-11 12:08:00,357 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 12:08:00,358 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 12:08:00,359 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 12:08:00,359 - services.payment_service - INFO - PaymentService initialized
2025-06-11 12:08:00,360 - services.location_service - INFO - LocationService initialized.
2025-06-11 12:08:00,360 - services.location_service - WARNING - Google Maps API key is not configured. Location services may not function.
2025-06-11 12:08:00,361 - services.llm_service - INFO - LLMService initialized with model: gemini-2.0-flash
2025-06-11 12:08:00,361 - handlers.base_handler - INFO - BaseHandler initialized.
2025-06-11 12:08:00,362 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 12:08:00,364 - handlers.message_processor - INFO - MessageProcessor initializing with data_manager type: <class 'utils.data_manager.DataManager'>
2025-06-11 12:08:00,364 - handlers.message_processor - INFO - data_manager has load_menu method: False
2025-06-11 12:08:00,365 - handlers.message_processor - ERROR - ERROR: data_manager object does not have 'load_menu' method. Type: <class 'utils.data_manager.DataManager'>
2025-06-11 12:08:00,365 - handlers.message_processor - WARNING - MessageProcessor initialized with empty menu data due to missing load_menu method.
2025-06-11 12:08:00,366 - handlers.webhook_handler - INFO - WebhookHandler initialized successfully.
2025-06-11 12:08:00,368 - __main__ - INFO - Starting WhatsApp bot server...
2025-06-11 12:08:00,408 - werkzeug - WARNING -  * Debugger is active!
2025-06-11 12:08:00,463 - werkzeug - INFO -  * Debugger PIN: 208-474-684
2025-06-11 12:08:17,275 - handlers.message_processor - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-11 12:08:17,276 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-11 12:08:17,276 - handlers.webhook_handler - ERROR - Error processing webhook data: 'WhatsAppService' object has no attribute 'send_text_message'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\webhook_handler.py", line 109, in handle_webhook
    self.message_processor.process_webhook_data(data)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 93, in process_webhook_data
    self._process_message(message_data, phone_number, user_name)
    ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 154, in _process_message
    self._handle_main_menu_interaction(phone_number, user_session, input_text)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 228, in _handle_main_menu_interaction
    self._send_main_menu(phone_number) # Show main menu again for invalid input
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 242, in _send_main_menu
    self.whatsapp_service.send_text_message(phone_number, menu_text)
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WhatsAppService' object has no attribute 'send_text_message'. Did you mean: 'send_timeout_message'?
2025-06-11 12:08:17,283 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 12:08:17] "[35m[1mPOST /webhook HTTP/1.1[0m" 500 -
2025-06-11 12:08:18,153 - handlers.message_processor - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-11 12:08:18,154 - handlers.webhook_handler - ERROR - Error processing webhook data: 'WhatsAppService' object has no attribute 'send_text_message'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\webhook_handler.py", line 109, in handle_webhook
    self.message_processor.process_webhook_data(data)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 93, in process_webhook_data
    self._process_message(message_data, phone_number, user_name)
    ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 154, in _process_message
    self._handle_main_menu_interaction(phone_number, user_session, input_text)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 228, in _handle_main_menu_interaction
    self._send_main_menu(phone_number) # Show main menu again for invalid input
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 242, in _send_main_menu
    self.whatsapp_service.send_text_message(phone_number, menu_text)
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WhatsAppService' object has no attribute 'send_text_message'. Did you mean: 'send_timeout_message'?
2025-06-11 12:08:18,160 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 12:08:18] "[35m[1mPOST /webhook HTTP/1.1[0m" 500 -
2025-06-11 12:08:19,514 - handlers.message_processor - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-11 12:08:19,514 - handlers.webhook_handler - ERROR - Error processing webhook data: 'WhatsAppService' object has no attribute 'send_text_message'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\webhook_handler.py", line 109, in handle_webhook
    self.message_processor.process_webhook_data(data)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 93, in process_webhook_data
    self._process_message(message_data, phone_number, user_name)
    ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 154, in _process_message
    self._handle_main_menu_interaction(phone_number, user_session, input_text)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 228, in _handle_main_menu_interaction
    self._send_main_menu(phone_number) # Show main menu again for invalid input
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 242, in _send_main_menu
    self.whatsapp_service.send_text_message(phone_number, menu_text)
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WhatsAppService' object has no attribute 'send_text_message'. Did you mean: 'send_timeout_message'?
2025-06-11 12:08:19,520 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 12:08:19] "[35m[1mPOST /webhook HTTP/1.1[0m" 500 -
2025-06-11 12:08:21,574 - handlers.message_processor - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-11 12:08:21,575 - handlers.webhook_handler - ERROR - Error processing webhook data: 'WhatsAppService' object has no attribute 'send_text_message'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\webhook_handler.py", line 109, in handle_webhook
    self.message_processor.process_webhook_data(data)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 93, in process_webhook_data
    self._process_message(message_data, phone_number, user_name)
    ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 154, in _process_message
    self._handle_main_menu_interaction(phone_number, user_session, input_text)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 228, in _handle_main_menu_interaction
    self._send_main_menu(phone_number) # Show main menu again for invalid input
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 242, in _send_main_menu
    self.whatsapp_service.send_text_message(phone_number, menu_text)
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WhatsAppService' object has no attribute 'send_text_message'. Did you mean: 'send_timeout_message'?
2025-06-11 12:08:21,580 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 12:08:21] "[35m[1mPOST /webhook HTTP/1.1[0m" 500 -
2025-06-11 12:08:44,299 - handlers.message_processor - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-11 12:08:44,302 - handlers.webhook_handler - ERROR - Error processing webhook data: 'WhatsAppService' object has no attribute 'send_text_message'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\webhook_handler.py", line 109, in handle_webhook
    self.message_processor.process_webhook_data(data)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 93, in process_webhook_data
    self._process_message(message_data, phone_number, user_name)
    ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 154, in _process_message
    self._handle_main_menu_interaction(phone_number, user_session, input_text)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 228, in _handle_main_menu_interaction
    self._send_main_menu(phone_number) # Show main menu again for invalid input
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 242, in _send_main_menu
    self.whatsapp_service.send_text_message(phone_number, menu_text)
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WhatsAppService' object has no attribute 'send_text_message'. Did you mean: 'send_timeout_message'?
2025-06-11 12:08:44,315 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 12:08:44] "[35m[1mPOST /webhook HTTP/1.1[0m" 500 -
2025-06-11 12:08:45,918 - werkzeug - INFO -  * Detected change in 'C:\\Users\\zigam\\Documents\\Lola\\Lola\\app\\app.py', reloading
2025-06-11 12:08:46,056 - werkzeug - INFO -  * Restarting with stat
2025-06-11 12:08:47,200 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-11 12:08:47,200 - __main__ - INFO - Initializing core services...
2025-06-11 12:08:47,201 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 12:08:47,201 - __main__ - INFO - ✓ SessionManager initialized
2025-06-11 12:08:47,202 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 12:08:47,203 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 12:08:47,203 - __main__ - INFO - ✓ DataManager initialized
2025-06-11 12:08:47,204 - __main__ - INFO - ✓ WhatsAppService initialized
2025-06-11 12:08:47,204 - services.payment_service - INFO - PaymentService initialized
2025-06-11 12:08:47,204 - __main__ - INFO - ✓ PaymentService initialized
2025-06-11 12:08:47,205 - services.location_service - INFO - LocationService initialized.
2025-06-11 12:08:47,205 - services.location_service - WARNING - Google Maps API key is not configured. Location services may not function.
2025-06-11 12:08:47,206 - __main__ - INFO - ✓ LocationService initialized
2025-06-11 12:08:47,206 - services.llm_service - INFO - LLMService initialized with model: gemini-2.0-flash
2025-06-11 12:08:47,207 - __main__ - INFO - ✓ LLMService initialized
2025-06-11 12:08:47,207 - __main__ - INFO - All core services initialized successfully!
2025-06-11 12:08:47,208 - __main__ - INFO - Initializing PaymentHandler...
2025-06-11 12:08:47,209 - handlers.base_handler - INFO - BaseHandler initialized.
2025-06-11 12:08:47,210 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 12:08:47,210 - __main__ - INFO - ✓ PaymentHandler initialized successfully
2025-06-11 12:08:47,211 - __main__ - INFO - Initializing WebhookHandler...
2025-06-11 12:08:47,213 - handlers.message_processor - INFO - MessageProcessor initializing with data_manager type: <class 'utils.data_manager.DataManager'>
2025-06-11 12:08:47,213 - handlers.message_processor - INFO - data_manager has load_menu method: False
2025-06-11 12:08:47,213 - handlers.message_processor - ERROR - ERROR: data_manager object does not have 'load_menu' method. Type: <class 'utils.data_manager.DataManager'>
2025-06-11 12:08:47,214 - handlers.message_processor - WARNING - MessageProcessor initialized with empty menu data due to missing load_menu method.
2025-06-11 12:08:47,214 - handlers.webhook_handler - INFO - WebhookHandler initialized successfully.
2025-06-11 12:08:47,215 - __main__ - INFO - ✓ WebhookHandler initialized successfully
2025-06-11 12:08:47,217 - __main__ - INFO - 🚀 Starting WhatsApp bot server...
2025-06-11 12:08:47,218 - __main__ - INFO - 📱 Webhook URL: https://your-chatbot-server.com/webhook
2025-06-11 12:08:47,218 - __main__ - INFO - 💳 Payment Callback: https://your-chatbot-server.com/payment-callback
2025-06-11 12:08:47,219 - __main__ - INFO - ❤️  Health Check: https://your-chatbot-server.com/health
2025-06-11 12:08:47,219 - __main__ - INFO - 📋 Logs: Check bot.log file for detailed logs
2025-06-11 12:08:47,220 - __main__ - INFO - 🔧 Debug Mode: True
2025-06-11 12:08:47,240 - werkzeug - WARNING -  * Debugger is active!
2025-06-11 12:08:47,244 - werkzeug - INFO -  * Debugger PIN: 208-474-684
2025-06-11 12:08:56,140 - __main__ - INFO - WhatsApp Bot Server running on port 8000
2025-06-11 12:08:56,141 - __main__ - INFO - Webhook URL: https://your-chatbot-server.com/webhook
2025-06-11 12:08:56,141 - __main__ - INFO - Payment Callback: https://your-chatbot-server.com/payment-callback
2025-06-11 12:08:56,142 - __main__ - INFO - Logs: Check bot.log file for detailed logs
2025-06-11 12:09:36,626 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-11 12:09:36,626 - __main__ - INFO - Initializing core services...
2025-06-11 12:09:36,627 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 12:09:36,627 - __main__ - INFO - ✓ SessionManager initialized
2025-06-11 12:09:36,628 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 12:09:36,628 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 12:09:36,629 - __main__ - INFO - ✓ DataManager initialized
2025-06-11 12:09:36,629 - __main__ - INFO - ✓ WhatsAppService initialized
2025-06-11 12:09:36,630 - services.payment_service - INFO - PaymentService initialized
2025-06-11 12:09:36,630 - __main__ - INFO - ✓ PaymentService initialized
2025-06-11 12:09:36,630 - services.location_service - INFO - LocationService initialized.
2025-06-11 12:09:36,631 - services.location_service - WARNING - Google Maps API key is not configured. Location services may not function.
2025-06-11 12:09:36,632 - __main__ - INFO - ✓ LocationService initialized
2025-06-11 12:09:36,632 - services.llm_service - INFO - LLMService initialized with model: gemini-2.0-flash
2025-06-11 12:09:36,633 - __main__ - INFO - ✓ LLMService initialized
2025-06-11 12:09:36,633 - __main__ - INFO - All core services initialized successfully!
2025-06-11 12:09:36,634 - __main__ - INFO - Initializing PaymentHandler...
2025-06-11 12:09:36,634 - handlers.base_handler - INFO - BaseHandler initialized.
2025-06-11 12:09:36,635 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 12:09:36,635 - __main__ - INFO - ✓ PaymentHandler initialized successfully
2025-06-11 12:09:36,636 - __main__ - INFO - Initializing WebhookHandler...
2025-06-11 12:09:36,638 - handlers.message_processor - INFO - MessageProcessor initializing with data_manager type: <class 'utils.data_manager.DataManager'>
2025-06-11 12:09:36,638 - handlers.message_processor - INFO - data_manager has load_menu method: False
2025-06-11 12:09:36,639 - handlers.message_processor - ERROR - ERROR: data_manager object does not have 'load_menu' method. Type: <class 'utils.data_manager.DataManager'>
2025-06-11 12:09:36,639 - handlers.message_processor - WARNING - MessageProcessor initialized with empty menu data due to missing load_menu method.
2025-06-11 12:09:36,640 - handlers.webhook_handler - INFO - WebhookHandler initialized successfully.
2025-06-11 12:09:36,640 - __main__ - INFO - ✓ WebhookHandler initialized successfully
2025-06-11 12:09:36,646 - __main__ - INFO - 🚀 Starting WhatsApp bot server...
2025-06-11 12:09:36,647 - __main__ - INFO - 📱 Webhook URL: https://your-chatbot-server.com/webhook
2025-06-11 12:09:36,647 - __main__ - INFO - 💳 Payment Callback: https://your-chatbot-server.com/payment-callback
2025-06-11 12:09:36,648 - __main__ - INFO - ❤️  Health Check: https://your-chatbot-server.com/health
2025-06-11 12:09:36,649 - __main__ - INFO - 📋 Logs: Check bot.log file for detailed logs
2025-06-11 12:09:36,649 - __main__ - INFO - 🔧 Debug Mode: True
2025-06-11 12:09:36,722 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:8000
 * Running on http://192.168.100.221:8000
2025-06-11 12:09:36,723 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-11 12:09:36,725 - werkzeug - INFO -  * Restarting with stat
2025-06-11 12:09:38,058 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-11 12:09:38,058 - __main__ - INFO - Initializing core services...
2025-06-11 12:09:38,059 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 12:09:38,059 - __main__ - INFO - ✓ SessionManager initialized
2025-06-11 12:09:38,060 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 12:09:38,061 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 12:09:38,062 - __main__ - INFO - ✓ DataManager initialized
2025-06-11 12:09:38,062 - __main__ - INFO - ✓ WhatsAppService initialized
2025-06-11 12:09:38,063 - services.payment_service - INFO - PaymentService initialized
2025-06-11 12:09:38,063 - __main__ - INFO - ✓ PaymentService initialized
2025-06-11 12:09:38,064 - services.location_service - INFO - LocationService initialized.
2025-06-11 12:09:38,065 - services.location_service - WARNING - Google Maps API key is not configured. Location services may not function.
2025-06-11 12:09:38,066 - __main__ - INFO - ✓ LocationService initialized
2025-06-11 12:09:38,067 - services.llm_service - INFO - LLMService initialized with model: gemini-2.0-flash
2025-06-11 12:09:38,068 - __main__ - INFO - ✓ LLMService initialized
2025-06-11 12:09:38,068 - __main__ - INFO - All core services initialized successfully!
2025-06-11 12:09:38,069 - __main__ - INFO - Initializing PaymentHandler...
2025-06-11 12:09:38,069 - handlers.base_handler - INFO - BaseHandler initialized.
2025-06-11 12:09:38,070 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 12:09:38,070 - __main__ - INFO - ✓ PaymentHandler initialized successfully
2025-06-11 12:09:38,071 - __main__ - INFO - Initializing WebhookHandler...
2025-06-11 12:09:38,073 - handlers.message_processor - INFO - MessageProcessor initializing with data_manager type: <class 'utils.data_manager.DataManager'>
2025-06-11 12:09:38,074 - handlers.message_processor - INFO - data_manager has load_menu method: False
2025-06-11 12:09:38,074 - handlers.message_processor - ERROR - ERROR: data_manager object does not have 'load_menu' method. Type: <class 'utils.data_manager.DataManager'>
2025-06-11 12:09:38,075 - handlers.message_processor - WARNING - MessageProcessor initialized with empty menu data due to missing load_menu method.
2025-06-11 12:09:38,077 - handlers.webhook_handler - INFO - WebhookHandler initialized successfully.
2025-06-11 12:09:38,078 - __main__ - INFO - ✓ WebhookHandler initialized successfully
2025-06-11 12:09:38,087 - __main__ - INFO - 🚀 Starting WhatsApp bot server...
2025-06-11 12:09:38,088 - __main__ - INFO - 📱 Webhook URL: https://your-chatbot-server.com/webhook
2025-06-11 12:09:38,089 - __main__ - INFO - 💳 Payment Callback: https://your-chatbot-server.com/payment-callback
2025-06-11 12:09:38,089 - __main__ - INFO - ❤️  Health Check: https://your-chatbot-server.com/health
2025-06-11 12:09:38,090 - __main__ - INFO - 📋 Logs: Check bot.log file for detailed logs
2025-06-11 12:09:38,091 - __main__ - INFO - 🔧 Debug Mode: True
2025-06-11 12:09:38,150 - werkzeug - WARNING -  * Debugger is active!
2025-06-11 12:09:38,161 - werkzeug - INFO -  * Debugger PIN: 208-474-684
2025-06-11 12:10:05,493 - handlers.message_processor - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-11 12:10:05,493 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-11 12:10:05,494 - handlers.webhook_handler - ERROR - Error processing webhook data: 'WhatsAppService' object has no attribute 'send_text_message'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\webhook_handler.py", line 109, in handle_webhook
    self.message_processor.process_webhook_data(data)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 93, in process_webhook_data
    self._process_message(message_data, phone_number, user_name)
    ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 154, in _process_message
    self._handle_main_menu_interaction(phone_number, user_session, input_text)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 228, in _handle_main_menu_interaction
    self._send_main_menu(phone_number) # Show main menu again for invalid input
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 242, in _send_main_menu
    self.whatsapp_service.send_text_message(phone_number, menu_text)
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WhatsAppService' object has no attribute 'send_text_message'. Did you mean: 'send_timeout_message'?
2025-06-11 12:10:05,500 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 12:10:05] "[35m[1mPOST /webhook HTTP/1.1[0m" 500 -
2025-06-11 12:10:06,161 - handlers.message_processor - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-11 12:10:06,162 - handlers.webhook_handler - ERROR - Error processing webhook data: 'WhatsAppService' object has no attribute 'send_text_message'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\webhook_handler.py", line 109, in handle_webhook
    self.message_processor.process_webhook_data(data)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 93, in process_webhook_data
    self._process_message(message_data, phone_number, user_name)
    ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 154, in _process_message
    self._handle_main_menu_interaction(phone_number, user_session, input_text)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 228, in _handle_main_menu_interaction
    self._send_main_menu(phone_number) # Show main menu again for invalid input
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 242, in _send_main_menu
    self.whatsapp_service.send_text_message(phone_number, menu_text)
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WhatsAppService' object has no attribute 'send_text_message'. Did you mean: 'send_timeout_message'?
2025-06-11 12:10:06,166 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 12:10:06] "[35m[1mPOST /webhook HTTP/1.1[0m" 500 -
2025-06-11 12:10:06,905 - handlers.message_processor - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-11 12:10:06,906 - handlers.webhook_handler - ERROR - Error processing webhook data: 'WhatsAppService' object has no attribute 'send_text_message'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\webhook_handler.py", line 109, in handle_webhook
    self.message_processor.process_webhook_data(data)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 93, in process_webhook_data
    self._process_message(message_data, phone_number, user_name)
    ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 154, in _process_message
    self._handle_main_menu_interaction(phone_number, user_session, input_text)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 228, in _handle_main_menu_interaction
    self._send_main_menu(phone_number) # Show main menu again for invalid input
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 242, in _send_main_menu
    self.whatsapp_service.send_text_message(phone_number, menu_text)
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WhatsAppService' object has no attribute 'send_text_message'. Did you mean: 'send_timeout_message'?
2025-06-11 12:10:06,911 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 12:10:06] "[35m[1mPOST /webhook HTTP/1.1[0m" 500 -
2025-06-11 12:10:08,932 - handlers.message_processor - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-11 12:10:08,932 - handlers.webhook_handler - ERROR - Error processing webhook data: 'WhatsAppService' object has no attribute 'send_text_message'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\webhook_handler.py", line 109, in handle_webhook
    self.message_processor.process_webhook_data(data)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 93, in process_webhook_data
    self._process_message(message_data, phone_number, user_name)
    ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 154, in _process_message
    self._handle_main_menu_interaction(phone_number, user_session, input_text)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 228, in _handle_main_menu_interaction
    self._send_main_menu(phone_number) # Show main menu again for invalid input
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 242, in _send_main_menu
    self.whatsapp_service.send_text_message(phone_number, menu_text)
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WhatsAppService' object has no attribute 'send_text_message'. Did you mean: 'send_timeout_message'?
2025-06-11 12:10:08,939 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 12:10:08] "[35m[1mPOST /webhook HTTP/1.1[0m" 500 -
2025-06-11 12:10:34,866 - handlers.message_processor - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-11 12:10:34,867 - handlers.webhook_handler - ERROR - Error processing webhook data: 'WhatsAppService' object has no attribute 'send_text_message'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\webhook_handler.py", line 109, in handle_webhook
    self.message_processor.process_webhook_data(data)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 93, in process_webhook_data
    self._process_message(message_data, phone_number, user_name)
    ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 154, in _process_message
    self._handle_main_menu_interaction(phone_number, user_session, input_text)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 228, in _handle_main_menu_interaction
    self._send_main_menu(phone_number) # Show main menu again for invalid input
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 242, in _send_main_menu
    self.whatsapp_service.send_text_message(phone_number, menu_text)
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WhatsAppService' object has no attribute 'send_text_message'. Did you mean: 'send_timeout_message'?
2025-06-11 12:10:34,871 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 12:10:34] "[35m[1mPOST /webhook HTTP/1.1[0m" 500 -
2025-06-11 12:12:43,704 - werkzeug - INFO -  * Detected change in 'C:\\Users\\zigam\\Documents\\Lola\\Lola\\app\\handlers\\message_processor.py', reloading
2025-06-11 12:12:43,782 - werkzeug - INFO -  * Restarting with stat
2025-06-11 12:12:44,756 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-11 12:12:44,757 - __main__ - INFO - Initializing core services...
2025-06-11 12:12:44,757 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 12:12:44,757 - __main__ - INFO - ✓ SessionManager initialized
2025-06-11 12:12:44,758 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 12:12:44,759 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 12:12:44,759 - __main__ - INFO - ✓ DataManager initialized
2025-06-11 12:12:44,760 - __main__ - INFO - ✓ WhatsAppService initialized
2025-06-11 12:12:44,760 - services.payment_service - INFO - PaymentService initialized
2025-06-11 12:12:44,761 - __main__ - INFO - ✓ PaymentService initialized
2025-06-11 12:12:44,761 - services.location_service - INFO - LocationService initialized.
2025-06-11 12:12:44,761 - services.location_service - WARNING - Google Maps API key is not configured. Location services may not function.
2025-06-11 12:12:44,762 - __main__ - INFO - ✓ LocationService initialized
2025-06-11 12:12:44,763 - services.llm_service - INFO - LLMService initialized with model: gemini-2.0-flash
2025-06-11 12:12:44,763 - __main__ - INFO - ✓ LLMService initialized
2025-06-11 12:12:44,764 - __main__ - INFO - All core services initialized successfully!
2025-06-11 12:12:44,764 - __main__ - INFO - Initializing PaymentHandler...
2025-06-11 12:12:44,765 - handlers.base_handler - INFO - BaseHandler initialized.
2025-06-11 12:12:44,765 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 12:12:44,766 - __main__ - INFO - ✓ PaymentHandler initialized successfully
2025-06-11 12:12:44,766 - __main__ - INFO - Initializing WebhookHandler...
2025-06-11 12:12:45,635 - __main__ - ERROR - ❌ Error initializing WebhookHandler: name 'Optional' is not defined
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\Lola\app\app.py", line 107, in <module>
    webhook_handler = WebhookHandler(
        config,             # 1st parameter: config
    ...<6 lines>...
        payment_handler     # 8th parameter: payment_handler
    )
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\webhook_handler.py", line 52, in __init__
    from handlers.message_processor import MessageProcessor
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 18, in <module>
    class MessageProcessor:
    ...<381 lines>...
                logger.error(f"Error in resource cleanup: {e}", exc_info=True)
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 115, in MessageProcessor
    def _process_message(self, message_data: Dict[str, Any], phone_number: str, user_name: str) -> Optional[Dict[str, Any]]: # Added return type hint
                                                                                                   ^^^^^^^^
NameError: name 'Optional' is not defined
2025-06-11 12:16:40,570 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-11 12:16:40,570 - __main__ - INFO - Initializing core services...
2025-06-11 12:16:40,571 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 12:16:40,571 - __main__ - INFO - ✓ SessionManager initialized
2025-06-11 12:16:40,572 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 12:16:40,572 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 12:16:40,573 - __main__ - INFO - ✓ DataManager initialized
2025-06-11 12:16:40,573 - __main__ - INFO - ✓ WhatsAppService initialized
2025-06-11 12:16:40,574 - services.payment_service - INFO - PaymentService initialized
2025-06-11 12:16:40,574 - __main__ - INFO - ✓ PaymentService initialized
2025-06-11 12:16:40,575 - services.location_service - INFO - LocationService initialized.
2025-06-11 12:16:40,575 - services.location_service - WARNING - Google Maps API key is not configured. Location services may not function.
2025-06-11 12:16:40,576 - __main__ - INFO - ✓ LocationService initialized
2025-06-11 12:16:40,576 - services.llm_service - INFO - LLMService initialized with model: gemini-2.0-flash
2025-06-11 12:16:40,577 - __main__ - INFO - ✓ LLMService initialized
2025-06-11 12:16:40,578 - __main__ - INFO - All core services initialized successfully!
2025-06-11 12:16:40,578 - __main__ - INFO - Initializing PaymentHandler...
2025-06-11 12:16:40,579 - handlers.base_handler - INFO - BaseHandler initialized.
2025-06-11 12:16:40,579 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 12:16:40,580 - __main__ - INFO - ✓ PaymentHandler initialized successfully
2025-06-11 12:16:40,580 - __main__ - INFO - Initializing WebhookHandler...
2025-06-11 12:16:40,635 - __main__ - ERROR - ❌ Error initializing WebhookHandler: unmatched ')' (message_processor.py, line 69)
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\Lola\app\app.py", line 107, in <module>
    webhook_handler = WebhookHandler(
        config,             # 1st parameter: config
    ...<6 lines>...
        payment_handler     # 8th parameter: payment_handler
    )
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\webhook_handler.py", line 52, in __init__
    from handlers.message_processor import MessageProcessor
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 69
    logger.warning("MessageProcessor initialized with empty menu data due to missing load_menu method.")data_manager)}")
                                                                                                                    ^
SyntaxError: unmatched ')'
2025-06-11 12:17:23,123 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-11 12:17:23,123 - app - INFO - Initializing core services...
2025-06-11 12:17:23,124 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 12:17:23,124 - app - INFO - ✓ SessionManager initialized
2025-06-11 12:17:23,125 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 12:17:23,127 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 12:17:23,127 - app - INFO - ✓ DataManager initialized
2025-06-11 12:17:23,127 - app - INFO - ✓ WhatsAppService initialized
2025-06-11 12:17:23,128 - services.payment_service - INFO - PaymentService initialized
2025-06-11 12:17:23,128 - app - INFO - ✓ PaymentService initialized
2025-06-11 12:17:23,129 - services.location_service - INFO - LocationService initialized.
2025-06-11 12:17:23,130 - services.location_service - WARNING - Google Maps API key is not configured. Location services may not function.
2025-06-11 12:17:23,130 - app - INFO - ✓ LocationService initialized
2025-06-11 12:17:23,131 - services.llm_service - INFO - LLMService initialized with model: gemini-2.0-flash
2025-06-11 12:17:23,131 - app - INFO - ✓ LLMService initialized
2025-06-11 12:17:23,132 - app - INFO - All core services initialized successfully!
2025-06-11 12:17:23,132 - app - INFO - Initializing PaymentHandler...
2025-06-11 12:17:23,133 - handlers.base_handler - INFO - BaseHandler initialized.
2025-06-11 12:17:23,133 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 12:17:23,133 - app - INFO - ✓ PaymentHandler initialized successfully
2025-06-11 12:17:23,134 - app - INFO - Initializing WebhookHandler...
2025-06-11 12:17:23,137 - app - ERROR - ❌ Error initializing WebhookHandler: unmatched ')' (message_processor.py, line 69)
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\Lola\app\app.py", line 107, in <module>
    webhook_handler = WebhookHandler(
        config,             # 1st parameter: config
    ...<6 lines>...
        payment_handler     # 8th parameter: payment_handler
    )
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\webhook_handler.py", line 52, in __init__
    from handlers.message_processor import MessageProcessor
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 69
    logger.warning("MessageProcessor initialized with empty menu data due to missing load_menu method.")data_manager)}")
                                                                                                                    ^
SyntaxError: unmatched ')'
2025-06-11 12:17:43,034 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-11 12:17:43,035 - app - INFO - Initializing core services...
2025-06-11 12:17:43,035 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 12:17:43,036 - app - INFO - ✓ SessionManager initialized
2025-06-11 12:17:43,037 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 12:17:43,038 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 12:17:43,038 - app - INFO - ✓ DataManager initialized
2025-06-11 12:17:43,038 - app - INFO - ✓ WhatsAppService initialized
2025-06-11 12:17:43,039 - services.payment_service - INFO - PaymentService initialized
2025-06-11 12:17:43,039 - app - INFO - ✓ PaymentService initialized
2025-06-11 12:17:43,040 - services.location_service - INFO - LocationService initialized.
2025-06-11 12:17:43,040 - services.location_service - WARNING - Google Maps API key is not configured. Location services may not function.
2025-06-11 12:17:43,041 - app - INFO - ✓ LocationService initialized
2025-06-11 12:17:43,041 - services.llm_service - INFO - LLMService initialized with model: gemini-2.0-flash
2025-06-11 12:17:43,042 - app - INFO - ✓ LLMService initialized
2025-06-11 12:17:43,042 - app - INFO - All core services initialized successfully!
2025-06-11 12:17:43,043 - app - INFO - Initializing PaymentHandler...
2025-06-11 12:17:43,043 - handlers.base_handler - INFO - BaseHandler initialized.
2025-06-11 12:17:43,044 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 12:17:43,044 - app - INFO - ✓ PaymentHandler initialized successfully
2025-06-11 12:17:43,045 - app - INFO - Initializing WebhookHandler...
2025-06-11 12:17:43,058 - handlers.message_processor - INFO - MessageProcessor initializing with data_manager type: <class 'utils.data_manager.DataManager'>
2025-06-11 12:17:43,059 - handlers.message_processor - INFO - data_manager has load_menu method: False
2025-06-11 12:17:43,059 - handlers.message_processor - INFO - WhatsAppService available methods: ['create_button_message', 'create_list_message', 'create_text_message', 'send_message', 'send_timeout_message']
2025-06-11 12:17:43,060 - handlers.message_processor - ERROR - ERROR: data_manager object does not have 'load_menu' method. Type: <class 'utils.data_manager.DataManager'>
2025-06-11 12:17:43,060 - handlers.message_processor - WARNING - MessageProcessor initialized with empty menu data due to missing load_menu method.
2025-06-11 12:17:43,061 - handlers.message_processor - INFO - data_manager has load_menu method: False
2025-06-11 12:17:43,061 - handlers.message_processor - ERROR - ERROR: data_manager object does not have 'load_menu' method. Type: <class 'utils.data_manager.DataManager'>
2025-06-11 12:17:43,062 - handlers.message_processor - WARNING - MessageProcessor initialized with empty menu data due to missing load_menu method.
2025-06-11 12:17:43,062 - handlers.webhook_handler - INFO - WebhookHandler initialized successfully.
2025-06-11 12:17:43,063 - app - INFO - ✓ WebhookHandler initialized successfully
2025-06-11 12:17:43,092 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-11 12:17:43,092 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-11 12:17:53,803 - handlers.message_processor - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-11 12:17:53,803 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-11 12:17:55,724 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkRFQTg0ODI2MDVBN0U2REZGOQA="}]}
2025-06-11 12:17:55,777 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 12:17:55] "POST /webhook HTTP/1.1" 200 -
2025-06-11 12:17:56,549 - handlers.message_processor - INFO - Received WhatsApp status update: sent for ID wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkRFQTg0ODI2MDVBN0U2REZGOQA=
2025-06-11 12:17:56,551 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 12:17:56] "POST /webhook HTTP/1.1" 200 -
2025-06-11 12:17:57,135 - handlers.message_processor - INFO - Received WhatsApp status update: read for ID wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkRFQTg0ODI2MDVBN0U2REZGOQA=
2025-06-11 12:17:57,137 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 12:17:57] "POST /webhook HTTP/1.1" 200 -
2025-06-11 12:17:57,401 - handlers.message_processor - INFO - Received WhatsApp status update: delivered for ID wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkRFQTg0ODI2MDVBN0U2REZGOQA=
2025-06-11 12:17:57,402 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 12:17:57] "POST /webhook HTTP/1.1" 200 -
2025-06-11 12:18:10,788 - handlers.message_processor - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Lola'}
2025-06-11 12:18:11,799 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkU0NEE4Qzk3RUQ2Qzk3RjBFQQA="}]}
2025-06-11 12:18:11,801 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 12:18:11] "POST /webhook HTTP/1.1" 200 -
2025-06-11 12:18:12,633 - handlers.message_processor - INFO - Received WhatsApp status update: sent for ID wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkU0NEE4Qzk3RUQ2Qzk3RjBFQQA=
2025-06-11 12:18:12,634 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 12:18:12] "POST /webhook HTTP/1.1" 200 -
2025-06-11 12:18:13,062 - handlers.message_processor - INFO - Received WhatsApp status update: delivered for ID wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkU0NEE4Qzk3RUQ2Qzk3RjBFQQA=
2025-06-11 12:18:13,064 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 12:18:13] "POST /webhook HTTP/1.1" 200 -
2025-06-11 12:18:13,552 - handlers.message_processor - INFO - Received WhatsApp status update: read for ID wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkU0NEE4Qzk3RUQ2Qzk3RjBFQQA=
2025-06-11 12:18:13,554 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 12:18:13] "POST /webhook HTTP/1.1" 200 -
2025-06-11 12:18:17,953 - handlers.message_processor - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Menu'}
2025-06-11 12:18:17,954 - utils.session_manager - INFO - Full session 2348055614455 cleared.
2025-06-11 12:18:20,197 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkZGNUQ3QUEzOUY1RDdGQTM5RAA="}]}
2025-06-11 12:18:20,200 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 12:18:20] "POST /webhook HTTP/1.1" 200 -
2025-06-11 12:18:20,918 - handlers.message_processor - INFO - Received WhatsApp status update: sent for ID wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkZGNUQ3QUEzOUY1RDdGQTM5RAA=
2025-06-11 12:18:20,920 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 12:18:20] "POST /webhook HTTP/1.1" 200 -
2025-06-11 12:18:21,738 - handlers.message_processor - INFO - Received WhatsApp status update: read for ID wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkZGNUQ3QUEzOUY1RDdGQTM5RAA=
2025-06-11 12:18:21,740 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 12:18:21] "POST /webhook HTTP/1.1" 200 -
2025-06-11 12:18:21,866 - handlers.message_processor - INFO - Received WhatsApp status update: delivered for ID wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkZGNUQ3QUEzOUY1RDdGQTM5RAA=
2025-06-11 12:18:21,867 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 12:18:21] "POST /webhook HTTP/1.1" 200 -
2025-06-11 12:18:26,359 - handlers.message_processor - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Bulk order'}
2025-06-11 12:18:26,360 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-11 12:18:27,291 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjlCRkVEMTUzRjkyRjUwRjc4RQA="}]}
2025-06-11 12:18:27,294 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 12:18:27] "POST /webhook HTTP/1.1" 200 -
2025-06-11 12:18:28,161 - handlers.message_processor - INFO - Received WhatsApp status update: sent for ID wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjlCRkVEMTUzRjkyRjUwRjc4RQA=
2025-06-11 12:18:28,162 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 12:18:28] "POST /webhook HTTP/1.1" 200 -
2025-06-11 12:18:28,596 - handlers.message_processor - INFO - Received WhatsApp status update: delivered for ID wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjlCRkVEMTUzRjkyRjUwRjc4RQA=
2025-06-11 12:18:28,632 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 12:18:28] "POST /webhook HTTP/1.1" 200 -
2025-06-11 12:18:29,011 - handlers.message_processor - INFO - Received WhatsApp status update: read for ID wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjlCRkVEMTUzRjkyRjUwRjc4RQA=
2025-06-11 12:18:29,012 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 12:18:29] "POST /webhook HTTP/1.1" 200 -
2025-06-11 12:18:37,411 - handlers.message_processor - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': '4 puff puff'}
2025-06-11 12:18:37,412 - handlers.message_processor - INFO - AI bulk order mode: User '2348055614455' sent: 4 puff puff
2025-06-11 12:18:37,413 - handlers.webhook_handler - ERROR - Error processing webhook data: 'LLMService' object has no attribute 'parse_order_with_llm'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\webhook_handler.py", line 109, in handle_webhook
    self.message_processor.process_webhook_data(data)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 108, in process_webhook_data
    self._process_message(message_data, phone_number, user_name)
    ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 163, in _process_message
    self._handle_ai_bulk_order_message(phone_number, user_session, input_text)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 190, in _handle_ai_bulk_order_message
    parsed_order_data = self.llm_service.parse_order_with_llm(message_text)
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'LLMService' object has no attribute 'parse_order_with_llm'
2025-06-11 12:18:37,418 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 12:18:37] "[35m[1mPOST /webhook HTTP/1.1[0m" 500 -
2025-06-11 12:18:38,017 - handlers.message_processor - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': '4 puff puff'}
2025-06-11 12:18:38,017 - handlers.message_processor - INFO - AI bulk order mode: User '2348055614455' sent: 4 puff puff
2025-06-11 12:18:38,018 - handlers.webhook_handler - ERROR - Error processing webhook data: 'LLMService' object has no attribute 'parse_order_with_llm'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\webhook_handler.py", line 109, in handle_webhook
    self.message_processor.process_webhook_data(data)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 108, in process_webhook_data
    self._process_message(message_data, phone_number, user_name)
    ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 163, in _process_message
    self._handle_ai_bulk_order_message(phone_number, user_session, input_text)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 190, in _handle_ai_bulk_order_message
    parsed_order_data = self.llm_service.parse_order_with_llm(message_text)
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'LLMService' object has no attribute 'parse_order_with_llm'
2025-06-11 12:18:38,022 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 12:18:38] "[35m[1mPOST /webhook HTTP/1.1[0m" 500 -
2025-06-11 12:18:38,635 - handlers.message_processor - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': '4 puff puff'}
2025-06-11 12:18:38,637 - handlers.message_processor - INFO - AI bulk order mode: User '2348055614455' sent: 4 puff puff
2025-06-11 12:18:38,638 - handlers.webhook_handler - ERROR - Error processing webhook data: 'LLMService' object has no attribute 'parse_order_with_llm'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\webhook_handler.py", line 109, in handle_webhook
    self.message_processor.process_webhook_data(data)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 108, in process_webhook_data
    self._process_message(message_data, phone_number, user_name)
    ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 163, in _process_message
    self._handle_ai_bulk_order_message(phone_number, user_session, input_text)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 190, in _handle_ai_bulk_order_message
    parsed_order_data = self.llm_service.parse_order_with_llm(message_text)
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'LLMService' object has no attribute 'parse_order_with_llm'
2025-06-11 12:18:38,642 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 12:18:38] "[35m[1mPOST /webhook HTTP/1.1[0m" 500 -
2025-06-11 12:18:40,784 - handlers.message_processor - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': '4 puff puff'}
2025-06-11 12:18:40,785 - handlers.message_processor - INFO - AI bulk order mode: User '2348055614455' sent: 4 puff puff
2025-06-11 12:18:40,786 - handlers.webhook_handler - ERROR - Error processing webhook data: 'LLMService' object has no attribute 'parse_order_with_llm'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\webhook_handler.py", line 109, in handle_webhook
    self.message_processor.process_webhook_data(data)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 108, in process_webhook_data
    self._process_message(message_data, phone_number, user_name)
    ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 163, in _process_message
    self._handle_ai_bulk_order_message(phone_number, user_session, input_text)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 190, in _handle_ai_bulk_order_message
    parsed_order_data = self.llm_service.parse_order_with_llm(message_text)
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'LLMService' object has no attribute 'parse_order_with_llm'
2025-06-11 12:18:40,790 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 12:18:40] "[35m[1mPOST /webhook HTTP/1.1[0m" 500 -
2025-06-11 12:19:04,017 - handlers.message_processor - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': '4 puff puff'}
2025-06-11 12:19:04,017 - handlers.message_processor - INFO - AI bulk order mode: User '2348055614455' sent: 4 puff puff
2025-06-11 12:19:04,018 - handlers.webhook_handler - ERROR - Error processing webhook data: 'LLMService' object has no attribute 'parse_order_with_llm'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\webhook_handler.py", line 109, in handle_webhook
    self.message_processor.process_webhook_data(data)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 108, in process_webhook_data
    self._process_message(message_data, phone_number, user_name)
    ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 163, in _process_message
    self._handle_ai_bulk_order_message(phone_number, user_session, input_text)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 190, in _handle_ai_bulk_order_message
    parsed_order_data = self.llm_service.parse_order_with_llm(message_text)
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'LLMService' object has no attribute 'parse_order_with_llm'
2025-06-11 12:19:04,023 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 12:19:04] "[35m[1mPOST /webhook HTTP/1.1[0m" 500 -
2025-06-11 12:43:49,234 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-11 12:43:49,235 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 12:43:49,235 - utils.data_manager - ERROR - Error decoding data\user_details.json. Starting with empty user details.
2025-06-11 12:43:49,236 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 12:43:49,237 - services.payment_service - INFO - PaymentService initialized
2025-06-11 12:43:49,237 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 12:43:49,238 - utils.data_manager - ERROR - Error decoding data\user_details.json. Starting with empty user details.
2025-06-11 12:43:49,238 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 12:43:49,239 - services.payment_service - INFO - PaymentService initialized
2025-06-11 12:43:49,239 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-11 12:43:49,240 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-11 12:43:49,241 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 12:43:49,241 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-11 12:43:49,241 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking
2025-06-11 12:43:49,242 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 12:43:49,271 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-11 12:43:49,272 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-11 12:45:17,062 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-11 12:45:17,063 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-11 12:45:17,072 - utils.data_manager - INFO - User details saved to data\user_details.json
2025-06-11 12:45:18,246 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjk5OEY4ODg2M0JDRUU1QzQ4QwA="}]}
2025-06-11 12:45:18,297 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 12:45:18] "POST /webhook HTTP/1.1" 200 -
2025-06-11 12:45:19,119 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 12:45:19] "POST /webhook HTTP/1.1" 200 -
2025-06-11 12:45:19,814 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 12:45:19] "POST /webhook HTTP/1.1" 200 -
2025-06-11 12:45:28,219 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'enquiry'}
2025-06-11 12:45:29,146 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkM1ODhDNUJCOTlCNDk2NjNFMgA="}]}
2025-06-11 12:45:29,148 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 12:45:29] "POST /webhook HTTP/1.1" 200 -
2025-06-11 12:45:30,289 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 12:45:30] "POST /webhook HTTP/1.1" 200 -
2025-06-11 12:45:30,403 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 12:45:30] "POST /webhook HTTP/1.1" 200 -
2025-06-11 12:45:31,053 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 12:45:31] "POST /webhook HTTP/1.1" 200 -
2025-06-11 12:54:52,680 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-11 12:54:52,680 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 12:54:52,681 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 12:54:52,681 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 12:54:52,682 - services.payment_service - INFO - PaymentService initialized
2025-06-11 12:54:52,682 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 12:54:52,682 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 12:54:52,683 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 12:54:52,683 - services.payment_service - INFO - PaymentService initialized
2025-06-11 12:54:52,683 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-11 12:54:52,684 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-11 12:54:52,684 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-11 12:54:52,684 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 12:54:52,685 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-11 12:54:53,060 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-11 12:54:53,060 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-11 12:54:53,061 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-11 12:54:53,061 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 12:54:53,074 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-11 12:54:53,075 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-11 12:55:02,513 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-11 12:55:02,514 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-11 12:55:02,517 - handlers.base_handler - INFO - Session 2348055614455 initialized with greeting state for user 'Ziga'.
2025-06-11 12:55:03,507 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjRCMDZGNUExMUQ0QjJBNDQzQwA="}]}
2025-06-11 12:55:03,508 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 12:55:03] "POST /webhook HTTP/1.1" 200 -
2025-06-11 12:55:04,714 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 12:55:04] "POST /webhook HTTP/1.1" 200 -
2025-06-11 12:55:04,755 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 12:55:04] "POST /webhook HTTP/1.1" 200 -
2025-06-11 12:55:04,975 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 12:55:04] "POST /webhook HTTP/1.1" 200 -
2025-06-11 12:55:05,884 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-11 12:55:05,886 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-06-11 12:55:05,886 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order.
2025-06-11 12:55:05,886 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-06-11 12:55:05,887 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-06-11 12:55:06,803 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjlBQjhFODIyQ0ZBNTM3RDhFMQA="}]}
2025-06-11 12:55:06,804 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 12:55:06] "POST /webhook HTTP/1.1" 200 -
2025-06-11 12:55:07,844 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 12:55:07] "POST /webhook HTTP/1.1" 200 -
2025-06-11 12:55:07,974 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 12:55:07] "POST /webhook HTTP/1.1" 200 -
2025-06-11 12:55:08,485 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 12:55:08] "POST /webhook HTTP/1.1" 200 -
2025-06-11 12:55:27,721 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': '10 puff puff'}
2025-06-11 12:55:27,723 - handlers.base_handler - INFO - AIHandler: Handling message '10 puff puff' in AI bulk order state for session 2348055614455. Original: '10 puff puff'
2025-06-11 12:55:30,315 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-11 12:55:31,304 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkQxNTlEQjg1QURENTlDOTVFNgA="}]}
2025-06-11 12:55:31,305 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 12:55:31] "POST /webhook HTTP/1.1" 200 -
2025-06-11 12:55:32,105 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 12:55:32] "POST /webhook HTTP/1.1" 200 -
2025-06-11 12:55:32,435 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 12:55:32] "POST /webhook HTTP/1.1" 200 -
2025-06-11 12:55:32,758 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 12:55:32] "POST /webhook HTTP/1.1" 200 -
2025-06-11 12:55:33,755 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-06-11 12:55:33,757 - handlers.base_handler - INFO - AI order confirmed. Cart: {'Puff Puff': {'item_id': 'Puff Puff', 'quantity': 10, 'price': 200, 'total_price': 2000, 'variations': {}}}. Redirecting to order handler.
2025-06-11 12:55:33,757 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'order_handler' with message 'process_final_order'.
2025-06-11 12:55:33,758 - handlers.order_handler - INFO - AI initiated order processing for session 2348055614455.
2025-06-11 12:55:33,758 - handlers.order_handler - INFO - Address set, proceeding to confirm order for AI-initiated session 2348055614455.
2025-06-11 12:55:33,758 - handlers.message_processor - ERROR - Error in message routing for handler 'order_handler', state 'confirm_details' for session 2348055614455: 'OrderHandler' object has no attribute '_show_order_confirmation'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 194, in _route_to_handler
    response = self.order_handler.handle_confirm_details_state(state, message, session_id)
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\order_handler.py", line 263, in handle_confirm_details_state
    return self._show_order_confirmation(state, session_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'OrderHandler' object has no attribute '_show_order_confirmation'
2025-06-11 12:55:33,761 - handlers.base_handler - ERROR - Error tracking cart activity for 2348055614455: 'str' object has no attribute 'get'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\lead_tracking_handler.py", line 68, in track_cart_activity
    total_value = sum(item.get("price", 0.0) * item.get("quantity", 0) for item in cart)
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\lead_tracking_handler.py", line 68, in <genexpr>
    total_value = sum(item.get("price", 0.0) * item.get("quantity", 0) for item in cart)
                      ^^^^^^^^
AttributeError: 'str' object has no attribute 'get'
2025-06-11 12:55:34,753 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkIxMTdERkU4QzE4REE0RTYwRgA="}]}
2025-06-11 12:55:34,754 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 12:55:34] "POST /webhook HTTP/1.1" 200 -
2025-06-11 12:55:35,457 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 12:55:35] "POST /webhook HTTP/1.1" 200 -
2025-06-11 12:55:35,954 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 12:55:35] "POST /webhook HTTP/1.1" 200 -
2025-06-11 12:55:36,216 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 12:55:36] "POST /webhook HTTP/1.1" 200 -
2025-06-11 12:58:15,214 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-11 12:58:15,215 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 12:58:15,215 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 12:58:15,216 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 12:58:15,216 - services.payment_service - INFO - PaymentService initialized
2025-06-11 12:58:15,216 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 12:58:15,217 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 12:58:15,217 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 12:58:15,217 - services.payment_service - INFO - PaymentService initialized
2025-06-11 12:58:15,218 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-11 12:58:15,218 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-11 12:58:15,219 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-11 12:58:15,219 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 12:58:15,219 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-11 12:58:15,570 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-11 12:58:15,570 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-11 12:58:15,571 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-11 12:58:15,571 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 12:58:15,585 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-11 12:58:15,585 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-11 12:58:25,003 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-11 12:58:25,003 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-11 12:58:25,006 - handlers.base_handler - INFO - Session 2348055614455 initialized with greeting state for user 'Ziga'.
2025-06-11 12:58:25,973 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjhGOEI5QjYwNENERDMyRTRGQgA="}]}
2025-06-11 12:58:25,974 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 12:58:25] "POST /webhook HTTP/1.1" 200 -
2025-06-11 12:58:26,865 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 12:58:26] "POST /webhook HTTP/1.1" 200 -
2025-06-11 12:58:27,273 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 12:58:27] "POST /webhook HTTP/1.1" 200 -
2025-06-11 12:58:27,434 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 12:58:27] "POST /webhook HTTP/1.1" 200 -
2025-06-11 12:58:28,363 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-11 12:58:28,365 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-06-11 12:58:28,366 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order.
2025-06-11 12:58:28,366 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-06-11 12:58:28,367 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-06-11 12:58:29,253 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkRBMkIzNzQ2MUMyQjYwODM3NQA="}]}
2025-06-11 12:58:29,253 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 12:58:29] "POST /webhook HTTP/1.1" 200 -
2025-06-11 12:58:30,144 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 12:58:30] "POST /webhook HTTP/1.1" 200 -
2025-06-11 12:58:30,455 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 12:58:30] "POST /webhook HTTP/1.1" 200 -
2025-06-11 12:58:30,755 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 12:58:30] "POST /webhook HTTP/1.1" 200 -
2025-06-11 12:59:14,208 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': '20 puff puff, egusi, plantain, coleslaw and moi moi'}
2025-06-11 12:59:14,210 - handlers.base_handler - INFO - AIHandler: Handling message '20 puff puff, egusi, plantain, coleslaw and moi moi' in AI bulk order state for session 2348055614455. Original: '20 puff puff, egusi, plantain, coleslaw and moi moi'
2025-06-11 12:59:18,643 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-11 12:59:19,653 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjMwRUQwNjEwRUU3NEJGNTgwMgA="}]}
2025-06-11 12:59:19,654 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 12:59:19] "POST /webhook HTTP/1.1" 200 -
2025-06-11 12:59:20,433 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 12:59:20] "POST /webhook HTTP/1.1" 200 -
2025-06-11 12:59:20,716 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 12:59:20] "POST /webhook HTTP/1.1" 200 -
2025-06-11 12:59:21,464 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 12:59:21] "POST /webhook HTTP/1.1" 200 -
2025-06-11 12:59:31,268 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-06-11 12:59:31,270 - handlers.base_handler - INFO - AI order confirmed. Cart: {'Puff Puff': {'item_id': 'Puff Puff', 'quantity': 20, 'price': 200, 'total_price': 4000, 'variations': {}}, 'Egusi Soup': {'item_id': 'Egusi Soup', 'quantity': 1, 'price': 1200, 'total_price': 1200, 'variations': {}}, 'Fried Plantain': {'item_id': 'Fried Plantain', 'quantity': 1, 'price': 500, 'total_price': 500, 'variations': {}}, 'Coleslaw': {'item_id': 'Coleslaw', 'quantity': 1, 'price': 400, 'total_price': 400, 'variations': {}}, 'Moi Moi': {'item_id': 'Moi Moi', 'quantity': 1, 'price': 500, 'total_price': 500, 'variations': {}}}. Redirecting to order handler.
2025-06-11 12:59:31,270 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'order_handler' with message 'process_final_order'.
2025-06-11 12:59:31,271 - handlers.order_handler - INFO - AI initiated order processing for session 2348055614455.
2025-06-11 12:59:31,271 - handlers.order_handler - INFO - Address set, proceeding to confirm order for AI-initiated session 2348055614455.
2025-06-11 12:59:31,272 - handlers.message_processor - ERROR - Error in message routing for handler 'order_handler', state 'confirm_details' for session 2348055614455: 'OrderHandler' object has no attribute '_show_order_confirmation'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\message_processor.py", line 194, in _route_to_handler
    response = self.order_handler.handle_confirm_details_state(state, message, session_id)
  File "C:\Users\zigam\Documents\Lola\Lola\app\handlers\order_handler.py", line 263, in handle_confirm_details_state
    return self._show_order_confirmation(state, session_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'OrderHandler' object has no attribute '_show_order_confirmation'
2025-06-11 12:59:31,278 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦6,600 (5 items)
2025-06-11 12:59:31,279 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦6,600.00
2025-06-11 12:59:32,173 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkYxRDE1NjI0NTUxNkU2RTUyMQA="}]}
2025-06-11 12:59:32,174 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 12:59:32] "POST /webhook HTTP/1.1" 200 -
2025-06-11 12:59:33,064 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 12:59:33] "POST /webhook HTTP/1.1" 200 -
2025-06-11 12:59:33,446 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 12:59:33] "POST /webhook HTTP/1.1" 200 -
2025-06-11 12:59:33,596 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 12:59:33] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:04:51,408 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-11 13:04:51,408 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 13:04:51,409 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 13:04:51,409 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 13:04:51,410 - services.payment_service - INFO - PaymentService initialized
2025-06-11 13:04:51,410 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 13:04:51,410 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 13:04:51,411 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 13:04:51,411 - services.payment_service - INFO - PaymentService initialized
2025-06-11 13:04:51,411 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-11 13:04:51,412 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-11 13:04:51,412 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-11 13:04:51,412 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 13:04:51,413 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-11 13:04:51,774 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-11 13:04:51,774 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-11 13:04:51,775 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-11 13:04:51,775 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 13:04:51,786 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-11 13:04:51,787 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-11 13:05:05,193 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-11 13:05:05,194 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-11 13:05:05,197 - handlers.base_handler - INFO - Session 2348055614455 initialized with greeting state for user 'Ziga'.
2025-06-11 13:05:06,131 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjYxRjY4NTk0RUM2MTlCRTQxMgA="}]}
2025-06-11 13:05:06,132 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:05:06] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:05:06,933 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:05:06] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:05:07,293 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:05:07] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:05:07,412 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:05:07] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:05:08,376 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-11 13:05:08,378 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-06-11 13:05:08,379 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order.
2025-06-11 13:05:08,379 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-06-11 13:05:08,380 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-06-11 13:05:09,361 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjdDRTM4NkYxMTA2MkEzRkU1NAA="}]}
2025-06-11 13:05:09,362 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:05:09] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:05:10,201 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:05:10] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:05:10,622 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:05:10] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:05:10,744 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:05:10] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:05:15,083 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': '3 puff puff'}
2025-06-11 13:05:15,085 - handlers.base_handler - INFO - AIHandler: Handling message '3 puff puff' in AI bulk order state for session 2348055614455. Original: '3 puff puff'
2025-06-11 13:05:17,543 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-11 13:05:18,671 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjJCNzcwQkU3ODVCNTcyRkY1RQA="}]}
2025-06-11 13:05:18,672 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:05:18] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:05:19,472 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:05:19] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:05:19,782 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:05:19] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:05:19,994 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:05:19] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:05:21,063 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-06-11 13:05:21,065 - handlers.base_handler - INFO - AI order confirmed. Cart: {'Puff Puff': {'item_id': 'Puff Puff', 'quantity': 3, 'price': 200, 'total_price': 600, 'variations': {}}}. Redirecting to order handler.
2025-06-11 13:05:21,066 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'order_handler' with message 'process_final_order'.
2025-06-11 13:05:21,066 - handlers.order_handler - INFO - AI initiated order processing for session 2348055614455.
2025-06-11 13:05:21,067 - handlers.order_handler - INFO - Address set, proceeding to confirm order for AI-initiated session 2348055614455.
2025-06-11 13:05:21,067 - handlers.order_handler - INFO - Showing final order confirmation for session 2348055614455. Total: ₦600.00
2025-06-11 13:05:21,070 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦600 (1 items)
2025-06-11 13:05:21,071 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦600.00
2025-06-11 13:05:22,001 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjgzMTkyOTRBQTc2NDYzNDExQQA="}]}
2025-06-11 13:05:22,002 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:05:22] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:05:22,743 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:05:22] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:05:23,183 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:05:23] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:05:23,302 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:05:23] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:05:25,198 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'final_confirm'}
2025-06-11 13:05:25,200 - handlers.order_handler - INFO - Order ORDER_20250611_130525_89d87621 confirmed for session 2348055614455. Amount: ₦600.00
2025-06-11 13:05:25,201 - handlers.order_handler - ERROR - Error tracking order conversion: 'OrderHandler' object has no attribute 'track_order_conversion'
2025-06-11 13:05:25,201 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'payment_handler' with message 'initiate_payment'.
2025-06-11 13:05:25,202 - handlers.message_processor - WARNING - No specific handler or state match for handler 'payment_handler', state 'payment_processing', message 'initiate_payment' for session 2348055614455. Resetting to greeting.
2025-06-11 13:05:25,205 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦600 (1 items)
2025-06-11 13:05:25,205 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦600.00
2025-06-11 13:05:26,202 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkMwRDE1NDJCQ0MzNzg0QTBDNgA="}]}
2025-06-11 13:05:26,203 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:05:26] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:05:27,153 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:05:27] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:05:27,342 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:05:27] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:05:27,451 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:05:27] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:16:50,310 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-11 13:16:50,310 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 13:16:50,311 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 13:16:50,311 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 13:16:50,311 - services.payment_service - INFO - PaymentService initialized
2025-06-11 13:16:50,311 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 13:16:50,312 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 13:16:50,312 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 13:16:50,312 - services.payment_service - INFO - PaymentService initialized
2025-06-11 13:16:50,313 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-11 13:16:50,313 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-11 13:16:50,313 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-11 13:16:50,314 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 13:16:50,314 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-11 13:16:50,693 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-11 13:16:50,693 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-11 13:16:50,694 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-11 13:16:50,694 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 13:16:50,711 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-11 13:16:50,712 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-11 13:17:07,726 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-11 13:17:07,726 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-11 13:17:07,729 - handlers.base_handler - INFO - Session 2348055614455 initialized with greeting state for user 'Ziga'.
2025-06-11 13:17:08,684 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjBFRUM3REI3NkI4M0RFNTQ4RgA="}]}
2025-06-11 13:17:08,685 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:17:08] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:17:09,489 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:17:09] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:17:09,851 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:17:09] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:17:10,254 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:17:10] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:17:12,119 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-11 13:17:12,121 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-06-11 13:17:12,121 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order.
2025-06-11 13:17:12,121 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-06-11 13:17:12,121 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-06-11 13:17:13,019 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjJBOUMzQTM5NzEzMTJDOUY2OQA="}]}
2025-06-11 13:17:13,020 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:17:13] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:17:13,857 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:17:13] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:17:14,161 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:17:14] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:17:14,569 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:17:14] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:17:19,254 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': '10 puff puff'}
2025-06-11 13:17:19,256 - handlers.base_handler - INFO - AIHandler: Handling message '10 puff puff' in AI bulk order state for session 2348055614455. Original: '10 puff puff'
2025-06-11 13:17:21,819 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-11 13:17:22,760 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkNGQ0QzRDAzQTZGMjE3RTcxRQA="}]}
2025-06-11 13:17:22,761 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:17:22] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:17:23,769 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:17:23] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:17:23,979 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:17:23] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:17:24,221 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:17:24] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:17:25,297 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-06-11 13:17:25,300 - handlers.base_handler - INFO - AI order confirmed. Cart: {'Puff Puff': {'item_id': 'Puff Puff', 'quantity': 10, 'price': 200, 'total_price': 2000, 'variations': {}}}. Redirecting to order handler.
2025-06-11 13:17:25,300 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'order_handler' with message 'process_final_order'.
2025-06-11 13:17:25,300 - handlers.order_handler - INFO - AI initiated order processing for session 2348055614455.
2025-06-11 13:17:25,301 - handlers.order_handler - INFO - Address set, proceeding to confirm order for AI-initiated session 2348055614455.
2025-06-11 13:17:25,301 - handlers.order_handler - INFO - Showing final order confirmation for session 2348055614455. Total: ₦2,000.00
2025-06-11 13:17:25,305 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦2,000 (1 items)
2025-06-11 13:17:25,305 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦2,000.00
2025-06-11 13:17:26,249 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkM3NDk2NjM4RkFBNzczRkRDOAA="}]}
2025-06-11 13:17:26,250 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:17:26] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:17:26,970 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:17:26] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:17:27,429 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:17:27] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:17:27,712 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:17:27] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:17:28,790 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'final_confirm'}
2025-06-11 13:17:28,796 - handlers.order_handler - INFO - Order ORDER_20250611_131728_e1d80d49 confirmed for session 2348055614455. Amount: ₦2,000.00
2025-06-11 13:17:28,797 - handlers.order_handler - ERROR - Error tracking order conversion: 'OrderHandler' object has no attribute 'track_order_conversion'
2025-06-11 13:17:28,797 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'payment_handler' with message 'initiate_payment'.
2025-06-11 13:17:28,797 - handlers.message_processor - WARNING - No specific handler or state match for handler 'payment_handler', state 'payment_processing', message 'initiate_payment' for session 2348055614455. Resetting to greeting.
2025-06-11 13:17:28,801 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦2,000 (1 items)
2025-06-11 13:17:28,802 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦2,000.00
2025-06-11 13:17:29,749 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjE1QkUwOTdGNTQ0N0E4RDQxMQA="}]}
2025-06-11 13:17:29,750 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:17:29] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:17:30,789 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:17:30] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:17:31,081 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:17:31] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:17:31,218 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:17:31] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:19:08,345 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'lola_chatbot_direct'}
2025-06-11 13:19:08,347 - handlers.base_handler - INFO - GreetingHandler: Handling message 'lola_chatbot_direct' in greeting state for session 2348055614455.
2025-06-11 13:19:08,347 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for Lola Chatbot.
2025-06-11 13:19:08,347 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'start_lola_chat'.
2025-06-11 13:19:08,348 - handlers.base_handler - INFO - AIHandler: Handling message 'start_lola_chat' in Lola chat state for session 2348055614455. Original: 'lola_chatbot_direct'
2025-06-11 13:19:08,350 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦2,000 (1 items)
2025-06-11 13:19:08,351 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦2,000.00
2025-06-11 13:19:09,288 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjhCODg4OTNBMDRERUY3ODQwNgA="}]}
2025-06-11 13:19:09,289 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:19:09] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:19:10,103 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:19:10] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:19:10,441 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:19:10] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:19:11,009 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:19:11] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:19:21,320 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': "What's today's date"}
2025-06-11 13:19:21,322 - handlers.base_handler - INFO - AIHandler: Handling message 'what's today's date' in Lola chat state for session 2348055614455. Original: 'What's today's date'
2025-06-11 13:19:22,860 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-11 13:19:22,864 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦2,000 (1 items)
2025-06-11 13:19:22,864 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦2,000.00
2025-06-11 13:19:23,808 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkIzRjg0QjdCNzRBOUNCMzcwOQA="}]}
2025-06-11 13:19:23,809 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:19:23] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:19:24,583 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:19:24] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:19:25,100 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:19:25] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:19:25,230 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:19:25] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:19:46,870 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': "We're in 2025"}
2025-06-11 13:19:46,872 - handlers.base_handler - INFO - AIHandler: Handling message 'we're in 2025' in Lola chat state for session 2348055614455. Original: 'We're in 2025'
2025-06-11 13:19:48,388 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-11 13:19:48,391 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦2,000 (1 items)
2025-06-11 13:19:48,391 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦2,000.00
2025-06-11 13:19:49,368 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjJBMEYzQjRBQTI5QTcxMkU3QwA="}]}
2025-06-11 13:19:49,369 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:19:49] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:19:50,409 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:19:50] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:19:50,698 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:19:50] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:19:51,091 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:19:51] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:20:01,364 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Menu'}
2025-06-11 13:20:01,367 - handlers.base_handler - INFO - AIHandler: Handling message 'menu' in Lola chat state for session 2348055614455. Original: 'Menu'
2025-06-11 13:20:01,367 - handlers.base_handler - INFO - Session 2348055614455 returned to main menu (greeting state).
2025-06-11 13:20:01,367 - handlers.base_handler - INFO - Session 2348055614455 returned to main menu (greeting state).
2025-06-11 13:20:01,370 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦2,000 (1 items)
2025-06-11 13:20:01,371 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦2,000.00
2025-06-11 13:20:02,328 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjc1MDc5OTZCN0ZGQjE1Q0VERQA="}]}
2025-06-11 13:20:02,328 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:20:02] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:20:03,259 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:20:03] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:20:03,559 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:20:03] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:20:03,998 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:20:03] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:20:06,300 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'others_menu'}
2025-06-11 13:20:06,301 - handlers.base_handler - INFO - GreetingHandler: Handling message 'others_menu' in greeting state for session 2348055614455.
2025-06-11 13:20:06,305 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦2,000 (1 items)
2025-06-11 13:20:06,306 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦2,000.00
2025-06-11 13:20:06,930 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 400 Client Error: Bad Request for url: https://graph.facebook.com/v17.0/608867502309431/messages - {"error":{"message":"(#131009) Parameter value is not valid","type":"OAuthException","code":131009,"error_data":{"messaging_product":"whatsapp","details":"Invalid buttons count. Min allowed buttons: 1, Max allowed buttons: 3"},"fbtrace_id":"AOJuAWXyCrs0aR82gveFrMm"}}
2025-06-11 13:20:06,931 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:20:06] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:25:53,912 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-11 13:25:53,912 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 13:25:53,913 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 13:25:53,913 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 13:25:53,914 - services.payment_service - INFO - PaymentService initialized
2025-06-11 13:25:53,914 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 13:25:53,915 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 13:25:53,915 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 13:25:53,916 - services.payment_service - INFO - PaymentService initialized
2025-06-11 13:25:53,916 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-11 13:25:53,916 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-11 13:25:53,917 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-11 13:25:53,918 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 13:25:53,918 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-11 13:25:54,385 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-11 13:25:54,385 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-11 13:25:54,385 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-11 13:25:54,385 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 13:25:54,402 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-11 13:25:54,402 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-11 13:26:00,416 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-11 13:26:00,417 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-11 13:26:00,419 - handlers.base_handler - INFO - Session 2348055614455 initialized with greeting state for user 'Ziga'.
2025-06-11 13:26:01,637 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQ0REJDOTQ5MkE5NTc0QzRFNAA="}]}
2025-06-11 13:26:01,639 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:26:01] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:26:02,428 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:26:02] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:26:02,817 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:26:02] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:26:03,277 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:26:03] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:26:03,548 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-11 13:26:03,551 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-06-11 13:26:03,551 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order.
2025-06-11 13:26:03,551 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-06-11 13:26:03,552 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-06-11 13:26:04,507 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjA1Qjg0Q0ZFQUUxRjg1NTAyRgA="}]}
2025-06-11 13:26:04,507 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:26:04] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:26:05,373 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:26:05] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:26:05,634 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:26:05] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:26:05,987 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:26:05] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:26:10,427 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': '2 puff puff'}
2025-06-11 13:26:10,429 - handlers.base_handler - INFO - AIHandler: Handling message '2 puff puff' in AI bulk order state for session 2348055614455. Original: '2 puff puff'
2025-06-11 13:26:12,831 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-11 13:26:13,817 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkRFN0E1Q0Q4MjU1OEZCMENDQwA="}]}
2025-06-11 13:26:13,818 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:26:13] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:26:14,554 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:26:14] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:26:15,167 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:26:15] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:26:15,290 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:26:15] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:26:16,239 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-06-11 13:26:16,241 - handlers.base_handler - INFO - AI order confirmed. Cart: {'Puff Puff': {'item_id': 'Puff Puff', 'quantity': 2, 'price': 200, 'total_price': 400, 'variations': {}}}. Redirecting to order handler.
2025-06-11 13:26:16,242 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'order_handler' with message 'process_final_order'.
2025-06-11 13:26:16,242 - handlers.order_handler - INFO - AI initiated order processing for session 2348055614455.
2025-06-11 13:26:16,242 - handlers.order_handler - INFO - Address set, proceeding to confirm order for AI-initiated session 2348055614455.
2025-06-11 13:26:16,243 - handlers.order_handler - INFO - Showing final order confirmation for session 2348055614455. Total: ₦400.00
2025-06-11 13:26:16,246 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦400 (1 items)
2025-06-11 13:26:16,246 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦400.00
2025-06-11 13:26:17,157 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjE2NzQ4OEI0QzBFQkExMzAwRQA="}]}
2025-06-11 13:26:17,157 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:26:17] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:26:18,084 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:26:18] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:26:18,300 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:26:18] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:26:18,719 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:26:18] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:26:19,575 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'final_confirm'}
2025-06-11 13:26:19,576 - handlers.order_handler - INFO - Order ORDER_20250611_132619_eb94c4d8 confirmed for session 2348055614455. Amount: ₦400.00
2025-06-11 13:26:19,577 - handlers.order_handler - ERROR - Error tracking order conversion: 'OrderHandler' object has no attribute 'track_order_conversion'
2025-06-11 13:26:19,577 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'payment_handler' with message 'initiate_payment'.
2025-06-11 13:26:19,577 - handlers.message_processor - WARNING - No specific handler or state match for handler 'payment_handler', state 'payment_processing', message 'initiate_payment' for session 2348055614455. Resetting to greeting.
2025-06-11 13:26:19,584 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦400 (1 items)
2025-06-11 13:26:19,584 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦400.00
2025-06-11 13:26:20,487 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkE2NDk3QzNFNzI4Njk0NTQ2QwA="}]}
2025-06-11 13:26:20,487 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:26:20] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:26:21,209 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:26:21] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:26:21,657 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:26:21] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:26:21,869 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:26:21] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:29:17,883 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'enquiry'}
2025-06-11 13:29:17,883 - utils.session_manager - INFO - New session 2347082345056 initialized.
2025-06-11 13:29:17,885 - services.lead_tracker - INFO - New lead tracked: 2347082345056 (Olumayowa Oyaleke)
2025-06-11 13:29:17,886 - handlers.lead_tracking_handler - INFO - 🆕 New lead detected: 2347082345056 (Olumayowa Oyaleke)
2025-06-11 13:29:17,888 - handlers.base_handler - INFO - Session 2347082345056 initialized with greeting state for user 'Olumayowa Oyaleke'.
2025-06-11 13:29:19,030 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjVGNDMxRDY0Mzg2RDFFNTVBQgA="}]}
2025-06-11 13:29:19,032 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:29:19] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:29:21,107 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:29:21] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:39:36,055 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-11 13:39:36,055 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 13:39:36,056 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 13:39:36,056 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 13:39:36,057 - services.payment_service - INFO - PaymentService initialized
2025-06-11 13:39:36,057 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 13:39:36,058 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 13:39:36,058 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 13:39:36,059 - services.payment_service - INFO - PaymentService initialized
2025-06-11 13:39:36,059 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-11 13:39:36,059 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-11 13:39:36,060 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-11 13:39:36,060 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 13:39:36,061 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-11 13:39:36,435 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-11 13:39:36,435 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-11 13:39:36,436 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-11 13:39:36,436 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 13:39:36,452 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-11 13:39:36,452 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-11 13:39:42,571 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-11 13:39:42,571 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-11 13:39:42,574 - handlers.base_handler - INFO - Session 2348055614455 initialized with greeting state for user 'Ziga'.
2025-06-11 13:39:43,585 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQ0RjNDQzE0NkE3RjdGNzlBMwA="}]}
2025-06-11 13:39:43,586 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:39:43] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:39:44,435 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:39:44] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:39:44,875 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:39:44] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:39:44,987 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:39:44] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:39:46,126 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-11 13:39:46,128 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-06-11 13:39:46,128 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order.
2025-06-11 13:39:46,129 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-06-11 13:39:46,129 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-06-11 13:39:47,075 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjNBRjcxQkM5QkVCODJCMUM2QQA="}]}
2025-06-11 13:39:47,076 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:39:47] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:39:47,801 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:39:47] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:39:48,417 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:39:48] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:39:48,685 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:39:48] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:39:54,600 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': '10 puff puff'}
2025-06-11 13:39:54,602 - handlers.base_handler - INFO - AIHandler: Handling message '10 puff puff' in AI bulk order state for session 2348055614455. Original: '10 puff puff'
2025-06-11 13:39:56,855 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-11 13:39:57,854 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkRCNTUwNkZGQTEzQ0NGRjBBNwA="}]}
2025-06-11 13:39:57,855 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:39:57] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:39:58,746 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:39:58] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:39:59,005 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:39:59] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:39:59,775 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:39:59] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:40:00,154 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-06-11 13:40:00,157 - handlers.base_handler - INFO - AI order confirmed. Cart: {'Puff Puff': {'item_id': 'Puff Puff', 'quantity': 10, 'price': 200, 'total_price': 2000, 'variations': {}}}. Redirecting to order handler.
2025-06-11 13:40:00,157 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'order_handler' with message 'process_final_order'.
2025-06-11 13:40:00,157 - handlers.order_handler - INFO - AI initiated order processing for session 2348055614455.
2025-06-11 13:40:00,158 - handlers.order_handler - INFO - Address set, proceeding to confirm order for AI-initiated session 2348055614455.
2025-06-11 13:40:00,158 - handlers.order_handler - INFO - Showing final order confirmation for session 2348055614455. Total: ₦2,000.00
2025-06-11 13:40:00,162 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦2,000 (1 items)
2025-06-11 13:40:00,162 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦2,000.00
2025-06-11 13:40:01,084 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQ5NUZDQTg4QTdCMDgzRkFERAA="}]}
2025-06-11 13:40:01,085 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:40:01] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:40:02,017 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:40:02] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:40:02,315 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:40:02] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:40:02,435 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:40:02] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:40:03,778 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'final_confirm'}
2025-06-11 13:40:03,779 - handlers.order_handler - INFO - Order ORDER_20250611_134003_25ec65e0 confirmed for session 2348055614455. Amount: ₦2,000.00
2025-06-11 13:40:03,783 - services.lead_tracker - INFO - Order completion tracked for 2348055614455: ORDER_20250611_134003_25ec65e0 (₦2,000)
2025-06-11 13:40:03,783 - handlers.lead_tracking_handler - INFO - 💰 Conversion tracked: 2348055614455 - ORDER_20250611_134003_25ec65e0 (₦2,000)
2025-06-11 13:40:03,784 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'payment_handler' with message 'initiate_payment'.
2025-06-11 13:40:03,784 - handlers.base_handler - INFO - Handling payment processing for session 2348055614455, message: initiate_payment
2025-06-11 13:40:03,784 - handlers.base_handler - INFO - Creating payment link for session 2348055614455
2025-06-11 13:40:03,792 - utils.data_manager - INFO - Order details saved to data\orders.json
2025-06-11 13:40:03,792 - services.payment_service - INFO - Attempting to create payment link for reference: PAY-ORDER-20250611134003-5966 with amount: 200000, email: ziga4455@foodorder.com
2025-06-11 13:40:04,575 - services.payment_service - INFO - Payment link created for Ziga Ziga (2348055614455), URL: https://checkout.paystack.com/2z1ldhh9ugtfqfk
2025-06-11 13:40:04,576 - handlers.base_handler - INFO - Starting payment monitoring for order ORDER-20250611134003-5966, reference PAY-ORDER-20250611134003-5966
2025-06-11 13:40:04,576 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-ORDER-20250611134003-5966
2025-06-11 13:40:05,077 - services.payment_service - WARNING - Payment not successful for reference PAY-ORDER-20250611134003-5966. Paystack status: abandoned. Response: {'status': True, 'message': 'Verification successful', 'data': {'id': 5048203249, 'domain': 'test', 'status': 'abandoned', 'reference': 'PAY-ORDER-20250611134003-5966', 'receipt_number': None, 'amount': 200000, 'message': None, 'gateway_response': 'The transaction was not completed', 'paid_at': None, 'created_at': '2025-06-11T12:40:04.000Z', 'channel': 'card', 'currency': 'NGN', 'ip_address': '102.67.12.153, 172.68.186.20, 172.31.63.81', 'metadata': {'customer_name': 'Ziga', 'customer_phone': '2348055614455', 'first_name': 'Ziga', 'last_name': 'Ziga', 'order_id': 'ORDER-20250611134003-5966', 'delivery_address': 'Howson Wright'}, 'log': None, 'fees': None, 'fees_split': None, 'authorization': {}, 'customer': {'id': 276711440, 'first_name': None, 'last_name': None, 'email': 'ziga4455@foodorder.com', 'customer_code': 'CUS_bhkdpnbvcjqt55g', 'phone': None, 'metadata': None, 'risk_action': 'default', 'international_format_phone': None}, 'plan': None, 'split': {}, 'order_id': None, 'paidAt': None, 'createdAt': '2025-06-11T12:40:04.000Z', 'requested_amount': 200000, 'pos_transaction_data': None, 'source': None, 'fees_breakdown': None, 'connect': None, 'transaction_date': '2025-06-11T12:40:04.000Z', 'plan_object': {}, 'subaccount': {}}}
2025-06-11 13:40:05,077 - handlers.base_handler - INFO - Payment not yet verified for order ORDER-20250611134003-5966, attempt 1/15
2025-06-11 13:40:05,078 - handlers.base_handler - INFO - Payment link created successfully for order ORDER-20250611134003-5966
2025-06-11 13:40:05,081 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦2,000 (1 items)
2025-06-11 13:40:05,081 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦2,000.00
2025-06-11 13:40:06,046 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjkyQjg5NzE2MzQzMDMxQTI1QgA="}]}
2025-06-11 13:40:06,047 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:40:06] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:40:06,793 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:40:06] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:40:07,157 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:40:07] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:40:07,447 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:40:07] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:40:29,184 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'paid'}
2025-06-11 13:40:29,186 - handlers.base_handler - INFO - Received 'paid' command for session 2348055614455, attempting manual verification for ref: PAY-ORDER-20250611134003-5966
2025-06-11 13:40:29,186 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-ORDER-20250611134003-5966
2025-06-11 13:40:29,695 - services.payment_service - INFO - Payment verified successfully for reference PAY-ORDER-20250611134003-5966. Status: success
2025-06-11 13:40:29,696 - handlers.base_handler - INFO - Manual payment verification successful for order ORDER-20250611134003-5966
2025-06-11 13:40:29,696 - handlers.base_handler - INFO - Payment monitoring stopped for session 2348055614455
2025-06-11 13:40:29,701 - utils.data_manager - INFO - Order details saved to data\orders.json
2025-06-11 13:40:29,704 - services.lead_tracker - INFO - Order completion tracked for 2348055614455: ORDER-20250611134003-5966 (₦2,000)
2025-06-11 13:40:29,705 - handlers.lead_tracking_handler - INFO - 💰 Conversion tracked: 2348055614455 - ORDER-20250611134003-5966 (₦2,000)
2025-06-11 13:40:30,654 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkNGMzI2MkI4QjdDMTNEQTExQQA="}]}
2025-06-11 13:40:30,655 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:40:30] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:40:31,456 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:40:31] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:40:34,503 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:40:34] "POST /webhook HTTP/1.1" 200 -
2025-06-11 13:40:34,628 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 13:40:34] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:09:17,152 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-11 14:09:17,153 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 14:09:17,153 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 14:09:17,154 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 14:09:17,154 - services.payment_service - INFO - PaymentService initialized
2025-06-11 14:09:17,154 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 14:09:17,155 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 14:09:17,155 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 14:09:17,156 - services.payment_service - INFO - PaymentService initialized
2025-06-11 14:09:17,156 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-11 14:09:17,157 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-11 14:09:17,157 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-11 14:09:17,158 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 14:09:17,158 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-11 14:09:17,714 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-11 14:09:17,715 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-11 14:09:17,715 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-11 14:09:17,715 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 14:09:17,755 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-11 14:09:17,755 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-11 14:10:23,102 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-11 14:10:23,103 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-11 14:10:23,107 - handlers.base_handler - INFO - Session 2348055614455 initialized with greeting state for user 'Ziga'.
2025-06-11 14:10:23,815 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 400 Client Error: Bad Request for url: https://graph.facebook.com/v17.0/608867502309431/messages - {"error":{"message":"(#131009) Parameter value is not valid","type":"OAuthException","code":131009,"error_data":{"messaging_product":"whatsapp","details":"Button title length invalid. Min length: 1, Max length: 20"},"fbtrace_id":"Af1uCHIBzBZ7o3oggCAXWXy"}}
2025-06-11 14:10:23,816 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:10:23] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:11:52,682 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-11 14:11:52,682 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 14:11:52,683 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 14:11:52,683 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 14:11:52,684 - services.payment_service - INFO - PaymentService initialized
2025-06-11 14:11:52,684 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 14:11:52,685 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 14:11:52,685 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 14:11:52,686 - services.payment_service - INFO - PaymentService initialized
2025-06-11 14:11:52,686 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-11 14:11:52,686 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-11 14:11:52,687 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-11 14:11:52,687 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 14:11:52,688 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-11 14:11:53,042 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-11 14:11:53,043 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-11 14:11:53,043 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-11 14:11:53,043 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 14:11:53,057 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-11 14:11:53,057 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-11 14:11:58,640 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-11 14:11:58,641 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-11 14:11:58,644 - handlers.base_handler - INFO - Session 2348055614455 initialized with greeting state for user 'Ziga'.
2025-06-11 14:11:59,865 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjZCQTVBNDU5MTVDQ0Q2NTU5QwA="}]}
2025-06-11 14:11:59,866 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:11:59] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:12:00,946 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:12:00] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:12:01,136 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:12:01] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:12:01,418 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:12:01] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:12:04,900 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'order_menu_categories'}
2025-06-11 14:12:04,902 - handlers.base_handler - INFO - GreetingHandler: Handling message 'order_menu_categories' in greeting state for session 2348055614455.
2025-06-11 14:12:04,902 - handlers.base_handler - WARNING - Session 2348055614455: Invalid option 'order_menu_categories' in greeting state.
2025-06-11 14:12:05,885 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQ3RTNGMkJEOUMzOTA0NjBDQgA="}]}
2025-06-11 14:12:05,886 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:12:05] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:12:06,736 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:12:06] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:12:07,385 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:12:07] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:12:07,506 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:12:07] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:12:30,463 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-11 14:12:30,465 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-06-11 14:12:30,466 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order.
2025-06-11 14:12:30,466 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-06-11 14:12:30,466 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-06-11 14:12:31,407 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkM4MzBGMDdENUZFOEFBQzRDOAA="}]}
2025-06-11 14:12:31,408 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:12:31] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:12:32,437 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:12:32] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:12:32,777 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:12:32] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:12:33,116 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:12:33] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:12:38,386 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': '100 puff puff'}
2025-06-11 14:12:38,389 - handlers.base_handler - INFO - AIHandler: Handling message '100 puff puff' in AI bulk order state for session 2348055614455. Original: '100 puff puff'
2025-06-11 14:12:41,175 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-11 14:12:42,215 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjg2QUJBRDRFQ0Q0OEE4MzE4NAA="}]}
2025-06-11 14:12:42,216 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:12:42] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:12:43,126 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:12:43] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:12:43,655 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:12:43] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:12:43,776 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:12:43] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:12:44,819 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-06-11 14:12:44,823 - handlers.base_handler - INFO - AI order confirmed. Cart: {'Puff Puff': {'item_id': 'Puff Puff', 'quantity': 100, 'price': 200, 'total_price': 20000, 'variations': {}}}. Redirecting to order handler.
2025-06-11 14:12:44,824 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'order_handler' with message 'process_final_order'.
2025-06-11 14:12:44,824 - handlers.order_handler - INFO - AI initiated order processing for session 2348055614455.
2025-06-11 14:12:44,825 - handlers.order_handler - INFO - Address set, proceeding to confirm order for AI-initiated session 2348055614455.
2025-06-11 14:12:44,825 - handlers.order_handler - INFO - Showing final order confirmation for session 2348055614455. Total: ₦20,000.00
2025-06-11 14:12:44,840 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦20,000 (1 items)
2025-06-11 14:12:44,841 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦20,000.00
2025-06-11 14:12:45,765 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkIxREM4RDI5QTVEMzE0NzUyOQA="}]}
2025-06-11 14:12:45,767 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:12:45] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:12:46,452 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:12:46] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:12:46,936 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:12:46] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:12:47,347 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:12:47] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:12:50,140 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'final_confirm'}
2025-06-11 14:12:50,142 - handlers.order_handler - INFO - Order ORDER_20250611_141250_c7210abe confirmed for session 2348055614455. Amount: ₦20,000.00
2025-06-11 14:12:50,146 - services.lead_tracker - INFO - Order completion tracked for 2348055614455: ORDER_20250611_141250_c7210abe (₦20,000)
2025-06-11 14:12:50,147 - handlers.lead_tracking_handler - INFO - 💰 Conversion tracked: 2348055614455 - ORDER_20250611_141250_c7210abe (₦20,000)
2025-06-11 14:12:50,147 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'payment_handler' with message 'initiate_payment'.
2025-06-11 14:12:50,148 - handlers.base_handler - INFO - Handling payment processing for session 2348055614455, message: initiate_payment
2025-06-11 14:12:50,148 - handlers.base_handler - INFO - Creating payment link for session 2348055614455
2025-06-11 14:12:50,167 - utils.data_manager - INFO - Order details saved to data\orders.json
2025-06-11 14:12:50,168 - services.payment_service - INFO - Attempting to create payment link for reference: PAY-ORDER-20250611141250-1538 with amount: 2000000, email: ziga4455@foodorder.com
2025-06-11 14:12:50,786 - services.payment_service - INFO - Payment link created for Ziga Ziga (2348055614455), URL: https://checkout.paystack.com/tvw692jakp6hzb1
2025-06-11 14:12:50,788 - handlers.base_handler - INFO - Starting payment monitoring for order ORDER-20250611141250-1538, reference PAY-ORDER-20250611141250-1538
2025-06-11 14:12:50,811 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-ORDER-20250611141250-1538
2025-06-11 14:12:51,286 - services.payment_service - WARNING - Payment not successful for reference PAY-ORDER-20250611141250-1538. Paystack status: abandoned. Response: {'status': True, 'message': 'Verification successful', 'data': {'id': 5048277826, 'domain': 'test', 'status': 'abandoned', 'reference': 'PAY-ORDER-20250611141250-1538', 'receipt_number': None, 'amount': 2000000, 'message': None, 'gateway_response': 'The transaction was not completed', 'paid_at': None, 'created_at': '2025-06-11T13:12:50.000Z', 'channel': 'card', 'currency': 'NGN', 'ip_address': '102.67.12.153, 172.70.163.148, 172.31.63.81', 'metadata': {'customer_name': 'Ziga', 'customer_phone': '2348055614455', 'first_name': 'Ziga', 'last_name': 'Ziga', 'order_id': 'ORDER-20250611141250-1538', 'delivery_address': 'Howson Wright'}, 'log': None, 'fees': None, 'fees_split': None, 'authorization': {}, 'customer': {'id': 276711440, 'first_name': None, 'last_name': None, 'email': 'ziga4455@foodorder.com', 'customer_code': 'CUS_bhkdpnbvcjqt55g', 'phone': None, 'metadata': None, 'risk_action': 'default', 'international_format_phone': None}, 'plan': None, 'split': {}, 'order_id': None, 'paidAt': None, 'createdAt': '2025-06-11T13:12:50.000Z', 'requested_amount': 2000000, 'pos_transaction_data': None, 'source': None, 'fees_breakdown': None, 'connect': None, 'transaction_date': '2025-06-11T13:12:50.000Z', 'plan_object': {}, 'subaccount': {}}}
2025-06-11 14:12:51,287 - handlers.base_handler - INFO - Payment not yet verified for order ORDER-20250611141250-1538, attempt 1/15
2025-06-11 14:12:51,288 - handlers.base_handler - INFO - Payment link created successfully for order ORDER-20250611141250-1538
2025-06-11 14:12:51,290 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦20,000 (1 items)
2025-06-11 14:12:51,291 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦20,000.00
2025-06-11 14:12:52,274 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkYyRENGNjcwNTlEQ0U1NEEyRgA="}]}
2025-06-11 14:12:52,275 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:12:52] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:12:53,076 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:12:53] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:12:53,565 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:12:53] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:12:53,897 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:12:53] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:13:05,785 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Paid'}
2025-06-11 14:13:05,787 - handlers.base_handler - INFO - Received 'paid' command for session 2348055614455, attempting manual verification for ref: PAY-ORDER-20250611141250-1538
2025-06-11 14:13:05,787 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-ORDER-20250611141250-1538
2025-06-11 14:13:06,316 - services.payment_service - INFO - Payment verified successfully for reference PAY-ORDER-20250611141250-1538. Status: success
2025-06-11 14:13:06,317 - handlers.base_handler - INFO - Manual payment verification successful for order ORDER-20250611141250-1538
2025-06-11 14:13:06,317 - handlers.base_handler - INFO - Payment monitoring stopped for session 2348055614455
2025-06-11 14:13:06,322 - utils.data_manager - INFO - Order details saved to data\orders.json
2025-06-11 14:13:06,325 - services.lead_tracker - INFO - Order completion tracked for 2348055614455: ORDER-20250611141250-1538 (₦20,000)
2025-06-11 14:13:06,325 - handlers.lead_tracking_handler - INFO - 💰 Conversion tracked: 2348055614455 - ORDER-20250611141250-1538 (₦20,000)
2025-06-11 14:13:07,335 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjBDMjUyNUVFNDk1MkY1QTlEMgA="}]}
2025-06-11 14:13:07,335 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:13:07] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:13:08,115 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:13:08] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:13:08,566 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:13:08] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:13:09,037 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:13:09] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:13:23,380 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-11 14:13:23,381 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 14:13:23,381 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 14:13:23,382 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 14:13:23,382 - services.payment_service - INFO - PaymentService initialized
2025-06-11 14:13:23,383 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 14:13:23,383 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 14:13:23,384 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 14:13:23,384 - services.payment_service - INFO - PaymentService initialized
2025-06-11 14:13:23,385 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-11 14:13:23,385 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-11 14:13:23,386 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-11 14:13:23,386 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 14:13:23,386 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-11 14:13:23,764 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-11 14:13:23,764 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-11 14:13:23,764 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-11 14:13:23,765 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 14:13:23,776 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-11 14:13:23,776 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-11 14:13:30,010 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-11 14:13:30,011 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-11 14:13:30,014 - handlers.message_processor - ERROR - Error in message routing for handler 'greeting_handler', state 'start' for session 2348055614455: GreetingHandler.generate_initial_greeting() takes 3 positional arguments but 4 were given
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\app\handlers\message_processor.py", line 160, in _route_to_handler
    response = self.greeting_handler.generate_initial_greeting(state, session_id, user_name)
TypeError: GreetingHandler.generate_initial_greeting() takes 3 positional arguments but 4 were given
2025-06-11 14:13:30,955 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjk0QkM2OUUxNUJGQ0FBQzQ5RQA="}]}
2025-06-11 14:13:30,956 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:13:30] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:13:32,166 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:13:32] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:13:32,436 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:13:32] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:13:32,666 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:13:32] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:23:46,168 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-11 14:23:46,168 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 14:23:46,169 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 14:23:46,169 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 14:23:46,170 - services.payment_service - INFO - PaymentService initialized
2025-06-11 14:23:46,170 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 14:23:46,170 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 14:23:46,171 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 14:23:46,171 - services.payment_service - INFO - PaymentService initialized
2025-06-11 14:23:46,172 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-11 14:23:46,172 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-11 14:23:46,172 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-11 14:23:46,173 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 14:23:46,173 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-11 14:23:46,520 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-11 14:23:46,520 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-11 14:23:46,520 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-11 14:23:46,521 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 14:23:46,533 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-11 14:23:46,533 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-11 14:23:52,698 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-11 14:23:52,699 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-11 14:23:52,702 - handlers.base_handler - INFO - Session 2348055614455 initialized with greeting state for user 'Ziga'.
2025-06-11 14:23:53,332 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 400 Client Error: Bad Request for url: https://graph.facebook.com/v17.0/608867502309431/messages - {"error":{"message":"(#131009) Parameter value is not valid","type":"OAuthException","code":131009,"error_data":{"messaging_product":"whatsapp","details":"Invalid buttons count. Min allowed buttons: 1, Max allowed buttons: 3"},"fbtrace_id":"AWdjSpxNJlHrPMDFq1A8FFj"}}
2025-06-11 14:23:53,334 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:23:53] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:25:22,815 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-11 14:25:22,815 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 14:25:22,816 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 14:25:22,816 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 14:25:22,817 - services.payment_service - INFO - PaymentService initialized
2025-06-11 14:25:22,817 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 14:25:22,817 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 14:25:22,818 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 14:25:22,818 - services.payment_service - INFO - PaymentService initialized
2025-06-11 14:25:22,818 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-11 14:25:22,819 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-11 14:25:22,820 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-11 14:25:22,820 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 14:25:22,820 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-11 14:25:23,161 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-11 14:25:23,162 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-11 14:25:23,162 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-11 14:25:23,162 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 14:25:23,175 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-11 14:25:23,175 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-11 14:25:27,898 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-11 14:25:27,899 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-11 14:25:27,902 - handlers.base_handler - INFO - Session 2348055614455 initialized with greeting state for user 'Ziga'.
2025-06-11 14:25:28,842 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjY0NjVCODQxN0Q0QUIxMTEyMwA="}]}
2025-06-11 14:25:28,843 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:25:28] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:25:29,702 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:25:29] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:25:30,144 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:25:30] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:25:31,654 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'order'}
2025-06-11 14:25:31,656 - handlers.base_handler - INFO - GreetingHandler: Handling message 'order' in greeting state for session 2348055614455.
2025-06-11 14:25:31,656 - handlers.base_handler - INFO - Session 2348055614455 redirecting to menu_handler for classic menu.
2025-06-11 14:25:31,657 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'menu_handler' with message 'show_menu'.
2025-06-11 14:25:31,657 - handlers.base_handler - INFO - Received category selection: 'order'
2025-06-11 14:25:32,642 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQ4ODFCQUQ4MDRFMjUxQTYyMwA="}]}
2025-06-11 14:25:32,643 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:25:32] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:25:33,767 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:25:33] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:25:33,883 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:25:33] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:25:34,294 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:25:34] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:25:43,483 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:25:43] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:25:43,883 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Sides'}
2025-06-11 14:25:43,887 - handlers.base_handler - INFO - Received category selection: 'Sides'
2025-06-11 14:25:44,922 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjhDNkM1QzkxNDUyNTY2QzcyMgA="}]}
2025-06-11 14:25:44,923 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:25:44] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:25:45,904 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:25:45] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:25:46,093 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:25:46] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:25:46,404 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:25:46] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:25:50,972 - handlers.webhook_handler - INFO - List reply received: id='Boiled Yam Slices', title='Boiled Yam Slices (₦400)'
2025-06-11 14:25:50,972 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Boiled Yam Slices'}
2025-06-11 14:25:51,912 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkFGMjYyNzI3REI5NDM2NjYwNQA="}]}
2025-06-11 14:25:51,913 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:25:51] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:25:52,684 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:25:52] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:25:53,102 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:25:53] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:25:53,372 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:25:53] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:26:14,847 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': '5'}
2025-06-11 14:26:14,849 - handlers.message_processor - WARNING - No specific handler or state match for handler 'menu_handler', state 'get_quantity', message '5' for session 2348055614455. Resetting to greeting.
2025-06-11 14:26:15,881 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQ2NDc1Qzk4OTY2OTRCNzJCOQA="}]}
2025-06-11 14:26:15,882 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:26:15] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:26:16,654 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:26:16] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:26:17,044 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:26:17] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:26:17,334 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:26:17] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:26:22,547 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:26:22] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:26:48,380 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'order'}
2025-06-11 14:26:48,382 - handlers.base_handler - INFO - GreetingHandler: Handling message 'order' in greeting state for session 2348055614455.
2025-06-11 14:26:48,383 - handlers.base_handler - INFO - Session 2348055614455 redirecting to menu_handler for classic menu.
2025-06-11 14:26:48,383 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'menu_handler' with message 'show_menu'.
2025-06-11 14:26:48,383 - handlers.base_handler - INFO - Received category selection: 'order'
2025-06-11 14:26:49,332 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjE1NjE1OTUyMTJDNDkyNUI2MAA="}]}
2025-06-11 14:26:49,333 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:26:49] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:26:50,116 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:26:50] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:26:50,733 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:26:50] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:26:50,793 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:26:50] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:29:55,708 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-11 14:29:55,708 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 14:29:55,709 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 14:29:55,710 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 14:29:55,710 - services.payment_service - INFO - PaymentService initialized
2025-06-11 14:29:55,711 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 14:29:55,712 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 14:29:55,713 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 14:29:55,713 - services.payment_service - INFO - PaymentService initialized
2025-06-11 14:29:55,714 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-11 14:29:55,714 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-11 14:29:55,716 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-11 14:29:55,716 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 14:29:55,717 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-11 14:29:56,221 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-11 14:29:56,221 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-11 14:29:56,222 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-11 14:29:56,222 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 14:29:56,244 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-11 14:29:56,244 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-11 14:30:04,010 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-11 14:30:04,011 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-11 14:30:04,015 - handlers.base_handler - INFO - Session 2348055614455 initialized with greeting state for user 'Ziga'.
2025-06-11 14:30:05,163 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjgyNEJBNUY3QzUxOUZGOEY3RQA="}]}
2025-06-11 14:30:05,166 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:30:05] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:30:06,025 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:30:06] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:30:06,565 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:30:06] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:30:06,867 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:30:06] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:30:07,586 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'order'}
2025-06-11 14:30:07,590 - handlers.base_handler - INFO - GreetingHandler: Handling message 'order' in greeting state for session 2348055614455.
2025-06-11 14:30:07,590 - handlers.base_handler - INFO - Session 2348055614455 redirecting to menu_handler for classic menu.
2025-06-11 14:30:07,591 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'menu_handler' with message 'show_menu'.
2025-06-11 14:30:07,591 - handlers.base_handler - INFO - MenuHandler: Received message 'show_menu' (original: 'order') in menu state for session 2348055614455
2025-06-11 14:30:07,592 - handlers.base_handler - INFO - Showing menu categories for session 2348055614455
2025-06-11 14:30:07,592 - handlers.base_handler - INFO - Available categories: ['Main Dishes', 'Soups & Stews', 'Sides', 'Snacks', 'Drinks', 'Desserts', 'Specialties']
2025-06-11 14:30:08,608 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjREMzBBNjI0NUVGRkE2ODQwNQA="}]}
2025-06-11 14:30:08,610 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:30:08] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:30:09,612 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:30:09] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:30:09,885 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:30:09] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:30:10,253 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:30:10] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:30:13,132 - handlers.webhook_handler - INFO - List reply received: id='main dishes', title='Main Dishes'
2025-06-11 14:30:13,132 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'main dishes'}
2025-06-11 14:30:13,135 - handlers.base_handler - INFO - MenuHandler: Received message 'main dishes' (original: 'main dishes') in menu state for session 2348055614455
2025-06-11 14:30:13,136 - handlers.base_handler - INFO - Category 'Main Dishes' selected for session 2348055614455
2025-06-11 14:30:14,238 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjA5MkFDN0Q5RDExRENDMkM1OQA="}]}
2025-06-11 14:30:14,241 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:30:14] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:30:14,960 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:30:14] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:30:15,394 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:30:15] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:30:15,755 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:30:15] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:30:18,028 - handlers.webhook_handler - INFO - List reply received: id='Fried Rice Fiesta', title='Fried Rice Fies (₦1,400)'
2025-06-11 14:30:18,030 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Fried Rice Fiesta'}
2025-06-11 14:30:18,035 - handlers.base_handler - INFO - MenuHandler: Handling item selection 'Fried Rice Fiesta' for session 2348055614455
2025-06-11 14:30:18,037 - handlers.base_handler - INFO - Item 'Fried Rice Fiesta' selected for session 2348055614455, redirecting to order handler
2025-06-11 14:30:18,991 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjUzQkVFODE1RUUyM0MyRDU3QgA="}]}
2025-06-11 14:30:18,993 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:30:18] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:30:19,858 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:30:19] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:30:20,331 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:30:20] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:30:20,444 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:30:20] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:30:23,365 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': '5'}
2025-06-11 14:30:23,369 - handlers.order_handler - INFO - Item 'Fried Rice Fiesta' added to cart for session 2348055614455. Cart: {'Fried Rice Fiesta': {'item_id': 'Fried Rice Fiesta', 'quantity': 5, 'price': 1400.0, 'total_price': 7000.0, 'variations': {}}}
2025-06-11 14:30:23,375 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦7,000.0 (1 items)
2025-06-11 14:30:23,375 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦7,000.00
2025-06-11 14:30:23,383 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦7,000.0 (1 items)
2025-06-11 14:30:23,384 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦7,000.00
2025-06-11 14:30:24,312 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjZEMEZFNjQ4Q0E0MDdEQUY0NQA="}]}
2025-06-11 14:30:24,315 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:30:24] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:30:25,277 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:30:25] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:30:25,735 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:30:25] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:30:25,826 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:30:25] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:30:27,373 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'checkout'}
2025-06-11 14:30:27,377 - handlers.order_handler - INFO - User selected 'Checkout' for session 2348055614455.
2025-06-11 14:30:27,382 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦7,000.0 (1 items)
2025-06-11 14:30:27,383 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦7,000.00
2025-06-11 14:30:28,312 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjAxODhDQjY1MjNCREYzQzM4MQA="}]}
2025-06-11 14:30:28,315 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:30:28] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:30:29,164 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:30:29] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:30:29,610 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:30:29] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:30:29,648 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:30:29] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:30:30,458 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'details_correct'}
2025-06-11 14:30:30,464 - handlers.order_handler - INFO - User confirmed details are correct for session 2348055614455.
2025-06-11 14:30:30,466 - handlers.order_handler - INFO - Address set, proceeding to confirm order for manual session 2348055614455.
2025-06-11 14:30:30,467 - handlers.order_handler - INFO - Showing final order confirmation for session 2348055614455. Total: ₦7,000.00
2025-06-11 14:30:30,475 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦7,000.0 (1 items)
2025-06-11 14:30:30,476 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦7,000.00
2025-06-11 14:30:31,433 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkJDMUUzMjA4QzczNjRGOENFOQA="}]}
2025-06-11 14:30:31,435 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:30:31] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:30:32,162 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:30:32] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:30:32,706 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:30:32] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:30:33,110 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:30:33] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:30:34,868 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'final_confirm'}
2025-06-11 14:30:34,875 - handlers.order_handler - INFO - Order ORDER_20250611_143034_fab444d2 confirmed for session 2348055614455. Amount: ₦7,000.00
2025-06-11 14:30:34,883 - services.lead_tracker - INFO - Order completion tracked for 2348055614455: ORDER_20250611_143034_fab444d2 (₦7,000.0)
2025-06-11 14:30:34,884 - handlers.lead_tracking_handler - INFO - 💰 Conversion tracked: 2348055614455 - ORDER_20250611_143034_fab444d2 (₦7,000.0)
2025-06-11 14:30:34,885 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'payment_handler' with message 'initiate_payment'.
2025-06-11 14:30:34,885 - handlers.base_handler - INFO - Handling payment processing for session 2348055614455, message: initiate_payment
2025-06-11 14:30:34,886 - handlers.base_handler - INFO - Creating payment link for session 2348055614455
2025-06-11 14:30:34,898 - utils.data_manager - INFO - Order details saved to data\orders.json
2025-06-11 14:30:34,899 - services.payment_service - INFO - Attempting to create payment link for reference: PAY-ORDER-20250611143034-9102 with amount: 700000.0, email: ziga4455@foodorder.com
2025-06-11 14:30:35,543 - services.payment_service - INFO - Payment link created for Ziga Ziga (2348055614455), URL: https://checkout.paystack.com/569xdaokaswd5u3
2025-06-11 14:30:35,545 - handlers.base_handler - INFO - Starting payment monitoring for order ORDER-20250611143034-9102, reference PAY-ORDER-20250611143034-9102
2025-06-11 14:30:35,546 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-ORDER-20250611143034-9102
2025-06-11 14:30:36,053 - services.payment_service - WARNING - Payment not successful for reference PAY-ORDER-20250611143034-9102. Paystack status: abandoned. Response: {'status': True, 'message': 'Verification successful', 'data': {'id': 5048307360, 'domain': 'test', 'status': 'abandoned', 'reference': 'PAY-ORDER-20250611143034-9102', 'receipt_number': None, 'amount': 700000, 'message': None, 'gateway_response': 'The transaction was not completed', 'paid_at': None, 'created_at': '2025-06-11T13:30:35.000Z', 'channel': 'card', 'currency': 'NGN', 'ip_address': '102.67.12.153, 172.71.178.85, 172.31.63.81', 'metadata': {'customer_name': 'Ziga', 'customer_phone': '2348055614455', 'first_name': 'Ziga', 'last_name': 'Ziga', 'order_id': 'ORDER-20250611143034-9102', 'delivery_address': 'Howson Wright'}, 'log': None, 'fees': None, 'fees_split': None, 'authorization': {}, 'customer': {'id': 276711440, 'first_name': None, 'last_name': None, 'email': 'ziga4455@foodorder.com', 'customer_code': 'CUS_bhkdpnbvcjqt55g', 'phone': None, 'metadata': None, 'risk_action': 'default', 'international_format_phone': None}, 'plan': None, 'split': {}, 'order_id': None, 'paidAt': None, 'createdAt': '2025-06-11T13:30:35.000Z', 'requested_amount': 700000, 'pos_transaction_data': None, 'source': None, 'fees_breakdown': None, 'connect': None, 'transaction_date': '2025-06-11T13:30:35.000Z', 'plan_object': {}, 'subaccount': {}}}
2025-06-11 14:30:36,055 - handlers.base_handler - INFO - Payment not yet verified for order ORDER-20250611143034-9102, attempt 1/15
2025-06-11 14:30:36,057 - handlers.base_handler - INFO - Payment link created successfully for order ORDER-20250611143034-9102
2025-06-11 14:30:36,066 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦7,000.0 (1 items)
2025-06-11 14:30:36,067 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦7,000.00
2025-06-11 14:30:36,982 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjkwQjg3MjI0Njg3Q0YyM0RGNAA="}]}
2025-06-11 14:30:36,983 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:30:36] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:30:37,700 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:30:37] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:30:38,107 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:30:38] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:30:38,752 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:30:38] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:30:52,842 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Paid'}
2025-06-11 14:30:52,846 - handlers.base_handler - INFO - Received 'paid' command for session 2348055614455, attempting manual verification for ref: PAY-ORDER-20250611143034-9102
2025-06-11 14:30:52,847 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-ORDER-20250611143034-9102
2025-06-11 14:30:53,460 - services.payment_service - INFO - Payment verified successfully for reference PAY-ORDER-20250611143034-9102. Status: success
2025-06-11 14:30:53,463 - handlers.base_handler - INFO - Manual payment verification successful for order ORDER-20250611143034-9102
2025-06-11 14:30:53,464 - handlers.base_handler - INFO - Payment monitoring stopped for session 2348055614455
2025-06-11 14:30:53,476 - utils.data_manager - INFO - Order details saved to data\orders.json
2025-06-11 14:30:53,482 - services.lead_tracker - INFO - Order completion tracked for 2348055614455: ORDER-20250611143034-9102 (₦7,000.0)
2025-06-11 14:30:53,483 - handlers.lead_tracking_handler - INFO - 💰 Conversion tracked: 2348055614455 - ORDER-20250611143034-9102 (₦7,000.0)
2025-06-11 14:30:54,403 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkNEOUM5NTZEQ0IxMUNEQ0YyQwA="}]}
2025-06-11 14:30:54,406 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:30:54] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:30:55,114 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:30:55] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:30:55,497 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:30:55] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:30:56,025 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:30:56] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:31:11,314 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-11 14:31:11,321 - handlers.base_handler - WARNING - handle_order_confirmation_state called but order ORDER-20250611143034-9102 not found or not confirmed. Status: pending_payment
2025-06-11 14:31:12,211 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjIzMEM5NjMyQkYyQzM1ODUyRAA="}]}
2025-06-11 14:31:12,212 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:31:12] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:31:13,244 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:31:13] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:31:13,659 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:31:13] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:31:13,673 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:31:13] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:31:22,450 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-11 14:31:22,453 - handlers.base_handler - INFO - GreetingHandler: Handling message 'hello' in greeting state for session 2348055614455.
2025-06-11 14:31:22,454 - handlers.base_handler - WARNING - Session 2348055614455: Invalid option 'hello' in greeting state.
2025-06-11 14:31:23,384 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjc3OUVFMzNFMjBFRDdDRjQ0NAA="}]}
2025-06-11 14:31:23,386 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:31:23] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:31:24,494 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:31:24] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:31:24,902 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:31:24] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:31:25,042 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:31:25] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:31:28,273 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'others'}
2025-06-11 14:31:28,277 - handlers.base_handler - INFO - GreetingHandler: Handling message 'others' in greeting state for session 2348055614455.
2025-06-11 14:31:29,251 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkRFNDQ2QjRCMTFDNkRCNDRGQwA="}]}
2025-06-11 14:31:29,253 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:31:29] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:31:30,107 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:31:30] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:31:30,793 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:31:30] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:31:31,146 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:31:31] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:31:34,595 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'enquiry'}
2025-06-11 14:31:34,599 - handlers.message_processor - WARNING - No specific handler or state match for handler 'greeting_handler', state 'others_menu_selection', message 'enquiry' for session 2348055614455. Resetting to greeting.
2025-06-11 14:31:35,665 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkVCOUY5RjBEMEVCN0U2Q0IxNQA="}]}
2025-06-11 14:31:35,667 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:31:35] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:31:36,282 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:31:36] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:31:37,097 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:31:37] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:31:37,101 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:31:37] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:48:54,094 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-11 14:48:54,095 - utils.session_manager - INFO - Session 2348055614455 timed out after 1039.50 seconds (timeout limit: 600s). Resetting.
2025-06-11 14:48:54,098 - handlers.base_handler - INFO - Session 2348055614455 initialized with greeting state for user 'Ziga'.
2025-06-11 14:48:55,319 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkFFREM2MTJBQzhBNUJFNTY0MwA="}]}
2025-06-11 14:48:55,320 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:48:55] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:48:56,310 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:48:56] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:48:56,711 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:48:56] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:49:27,782 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:49:27] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:50:30,043 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:50:30] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:52:27,269 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-11 14:52:27,269 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 14:52:27,270 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 14:52:27,270 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 14:52:27,271 - services.payment_service - INFO - PaymentService initialized
2025-06-11 14:52:27,271 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 14:52:27,271 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 14:52:27,272 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 14:52:27,272 - services.payment_service - INFO - PaymentService initialized
2025-06-11 14:52:27,272 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-11 14:52:27,273 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-11 14:52:27,273 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-11 14:52:27,273 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 14:52:27,275 - handlers.feedback_handler - INFO - Created feedback file: data/feedback.json
2025-06-11 14:52:27,275 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-11 14:52:27,275 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-11 14:52:27,706 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-11 14:52:27,707 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-11 14:52:27,707 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-11 14:52:27,707 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 14:52:27,720 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-11 14:52:27,721 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-11 14:52:36,026 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-11 14:52:36,027 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-11 14:52:36,031 - handlers.base_handler - INFO - Session 2348055614455 initialized with greeting state for user 'Ziga'.
2025-06-11 14:52:37,258 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjEwMTRGMDAzQzZGNDAzNTNBRgA="}]}
2025-06-11 14:52:37,260 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:52:37] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:52:38,229 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:52:38] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:52:38,719 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:52:38] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:52:38,721 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:52:38] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:52:41,592 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_assistant'}
2025-06-11 14:52:41,594 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_assistant' in greeting state for session 2348055614455.
2025-06-11 14:52:41,594 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI menu.
2025-06-11 14:52:41,595 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'initial_entry'.
2025-06-11 14:52:41,595 - handlers.base_handler - INFO - AIHandler: Handling message 'initial_entry' in AI menu state for session 2348055614455. Original: 'ai_assistant'
2025-06-11 14:52:42,546 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjEyNDYxNDdGQTMxMkNCQjE2MQA="}]}
2025-06-11 14:52:42,547 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:52:42] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:52:44,266 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:52:44] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:52:44,535 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:52:44] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:52:44,536 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:52:44] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:52:56,573 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order'}
2025-06-11 14:52:56,576 - handlers.base_handler - INFO - AIHandler: Handling message 'ai_bulk_order' in AI menu state for session 2348055614455. Original: 'ai_bulk_order'
2025-06-11 14:52:57,506 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkVFMDcyRUVFQjFFRjYzRUQ1RgA="}]}
2025-06-11 14:52:57,507 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:52:57] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:52:58,470 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:52:58] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:52:59,070 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:52:59] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:52:59,072 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:52:59] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:53:42,223 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Jellofe fiesta 4\nEgusi three\nChicken platter 3'}
2025-06-11 14:53:42,225 - handlers.base_handler - INFO - AIHandler: Handling message 'jellofe fiesta 4
egusi three
chicken platter 3' in AI bulk order state for session 2348055614455. Original: 'Jellofe fiesta 4
Egusi three
Chicken platter 3'
2025-06-11 14:53:45,557 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-11 14:53:46,469 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkVDQTg0NUI1OUMwRjRDMTM1MQA="}]}
2025-06-11 14:53:46,470 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:53:46] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:53:47,378 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:53:47] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:53:47,728 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:53:47] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:53:47,998 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:53:47] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:53:52,496 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-06-11 14:53:52,498 - handlers.base_handler - INFO - AI order confirmed. Cart: {'Smoky Jollof Fiesta': {'item_id': 'smoky_jollof_fiesta', 'quantity': 4, 'price': 1500, 'total_price': 6000, 'variations': {}}, 'Egusi Soup': {'item_id': 'egusi_soup', 'quantity': 3, 'price': 1200, 'total_price': 3600, 'variations': {}}, 'Suya-Spiced Chicken Platter': {'item_id': 'suya_spiced_chicken_platter', 'quantity': 3, 'price': 1600, 'total_price': 4800, 'variations': {}}}. Redirecting to order handler.
2025-06-11 14:53:52,498 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'order_handler' with message 'process_final_order'.
2025-06-11 14:53:52,499 - handlers.order_handler - INFO - AI initiated order processing for session 2348055614455.
2025-06-11 14:53:52,499 - handlers.order_handler - INFO - Address set, proceeding to confirm order for AI-initiated session 2348055614455.
2025-06-11 14:53:52,499 - handlers.order_handler - INFO - Showing final order confirmation for session 2348055614455. Total: ₦14,400.00
2025-06-11 14:53:52,503 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦14,400 (3 items)
2025-06-11 14:53:52,503 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦14,400.00
2025-06-11 14:53:53,436 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjU0NDM0RkZFODJGNTFEMkVBRAA="}]}
2025-06-11 14:53:53,437 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:53:53] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:53:54,374 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:53:54] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:53:54,637 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:53:54] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:53:55,217 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:53:55] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:53:59,787 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'final_confirm'}
2025-06-11 14:53:59,789 - handlers.order_handler - INFO - Order ORDER_20250611_145359_85041f68 confirmed for session 2348055614455. Amount: ₦14,400.00
2025-06-11 14:53:59,794 - services.lead_tracker - INFO - Order completion tracked for 2348055614455: ORDER_20250611_145359_85041f68 (₦14,400)
2025-06-11 14:53:59,794 - handlers.lead_tracking_handler - INFO - 💰 Conversion tracked: 2348055614455 - ORDER_20250611_145359_85041f68 (₦14,400)
2025-06-11 14:53:59,795 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'payment_handler' with message 'initiate_payment'.
2025-06-11 14:53:59,795 - handlers.base_handler - INFO - Handling payment processing for session 2348055614455, message: initiate_payment
2025-06-11 14:53:59,796 - handlers.base_handler - INFO - Creating payment link for session 2348055614455
2025-06-11 14:53:59,807 - utils.data_manager - INFO - Order details saved to data\orders.json
2025-06-11 14:53:59,807 - services.payment_service - INFO - Attempting to create payment link for reference: PAY-ORDER-20250611145359-1663 with amount: 1440000, email: ziga4455@foodorder.com
2025-06-11 14:54:01,045 - services.payment_service - INFO - Payment link created for Ziga Ziga (2348055614455), URL: https://checkout.paystack.com/si9yh6yalv6gqi3
2025-06-11 14:54:01,046 - handlers.base_handler - INFO - Starting payment monitoring for order ORDER-20250611145359-1663, reference PAY-ORDER-20250611145359-1663
2025-06-11 14:54:01,046 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-ORDER-20250611145359-1663
2025-06-11 14:54:02,958 - services.payment_service - WARNING - Payment not successful for reference PAY-ORDER-20250611145359-1663. Paystack status: abandoned. Response: {'status': True, 'message': 'Verification successful', 'data': {'id': 5048348248, 'domain': 'test', 'status': 'abandoned', 'reference': 'PAY-ORDER-20250611145359-1663', 'receipt_number': None, 'amount': 1440000, 'message': None, 'gateway_response': 'The transaction was not completed', 'paid_at': None, 'created_at': '2025-06-11T13:54:00.000Z', 'channel': 'card', 'currency': 'NGN', 'ip_address': '102.67.12.153, 172.70.91.72, 172.31.63.81', 'metadata': {'customer_name': 'Ziga', 'customer_phone': '2348055614455', 'first_name': 'Ziga', 'last_name': 'Ziga', 'order_id': 'ORDER-20250611145359-1663', 'delivery_address': 'Howson Wright'}, 'log': None, 'fees': None, 'fees_split': None, 'authorization': {}, 'customer': {'id': 276711440, 'first_name': None, 'last_name': None, 'email': 'ziga4455@foodorder.com', 'customer_code': 'CUS_bhkdpnbvcjqt55g', 'phone': None, 'metadata': None, 'risk_action': 'default', 'international_format_phone': None}, 'plan': None, 'split': {}, 'order_id': None, 'paidAt': None, 'createdAt': '2025-06-11T13:54:00.000Z', 'requested_amount': 1440000, 'pos_transaction_data': None, 'source': None, 'fees_breakdown': None, 'connect': None, 'transaction_date': '2025-06-11T13:54:00.000Z', 'plan_object': {}, 'subaccount': {}}}
2025-06-11 14:54:02,958 - handlers.base_handler - INFO - Payment not yet verified for order ORDER-20250611145359-1663, attempt 1/15
2025-06-11 14:54:02,959 - handlers.base_handler - INFO - Payment link created successfully for order ORDER-20250611145359-1663
2025-06-11 14:54:02,962 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦14,400 (3 items)
2025-06-11 14:54:02,962 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦14,400.00
2025-06-11 14:54:03,987 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkRBQTk3NTEzRUJCODc1Nzg0NgA="}]}
2025-06-11 14:54:03,987 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:54:03] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:54:05,018 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:54:05] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:54:05,317 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:54:05] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:54:05,621 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:54:05] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:54:18,892 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Paid'}
2025-06-11 14:54:18,894 - handlers.base_handler - INFO - Received 'paid' command for session 2348055614455, attempting manual verification for ref: PAY-ORDER-20250611145359-1663
2025-06-11 14:54:18,895 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-ORDER-20250611145359-1663
2025-06-11 14:54:19,386 - services.payment_service - INFO - Payment verified successfully for reference PAY-ORDER-20250611145359-1663. Status: success
2025-06-11 14:54:19,387 - handlers.base_handler - INFO - Manual payment verification successful for order ORDER-20250611145359-1663
2025-06-11 14:54:19,388 - handlers.base_handler - INFO - Payment monitoring stopped for session 2348055614455
2025-06-11 14:54:19,393 - utils.data_manager - INFO - Order details saved to data\orders.json
2025-06-11 14:54:19,406 - services.lead_tracker - INFO - Order completion tracked for 2348055614455: ORDER-20250611145359-1663 (₦14,400)
2025-06-11 14:54:19,407 - handlers.lead_tracking_handler - INFO - 💰 Conversion tracked: 2348055614455 - ORDER-20250611145359-1663 (₦14,400)
2025-06-11 14:54:19,407 - handlers.feedback_handler - INFO - Initiated feedback collection for order ORDER-20250611145359-1663, session 2348055614455
2025-06-11 14:54:20,006 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 400 Client Error: Bad Request for url: https://graph.facebook.com/v17.0/608867502309431/messages - {"error":{"message":"(#100) The parameter messaging_product is required.","type":"OAuthException","code":100,"fbtrace_id":"ALR1kCXb-G1oDhWezAco73V"}}
2025-06-11 14:54:20,007 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:54:20] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:59:39,956 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-11 14:59:39,957 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 14:59:39,957 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 14:59:39,958 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 14:59:39,959 - services.payment_service - INFO - PaymentService initialized
2025-06-11 14:59:39,959 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 14:59:39,960 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 14:59:39,961 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 14:59:39,961 - services.payment_service - INFO - PaymentService initialized
2025-06-11 14:59:39,961 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-11 14:59:39,961 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-11 14:59:39,962 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-11 14:59:39,963 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 14:59:39,963 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-11 14:59:39,963 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-11 14:59:40,328 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-11 14:59:40,328 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-11 14:59:40,328 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-11 14:59:40,329 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 14:59:40,346 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-11 14:59:40,346 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-11 14:59:48,915 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-11 14:59:48,915 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-11 14:59:48,918 - handlers.base_handler - INFO - Session 2348055614455 initialized with greeting state for user 'Ziga'.
2025-06-11 14:59:49,887 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjdBNzlGMENEMzBFN0VCRjJENAA="}]}
2025-06-11 14:59:49,888 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:59:49] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:59:50,700 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:59:50] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:59:51,639 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:59:51] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:59:53,707 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_assistant'}
2025-06-11 14:59:53,709 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_assistant' in greeting state for session 2348055614455.
2025-06-11 14:59:53,710 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI menu.
2025-06-11 14:59:53,710 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'initial_entry'.
2025-06-11 14:59:53,710 - handlers.base_handler - INFO - AIHandler: Handling message 'initial_entry' in AI menu state for session 2348055614455. Original: 'ai_assistant'
2025-06-11 14:59:57,427 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkY4NzY1NTE2MzZENEI3RTkxQQA="}]}
2025-06-11 14:59:57,428 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:59:57] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:59:58,441 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:59:58] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:59:58,758 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:59:58] "POST /webhook HTTP/1.1" 200 -
2025-06-11 14:59:59,028 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 14:59:59] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:00:00,436 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order'}
2025-06-11 15:00:00,438 - handlers.base_handler - INFO - AIHandler: Handling message 'ai_bulk_order' in AI menu state for session 2348055614455. Original: 'ai_bulk_order'
2025-06-11 15:00:01,455 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjM2QURBMUEyQTQ1ODcwMEMyOQA="}]}
2025-06-11 15:00:01,456 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:00:01] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:00:02,349 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:00:02] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:00:02,775 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:00:02] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:00:03,127 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:00:03] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:00:10,660 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': '3 puff puff'}
2025-06-11 15:00:10,663 - handlers.base_handler - INFO - AIHandler: Handling message '3 puff puff' in AI bulk order state for session 2348055614455. Original: '3 puff puff'
2025-06-11 15:00:14,032 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-11 15:00:15,025 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjA1MTQzM0I3QTg4RDRCRjEzRAA="}]}
2025-06-11 15:00:15,026 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:00:15] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:00:16,934 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:00:16] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:00:16,935 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:00:16] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:00:18,046 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-06-11 15:00:18,049 - handlers.base_handler - INFO - AI order confirmed. Cart: {'Puff Puff': {'item_id': 'Puff Puff', 'quantity': 3, 'price': 200, 'total_price': 600, 'variations': {}}}. Redirecting to order handler.
2025-06-11 15:00:18,049 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'order_handler' with message 'process_final_order'.
2025-06-11 15:00:18,050 - handlers.order_handler - INFO - AI initiated order processing for session 2348055614455.
2025-06-11 15:00:18,050 - handlers.order_handler - INFO - Address set, proceeding to confirm order for AI-initiated session 2348055614455.
2025-06-11 15:00:18,051 - handlers.order_handler - INFO - Showing final order confirmation for session 2348055614455. Total: ₦600.00
2025-06-11 15:00:18,054 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦600 (1 items)
2025-06-11 15:00:18,054 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦600.00
2025-06-11 15:00:19,094 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjExRjVFQUU5ODY5RkIxRkI5QwA="}]}
2025-06-11 15:00:19,095 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:00:19] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:00:20,146 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:00:20] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:00:20,216 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:00:20] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:00:20,597 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:00:20] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:00:23,163 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'final_confirm'}
2025-06-11 15:00:23,165 - handlers.order_handler - INFO - Order ORDER_20250611_150023_e685f157 confirmed for session 2348055614455. Amount: ₦600.00
2025-06-11 15:00:23,168 - services.lead_tracker - INFO - Order completion tracked for 2348055614455: ORDER_20250611_150023_e685f157 (₦600)
2025-06-11 15:00:23,169 - handlers.lead_tracking_handler - INFO - 💰 Conversion tracked: 2348055614455 - ORDER_20250611_150023_e685f157 (₦600)
2025-06-11 15:00:23,169 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'payment_handler' with message 'initiate_payment'.
2025-06-11 15:00:23,169 - handlers.base_handler - INFO - Handling payment processing for session 2348055614455, message: initiate_payment
2025-06-11 15:00:23,170 - handlers.base_handler - INFO - Creating payment link for session 2348055614455
2025-06-11 15:00:23,180 - utils.data_manager - INFO - Order details saved to data\orders.json
2025-06-11 15:00:23,180 - services.payment_service - INFO - Attempting to create payment link for reference: PAY-ORDER-20250611150023-2716 with amount: 60000, email: ziga4455@foodorder.com
2025-06-11 15:00:23,916 - services.payment_service - INFO - Payment link created for Ziga Ziga (2348055614455), URL: https://checkout.paystack.com/fsujlrvjnsxkqmg
2025-06-11 15:00:23,916 - handlers.base_handler - INFO - Starting payment monitoring for order ORDER-20250611150023-2716, reference PAY-ORDER-20250611150023-2716
2025-06-11 15:00:23,917 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-ORDER-20250611150023-2716
2025-06-11 15:00:25,118 - services.payment_service - WARNING - Payment not successful for reference PAY-ORDER-20250611150023-2716. Paystack status: abandoned. Response: {'status': True, 'message': 'Verification successful', 'data': {'id': 5048359429, 'domain': 'test', 'status': 'abandoned', 'reference': 'PAY-ORDER-20250611150023-2716', 'receipt_number': None, 'amount': 60000, 'message': None, 'gateway_response': 'The transaction was not completed', 'paid_at': None, 'created_at': '2025-06-11T14:00:23.000Z', 'channel': 'card', 'currency': 'NGN', 'ip_address': '102.67.12.153, 172.70.90.28, 172.31.62.52', 'metadata': {'customer_name': 'Ziga', 'customer_phone': '2348055614455', 'first_name': 'Ziga', 'last_name': 'Ziga', 'order_id': 'ORDER-20250611150023-2716', 'delivery_address': 'Howson Wright'}, 'log': None, 'fees': None, 'fees_split': None, 'authorization': {}, 'customer': {'id': 276711440, 'first_name': None, 'last_name': None, 'email': 'ziga4455@foodorder.com', 'customer_code': 'CUS_bhkdpnbvcjqt55g', 'phone': None, 'metadata': None, 'risk_action': 'default', 'international_format_phone': None}, 'plan': None, 'split': {}, 'order_id': None, 'paidAt': None, 'createdAt': '2025-06-11T14:00:23.000Z', 'requested_amount': 60000, 'pos_transaction_data': None, 'source': None, 'fees_breakdown': None, 'connect': None, 'transaction_date': '2025-06-11T14:00:23.000Z', 'plan_object': {}, 'subaccount': {}}}
2025-06-11 15:00:25,119 - handlers.base_handler - INFO - Payment not yet verified for order ORDER-20250611150023-2716, attempt 1/15
2025-06-11 15:00:25,120 - handlers.base_handler - INFO - Payment link created successfully for order ORDER-20250611150023-2716
2025-06-11 15:00:25,122 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦600 (1 items)
2025-06-11 15:00:25,123 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦600.00
2025-06-11 15:00:26,087 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkI0MTI2QTc0RjFGNDZDMjdCQgA="}]}
2025-06-11 15:00:26,088 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:00:26] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:00:27,409 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:00:27] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:00:27,411 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:00:27] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:00:27,561 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:00:27] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:00:43,061 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Paid'}
2025-06-11 15:00:43,063 - handlers.base_handler - INFO - Received 'paid' command for session 2348055614455, attempting manual verification for ref: PAY-ORDER-20250611150023-2716
2025-06-11 15:00:43,064 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-ORDER-20250611150023-2716
2025-06-11 15:00:43,646 - services.payment_service - INFO - Payment verified successfully for reference PAY-ORDER-20250611150023-2716. Status: success
2025-06-11 15:00:43,647 - handlers.base_handler - INFO - Manual payment verification successful for order ORDER-20250611150023-2716
2025-06-11 15:00:43,648 - handlers.base_handler - INFO - Payment monitoring stopped for session 2348055614455
2025-06-11 15:00:43,654 - utils.data_manager - INFO - Order details saved to data\orders.json
2025-06-11 15:00:43,656 - services.lead_tracker - INFO - Order completion tracked for 2348055614455: ORDER-20250611150023-2716 (₦600)
2025-06-11 15:00:43,656 - handlers.lead_tracking_handler - INFO - 💰 Conversion tracked: 2348055614455 - ORDER-20250611150023-2716 (₦600)
2025-06-11 15:00:43,657 - handlers.feedback_handler - INFO - Initiated feedback collection for order ORDER-20250611150023-2716, session 2348055614455
2025-06-11 15:00:45,799 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 400 Client Error: Bad Request for url: https://graph.facebook.com/v17.0/608867502309431/messages - {"error":{"message":"(#100) The parameter messaging_product is required.","type":"OAuthException","code":100,"fbtrace_id":"A2fjgmsKENCIBTWp1dZ6yhK"}}
2025-06-11 15:00:45,799 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:00:45] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:15:25,192 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-11 15:15:25,193 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 15:15:25,193 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 15:15:25,194 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 15:15:25,194 - services.payment_service - INFO - PaymentService initialized
2025-06-11 15:15:25,194 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 15:15:25,195 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 15:15:25,195 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 15:15:25,195 - services.payment_service - INFO - PaymentService initialized
2025-06-11 15:15:25,196 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-11 15:15:25,196 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-11 15:15:25,197 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-11 15:15:25,197 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 15:15:25,197 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-11 15:15:25,197 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-11 15:15:25,586 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-11 15:15:25,586 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-11 15:15:25,587 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-11 15:15:25,587 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 15:15:25,614 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-11 15:15:25,614 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-11 15:15:34,528 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-11 15:15:34,529 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-11 15:15:34,543 - handlers.base_handler - INFO - Session 2348055614455 initialized with greeting state for user 'Ziga'.
2025-06-11 15:15:35,814 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjVDRjVGRkYyQkZDQ0Q4MkZBNQA="}]}
2025-06-11 15:15:36,758 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:15:36] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:15:37,311 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:15:37] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:15:37,369 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 400 Client Error: Bad Request for url: https://graph.facebook.com/v17.0/608867502309431/messages - {"error":{"message":"(#100) Unexpected key \"input\" on param \"contacts[0]\".","type":"OAuthException","code":100,"fbtrace_id":"A1FOB_Vd7h41hruG_WH5xJY"}}
2025-06-11 15:15:37,369 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:15:37] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:15:39,004 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_assistant'}
2025-06-11 15:15:39,006 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_assistant' in greeting state for session 2348055614455.
2025-06-11 15:15:39,006 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI menu.
2025-06-11 15:15:39,007 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'initial_entry'.
2025-06-11 15:15:39,007 - handlers.base_handler - INFO - AIHandler: Handling message 'initial_entry' in AI menu state for session 2348055614455. Original: 'ai_assistant'
2025-06-11 15:15:39,901 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjU2ODFFOTgxNzQyMzE5MDczOAA="}]}
2025-06-11 15:15:40,357 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 400 Client Error: Bad Request for url: https://graph.facebook.com/v17.0/608867502309431/messages - {"error":{"message":"(#100) Unexpected key \"input\" on param \"contacts[0]\".","type":"OAuthException","code":100,"fbtrace_id":"AflCshPGB0FWfdax9PnbRp3"}}
2025-06-11 15:15:40,358 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:15:40] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:15:40,942 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:15:40] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:15:41,196 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:15:41] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:15:41,451 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:15:41] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:15:42,596 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order'}
2025-06-11 15:15:42,598 - handlers.base_handler - INFO - AIHandler: Handling message 'ai_bulk_order' in AI menu state for session 2348055614455. Original: 'ai_bulk_order'
2025-06-11 15:15:43,563 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkFDMkI1MzEwMkU0NzY4RjE5RAA="}]}
2025-06-11 15:15:44,029 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 400 Client Error: Bad Request for url: https://graph.facebook.com/v17.0/608867502309431/messages - {"error":{"message":"(#100) Unexpected key \"input\" on param \"contacts[0]\".","type":"OAuthException","code":100,"fbtrace_id":"Aikv4-_dLxqfeZlDfOwznJ_"}}
2025-06-11 15:15:44,030 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:15:44] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:15:44,536 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:15:44] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:15:44,975 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:15:44] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:15:45,096 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:15:45] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:15:51,624 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Puff puff'}
2025-06-11 15:15:51,626 - handlers.base_handler - INFO - AIHandler: Handling message 'puff puff' in AI bulk order state for session 2348055614455. Original: 'Puff puff'
2025-06-11 15:15:54,122 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-11 15:15:55,017 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjZERTFENDI0RTQ3REZBNTNCQwA="}]}
2025-06-11 15:15:55,491 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 400 Client Error: Bad Request for url: https://graph.facebook.com/v17.0/608867502309431/messages - {"error":{"message":"(#100) Unexpected key \"input\" on param \"contacts[0]\".","type":"OAuthException","code":100,"fbtrace_id":"A7SefOQrIPjchZNPOI7hPG-"}}
2025-06-11 15:15:55,491 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:15:55] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:15:55,915 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:15:55] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:15:56,296 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:15:56] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:15:56,649 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:15:56] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:15:57,753 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-06-11 15:15:57,755 - handlers.base_handler - INFO - AI order confirmed. Cart: {'Puff Puff': {'item_id': 'Puff Puff', 'quantity': 1, 'price': 200, 'total_price': 200, 'variations': {}}}. Redirecting to order handler.
2025-06-11 15:15:57,755 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'order_handler' with message 'process_final_order'.
2025-06-11 15:15:57,756 - handlers.order_handler - INFO - AI initiated order processing for session 2348055614455.
2025-06-11 15:15:57,756 - handlers.order_handler - INFO - Address set, proceeding to confirm order for AI-initiated session 2348055614455.
2025-06-11 15:15:57,757 - handlers.order_handler - INFO - Showing final order confirmation for session 2348055614455. Total: ₦200.00
2025-06-11 15:15:58,750 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkZGMjU0NDk1NzE5RUUzNUM5OAA="}]}
2025-06-11 15:15:58,766 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦200 (1 items)
2025-06-11 15:15:58,766 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦200.00
2025-06-11 15:15:59,222 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 400 Client Error: Bad Request for url: https://graph.facebook.com/v17.0/608867502309431/messages - {"error":{"message":"(#100) Unexpected key \"input\" on param \"contacts[0]\".","type":"OAuthException","code":100,"fbtrace_id":"AskPXgxlF2MWFcLeiy9rb0T"}}
2025-06-11 15:15:59,223 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:15:59] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:15:59,594 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:15:59] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:16:00,350 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:16:00] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:16:01,391 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'final_confirm'}
2025-06-11 15:16:01,394 - handlers.order_handler - INFO - Order ORDER_20250611_151601_24545059 confirmed for session 2348055614455. Amount: ₦200.00
2025-06-11 15:16:01,397 - services.lead_tracker - INFO - Order completion tracked for 2348055614455: ORDER_20250611_151601_24545059 (₦200)
2025-06-11 15:16:01,397 - handlers.lead_tracking_handler - INFO - 💰 Conversion tracked: 2348055614455 - ORDER_20250611_151601_24545059 (₦200)
2025-06-11 15:16:01,398 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'payment_handler' with message 'initiate_payment'.
2025-06-11 15:16:01,398 - handlers.base_handler - INFO - Handling payment processing for session 2348055614455, message: initiate_payment
2025-06-11 15:16:01,399 - handlers.base_handler - INFO - Creating payment link for session 2348055614455
2025-06-11 15:16:01,409 - utils.data_manager - INFO - Order details saved to data\orders.json
2025-06-11 15:16:01,409 - services.payment_service - INFO - Attempting to create payment link for reference: PAY-ORDER-20250611151601-5899 with amount: 20000, email: ziga4455@foodorder.com
2025-06-11 15:16:03,083 - services.payment_service - INFO - Payment link created for Ziga Ziga (2348055614455), URL: https://checkout.paystack.com/8mzn05eyhooe2qg
2025-06-11 15:16:03,084 - handlers.base_handler - INFO - Starting payment monitoring for order ORDER-20250611151601-5899, reference PAY-ORDER-20250611151601-5899
2025-06-11 15:16:03,084 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-ORDER-20250611151601-5899
2025-06-11 15:16:03,717 - services.payment_service - WARNING - Payment not successful for reference PAY-ORDER-20250611151601-5899. Paystack status: abandoned. Response: {'status': True, 'message': 'Verification successful', 'data': {'id': 5048389579, 'domain': 'test', 'status': 'abandoned', 'reference': 'PAY-ORDER-20250611151601-5899', 'receipt_number': None, 'amount': 20000, 'message': None, 'gateway_response': 'The transaction was not completed', 'paid_at': None, 'created_at': '2025-06-11T14:16:02.000Z', 'channel': 'card', 'currency': 'NGN', 'ip_address': '102.67.12.153, 172.69.194.62, 172.31.63.81', 'metadata': {'customer_name': 'Ziga', 'customer_phone': '2348055614455', 'first_name': 'Ziga', 'last_name': 'Ziga', 'order_id': 'ORDER-20250611151601-5899', 'delivery_address': 'Howson Wright'}, 'log': None, 'fees': None, 'fees_split': None, 'authorization': {}, 'customer': {'id': 276711440, 'first_name': None, 'last_name': None, 'email': 'ziga4455@foodorder.com', 'customer_code': 'CUS_bhkdpnbvcjqt55g', 'phone': None, 'metadata': None, 'risk_action': 'default', 'international_format_phone': None}, 'plan': None, 'split': {}, 'order_id': None, 'paidAt': None, 'createdAt': '2025-06-11T14:16:02.000Z', 'requested_amount': 20000, 'pos_transaction_data': None, 'source': None, 'fees_breakdown': None, 'connect': None, 'transaction_date': '2025-06-11T14:16:02.000Z', 'plan_object': {}, 'subaccount': {}}}
2025-06-11 15:16:03,718 - handlers.base_handler - INFO - Payment not yet verified for order ORDER-20250611151601-5899, attempt 1/15
2025-06-11 15:16:03,719 - handlers.base_handler - INFO - Payment link created successfully for order ORDER-20250611151601-5899
2025-06-11 15:16:04,699 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkJGQjQwREYxOTk0MDMzMjFENwA="}]}
2025-06-11 15:16:04,702 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦200 (1 items)
2025-06-11 15:16:04,702 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦200.00
2025-06-11 15:16:05,160 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 400 Client Error: Bad Request for url: https://graph.facebook.com/v17.0/608867502309431/messages - {"error":{"message":"(#100) Unexpected key \"input\" on param \"contacts[0]\".","type":"OAuthException","code":100,"fbtrace_id":"APPoXnGl6Th3MCIJlnMv49g"}}
2025-06-11 15:16:05,161 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:16:05] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:16:05,458 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:16:05] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:16:05,956 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:16:05] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:16:06,174 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:16:06] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:16:18,527 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Paid'}
2025-06-11 15:16:18,529 - handlers.base_handler - INFO - Received 'paid' command for session 2348055614455, attempting manual verification for ref: PAY-ORDER-20250611151601-5899
2025-06-11 15:16:18,530 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-ORDER-20250611151601-5899
2025-06-11 15:16:19,147 - services.payment_service - INFO - Payment verified successfully for reference PAY-ORDER-20250611151601-5899. Status: success
2025-06-11 15:16:19,148 - handlers.base_handler - INFO - Manual payment verification successful for order ORDER-20250611151601-5899
2025-06-11 15:16:19,149 - handlers.base_handler - INFO - Payment monitoring stopped for session 2348055614455
2025-06-11 15:16:19,156 - utils.data_manager - INFO - Order details saved to data\orders.json
2025-06-11 15:16:19,159 - services.lead_tracker - INFO - Order completion tracked for 2348055614455: ORDER-20250611151601-5899 (₦200)
2025-06-11 15:16:19,160 - handlers.lead_tracking_handler - INFO - 💰 Conversion tracked: 2348055614455 - ORDER-20250611151601-5899 (₦200)
2025-06-11 15:16:20,319 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQxM0U2NjAzMUVDMkMzQTVENAA="}]}
2025-06-11 15:16:20,320 - handlers.base_handler - ERROR - Error initiating feedback collection for order ORDER-20250611151601-5899: FeedbackHandler.initiate_feedback_request() takes 3 positional arguments but 4 were given
2025-06-11 15:16:20,978 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 400 Client Error: Bad Request for url: https://graph.facebook.com/v17.0/608867502309431/messages - {"error":{"message":"(#100) The parameter messaging_product is required.","type":"OAuthException","code":100,"fbtrace_id":"AcTsBBZvJ62PQwmj4ISttJh"}}
2025-06-11 15:16:20,979 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:16:20] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:16:21,135 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:16:21] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:16:21,854 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:16:21] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:22:39,150 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-11 15:22:39,150 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 15:22:39,151 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 15:22:39,151 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 15:22:39,152 - services.payment_service - INFO - PaymentService initialized
2025-06-11 15:22:39,152 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=1800s
2025-06-11 15:22:39,152 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 15:22:39,153 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 15:22:39,153 - services.payment_service - INFO - PaymentService initialized
2025-06-11 15:22:39,153 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-11 15:22:39,153 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-11 15:22:39,154 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-11 15:22:39,154 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 15:22:39,154 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-11 15:22:39,154 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-11 15:22:39,551 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-11 15:22:39,551 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-11 15:22:39,551 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-11 15:22:39,551 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 15:22:39,564 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-11 15:22:39,564 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-11 15:22:59,060 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-11 15:22:59,060 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-11 15:22:59,064 - handlers.base_handler - INFO - Session 2348055614455 initialized with greeting state for user 'Ziga'.
2025-06-11 15:22:59,066 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Ziga! 👋\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order', 'title': '🛒 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_assistant', 'title': '🤖 AI Assistant'}}, {'type': 'reply', 'reply': {'id': 'others', 'title': '⚙️ Others'}}]}}}
2025-06-11 15:23:00,095 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjRENEFGQzVDRUU5MjEzMEIyRAA="}]}
2025-06-11 15:23:00,095 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjRENEFGQzVDRUU5MjEzMEIyRAA='}]}
2025-06-11 15:23:00,580 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 400 Client Error: Bad Request for url: https://graph.facebook.com/v17.0/608867502309431/messages - {"error":{"message":"(#100) Unexpected key \"input\" on param \"contacts[0]\".","type":"OAuthException","code":100,"fbtrace_id":"A5suyyrPQcwRdjduhds1tcT"}}
2025-06-11 15:23:00,581 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:23:00] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:23:01,132 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:23:01] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:23:01,402 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:23:01] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:23:01,762 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:23:01] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:23:07,409 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_assistant'}
2025-06-11 15:23:07,413 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_assistant' in greeting state for session 2348055614455.
2025-06-11 15:23:07,414 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI menu.
2025-06-11 15:23:07,414 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'initial_entry'.
2025-06-11 15:23:07,415 - handlers.base_handler - INFO - AIHandler: Handling message 'initial_entry' in AI menu state for session 2348055614455. Original: 'ai_assistant'
2025-06-11 15:23:07,415 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🤖 *AI Assistant Options*\n\n🤖 *Lola Chatbot* - Chat with our AI assistant\n🛒 *AI Bulk Order* - Order multiple items at once\n\nPlease select an AI option:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'lola_chatbot', 'title': '🤖 Lola Chatbot'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order', 'title': '🛒 AI Bulk Order'}}, {'type': 'reply', 'reply': {'id': 'back_to_main', 'title': '🔙 Back to Main'}}]}}}
2025-06-11 15:23:08,450 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkIxOENGREM3Q0JDNTU5REMzNgA="}]}
2025-06-11 15:23:08,451 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkIxOENGREM3Q0JDNTU5REMzNgA='}]}
2025-06-11 15:23:08,931 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 400 Client Error: Bad Request for url: https://graph.facebook.com/v17.0/608867502309431/messages - {"error":{"message":"(#100) Unexpected key \"input\" on param \"contacts[0]\".","type":"OAuthException","code":100,"fbtrace_id":"ADb-taxXTWCde1rWwS_LPPK"}}
2025-06-11 15:23:08,932 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:23:08] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:23:09,545 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:23:09] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:23:09,920 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:23:09] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:23:10,094 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:23:10] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:23:11,532 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order'}
2025-06-11 15:23:11,533 - handlers.base_handler - INFO - AIHandler: Handling message 'ai_bulk_order' in AI menu state for session 2348055614455. Original: 'ai_bulk_order'
2025-06-11 15:23:11,534 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': '🛒 *AI Bulk Order Assistant*\n\nTell me everything you want to order in one message! For example:\n\n_"2 chief burgers with drinks, 3 jollof rice with chicken, large fries and 4 cokes"_\n\nI\'ll understand your order and help you confirm it! 🚀\n\n_Type \'menu\' to go back to the main menu_'}}
2025-06-11 15:23:12,774 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkQwNEZEREE3RjUxRDMyQTA3RgA="}]}
2025-06-11 15:23:12,775 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkQwNEZEREE3RjUxRDMyQTA3RgA='}]}
2025-06-11 15:23:13,556 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 400 Client Error: Bad Request for url: https://graph.facebook.com/v17.0/608867502309431/messages - {"error":{"message":"(#100) Unexpected key \"input\" on param \"contacts[0]\".","type":"OAuthException","code":100,"fbtrace_id":"AYsRG0ZVtmhv5tuMHD0QqMj"}}
2025-06-11 15:23:13,557 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:23:13] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:23:13,730 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:23:13] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:23:14,019 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:23:14] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:23:14,326 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:23:14] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:23:36,444 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': '4 puff puff'}
2025-06-11 15:23:36,446 - handlers.base_handler - INFO - AIHandler: Handling message '4 puff puff' in AI bulk order state for session 2348055614455. Original: '4 puff puff'
2025-06-11 15:23:38,922 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-11 15:23:38,924 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🛒 *Order Summary:*\n\n✅ 4x Puff Puff - ₦800\n\n*Total: ₦800.00*\n\nWould you like to proceed with this order?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'confirm_ai_order', 'title': '✅ Confirm Order'}}, {'type': 'reply', 'reply': {'id': 'modify_ai_order', 'title': '✏️ Modify Order'}}, {'type': 'reply', 'reply': {'id': 'cancel_ai_order', 'title': '❌ Cancel'}}]}}}
2025-06-11 15:23:40,007 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjY1MkVEQTIxRDlFNUEyREY5RQA="}]}
2025-06-11 15:23:40,007 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjY1MkVEQTIxRDlFNUEyREY5RQA='}]}
2025-06-11 15:23:40,496 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 400 Client Error: Bad Request for url: https://graph.facebook.com/v17.0/608867502309431/messages - {"error":{"message":"(#100) Unexpected key \"input\" on param \"contacts[0]\".","type":"OAuthException","code":100,"fbtrace_id":"AKbA0RI9KOepX7CDPJCMOHj"}}
2025-06-11 15:23:40,497 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:23:40] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:23:40,793 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:23:40] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:23:41,481 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:23:41] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:23:42,310 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-06-11 15:23:42,312 - handlers.base_handler - INFO - AI order confirmed. Cart: {'Puff Puff': {'item_id': 'Puff Puff', 'quantity': 4, 'price': 200, 'total_price': 800, 'variations': {}}}. Redirecting to order handler.
2025-06-11 15:23:42,313 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'order_handler' with message 'process_final_order'.
2025-06-11 15:23:42,313 - handlers.order_handler - INFO - AI initiated order processing for session 2348055614455.
2025-06-11 15:23:42,314 - handlers.order_handler - INFO - Address set, proceeding to confirm order for AI-initiated session 2348055614455.
2025-06-11 15:23:42,314 - handlers.order_handler - INFO - Showing final order confirmation for session 2348055614455. Total: ₦800.00
2025-06-11 15:23:42,314 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🛒 *Final Order Confirmation*\n\n📋 *Items Ordered:*\n• 4x Puff Puff - ₦800.00\n\n📍 *Delivery Details:*\n👤 Name: Ziga\n📱 Phone: 2348055614455\n🏠 Address: Howson Wright\n\n💰 *Total Amount: ₦800.00*\n\nPlease confirm to proceed with payment.'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'final_confirm', 'title': '✅ Confirm & Pay'}}, {'type': 'reply', 'reply': {'id': 'edit_order', 'title': '✏️ Edit Order'}}, {'type': 'reply', 'reply': {'id': 'cancel_order', 'title': '❌ Cancel Order'}}]}}}
2025-06-11 15:23:43,340 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjBDNjEzQ0QzQTU4NzZBNjAzNAA="}]}
2025-06-11 15:23:43,343 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦800 (1 items)
2025-06-11 15:23:43,344 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦800.00
2025-06-11 15:23:43,344 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjBDNjEzQ0QzQTU4NzZBNjAzNAA='}]}
2025-06-11 15:23:43,831 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 400 Client Error: Bad Request for url: https://graph.facebook.com/v17.0/608867502309431/messages - {"error":{"message":"(#100) Unexpected key \"input\" on param \"contacts[0]\".","type":"OAuthException","code":100,"fbtrace_id":"AO7Cy39ZwopxqumRTvHjEhi"}}
2025-06-11 15:23:43,832 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:23:43] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:23:44,100 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:23:44] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:23:44,581 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:23:44] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:23:44,832 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:23:44] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:23:45,512 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'final_confirm'}
2025-06-11 15:23:45,514 - handlers.order_handler - INFO - Order ORDER_20250611_152345_5e105a88 confirmed for session 2348055614455. Amount: ₦800.00
2025-06-11 15:23:45,518 - services.lead_tracker - INFO - Order completion tracked for 2348055614455: ORDER_20250611_152345_5e105a88 (₦800)
2025-06-11 15:23:45,518 - handlers.lead_tracking_handler - INFO - 💰 Conversion tracked: 2348055614455 - ORDER_20250611_152345_5e105a88 (₦800)
2025-06-11 15:23:45,519 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'payment_handler' with message 'initiate_payment'.
2025-06-11 15:23:45,519 - handlers.base_handler - INFO - Handling payment processing for session 2348055614455, message: initiate_payment
2025-06-11 15:23:45,519 - handlers.base_handler - INFO - Creating payment link for session 2348055614455
2025-06-11 15:23:45,528 - utils.data_manager - INFO - Order details saved to data\orders.json
2025-06-11 15:23:45,529 - services.payment_service - INFO - Attempting to create payment link for reference: PAY-ORDER-20250611152345-4911 with amount: 80000, email: ziga4455@foodorder.com
2025-06-11 15:23:46,112 - services.payment_service - INFO - Payment link created for Ziga Ziga (2348055614455), URL: https://checkout.paystack.com/jdtoofcys9it0mq
2025-06-11 15:23:46,112 - handlers.base_handler - INFO - Starting payment monitoring for order ORDER-20250611152345-4911, reference PAY-ORDER-20250611152345-4911
2025-06-11 15:23:46,113 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-ORDER-20250611152345-4911
2025-06-11 15:23:46,623 - services.payment_service - WARNING - Payment not successful for reference PAY-ORDER-20250611152345-4911. Paystack status: abandoned. Response: {'status': True, 'message': 'Verification successful', 'data': {'id': 5048402487, 'domain': 'test', 'status': 'abandoned', 'reference': 'PAY-ORDER-20250611152345-4911', 'receipt_number': None, 'amount': 80000, 'message': None, 'gateway_response': 'The transaction was not completed', 'paid_at': None, 'created_at': '2025-06-11T14:23:46.000Z', 'channel': 'card', 'currency': 'NGN', 'ip_address': '102.67.12.153, 141.101.99.79, 172.31.62.52', 'metadata': {'customer_name': 'Ziga', 'customer_phone': '2348055614455', 'first_name': 'Ziga', 'last_name': 'Ziga', 'order_id': 'ORDER-20250611152345-4911', 'delivery_address': 'Howson Wright'}, 'log': None, 'fees': None, 'fees_split': None, 'authorization': {}, 'customer': {'id': 276711440, 'first_name': None, 'last_name': None, 'email': 'ziga4455@foodorder.com', 'customer_code': 'CUS_bhkdpnbvcjqt55g', 'phone': None, 'metadata': None, 'risk_action': 'default', 'international_format_phone': None}, 'plan': None, 'split': {}, 'order_id': None, 'paidAt': None, 'createdAt': '2025-06-11T14:23:46.000Z', 'requested_amount': 80000, 'pos_transaction_data': None, 'source': None, 'fees_breakdown': None, 'connect': None, 'transaction_date': '2025-06-11T14:23:46.000Z', 'plan_object': {}, 'subaccount': {}}}
2025-06-11 15:23:46,624 - handlers.base_handler - INFO - Payment not yet verified for order ORDER-20250611152345-4911, attempt 1/15
2025-06-11 15:23:46,624 - handlers.base_handler - INFO - Payment link created successfully for order ORDER-20250611152345-4911
2025-06-11 15:23:46,625 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "🛒 *Order Created Successfully!*\n\n📋 *Order ID:* ORDER-20250611152345-4911\n💰 *Total:* ₦800\n\n💳 *Complete Payment:*\nhttps://checkout.paystack.com/jdtoofcys9it0mq\n\n✅ We'll automatically confirm your order once payment is received!\n💬 You can also send 'paid' after payment to check status immediately.\n\n⏰ Payment link expires in 15 minutes."}}
2025-06-11 15:23:47,601 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkFBRkUwRTZCNTIwRUZGNzYwQwA="}]}
2025-06-11 15:23:47,604 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦800 (1 items)
2025-06-11 15:23:47,604 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦800.00
2025-06-11 15:23:47,605 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkFBRkUwRTZCNTIwRUZGNzYwQwA='}]}
2025-06-11 15:23:48,102 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 400 Client Error: Bad Request for url: https://graph.facebook.com/v17.0/608867502309431/messages - {"error":{"message":"(#100) Unexpected key \"input\" on param \"contacts[0]\".","type":"OAuthException","code":100,"fbtrace_id":"ALsSKlYnEULtc_y_ZULoWNr"}}
2025-06-11 15:23:48,103 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:23:48] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:23:48,559 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:23:48] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:23:48,713 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:23:48] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:23:49,383 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:23:49] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:24:01,923 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Paid'}
2025-06-11 15:24:01,926 - handlers.base_handler - INFO - Received 'paid' command for session 2348055614455, attempting manual verification for ref: PAY-ORDER-20250611152345-4911
2025-06-11 15:24:01,926 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-ORDER-20250611152345-4911
2025-06-11 15:24:02,521 - services.payment_service - INFO - Payment verified successfully for reference PAY-ORDER-20250611152345-4911. Status: success
2025-06-11 15:24:02,522 - handlers.base_handler - INFO - Manual payment verification successful for order ORDER-20250611152345-4911
2025-06-11 15:24:02,523 - handlers.base_handler - INFO - Payment monitoring stopped for session 2348055614455
2025-06-11 15:24:02,529 - utils.data_manager - INFO - Order details saved to data\orders.json
2025-06-11 15:24:02,532 - services.lead_tracker - INFO - Order completion tracked for 2348055614455: ORDER-20250611152345-4911 (₦800)
2025-06-11 15:24:02,532 - handlers.lead_tracking_handler - INFO - 💰 Conversion tracked: 2348055614455 - ORDER-20250611152345-4911 (₦800)
2025-06-11 15:24:02,533 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "🎉 *Payment Confirmed!*\n\n📋 *Order ID:* ORDER-20250611152345-4911\n💰 *Amount Paid:* ₦800\n🛒 *Items:* 🛒 *Your Cart:*\n• 4 x Puff Puff (₦200) = ₦800\n\n💰 *Total: ₦800*\n🚚 *Delivery to:* Howson Wright\n\n✅ Your order is confirmed and being processed!\n📱 You'll receive delivery updates soon.\n\n🙏 Thank you for your purchase! 😊"}}
2025-06-11 15:24:03,451 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjU0QzUxQjQwNDFCRjNFM0JCMgA="}]}
2025-06-11 15:24:03,452 - handlers.feedback_handler - INFO - Initiated feedback collection for order ORDER-20250611152345-4911, session 2348055614455
2025-06-11 15:24:03,452 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🎉 *Thank you for your order!*\n\n📋 Order ID: ORDER-20250611152345-4911\n\n💬 *How was your ordering experience?*\nYour feedback helps us improve our service!'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'excellent', 'title': '🤩 Excellent'}}, {'type': 'reply', 'reply': {'id': 'good', 'title': '😊 Good'}}, {'type': 'reply', 'reply': {'id': 'bad', 'title': '😞 Bad'}}]}}}
2025-06-11 15:24:04,313 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:24:04] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:24:04,422 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkQ4NEMwMkIzNUJCQzE4MDY3MgA="}]}
2025-06-11 15:24:04,423 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'message': 'Payment confirmed and feedback initiated'}
2025-06-11 15:24:04,424 - services.whatsapp_service - WARNING - Added missing messaging_product to payload
2025-06-11 15:24:04,973 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:24:04] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:24:05,023 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 400 Client Error: Bad Request for url: https://graph.facebook.com/v17.0/608867502309431/messages - {"error":{"message":"The parameter to is required.","type":"OAuthException","code":100,"fbtrace_id":"A7h-nEYBL0wesS8yIwC8_Fu"}}
2025-06-11 15:24:05,024 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:24:05] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:24:05,267 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:24:05] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:24:05,765 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:24:05] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:24:05,963 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:24:05] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:24:09,891 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'excellent'}
2025-06-11 15:24:09,893 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "🤩 *Thank you for the excellent rating!*\n\n💬 Would you like to share any specific comments about your experience?\n\nType your message or 'skip' to finish."}}
2025-06-11 15:24:10,781 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjlDMzgwOEI4RjM0MjBERDQ1NAA="}]}
2025-06-11 15:24:10,782 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjlDMzgwOEI4RjM0MjBERDQ1NAA='}]}
2025-06-11 15:24:11,270 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 400 Client Error: Bad Request for url: https://graph.facebook.com/v17.0/608867502309431/messages - {"error":{"message":"(#100) Unexpected key \"input\" on param \"contacts[0]\".","type":"OAuthException","code":100,"fbtrace_id":"ALyMylnDzF83sz3oJYYi23O"}}
2025-06-11 15:24:11,270 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:24:11] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:24:11,531 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:24:11] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:24:12,060 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:24:12] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:24:12,493 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:24:12] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:25:06,051 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-11 15:25:06,055 - handlers.feedback_handler - INFO - Feedback saved to data/feedback.json
2025-06-11 15:25:06,055 - handlers.feedback_handler - INFO - Feedback saved for order ORDER-20250611152345-4911: excellent
2025-06-11 15:25:06,056 - handlers.base_handler - INFO - Session 2348055614455 returned to main menu (greeting state).
2025-06-11 15:25:06,056 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Ziga! 🙏 *Thank you for your Excellent feedback!*\n\nYour comments have been recorded and will help us improve.\n\nWe appreciate you choosing us! 😊'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '✨ Lola AI Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '⚙️ Others'}}]}}}
2025-06-11 15:25:07,431 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkU0RTQ3QkJDNDg0OTdFNDUyQwA="}]}
2025-06-11 15:25:07,431 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkU0RTQ3QkJDNDg0OTdFNDUyQwA='}]}
2025-06-11 15:25:07,912 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 400 Client Error: Bad Request for url: https://graph.facebook.com/v17.0/608867502309431/messages - {"error":{"message":"(#100) Unexpected key \"input\" on param \"contacts[0]\".","type":"OAuthException","code":100,"fbtrace_id":"AZJzE-2HXxMXWJBZZOcAAsI"}}
2025-06-11 15:25:07,913 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:25:07] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:25:08,092 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:25:08] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:25:08,603 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:25:08] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:25:16,721 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'others_menu'}
2025-06-11 15:25:16,725 - handlers.base_handler - INFO - GreetingHandler: Handling message 'others_menu' in greeting state for session 2348055614455.
2025-06-11 15:25:16,725 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🔧 *Other Options*\n\nHere are other ways I can help you:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'enquiry', 'title': '❓ Enquiry'}}, {'type': 'reply', 'reply': {'id': 'complain', 'title': '📝 Complain'}}, {'type': 'reply', 'reply': {'id': 'back_to_main', 'title': '🔙 Back'}}]}}}
2025-06-11 15:25:17,760 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjIxODg4MjJCODUxNjYzRDc0QgA="}]}
2025-06-11 15:25:17,761 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjIxODg4MjJCODUxNjYzRDc0QgA='}]}
2025-06-11 15:25:18,241 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 400 Client Error: Bad Request for url: https://graph.facebook.com/v17.0/608867502309431/messages - {"error":{"message":"(#100) Unexpected key \"input\" on param \"contacts[0]\".","type":"OAuthException","code":100,"fbtrace_id":"AxxnVarzcHkMb6FFnz8V4us"}}
2025-06-11 15:25:18,242 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:25:18] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:25:18,440 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:25:18] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:25:18,973 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:25:18] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:25:19,482 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:25:19] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:25:33,403 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'complain'}
2025-06-11 15:25:33,405 - handlers.message_processor - WARNING - No specific handler or state match for handler 'greeting_handler', state 'others_menu_selection', message 'complain' for session 2348055614455. Resetting to greeting.
2025-06-11 15:25:33,405 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "I'm sorry, I didn't quite understand that. Let's get back to the main menu."}}
2025-06-11 15:25:34,385 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjhERTlBRDgwMjUyQzM5RUNBNwA="}]}
2025-06-11 15:25:34,386 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Ziga! 👋\n\nPlease choose from the options below:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order', 'title': '🛒 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_assistant', 'title': '🤖 AI Assistant'}}, {'type': 'reply', 'reply': {'id': 'others', 'title': '⚙️ Others'}}]}}}
2025-06-11 15:25:35,352 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkFCRjM0ODExOTcwMEEzNUVERgA="}]}
2025-06-11 15:25:35,352 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkFCRjM0ODExOTcwMEEzNUVERgA='}]}
2025-06-11 15:25:35,420 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:25:35] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:25:35,740 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:25:35] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:25:35,845 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 400 Client Error: Bad Request for url: https://graph.facebook.com/v17.0/608867502309431/messages - {"error":{"message":"(#100) Unexpected key \"input\" on param \"contacts[0]\".","type":"OAuthException","code":100,"fbtrace_id":"AgISayeEkk0gz4KHV56ewzP"}}
2025-06-11 15:25:35,846 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:25:35] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:25:36,112 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:25:36] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:25:36,462 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:25:36] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:25:36,792 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:25:36] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:55:18,182 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-11 15:55:18,183 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-11 15:55:18,183 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 15:55:18,184 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 15:55:18,184 - services.payment_service - INFO - PaymentService initialized
2025-06-11 15:55:18,185 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-11 15:55:18,185 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 15:55:18,186 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 15:55:18,186 - services.payment_service - INFO - PaymentService initialized
2025-06-11 15:55:18,186 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-11 15:55:18,186 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-11 15:55:18,187 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-11 15:55:18,187 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 15:55:18,187 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-11 15:55:18,189 - handlers.order_tracking_handler - INFO - Created order status file: data/order_status.json
2025-06-11 15:55:18,189 - handlers.order_tracking_handler - INFO - OrderTrackingHandler initialized.
2025-06-11 15:55:18,190 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-11 15:55:18,548 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-11 15:55:18,548 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-11 15:55:18,549 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-11 15:55:18,549 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 15:55:18,566 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-11 15:55:18,566 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-11 15:55:28,051 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-11 15:55:28,052 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-11 15:55:28,056 - utils.data_manager - INFO - User details saved to data\user_details.json
2025-06-11 15:55:28,056 - handlers.base_handler - INFO - Session 2348055614455 initialized with greeting state for user 'Ziga'.
2025-06-11 15:55:28,057 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Ziga! 👋\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order', 'title': '🛒 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_assistant', 'title': '🤖 AI Assistant'}}, {'type': 'reply', 'reply': {'id': 'others', 'title': '⚙️ Others'}}]}}}
2025-06-11 15:55:29,235 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjhBQzc2RkU1NjAxMjAyNjk0MgA="}]}
2025-06-11 15:55:29,236 - services.whatsapp_service - WARNING - Removing unwanted field 'contacts' from payload
2025-06-11 15:55:29,236 - services.whatsapp_service - WARNING - Removing unwanted field 'messages' from payload
2025-06-11 15:55:29,236 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp'}
2025-06-11 15:55:29,863 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 400 Client Error: Bad Request for url: https://graph.facebook.com/v17.0/608867502309431/messages - {"error":{"message":"The parameter to is required.","type":"OAuthException","code":100,"fbtrace_id":"AYLxuQCtotKxjuNgO89cSy7"}}
2025-06-11 15:55:29,864 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:55:29] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:55:30,349 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:55:30] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:55:30,747 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:55:30] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:55:32,896 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_assistant'}
2025-06-11 15:55:32,898 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_assistant' in greeting state for session 2348055614455.
2025-06-11 15:55:32,899 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI menu.
2025-06-11 15:55:32,899 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'initial_entry'.
2025-06-11 15:55:32,900 - handlers.base_handler - INFO - AIHandler: Handling message 'initial_entry' in AI menu state for session 2348055614455. Original: 'ai_assistant'
2025-06-11 15:55:32,900 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🤖 *AI Assistant Options*\n\n🤖 *Lola Chatbot* - Chat with our AI assistant\n🛒 *AI Bulk Order* - Order multiple items at once\n\nPlease select an AI option:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'lola_chatbot', 'title': '🤖 Lola Chatbot'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order', 'title': '🛒 AI Bulk Order'}}, {'type': 'reply', 'reply': {'id': 'back_to_main', 'title': '🔙 Back to Main'}}]}}}
2025-06-11 15:55:33,853 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkE3MDJCNzdDQzkyQkFFQzVBRAA="}]}
2025-06-11 15:55:33,853 - services.whatsapp_service - WARNING - Removing unwanted field 'contacts' from payload
2025-06-11 15:55:33,853 - services.whatsapp_service - WARNING - Removing unwanted field 'messages' from payload
2025-06-11 15:55:33,854 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp'}
2025-06-11 15:55:35,570 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:55:35] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:55:35,573 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:55:35] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:55:35,838 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order'}
2025-06-11 15:55:35,840 - handlers.base_handler - INFO - AIHandler: Handling message 'ai_bulk_order' in AI menu state for session 2348055614455. Original: 'ai_bulk_order'
2025-06-11 15:55:35,840 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': '🛒 *AI Bulk Order Assistant*\n\nTell me everything you want to order in one message! For example:\n\n_"2 chief burgers with drinks, 3 jollof rice with chicken, large fries and 4 cokes"_\n\nI\'ll understand your order and help you confirm it! 🚀\n\n_Type \'menu\' to go back to the main menu_'}}
2025-06-11 15:55:35,924 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 400 Client Error: Bad Request for url: https://graph.facebook.com/v17.0/608867502309431/messages - {"error":{"message":"The parameter to is required.","type":"OAuthException","code":100,"fbtrace_id":"A-3Iw6PQ6Jr-hkCEwuWGXGU"}}
2025-06-11 15:55:35,925 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:55:35] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:55:37,223 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkQ5NkU5MTU1ODUyQjBGQkE3RQA="}]}
2025-06-11 15:55:37,223 - services.whatsapp_service - WARNING - Removing unwanted field 'contacts' from payload
2025-06-11 15:55:37,224 - services.whatsapp_service - WARNING - Removing unwanted field 'messages' from payload
2025-06-11 15:55:37,224 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp'}
2025-06-11 15:55:38,307 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:55:38] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:55:38,755 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:55:38] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:55:38,810 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 400 Client Error: Bad Request for url: https://graph.facebook.com/v17.0/608867502309431/messages - {"error":{"message":"The parameter to is required.","type":"OAuthException","code":100,"fbtrace_id":"A0xQ2Ley1sYGzm_w-Onu_cr"}}
2025-06-11 15:55:38,811 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:55:38] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:55:43,530 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': '6 puff puff'}
2025-06-11 15:55:43,532 - handlers.base_handler - INFO - AIHandler: Handling message '6 puff puff' in AI bulk order state for session 2348055614455. Original: '6 puff puff'
2025-06-11 15:55:46,744 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-11 15:55:46,746 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🛒 *Order Summary:*\n\n✅ 6x Puff Puff - ₦1,200\n\n*Total: ₦1,200.00*\n\nWould you like to proceed with this order?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'confirm_ai_order', 'title': '✅ Confirm Order'}}, {'type': 'reply', 'reply': {'id': 'modify_ai_order', 'title': '✏️ Modify Order'}}, {'type': 'reply', 'reply': {'id': 'cancel_ai_order', 'title': '❌ Cancel'}}]}}}
2025-06-11 15:55:47,685 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjc0QjE5NkYyOTk2NjFBQjM4OQA="}]}
2025-06-11 15:55:47,686 - services.whatsapp_service - WARNING - Removing unwanted field 'contacts' from payload
2025-06-11 15:55:47,686 - services.whatsapp_service - WARNING - Removing unwanted field 'messages' from payload
2025-06-11 15:55:47,687 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp'}
2025-06-11 15:55:48,273 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 400 Client Error: Bad Request for url: https://graph.facebook.com/v17.0/608867502309431/messages - {"error":{"message":"The parameter to is required.","type":"OAuthException","code":100,"fbtrace_id":"A8e-LhTLFOz3WB5N4YcT4Sg"}}
2025-06-11 15:55:48,274 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:55:48] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:55:48,548 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:55:48] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:55:49,090 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:55:49] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:55:50,272 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-06-11 15:55:50,273 - handlers.base_handler - INFO - AI order confirmed. Cart: {'Puff Puff': {'item_id': 'Puff Puff', 'quantity': 6, 'price': 200, 'total_price': 1200, 'variations': {}}}. Redirecting to order handler.
2025-06-11 15:55:50,274 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'order_handler' with message 'process_final_order'.
2025-06-11 15:55:50,274 - handlers.order_handler - INFO - AI initiated order processing for session 2348055614455.
2025-06-11 15:55:50,274 - handlers.order_handler - INFO - Address set, proceeding to confirm order for AI-initiated session 2348055614455.
2025-06-11 15:55:50,275 - handlers.order_handler - INFO - Showing final order confirmation for session 2348055614455. Total: ₦1,200.00
2025-06-11 15:55:50,275 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🛒 *Final Order Confirmation*\n\n📋 *Items Ordered:*\n• 6x Puff Puff - ₦1,200.00\n\n📍 *Delivery Details:*\n👤 Name: Ziga\n📱 Phone: 2348055614455\n🏠 Address: Howson Wright\n\n💰 *Total Amount: ₦1,200.00*\n\nPlease confirm to proceed with payment.'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'final_confirm', 'title': '✅ Confirm & Pay'}}, {'type': 'reply', 'reply': {'id': 'edit_order', 'title': '✏️ Edit Order'}}, {'type': 'reply', 'reply': {'id': 'cancel_order', 'title': '❌ Cancel Order'}}]}}}
2025-06-11 15:55:51,393 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjkzRDJERTRGOEJGNTU3MkE1RgA="}]}
2025-06-11 15:55:51,397 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦1,200 (1 items)
2025-06-11 15:55:51,397 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦1,200.00
2025-06-11 15:55:51,397 - services.whatsapp_service - WARNING - Removing unwanted field 'contacts' from payload
2025-06-11 15:55:51,397 - services.whatsapp_service - WARNING - Removing unwanted field 'messages' from payload
2025-06-11 15:55:51,398 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp'}
2025-06-11 15:55:52,425 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 400 Client Error: Bad Request for url: https://graph.facebook.com/v17.0/608867502309431/messages - {"error":{"message":"The parameter to is required.","type":"OAuthException","code":100,"fbtrace_id":"AcyX30uSpq3YfxenJIxwZN1"}}
2025-06-11 15:55:52,426 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:55:52] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:55:52,459 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:55:52] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:55:53,216 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:55:53] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:55:53,989 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'final_confirm'}
2025-06-11 15:55:53,990 - handlers.order_handler - INFO - Order ORDER_20250611_155553_c45d0a8e confirmed for session 2348055614455. Amount: ₦1,200.00
2025-06-11 15:55:53,993 - services.lead_tracker - INFO - Order completion tracked for 2348055614455: ORDER_20250611_155553_c45d0a8e (₦1,200)
2025-06-11 15:55:53,994 - handlers.lead_tracking_handler - INFO - 💰 Conversion tracked: 2348055614455 - ORDER_20250611_155553_c45d0a8e (₦1,200)
2025-06-11 15:55:53,994 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'payment_handler' with message 'initiate_payment'.
2025-06-11 15:55:53,994 - handlers.base_handler - INFO - Handling payment processing for session 2348055614455, message: initiate_payment
2025-06-11 15:55:53,995 - handlers.base_handler - INFO - Creating payment link for session 2348055614455
2025-06-11 15:55:54,003 - utils.data_manager - INFO - Order details saved to data\orders.json
2025-06-11 15:55:54,004 - services.payment_service - INFO - Attempting to create payment link for reference: PAY-ORDER-20250611155553-7847 with amount: 120000, email: ziga4455@foodorder.com
2025-06-11 15:55:54,674 - services.payment_service - INFO - Payment link created for Ziga Ziga (2348055614455), URL: https://checkout.paystack.com/sprnrxvnliqwjcf
2025-06-11 15:55:54,675 - handlers.base_handler - INFO - Starting payment monitoring for order ORDER-20250611155553-7847, reference PAY-ORDER-20250611155553-7847
2025-06-11 15:55:54,676 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-ORDER-20250611155553-7847
2025-06-11 15:55:55,154 - services.payment_service - WARNING - Payment not successful for reference PAY-ORDER-20250611155553-7847. Paystack status: abandoned. Response: {'status': True, 'message': 'Verification successful', 'data': {'id': 5048461807, 'domain': 'test', 'status': 'abandoned', 'reference': 'PAY-ORDER-20250611155553-7847', 'receipt_number': None, 'amount': 120000, 'message': None, 'gateway_response': 'The transaction was not completed', 'paid_at': None, 'created_at': '2025-06-11T14:55:54.000Z', 'channel': 'card', 'currency': 'NGN', 'ip_address': '102.67.12.153, 172.70.86.34, 172.31.68.120', 'metadata': {'customer_name': 'Ziga', 'customer_phone': '2348055614455', 'first_name': 'Ziga', 'last_name': 'Ziga', 'order_id': 'ORDER-20250611155553-7847', 'delivery_address': 'Howson Wright'}, 'log': None, 'fees': None, 'fees_split': None, 'authorization': {}, 'customer': {'id': 276711440, 'first_name': None, 'last_name': None, 'email': 'ziga4455@foodorder.com', 'customer_code': 'CUS_bhkdpnbvcjqt55g', 'phone': None, 'metadata': None, 'risk_action': 'default', 'international_format_phone': None}, 'plan': None, 'split': {}, 'order_id': None, 'paidAt': None, 'createdAt': '2025-06-11T14:55:54.000Z', 'requested_amount': 120000, 'pos_transaction_data': None, 'source': None, 'fees_breakdown': None, 'connect': None, 'transaction_date': '2025-06-11T14:55:54.000Z', 'plan_object': {}, 'subaccount': {}}}
2025-06-11 15:55:55,155 - handlers.base_handler - INFO - Payment not yet verified for order ORDER-20250611155553-7847, attempt 1/15
2025-06-11 15:55:55,156 - handlers.base_handler - INFO - Payment link created successfully for order ORDER-20250611155553-7847
2025-06-11 15:55:55,156 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "🛒 *Order Created Successfully!*\n\n📋 *Order ID:* ORDER-20250611155553-7847\n💰 *Total:* ₦1,200\n\n💳 *Complete Payment:*\nhttps://checkout.paystack.com/sprnrxvnliqwjcf\n\n✅ We'll automatically confirm your order once payment is received!\n💬 You can also send 'paid' after payment to check status immediately.\n\n⏰ Payment link expires in 15 minutes."}}
2025-06-11 15:55:56,113 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkU2NkE0OURBQTAxRUI5Q0ZBQQA="}]}
2025-06-11 15:55:56,117 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦1,200 (1 items)
2025-06-11 15:55:56,117 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦1,200.00
2025-06-11 15:55:56,117 - services.whatsapp_service - WARNING - Removing unwanted field 'contacts' from payload
2025-06-11 15:55:56,117 - services.whatsapp_service - WARNING - Removing unwanted field 'messages' from payload
2025-06-11 15:55:56,118 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp'}
2025-06-11 15:55:56,685 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 400 Client Error: Bad Request for url: https://graph.facebook.com/v17.0/608867502309431/messages - {"error":{"message":"The parameter to is required.","type":"OAuthException","code":100,"fbtrace_id":"ASh5ytw3bn4__4F3KdZatTx"}}
2025-06-11 15:55:56,685 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:55:56] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:55:56,966 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:55:56] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:55:57,915 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:55:57] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:56:10,534 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Paid'}
2025-06-11 15:56:10,536 - handlers.base_handler - INFO - Received 'paid' command for session 2348055614455, attempting manual verification for ref: PAY-ORDER-20250611155553-7847
2025-06-11 15:56:10,536 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-ORDER-20250611155553-7847
2025-06-11 15:56:11,188 - services.payment_service - INFO - Payment verified successfully for reference PAY-ORDER-20250611155553-7847. Status: success
2025-06-11 15:56:11,190 - handlers.base_handler - INFO - Manual payment verification successful for order ORDER-20250611155553-7847
2025-06-11 15:56:11,190 - handlers.base_handler - INFO - Payment monitoring stopped for session 2348055614455
2025-06-11 15:56:11,197 - utils.data_manager - INFO - Order details saved to data\orders.json
2025-06-11 15:56:11,200 - services.lead_tracker - INFO - Order completion tracked for 2348055614455: ORDER-20250611155553-7847 (₦1,200)
2025-06-11 15:56:11,200 - handlers.lead_tracking_handler - INFO - 💰 Conversion tracked: 2348055614455 - ORDER-20250611155553-7847 (₦1,200)
2025-06-11 15:56:11,200 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "🎉 *Payment Confirmed!*\n\n📋 *Order ID:* ORDER-20250611155553-7847\n💰 *Amount Paid:* ₦1,200\n🛒 *Items:* 🛒 *Your Cart:*\n• 6 x Puff Puff (₦200) = ₦1,200\n\n💰 *Total: ₦1,200*\n🚚 *Delivery to:* Howson Wright\n\n✅ Your order is confirmed and being processed!\n📱 You'll receive delivery updates soon.\n\n🙏 Thank you for your purchase! 😊"}}
2025-06-11 15:56:13,286 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjhDMEFBQzY1NTdCNEE2MDA4OQA="}]}
2025-06-11 15:56:13,286 - handlers.feedback_handler - INFO - Initiated feedback collection for order ORDER-20250611155553-7847, session 2348055614455
2025-06-11 15:56:13,287 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🎉 *Thank you for your order!*\n\n📋 Order ID: ORDER-20250611155553-7847\n\n💬 *How was your ordering experience?*\nYour feedback helps us improve our service!'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'excellent', 'title': '🤩 Excellent'}}, {'type': 'reply', 'reply': {'id': 'good', 'title': '😊 Good'}}, {'type': 'reply', 'reply': {'id': 'bad', 'title': '😞 Bad'}}]}}}
2025-06-11 15:56:13,287 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:56:13] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:56:13,685 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:56:13] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:56:14,294 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkVGNTNBQUQ2N0IwMzNBMzVBMwA="}]}
2025-06-11 15:56:14,294 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'message': 'Payment confirmed and feedback initiated'}
2025-06-11 15:56:14,295 - services.whatsapp_service - WARNING - Added missing messaging_product to payload
2025-06-11 15:56:14,921 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 400 Client Error: Bad Request for url: https://graph.facebook.com/v17.0/608867502309431/messages - {"error":{"message":"The parameter to is required.","type":"OAuthException","code":100,"fbtrace_id":"A1jy8lI6cdHhBFs3_rQp0BK"}}
2025-06-11 15:56:14,922 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:56:14] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:56:15,110 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:56:15] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:56:15,883 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:56:15] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:56:17,583 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'excellent'}
2025-06-11 15:56:17,585 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "🤩 *Thank you for the excellent rating!*\n\n💬 Would you like to share any specific comments about your experience?\n\nType your message or 'skip' to finish."}}
2025-06-11 15:56:18,513 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjJBNEE4NzREREY4NDE5RUExNQA="}]}
2025-06-11 15:56:18,513 - services.whatsapp_service - WARNING - Removing unwanted field 'contacts' from payload
2025-06-11 15:56:18,513 - services.whatsapp_service - WARNING - Removing unwanted field 'messages' from payload
2025-06-11 15:56:18,514 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp'}
2025-06-11 15:56:19,093 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 400 Client Error: Bad Request for url: https://graph.facebook.com/v17.0/608867502309431/messages - {"error":{"message":"The parameter to is required.","type":"OAuthException","code":100,"fbtrace_id":"Amwu-bowvu2ijw8uZQia3Fg"}}
2025-06-11 15:56:19,095 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:56:19] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:56:19,325 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:56:19] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:56:19,995 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:56:19] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:56:22,888 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Skip'}
2025-06-11 15:56:22,892 - handlers.feedback_handler - INFO - Feedback saved to data/feedback.json
2025-06-11 15:56:22,892 - handlers.feedback_handler - INFO - Feedback saved for order ORDER-20250611155553-7847: excellent
2025-06-11 15:56:22,893 - handlers.base_handler - INFO - Session 2348055614455 returned to main menu (greeting state).
2025-06-11 15:56:22,893 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Ziga! 🙏 *Thank you for your Excellent feedback!*\n\nWe appreciate you choosing us! 😊'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '✨ Lola AI Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '⚙️ Others'}}]}}}
2025-06-11 15:56:24,913 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjg0MzkyMzkyMjM2QTA4MjE0RgA="}]}
2025-06-11 15:56:24,913 - services.whatsapp_service - WARNING - Removing unwanted field 'contacts' from payload
2025-06-11 15:56:24,914 - services.whatsapp_service - WARNING - Removing unwanted field 'messages' from payload
2025-06-11 15:56:24,914 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp'}
2025-06-11 15:56:25,524 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 400 Client Error: Bad Request for url: https://graph.facebook.com/v17.0/608867502309431/messages - {"error":{"message":"The parameter to is required.","type":"OAuthException","code":100,"fbtrace_id":"AgLt0t9MMMDutkWY_0GObqf"}}
2025-06-11 15:56:25,524 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:56:25] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:56:25,715 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:56:25] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:56:26,405 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:56:26] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:56:35,609 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-11 15:56:35,611 - handlers.base_handler - INFO - GreetingHandler: Handling message 'hello' in greeting state for session 2348055614455.
2025-06-11 15:56:35,612 - handlers.base_handler - WARNING - Session 2348055614455: Invalid option 'hello' in greeting state.
2025-06-11 15:56:35,612 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Ziga! 👋\n\nInvalid option. Please choose from the options below:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order', 'title': '🛒 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_assistant', 'title': '🤖 AI Assistant'}}, {'type': 'reply', 'reply': {'id': 'others', 'title': '⚙️ Others'}}]}}}
2025-06-11 15:56:36,573 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjdEQUU5QUI5MDUwODBFNUVEOQA="}]}
2025-06-11 15:56:36,574 - services.whatsapp_service - WARNING - Removing unwanted field 'contacts' from payload
2025-06-11 15:56:36,574 - services.whatsapp_service - WARNING - Removing unwanted field 'messages' from payload
2025-06-11 15:56:36,574 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp'}
2025-06-11 15:56:37,251 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 400 Client Error: Bad Request for url: https://graph.facebook.com/v17.0/608867502309431/messages - {"error":{"message":"The parameter to is required.","type":"OAuthException","code":100,"fbtrace_id":"AeP4HG6JBCu32N5g5jO3Dtr"}}
2025-06-11 15:56:37,252 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:56:37] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:56:37,309 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:56:37] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:56:38,153 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:56:38] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:56:45,019 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_assistant'}
2025-06-11 15:56:45,021 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_assistant' in greeting state for session 2348055614455.
2025-06-11 15:56:45,022 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI menu.
2025-06-11 15:56:45,022 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'initial_entry'.
2025-06-11 15:56:45,023 - handlers.base_handler - INFO - AIHandler: Handling message 'initial_entry' in AI menu state for session 2348055614455. Original: 'ai_assistant'
2025-06-11 15:56:45,023 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🤖 *AI Assistant Options*\n\n🤖 *Lola Chatbot* - Chat with our AI assistant\n🛒 *AI Bulk Order* - Order multiple items at once\n\nPlease select an AI option:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'lola_chatbot', 'title': '🤖 Lola Chatbot'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order', 'title': '🛒 AI Bulk Order'}}, {'type': 'reply', 'reply': {'id': 'back_to_main', 'title': '🔙 Back to Main'}}]}}}
2025-06-11 15:56:46,021 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjZCMjg0NTY2OEFDRjdDNTA2MwA="}]}
2025-06-11 15:56:46,022 - services.whatsapp_service - WARNING - Removing unwanted field 'contacts' from payload
2025-06-11 15:56:46,022 - services.whatsapp_service - WARNING - Removing unwanted field 'messages' from payload
2025-06-11 15:56:46,023 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp'}
2025-06-11 15:56:46,646 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 400 Client Error: Bad Request for url: https://graph.facebook.com/v17.0/608867502309431/messages - {"error":{"message":"The parameter to is required.","type":"OAuthException","code":100,"fbtrace_id":"AfJXB9cJHEVuF1gqojGEeEV"}}
2025-06-11 15:56:46,646 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:56:46] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:56:46,950 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:56:46] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:56:47,644 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:56:47] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:59:16,898 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-11 15:59:16,900 - handlers.base_handler - INFO - AIHandler: Handling message 'hello' in AI menu state for session 2348055614455. Original: 'Hello'
2025-06-11 15:59:16,901 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🤖 *AI Assistant Options*\n\n🤖 *Lola Chatbot* - Chat with our AI assistant\n🛒 *AI Bulk Order* - Order multiple items at once\n\nPlease select an AI option:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'lola_chatbot', 'title': '🤖 Lola Chatbot'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order', 'title': '🛒 AI Bulk Order'}}, {'type': 'reply', 'reply': {'id': 'back_to_main', 'title': '🔙 Back to Main'}}]}}}
2025-06-11 15:59:17,844 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjY0NUM5MTZFNDNFOTA0NTc3QwA="}]}
2025-06-11 15:59:17,845 - services.whatsapp_service - WARNING - Removing unwanted field 'contacts' from payload
2025-06-11 15:59:17,845 - services.whatsapp_service - WARNING - Removing unwanted field 'messages' from payload
2025-06-11 15:59:17,845 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp'}
2025-06-11 15:59:19,543 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 400 Client Error: Bad Request for url: https://graph.facebook.com/v17.0/608867502309431/messages - {"error":{"message":"The parameter to is required.","type":"OAuthException","code":100,"fbtrace_id":"AnjhSalLQIy4GOhZMJyXhvn"}}
2025-06-11 15:59:19,543 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:59:19] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:59:19,656 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:59:19] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:59:19,658 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:59:19] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:59:22,119 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'back_to_main'}
2025-06-11 15:59:22,121 - handlers.base_handler - INFO - AIHandler: Handling message 'back_to_main' in AI menu state for session 2348055614455. Original: 'back_to_main'
2025-06-11 15:59:22,122 - handlers.base_handler - INFO - Session 2348055614455 returned to main menu (greeting state).
2025-06-11 15:59:22,122 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Ziga! Welcome back! How can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '✨ Lola AI Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '⚙️ Others'}}]}}}
2025-06-11 15:59:24,053 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkIyOTdCNEI3OTk5REIyMUI4MgA="}]}
2025-06-11 15:59:24,053 - services.whatsapp_service - WARNING - Removing unwanted field 'contacts' from payload
2025-06-11 15:59:24,053 - services.whatsapp_service - WARNING - Removing unwanted field 'messages' from payload
2025-06-11 15:59:24,054 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp'}
2025-06-11 15:59:25,444 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 400 Client Error: Bad Request for url: https://graph.facebook.com/v17.0/608867502309431/messages - {"error":{"message":"The parameter to is required.","type":"OAuthException","code":100,"fbtrace_id":"AfuP4ZXHuiBq3O1-T3g9yjX"}}
2025-06-11 15:59:25,445 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:59:25] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:59:25,585 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:59:25] "POST /webhook HTTP/1.1" 200 -
2025-06-11 15:59:26,843 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 15:59:26] "POST /webhook HTTP/1.1" 200 -
2025-06-11 16:17:40,985 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-11 16:17:40,986 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-11 16:17:40,987 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 16:17:40,987 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 16:17:40,987 - services.payment_service - INFO - PaymentService initialized
2025-06-11 16:17:40,988 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-11 16:17:40,988 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 16:17:40,989 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 16:17:40,989 - services.payment_service - INFO - PaymentService initialized
2025-06-11 16:17:40,990 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-11 16:17:40,990 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-11 16:17:40,991 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-11 16:17:40,991 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 16:17:40,992 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-11 16:17:40,992 - handlers.order_tracking_handler - INFO - OrderTrackingHandler initialized.
2025-06-11 16:17:40,992 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-11 16:17:41,485 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-11 16:17:41,485 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-11 16:17:41,485 - handlers.message_processor - INFO - MessageProcessor initialized with comprehensive paid/non-paid user support.
2025-06-11 16:17:41,486 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 16:17:41,500 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-11 16:17:41,500 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-11 16:18:17,335 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-11 16:18:17,335 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-11 16:18:17,339 - handlers.base_handler - INFO - Session 2348055614455 initialized with greeting state for user 'Ziga'.
2025-06-11 16:18:17,339 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Ziga! 👋\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order', 'title': '🛒 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_assistant', 'title': '🤖 AI Assistant'}}, {'type': 'reply', 'reply': {'id': 'others', 'title': '⚙️ Others'}}]}}}
2025-06-11 16:18:23,597 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjEwOTYyM0M3QjUxRUFBMUI2OAA="}]}
2025-06-11 16:18:23,598 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjEwOTYyM0M3QjUxRUFBMUI2OAA='}]}
2025-06-11 16:18:23,598 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 16:18:23] "POST /webhook HTTP/1.1" 200 -
2025-06-11 16:18:26,882 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 16:18:26] "POST /webhook HTTP/1.1" 200 -
2025-06-11 16:18:27,013 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 16:18:27] "POST /webhook HTTP/1.1" 200 -
2025-06-11 16:18:28,790 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_assistant'}
2025-06-11 16:18:28,792 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_assistant' in greeting state for session 2348055614455.
2025-06-11 16:18:28,793 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI menu.
2025-06-11 16:18:28,793 - handlers.message_processor - INFO - Redirecting session 2348055614455 to 'ai_handler' with message 'initial_entry'
2025-06-11 16:18:28,794 - handlers.base_handler - INFO - AIHandler: Handling message 'initial_entry' in AI menu state for session 2348055614455. Original: 'ai_assistant'
2025-06-11 16:18:28,794 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🤖 *AI Assistant Options*\n\n🤖 *Lola Chatbot* - Chat with our AI assistant\n🛒 *AI Bulk Order* - Order multiple items at once\n\nPlease select an AI option:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'lola_chatbot', 'title': '🤖 Lola Chatbot'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order', 'title': '🛒 AI Bulk Order'}}, {'type': 'reply', 'reply': {'id': 'back_to_main', 'title': '🔙 Back to Main'}}]}}}
2025-06-11 16:18:30,305 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjgxQjI3Q0Q4RkRFRUJFM0E1RQA="}]}
2025-06-11 16:18:30,306 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjgxQjI3Q0Q4RkRFRUJFM0E1RQA='}]}
2025-06-11 16:18:30,306 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 16:18:30] "POST /webhook HTTP/1.1" 200 -
2025-06-11 16:18:31,199 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 16:18:31] "POST /webhook HTTP/1.1" 200 -
2025-06-11 16:18:31,932 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 16:18:31] "POST /webhook HTTP/1.1" 200 -
2025-06-11 16:18:31,933 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 16:18:31] "POST /webhook HTTP/1.1" 200 -
2025-06-11 16:18:33,086 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order'}
2025-06-11 16:18:33,088 - handlers.base_handler - INFO - AIHandler: Handling message 'ai_bulk_order' in AI menu state for session 2348055614455. Original: 'ai_bulk_order'
2025-06-11 16:18:33,089 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': '🛒 *AI Bulk Order Assistant*\n\nTell me everything you want to order in one message! For example:\n\n_"2 chief burgers with drinks, 3 jollof rice with chicken, large fries and 4 cokes"_\n\nI\'ll understand your order and help you confirm it! 🚀\n\n_Type \'menu\' to go back to the main menu_'}}
2025-06-11 16:18:35,220 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjM1QzZCMkM3NTY1MzEwRENDMQA="}]}
2025-06-11 16:18:35,220 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjM1QzZCMkM3NTY1MzEwRENDMQA='}]}
2025-06-11 16:18:35,221 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 16:18:35] "POST /webhook HTTP/1.1" 200 -
2025-06-11 16:18:36,007 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 16:18:36] "POST /webhook HTTP/1.1" 200 -
2025-06-11 16:18:36,856 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 16:18:36] "POST /webhook HTTP/1.1" 200 -
2025-06-11 16:18:47,335 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': '3 puff puff'}
2025-06-11 16:18:47,337 - handlers.base_handler - INFO - AIHandler: Handling message '3 puff puff' in AI bulk order state for session 2348055614455. Original: '3 puff puff'
2025-06-11 16:18:51,492 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-11 16:18:51,496 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🛒 *Order Summary:*\n\n✅ 3x Puff Puff - ₦600\n\n*Total: ₦600.00*\n\nWould you like to proceed with this order?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'confirm_ai_order', 'title': '✅ Confirm Order'}}, {'type': 'reply', 'reply': {'id': 'modify_ai_order', 'title': '✏️ Modify Order'}}, {'type': 'reply', 'reply': {'id': 'cancel_ai_order', 'title': '❌ Cancel'}}]}}}
2025-06-11 16:18:52,747 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkNGMjM5RDk1MEIyNDQ2OTMwOAA="}]}
2025-06-11 16:18:52,748 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkNGMjM5RDk1MEIyNDQ2OTMwOAA='}]}
2025-06-11 16:18:52,748 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 16:18:52] "POST /webhook HTTP/1.1" 200 -
2025-06-11 16:18:53,663 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 16:18:53] "POST /webhook HTTP/1.1" 200 -
2025-06-11 16:18:55,820 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 16:18:55] "POST /webhook HTTP/1.1" 200 -
2025-06-11 16:18:55,822 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 16:18:55] "POST /webhook HTTP/1.1" 200 -
2025-06-11 16:18:55,824 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-06-11 16:18:55,827 - handlers.base_handler - INFO - AI order confirmed. Cart: {'Puff Puff': {'item_id': 'Puff Puff', 'quantity': 3, 'price': 200, 'total_price': 600, 'variations': {}}}. Redirecting to order handler.
2025-06-11 16:18:55,828 - handlers.message_processor - INFO - Redirecting session 2348055614455 to 'order_handler' with message 'process_final_order'
2025-06-11 16:18:55,828 - handlers.order_handler - INFO - AI initiated order processing for session 2348055614455.
2025-06-11 16:18:55,829 - handlers.order_handler - INFO - Address set, proceeding to confirm order for AI-initiated session 2348055614455.
2025-06-11 16:18:55,829 - handlers.order_handler - INFO - Showing final order confirmation for session 2348055614455. Total: ₦600.00
2025-06-11 16:18:55,830 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🛒 *Final Order Confirmation*\n\n📋 *Items Ordered:*\n• 3x Puff Puff - ₦600.00\n\n📍 *Delivery Details:*\n👤 Name: Ziga\n📱 Phone: 2348055614455\n🏠 Address: Howson Wright\n\n💰 *Total Amount: ₦600.00*\n\nPlease confirm to proceed with payment.'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'final_confirm', 'title': '✅ Confirm & Pay'}}, {'type': 'reply', 'reply': {'id': 'edit_order', 'title': '✏️ Edit Order'}}, {'type': 'reply', 'reply': {'id': 'cancel_order', 'title': '❌ Cancel Order'}}]}}}
2025-06-11 16:19:02,293 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjFDMkMzQ0E1QTM4MkQ1QzMzRgA="}]}
2025-06-11 16:19:02,296 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦600 (1 items)
2025-06-11 16:19:02,297 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦600.00
2025-06-11 16:19:02,297 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjFDMkMzQ0E1QTM4MkQ1QzMzRgA='}]}
2025-06-11 16:19:02,297 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 16:19:02] "POST /webhook HTTP/1.1" 200 -
2025-06-11 16:19:03,045 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 16:19:03] "POST /webhook HTTP/1.1" 200 -
2025-06-11 16:19:03,595 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 16:19:03] "POST /webhook HTTP/1.1" 200 -
2025-06-11 16:19:05,851 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 16:19:05] "POST /webhook HTTP/1.1" 200 -
2025-06-11 16:19:05,993 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'final_confirm'}
2025-06-11 16:19:05,995 - handlers.order_handler - INFO - Order ORDER_20250611_161905_dda6c9c7 confirmed for session 2348055614455. Amount: ₦600.00
2025-06-11 16:19:05,998 - services.lead_tracker - INFO - Order completion tracked for 2348055614455: ORDER_20250611_161905_dda6c9c7 (₦600)
2025-06-11 16:19:05,998 - handlers.lead_tracking_handler - INFO - 💰 Conversion tracked: 2348055614455 - ORDER_20250611_161905_dda6c9c7 (₦600)
2025-06-11 16:19:05,998 - handlers.message_processor - INFO - Redirecting session 2348055614455 to 'payment_handler' with message 'initiate_payment'
2025-06-11 16:19:05,999 - handlers.base_handler - INFO - Handling payment processing for session 2348055614455, message: initiate_payment
2025-06-11 16:19:05,999 - handlers.base_handler - INFO - Creating payment link for session 2348055614455
2025-06-11 16:19:06,009 - utils.data_manager - INFO - Order details saved to data\orders.json
2025-06-11 16:19:06,010 - services.payment_service - INFO - Attempting to create payment link for reference: PAY-ORDER-20250611161906-6136 with amount: 60000, email: ziga4455@foodorder.com
2025-06-11 16:19:09,460 - services.payment_service - INFO - Payment link created for Ziga Ziga (2348055614455), URL: https://checkout.paystack.com/zsatrfc97dm746h
2025-06-11 16:19:09,461 - handlers.base_handler - INFO - Starting payment monitoring for order ORDER-20250611161906-6136, reference PAY-ORDER-20250611161906-6136
2025-06-11 16:19:09,461 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-ORDER-20250611161906-6136
2025-06-11 16:19:11,028 - services.payment_service - WARNING - Payment not successful for reference PAY-ORDER-20250611161906-6136. Paystack status: abandoned. Response: {'status': True, 'message': 'Verification successful', 'data': {'id': 5048499739, 'domain': 'test', 'status': 'abandoned', 'reference': 'PAY-ORDER-20250611161906-6136', 'receipt_number': None, 'amount': 60000, 'message': None, 'gateway_response': 'The transaction was not completed', 'paid_at': None, 'created_at': '2025-06-11T15:19:08.000Z', 'channel': 'card', 'currency': 'NGN', 'ip_address': '102.67.12.153, 172.70.162.180, 172.31.62.52', 'metadata': {'customer_name': 'Ziga', 'customer_phone': '2348055614455', 'first_name': 'Ziga', 'last_name': 'Ziga', 'order_id': 'ORDER-20250611161906-6136', 'delivery_address': 'Howson Wright'}, 'log': None, 'fees': None, 'fees_split': None, 'authorization': {}, 'customer': {'id': 276711440, 'first_name': None, 'last_name': None, 'email': 'ziga4455@foodorder.com', 'customer_code': 'CUS_bhkdpnbvcjqt55g', 'phone': None, 'metadata': None, 'risk_action': 'default', 'international_format_phone': None}, 'plan': None, 'split': {}, 'order_id': None, 'paidAt': None, 'createdAt': '2025-06-11T15:19:08.000Z', 'requested_amount': 60000, 'pos_transaction_data': None, 'source': None, 'fees_breakdown': None, 'connect': None, 'transaction_date': '2025-06-11T15:19:08.000Z', 'plan_object': {}, 'subaccount': {}}}
2025-06-11 16:19:11,028 - handlers.base_handler - INFO - Payment not yet verified for order ORDER-20250611161906-6136, attempt 1/15
2025-06-11 16:19:11,029 - handlers.base_handler - INFO - Payment link created successfully for order ORDER-20250611161906-6136
2025-06-11 16:19:11,029 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "🛒 *Order Created Successfully!*\n\n📋 *Order ID:* ORDER-20250611161906-6136\n💰 *Total:* ₦600\n\n💳 *Complete Payment:*\nhttps://checkout.paystack.com/zsatrfc97dm746h\n\n✅ We'll automatically confirm your order once payment is received!\n💬 You can also send 'paid' after payment to check status immediately.\n\n⏰ Payment link expires in 15 minutes."}}
2025-06-11 16:19:12,114 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjA0ODNEMjhGQjVGN0MzNTdFQwA="}]}
2025-06-11 16:19:12,117 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦600 (1 items)
2025-06-11 16:19:12,118 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦600.00
2025-06-11 16:19:12,118 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjA0ODNEMjhGQjVGN0MzNTdFQwA='}]}
2025-06-11 16:19:12,118 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 16:19:12] "POST /webhook HTTP/1.1" 200 -
2025-06-11 16:19:19,105 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 16:19:19] "POST /webhook HTTP/1.1" 200 -
2025-06-11 16:19:19,247 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 16:19:19] "POST /webhook HTTP/1.1" 200 -
2025-06-11 16:19:31,450 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Paid'}
2025-06-11 16:19:31,452 - handlers.base_handler - INFO - Received 'paid' command for session 2348055614455, attempting manual verification for ref: PAY-ORDER-20250611161906-6136
2025-06-11 16:19:31,452 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-ORDER-20250611161906-6136
2025-06-11 16:19:32,207 - services.payment_service - INFO - Payment verified successfully for reference PAY-ORDER-20250611161906-6136. Status: success
2025-06-11 16:19:32,209 - handlers.base_handler - INFO - Manual payment verification successful for order ORDER-20250611161906-6136
2025-06-11 16:19:32,210 - handlers.base_handler - INFO - Payment monitoring stopped for session 2348055614455
2025-06-11 16:19:32,220 - utils.data_manager - INFO - Order details saved to data\orders.json
2025-06-11 16:19:32,223 - services.lead_tracker - INFO - Order completion tracked for 2348055614455: ORDER-20250611161906-6136 (₦600)
2025-06-11 16:19:32,223 - handlers.lead_tracking_handler - INFO - 💰 Conversion tracked: 2348055614455 - ORDER-20250611161906-6136 (₦600)
2025-06-11 16:19:32,223 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "🎉 *Payment Confirmed!*\n\n📋 *Order ID:* ORDER-20250611161906-6136\n💰 *Amount Paid:* ₦600\n🛒 *Items:* 🛒 *Your Cart:*\n• 3 x Puff Puff (₦200) = ₦600\n\n💰 *Total: ₦600*\n🚚 *Delivery to:* Howson Wright\n\n✅ Your order is confirmed and being processed!\n📱 You'll receive delivery updates soon.\n\n🙏 Thank you for your purchase! 😊"}}
2025-06-11 16:19:36,527 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkVFMkZDNEMxQTFGODE2MUY4OQA="}]}
2025-06-11 16:19:36,529 - handlers.feedback_handler - INFO - Initiated feedback collection for order ORDER-20250611161906-6136, session 2348055614455
2025-06-11 16:19:36,529 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🎉 *Thank you for your order!*\n\n📋 Order ID: ORDER-20250611161906-6136\n\n💬 *How was your ordering experience?*\nYour feedback helps us improve our service!'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'excellent', 'title': '🤩 Excellent'}}, {'type': 'reply', 'reply': {'id': 'good', 'title': '😊 Good'}}, {'type': 'reply', 'reply': {'id': 'bad', 'title': '😞 Bad'}}]}}}
2025-06-11 16:19:37,604 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 16:19:37] "POST /webhook HTTP/1.1" 200 -
2025-06-11 16:19:38,230 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkM4QjdEMzhCRDQzQ0NDQ0IyMQA="}]}
2025-06-11 16:19:38,230 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'message': 'Payment confirmed and feedback initiated'}
2025-06-11 16:19:38,231 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 16:19:38] "POST /webhook HTTP/1.1" 200 -
2025-06-11 16:19:38,232 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 16:19:38] "POST /webhook HTTP/1.1" 200 -
2025-06-11 16:19:39,430 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 16:19:39] "POST /webhook HTTP/1.1" 200 -
2025-06-11 16:19:39,551 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 16:19:39] "POST /webhook HTTP/1.1" 200 -
2025-06-11 16:19:42,279 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'excellent'}
2025-06-11 16:19:42,282 - handlers.feedback_handler - INFO - Feedback saved to data/feedback.json
2025-06-11 16:19:42,283 - handlers.feedback_handler - INFO - Feedback rating 'excellent' saved for order ORDER-20250611161906-6136.
2025-06-11 16:19:42,283 - handlers.base_handler - INFO - Session 2348055614455 returned to main menu (greeting state).
2025-06-11 16:19:42,284 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Ziga! 🤩 *Thank you for your Excellent rating!*\n\nWe truly appreciate your feedback and strive to improve. 😊'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '✨ Lola AI Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '⚙️ Others'}}]}}}
2025-06-11 16:19:43,570 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjM1QTAwMEJCNTg0QkY3OEFBNAA="}]}
2025-06-11 16:19:43,571 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjM1QTAwMEJCNTg0QkY3OEFBNAA='}]}
2025-06-11 16:19:43,571 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 16:19:43] "POST /webhook HTTP/1.1" 200 -
2025-06-11 16:19:44,837 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 16:19:44] "POST /webhook HTTP/1.1" 200 -
2025-06-11 16:19:45,529 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 16:19:45] "POST /webhook HTTP/1.1" 200 -
2025-06-11 16:19:45,925 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 16:19:45] "POST /webhook HTTP/1.1" 200 -
2025-06-11 16:19:54,016 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'order_menu_categories'}
2025-06-11 16:19:54,018 - handlers.base_handler - INFO - GreetingHandler: Handling message 'order_menu_categories' in greeting state for session 2348055614455.
2025-06-11 16:19:54,019 - handlers.base_handler - INFO - Session 2348055614455 redirecting to menu_handler for classic menu.
2025-06-11 16:19:54,019 - handlers.message_processor - INFO - Redirecting session 2348055614455 to 'menu_handler' with message 'show_menu'
2025-06-11 16:19:54,020 - handlers.base_handler - INFO - MenuHandler: Received message 'show_menu' (original: 'order_menu_categories') in menu state for session 2348055614455
2025-06-11 16:19:54,020 - handlers.base_handler - INFO - Showing menu categories for session 2348055614455
2025-06-11 16:19:54,020 - handlers.base_handler - INFO - Available categories: ['Main Dishes', 'Soups & Stews', 'Sides', 'Snacks', 'Drinks', 'Desserts', 'Specialties']
2025-06-11 16:19:54,021 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'list', 'body': {'text': '🍽️ *Our Menu*\n\nChoose a category to browse items:'}, 'action': {'button': 'Categories', 'sections': [{'title': 'Menu Categories', 'rows': [{'id': 'main dishes', 'title': 'Main Dishes'}, {'id': 'soups & stews', 'title': 'Soups & Stews'}, {'id': 'sides', 'title': 'Sides'}, {'id': 'snacks', 'title': 'Snacks'}, {'id': 'drinks', 'title': 'Drinks'}, {'id': 'desserts', 'title': 'Desserts'}, {'id': 'specialties', 'title': 'Specialties'}]}]}}}
2025-06-11 16:19:55,844 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjRGMTdCNjE1RUM0NzMyMTJCMgA="}]}
2025-06-11 16:19:55,845 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjRGMTdCNjE1RUM0NzMyMTJCMgA='}]}
2025-06-11 16:19:55,845 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 16:19:55] "POST /webhook HTTP/1.1" 200 -
2025-06-11 16:19:56,458 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 16:19:56] "POST /webhook HTTP/1.1" 200 -
2025-06-11 16:19:57,148 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 16:19:57] "POST /webhook HTTP/1.1" 200 -
2025-06-11 16:19:57,238 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 16:19:57] "POST /webhook HTTP/1.1" 200 -
2025-06-11 16:24:33,641 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-11 16:24:33,641 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-11 16:24:33,641 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 16:24:33,642 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 16:24:33,642 - services.payment_service - INFO - PaymentService initialized
2025-06-11 16:24:33,642 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-11 16:24:33,643 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 16:24:33,643 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 16:24:33,644 - services.payment_service - INFO - PaymentService initialized
2025-06-11 16:24:33,644 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-11 16:24:33,644 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-11 16:24:33,645 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-11 16:24:33,645 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 16:24:33,645 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-11 16:24:33,646 - handlers.order_tracking_handler - INFO - OrderTrackingHandler initialized.
2025-06-11 16:24:33,646 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-11 16:24:34,016 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-11 16:24:34,016 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-11 16:24:34,017 - handlers.message_processor - INFO - MessageProcessor initialized with comprehensive paid/non-paid user support.
2025-06-11 16:24:34,017 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 16:24:34,031 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-11 16:24:34,031 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-11 16:24:44,818 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-11 16:24:44,819 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-11 16:24:44,822 - handlers.base_handler - INFO - Session 2348055614455 initialized with greeting state for user 'Ziga'.
2025-06-11 16:24:44,823 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Ziga! 👋\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order', 'title': '🛒 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_assistant', 'title': '🤖 AI Assistant'}}, {'type': 'reply', 'reply': {'id': 'others', 'title': '⚙️ Others'}}]}}}
2025-06-11 16:24:46,096 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjE3NDNGMTJBMUMwOTUzMjFCNwA="}]}
2025-06-11 16:24:46,097 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjE3NDNGMTJBMUMwOTUzMjFCNwA='}]}
2025-06-11 16:24:46,098 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 16:24:46] "POST /webhook HTTP/1.1" 200 -
2025-06-11 16:24:46,928 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 16:24:46] "POST /webhook HTTP/1.1" 200 -
2025-06-11 16:24:47,359 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 16:24:47] "POST /webhook HTTP/1.1" 200 -
2025-06-11 16:24:47,620 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 16:24:47] "POST /webhook HTTP/1.1" 200 -
2025-06-11 16:24:49,650 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_assistant'}
2025-06-11 16:24:49,657 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_assistant' in greeting state for session 2348055614455.
2025-06-11 16:24:49,657 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI menu.
2025-06-11 16:24:49,657 - handlers.message_processor - INFO - Redirecting session 2348055614455 to 'ai_handler' with message 'initial_entry'
2025-06-11 16:24:49,658 - handlers.base_handler - INFO - AIHandler: Handling message 'initial_entry' in AI menu state for session 2348055614455. Original: 'ai_assistant'
2025-06-11 16:24:49,659 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🤖 *AI Assistant Options*\n\n🤖 *Lola Chatbot* - Chat with our AI assistant\n🛒 *AI Bulk Order* - Order multiple items at once\n\nPlease select an AI option:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'lola_chatbot', 'title': '🤖 Lola Chatbot'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order', 'title': '🛒 AI Bulk Order'}}, {'type': 'reply', 'reply': {'id': 'back_to_main', 'title': '🔙 Back to Main'}}]}}}
2025-06-11 16:24:50,598 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkEyQkM1MkY2NkI2MjEzQzIzQgA="}]}
2025-06-11 16:24:50,598 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkEyQkM1MkY2NkI2MjEzQzIzQgA='}]}
2025-06-11 16:24:50,599 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 16:24:50] "POST /webhook HTTP/1.1" 200 -
2025-06-11 16:24:51,413 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 16:24:51] "POST /webhook HTTP/1.1" 200 -
2025-06-11 16:24:51,988 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 16:24:51] "POST /webhook HTTP/1.1" 200 -
2025-06-11 16:24:52,110 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 16:24:52] "POST /webhook HTTP/1.1" 200 -
2025-06-11 16:24:52,823 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order'}
2025-06-11 16:24:52,826 - handlers.base_handler - INFO - AIHandler: Handling message 'ai_bulk_order' in AI menu state for session 2348055614455. Original: 'ai_bulk_order'
2025-06-11 16:24:52,826 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': '🛒 *AI Bulk Order Assistant*\n\nTell me everything you want to order in one message! For example:\n\n_"2 chief burgers with drinks, 3 jollof rice with chicken, large fries and 4 cokes"_\n\nI\'ll understand your order and help you confirm it! 🚀\n\n_Type \'menu\' to go back to the main menu_'}}
2025-06-11 16:24:54,052 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQ4Nzc2RkVCMUI3MDYwQzIwQwA="}]}
2025-06-11 16:24:54,053 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQ4Nzc2RkVCMUI3MDYwQzIwQwA='}]}
2025-06-11 16:24:54,053 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 16:24:54] "POST /webhook HTTP/1.1" 200 -
2025-06-11 16:24:54,871 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 16:24:54] "POST /webhook HTTP/1.1" 200 -
2025-06-11 16:24:55,300 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 16:24:55] "POST /webhook HTTP/1.1" 200 -
2025-06-11 16:24:55,969 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 16:24:55] "POST /webhook HTTP/1.1" 200 -
2025-06-11 16:25:03,560 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Puff puff 10'}
2025-06-11 16:25:03,562 - handlers.base_handler - INFO - AIHandler: Handling message 'puff puff 10' in AI bulk order state for session 2348055614455. Original: 'Puff puff 10'
2025-06-11 16:25:05,929 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-11 16:25:05,931 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🛒 *Order Summary:*\n\n✅ 10x Puff Puff - ₦2,000\n\n*Total: ₦2,000.00*\n\nWould you like to proceed with this order?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'confirm_ai_order', 'title': '✅ Confirm Order'}}, {'type': 'reply', 'reply': {'id': 'modify_ai_order', 'title': '✏️ Modify Order'}}, {'type': 'reply', 'reply': {'id': 'cancel_ai_order', 'title': '❌ Cancel'}}]}}}
2025-06-11 16:25:06,868 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjNBQzAxODYxM0IyNkFFNTE3NQA="}]}
2025-06-11 16:25:06,869 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjNBQzAxODYxM0IyNkFFNTE3NQA='}]}
2025-06-11 16:25:06,869 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 16:25:06] "POST /webhook HTTP/1.1" 200 -
2025-06-11 16:25:07,640 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 16:25:07] "POST /webhook HTTP/1.1" 200 -
2025-06-11 16:25:08,020 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 16:25:08] "POST /webhook HTTP/1.1" 200 -
2025-06-11 16:25:08,241 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 16:25:08] "POST /webhook HTTP/1.1" 200 -
2025-06-11 16:25:35,951 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-06-11 16:25:35,953 - handlers.base_handler - INFO - AI order confirmed. Cart: {'Puff Puff': {'item_id': 'Puff Puff', 'quantity': 10, 'price': 200, 'total_price': 2000, 'variations': {}}}. Redirecting to order handler.
2025-06-11 16:25:35,953 - handlers.message_processor - INFO - Redirecting session 2348055614455 to 'order_handler' with message 'process_final_order'
2025-06-11 16:25:35,953 - handlers.order_handler - INFO - AI initiated order processing for session 2348055614455.
2025-06-11 16:25:35,954 - handlers.order_handler - INFO - Address set, proceeding to confirm order for AI-initiated session 2348055614455.
2025-06-11 16:25:35,954 - handlers.order_handler - INFO - Showing final order confirmation for session 2348055614455. Total: ₦2,000.00
2025-06-11 16:25:35,955 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🛒 *Final Order Confirmation*\n\n📋 *Items Ordered:*\n• 10x Puff Puff - ₦2,000.00\n\n📍 *Delivery Details:*\n👤 Name: Ziga\n📱 Phone: 2348055614455\n🏠 Address: Howson Wright\n\n💰 *Total Amount: ₦2,000.00*\n\nPlease confirm to proceed with payment.'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'final_confirm', 'title': '✅ Confirm & Pay'}}, {'type': 'reply', 'reply': {'id': 'edit_order', 'title': '✏️ Edit Order'}}, {'type': 'reply', 'reply': {'id': 'cancel_order', 'title': '❌ Cancel Order'}}]}}}
2025-06-11 16:25:37,308 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkREQUQ4MTc5ODg1N0M0OUEzMgA="}]}
2025-06-11 16:25:37,310 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦2,000 (1 items)
2025-06-11 16:25:37,310 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦2,000.00
2025-06-11 16:25:37,311 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkREQUQ4MTc5ODg1N0M0OUEzMgA='}]}
2025-06-11 16:25:37,311 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 16:25:37] "POST /webhook HTTP/1.1" 200 -
2025-06-11 16:25:38,149 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 16:25:38] "POST /webhook HTTP/1.1" 200 -
2025-06-11 16:25:38,481 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 16:25:38] "POST /webhook HTTP/1.1" 200 -
2025-06-11 16:25:38,793 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 16:25:38] "POST /webhook HTTP/1.1" 200 -
2025-06-11 16:25:40,510 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'final_confirm'}
2025-06-11 16:25:40,512 - handlers.order_handler - INFO - Order ORDER_20250611_162540_d3d5e090 confirmed for session 2348055614455. Amount: ₦2,000.00
2025-06-11 16:25:40,517 - services.lead_tracker - INFO - Order completion tracked for 2348055614455: ORDER_20250611_162540_d3d5e090 (₦2,000)
2025-06-11 16:25:40,517 - handlers.lead_tracking_handler - INFO - 💰 Conversion tracked: 2348055614455 - ORDER_20250611_162540_d3d5e090 (₦2,000)
2025-06-11 16:25:40,518 - handlers.message_processor - INFO - Redirecting session 2348055614455 to 'payment_handler' with message 'initiate_payment'
2025-06-11 16:25:40,518 - handlers.base_handler - INFO - Handling payment processing for session 2348055614455, message: initiate_payment
2025-06-11 16:25:40,519 - handlers.base_handler - INFO - Creating payment link for session 2348055614455
2025-06-11 16:25:40,534 - utils.data_manager - INFO - Order details saved to data\orders.json
2025-06-11 16:25:40,534 - services.payment_service - INFO - Attempting to create payment link for reference: PAY-ORDER-20250611162540-6980 with amount: 200000, email: ziga4455@foodorder.com
2025-06-11 16:25:42,738 - services.payment_service - INFO - Payment link created for Ziga Ziga (2348055614455), URL: https://checkout.paystack.com/o09t3gtqr2u318r
2025-06-11 16:25:42,738 - handlers.base_handler - INFO - Starting payment monitoring for order ORDER-20250611162540-6980, reference PAY-ORDER-20250611162540-6980
2025-06-11 16:25:42,738 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-ORDER-20250611162540-6980
2025-06-11 16:25:43,740 - services.payment_service - WARNING - Payment not successful for reference PAY-ORDER-20250611162540-6980. Paystack status: abandoned. Response: {'status': True, 'message': 'Verification successful', 'data': {'id': 5048509758, 'domain': 'test', 'status': 'abandoned', 'reference': 'PAY-ORDER-20250611162540-6980', 'receipt_number': None, 'amount': 200000, 'message': None, 'gateway_response': 'The transaction was not completed', 'paid_at': None, 'created_at': '2025-06-11T15:25:42.000Z', 'channel': 'card', 'currency': 'NGN', 'ip_address': '102.67.12.153, 172.70.163.72, 172.31.68.120', 'metadata': {'customer_name': 'Ziga', 'customer_phone': '2348055614455', 'first_name': 'Ziga', 'last_name': 'Ziga', 'order_id': 'ORDER-20250611162540-6980', 'delivery_address': 'Howson Wright'}, 'log': None, 'fees': None, 'fees_split': None, 'authorization': {}, 'customer': {'id': 276711440, 'first_name': None, 'last_name': None, 'email': 'ziga4455@foodorder.com', 'customer_code': 'CUS_bhkdpnbvcjqt55g', 'phone': None, 'metadata': None, 'risk_action': 'default', 'international_format_phone': None}, 'plan': None, 'split': {}, 'order_id': None, 'paidAt': None, 'createdAt': '2025-06-11T15:25:42.000Z', 'requested_amount': 200000, 'pos_transaction_data': None, 'source': None, 'fees_breakdown': None, 'connect': None, 'transaction_date': '2025-06-11T15:25:42.000Z', 'plan_object': {}, 'subaccount': {}}}
2025-06-11 16:25:43,740 - handlers.base_handler - INFO - Payment not yet verified for order ORDER-20250611162540-6980, attempt 1/15
2025-06-11 16:25:43,741 - handlers.base_handler - INFO - Payment link created successfully for order ORDER-20250611162540-6980
2025-06-11 16:25:43,741 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "🛒 *Order Created Successfully!*\n\n📋 *Order ID:* ORDER-20250611162540-6980\n💰 *Total:* ₦2,000\n\n💳 *Complete Payment:*\nhttps://checkout.paystack.com/o09t3gtqr2u318r\n\n✅ We'll automatically confirm your order once payment is received!\n💬 You can also send 'paid' after payment to check status immediately.\n\n⏰ Payment link expires in 15 minutes."}}
2025-06-11 16:25:45,237 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjNEN0M4NDU3NTg0MzVFOUNGMAA="}]}
2025-06-11 16:25:45,240 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦2,000 (1 items)
2025-06-11 16:25:45,240 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦2,000.00
2025-06-11 16:25:45,240 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjNEN0M4NDU3NTg0MzVFOUNGMAA='}]}
2025-06-11 16:25:45,241 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 16:25:45] "POST /webhook HTTP/1.1" 200 -
2025-06-11 16:25:46,282 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 16:25:46] "POST /webhook HTTP/1.1" 200 -
2025-06-11 16:25:46,637 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 16:25:46] "POST /webhook HTTP/1.1" 200 -
2025-06-11 16:25:46,663 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 16:25:46] "POST /webhook HTTP/1.1" 200 -
2025-06-11 16:26:02,319 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Paid'}
2025-06-11 16:26:02,321 - handlers.base_handler - INFO - Received 'paid' command for session 2348055614455, attempting manual verification for ref: PAY-ORDER-20250611162540-6980
2025-06-11 16:26:02,322 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-ORDER-20250611162540-6980
2025-06-11 16:26:03,554 - services.payment_service - INFO - Payment verified successfully for reference PAY-ORDER-20250611162540-6980. Status: success
2025-06-11 16:26:03,556 - handlers.base_handler - INFO - Manual payment verification successful for order ORDER-20250611162540-6980
2025-06-11 16:26:03,556 - handlers.base_handler - INFO - Payment monitoring stopped for session 2348055614455
2025-06-11 16:26:03,564 - utils.data_manager - INFO - Order details saved to data\orders.json
2025-06-11 16:26:03,567 - services.lead_tracker - INFO - Order completion tracked for 2348055614455: ORDER-20250611162540-6980 (₦2,000)
2025-06-11 16:26:03,567 - handlers.lead_tracking_handler - INFO - 💰 Conversion tracked: 2348055614455 - ORDER-20250611162540-6980 (₦2,000)
2025-06-11 16:26:03,568 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "🎉 *Payment Confirmed!*\n\n📋 *Order ID:* ORDER-20250611162540-6980\n💰 *Amount Paid:* ₦2,000\n🛒 *Items:* 🛒 *Your Cart:*\n• 10 x Puff Puff (₦200) = ₦2,000\n\n💰 *Total: ₦2,000*\n🚚 *Delivery to:* Howson Wright\n\n✅ Your order is confirmed and being processed!\n📱 You'll receive delivery updates soon.\n\n🙏 Thank you for your purchase! 😊"}}
2025-06-11 16:26:05,218 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkJGRDIxNUQ2RTJBRDY3NjFEMQA="}]}
2025-06-11 16:26:05,219 - handlers.feedback_handler - INFO - Initiated feedback collection for order ORDER-20250611162540-6980, session 2348055614455
2025-06-11 16:26:05,219 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🎉 *Thank you for your order!*\n\n📋 Order ID: ORDER-20250611162540-6980\n\n💬 *How was your ordering experience?*\nYour feedback helps us improve our service!'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'excellent', 'title': '🤩 Excellent'}}, {'type': 'reply', 'reply': {'id': 'good', 'title': '😊 Good'}}, {'type': 'reply', 'reply': {'id': 'bad', 'title': '😞 Bad'}}]}}}
2025-06-11 16:26:06,079 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 16:26:06] "POST /webhook HTTP/1.1" 200 -
2025-06-11 16:26:06,259 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkRFN0U4MTMzNDM3MTRFNzQ1RgA="}]}
2025-06-11 16:26:06,260 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'message': 'Payment confirmed and feedback initiated'}
2025-06-11 16:26:06,261 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 16:26:06] "POST /webhook HTTP/1.1" 200 -
2025-06-11 16:26:06,389 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 16:26:06] "POST /webhook HTTP/1.1" 200 -
2025-06-11 16:26:06,770 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 16:26:06] "POST /webhook HTTP/1.1" 200 -
2025-06-11 16:26:07,194 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 16:26:07] "POST /webhook HTTP/1.1" 200 -
2025-06-11 16:26:07,503 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 16:26:07] "POST /webhook HTTP/1.1" 200 -
2025-06-11 16:26:07,589 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 16:26:07] "POST /webhook HTTP/1.1" 200 -
2025-06-11 16:26:08,647 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'excellent'}
2025-06-11 16:26:08,650 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "🤩 *Thank you for the excellent rating!*\n\n💬 Would you like to share any specific comments about your experience?\n\nType your message or 'skip' to finish."}}
2025-06-11 16:26:09,826 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjA3RUFFN0NBMTM3OERBN0QyQgA="}]}
2025-06-11 16:26:09,827 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjA3RUFFN0NBMTM3OERBN0QyQgA='}]}
2025-06-11 16:26:09,827 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 16:26:09] "POST /webhook HTTP/1.1" 200 -
2025-06-11 16:26:10,644 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 16:26:10] "POST /webhook HTTP/1.1" 200 -
2025-06-11 16:26:11,219 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 16:26:11] "POST /webhook HTTP/1.1" 200 -
2025-06-11 16:26:11,519 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 16:26:11] "POST /webhook HTTP/1.1" 200 -
2025-06-11 16:26:18,699 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Thanks'}
2025-06-11 16:26:18,702 - handlers.feedback_handler - INFO - Feedback saved to data/feedback.json
2025-06-11 16:26:18,703 - handlers.feedback_handler - INFO - Feedback saved for order ORDER-20250611162540-6980: excellent
2025-06-11 16:26:18,703 - handlers.base_handler - INFO - Session 2348055614455 returned to main menu (greeting state).
2025-06-11 16:26:18,704 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Ziga! 🙏 *Thank you for your Excellent feedback!*\n\nYour comments have been recorded and will help us improve.\n\nWe appreciate you choosing us! 😊'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '✨ Lola AI Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '⚙️ Others'}}]}}}
2025-06-11 16:26:19,747 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkE4QTBBOUFGOTExM0MyMzg0QwA="}]}
2025-06-11 16:26:19,748 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkE4QTBBOUFGOTExM0MyMzg0QwA='}]}
2025-06-11 16:26:19,749 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 16:26:19] "POST /webhook HTTP/1.1" 200 -
2025-06-11 16:26:20,570 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 16:26:20] "POST /webhook HTTP/1.1" 200 -
2025-06-11 16:26:20,902 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 16:26:20] "POST /webhook HTTP/1.1" 200 -
2025-06-11 16:26:21,157 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 16:26:21] "POST /webhook HTTP/1.1" 200 -
2025-06-11 16:26:33,024 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-11 16:26:33,026 - handlers.base_handler - INFO - GreetingHandler: Handling message 'hello' in greeting state for session 2348055614455.
2025-06-11 16:26:33,027 - handlers.base_handler - WARNING - Session 2348055614455: Invalid option 'hello' in greeting state.
2025-06-11 16:26:33,027 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Ziga! 👋\n\nInvalid option. Please choose from the options below:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order', 'title': '🛒 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_assistant', 'title': '🤖 AI Assistant'}}, {'type': 'reply', 'reply': {'id': 'others', 'title': '⚙️ Others'}}]}}}
2025-06-11 16:26:33,977 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkMyMzBDMjkxNkQ4RDFFNjY3MQA="}]}
2025-06-11 16:26:33,978 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkMyMzBDMjkxNkQ4RDFFNjY3MQA='}]}
2025-06-11 16:26:33,979 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 16:26:33] "POST /webhook HTTP/1.1" 200 -
2025-06-11 16:26:34,711 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 16:26:34] "POST /webhook HTTP/1.1" 200 -
2025-06-11 16:26:35,067 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 16:26:35] "POST /webhook HTTP/1.1" 200 -
2025-06-11 16:26:35,308 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 16:26:35] "POST /webhook HTTP/1.1" 200 -
2025-06-11 19:38:38,606 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-11 19:38:38,607 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-11 19:38:38,608 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 19:38:38,609 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 19:38:38,609 - services.payment_service - INFO - PaymentService initialized
2025-06-11 19:38:38,610 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-11 19:38:38,610 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 19:38:38,611 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 19:38:38,611 - services.payment_service - INFO - PaymentService initialized
2025-06-11 19:38:38,612 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-11 19:38:38,613 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-11 19:38:38,614 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-11 19:38:38,615 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 19:38:38,615 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-11 19:38:38,616 - handlers.order_tracking_handler - INFO - OrderTrackingHandler initialized.
2025-06-11 19:38:38,616 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-11 19:38:39,235 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-11 19:38:39,235 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-11 19:38:39,236 - handlers.message_processor - INFO - MessageProcessor initialized with comprehensive paid/non-paid user support.
2025-06-11 19:38:39,236 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 19:38:39,271 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-11 19:38:39,272 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-11 19:50:44,988 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-11 19:50:44,988 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-11 19:50:44,995 - handlers.base_handler - INFO - Session 2348055614455 initialized with greeting state for user 'Ziga'.
2025-06-11 19:50:44,999 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Ziga! 👋\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order', 'title': '🛒 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_assistant', 'title': '🤖 AI Assistant'}}, {'type': 'reply', 'reply': {'id': 'others', 'title': '⚙️ Others'}}]}}}
2025-06-11 19:50:46,427 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQyMkY1RjgyQ0YwRTlGRUE2QQA="}]}
2025-06-11 19:50:46,429 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQyMkY1RjgyQ0YwRTlGRUE2QQA='}]}
2025-06-11 19:50:46,430 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 19:50:46] "POST /webhook HTTP/1.1" 200 -
2025-06-11 19:50:47,370 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 19:50:47] "POST /webhook HTTP/1.1" 200 -
2025-06-11 19:50:47,670 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 19:50:47] "POST /webhook HTTP/1.1" 200 -
2025-06-11 21:28:54,612 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'Hello'}
2025-06-11 21:28:54,619 - utils.session_manager - INFO - New session 2347082345056 initialized.
2025-06-11 21:28:54,728 - handlers.base_handler - INFO - Session 2347082345056 initialized with greeting state for user 'Olumayowa Oyaleke'.
2025-06-11 21:28:54,729 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Olumayowa Oyaleke! 👋\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order', 'title': '🛒 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_assistant', 'title': '🤖 AI Assistant'}}, {'type': 'reply', 'reply': {'id': 'others', 'title': '⚙️ Others'}}]}}}
2025-06-11 21:28:56,094 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjlCMkRCM0FDQkY4MjIwQ0ZDNQA="}]}
2025-06-11 21:28:56,095 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjlCMkRCM0FDQkY4MjIwQ0ZDNQA='}]}
2025-06-11 21:28:56,096 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 21:28:56] "POST /webhook HTTP/1.1" 200 -
2025-06-11 21:28:57,129 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 21:28:57] "POST /webhook HTTP/1.1" 200 -
2025-06-11 21:28:58,077 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 21:28:58] "POST /webhook HTTP/1.1" 200 -
2025-06-11 21:28:58,227 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 21:28:58] "POST /webhook HTTP/1.1" 200 -
2025-06-11 21:29:04,052 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'ai_assistant'}
2025-06-11 21:29:04,056 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_assistant' in greeting state for session 2347082345056.
2025-06-11 21:29:04,057 - handlers.base_handler - INFO - Session 2347082345056 redirecting to AIHandler for AI menu.
2025-06-11 21:29:04,057 - handlers.message_processor - INFO - Redirecting session 2347082345056 to 'ai_handler' with message 'initial_entry'
2025-06-11 21:29:04,058 - handlers.base_handler - INFO - AIHandler: Handling message 'initial_entry' in AI menu state for session 2347082345056. Original: 'ai_assistant'
2025-06-11 21:29:04,058 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🤖 *AI Assistant Options*\n\n🤖 *Lola Chatbot* - Chat with our AI assistant\n🛒 *AI Bulk Order* - Order multiple items at once\n\nPlease select an AI option:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'lola_chatbot', 'title': '🤖 Lola Chatbot'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order', 'title': '🛒 AI Bulk Order'}}, {'type': 'reply', 'reply': {'id': 'back_to_main', 'title': '🔙 Back to Main'}}]}}}
2025-06-11 21:29:04,993 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjZFMDFCQkUzQ0UyNTU1MDU0OAA="}]}
2025-06-11 21:29:04,994 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjZFMDFCQkUzQ0UyNTU1MDU0OAA='}]}
2025-06-11 21:29:04,994 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 21:29:04] "POST /webhook HTTP/1.1" 200 -
2025-06-11 21:29:05,687 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 21:29:05] "POST /webhook HTTP/1.1" 200 -
2025-06-11 21:29:06,347 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 21:29:06] "POST /webhook HTTP/1.1" 200 -
2025-06-11 21:29:06,678 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 21:29:06] "POST /webhook HTTP/1.1" 200 -
2025-06-11 21:29:16,532 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'lola_chatbot'}
2025-06-11 21:29:16,535 - handlers.base_handler - INFO - AIHandler: Handling message 'lola_chatbot' in AI menu state for session 2347082345056. Original: 'lola_chatbot'
2025-06-11 21:29:16,536 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'text', 'text': {'body': "🤖 *Hi! I'm Lola, your AI assistant!*\n\nI can help you with:\n• Menu recommendations\n• Order assistance\n• General questions about our food\n• Nutritional information\n\nWhat would you like to know? Just ask me anything! 😊\n\n_Type 'menu' to go back to the main menu_"}}
2025-06-11 21:29:17,533 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjlEOTkxOEUzMUY2MDNDQzYyNAA="}]}
2025-06-11 21:29:17,534 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjlEOTkxOEUzMUY2MDNDQzYyNAA='}]}
2025-06-11 21:29:17,534 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 21:29:17] "POST /webhook HTTP/1.1" 200 -
2025-06-11 21:29:18,199 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 21:29:18] "POST /webhook HTTP/1.1" 200 -
2025-06-11 21:29:19,337 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 21:29:19] "POST /webhook HTTP/1.1" 200 -
2025-06-11 21:29:19,339 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 21:29:19] "POST /webhook HTTP/1.1" 200 -
2025-06-11 21:29:41,198 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'Order assistance'}
2025-06-11 21:29:41,206 - handlers.base_handler - INFO - AIHandler: Handling message 'order assistance' in Lola chat state for session 2347082345056. Original: 'Order assistance'
2025-06-11 21:29:43,467 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-11 21:29:43,475 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'text', 'text': {'body': "Hey there! How can I assist you with your order today? You can either browse our menu for some tasty options or use our AI bulk order feature for larger orders. No wahala, I'm here to help!\n\n_Type 'menu' to return to main menu_ 🤖"}}
2025-06-11 21:29:44,544 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjM1NDkzOTFENjM1MjE2QzQ2NAA="}]}
2025-06-11 21:29:44,545 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjM1NDkzOTFENjM1MjE2QzQ2NAA='}]}
2025-06-11 21:29:44,546 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 21:29:44] "POST /webhook HTTP/1.1" 200 -
2025-06-11 21:29:45,415 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 21:29:45] "POST /webhook HTTP/1.1" 200 -
2025-06-11 21:29:45,805 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 21:29:45] "POST /webhook HTTP/1.1" 200 -
2025-06-11 21:29:46,108 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 21:29:46] "POST /webhook HTTP/1.1" 200 -
2025-06-11 21:31:22,914 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'Menu'}
2025-06-11 21:31:22,917 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Olumayowa Oyaleke! 👋\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order', 'title': '🛒 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_assistant', 'title': '🤖 AI Assistant'}}, {'type': 'reply', 'reply': {'id': 'others', 'title': '⚙️ Others'}}]}}}
2025-06-11 21:31:23,914 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjU1OEJERTBFMzg2NjlBOTNFQQA="}]}
2025-06-11 21:31:23,919 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjU1OEJERTBFMzg2NjlBOTNFQQA='}]}
2025-06-11 21:31:23,920 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 21:31:23] "POST /webhook HTTP/1.1" 200 -
2025-06-11 21:31:24,683 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 21:31:24] "POST /webhook HTTP/1.1" 200 -
2025-06-11 21:31:26,353 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 21:31:26] "POST /webhook HTTP/1.1" 200 -
2025-06-11 21:31:26,584 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 21:31:26] "POST /webhook HTTP/1.1" 200 -
2025-06-11 21:31:32,042 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'order'}
2025-06-11 21:31:32,046 - handlers.base_handler - INFO - GreetingHandler: Handling message 'order' in greeting state for session 2347082345056.
2025-06-11 21:31:32,046 - handlers.base_handler - INFO - Session 2347082345056 redirecting to menu_handler for classic menu.
2025-06-11 21:31:32,047 - handlers.message_processor - INFO - Redirecting session 2347082345056 to 'menu_handler' with message 'show_menu'
2025-06-11 21:31:32,047 - handlers.base_handler - INFO - MenuHandler: Received message 'show_menu' (original: 'order') in menu state for session 2347082345056
2025-06-11 21:31:32,048 - handlers.base_handler - INFO - Showing menu categories for session 2347082345056
2025-06-11 21:31:32,048 - handlers.base_handler - INFO - Available categories: ['Main Dishes', 'Soups & Stews', 'Sides', 'Snacks', 'Drinks', 'Desserts', 'Specialties']
2025-06-11 21:31:32,050 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'list', 'body': {'text': '🍽️ *Our Menu*\n\nChoose a category to browse items:'}, 'action': {'button': 'Categories', 'sections': [{'title': 'Menu Categories', 'rows': [{'id': 'main dishes', 'title': 'Main Dishes'}, {'id': 'soups & stews', 'title': 'Soups & Stews'}, {'id': 'sides', 'title': 'Sides'}, {'id': 'snacks', 'title': 'Snacks'}, {'id': 'drinks', 'title': 'Drinks'}, {'id': 'desserts', 'title': 'Desserts'}, {'id': 'specialties', 'title': 'Specialties'}]}]}}}
2025-06-11 21:31:32,975 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjMxMTQ0OTlCOUVCOUI1RkJGRAA="}]}
2025-06-11 21:31:32,976 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjMxMTQ0OTlCOUVCOUI1RkJGRAA='}]}
2025-06-11 21:31:32,976 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 21:31:32] "POST /webhook HTTP/1.1" 200 -
2025-06-11 21:31:33,785 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 21:31:33] "POST /webhook HTTP/1.1" 200 -
2025-06-11 21:31:34,715 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 21:31:34] "POST /webhook HTTP/1.1" 200 -
2025-06-11 21:31:34,760 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 21:31:34] "POST /webhook HTTP/1.1" 200 -
2025-06-11 21:31:41,434 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'Menu'}
2025-06-11 21:31:41,439 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Olumayowa Oyaleke! 👋\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order', 'title': '🛒 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_assistant', 'title': '🤖 AI Assistant'}}, {'type': 'reply', 'reply': {'id': 'others', 'title': '⚙️ Others'}}]}}}
2025-06-11 21:31:42,357 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjE4QkE3REQyMEJERUQzQjg5NQA="}]}
2025-06-11 21:31:42,358 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjE4QkE3REQyMEJERUQzQjg5NQA='}]}
2025-06-11 21:31:42,358 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 21:31:42] "POST /webhook HTTP/1.1" 200 -
2025-06-11 21:31:42,994 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 21:31:42] "POST /webhook HTTP/1.1" 200 -
2025-06-11 21:31:44,574 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 21:31:44] "POST /webhook HTTP/1.1" 200 -
2025-06-11 21:31:44,578 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 21:31:44] "POST /webhook HTTP/1.1" 200 -
2025-06-11 21:32:18,700 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'order'}
2025-06-11 21:32:18,714 - handlers.base_handler - INFO - GreetingHandler: Handling message 'order' in greeting state for session 2347082345056.
2025-06-11 21:32:18,714 - handlers.base_handler - INFO - Session 2347082345056 redirecting to menu_handler for classic menu.
2025-06-11 21:32:18,715 - handlers.message_processor - INFO - Redirecting session 2347082345056 to 'menu_handler' with message 'show_menu'
2025-06-11 21:32:18,715 - handlers.base_handler - INFO - MenuHandler: Received message 'show_menu' (original: 'order') in menu state for session 2347082345056
2025-06-11 21:32:18,715 - handlers.base_handler - INFO - Showing menu categories for session 2347082345056
2025-06-11 21:32:18,716 - handlers.base_handler - INFO - Available categories: ['Main Dishes', 'Soups & Stews', 'Sides', 'Snacks', 'Drinks', 'Desserts', 'Specialties']
2025-06-11 21:32:18,716 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'list', 'body': {'text': '🍽️ *Our Menu*\n\nChoose a category to browse items:'}, 'action': {'button': 'Categories', 'sections': [{'title': 'Menu Categories', 'rows': [{'id': 'main dishes', 'title': 'Main Dishes'}, {'id': 'soups & stews', 'title': 'Soups & Stews'}, {'id': 'sides', 'title': 'Sides'}, {'id': 'snacks', 'title': 'Snacks'}, {'id': 'drinks', 'title': 'Drinks'}, {'id': 'desserts', 'title': 'Desserts'}, {'id': 'specialties', 'title': 'Specialties'}]}]}}}
2025-06-11 21:32:22,324 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjFBRjAzN0QxNThDREFBRUNEOQA="}]}
2025-06-11 21:32:22,325 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjFBRjAzN0QxNThDREFBRUNEOQA='}]}
2025-06-11 21:32:22,326 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 21:32:22] "POST /webhook HTTP/1.1" 200 -
2025-06-11 21:32:23,043 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 21:32:23] "POST /webhook HTTP/1.1" 200 -
2025-06-11 21:32:24,265 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 21:32:24] "POST /webhook HTTP/1.1" 200 -
2025-06-11 21:32:24,642 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 21:32:24] "POST /webhook HTTP/1.1" 200 -
2025-06-11 21:32:29,875 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'Menu'}
2025-06-11 21:32:29,885 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Olumayowa Oyaleke! 👋\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order', 'title': '🛒 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_assistant', 'title': '🤖 AI Assistant'}}, {'type': 'reply', 'reply': {'id': 'others', 'title': '⚙️ Others'}}]}}}
2025-06-11 21:32:30,833 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkU5QzM2QjAzRDUzMUJFMjk5NwA="}]}
2025-06-11 21:32:30,834 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkU5QzM2QjAzRDUzMUJFMjk5NwA='}]}
2025-06-11 21:32:30,835 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 21:32:30] "POST /webhook HTTP/1.1" 200 -
2025-06-11 21:32:31,676 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 21:32:31] "POST /webhook HTTP/1.1" 200 -
2025-06-11 21:32:32,278 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 21:32:32] "POST /webhook HTTP/1.1" 200 -
2025-06-11 21:32:32,415 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 21:32:32] "POST /webhook HTTP/1.1" 200 -
2025-06-11 21:32:35,354 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'ai_assistant'}
2025-06-11 21:32:35,362 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_assistant' in greeting state for session 2347082345056.
2025-06-11 21:32:35,363 - handlers.base_handler - INFO - Session 2347082345056 redirecting to AIHandler for AI menu.
2025-06-11 21:32:35,363 - handlers.message_processor - INFO - Redirecting session 2347082345056 to 'ai_handler' with message 'initial_entry'
2025-06-11 21:32:35,365 - handlers.base_handler - INFO - AIHandler: Handling message 'initial_entry' in AI menu state for session 2347082345056. Original: 'ai_assistant'
2025-06-11 21:32:35,366 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🤖 *AI Assistant Options*\n\n🤖 *Lola Chatbot* - Chat with our AI assistant\n🛒 *AI Bulk Order* - Order multiple items at once\n\nPlease select an AI option:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'lola_chatbot', 'title': '🤖 Lola Chatbot'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order', 'title': '🛒 AI Bulk Order'}}, {'type': 'reply', 'reply': {'id': 'back_to_main', 'title': '🔙 Back to Main'}}]}}}
2025-06-11 21:32:36,415 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkZENTBENjlENjZCMjI2QzMzQQA="}]}
2025-06-11 21:32:36,416 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkZENTBENjlENjZCMjI2QzMzQQA='}]}
2025-06-11 21:32:36,417 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 21:32:36] "POST /webhook HTTP/1.1" 200 -
2025-06-11 21:32:37,319 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 21:32:37] "POST /webhook HTTP/1.1" 200 -
2025-06-11 21:32:37,659 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 21:32:37] "POST /webhook HTTP/1.1" 200 -
2025-06-11 21:32:38,189 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 21:32:38] "POST /webhook HTTP/1.1" 200 -
2025-06-11 21:32:53,146 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'lola_chatbot'}
2025-06-11 21:32:53,161 - handlers.base_handler - INFO - AIHandler: Handling message 'lola_chatbot' in AI menu state for session 2347082345056. Original: 'lola_chatbot'
2025-06-11 21:32:53,162 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'text', 'text': {'body': "🤖 *Hi! I'm Lola, your AI assistant!*\n\nI can help you with:\n• Menu recommendations\n• Order assistance\n• General questions about our food\n• Nutritional information\n\nWhat would you like to know? Just ask me anything! 😊\n\n_Type 'menu' to go back to the main menu_"}}
2025-06-11 21:32:54,173 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjMyRUU3Q0VCMTk1QkRFMDNBRAA="}]}
2025-06-11 21:32:54,174 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjMyRUU3Q0VCMTk1QkRFMDNBRAA='}]}
2025-06-11 21:32:54,175 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 21:32:54] "POST /webhook HTTP/1.1" 200 -
2025-06-11 21:32:54,816 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 21:32:54] "POST /webhook HTTP/1.1" 200 -
2025-06-11 21:32:56,434 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 21:32:56] "POST /webhook HTTP/1.1" 200 -
2025-06-11 21:32:56,785 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 21:32:56] "POST /webhook HTTP/1.1" 200 -
2025-06-11 21:35:22,390 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'Menu recommendations'}
2025-06-11 21:35:22,394 - handlers.base_handler - INFO - AIHandler: Handling message 'menu recommendations' in Lola chat state for session 2347082345056. Original: 'Menu recommendations'
2025-06-11 21:35:24,020 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-11 21:35:24,021 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'text', 'text': {'body': "Hey there! If you're looking for a tasty meal at Chicken Republic, I'd recommend trying our delicious Spicy Chicken Wings or the yummy Chicken Republic Burger. And don't forget to add some tasty sides like our famous Chicken Republic Fries or Coleslaw. Feel free to ask if you need more recommendations or nutritional info! How can I assist you today?\n\n_Type 'menu' to return to main menu_ 🤖"}}
2025-06-11 21:35:25,240 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkEwOTA5Qzg2MEE0MjM4QTg4QgA="}]}
2025-06-11 21:35:25,241 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkEwOTA5Qzg2MEE0MjM4QTg4QgA='}]}
2025-06-11 21:35:25,243 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 21:35:25] "POST /webhook HTTP/1.1" 200 -
2025-06-11 21:35:25,897 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 21:35:25] "POST /webhook HTTP/1.1" 200 -
2025-06-11 21:35:28,120 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 21:35:28] "POST /webhook HTTP/1.1" 200 -
2025-06-11 21:35:28,128 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 21:35:28] "POST /webhook HTTP/1.1" 200 -
2025-06-11 21:40:30,407 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'I want 2 roasted chicken'}
2025-06-11 21:40:30,414 - handlers.base_handler - INFO - AIHandler: Handling message 'i want 2 roasted chicken' in Lola chat state for session 2347082345056. Original: 'I want 2 roasted chicken'
2025-06-11 21:40:32,881 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-11 21:40:32,894 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'text', 'text': {'body': "Great choice! Our roasted chicken is delicious and full of flavor. You can order 2 roasted chickens through our regular menu or use our AI bulk order feature for larger quantities. How many sides would you like with your order?\n\n_Type 'menu' to return to main menu_ 🤖"}}
2025-06-11 21:40:33,921 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjYwQTNGRUVBOUQwRTk4QTY3RgA="}]}
2025-06-11 21:40:33,921 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjYwQTNGRUVBOUQwRTk4QTY3RgA='}]}
2025-06-11 21:40:33,922 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 21:40:33] "POST /webhook HTTP/1.1" 200 -
2025-06-11 21:40:34,923 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 21:40:34] "POST /webhook HTTP/1.1" 200 -
2025-06-11 21:40:36,341 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 21:40:36] "POST /webhook HTTP/1.1" 200 -
2025-06-11 21:40:36,463 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 21:40:36] "POST /webhook HTTP/1.1" 200 -
2025-06-11 21:40:49,136 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'Menu'}
2025-06-11 21:40:49,140 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Olumayowa Oyaleke! 👋\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order', 'title': '🛒 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_assistant', 'title': '🤖 AI Assistant'}}, {'type': 'reply', 'reply': {'id': 'others', 'title': '⚙️ Others'}}]}}}
2025-06-11 21:40:50,024 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjhDMDk3RUQ4Q0UwQTdFNTJDOAA="}]}
2025-06-11 21:40:50,025 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjhDMDk3RUQ4Q0UwQTdFNTJDOAA='}]}
2025-06-11 21:40:50,026 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 21:40:50] "POST /webhook HTTP/1.1" 200 -
2025-06-11 21:40:51,185 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 21:40:51] "POST /webhook HTTP/1.1" 200 -
2025-06-11 21:40:51,913 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 21:40:51] "POST /webhook HTTP/1.1" 200 -
2025-06-11 21:40:52,542 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 21:40:52] "POST /webhook HTTP/1.1" 200 -
2025-06-11 21:41:18,746 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'ai_assistant'}
2025-06-11 21:41:18,750 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_assistant' in greeting state for session 2347082345056.
2025-06-11 21:41:18,750 - handlers.base_handler - INFO - Session 2347082345056 redirecting to AIHandler for AI menu.
2025-06-11 21:41:18,751 - handlers.message_processor - INFO - Redirecting session 2347082345056 to 'ai_handler' with message 'initial_entry'
2025-06-11 21:41:18,751 - handlers.base_handler - INFO - AIHandler: Handling message 'initial_entry' in AI menu state for session 2347082345056. Original: 'ai_assistant'
2025-06-11 21:41:18,751 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🤖 *AI Assistant Options*\n\n🤖 *Lola Chatbot* - Chat with our AI assistant\n🛒 *AI Bulk Order* - Order multiple items at once\n\nPlease select an AI option:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'lola_chatbot', 'title': '🤖 Lola Chatbot'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order', 'title': '🛒 AI Bulk Order'}}, {'type': 'reply', 'reply': {'id': 'back_to_main', 'title': '🔙 Back to Main'}}]}}}
2025-06-11 21:41:19,721 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjNCMkFGNTAzM0U1RUFGNDdBOAA="}]}
2025-06-11 21:41:19,721 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjNCMkFGNTAzM0U1RUFGNDdBOAA='}]}
2025-06-11 21:41:19,722 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 21:41:19] "POST /webhook HTTP/1.1" 200 -
2025-06-11 21:41:20,561 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 21:41:20] "POST /webhook HTTP/1.1" 200 -
2025-06-11 21:41:21,312 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 21:41:21] "POST /webhook HTTP/1.1" 200 -
2025-06-11 21:41:21,453 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 21:41:21] "POST /webhook HTTP/1.1" 200 -
2025-06-11 21:43:25,075 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'ai_bulk_order'}
2025-06-11 21:43:25,081 - handlers.base_handler - INFO - AIHandler: Handling message 'ai_bulk_order' in AI menu state for session 2347082345056. Original: 'ai_bulk_order'
2025-06-11 21:43:25,081 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'text', 'text': {'body': '🛒 *AI Bulk Order Assistant*\n\nTell me everything you want to order in one message! For example:\n\n_"2 chief burgers with drinks, 3 jollof rice with chicken, large fries and 4 cokes"_\n\nI\'ll understand your order and help you confirm it! 🚀\n\n_Type \'menu\' to go back to the main menu_'}}
2025-06-11 21:43:26,171 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjlGNTA3NTMzNkU2ODRFMTgzMwA="}]}
2025-06-11 21:43:26,172 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjlGNTA3NTMzNkU2ODRFMTgzMwA='}]}
2025-06-11 21:43:26,172 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 21:43:26] "POST /webhook HTTP/1.1" 200 -
2025-06-11 21:43:26,945 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 21:43:26] "POST /webhook HTTP/1.1" 200 -
2025-06-11 21:43:27,957 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 21:43:27] "POST /webhook HTTP/1.1" 200 -
2025-06-11 21:43:27,959 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 21:43:27] "POST /webhook HTTP/1.1" 200 -
2025-06-11 21:44:29,148 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'I want 4 burgers 3 jollof rice and 2 roasted chicken'}
2025-06-11 21:44:29,154 - handlers.base_handler - INFO - AIHandler: Handling message 'i want 4 burgers 3 jollof rice and 2 roasted chicken' in AI bulk order state for session 2347082345056. Original: 'I want 4 burgers 3 jollof rice and 2 roasted chicken'
2025-06-11 21:44:32,180 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-11 21:44:32,192 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🛒 *Order Summary:*\n\n✅ 4x Spicy Suya Burger - ₦4,800\n✅ 3x Vegan Jollof Rice with Tofu - ₦4,500\n✅ 2x Suya-Spiced Chicken Platter - ₦3,200\n\n*Total: ₦12,500.00*\n\nWould you like to proceed with this order?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'confirm_ai_order', 'title': '✅ Confirm Order'}}, {'type': 'reply', 'reply': {'id': 'modify_ai_order', 'title': '✏️ Modify Order'}}, {'type': 'reply', 'reply': {'id': 'cancel_ai_order', 'title': '❌ Cancel'}}]}}}
2025-06-11 21:44:33,110 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjM2NDMzRDBDQTNFMjBGMzI2NAA="}]}
2025-06-11 21:44:33,110 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjM2NDMzRDBDQTNFMjBGMzI2NAA='}]}
2025-06-11 21:44:33,111 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 21:44:33] "POST /webhook HTTP/1.1" 200 -
2025-06-11 21:44:33,852 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 21:44:33] "POST /webhook HTTP/1.1" 200 -
2025-06-11 21:44:35,616 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 21:44:35] "POST /webhook HTTP/1.1" 200 -
2025-06-11 21:44:35,901 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 21:44:35] "POST /webhook HTTP/1.1" 200 -
2025-06-11 21:45:22,313 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'modify_ai_order'}
2025-06-11 21:45:22,316 - handlers.base_handler - INFO - User chose to modify AI order for session 2347082345056.
2025-06-11 21:45:22,316 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'text', 'text': {'body': 'Please tell me your updated order:'}}
2025-06-11 21:45:23,263 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkVBMTFCMjkxRTYyOEYyOEQzQgA="}]}
2025-06-11 21:45:23,264 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkVBMTFCMjkxRTYyOEYyOEQzQgA='}]}
2025-06-11 21:45:23,265 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 21:45:23] "POST /webhook HTTP/1.1" 200 -
2025-06-11 21:45:24,390 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 21:45:24] "POST /webhook HTTP/1.1" 200 -
2025-06-11 21:45:24,749 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 21:45:24] "POST /webhook HTTP/1.1" 200 -
2025-06-11 21:45:24,884 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 21:45:24] "POST /webhook HTTP/1.1" 200 -
2025-06-11 21:45:45,225 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'I want 3 fried rice'}
2025-06-11 21:45:45,229 - handlers.base_handler - INFO - AIHandler: Handling message 'i want 3 fried rice' in AI bulk order state for session 2347082345056. Original: 'I want 3 fried rice'
2025-06-11 21:45:47,111 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-11 21:45:47,112 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🛒 *Order Summary:*\n\n✅ 3x Fried Rice Fiesta - ₦4,200\n\n*Total: ₦4,200.00*\n\nWould you like to proceed with this order?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'confirm_ai_order', 'title': '✅ Confirm Order'}}, {'type': 'reply', 'reply': {'id': 'modify_ai_order', 'title': '✏️ Modify Order'}}, {'type': 'reply', 'reply': {'id': 'cancel_ai_order', 'title': '❌ Cancel'}}]}}}
2025-06-11 21:45:48,230 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjcyM0VGQ0JGMDY4NDM5NjY4MQA="}]}
2025-06-11 21:45:48,230 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjcyM0VGQ0JGMDY4NDM5NjY4MQA='}]}
2025-06-11 21:45:48,231 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 21:45:48] "POST /webhook HTTP/1.1" 200 -
2025-06-11 21:45:49,063 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 21:45:49] "POST /webhook HTTP/1.1" 200 -
2025-06-11 21:45:50,330 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 21:45:50] "POST /webhook HTTP/1.1" 200 -
2025-06-11 21:45:50,605 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 21:45:50] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:31:30,753 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'confirm_ai_order'}
2025-06-11 22:31:30,756 - utils.session_manager - INFO - Session 2347082345056 timed out after 2743.64 seconds (timeout limit: 600s). Resetting.
2025-06-11 22:31:30,817 - handlers.base_handler - INFO - Session 2347082345056 initialized with greeting state for user 'Olumayowa Oyaleke'.
2025-06-11 22:31:30,819 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Olumayowa Oyaleke! 👋\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order', 'title': '🛒 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_assistant', 'title': '🤖 AI Assistant'}}, {'type': 'reply', 'reply': {'id': 'others', 'title': '⚙️ Others'}}]}}}
2025-06-11 22:31:32,117 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjM4QkQ0MTRCRTA0QjFGMTNGMwA="}]}
2025-06-11 22:31:32,118 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjM4QkQ0MTRCRTA0QjFGMTNGMwA='}]}
2025-06-11 22:31:32,119 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:31:32] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:31:33,233 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:31:33] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:31:33,732 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:31:33] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:31:33,779 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:31:33] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:31:39,759 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'ai_assistant'}
2025-06-11 22:31:39,767 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_assistant' in greeting state for session 2347082345056.
2025-06-11 22:31:39,768 - handlers.base_handler - INFO - Session 2347082345056 redirecting to AIHandler for AI menu.
2025-06-11 22:31:39,769 - handlers.message_processor - INFO - Redirecting session 2347082345056 to 'ai_handler' with message 'initial_entry'
2025-06-11 22:31:39,770 - handlers.base_handler - INFO - AIHandler: Handling message 'initial_entry' in AI menu state for session 2347082345056. Original: 'ai_assistant'
2025-06-11 22:31:39,772 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🤖 *AI Assistant Options*\n\n🤖 *Lola Chatbot* - Chat with our AI assistant\n🛒 *AI Bulk Order* - Order multiple items at once\n\nPlease select an AI option:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'lola_chatbot', 'title': '🤖 Lola Chatbot'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order', 'title': '🛒 AI Bulk Order'}}, {'type': 'reply', 'reply': {'id': 'back_to_main', 'title': '🔙 Back to Main'}}]}}}
2025-06-11 22:31:41,045 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjM0NTQwRTY1QzZBQTRDRjJEMAA="}]}
2025-06-11 22:31:41,046 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjM0NTQwRTY1QzZBQTRDRjJEMAA='}]}
2025-06-11 22:31:41,047 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:31:41] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:31:41,987 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:31:41] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:31:42,128 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:31:42] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:31:42,178 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:31:42] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:31:45,052 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'ai_bulk_order'}
2025-06-11 22:31:45,059 - handlers.base_handler - INFO - AIHandler: Handling message 'ai_bulk_order' in AI menu state for session 2347082345056. Original: 'ai_bulk_order'
2025-06-11 22:31:45,061 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'text', 'text': {'body': '🛒 *AI Bulk Order Assistant*\n\nTell me everything you want to order in one message! For example:\n\n_"2 chief burgers with drinks, 3 jollof rice with chicken, large fries and 4 cokes"_\n\nI\'ll understand your order and help you confirm it! 🚀\n\n_Type \'menu\' to go back to the main menu_'}}
2025-06-11 22:31:46,046 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjNENDVEMTU4QzZDM0MwOUI0QgA="}]}
2025-06-11 22:31:46,046 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjNENDVEMTU4QzZDM0MwOUI0QgA='}]}
2025-06-11 22:31:46,047 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:31:46] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:31:46,958 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:31:46] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:31:47,268 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:31:47] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:31:47,272 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:31:47] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:32:45,625 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': '3 jollof rice, 2 fried rice , 3 roasted chicken and one large fries'}
2025-06-11 22:32:45,633 - handlers.base_handler - INFO - AIHandler: Handling message '3 jollof rice, 2 fried rice , 3 roasted chicken and one large fries' in AI bulk order state for session 2347082345056. Original: '3 jollof rice, 2 fried rice , 3 roasted chicken and one large fries'
2025-06-11 22:32:49,410 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-11 22:32:49,465 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': "🛒 *Order Summary:*\n\n✅ 2x Fried Rice Fiesta - ₦2,800\n✅ 3x Suya-Spiced Chicken Platter - ₦4,800\n✅ 1x Yam Fries with Pepper Dip - ₦600\n\n❓ *Need Clarification:*\n⚠️ 3x jollof rice (Which 'jollof rice' did you mean?)\n\n*Total: ₦8,200.00*\n\nPlease help me clarify:"}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'smoky_jollof_fiesta', 'title': 'Smoky Jollof Fiesta'}}, {'type': 'reply', 'reply': {'id': 'vegan_jollof_rice_with_tofu', 'title': 'Vegan Jollof Rice with Tofu'}}, {'type': 'reply', 'reply': {'id': 'cancel_ai_order', 'title': '❌ Cancel Order'}}]}}}
2025-06-11 22:32:50,229 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 400 Client Error: Bad Request for url: https://graph.facebook.com/v17.0/608867502309431/messages - {"error":{"message":"(#131009) Parameter value is not valid","type":"OAuthException","code":131009,"error_data":{"messaging_product":"whatsapp","details":"Button title length invalid. Min length: 1, Max length: 20"},"fbtrace_id":"AghGRW6MIEE1yruIPMszh9v"}}
2025-06-11 22:32:50,230 - handlers.message_processor - WARNING - No response for handler 'ai_handler', state 'ai_bulk_order' for session 2347082345056
2025-06-11 22:32:50,230 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'text', 'text': {'body': "I'm sorry, I didn't quite understand that. Let's get back to the main menu."}}
2025-06-11 22:32:51,502 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjQ5NDFBMzI2M0JCMTFDRTI1MgA="}]}
2025-06-11 22:32:51,504 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Olumayowa Oyaleke! 👋\n\nPlease choose from the options below:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order', 'title': '🛒 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_assistant', 'title': '🤖 AI Assistant'}}, {'type': 'reply', 'reply': {'id': 'others', 'title': '⚙️ Others'}}]}}}
2025-06-11 22:32:51,917 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:32:51] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:32:52,401 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjJFQzU2N0I4RDc4QjhDNDY0MwA="}]}
2025-06-11 22:32:52,402 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjJFQzU2N0I4RDc4QjhDNDY0MwA='}]}
2025-06-11 22:32:52,403 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:32:52] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:32:52,467 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:32:52] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:32:52,691 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:32:52] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:32:53,269 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:32:53] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:32:53,719 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:32:53] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:32:54,033 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:32:54] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:33:08,743 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'ai_assistant'}
2025-06-11 22:33:08,753 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': "Please choose one of the *exact* options for clarification or type 'menu' to go back to the main menu:"}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'smoky_jollof_fiesta', 'title': 'Smoky Jollof Fiesta'}}, {'type': 'reply', 'reply': {'id': 'vegan_jollof_rice_with_tofu', 'title': 'Vegan Jollof Rice with Tofu'}}, {'type': 'reply', 'reply': {'id': 'cancel_ai_order', 'title': '❌ Cancel Order'}}]}}}
2025-06-11 22:33:09,391 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 400 Client Error: Bad Request for url: https://graph.facebook.com/v17.0/608867502309431/messages - {"error":{"message":"(#131009) Parameter value is not valid","type":"OAuthException","code":131009,"error_data":{"messaging_product":"whatsapp","details":"Button title length invalid. Min length: 1, Max length: 20"},"fbtrace_id":"AuDdw_imnlnMqcjkqRJJ1s-"}}
2025-06-11 22:33:09,395 - handlers.message_processor - WARNING - No response for handler 'ai_handler', state 'ai_order_clarification' for session 2347082345056
2025-06-11 22:33:09,396 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'text', 'text': {'body': "I'm sorry, I didn't quite understand that. Let's get back to the main menu."}}
2025-06-11 22:33:10,367 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjJGRjA2NUNDQUVBRkFGMjA2RgA="}]}
2025-06-11 22:33:10,371 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Olumayowa Oyaleke! 👋\n\nPlease choose from the options below:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order', 'title': '🛒 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_assistant', 'title': '🤖 AI Assistant'}}, {'type': 'reply', 'reply': {'id': 'others', 'title': '⚙️ Others'}}]}}}
2025-06-11 22:33:11,299 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:33:11] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:33:11,386 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjQzODU5NjBEOUMyNjE1NzUyMwA="}]}
2025-06-11 22:33:11,388 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjQzODU5NjBEOUMyNjE1NzUyMwA='}]}
2025-06-11 22:33:11,389 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:33:11] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:33:11,635 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:33:11] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:33:11,799 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:33:11] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:33:12,177 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:33:12] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:33:12,782 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:33:12] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:33:13,014 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:33:13] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:33:16,970 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'ai_assistant'}
2025-06-11 22:33:16,980 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': "Please choose one of the *exact* options for clarification or type 'menu' to go back to the main menu:"}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'smoky_jollof_fiesta', 'title': 'Smoky Jollof Fiesta'}}, {'type': 'reply', 'reply': {'id': 'vegan_jollof_rice_with_tofu', 'title': 'Vegan Jollof Rice with Tofu'}}, {'type': 'reply', 'reply': {'id': 'cancel_ai_order', 'title': '❌ Cancel Order'}}]}}}
2025-06-11 22:33:17,628 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 400 Client Error: Bad Request for url: https://graph.facebook.com/v17.0/608867502309431/messages - {"error":{"message":"(#131009) Parameter value is not valid","type":"OAuthException","code":131009,"error_data":{"messaging_product":"whatsapp","details":"Button title length invalid. Min length: 1, Max length: 20"},"fbtrace_id":"A6EOwvbwXnnbP2TnEnAgwEq"}}
2025-06-11 22:33:17,630 - handlers.message_processor - WARNING - No response for handler 'ai_handler', state 'ai_order_clarification' for session 2347082345056
2025-06-11 22:33:17,630 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'text', 'text': {'body': "I'm sorry, I didn't quite understand that. Let's get back to the main menu."}}
2025-06-11 22:33:18,571 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkJCRTI5MDBENkE5QThDRDI1RgA="}]}
2025-06-11 22:33:18,572 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Olumayowa Oyaleke! 👋\n\nPlease choose from the options below:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order', 'title': '🛒 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_assistant', 'title': '🤖 AI Assistant'}}, {'type': 'reply', 'reply': {'id': 'others', 'title': '⚙️ Others'}}]}}}
2025-06-11 22:33:19,475 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:33:19] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:33:19,812 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:33:19] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:33:20,044 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:33:20] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:33:20,142 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkJCRTI2NjRGM0VEOUQwMzE2NQA="}]}
2025-06-11 22:33:20,143 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkJCRTI2NjRGM0VEOUQwMzE2NQA='}]}
2025-06-11 22:33:20,144 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:33:20] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:33:20,839 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:33:20] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:33:21,448 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:33:21] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:33:21,542 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:33:21] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:33:23,094 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'order'}
2025-06-11 22:33:23,104 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': "Please choose one of the *exact* options for clarification or type 'menu' to go back to the main menu:"}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'smoky_jollof_fiesta', 'title': 'Smoky Jollof Fiesta'}}, {'type': 'reply', 'reply': {'id': 'vegan_jollof_rice_with_tofu', 'title': 'Vegan Jollof Rice with Tofu'}}, {'type': 'reply', 'reply': {'id': 'cancel_ai_order', 'title': '❌ Cancel Order'}}]}}}
2025-06-11 22:33:24,066 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 400 Client Error: Bad Request for url: https://graph.facebook.com/v17.0/608867502309431/messages - {"error":{"message":"(#131009) Parameter value is not valid","type":"OAuthException","code":131009,"error_data":{"messaging_product":"whatsapp","details":"Button title length invalid. Min length: 1, Max length: 20"},"fbtrace_id":"ATz8vKFqrgXDdQDRHqme1T9"}}
2025-06-11 22:33:24,068 - handlers.message_processor - WARNING - No response for handler 'ai_handler', state 'ai_order_clarification' for session 2347082345056
2025-06-11 22:33:24,068 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'text', 'text': {'body': "I'm sorry, I didn't quite understand that. Let's get back to the main menu."}}
2025-06-11 22:33:25,057 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjYxOTA0NkY0RjY3MkQ5MDAwNwA="}]}
2025-06-11 22:33:25,058 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Olumayowa Oyaleke! 👋\n\nPlease choose from the options below:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order', 'title': '🛒 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_assistant', 'title': '🤖 AI Assistant'}}, {'type': 'reply', 'reply': {'id': 'others', 'title': '⚙️ Others'}}]}}}
2025-06-11 22:33:25,720 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:33:25] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:33:26,486 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjUwRDYyMzM1MzE1MjdCRkNBMwA="}]}
2025-06-11 22:33:26,490 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjUwRDYyMzM1MzE1MjdCRkNBMwA='}]}
2025-06-11 22:33:26,491 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:33:26] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:33:26,514 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:33:26] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:33:26,540 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:33:26] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:33:27,130 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:33:27] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:33:27,897 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:33:27] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:33:27,991 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:33:27] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:44:36,125 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-11 22:44:36,125 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-11 22:44:36,126 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 22:44:36,127 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 22:44:36,127 - services.payment_service - INFO - PaymentService initialized
2025-06-11 22:44:36,127 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-11 22:44:36,128 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-11 22:44:36,128 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-11 22:44:36,128 - services.payment_service - INFO - PaymentService initialized
2025-06-11 22:44:36,129 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-11 22:44:36,129 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-11 22:44:36,130 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-11 22:44:36,131 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 22:44:36,131 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-11 22:44:36,131 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-11 22:44:36,509 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-11 22:44:36,510 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-11 22:44:36,510 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-11 22:44:36,510 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-11 22:44:36,540 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-11 22:44:36,541 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-11 22:45:14,506 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:45:14] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:45:16,987 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-11 22:45:16,988 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-11 22:45:16,993 - handlers.base_handler - INFO - Session 2348055614455 initialized with greeting state for user 'Ziga'.
2025-06-11 22:45:16,993 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Ziga! 👋\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order', 'title': '🛒 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_assistant', 'title': '🤖 AI Assistant'}}, {'type': 'reply', 'reply': {'id': 'others', 'title': '⚙️ Others'}}]}}}
2025-06-11 22:45:18,327 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQ3OTU4RTA1RUIxOTg4NEExOQA="}]}
2025-06-11 22:45:18,328 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQ3OTU4RTA1RUIxOTg4NEExOQA='}]}
2025-06-11 22:45:18,329 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:45:18] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:45:19,231 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:45:19] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:45:19,480 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:45:19] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:45:20,167 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:45:20] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:45:26,878 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_assistant'}
2025-06-11 22:45:26,881 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_assistant' in greeting state for session 2348055614455.
2025-06-11 22:45:26,882 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI menu.
2025-06-11 22:45:26,882 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'initial_entry'.
2025-06-11 22:45:26,882 - handlers.base_handler - INFO - AIHandler: Handling message 'initial_entry' in AI menu state for session 2348055614455. Original: 'ai_assistant'
2025-06-11 22:45:26,883 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🤖 *AI Assistant Options*\n\n🤖 *Lola Chatbot* - Chat with our AI assistant\n🛒 *AI Bulk Order* - Order multiple items at once\n\nPlease select an AI option:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'lola_chatbot', 'title': '🤖 Lola Chatbot'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order', 'title': '🛒 AI Bulk Order'}}, {'type': 'reply', 'reply': {'id': 'back_to_main', 'title': '🔙 Back to Main'}}]}}}
2025-06-11 22:45:27,820 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkM2MENDRkU3MEU5OTg5QTNEMQA="}]}
2025-06-11 22:45:27,821 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkM2MENDRkU3MEU5OTg5QTNEMQA='}]}
2025-06-11 22:45:27,821 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:45:27] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:45:28,680 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:45:28] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:45:28,969 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:45:28] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:45:29,160 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:45:29] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:45:30,379 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order'}
2025-06-11 22:45:30,382 - handlers.base_handler - INFO - AIHandler: Handling message 'ai_bulk_order' in AI menu state for session 2348055614455. Original: 'ai_bulk_order'
2025-06-11 22:45:30,382 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': '🛒 *AI Bulk Order Assistant*\n\nTell me everything you want to order in one message! For example:\n\n_"2 chief burgers with drinks, 3 jollof rice with chicken, large fries and 4 cokes"_\n\nI\'ll understand your order and help you confirm it! 🚀\n\n_Type \'menu\' to go back to the main menu_'}}
2025-06-11 22:45:31,329 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkRGRTgyOEQ3RTExMEYxNzg0NwA="}]}
2025-06-11 22:45:31,330 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkRGRTgyOEQ3RTExMEYxNzg0NwA='}]}
2025-06-11 22:45:31,331 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:45:31] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:45:32,337 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:45:32] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:45:32,469 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:45:32] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:45:32,710 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:45:32] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:45:43,931 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Jellof rice, puff puff'}
2025-06-11 22:45:43,938 - handlers.base_handler - INFO - AIHandler: Handling message 'jellof rice, puff puff' in AI bulk order state for session 2348055614455. Original: 'Jellof rice, puff puff'
2025-06-11 22:45:46,968 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-11 22:45:46,970 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🛒 *Order Summary:*\n\n✅ 1x Smoky Jollof Fiesta - ₦1,500\n✅ 1x Puff Puff - ₦200\n\n*Total: ₦1,700.00*\n\nWould you like to proceed with this order?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'confirm_ai_order', 'title': '✅ Confirm Order'}}, {'type': 'reply', 'reply': {'id': 'modify_ai_order', 'title': '✏️ Modify Order'}}, {'type': 'reply', 'reply': {'id': 'cancel_ai_order', 'title': '❌ Cancel'}}]}}}
2025-06-11 22:45:47,917 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkYxMzJFN0U5MjQ4NzM5RjQ5MAA="}]}
2025-06-11 22:45:47,918 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkYxMzJFN0U5MjQ4NzM5RjQ5MAA='}]}
2025-06-11 22:45:47,919 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:45:47] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:45:48,710 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:45:48] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:45:49,076 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:45:49] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:45:49,479 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:45:49] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:45:52,771 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-06-11 22:45:52,774 - handlers.base_handler - INFO - AI order confirmed. Cart: {'Smoky Jollof Fiesta': {'item_id': 'Smoky Jollof Fiesta', 'quantity': 1, 'price': 1500, 'total_price': 1500, 'variations': {}}, 'Puff Puff': {'item_id': 'Puff Puff', 'quantity': 1, 'price': 200, 'total_price': 200, 'variations': {}}}. Redirecting to order handler.
2025-06-11 22:45:52,774 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'order_handler' with message 'process_final_order'.
2025-06-11 22:45:52,774 - handlers.order_handler - INFO - AI initiated order processing for session 2348055614455.
2025-06-11 22:45:52,775 - handlers.order_handler - INFO - Address set, proceeding to confirm order for AI-initiated session 2348055614455.
2025-06-11 22:45:52,775 - handlers.order_handler - INFO - Showing final order confirmation for session 2348055614455. Total: ₦1,700.00
2025-06-11 22:45:52,775 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🛒 *Final Order Confirmation*\n\n📋 *Items Ordered:*\n• 1x Smoky Jollof Fiesta - ₦1,500.00\n• 1x Puff Puff - ₦200.00\n\n📍 *Delivery Details:*\n👤 Name: Ziga\n📱 Phone: 2348055614455\n🏠 Address: Howson Wright\n\n💰 *Total Amount: ₦1,700.00*\n\nPlease confirm to proceed with payment.'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'final_confirm', 'title': '✅ Confirm & Pay'}}, {'type': 'reply', 'reply': {'id': 'edit_order', 'title': '✏️ Edit Order'}}, {'type': 'reply', 'reply': {'id': 'cancel_order', 'title': '❌ Cancel Order'}}]}}}
2025-06-11 22:45:53,687 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkJDQjUxOUREMDgzMDdBMjg3RgA="}]}
2025-06-11 22:45:53,705 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦1,700 (2 items)
2025-06-11 22:45:53,705 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦1,700.00
2025-06-11 22:45:53,706 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkJDQjUxOUREMDgzMDdBMjg3RgA='}]}
2025-06-11 22:45:53,706 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:45:53] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:45:54,508 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:45:54] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:45:54,859 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:45:54] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:45:55,359 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:45:55] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:45:57,229 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'final_confirm'}
2025-06-11 22:45:57,231 - handlers.order_handler - INFO - Order ORDER_20250611_224557_e917dcd4 confirmed for session 2348055614455. Amount: ₦1,700.00
2025-06-11 22:45:57,235 - services.lead_tracker - INFO - Order completion tracked for 2348055614455: ORDER_20250611_224557_e917dcd4 (₦1,700)
2025-06-11 22:45:57,236 - handlers.lead_tracking_handler - INFO - 💰 Conversion tracked: 2348055614455 - ORDER_20250611_224557_e917dcd4 (₦1,700)
2025-06-11 22:45:57,236 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'payment_handler' with message 'initiate_payment'.
2025-06-11 22:45:57,237 - handlers.base_handler - INFO - Handling payment processing for session 2348055614455, message: initiate_payment
2025-06-11 22:45:57,237 - handlers.base_handler - INFO - Creating payment link for session 2348055614455
2025-06-11 22:45:57,253 - utils.data_manager - INFO - Order details saved to data\orders.json
2025-06-11 22:45:57,253 - services.payment_service - INFO - Attempting to create payment link for reference: PAY-ORDER-20250611224557-3453 with amount: 170000, email: ziga4455@foodorder.com
2025-06-11 22:45:57,852 - services.payment_service - INFO - Payment link created for Ziga Ziga (2348055614455), URL: https://checkout.paystack.com/kf0nuz9ibm82n2j
2025-06-11 22:45:57,853 - handlers.base_handler - INFO - Starting payment monitoring for order ORDER-20250611224557-3453, reference PAY-ORDER-20250611224557-3453
2025-06-11 22:45:57,854 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-ORDER-20250611224557-3453
2025-06-11 22:45:58,327 - services.payment_service - WARNING - Payment not successful for reference PAY-ORDER-20250611224557-3453. Paystack status: abandoned. Response: {'status': True, 'message': 'Verification successful', 'data': {'id': 5049179229, 'domain': 'test', 'status': 'abandoned', 'reference': 'PAY-ORDER-20250611224557-3453', 'receipt_number': None, 'amount': 170000, 'message': None, 'gateway_response': 'The transaction was not completed', 'paid_at': None, 'created_at': '2025-06-11T21:45:57.000Z', 'channel': 'card', 'currency': 'NGN', 'ip_address': '102.67.12.153, 172.71.178.28, 172.31.63.81', 'metadata': {'customer_name': 'Ziga', 'customer_phone': '2348055614455', 'first_name': 'Ziga', 'last_name': 'Ziga', 'order_id': 'ORDER-20250611224557-3453', 'delivery_address': 'Howson Wright'}, 'log': None, 'fees': None, 'fees_split': None, 'authorization': {}, 'customer': {'id': 276711440, 'first_name': None, 'last_name': None, 'email': 'ziga4455@foodorder.com', 'customer_code': 'CUS_bhkdpnbvcjqt55g', 'phone': None, 'metadata': None, 'risk_action': 'default', 'international_format_phone': None}, 'plan': None, 'split': {}, 'order_id': None, 'paidAt': None, 'createdAt': '2025-06-11T21:45:57.000Z', 'requested_amount': 170000, 'pos_transaction_data': None, 'source': None, 'fees_breakdown': None, 'connect': None, 'transaction_date': '2025-06-11T21:45:57.000Z', 'plan_object': {}, 'subaccount': {}}}
2025-06-11 22:45:58,327 - handlers.base_handler - INFO - Payment not yet verified for order ORDER-20250611224557-3453, attempt 1/15
2025-06-11 22:45:58,328 - handlers.base_handler - INFO - Payment link created successfully for order ORDER-20250611224557-3453
2025-06-11 22:45:58,328 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "🛒 *Order Created Successfully!*\n\n📋 *Order ID:* ORDER-20250611224557-3453\n💰 *Total:* ₦1,700\n\n💳 *Complete Payment:*\nhttps://checkout.paystack.com/kf0nuz9ibm82n2j\n\n✅ We'll automatically confirm your order once payment is received!\n💬 You can also send 'paid' after payment to check status immediately.\n\n⏰ Payment link expires in 15 minutes."}}
2025-06-11 22:45:59,290 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkUzN0JGNUI1MUJCQjBGNzBERQA="}]}
2025-06-11 22:45:59,293 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦1,700 (2 items)
2025-06-11 22:45:59,293 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦1,700.00
2025-06-11 22:45:59,293 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkUzN0JGNUI1MUJCQjBGNzBERQA='}]}
2025-06-11 22:45:59,294 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:45:59] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:46:00,136 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:46:00] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:46:00,401 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:46:00] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:46:00,850 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:46:00] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:46:17,000 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Paid'}
2025-06-11 22:46:17,003 - handlers.base_handler - INFO - Received 'paid' command for session 2348055614455, attempting manual verification for ref: PAY-ORDER-20250611224557-3453
2025-06-11 22:46:17,004 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-ORDER-20250611224557-3453
2025-06-11 22:46:17,509 - services.payment_service - INFO - Payment verified successfully for reference PAY-ORDER-20250611224557-3453. Status: success
2025-06-11 22:46:17,511 - handlers.base_handler - INFO - Manual payment verification successful for order ORDER-20250611224557-3453
2025-06-11 22:46:17,511 - handlers.base_handler - INFO - Payment monitoring stopped for session 2348055614455
2025-06-11 22:46:17,521 - utils.data_manager - INFO - Order details saved to data\orders.json
2025-06-11 22:46:17,524 - services.lead_tracker - INFO - Order completion tracked for 2348055614455: ORDER-20250611224557-3453 (₦1,700)
2025-06-11 22:46:17,525 - handlers.lead_tracking_handler - INFO - 💰 Conversion tracked: 2348055614455 - ORDER-20250611224557-3453 (₦1,700)
2025-06-11 22:46:17,525 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "🎉 *Payment Confirmed!*\n\n📋 *Order ID:* ORDER-20250611224557-3453\n💰 *Amount Paid:* ₦1,700\n🛒 *Items:* 🛒 *Your Cart:*\n• 1 x Smoky Jollof Fiesta (₦1,500) = ₦1,500\n• 1 x Puff Puff (₦200) = ₦200\n\n💰 *Total: ₦1,700*\n🚚 *Delivery to:* Howson Wright\n\n✅ Your order is confirmed and being processed!\n📱 You'll receive delivery updates soon.\n\n🙏 Thank you for your purchase! 😊"}}
2025-06-11 22:46:18,496 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkVBREJBODJEN0VGMTQwMDcyOQA="}]}
2025-06-11 22:46:18,497 - handlers.feedback_handler - INFO - Initiated feedback collection for order ORDER-20250611224557-3453, session 2348055614455
2025-06-11 22:46:18,497 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🎉 *Thank you for your order!*\n\n📋 Order ID: ORDER-20250611224557-3453\n\n💬 *How was your ordering experience?*\nYour feedback helps us improve our service!'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'excellent', 'title': '🤩 Excellent'}}, {'type': 'reply', 'reply': {'id': 'good', 'title': '😊 Good'}}, {'type': 'reply', 'reply': {'id': 'bad', 'title': '😞 Bad'}}]}}}
2025-06-11 22:46:19,266 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:46:19] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:46:19,420 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjMxRkQ0OUExMTA2RjYyNEFFOAA="}]}
2025-06-11 22:46:19,421 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'message': 'Payment confirmed and feedback initiated'}
2025-06-11 22:46:19,421 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:46:19] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:46:19,900 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:46:19] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:46:19,970 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:46:19] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:46:20,530 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:46:20] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:46:20,565 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:46:20] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:46:21,070 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:46:21] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:46:22,128 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'excellent'}
2025-06-11 22:46:22,130 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "🤩 *Thank you for the excellent rating!*\n\n💬 Would you like to share any specific comments about your experience?\n\nType your message or 'skip' to finish."}}
2025-06-11 22:46:23,137 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkZEMTA5QUU0RERCRUFGQTk2MQA="}]}
2025-06-11 22:46:23,137 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkZEMTA5QUU0RERCRUFGQTk2MQA='}]}
2025-06-11 22:46:23,138 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:46:23] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:46:24,077 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:46:24] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:46:24,279 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:46:24] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:46:24,440 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:46:24] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:46:28,125 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Skip'}
2025-06-11 22:46:28,140 - handlers.feedback_handler - INFO - Feedback saved to data/feedback.json
2025-06-11 22:46:28,141 - handlers.feedback_handler - INFO - Feedback saved for order ORDER-20250611224557-3453: excellent
2025-06-11 22:46:28,141 - handlers.base_handler - INFO - Session 2348055614455 returned to main menu (greeting state).
2025-06-11 22:46:28,141 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Ziga! 🙏 *Thank you for your Excellent feedback!*\n\nWe appreciate you choosing us! 😊'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '✨ Lola AI Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '⚙️ Others'}}]}}}
2025-06-11 22:46:29,025 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjJENDg5QzI3NUE3N0IyN0JGQQA="}]}
2025-06-11 22:46:29,025 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjJENDg5QzI3NUE3N0IyN0JGQQA='}]}
2025-06-11 22:46:29,026 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:46:29] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:46:29,761 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:46:29] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:46:30,229 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:46:30] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:46:30,419 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:46:30] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:46:34,474 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-11 22:46:34,476 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-06-11 22:46:34,477 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order.
2025-06-11 22:46:34,477 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-06-11 22:46:34,477 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-06-11 22:46:34,478 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': '🛒 *AI Bulk Order Assistant*\n\nTell me everything you want to order in one message! For example:\n\n_"2 chief burgers with drinks, 3 jollof rice with chicken, large fries and 4 cokes"_\n\nI\'ll understand your order and help you confirm it! 🚀\n\n_Type \'menu\' to go back to the main menu_'}}
2025-06-11 22:46:35,426 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjJFQzRDODI0REQ3NTBFOTg4NQA="}]}
2025-06-11 22:46:35,427 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjJFQzRDODI0REQ3NTBFOTg4NQA='}]}
2025-06-11 22:46:35,427 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:46:35] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:46:36,579 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:46:36] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:46:36,768 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:46:36] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:46:36,872 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:46:36] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:51:45,379 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': 'Hi'}
2025-06-11 22:51:45,379 - utils.session_manager - INFO - New session 2349030918492 initialized.
2025-06-11 22:51:45,382 - services.lead_tracker - INFO - New lead tracked: 2349030918492 (Benny)
2025-06-11 22:51:45,383 - handlers.lead_tracking_handler - INFO - 🆕 New lead detected: 2349030918492 (Benny)
2025-06-11 22:51:45,385 - handlers.base_handler - INFO - Session 2349030918492 initialized with greeting state for user 'Benny'.
2025-06-11 22:51:45,386 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Benny! 👋\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order', 'title': '🛒 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_assistant', 'title': '🤖 AI Assistant'}}, {'type': 'reply', 'reply': {'id': 'others', 'title': '⚙️ Others'}}]}}}
2025-06-11 22:51:46,407 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjYxQUQwNzFCQzVBMkZDM0I0OQA="}]}
2025-06-11 22:51:46,407 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjYxQUQwNzFCQzVBMkZDM0I0OQA='}]}
2025-06-11 22:51:46,408 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:51:46] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:51:48,843 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:51:48] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:51:49,488 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:51:49] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:51:49,623 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:51:49] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:51:50,999 - handlers.webhook_handler - WARNING - No valid message data extracted for 2349030918492. Message type: sticker
2025-06-11 22:51:50,999 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:51:50] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:51:54,177 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': 'ai_assistant'}
2025-06-11 22:51:54,181 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_assistant' in greeting state for session 2349030918492.
2025-06-11 22:51:54,181 - handlers.base_handler - INFO - Session 2349030918492 redirecting to AIHandler for AI menu.
2025-06-11 22:51:54,182 - handlers.message_processor - INFO - Redirecting session 2349030918492 to handler 'ai_handler' with message 'initial_entry'.
2025-06-11 22:51:54,182 - handlers.base_handler - INFO - AIHandler: Handling message 'initial_entry' in AI menu state for session 2349030918492. Original: 'ai_assistant'
2025-06-11 22:51:54,183 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🤖 *AI Assistant Options*\n\n🤖 *Lola Chatbot* - Chat with our AI assistant\n🛒 *AI Bulk Order* - Order multiple items at once\n\nPlease select an AI option:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'lola_chatbot', 'title': '🤖 Lola Chatbot'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order', 'title': '🛒 AI Bulk Order'}}, {'type': 'reply', 'reply': {'id': 'back_to_main', 'title': '🔙 Back to Main'}}]}}}
2025-06-11 22:51:55,160 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEkUwNzUyQzhCRUY1NzM0M0U2RgA="}]}
2025-06-11 22:51:55,161 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEkUwNzUyQzhCRUY1NzM0M0U2RgA='}]}
2025-06-11 22:51:55,161 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:51:55] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:51:56,066 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:51:56] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:51:58,600 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:51:58] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:52:10,763 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': 'lola_chatbot'}
2025-06-11 22:52:10,769 - handlers.base_handler - INFO - AIHandler: Handling message 'lola_chatbot' in AI menu state for session 2349030918492. Original: 'lola_chatbot'
2025-06-11 22:52:10,770 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'text', 'text': {'body': "🤖 *Hi! I'm Lola, your AI assistant!*\n\nI can help you with:\n• Menu recommendations\n• Order assistance\n• General questions about our food\n• Nutritional information\n\nWhat would you like to know? Just ask me anything! 😊\n\n_Type 'menu' to go back to the main menu_"}}
2025-06-11 22:52:11,657 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEkQ4RENCOTg5MTMxMDlBRDg3QgA="}]}
2025-06-11 22:52:11,657 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEkQ4RENCOTg5MTMxMDlBRDg3QgA='}]}
2025-06-11 22:52:11,658 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:52:11] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:52:12,456 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:52:12] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:52:13,041 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:52:13] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:52:29,615 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': 'ai_bulk_order'}
2025-06-11 22:52:29,619 - handlers.base_handler - INFO - AIHandler: Handling message 'ai_bulk_order' in Lola chat state for session 2349030918492. Original: 'ai_bulk_order'
2025-06-11 22:52:31,247 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-11 22:52:31,248 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'text', 'text': {'body': "Hey there! Ready to order in bulk? Just let me know how many people you're feeding, and I can help you put together a fantastic feast. Don't forget, you can also check out our regular menu for more options if you're looking for something specific. Let's get your order sorted out - no wahala! 🍗🎉\n\n_Type 'menu' to return to main menu_ 🤖"}}
2025-06-11 22:52:32,237 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjJBRTlBQkU5QkZEM0NFQjdDMwA="}]}
2025-06-11 22:52:32,238 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjJBRTlBQkU5QkZEM0NFQjdDMwA='}]}
2025-06-11 22:52:32,238 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:52:32] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:52:33,103 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:52:33] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:52:33,689 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:52:33] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:52:52,368 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': '5 people. I want to buy jollof rice'}
2025-06-11 22:52:52,371 - handlers.base_handler - INFO - AIHandler: Handling message '5 people. i want to buy jollof rice' in Lola chat state for session 2349030918492. Original: '5 people. I want to buy jollof rice'
2025-06-11 22:52:54,270 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-11 22:52:54,271 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'text', 'text': {'body': "Hey there! Jollof rice is always a great choice! For 5 people, I recommend ordering our Jollof Rice Family Pack. It's perfect for sharing and comes with a generous portion of flavorful jollof rice that everyone will enjoy. You can easily order through our regular menu or use the AI bulk order feature for a seamless experience. Let me know if you need any more help!\n\n_Type 'menu' to return to main menu_ 🤖"}}
2025-06-11 22:52:55,489 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjIwRUM5RDBFRjUyRDUxQjhGOAA="}]}
2025-06-11 22:52:55,490 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjIwRUM5RDBFRjUyRDUxQjhGOAA='}]}
2025-06-11 22:52:55,491 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:52:55] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:52:56,021 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:52:56] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:52:56,600 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:52:56] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:53:09,481 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': 'back_to_main'}
2025-06-11 22:53:09,485 - handlers.base_handler - INFO - AIHandler: Handling message 'back_to_main' in Lola chat state for session 2349030918492. Original: 'back_to_main'
2025-06-11 22:53:11,029 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-11 22:53:11,030 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'text', 'text': {'body': "Welcome back! How can I assist you today? If you're feeling hungry, I can recommend some tasty treats from our menu. Just let me know what you're in the mood for!\n\n_Type 'menu' to return to main menu_ 🤖"}}
2025-06-11 22:53:12,217 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjA5NjI4QTQ1MjRGNUI4RjM1NQA="}]}
2025-06-11 22:53:12,218 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjA5NjI4QTQ1MjRGNUI4RjM1NQA='}]}
2025-06-11 22:53:12,218 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:53:12] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:53:13,079 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:53:13] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:53:13,939 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:53:13] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:53:16,416 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': 'Menu'}
2025-06-11 22:53:16,423 - handlers.base_handler - INFO - AIHandler: Handling message 'menu' in Lola chat state for session 2349030918492. Original: 'Menu'
2025-06-11 22:53:16,424 - handlers.base_handler - INFO - Session 2349030918492 returned to main menu (greeting state).
2025-06-11 22:53:16,426 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Benny! Welcome back! How can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '✨ Lola AI Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '⚙️ Others'}}]}}}
2025-06-11 22:53:17,367 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjk3OUVBQUUxNDZGQkJEQjZFQwA="}]}
2025-06-11 22:53:17,368 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Benny! 👋\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order', 'title': '🛒 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_assistant', 'title': '🤖 AI Assistant'}}, {'type': 'reply', 'reply': {'id': 'others', 'title': '⚙️ Others'}}]}}}
2025-06-11 22:53:18,110 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:53:18] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:53:18,301 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjQ1QzM2MDVCNkUzMDlCNThDQgA="}]}
2025-06-11 22:53:18,302 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjQ1QzM2MDVCNkUzMDlCNThDQgA='}]}
2025-06-11 22:53:18,303 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:53:18] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:53:18,873 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:53:18] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:53:19,062 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:53:19] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:53:19,888 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:53:19] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:53:20,807 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': 'order'}
2025-06-11 22:53:20,811 - handlers.base_handler - INFO - GreetingHandler: Handling message 'order' in greeting state for session 2349030918492.
2025-06-11 22:53:20,812 - handlers.base_handler - INFO - Session 2349030918492 redirecting to menu_handler for classic menu.
2025-06-11 22:53:20,812 - handlers.message_processor - INFO - Redirecting session 2349030918492 to handler 'menu_handler' with message 'show_menu'.
2025-06-11 22:53:20,813 - handlers.base_handler - INFO - MenuHandler: Received message 'show_menu' (original: 'order') in menu state for session 2349030918492
2025-06-11 22:53:20,813 - handlers.base_handler - INFO - Showing menu categories for session 2349030918492
2025-06-11 22:53:20,813 - handlers.base_handler - INFO - Available categories: ['Main Dishes', 'Soups & Stews', 'Sides', 'Snacks', 'Drinks', 'Desserts', 'Specialties']
2025-06-11 22:53:20,814 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'interactive', 'interactive': {'type': 'list', 'body': {'text': '🍽️ *Our Menu*\n\nChoose a category to browse items:'}, 'action': {'button': 'Categories', 'sections': [{'title': 'Menu Categories', 'rows': [{'id': 'main dishes', 'title': 'Main Dishes'}, {'id': 'soups & stews', 'title': 'Soups & Stews'}, {'id': 'sides', 'title': 'Sides'}, {'id': 'snacks', 'title': 'Snacks'}, {'id': 'drinks', 'title': 'Drinks'}, {'id': 'desserts', 'title': 'Desserts'}, {'id': 'specialties', 'title': 'Specialties'}]}]}}}
2025-06-11 22:53:21,867 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjVEMjVFRkQyOThFQzUzQjdDNQA="}]}
2025-06-11 22:53:21,868 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjVEMjVFRkQyOThFQzUzQjdDNQA='}]}
2025-06-11 22:53:21,869 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:53:21] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:53:22,652 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:53:22] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:53:23,692 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:53:23] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:53:24,061 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': 'ai_assistant'}
2025-06-11 22:53:24,070 - handlers.base_handler - INFO - MenuHandler: Received message 'ai_assistant' (original: 'ai_assistant') in menu state for session 2349030918492
2025-06-11 22:53:24,071 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'text', 'text': {'body': "❌ Invalid selection: 'ai_assistant'\n\nPlease select from these categories:\nMain Dishes, Soups & Stews, Sides, Snacks, Drinks, Desserts, Specialties\n\nOr type 'back' to return to main menu."}}
2025-06-11 22:53:25,031 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEkM1NTk2MzVBNkVGODc5QkQwOQA="}]}
2025-06-11 22:53:25,032 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEkM1NTk2MzVBNkVGODc5QkQwOQA='}]}
2025-06-11 22:53:25,032 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:53:25] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:53:25,762 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:53:25] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:53:25,959 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:53:25] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:53:31,005 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': 'Back'}
2025-06-11 22:53:31,010 - handlers.base_handler - INFO - MenuHandler: Received message 'back' (original: 'Back') in menu state for session 2349030918492
2025-06-11 22:53:31,011 - handlers.base_handler - INFO - Session 2349030918492 returned to main menu (greeting state).
2025-06-11 22:53:31,011 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Benny! Welcome back! How can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '✨ Lola AI Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '⚙️ Others'}}]}}}
2025-06-11 22:53:31,899 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEkREREY3NTEwMTE4QzUyRENGRQA="}]}
2025-06-11 22:53:31,899 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEkREREY3NTEwMTE4QzUyRENGRQA='}]}
2025-06-11 22:53:31,900 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:53:31] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:53:32,873 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:53:32] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:53:33,240 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:53:33] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:53:35,048 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-11 22:53:35,053 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2349030918492.
2025-06-11 22:53:35,053 - handlers.base_handler - INFO - Session 2349030918492 redirecting to AIHandler for AI Bulk Order.
2025-06-11 22:53:35,054 - handlers.message_processor - INFO - Redirecting session 2349030918492 to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-06-11 22:53:35,055 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2349030918492. Original: 'ai_bulk_order_direct'
2025-06-11 22:53:35,055 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'text', 'text': {'body': '🛒 *AI Bulk Order Assistant*\n\nTell me everything you want to order in one message! For example:\n\n_"2 chief burgers with drinks, 3 jollof rice with chicken, large fries and 4 cokes"_\n\nI\'ll understand your order and help you confirm it! 🚀\n\n_Type \'menu\' to go back to the main menu_'}}
2025-06-11 22:53:36,018 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjc0REExOTYyOTNDNTc3OENGRAA="}]}
2025-06-11 22:53:36,018 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjc0REExOTYyOTNDNTc3OENGRAA='}]}
2025-06-11 22:53:36,019 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:53:36] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:53:36,674 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:53:36] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:53:37,055 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:53:37] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:54:03,384 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': '1 plate of jollof rice and chicken'}
2025-06-11 22:54:03,388 - handlers.base_handler - INFO - AIHandler: Handling message '1 plate of jollof rice and chicken' in AI bulk order state for session 2349030918492. Original: '1 plate of jollof rice and chicken'
2025-06-11 22:54:05,797 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-11 22:54:05,798 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🛒 *Order Summary:*\n\n✅ 1x Smoky Jollof Fiesta - ₦1,500\n✅ 1x Suya-Spiced Chicken Platter - ₦1,600\n\n*Total: ₦3,100.00*\n\nWould you like to proceed with this order?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'confirm_ai_order', 'title': '✅ Confirm Order'}}, {'type': 'reply', 'reply': {'id': 'modify_ai_order', 'title': '✏️ Modify Order'}}, {'type': 'reply', 'reply': {'id': 'cancel_ai_order', 'title': '❌ Cancel'}}]}}}
2025-06-11 22:54:06,767 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEkVERDdCRUY4NkVENkEwODg5MgA="}]}
2025-06-11 22:54:06,768 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEkVERDdCRUY4NkVENkEwODg5MgA='}]}
2025-06-11 22:54:06,769 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:54:06] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:54:07,510 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:54:07] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:54:08,833 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:54:08] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:54:15,813 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': 'modify_ai_order'}
2025-06-11 22:54:15,817 - handlers.base_handler - INFO - User chose to modify AI order for session 2349030918492.
2025-06-11 22:54:15,817 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'text', 'text': {'body': 'Please tell me your updated order:'}}
2025-06-11 22:54:16,767 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjg0OTE5NjgxMkRBODZDNUMwQgA="}]}
2025-06-11 22:54:16,768 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjg0OTE5NjgxMkRBODZDNUMwQgA='}]}
2025-06-11 22:54:16,769 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:54:16] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:54:17,470 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:54:17] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:54:18,619 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:54:18] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:54:27,884 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': '1 Jollof rice'}
2025-06-11 22:54:27,888 - handlers.base_handler - INFO - AIHandler: Handling message '1 jollof rice' in AI bulk order state for session 2349030918492. Original: '1 Jollof rice'
2025-06-11 22:54:29,698 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-11 22:54:29,699 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🛒 *Order Summary:*\n\n✅ 1x Fried Rice Fiesta - ₦1,400\n\n*Total: ₦1,400.00*\n\nWould you like to proceed with this order?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'confirm_ai_order', 'title': '✅ Confirm Order'}}, {'type': 'reply', 'reply': {'id': 'modify_ai_order', 'title': '✏️ Modify Order'}}, {'type': 'reply', 'reply': {'id': 'cancel_ai_order', 'title': '❌ Cancel'}}]}}}
2025-06-11 22:54:30,680 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjBEMDE1NEIyNEY2QzNEMzMyMAA="}]}
2025-06-11 22:54:30,681 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjBEMDE1NEIyNEY2QzNEMzMyMAA='}]}
2025-06-11 22:54:30,681 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:54:30] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:54:31,740 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:54:31] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:54:32,014 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:54:32] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:56:30,888 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': 'modify_ai_order'}
2025-06-11 22:56:30,892 - handlers.base_handler - INFO - User chose to modify AI order for session 2349030918492.
2025-06-11 22:56:30,893 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'text', 'text': {'body': 'Please tell me your updated order:'}}
2025-06-11 22:56:31,877 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEkMyM0M3MEU0OEUwMTk1MThDQwA="}]}
2025-06-11 22:56:31,878 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEkMyM0M3MEU0OEUwMTk1MThDQwA='}]}
2025-06-11 22:56:31,879 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:56:31] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:56:32,688 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:56:32] "POST /webhook HTTP/1.1" 200 -
2025-06-11 22:56:33,651 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 22:56:33] "POST /webhook HTTP/1.1" 200 -
2025-06-11 23:05:33,539 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': '1x fried rice fiesta'}
2025-06-11 23:05:33,545 - handlers.base_handler - INFO - AIHandler: Handling message '1x fried rice fiesta' in AI bulk order state for session 2349030918492. Original: '1x fried rice fiesta'
2025-06-11 23:05:36,624 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-11 23:05:36,625 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🛒 *Order Summary:*\n\n✅ 1x Fried Rice Fiesta - ₦1,400\n\n*Total: ₦1,400.00*\n\nWould you like to proceed with this order?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'confirm_ai_order', 'title': '✅ Confirm Order'}}, {'type': 'reply', 'reply': {'id': 'modify_ai_order', 'title': '✏️ Modify Order'}}, {'type': 'reply', 'reply': {'id': 'cancel_ai_order', 'title': '❌ Cancel'}}]}}}
2025-06-11 23:05:37,678 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEkE4NkZERjQ2QUYxNjZCNDJBNwA="}]}
2025-06-11 23:05:37,679 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEkE4NkZERjQ2QUYxNjZCNDJBNwA='}]}
2025-06-11 23:05:37,680 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 23:05:37] "POST /webhook HTTP/1.1" 200 -
2025-06-11 23:05:38,665 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 23:05:38] "POST /webhook HTTP/1.1" 200 -
2025-06-11 23:05:39,148 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 23:05:39] "POST /webhook HTTP/1.1" 200 -
2025-06-11 23:05:43,555 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': 'modify_ai_order'}
2025-06-11 23:05:43,560 - handlers.base_handler - INFO - User chose to modify AI order for session 2349030918492.
2025-06-11 23:05:43,561 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'text', 'text': {'body': 'Please tell me your updated order:'}}
2025-06-11 23:05:44,477 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjVBNzFDMzRERUIzMTgzODlGNwA="}]}
2025-06-11 23:05:44,478 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjVBNzFDMzRERUIzMTgzODlGNwA='}]}
2025-06-11 23:05:44,480 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 23:05:44] "POST /webhook HTTP/1.1" 200 -
2025-06-11 23:05:45,324 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 23:05:45] "POST /webhook HTTP/1.1" 200 -
2025-06-11 23:05:45,592 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 23:05:45] "POST /webhook HTTP/1.1" 200 -
2025-06-11 23:06:04,781 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': 'I fried  rice and chicken'}
2025-06-11 23:06:04,785 - handlers.base_handler - INFO - AIHandler: Handling message 'i fried  rice and chicken' in AI bulk order state for session 2349030918492. Original: 'I fried  rice and chicken'
2025-06-11 23:06:07,168 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-11 23:06:07,169 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🛒 *Order Summary:*\n\n✅ 1x Fried Rice Fiesta - ₦1,400\n✅ 1x Suya-Spiced Chicken Platter - ₦1,600\n\n*Total: ₦3,000.00*\n\nWould you like to proceed with this order?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'confirm_ai_order', 'title': '✅ Confirm Order'}}, {'type': 'reply', 'reply': {'id': 'modify_ai_order', 'title': '✏️ Modify Order'}}, {'type': 'reply', 'reply': {'id': 'cancel_ai_order', 'title': '❌ Cancel'}}]}}}
2025-06-11 23:06:08,039 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEkI0RjA2NkIyOTNEODM5RjAwOAA="}]}
2025-06-11 23:06:08,039 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEkI0RjA2NkIyOTNEODM5RjAwOAA='}]}
2025-06-11 23:06:08,040 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 23:06:08] "POST /webhook HTTP/1.1" 200 -
2025-06-11 23:06:08,800 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 23:06:08] "POST /webhook HTTP/1.1" 200 -
2025-06-11 23:06:09,689 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 23:06:09] "POST /webhook HTTP/1.1" 200 -
2025-06-11 23:06:18,010 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': 'modify_ai_order'}
2025-06-11 23:06:18,014 - handlers.base_handler - INFO - User chose to modify AI order for session 2349030918492.
2025-06-11 23:06:18,014 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'text', 'text': {'body': 'Please tell me your updated order:'}}
2025-06-11 23:06:18,948 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjgzNDIwMjRFRTk3QTIzOENCNgA="}]}
2025-06-11 23:06:18,949 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjgzNDIwMjRFRTk3QTIzOENCNgA='}]}
2025-06-11 23:06:18,949 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 23:06:18] "POST /webhook HTTP/1.1" 200 -
2025-06-11 23:06:19,679 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 23:06:19] "POST /webhook HTTP/1.1" 200 -
2025-06-11 23:06:19,858 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 23:06:19] "POST /webhook HTTP/1.1" 200 -
2025-06-11 23:06:40,958 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': '2 Suya-Spiced Chicken Platter'}
2025-06-11 23:06:40,963 - handlers.base_handler - INFO - AIHandler: Handling message '2 suya-spiced chicken platter' in AI bulk order state for session 2349030918492. Original: '2 Suya-Spiced Chicken Platter'
2025-06-11 23:06:42,998 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-11 23:06:42,999 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🛒 *Order Summary:*\n\n✅ 2x Suya-Spiced Chicken Platter - ₦3,200\n\n*Total: ₦3,200.00*\n\nWould you like to proceed with this order?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'confirm_ai_order', 'title': '✅ Confirm Order'}}, {'type': 'reply', 'reply': {'id': 'modify_ai_order', 'title': '✏️ Modify Order'}}, {'type': 'reply', 'reply': {'id': 'cancel_ai_order', 'title': '❌ Cancel'}}]}}}
2025-06-11 23:06:43,898 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEkZGRkVCRTY3RUQ1NzVEOUE2NwA="}]}
2025-06-11 23:06:43,899 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEkZGRkVCRTY3RUQ1NzVEOUE2NwA='}]}
2025-06-11 23:06:43,900 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 23:06:43] "POST /webhook HTTP/1.1" 200 -
2025-06-11 23:06:44,651 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 23:06:44] "POST /webhook HTTP/1.1" 200 -
2025-06-11 23:06:45,268 - werkzeug - INFO - 127.0.0.1 - - [11/Jun/2025 23:06:45] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:19:14,573 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-12 15:19:14,575 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-12 15:19:14,576 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-12 15:19:14,578 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-12 15:19:14,579 - services.payment_service - INFO - PaymentService initialized
2025-06-12 15:19:14,580 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-12 15:19:14,582 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-12 15:19:14,583 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-12 15:19:14,584 - services.payment_service - INFO - PaymentService initialized
2025-06-12 15:19:14,588 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-12 15:19:14,593 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-12 15:19:14,597 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-12 15:19:14,598 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-12 15:19:14,599 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-12 15:19:14,599 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-12 15:19:15,394 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-12 15:19:15,394 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-12 15:19:15,395 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-12 15:19:15,395 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-12 15:19:15,420 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-12 15:19:15,421 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-12 15:31:51,875 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'Hello'}
2025-06-12 15:31:51,877 - utils.session_manager - INFO - New session 2347082345056 initialized.
2025-06-12 15:31:51,888 - handlers.base_handler - INFO - Session 2347082345056 initialized with greeting state for user 'Olumayowa Oyaleke'.
2025-06-12 15:31:51,891 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Olumayowa Oyaleke! 👋\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order', 'title': '🛒 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_assistant', 'title': '🤖 AI Assistant'}}, {'type': 'reply', 'reply': {'id': 'others', 'title': '⚙️ Others'}}]}}}
2025-06-12 15:31:54,532 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjI1NzU2ODkxMDQwOENCQTYxNAA="}]}
2025-06-12 15:31:54,534 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjI1NzU2ODkxMDQwOENCQTYxNAA='}]}
2025-06-12 15:31:54,536 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:31:54] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:31:55,711 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:31:55] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:31:55,940 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:31:55] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:31:56,029 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:31:56] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:32:03,099 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'others'}
2025-06-12 15:32:03,145 - handlers.base_handler - INFO - GreetingHandler: Handling message 'others' in greeting state for session 2347082345056.
2025-06-12 15:32:03,146 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🔧 *Other Options*\n\nHere are other ways I can help you:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'enquiry', 'title': '❓ Enquiry'}}, {'type': 'reply', 'reply': {'id': 'complain', 'title': '📝 Complain'}}, {'type': 'reply', 'reply': {'id': 'back_to_main', 'title': '🔙 Back'}}]}}}
2025-06-12 15:32:04,389 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjI5NTY5M0VEQUY3OTQzNjFFNwA="}]}
2025-06-12 15:32:04,390 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjI5NTY5M0VEQUY3OTQzNjFFNwA='}]}
2025-06-12 15:32:04,391 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:32:04] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:32:05,254 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:32:05] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:32:05,579 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:32:05] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:32:05,606 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:32:05] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:32:09,027 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'back_to_main'}
2025-06-12 15:32:09,039 - handlers.message_processor - WARNING - No specific handler or state match for handler 'greeting_handler', state 'others_menu_selection', message 'back_to_main' for session 2347082345056. Resetting to greeting.
2025-06-12 15:32:09,045 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'text', 'text': {'body': "I'm sorry, I didn't quite understand that. Let's get back to the main menu."}}
2025-06-12 15:32:10,287 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjgwQTE1OTk2NjM2Qjk2OEUyOQA="}]}
2025-06-12 15:32:10,288 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Olumayowa Oyaleke! 👋\n\nPlease choose from the options below:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order', 'title': '🛒 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_assistant', 'title': '🤖 AI Assistant'}}, {'type': 'reply', 'reply': {'id': 'others', 'title': '⚙️ Others'}}]}}}
2025-06-12 15:32:11,128 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:32:11] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:32:11,336 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjY0NTkzNzI2NDEzRjg4QzRFQwA="}]}
2025-06-12 15:32:11,337 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjY0NTkzNzI2NDEzRjg4QzRFQwA='}]}
2025-06-12 15:32:11,338 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:32:11] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:32:11,662 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:32:11] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:32:11,802 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:32:11] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:32:12,552 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:32:12] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:32:12,992 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:32:12] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:32:12,999 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:32:12] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:32:20,657 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'order'}
2025-06-12 15:32:20,669 - handlers.base_handler - INFO - GreetingHandler: Handling message 'order' in greeting state for session 2347082345056.
2025-06-12 15:32:20,669 - handlers.base_handler - INFO - Session 2347082345056 redirecting to menu_handler for classic menu.
2025-06-12 15:32:20,669 - handlers.message_processor - INFO - Redirecting session 2347082345056 to handler 'menu_handler' with message 'show_menu'.
2025-06-12 15:32:20,671 - handlers.base_handler - INFO - MenuHandler: Received message 'show_menu' (original: 'order') in menu state for session 2347082345056
2025-06-12 15:32:20,672 - handlers.base_handler - INFO - Showing menu categories for session 2347082345056
2025-06-12 15:32:20,673 - handlers.base_handler - INFO - Available categories: ['Main Dishes', 'Soups & Stews', 'Sides', 'Snacks', 'Drinks', 'Desserts', 'Specialties']
2025-06-12 15:32:20,680 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'list', 'body': {'text': '🍽️ *Our Menu*\n\nChoose a category to browse items:'}, 'action': {'button': 'Categories', 'sections': [{'title': 'Menu Categories', 'rows': [{'id': 'main dishes', 'title': 'Main Dishes'}, {'id': 'soups & stews', 'title': 'Soups & Stews'}, {'id': 'sides', 'title': 'Sides'}, {'id': 'snacks', 'title': 'Snacks'}, {'id': 'drinks', 'title': 'Drinks'}, {'id': 'desserts', 'title': 'Desserts'}, {'id': 'specialties', 'title': 'Specialties'}]}]}}}
2025-06-12 15:32:21,799 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkRBREFDN0Y0NDFBMEM5MEM2NAA="}]}
2025-06-12 15:32:21,801 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkRBREFDN0Y0NDFBMEM5MEM2NAA='}]}
2025-06-12 15:32:21,802 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:32:21] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:32:22,770 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:32:22] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:32:23,033 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:32:23] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:32:23,073 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:32:23] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:32:33,514 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'Menu'}
2025-06-12 15:32:33,518 - handlers.base_handler - INFO - MenuHandler: Received message 'menu' (original: 'Menu') in menu state for session 2347082345056
2025-06-12 15:32:33,519 - handlers.base_handler - INFO - Session 2347082345056 returned to main menu (greeting state).
2025-06-12 15:32:33,520 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Olumayowa Oyaleke! Welcome back! How can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '✨ Lola AI Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '⚙️ Others'}}]}}}
2025-06-12 15:32:34,727 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjc2RDQwOTU0NjQ0QjAyQjU5NQA="}]}
2025-06-12 15:32:34,729 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Olumayowa Oyaleke! 👋\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order', 'title': '🛒 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_assistant', 'title': '🤖 AI Assistant'}}, {'type': 'reply', 'reply': {'id': 'others', 'title': '⚙️ Others'}}]}}}
2025-06-12 15:32:35,665 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjBGQ0IwMDgzNUU1ODU5OEM5NwA="}]}
2025-06-12 15:32:35,666 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjBGQ0IwMDgzNUU1ODU5OEM5NwA='}]}
2025-06-12 15:32:35,667 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:32:35] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:32:35,768 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:32:35] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:32:35,987 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:32:35] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:32:36,188 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:32:36] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:32:36,432 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:32:36] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:32:36,858 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:32:36] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:32:36,996 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:32:36] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:34:11,623 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': 'Hi'}
2025-06-12 15:34:11,623 - utils.session_manager - INFO - New session 2349030918492 initialized.
2025-06-12 15:34:11,627 - handlers.base_handler - INFO - Session 2349030918492 initialized with greeting state for user 'Benny'.
2025-06-12 15:34:11,628 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Benny! 👋\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order', 'title': '🛒 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_assistant', 'title': '🤖 AI Assistant'}}, {'type': 'reply', 'reply': {'id': 'others', 'title': '⚙️ Others'}}]}}}
2025-06-12 15:34:12,704 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjQyRDY3REMwMTY1NzQyNzRCRAA="}]}
2025-06-12 15:34:12,705 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjQyRDY3REMwMTY1NzQyNzRCRAA='}]}
2025-06-12 15:34:12,705 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:34:12] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:34:13,635 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:34:13] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:34:14,143 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:34:14] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:35:17,247 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': 'others'}
2025-06-12 15:35:17,251 - handlers.base_handler - INFO - GreetingHandler: Handling message 'others' in greeting state for session 2349030918492.
2025-06-12 15:35:17,252 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🔧 *Other Options*\n\nHere are other ways I can help you:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'enquiry', 'title': '❓ Enquiry'}}, {'type': 'reply', 'reply': {'id': 'complain', 'title': '📝 Complain'}}, {'type': 'reply', 'reply': {'id': 'back_to_main', 'title': '🔙 Back'}}]}}}
2025-06-12 15:35:18,211 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjgxMDA5MTFFQzg2MEJFOUU3QgA="}]}
2025-06-12 15:35:18,213 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjgxMDA5MTFFQzg2MEJFOUU3QgA='}]}
2025-06-12 15:35:18,214 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:35:18] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:35:19,083 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:35:19] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:35:19,540 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:35:19] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:35:59,700 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'others_menu'}
2025-06-12 15:35:59,706 - handlers.base_handler - INFO - GreetingHandler: Handling message 'others_menu' in greeting state for session 2347082345056.
2025-06-12 15:35:59,707 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🔧 *Other Options*\n\nHere are other ways I can help you:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'enquiry', 'title': '❓ Enquiry'}}, {'type': 'reply', 'reply': {'id': 'complain', 'title': '📝 Complain'}}, {'type': 'reply', 'reply': {'id': 'back_to_main', 'title': '🔙 Back'}}]}}}
2025-06-12 15:36:00,761 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkRDQTM3OTVGMDUyNkQ3QkEzOAA="}]}
2025-06-12 15:36:00,762 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkRDQTM3OTVGMDUyNkQ3QkEzOAA='}]}
2025-06-12 15:36:00,763 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:36:00] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:36:01,675 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:36:01] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:36:02,110 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:36:02] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:36:02,395 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:36:02] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:36:26,906 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': 'enquiry'}
2025-06-12 15:36:26,909 - handlers.message_processor - WARNING - No specific handler or state match for handler 'greeting_handler', state 'others_menu_selection', message 'enquiry' for session 2349030918492. Resetting to greeting.
2025-06-12 15:36:26,909 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'text', 'text': {'body': "I'm sorry, I didn't quite understand that. Let's get back to the main menu."}}
2025-06-12 15:36:27,808 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEkFDOURDODI0OTNBMUI3MTcxMAA="}]}
2025-06-12 15:36:27,809 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Benny! 👋\n\nPlease choose from the options below:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order', 'title': '🛒 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_assistant', 'title': '🤖 AI Assistant'}}, {'type': 'reply', 'reply': {'id': 'others', 'title': '⚙️ Others'}}]}}}
2025-06-12 15:36:28,712 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjNCQjY1OEZBMEMyQTRENjg0NwA="}]}
2025-06-12 15:36:28,712 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjNCQjY1OEZBMEMyQTRENjg0NwA='}]}
2025-06-12 15:36:28,713 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:36:28] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:36:28,887 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:36:28] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:36:29,046 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:36:29] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:36:29,513 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'enquiry'}
2025-06-12 15:36:29,517 - handlers.message_processor - WARNING - No specific handler or state match for handler 'greeting_handler', state 'others_menu_selection', message 'enquiry' for session 2347082345056. Resetting to greeting.
2025-06-12 15:36:29,517 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'text', 'text': {'body': "I'm sorry, I didn't quite understand that. Let's get back to the main menu."}}
2025-06-12 15:36:29,550 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:36:29] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:36:29,829 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:36:29] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:36:30,609 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkZBOENGMTlFOTQ3QjUwNTgxRgA="}]}
2025-06-12 15:36:30,610 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Olumayowa Oyaleke! 👋\n\nPlease choose from the options below:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order', 'title': '🛒 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_assistant', 'title': '🤖 AI Assistant'}}, {'type': 'reply', 'reply': {'id': 'others', 'title': '⚙️ Others'}}]}}}
2025-06-12 15:36:31,329 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:36:31] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:36:31,659 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkNDREUwNDNFMkE0MDRDMDk2QQA="}]}
2025-06-12 15:36:31,660 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkNDREUwNDNFMkE0MDRDMDk2QQA='}]}
2025-06-12 15:36:31,660 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:36:31] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:36:31,725 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:36:31] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:36:31,894 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:36:31] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:36:32,813 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': 'others'}
2025-06-12 15:36:32,818 - handlers.base_handler - INFO - GreetingHandler: Handling message 'others' in greeting state for session 2349030918492.
2025-06-12 15:36:32,819 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🔧 *Other Options*\n\nHere are other ways I can help you:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'enquiry', 'title': '❓ Enquiry'}}, {'type': 'reply', 'reply': {'id': 'complain', 'title': '📝 Complain'}}, {'type': 'reply', 'reply': {'id': 'back_to_main', 'title': '🔙 Back'}}]}}}
2025-06-12 15:36:32,934 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:36:32] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:36:33,190 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:36:33] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:36:33,367 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:36:33] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:36:33,794 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjlFMzMzNEJFMzk1NDg2REMwOQA="}]}
2025-06-12 15:36:33,795 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjlFMzMzNEJFMzk1NDg2REMwOQA='}]}
2025-06-12 15:36:33,795 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:36:33] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:36:34,630 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:36:34] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:36:35,336 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:36:35] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:36:37,046 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': 'enquiry'}
2025-06-12 15:36:37,053 - handlers.message_processor - WARNING - No specific handler or state match for handler 'greeting_handler', state 'others_menu_selection', message 'enquiry' for session 2349030918492. Resetting to greeting.
2025-06-12 15:36:37,054 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'text', 'text': {'body': "I'm sorry, I didn't quite understand that. Let's get back to the main menu."}}
2025-06-12 15:36:38,451 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjhBN0MxODgzRDQ2RkQ5NERGRAA="}]}
2025-06-12 15:36:38,452 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Benny! 👋\n\nPlease choose from the options below:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order', 'title': '🛒 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_assistant', 'title': '🤖 AI Assistant'}}, {'type': 'reply', 'reply': {'id': 'others', 'title': '⚙️ Others'}}]}}}
2025-06-12 15:36:39,166 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:36:39] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:36:39,332 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:36:39] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:36:39,335 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjZGMUZFQ0IwQjMyRERGQkQxMgA="}]}
2025-06-12 15:36:39,336 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjZGMUZFQ0IwQjMyRERGQkQxMgA='}]}
2025-06-12 15:36:39,336 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:36:39] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:36:40,392 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:36:40] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:36:40,562 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:36:40] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:45:41,953 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': 'others'}
2025-06-12 15:45:41,964 - handlers.base_handler - INFO - GreetingHandler: Handling message 'others' in greeting state for session 2349030918492.
2025-06-12 15:45:41,965 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🔧 *Other Options*\n\nHere are other ways I can help you:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'enquiry', 'title': '❓ Enquiry'}}, {'type': 'reply', 'reply': {'id': 'complain', 'title': '📝 Complain'}}, {'type': 'reply', 'reply': {'id': 'back_to_main', 'title': '🔙 Back'}}]}}}
2025-06-12 15:45:42,688 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjVCMDI2QjdFRjRBMjA5RDI0OAA="}]}
2025-06-12 15:45:42,690 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjVCMDI2QjdFRjRBMjA5RDI0OAA='}]}
2025-06-12 15:45:42,693 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:45:42] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:45:43,516 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:45:43] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:45:44,180 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:45:44] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:45:45,454 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': 'complain'}
2025-06-12 15:45:45,460 - handlers.message_processor - WARNING - No specific handler or state match for handler 'greeting_handler', state 'others_menu_selection', message 'complain' for session 2349030918492. Resetting to greeting.
2025-06-12 15:45:45,460 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'text', 'text': {'body': "I'm sorry, I didn't quite understand that. Let's get back to the main menu."}}
2025-06-12 15:45:46,169 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjM0MkUwRTY5QkQ2NkZFRTUwQwA="}]}
2025-06-12 15:45:46,170 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Benny! 👋\n\nPlease choose from the options below:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order', 'title': '🛒 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_assistant', 'title': '🤖 AI Assistant'}}, {'type': 'reply', 'reply': {'id': 'others', 'title': '⚙️ Others'}}]}}}
2025-06-12 15:45:46,804 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjA3N0Q2Qjc5RkM5OThBNzE1MgA="}]}
2025-06-12 15:45:46,806 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjA3N0Q2Qjc5RkM5OThBNzE1MgA='}]}
2025-06-12 15:45:46,807 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:45:46] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:45:47,062 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:45:47] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:45:47,153 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:45:47] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:45:47,501 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:45:47] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:45:47,720 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:45:47] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:45:47,889 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:45:47] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:45:50,133 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'others'}
2025-06-12 15:45:50,139 - handlers.base_handler - INFO - GreetingHandler: Handling message 'others' in greeting state for session 2347082345056.
2025-06-12 15:45:50,140 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🔧 *Other Options*\n\nHere are other ways I can help you:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'enquiry', 'title': '❓ Enquiry'}}, {'type': 'reply', 'reply': {'id': 'complain', 'title': '📝 Complain'}}, {'type': 'reply', 'reply': {'id': 'back_to_main', 'title': '🔙 Back'}}]}}}
2025-06-12 15:45:51,009 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkQ5QUJCQ0RGQ0JBNjQ0M0RCOAA="}]}
2025-06-12 15:45:51,011 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkQ5QUJCQ0RGQ0JBNjQ0M0RCOAA='}]}
2025-06-12 15:45:51,013 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:45:51] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:45:51,928 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:45:51] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:45:52,462 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:45:52] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:45:52,598 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:45:52] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:45:54,865 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'complain'}
2025-06-12 15:45:54,870 - handlers.message_processor - WARNING - No specific handler or state match for handler 'greeting_handler', state 'others_menu_selection', message 'complain' for session 2347082345056. Resetting to greeting.
2025-06-12 15:45:54,871 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'text', 'text': {'body': "I'm sorry, I didn't quite understand that. Let's get back to the main menu."}}
2025-06-12 15:45:56,176 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjdBQTQ5ODREMTY3M0U1QzgxRAA="}]}
2025-06-12 15:45:56,178 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Olumayowa Oyaleke! 👋\n\nPlease choose from the options below:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order', 'title': '🛒 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_assistant', 'title': '🤖 AI Assistant'}}, {'type': 'reply', 'reply': {'id': 'others', 'title': '⚙️ Others'}}]}}}
2025-06-12 15:45:57,080 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjI0MDBGNDE5RjlDNzE0OEREMwA="}]}
2025-06-12 15:45:57,081 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjI0MDBGNDE5RjlDNzE0OEREMwA='}]}
2025-06-12 15:45:57,081 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:45:57] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:45:57,208 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:45:57] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:45:57,589 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:45:57] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:45:57,861 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:45:57] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:45:57,958 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:45:57] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:45:58,570 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:45:58] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:45:58,579 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:45:58] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:56:19,511 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'ai_assistant'}
2025-06-12 15:56:19,512 - utils.session_manager - INFO - Session 2347082345056 timed out after 624.64 seconds (timeout limit: 600s). Resetting.
2025-06-12 15:56:19,517 - handlers.base_handler - INFO - Session 2347082345056 initialized with greeting state for user 'Olumayowa Oyaleke'.
2025-06-12 15:56:19,518 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Olumayowa Oyaleke! 👋\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order', 'title': '🛒 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_assistant', 'title': '🤖 AI Assistant'}}, {'type': 'reply', 'reply': {'id': 'others', 'title': '⚙️ Others'}}]}}}
2025-06-12 15:56:20,600 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjEyRDMyNjExMkNBQjNBQjdFNwA="}]}
2025-06-12 15:56:20,602 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjEyRDMyNjExMkNBQjNBQjdFNwA='}]}
2025-06-12 15:56:20,603 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:56:20] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:56:21,604 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:56:21] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:56:21,952 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:56:21] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:56:22,107 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:56:22] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:56:32,360 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'ai_assistant'}
2025-06-12 15:56:32,367 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_assistant' in greeting state for session 2347082345056.
2025-06-12 15:56:32,368 - handlers.base_handler - INFO - Session 2347082345056 redirecting to AIHandler for AI menu.
2025-06-12 15:56:32,369 - handlers.message_processor - INFO - Redirecting session 2347082345056 to handler 'ai_handler' with message 'initial_entry'.
2025-06-12 15:56:32,370 - handlers.base_handler - INFO - AIHandler: Handling message 'initial_entry' in AI menu state for session 2347082345056. Original: 'ai_assistant'
2025-06-12 15:56:32,371 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🤖 *AI Assistant Options*\n\n🤖 *Lola Chatbot* - Chat with our AI assistant\n🛒 *AI Bulk Order* - Order multiple items at once\n\nPlease select an AI option:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'lola_chatbot', 'title': '🤖 Lola Chatbot'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order', 'title': '🛒 AI Bulk Order'}}, {'type': 'reply', 'reply': {'id': 'back_to_main', 'title': '🔙 Back to Main'}}]}}}
2025-06-12 15:56:33,270 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkNDNTk0OTkwMDJEQkZEN0FCMQA="}]}
2025-06-12 15:56:33,271 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkNDNTk0OTkwMDJEQkZEN0FCMQA='}]}
2025-06-12 15:56:33,272 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:56:33] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:56:34,071 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:56:34] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:56:34,650 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:56:34] "POST /webhook HTTP/1.1" 200 -
2025-06-12 15:56:34,676 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 15:56:34] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:00:50,504 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-12 16:00:50,505 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-12 16:00:50,522 - handlers.base_handler - INFO - Session 2348055614455 initialized with greeting state for user 'Ziga'.
2025-06-12 16:00:50,523 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Ziga! 👋\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order', 'title': '🛒 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_assistant', 'title': '🤖 AI Assistant'}}, {'type': 'reply', 'reply': {'id': 'others', 'title': '⚙️ Others'}}]}}}
2025-06-12 16:00:52,020 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjU3RDg3MjU4MTNEQUYyNDgxOQA="}]}
2025-06-12 16:00:52,021 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjU3RDg3MjU4MTNEQUYyNDgxOQA='}]}
2025-06-12 16:00:52,021 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:00:52] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:00:53,465 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:00:53] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:00:53,681 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:00:53] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:10:22,302 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:10:22] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:12:12,036 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': 'ai_assistant'}
2025-06-12 16:12:12,037 - utils.session_manager - INFO - Session 2349030918492 timed out after 1586.58 seconds (timeout limit: 600s). Resetting.
2025-06-12 16:12:12,046 - handlers.base_handler - INFO - Session 2349030918492 initialized with greeting state for user 'Benny'.
2025-06-12 16:12:12,047 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Benny! 👋\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order', 'title': '🛒 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_assistant', 'title': '🤖 AI Assistant'}}, {'type': 'reply', 'reply': {'id': 'others', 'title': '⚙️ Others'}}]}}}
2025-06-12 16:12:13,002 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjhGQURFMTdFRjJGQzM2NzhGQwA="}]}
2025-06-12 16:12:13,003 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjhGQURFMTdFRjJGQzM2NzhGQwA='}]}
2025-06-12 16:12:13,004 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:12:13] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:12:14,030 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:12:14] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:12:14,547 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:12:14] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:12:16,606 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': 'ai_assistant'}
2025-06-12 16:12:16,613 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_assistant' in greeting state for session 2349030918492.
2025-06-12 16:12:16,613 - handlers.base_handler - INFO - Session 2349030918492 redirecting to AIHandler for AI menu.
2025-06-12 16:12:16,613 - handlers.message_processor - INFO - Redirecting session 2349030918492 to handler 'ai_handler' with message 'initial_entry'.
2025-06-12 16:12:16,615 - handlers.base_handler - INFO - AIHandler: Handling message 'initial_entry' in AI menu state for session 2349030918492. Original: 'ai_assistant'
2025-06-12 16:12:16,616 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🤖 *AI Assistant Options*\n\n🤖 *Lola Chatbot* - Chat with our AI assistant\n🛒 *AI Bulk Order* - Order multiple items at once\n\nPlease select an AI option:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'lola_chatbot', 'title': '🤖 Lola Chatbot'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order', 'title': '🛒 AI Bulk Order'}}, {'type': 'reply', 'reply': {'id': 'back_to_main', 'title': '🔙 Back to Main'}}]}}}
2025-06-12 16:12:17,319 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjUzQTBBNjcyQzM0MkY5NTJCRAA="}]}
2025-06-12 16:12:17,321 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjUzQTBBNjcyQzM0MkY5NTJCRAA='}]}
2025-06-12 16:12:17,322 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:12:17] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:12:18,497 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:12:18] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:12:18,501 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:12:18] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:23:12,241 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': 'lola_chatbot'}
2025-06-12 16:23:12,243 - utils.session_manager - INFO - Session 2349030918492 timed out after 655.63 seconds (timeout limit: 600s). Resetting.
2025-06-12 16:23:12,248 - handlers.base_handler - INFO - Session 2349030918492 initialized with greeting state for user 'Benny'.
2025-06-12 16:23:12,249 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Benny! 👋\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order', 'title': '🛒 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_assistant', 'title': '🤖 AI Assistant'}}, {'type': 'reply', 'reply': {'id': 'others', 'title': '⚙️ Others'}}]}}}
2025-06-12 16:23:13,118 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjg2N0Q3M0IxMTY3MzE4NzQ5NQA="}]}
2025-06-12 16:23:13,119 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjg2N0Q3M0IxMTY3MzE4NzQ5NQA='}]}
2025-06-12 16:23:13,120 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:23:13] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:23:13,952 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:23:13] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:23:14,566 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:23:14] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:23:17,599 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': 'order'}
2025-06-12 16:23:17,604 - handlers.base_handler - INFO - GreetingHandler: Handling message 'order' in greeting state for session 2349030918492.
2025-06-12 16:23:17,605 - handlers.base_handler - INFO - Session 2349030918492 redirecting to menu_handler for classic menu.
2025-06-12 16:23:17,605 - handlers.message_processor - INFO - Redirecting session 2349030918492 to handler 'menu_handler' with message 'show_menu'.
2025-06-12 16:23:17,606 - handlers.base_handler - INFO - MenuHandler: Received message 'show_menu' (original: 'order') in menu state for session 2349030918492
2025-06-12 16:23:17,608 - handlers.base_handler - INFO - Showing menu categories for session 2349030918492
2025-06-12 16:23:17,609 - handlers.base_handler - INFO - Available categories: ['Main Dishes', 'Soups & Stews', 'Sides', 'Snacks', 'Drinks', 'Desserts', 'Specialties']
2025-06-12 16:23:17,609 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'interactive', 'interactive': {'type': 'list', 'body': {'text': '🍽️ *Our Menu*\n\nChoose a category to browse items:'}, 'action': {'button': 'Categories', 'sections': [{'title': 'Menu Categories', 'rows': [{'id': 'main dishes', 'title': 'Main Dishes'}, {'id': 'soups & stews', 'title': 'Soups & Stews'}, {'id': 'sides', 'title': 'Sides'}, {'id': 'snacks', 'title': 'Snacks'}, {'id': 'drinks', 'title': 'Drinks'}, {'id': 'desserts', 'title': 'Desserts'}, {'id': 'specialties', 'title': 'Specialties'}]}]}}}
2025-06-12 16:23:18,396 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjM4QUYzOENCMDlBRTI4NEU0QQA="}]}
2025-06-12 16:23:18,396 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjM4QUYzOENCMDlBRTI4NEU0QQA='}]}
2025-06-12 16:23:18,397 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:23:18] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:23:19,276 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:23:19] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:23:19,729 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:23:19] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:25:54,562 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'back_to_main'}
2025-06-12 16:25:54,563 - utils.session_manager - INFO - Session 2347082345056 timed out after 1762.19 seconds (timeout limit: 600s). Resetting.
2025-06-12 16:25:54,567 - handlers.base_handler - INFO - Session 2347082345056 initialized with greeting state for user 'Olumayowa Oyaleke'.
2025-06-12 16:25:54,568 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Olumayowa Oyaleke! 👋\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order', 'title': '🛒 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_assistant', 'title': '🤖 AI Assistant'}}, {'type': 'reply', 'reply': {'id': 'others', 'title': '⚙️ Others'}}]}}}
2025-06-12 16:25:55,570 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjE3ODMxMEYyRDAzNDUzQTlBRQA="}]}
2025-06-12 16:25:55,570 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjE3ODMxMEYyRDAzNDUzQTlBRQA='}]}
2025-06-12 16:25:55,571 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:25:55] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:25:56,543 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:25:56] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:25:56,952 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:25:56] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:25:57,117 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:25:57] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:26:02,974 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'order'}
2025-06-12 16:26:02,979 - handlers.base_handler - INFO - GreetingHandler: Handling message 'order' in greeting state for session 2347082345056.
2025-06-12 16:26:02,979 - handlers.base_handler - INFO - Session 2347082345056 redirecting to menu_handler for classic menu.
2025-06-12 16:26:02,980 - handlers.message_processor - INFO - Redirecting session 2347082345056 to handler 'menu_handler' with message 'show_menu'.
2025-06-12 16:26:02,980 - handlers.base_handler - INFO - MenuHandler: Received message 'show_menu' (original: 'order') in menu state for session 2347082345056
2025-06-12 16:26:02,980 - handlers.base_handler - INFO - Showing menu categories for session 2347082345056
2025-06-12 16:26:02,981 - handlers.base_handler - INFO - Available categories: ['Main Dishes', 'Soups & Stews', 'Sides', 'Snacks', 'Drinks', 'Desserts', 'Specialties']
2025-06-12 16:26:02,981 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'list', 'body': {'text': '🍽️ *Our Menu*\n\nChoose a category to browse items:'}, 'action': {'button': 'Categories', 'sections': [{'title': 'Menu Categories', 'rows': [{'id': 'main dishes', 'title': 'Main Dishes'}, {'id': 'soups & stews', 'title': 'Soups & Stews'}, {'id': 'sides', 'title': 'Sides'}, {'id': 'snacks', 'title': 'Snacks'}, {'id': 'drinks', 'title': 'Drinks'}, {'id': 'desserts', 'title': 'Desserts'}, {'id': 'specialties', 'title': 'Specialties'}]}]}}}
2025-06-12 16:26:04,012 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjg0NEE2N0U3QzRGRkNERDQ0RQA="}]}
2025-06-12 16:26:04,012 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjg0NEE2N0U3QzRGRkNERDQ0RQA='}]}
2025-06-12 16:26:04,013 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:26:04] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:26:04,749 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:26:04] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:26:05,261 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:26:05] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:26:05,430 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:26:05] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:28:35,734 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': 'Hi'}
2025-06-12 16:28:35,742 - handlers.base_handler - INFO - MenuHandler: Received message 'hi' (original: 'Hi') in menu state for session 2349030918492
2025-06-12 16:28:35,743 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'text', 'text': {'body': "❌ Invalid selection: 'Hi'\n\nPlease select from these categories:\nMain Dishes, Soups & Stews, Sides, Snacks, Drinks, Desserts, Specialties\n\nOr type 'back' to return to main menu."}}
2025-06-12 16:28:36,567 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEkZBRDJCMTNDOTFDN0U3NTYxRgA="}]}
2025-06-12 16:28:36,567 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEkZBRDJCMTNDOTFDN0U3NTYxRgA='}]}
2025-06-12 16:28:36,568 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:28:36] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:28:37,583 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:28:37] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:28:37,908 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:28:37] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:28:42,285 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': 'Back'}
2025-06-12 16:28:42,290 - handlers.base_handler - INFO - MenuHandler: Received message 'back' (original: 'Back') in menu state for session 2349030918492
2025-06-12 16:28:42,290 - handlers.base_handler - INFO - Session 2349030918492 returned to main menu (greeting state).
2025-06-12 16:28:42,291 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Benny! Welcome back! How can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '✨ Lola AI Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '⚙️ Others'}}]}}}
2025-06-12 16:28:43,053 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjRFMEUxQUIwMDc1QjEwMkFFQQA="}]}
2025-06-12 16:28:43,053 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjRFMEUxQUIwMDc1QjEwMkFFQQA='}]}
2025-06-12 16:28:43,054 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:28:43] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:28:44,006 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:28:44] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:28:44,439 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:28:44] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:28:46,387 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-12 16:28:46,392 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2349030918492.
2025-06-12 16:28:46,393 - handlers.base_handler - INFO - Session 2349030918492 redirecting to AIHandler for AI Bulk Order.
2025-06-12 16:28:46,393 - handlers.message_processor - INFO - Redirecting session 2349030918492 to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-06-12 16:28:46,394 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2349030918492. Original: 'ai_bulk_order_direct'
2025-06-12 16:28:46,395 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'text', 'text': {'body': '🛒 *AI Bulk Order Assistant*\n\nTell me everything you want to order in one message! For example:\n\n_"2 chief burgers with drinks, 3 jollof rice with chicken, large fries and 4 cokes"_\n\nI\'ll understand your order and help you confirm it! 🚀\n\n_Type \'menu\' to go back to the main menu_'}}
2025-06-12 16:28:47,187 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEkI4RTZCOUFFMjA2Q0I4NEE0MQA="}]}
2025-06-12 16:28:47,188 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEkI4RTZCOUFFMjA2Q0I4NEE0MQA='}]}
2025-06-12 16:28:47,189 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:28:47] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:28:47,931 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:28:47] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:28:48,680 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:28:48] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:29:05,126 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'Menu'}
2025-06-12 16:29:05,130 - handlers.base_handler - INFO - MenuHandler: Received message 'menu' (original: 'Menu') in menu state for session 2347082345056
2025-06-12 16:29:05,130 - handlers.base_handler - INFO - Session 2347082345056 returned to main menu (greeting state).
2025-06-12 16:29:05,131 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Olumayowa Oyaleke! Welcome back! How can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '✨ Lola AI Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '⚙️ Others'}}]}}}
2025-06-12 16:29:06,001 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjA5ODk4M0IwQ0U5OUIxN0NCQwA="}]}
2025-06-12 16:29:06,005 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Olumayowa Oyaleke! 👋\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order', 'title': '🛒 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_assistant', 'title': '🤖 AI Assistant'}}, {'type': 'reply', 'reply': {'id': 'others', 'title': '⚙️ Others'}}]}}}
2025-06-12 16:29:06,797 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjVGMDJFQ0Q5MURCRTdEMzY1NAA="}]}
2025-06-12 16:29:06,797 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjVGMDJFQ0Q5MURCRTdEMzY1NAA='}]}
2025-06-12 16:29:06,798 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:29:06] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:29:06,895 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:29:06] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:29:07,350 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:29:07] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:29:07,479 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:29:07] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:29:07,788 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:29:07] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:29:08,059 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:29:08] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:29:08,205 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:29:08] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:29:12,225 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': 'Hi'}
2025-06-12 16:29:12,229 - handlers.base_handler - INFO - AIHandler: Handling message 'hi' in AI bulk order state for session 2349030918492. Original: 'Hi'
2025-06-12 16:29:14,866 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-12 16:29:14,886 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'text', 'text': {'body': "❌ No items mentioned in the order.\n\nPlease try rephrasing your order or type 'menu' to return to main menu."}}
2025-06-12 16:29:15,642 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEkZFMThDNDZDNTZEMDk3MDkxNAA="}]}
2025-06-12 16:29:15,643 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEkZFMThDNDZDNTZEMDk3MDkxNAA='}]}
2025-06-12 16:29:15,644 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:29:15] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:29:16,571 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:29:16] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:29:16,755 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:29:16] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:36:01,360 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-12 16:36:01,366 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2347082345056.
2025-06-12 16:36:01,366 - handlers.base_handler - INFO - Session 2347082345056 redirecting to AIHandler for AI Bulk Order.
2025-06-12 16:36:01,367 - handlers.message_processor - INFO - Redirecting session 2347082345056 to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-06-12 16:36:01,368 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2347082345056. Original: 'ai_bulk_order_direct'
2025-06-12 16:36:01,370 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'text', 'text': {'body': '🛒 *AI Bulk Order Assistant*\n\nTell me everything you want to order in one message! For example:\n\n_"2 chief burgers with drinks, 3 jollof rice with chicken, large fries and 4 cokes"_\n\nI\'ll understand your order and help you confirm it! 🚀\n\n_Type \'menu\' to go back to the main menu_'}}
2025-06-12 16:36:02,254 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkRDQjJGQUE5N0E0NEU4NTkxMgA="}]}
2025-06-12 16:36:02,255 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkRDQjJGQUE5N0E0NEU4NTkxMgA='}]}
2025-06-12 16:36:02,256 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:36:02] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:36:03,341 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:36:03] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:36:03,652 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:36:03] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:36:03,866 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:36:03] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:40:35,900 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'I want 4 chicken and 3 jollof rice'}
2025-06-12 16:40:35,908 - handlers.base_handler - INFO - AIHandler: Handling message 'i want 4 chicken and 3 jollof rice' in AI bulk order state for session 2347082345056. Original: 'I want 4 chicken and 3 jollof rice'
2025-06-12 16:40:39,160 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-12 16:40:39,162 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🛒 *Order Summary:*\n\n✅ 4x Suya-Spiced Chicken Platter - ₦6,400\n✅ 3x Fried Rice Fiesta - ₦4,200\n\n*Total: ₦10,600.00*\n\nWould you like to proceed with this order?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'confirm_ai_order', 'title': '✅ Confirm Order'}}, {'type': 'reply', 'reply': {'id': 'modify_ai_order', 'title': '✏️ Modify Order'}}, {'type': 'reply', 'reply': {'id': 'cancel_ai_order', 'title': '❌ Cancel'}}]}}}
2025-06-12 16:40:40,045 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjJBNzBFQzhCNzVFMzJGNTNDRAA="}]}
2025-06-12 16:40:40,046 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjJBNzBFQzhCNzVFMzJGNTNDRAA='}]}
2025-06-12 16:40:40,046 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:40:40] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:40:41,135 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:40:41] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:40:41,448 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:40:41] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:40:41,449 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:40:41] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:41:52,481 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'modify_ai_order'}
2025-06-12 16:41:52,484 - handlers.base_handler - INFO - User chose to modify AI order for session 2347082345056.
2025-06-12 16:41:52,484 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'text', 'text': {'body': 'Please tell me your updated order:'}}
2025-06-12 16:41:53,542 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjRCNThGRDQyMUQyOEM1RDQzQQA="}]}
2025-06-12 16:41:53,543 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjRCNThGRDQyMUQyOEM1RDQzQQA='}]}
2025-06-12 16:41:53,544 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:41:53] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:41:54,428 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:41:54] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:41:55,030 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:41:55] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:41:55,161 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:41:55] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:42:09,566 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': 'Two plate of jollof rice, 2 coke and asun'}
2025-06-12 16:42:09,566 - utils.session_manager - INFO - Session 2349030918492 timed out after 777.34 seconds (timeout limit: 600s). Resetting.
2025-06-12 16:42:09,571 - handlers.base_handler - INFO - Session 2349030918492 initialized with greeting state for user 'Benny'.
2025-06-12 16:42:09,571 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Benny! 👋\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order', 'title': '🛒 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_assistant', 'title': '🤖 AI Assistant'}}, {'type': 'reply', 'reply': {'id': 'others', 'title': '⚙️ Others'}}]}}}
2025-06-12 16:42:10,418 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjYzODMzQUFENUFCMzZFMkY2MwA="}]}
2025-06-12 16:42:10,418 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjYzODMzQUFENUFCMzZFMkY2MwA='}]}
2025-06-12 16:42:10,419 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:42:10] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:42:11,117 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:42:11] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:42:11,749 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:42:11] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:42:15,328 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'Add 2 more chickens'}
2025-06-12 16:42:15,332 - handlers.base_handler - INFO - AIHandler: Handling message 'add 2 more chickens' in AI bulk order state for session 2347082345056. Original: 'Add 2 more chickens'
2025-06-12 16:42:17,893 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-12 16:42:17,894 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': "🛒 *Order Summary:*\n\n✅ 3x Suya-Spiced Chicken Platter - ₦4,800\n\n❌ *Unrecognized Items:*\n🚫 2 more chickens (No specific menu item found matching '2 more chickens')\n\n*Total: ₦4,800.00*\n\nWould you like to proceed with this order?"}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'confirm_ai_order', 'title': '✅ Confirm Order'}}, {'type': 'reply', 'reply': {'id': 'modify_ai_order', 'title': '✏️ Modify Order'}}, {'type': 'reply', 'reply': {'id': 'cancel_ai_order', 'title': '❌ Cancel'}}]}}}
2025-06-12 16:42:18,092 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': 'ai_assistant'}
2025-06-12 16:42:18,097 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_assistant' in greeting state for session 2349030918492.
2025-06-12 16:42:18,097 - handlers.base_handler - INFO - Session 2349030918492 redirecting to AIHandler for AI menu.
2025-06-12 16:42:18,097 - handlers.message_processor - INFO - Redirecting session 2349030918492 to handler 'ai_handler' with message 'initial_entry'.
2025-06-12 16:42:18,098 - handlers.base_handler - INFO - AIHandler: Handling message 'initial_entry' in AI menu state for session 2349030918492. Original: 'ai_assistant'
2025-06-12 16:42:18,098 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🤖 *AI Assistant Options*\n\n🤖 *Lola Chatbot* - Chat with our AI assistant\n🛒 *AI Bulk Order* - Order multiple items at once\n\nPlease select an AI option:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'lola_chatbot', 'title': '🤖 Lola Chatbot'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order', 'title': '🛒 AI Bulk Order'}}, {'type': 'reply', 'reply': {'id': 'back_to_main', 'title': '🔙 Back to Main'}}]}}}
2025-06-12 16:42:18,743 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjRGOUI4NTlEODVEMkM2NDYxMQA="}]}
2025-06-12 16:42:18,743 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjRGOUI4NTlEODVEMkM2NDYxMQA='}]}
2025-06-12 16:42:18,744 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:42:18] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:42:18,757 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjVDMzA2OTY3MkE5NjJBODUzQgA="}]}
2025-06-12 16:42:18,757 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjVDMzA2OTY3MkE5NjJBODUzQgA='}]}
2025-06-12 16:42:18,758 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:42:18] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:42:19,574 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:42:19] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:42:19,577 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:42:19] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:42:19,721 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:42:19] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:42:19,990 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:42:19] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:42:20,189 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:42:20] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:49:56,211 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': 'Hi'}
2025-06-12 16:49:56,215 - handlers.base_handler - INFO - AIHandler: Handling message 'hi' in AI menu state for session 2349030918492. Original: 'Hi'
2025-06-12 16:49:56,216 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🤖 *AI Assistant Options*\n\n🤖 *Lola Chatbot* - Chat with our AI assistant\n🛒 *AI Bulk Order* - Order multiple items at once\n\nPlease select an AI option:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'lola_chatbot', 'title': '🤖 Lola Chatbot'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order', 'title': '🛒 AI Bulk Order'}}, {'type': 'reply', 'reply': {'id': 'back_to_main', 'title': '🔙 Back to Main'}}]}}}
2025-06-12 16:49:56,986 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjQ1MzVFMjJEREQzNjA5ODI4MQA="}]}
2025-06-12 16:49:56,987 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjQ1MzVFMjJEREQzNjA5ODI4MQA='}]}
2025-06-12 16:49:56,988 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:49:56] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:49:57,826 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:49:57] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:49:58,214 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:49:58] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:49:59,768 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'Menu'}
2025-06-12 16:49:59,775 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'text', 'text': {'body': 'Please choose from the available options.'}}
2025-06-12 16:50:00,555 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjM0RkE1QjcxMUVGMjQwNzNCRAA="}]}
2025-06-12 16:50:00,556 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Olumayowa Oyaleke! 👋\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order', 'title': '🛒 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_assistant', 'title': '🤖 AI Assistant'}}, {'type': 'reply', 'reply': {'id': 'others', 'title': '⚙️ Others'}}]}}}
2025-06-12 16:50:01,477 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:50:01] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:50:01,507 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkI5RkUxRjVEODg3QzkyMzlCRAA="}]}
2025-06-12 16:50:01,509 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkI5RkUxRjVEODg3QzkyMzlCRAA='}]}
2025-06-12 16:50:01,511 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:50:01] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:50:01,979 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:50:01] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:50:02,107 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:50:02] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:50:02,409 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:50:02] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:50:02,765 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:50:02] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:50:02,889 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:50:02] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:50:08,949 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'ai_assistant'}
2025-06-12 16:50:08,953 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_assistant' in greeting state for session 2347082345056.
2025-06-12 16:50:08,954 - handlers.base_handler - INFO - Session 2347082345056 redirecting to AIHandler for AI menu.
2025-06-12 16:50:08,954 - handlers.message_processor - INFO - Redirecting session 2347082345056 to handler 'ai_handler' with message 'initial_entry'.
2025-06-12 16:50:08,954 - handlers.base_handler - INFO - AIHandler: Handling message 'initial_entry' in AI menu state for session 2347082345056. Original: 'ai_assistant'
2025-06-12 16:50:08,955 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🤖 *AI Assistant Options*\n\n🤖 *Lola Chatbot* - Chat with our AI assistant\n🛒 *AI Bulk Order* - Order multiple items at once\n\nPlease select an AI option:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'lola_chatbot', 'title': '🤖 Lola Chatbot'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order', 'title': '🛒 AI Bulk Order'}}, {'type': 'reply', 'reply': {'id': 'back_to_main', 'title': '🔙 Back to Main'}}]}}}
2025-06-12 16:50:09,804 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkZENTIyNjBEMEU2MDk3MTI4MQA="}]}
2025-06-12 16:50:09,805 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkZENTIyNjBEMEU2MDk3MTI4MQA='}]}
2025-06-12 16:50:09,806 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:50:09] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:50:10,559 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:50:10] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:50:10,984 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:50:10] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:50:11,023 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:50:11] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:50:34,092 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': 'lola_chatbot'}
2025-06-12 16:50:34,096 - handlers.base_handler - INFO - AIHandler: Handling message 'lola_chatbot' in AI menu state for session 2349030918492. Original: 'lola_chatbot'
2025-06-12 16:50:34,097 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'text', 'text': {'body': "🤖 *Hi! I'm Lola, your AI assistant!*\n\nI can help you with:\n• Menu recommendations\n• Order assistance\n• General questions about our food\n• Nutritional information\n\nWhat would you like to know? Just ask me anything! 😊\n\n_Type 'menu' to go back to the main menu_"}}
2025-06-12 16:50:34,817 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjkzMzhFQ0ZFMjUyRURCRDZCMgA="}]}
2025-06-12 16:50:34,819 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjkzMzhFQ0ZFMjUyRURCRDZCMgA='}]}
2025-06-12 16:50:34,820 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:50:34] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:50:35,593 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:50:35] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:50:36,058 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:50:36] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:50:51,857 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'lola_chatbot'}
2025-06-12 16:50:51,860 - handlers.base_handler - INFO - AIHandler: Handling message 'lola_chatbot' in AI menu state for session 2347082345056. Original: 'lola_chatbot'
2025-06-12 16:50:51,861 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'text', 'text': {'body': "🤖 *Hi! I'm Lola, your AI assistant!*\n\nI can help you with:\n• Menu recommendations\n• Order assistance\n• General questions about our food\n• Nutritional information\n\nWhat would you like to know? Just ask me anything! 😊\n\n_Type 'menu' to go back to the main menu_"}}
2025-06-12 16:50:53,021 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkNFRjBCMzVGRjU4RjFENzJDMgA="}]}
2025-06-12 16:50:53,022 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkNFRjBCMzVGRjU4RjFENzJDMgA='}]}
2025-06-12 16:50:53,023 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:50:53] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:50:53,758 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:50:53] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:50:54,226 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:50:54] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:50:54,317 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:50:54] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:50:54,629 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': 'ai_bulk_order'}
2025-06-12 16:50:54,634 - handlers.base_handler - INFO - AIHandler: Handling message 'ai_bulk_order' in Lola chat state for session 2349030918492. Original: 'ai_bulk_order'
2025-06-12 16:50:56,781 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-12 16:50:56,783 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'text', 'text': {'body': "Hey there! How far? I see you're interested in our AI bulk order feature. That's great! You can easily place a bulk order by selecting the items and quantities you need from our menu. Just let me know what you're craving, and I'll help you with the ordering process. No wahala at all! Let's get your order sorted out. What delicious treats can I assist you with today?\n\n_Type 'menu' to return to main menu_ 🤖"}}
2025-06-12 16:50:57,464 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjI2NDY4QkY3QURDRTBBNzlBRgA="}]}
2025-06-12 16:50:57,465 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjI2NDY4QkY3QURDRTBBNzlBRgA='}]}
2025-06-12 16:50:57,466 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:50:57] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:50:58,242 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:50:58] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:50:58,770 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:50:58] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:55:02,730 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'Menu'}
2025-06-12 16:55:02,735 - handlers.base_handler - INFO - AIHandler: Handling message 'menu' in Lola chat state for session 2347082345056. Original: 'Menu'
2025-06-12 16:55:02,735 - handlers.base_handler - INFO - Session 2347082345056 returned to main menu (greeting state).
2025-06-12 16:55:02,736 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Olumayowa Oyaleke! Welcome back! How can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '✨ Lola AI Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '⚙️ Others'}}]}}}
2025-06-12 16:55:03,681 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjM0NUE4ODIwMUZEMDgzRUYwRQA="}]}
2025-06-12 16:55:03,683 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Olumayowa Oyaleke! 👋\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order', 'title': '🛒 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_assistant', 'title': '🤖 AI Assistant'}}, {'type': 'reply', 'reply': {'id': 'others', 'title': '⚙️ Others'}}]}}}
2025-06-12 16:55:04,439 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkYwNTAxMDQ0NEMyMzdBNDgzQwA="}]}
2025-06-12 16:55:04,439 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkYwNTAxMDQ0NEMyMzdBNDgzQwA='}]}
2025-06-12 16:55:04,440 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:55:04] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:55:04,505 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:55:04] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:55:04,966 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:55:04] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:55:05,066 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:55:05] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:55:05,301 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:55:05] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:55:05,741 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:55:05] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:55:05,951 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:55:05] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:55:08,966 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-12 16:55:08,970 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2347082345056.
2025-06-12 16:55:08,970 - handlers.base_handler - INFO - Session 2347082345056 redirecting to AIHandler for AI Bulk Order.
2025-06-12 16:55:08,970 - handlers.message_processor - INFO - Redirecting session 2347082345056 to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-06-12 16:55:08,971 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2347082345056. Original: 'ai_bulk_order_direct'
2025-06-12 16:55:08,971 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'text', 'text': {'body': '🛒 *AI Bulk Order Assistant*\n\nTell me everything you want to order in one message! For example:\n\n_"2 chief burgers with drinks, 3 jollof rice with chicken, large fries and 4 cokes"_\n\nI\'ll understand your order and help you confirm it! 🚀\n\n_Type \'menu\' to go back to the main menu_'}}
2025-06-12 16:55:09,982 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjVFRjEyNkUzQzFBMjkxMTU2OQA="}]}
2025-06-12 16:55:09,983 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjVFRjEyNkUzQzFBMjkxMTU2OQA='}]}
2025-06-12 16:55:09,984 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:55:09] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:55:10,896 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:55:10] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:55:11,084 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:55:11] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:55:11,159 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:55:11] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:55:13,263 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': 'Menu'}
2025-06-12 16:55:13,267 - handlers.base_handler - INFO - AIHandler: Handling message 'menu' in Lola chat state for session 2349030918492. Original: 'Menu'
2025-06-12 16:55:13,267 - handlers.base_handler - INFO - Session 2349030918492 returned to main menu (greeting state).
2025-06-12 16:55:13,268 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Benny! Welcome back! How can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '✨ Lola AI Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '⚙️ Others'}}]}}}
2025-06-12 16:55:13,983 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjFCRDYxMDNCODM2RjlBMENBMwA="}]}
2025-06-12 16:55:13,984 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Benny! 👋\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order', 'title': '🛒 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_assistant', 'title': '🤖 AI Assistant'}}, {'type': 'reply', 'reply': {'id': 'others', 'title': '⚙️ Others'}}]}}}
2025-06-12 16:55:14,735 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:55:14] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:55:14,752 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjYxOTI2NzQ3OUMzRTUyOTRCQgA="}]}
2025-06-12 16:55:14,753 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjYxOTI2NzQ3OUMzRTUyOTRCQgA='}]}
2025-06-12 16:55:14,753 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:55:14] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:55:15,189 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:55:15] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:55:15,965 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:55:15] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:55:16,102 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:55:16] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:55:16,300 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:55:16] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:55:18,558 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'Menu'}
2025-06-12 16:55:18,563 - handlers.base_handler - INFO - AIHandler: Handling message 'menu' in AI bulk order state for session 2347082345056. Original: 'Menu'
2025-06-12 16:55:18,564 - handlers.base_handler - INFO - Session 2347082345056 returned to main menu (greeting state).
2025-06-12 16:55:18,564 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Olumayowa Oyaleke! Welcome back! How can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '✨ Lola AI Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '⚙️ Others'}}]}}}
2025-06-12 16:55:19,575 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkEwMzA4NUU5QjUyMTRCNTA1NAA="}]}
2025-06-12 16:55:19,576 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Olumayowa Oyaleke! 👋\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order', 'title': '🛒 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_assistant', 'title': '🤖 AI Assistant'}}, {'type': 'reply', 'reply': {'id': 'others', 'title': '⚙️ Others'}}]}}}
2025-06-12 16:55:20,325 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjdBNzUwNzYxRjExMTdBOTJFQwA="}]}
2025-06-12 16:55:20,326 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjdBNzUwNzYxRjExMTdBOTJFQwA='}]}
2025-06-12 16:55:20,327 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:55:20] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:55:20,490 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:55:20] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:55:20,804 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:55:20] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:55:20,807 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:55:20] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:55:21,155 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:55:21] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:55:21,565 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:55:21] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:55:21,744 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:55:21] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:55:24,298 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': 'order'}
2025-06-12 16:55:24,303 - handlers.base_handler - INFO - GreetingHandler: Handling message 'order' in greeting state for session 2349030918492.
2025-06-12 16:55:24,303 - handlers.base_handler - INFO - Session 2349030918492 redirecting to menu_handler for classic menu.
2025-06-12 16:55:24,304 - handlers.message_processor - INFO - Redirecting session 2349030918492 to handler 'menu_handler' with message 'show_menu'.
2025-06-12 16:55:24,305 - handlers.base_handler - INFO - MenuHandler: Received message 'show_menu' (original: 'order') in menu state for session 2349030918492
2025-06-12 16:55:24,305 - handlers.base_handler - INFO - Showing menu categories for session 2349030918492
2025-06-12 16:55:24,306 - handlers.base_handler - INFO - Available categories: ['Main Dishes', 'Soups & Stews', 'Sides', 'Snacks', 'Drinks', 'Desserts', 'Specialties']
2025-06-12 16:55:24,306 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'interactive', 'interactive': {'type': 'list', 'body': {'text': '🍽️ *Our Menu*\n\nChoose a category to browse items:'}, 'action': {'button': 'Categories', 'sections': [{'title': 'Menu Categories', 'rows': [{'id': 'main dishes', 'title': 'Main Dishes'}, {'id': 'soups & stews', 'title': 'Soups & Stews'}, {'id': 'sides', 'title': 'Sides'}, {'id': 'snacks', 'title': 'Snacks'}, {'id': 'drinks', 'title': 'Drinks'}, {'id': 'desserts', 'title': 'Desserts'}, {'id': 'specialties', 'title': 'Specialties'}]}]}}}
2025-06-12 16:55:25,028 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjUwRDgyRkExRkM3RTEyMjRFRQA="}]}
2025-06-12 16:55:25,029 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjUwRDgyRkExRkM3RTEyMjRFRQA='}]}
2025-06-12 16:55:25,030 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:55:25] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:55:26,048 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:55:26] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:55:26,326 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:55:26] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:55:30,340 - handlers.webhook_handler - INFO - List reply received: id='main dishes', title='Main Dishes'
2025-06-12 16:55:30,341 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': 'main dishes'}
2025-06-12 16:55:30,344 - handlers.base_handler - INFO - MenuHandler: Received message 'main dishes' (original: 'main dishes') in menu state for session 2349030918492
2025-06-12 16:55:30,345 - handlers.base_handler - INFO - Category 'Main Dishes' selected for session 2349030918492
2025-06-12 16:55:30,345 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'interactive', 'interactive': {'type': 'list', 'body': {'text': '🍽️ *Main Dishes*\n\nSelect an item to add to your cart:'}, 'action': {'button': 'Select Item', 'sections': [{'title': 'Main Dishes Items', 'rows': [{'id': 'Smoky Jollof Fiesta', 'title': 'Smoky Jollof Fi (₦1,500)'}, {'id': 'Egusi Pasta Primavera', 'title': 'Egusi Pasta Pri (₦1,800)'}, {'id': 'Grilled Tilapia with Herb Crust', 'title': 'Grilled Tilapia (₦2,000)'}, {'id': 'Pounded Yam with Vegetable Soup', 'title': 'Pounded Yam wit (₦1,700)'}, {'id': 'Fried Rice Fiesta', 'title': 'Fried Rice Fies (₦1,400)'}, {'id': 'Suya-Spiced Chicken Platter', 'title': 'Suya-Spiced Chi (₦1,600)'}, {'id': 'Banga Rice Delight', 'title': 'Banga Rice Deli (₦1,300)'}, {'id': 'Plantain Porridge with Fish', 'title': 'Plantain Porrid (₦1,500)'}, {'id': 'Amala with Gbegiri and Ewedu', 'title': 'Amala with Gbeg (₦1,600)'}, {'id': 'Spicy Beef Stir-Fry', 'title': 'Spicy Beef Stir (₦1,700)'}]}]}}}
2025-06-12 16:55:30,995 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjY5QUY5MTkyOEJDRjU2QUJFNwA="}]}
2025-06-12 16:55:30,995 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjY5QUY5MTkyOEJDRjU2QUJFNwA='}]}
2025-06-12 16:55:30,996 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:55:30] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:55:31,845 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:55:31] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:55:32,110 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:55:32] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:55:37,751 - handlers.webhook_handler - INFO - List reply received: id='Suya-Spiced Chicken Platter', title='Suya-Spiced Chi (₦1,600)'
2025-06-12 16:55:37,751 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': 'Suya-Spiced Chicken Platter'}
2025-06-12 16:55:37,754 - handlers.base_handler - INFO - MenuHandler: Handling item selection 'Suya-Spiced Chicken Platter' for session 2349030918492
2025-06-12 16:55:37,755 - handlers.base_handler - INFO - Item 'Suya-Spiced Chicken Platter' selected for session 2349030918492, redirecting to order handler
2025-06-12 16:55:37,755 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'text', 'text': {'body': '🛒 *Suya-Spiced Chicken Platter*\nPrice: ₦1,600\n\nHow many would you like to order?\n\nPlease enter a number (e.g., 1, 2, 3...):'}}
2025-06-12 16:55:38,497 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEkJERUYzOTlEOTBDNTEwNTIwQgA="}]}
2025-06-12 16:55:38,499 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEkJERUYzOTlEOTBDNTEwNTIwQgA='}]}
2025-06-12 16:55:38,500 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:55:38] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:55:39,197 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:55:39] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:55:39,885 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:55:39] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:55:44,642 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': '1'}
2025-06-12 16:55:44,648 - handlers.order_handler - INFO - Item 'Suya-Spiced Chicken Platter' added to cart for session 2349030918492. Cart: {'Suya-Spiced Chicken Platter': {'item_id': 'Suya-Spiced Chicken Platter', 'quantity': 1, 'price': 1600.0, 'total_price': 1600.0, 'variations': {}}}
2025-06-12 16:55:44,653 - services.lead_tracker - INFO - Cart addition tracked for 2349030918492: ₦1,600.0 (1 items)
2025-06-12 16:55:44,653 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2349030918492 - ₦1,600.00
2025-06-12 16:55:44,653 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': "🛒 *Your Cart:*\n• 1 x Suya-Spiced Chicken Platter (₦1,600.0) = ₦1,600.0\n\n💰 *Total: ₦1,600.0*\n\nWhat would you like to do next?\n\nPress 'Checkout' to finalize.\nPress 'Order More' to add more items.\nOr, press 'Other Options' for cart management."}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'checkout', 'title': 'Checkout'}}, {'type': 'reply', 'reply': {'id': 'order_more', 'title': 'Order More'}}, {'type': 'reply', 'reply': {'id': 'other_actions', 'title': 'Other Options'}}]}}}
2025-06-12 16:55:45,401 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjBDNTM2MEE4QUQ3NzlGRkU4RQA="}]}
2025-06-12 16:55:45,404 - services.lead_tracker - INFO - Cart addition tracked for 2349030918492: ₦1,600.0 (1 items)
2025-06-12 16:55:45,404 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2349030918492 - ₦1,600.00
2025-06-12 16:55:45,405 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjBDNTM2MEE4QUQ3NzlGRkU4RQA='}]}
2025-06-12 16:55:45,405 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:55:45] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:55:46,106 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:55:46] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:55:46,282 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:55:46] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:55:55,590 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'ai_assistant'}
2025-06-12 16:55:55,595 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_assistant' in greeting state for session 2347082345056.
2025-06-12 16:55:55,596 - handlers.base_handler - INFO - Session 2347082345056 redirecting to AIHandler for AI menu.
2025-06-12 16:55:55,597 - handlers.message_processor - INFO - Redirecting session 2347082345056 to handler 'ai_handler' with message 'initial_entry'.
2025-06-12 16:55:55,597 - handlers.base_handler - INFO - AIHandler: Handling message 'initial_entry' in AI menu state for session 2347082345056. Original: 'ai_assistant'
2025-06-12 16:55:55,597 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🤖 *AI Assistant Options*\n\n🤖 *Lola Chatbot* - Chat with our AI assistant\n🛒 *AI Bulk Order* - Order multiple items at once\n\nPlease select an AI option:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'lola_chatbot', 'title': '🤖 Lola Chatbot'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order', 'title': '🛒 AI Bulk Order'}}, {'type': 'reply', 'reply': {'id': 'back_to_main', 'title': '🔙 Back to Main'}}]}}}
2025-06-12 16:55:56,343 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkVFMDkwMzVGREI3OTBBODQzNgA="}]}
2025-06-12 16:55:56,344 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkVFMDkwMzVGREI3OTBBODQzNgA='}]}
2025-06-12 16:55:56,346 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:55:56] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:55:57,233 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:55:57] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:55:57,696 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:55:57] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:55:57,942 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:55:57] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:56:01,185 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'ai_bulk_order'}
2025-06-12 16:56:01,189 - handlers.base_handler - INFO - AIHandler: Handling message 'ai_bulk_order' in AI menu state for session 2347082345056. Original: 'ai_bulk_order'
2025-06-12 16:56:01,190 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'text', 'text': {'body': '🛒 *AI Bulk Order Assistant*\n\nTell me everything you want to order in one message! For example:\n\n_"2 chief burgers with drinks, 3 jollof rice with chicken, large fries and 4 cokes"_\n\nI\'ll understand your order and help you confirm it! 🚀\n\n_Type \'menu\' to go back to the main menu_'}}
2025-06-12 16:56:02,167 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkM2Qzg0RUVDNTk4ODE1REE5NAA="}]}
2025-06-12 16:56:02,168 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkM2Qzg0RUVDNTk4ODE1REE5NAA='}]}
2025-06-12 16:56:02,168 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:56:02] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:56:03,210 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:56:03] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:56:03,444 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:56:03] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:56:03,449 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:56:03] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:56:17,487 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': 'checkout'}
2025-06-12 16:56:17,491 - handlers.order_handler - INFO - User selected 'Checkout' for session 2349030918492.
2025-06-12 16:56:17,491 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '📋 *Confirm Delivery Details:*\n\n👤 *Name:* Benny\n📱 *Phone:* 2349030918492\n📍 *Address:* None\n\nIs this information correct?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'details_correct', 'title': '✅ Correct'}}, {'type': 'reply', 'reply': {'id': 'change_all_details', 'title': '✏️ Change Details'}}]}}}
2025-06-12 16:56:18,182 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjExODhCMUM2N0NFNkU2NTczMAA="}]}
2025-06-12 16:56:18,187 - services.lead_tracker - INFO - Cart addition tracked for 2349030918492: ₦1,600.0 (1 items)
2025-06-12 16:56:18,187 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2349030918492 - ₦1,600.00
2025-06-12 16:56:18,187 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjExODhCMUM2N0NFNkU2NTczMAA='}]}
2025-06-12 16:56:18,188 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:56:18] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:56:19,160 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:56:19] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:56:19,582 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:56:19] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:56:21,196 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'back_to_main'}
2025-06-12 16:56:21,200 - handlers.base_handler - INFO - AIHandler: Handling message 'back_to_main' in AI bulk order state for session 2347082345056. Original: 'back_to_main'
2025-06-12 16:56:23,241 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-12 16:56:23,242 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'text', 'text': {'body': "❌ No items were recognized in the order.\n\nPlease try rephrasing your order or type 'menu' to return to main menu."}}
2025-06-12 16:56:24,201 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjk1RkQ5NTk1MjhEQTg1Q0U4QQA="}]}
2025-06-12 16:56:24,203 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjk1RkQ5NTk1MjhEQTg1Q0U4QQA='}]}
2025-06-12 16:56:24,205 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:56:24] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:56:25,037 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:56:25] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:56:25,533 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:56:25] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:56:25,548 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:56:25] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:58:29,372 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': 'details_correct'}
2025-06-12 16:58:29,376 - handlers.order_handler - INFO - User confirmed details are correct for session 2349030918492.
2025-06-12 16:58:29,376 - handlers.order_handler - INFO - Address not set, redirecting to location handler for session 2349030918492.
2025-06-12 16:58:29,376 - handlers.message_processor - INFO - Redirecting session 2349030918492 to handler 'location_handler' with message 'initiate_address_collection'.
2025-06-12 16:58:29,377 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'text', 'text': {'body': 'Please choose a valid option from the menu.'}}
2025-06-12 16:58:30,314 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjBCNkI0RERGNTE3NDVBQjBBNAA="}]}
2025-06-12 16:58:30,316 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '📍 *How would you like to provide your delivery address?*\n\nChoose the most convenient option:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'share_current_location', 'title': '📍 Share Current Location'}}, {'type': 'reply', 'reply': {'id': 'type_address_manually', 'title': '✏️ Type Address Manually'}}]}}}
2025-06-12 16:58:30,867 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 400 Client Error: Bad Request for url: https://graph.facebook.com/v17.0/608867502309431/messages - {"error":{"message":"(#131009) Parameter value is not valid","type":"OAuthException","code":131009,"error_data":{"messaging_product":"whatsapp","details":"Button title length invalid. Min length: 1, Max length: 20"},"fbtrace_id":"Ab94TdVCFFJ6_369GVoPr_M"}}
2025-06-12 16:58:30,867 - handlers.message_processor - WARNING - No specific handler or state match for handler 'location_handler', state 'address_collection_menu', message 'initiate_address_collection' for session 2349030918492. Resetting to greeting.
2025-06-12 16:58:30,867 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'text', 'text': {'body': "I'm sorry, I didn't quite understand that. Let's get back to the main menu."}}
2025-06-12 16:58:31,173 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:58:31] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:58:31,671 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjMzN0E2RUE2RTBFMkY3N0ZENwA="}]}
2025-06-12 16:58:31,672 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Benny! 👋\n\nPlease choose from the options below:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order', 'title': '🛒 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_assistant', 'title': '🤖 AI Assistant'}}, {'type': 'reply', 'reply': {'id': 'others', 'title': '⚙️ Others'}}]}}}
2025-06-12 16:58:31,698 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:58:31] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:58:32,399 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjE1REVBNjY5NjYwQ0JDMDU5NwA="}]}
2025-06-12 16:58:32,402 - services.lead_tracker - INFO - Cart addition tracked for 2349030918492: ₦1,600.0 (1 items)
2025-06-12 16:58:32,402 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2349030918492 - ₦1,600.00
2025-06-12 16:58:32,403 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjE1REVBNjY5NjYwQ0JDMDU5NwA='}]}
2025-06-12 16:58:32,403 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:58:32] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:58:32,435 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:58:32] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:58:32,600 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:58:32] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:58:33,164 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:58:33] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:58:33,467 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:58:33] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:58:35,617 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': 'order'}
2025-06-12 16:58:35,621 - handlers.base_handler - INFO - GreetingHandler: Handling message 'order' in greeting state for session 2349030918492.
2025-06-12 16:58:35,621 - handlers.base_handler - INFO - Session 2349030918492 redirecting to menu_handler for classic menu.
2025-06-12 16:58:35,622 - handlers.message_processor - INFO - Redirecting session 2349030918492 to handler 'menu_handler' with message 'show_menu'.
2025-06-12 16:58:35,622 - handlers.base_handler - INFO - MenuHandler: Received message 'show_menu' (original: 'order') in menu state for session 2349030918492
2025-06-12 16:58:35,623 - handlers.base_handler - INFO - Showing menu categories for session 2349030918492
2025-06-12 16:58:35,623 - handlers.base_handler - INFO - Available categories: ['Main Dishes', 'Soups & Stews', 'Sides', 'Snacks', 'Drinks', 'Desserts', 'Specialties']
2025-06-12 16:58:35,623 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'interactive', 'interactive': {'type': 'list', 'body': {'text': '🍽️ *Our Menu*\n\nChoose a category to browse items:'}, 'action': {'button': 'Categories', 'sections': [{'title': 'Menu Categories', 'rows': [{'id': 'main dishes', 'title': 'Main Dishes'}, {'id': 'soups & stews', 'title': 'Soups & Stews'}, {'id': 'sides', 'title': 'Sides'}, {'id': 'snacks', 'title': 'Snacks'}, {'id': 'drinks', 'title': 'Drinks'}, {'id': 'desserts', 'title': 'Desserts'}, {'id': 'specialties', 'title': 'Specialties'}]}]}}}
2025-06-12 16:58:36,860 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjg1ODA3RUZEOEEyNkQzM0UxMQA="}]}
2025-06-12 16:58:36,864 - services.lead_tracker - INFO - Cart addition tracked for 2349030918492: ₦1,600.0 (1 items)
2025-06-12 16:58:36,864 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2349030918492 - ₦1,600.00
2025-06-12 16:58:36,865 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjg1ODA3RUZEOEEyNkQzM0UxMQA='}]}
2025-06-12 16:58:36,865 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:58:36] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:58:37,576 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:58:37] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:58:37,814 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:58:37] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:58:42,350 - handlers.webhook_handler - INFO - List reply received: id='snacks', title='Snacks'
2025-06-12 16:58:42,350 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': 'snacks'}
2025-06-12 16:58:42,353 - handlers.base_handler - INFO - MenuHandler: Received message 'snacks' (original: 'snacks') in menu state for session 2349030918492
2025-06-12 16:58:42,353 - handlers.base_handler - INFO - Category 'Snacks' selected for session 2349030918492
2025-06-12 16:58:42,353 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'interactive', 'interactive': {'type': 'list', 'body': {'text': '🍽️ *Snacks*\n\nSelect an item to add to your cart:'}, 'action': {'button': 'Select Item', 'sections': [{'title': 'Snacks Items', 'rows': [{'id': 'Puff Puff', 'title': 'Puff Puff (₦200)'}, {'id': 'Samosa (4pcs)', 'title': 'Samosa (4pcs) (₦300)'}, {'id': 'Spring Rolls (4pcs)', 'title': 'Spring Rolls (4pc (₦300)'}, {'id': 'Chin Chin (Small Pack)', 'title': 'Chin Chin (Small (₦150)'}, {'id': 'Meat Pie', 'title': 'Meat Pie (₦300)'}, {'id': 'Chicken Shawarma', 'title': 'Chicken Shawarma (₦800)'}, {'id': 'Fish Rolls (4pcs)', 'title': 'Fish Rolls (4pcs) (₦400)'}, {'id': 'Plantaintain Chips', 'title': 'Plantaintain Chip (₦200)'}, {'id': 'Akara Balls (6pcs)', 'title': 'Akara Balls (6pcs (₦200)'}, {'id': 'Peppered Snail', 'title': 'Peppered Snail (₦1,200)'}]}]}}}
2025-06-12 16:58:43,137 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjkwNEM3NzBCNTY2MTcyNzA0NAA="}]}
2025-06-12 16:58:43,148 - services.lead_tracker - INFO - Cart addition tracked for 2349030918492: ₦1,600.0 (1 items)
2025-06-12 16:58:43,148 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2349030918492 - ₦1,600.00
2025-06-12 16:58:43,148 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjkwNEM3NzBCNTY2MTcyNzA0NAA='}]}
2025-06-12 16:58:43,150 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:58:43] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:58:43,981 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:58:43] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:58:44,464 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:58:44] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:58:48,567 - handlers.webhook_handler - INFO - List reply received: id='Meat Pie', title='Meat Pie (₦300)'
2025-06-12 16:58:48,568 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': 'Meat Pie'}
2025-06-12 16:58:48,572 - handlers.base_handler - INFO - MenuHandler: Handling item selection 'Meat Pie' for session 2349030918492
2025-06-12 16:58:48,573 - handlers.base_handler - INFO - Item 'Meat Pie' selected for session 2349030918492, redirecting to order handler
2025-06-12 16:58:48,573 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'text', 'text': {'body': '🛒 *Meat Pie*\nPrice: ₦300\n\nHow many would you like to order?\n\nPlease enter a number (e.g., 1, 2, 3...):'}}
2025-06-12 16:58:49,358 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjI1RUEzRThDNjAwNkI1RTNCRQA="}]}
2025-06-12 16:58:49,363 - services.lead_tracker - INFO - Cart addition tracked for 2349030918492: ₦1,600.0 (1 items)
2025-06-12 16:58:49,363 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2349030918492 - ₦1,600.00
2025-06-12 16:58:49,363 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjI1RUEzRThDNjAwNkI1RTNCRQA='}]}
2025-06-12 16:58:49,364 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:58:49] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:58:50,345 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:58:50] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:58:50,486 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:58:50] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:58:53,959 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': '3'}
2025-06-12 16:58:53,965 - handlers.order_handler - INFO - Item 'Meat Pie' added to cart for session 2349030918492. Cart: {'Suya-Spiced Chicken Platter': {'item_id': 'Suya-Spiced Chicken Platter', 'quantity': 1, 'price': 1600.0, 'total_price': 1600.0, 'variations': {}}, 'Meat Pie': {'item_id': 'Meat Pie', 'quantity': 3, 'price': 300.0, 'total_price': 900.0, 'variations': {}}}
2025-06-12 16:58:53,976 - services.lead_tracker - INFO - Cart addition tracked for 2349030918492: ₦2,500.0 (2 items)
2025-06-12 16:58:53,976 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2349030918492 - ₦2,500.00
2025-06-12 16:58:53,977 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': "🛒 *Your Cart:*\n• 1 x Suya-Spiced Chicken Platter (₦1,600.0) = ₦1,600.0\n• 3 x Meat Pie (₦300.0) = ₦900.0\n\n💰 *Total: ₦2,500.0*\n\nWhat would you like to do next?\n\nPress 'Checkout' to finalize.\nPress 'Order More' to add more items.\nOr, press 'Other Options' for cart management."}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'checkout', 'title': 'Checkout'}}, {'type': 'reply', 'reply': {'id': 'order_more', 'title': 'Order More'}}, {'type': 'reply', 'reply': {'id': 'other_actions', 'title': 'Other Options'}}]}}}
2025-06-12 16:58:54,851 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjcyQzkxRkYzRThDNzRCMzNGQgA="}]}
2025-06-12 16:58:54,856 - services.lead_tracker - INFO - Cart addition tracked for 2349030918492: ₦2,500.0 (2 items)
2025-06-12 16:58:54,856 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2349030918492 - ₦2,500.00
2025-06-12 16:58:54,857 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjcyQzkxRkYzRThDNzRCMzNGQgA='}]}
2025-06-12 16:58:54,857 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:58:54] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:58:55,658 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:58:55] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:58:56,045 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:58:56] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:59:03,969 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': 'checkout'}
2025-06-12 16:59:03,976 - handlers.order_handler - INFO - User selected 'Checkout' for session 2349030918492.
2025-06-12 16:59:03,976 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '📋 *Confirm Delivery Details:*\n\n👤 *Name:* Benny\n📱 *Phone:* 2349030918492\n📍 *Address:* None\n\nIs this information correct?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'details_correct', 'title': '✅ Correct'}}, {'type': 'reply', 'reply': {'id': 'change_all_details', 'title': '✏️ Change Details'}}]}}}
2025-06-12 16:59:04,756 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjk4MkFFRDBCMTBFRkE3NUMyRAA="}]}
2025-06-12 16:59:04,762 - services.lead_tracker - INFO - Cart addition tracked for 2349030918492: ₦2,500.0 (2 items)
2025-06-12 16:59:04,762 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2349030918492 - ₦2,500.00
2025-06-12 16:59:04,762 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjk4MkFFRDBCMTBFRkE3NUMyRAA='}]}
2025-06-12 16:59:04,764 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:59:04] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:59:05,557 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:59:05] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:59:05,837 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:59:05] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:59:11,556 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': 'details_correct'}
2025-06-12 16:59:11,560 - handlers.order_handler - INFO - User confirmed details are correct for session 2349030918492.
2025-06-12 16:59:11,560 - handlers.order_handler - INFO - Address not set, redirecting to location handler for session 2349030918492.
2025-06-12 16:59:11,560 - handlers.message_processor - INFO - Redirecting session 2349030918492 to handler 'location_handler' with message 'initiate_address_collection'.
2025-06-12 16:59:11,561 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'text', 'text': {'body': 'Please choose a valid option from the menu.'}}
2025-06-12 16:59:12,413 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjU1NzlBMDc1QTg0ODY2RkFDQQA="}]}
2025-06-12 16:59:12,414 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '📍 *How would you like to provide your delivery address?*\n\nChoose the most convenient option:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'share_current_location', 'title': '📍 Share Current Location'}}, {'type': 'reply', 'reply': {'id': 'type_address_manually', 'title': '✏️ Type Address Manually'}}]}}}
2025-06-12 16:59:12,885 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 400 Client Error: Bad Request for url: https://graph.facebook.com/v17.0/608867502309431/messages - {"error":{"message":"(#131009) Parameter value is not valid","type":"OAuthException","code":131009,"error_data":{"messaging_product":"whatsapp","details":"Button title length invalid. Min length: 1, Max length: 20"},"fbtrace_id":"AvDlj14pZqq-qjrfE2dv4fb"}}
2025-06-12 16:59:12,886 - handlers.message_processor - WARNING - No specific handler or state match for handler 'location_handler', state 'address_collection_menu', message 'initiate_address_collection' for session 2349030918492. Resetting to greeting.
2025-06-12 16:59:12,886 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'text', 'text': {'body': "I'm sorry, I didn't quite understand that. Let's get back to the main menu."}}
2025-06-12 16:59:13,305 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:59:13] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:59:13,396 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:59:13] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:59:13,608 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjc0NEE5NEFBMjExNjIwNkZCRAA="}]}
2025-06-12 16:59:13,609 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Benny! 👋\n\nPlease choose from the options below:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order', 'title': '🛒 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_assistant', 'title': '🤖 AI Assistant'}}, {'type': 'reply', 'reply': {'id': 'others', 'title': '⚙️ Others'}}]}}}
2025-06-12 16:59:14,418 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjREQjk2OUI3MDJFMjBENkVBRAA="}]}
2025-06-12 16:59:14,422 - services.lead_tracker - INFO - Cart addition tracked for 2349030918492: ₦2,500.0 (2 items)
2025-06-12 16:59:14,422 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2349030918492 - ₦2,500.00
2025-06-12 16:59:14,423 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjREQjk2OUI3MDJFMjBENkVBRAA='}]}
2025-06-12 16:59:14,423 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:59:14] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:59:14,455 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:59:14] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:59:15,108 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:59:15] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:59:15,279 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:59:15] "POST /webhook HTTP/1.1" 200 -
2025-06-12 16:59:15,448 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 16:59:15] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:00:01,530 - handlers.webhook_handler - INFO - Processing message from 2348026314159 (User: Daniel Israel): {'type': 'text', 'text': 'Hi'}
2025-06-12 17:00:01,530 - utils.session_manager - INFO - New session 2348026314159 initialized.
2025-06-12 17:00:01,533 - services.lead_tracker - INFO - New lead tracked: 2348026314159 (Daniel Israel)
2025-06-12 17:00:01,533 - handlers.lead_tracking_handler - INFO - 🆕 New lead detected: 2348026314159 (Daniel Israel)
2025-06-12 17:00:01,535 - handlers.base_handler - INFO - Session 2348026314159 initialized with greeting state for user 'Daniel Israel'.
2025-06-12 17:00:01,536 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348026314159', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Daniel Israel! 👋\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order', 'title': '🛒 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_assistant', 'title': '🤖 AI Assistant'}}, {'type': 'reply', 'reply': {'id': 'others', 'title': '⚙️ Others'}}]}}}
2025-06-12 17:00:02,506 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348026314159","wa_id":"2348026314159"}],"messages":[{"id":"wamid.HBgNMjM0ODAyNjMxNDE1ORUCABEYEkU4NTM4NkQwRUFBOURCRjg1NQA="}]}
2025-06-12 17:00:02,507 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348026314159', 'wa_id': '2348026314159'}], 'messages': [{'id': 'wamid.HBgNMjM0ODAyNjMxNDE1ORUCABEYEkU4NTM4NkQwRUFBOURCRjg1NQA='}]}
2025-06-12 17:00:02,508 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:00:02] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:00:06,364 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:00:06] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:00:07,058 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:00:07] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:00:07,194 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': 'change_all_details'}
2025-06-12 17:00:07,199 - handlers.base_handler - INFO - GreetingHandler: Handling message 'change_all_details' in greeting state for session 2349030918492.
2025-06-12 17:00:07,199 - handlers.base_handler - WARNING - Session 2349030918492: Invalid option 'change_all_details' in greeting state.
2025-06-12 17:00:07,200 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Benny! 👋\n\nInvalid option. Please choose from the options below:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order', 'title': '🛒 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_assistant', 'title': '🤖 AI Assistant'}}, {'type': 'reply', 'reply': {'id': 'others', 'title': '⚙️ Others'}}]}}}
2025-06-12 17:00:08,168 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjUzNUM2ODUyRkE0OUUxRDMzMAA="}]}
2025-06-12 17:00:08,172 - services.lead_tracker - INFO - Cart addition tracked for 2349030918492: ₦2,500.0 (2 items)
2025-06-12 17:00:08,172 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2349030918492 - ₦2,500.00
2025-06-12 17:00:08,172 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjUzNUM2ODUyRkE0OUUxRDMzMAA='}]}
2025-06-12 17:00:08,173 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:00:08] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:00:08,934 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:00:08] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:00:09,842 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:00:09] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:00:10,870 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': 'order'}
2025-06-12 17:00:10,876 - handlers.base_handler - INFO - GreetingHandler: Handling message 'order' in greeting state for session 2349030918492.
2025-06-12 17:00:10,876 - handlers.base_handler - INFO - Session 2349030918492 redirecting to menu_handler for classic menu.
2025-06-12 17:00:10,876 - handlers.message_processor - INFO - Redirecting session 2349030918492 to handler 'menu_handler' with message 'show_menu'.
2025-06-12 17:00:10,877 - handlers.base_handler - INFO - MenuHandler: Received message 'show_menu' (original: 'order') in menu state for session 2349030918492
2025-06-12 17:00:10,877 - handlers.base_handler - INFO - Showing menu categories for session 2349030918492
2025-06-12 17:00:10,877 - handlers.base_handler - INFO - Available categories: ['Main Dishes', 'Soups & Stews', 'Sides', 'Snacks', 'Drinks', 'Desserts', 'Specialties']
2025-06-12 17:00:10,877 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'interactive', 'interactive': {'type': 'list', 'body': {'text': '🍽️ *Our Menu*\n\nChoose a category to browse items:'}, 'action': {'button': 'Categories', 'sections': [{'title': 'Menu Categories', 'rows': [{'id': 'main dishes', 'title': 'Main Dishes'}, {'id': 'soups & stews', 'title': 'Soups & Stews'}, {'id': 'sides', 'title': 'Sides'}, {'id': 'snacks', 'title': 'Snacks'}, {'id': 'drinks', 'title': 'Drinks'}, {'id': 'desserts', 'title': 'Desserts'}, {'id': 'specialties', 'title': 'Specialties'}]}]}}}
2025-06-12 17:00:11,569 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjZBMDU5QTVDMjRGNDVBRTJBMgA="}]}
2025-06-12 17:00:11,584 - services.lead_tracker - INFO - Cart addition tracked for 2349030918492: ₦2,500.0 (2 items)
2025-06-12 17:00:11,585 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2349030918492 - ₦2,500.00
2025-06-12 17:00:11,586 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjZBMDU5QTVDMjRGNDVBRTJBMgA='}]}
2025-06-12 17:00:11,589 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:00:11] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:00:12,428 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:00:12] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:00:12,758 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:00:12] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:00:16,528 - handlers.webhook_handler - INFO - List reply received: id='sides', title='Sides'
2025-06-12 17:00:16,528 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': 'sides'}
2025-06-12 17:00:16,531 - handlers.base_handler - INFO - MenuHandler: Received message 'sides' (original: 'sides') in menu state for session 2349030918492
2025-06-12 17:00:16,532 - handlers.base_handler - INFO - Category 'Sides' selected for session 2349030918492
2025-06-12 17:00:16,532 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'interactive', 'interactive': {'type': 'list', 'body': {'text': '🍽️ *Sides*\n\nSelect an item to add to your cart:'}, 'action': {'button': 'Select Item', 'sections': [{'title': 'Sides Items', 'rows': [{'id': 'Fried Plantain', 'title': 'Fried Plantain (₦500)'}, {'id': 'Yam Fries with Pepper Dip', 'title': 'Yam Fries with Pe (₦600)'}, {'id': 'Coleslaw', 'title': 'Coleslaw (₦400)'}, {'id': 'Moi Moi', 'title': 'Moi Moi (₦500)'}, {'id': 'Boiled Yam Slices', 'title': 'Boiled Yam Slices (₦400)'}, {'id': 'Vegetable Salad', 'title': 'Vegetable Salad (₦500)'}, {'id': 'Spicy Gizdodo', 'title': 'Spicy Gizdodo (₦700)'}, {'id': 'Jollof Beans', 'title': 'Jollof Beans (₦600)'}, {'id': 'Sweet Potato Wedges', 'title': 'Sweet Potato Wedg (₦500)'}, {'id': 'Garlic Bread Rolls', 'title': 'Garlic Bread Roll (₦400)'}]}]}}}
2025-06-12 17:00:17,204 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjAxMDM4OEIyRjI1NUM1MDgzNgA="}]}
2025-06-12 17:00:17,206 - services.lead_tracker - INFO - Cart addition tracked for 2349030918492: ₦2,500.0 (2 items)
2025-06-12 17:00:17,207 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2349030918492 - ₦2,500.00
2025-06-12 17:00:17,207 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjAxMDM4OEIyRjI1NUM1MDgzNgA='}]}
2025-06-12 17:00:17,207 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:00:17] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:00:17,957 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:00:17] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:00:18,426 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:00:18] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:00:20,374 - handlers.webhook_handler - INFO - Processing message from 2348026314159 (User: Daniel Israel): {'type': 'text', 'text': 'order'}
2025-06-12 17:00:20,377 - handlers.base_handler - INFO - GreetingHandler: Handling message 'order' in greeting state for session 2348026314159.
2025-06-12 17:00:20,377 - handlers.base_handler - INFO - Session 2348026314159 redirecting to menu_handler for classic menu.
2025-06-12 17:00:20,377 - handlers.message_processor - INFO - Redirecting session 2348026314159 to handler 'menu_handler' with message 'show_menu'.
2025-06-12 17:00:20,378 - handlers.base_handler - INFO - MenuHandler: Received message 'show_menu' (original: 'order') in menu state for session 2348026314159
2025-06-12 17:00:20,378 - handlers.base_handler - INFO - Showing menu categories for session 2348026314159
2025-06-12 17:00:20,378 - handlers.base_handler - INFO - Available categories: ['Main Dishes', 'Soups & Stews', 'Sides', 'Snacks', 'Drinks', 'Desserts', 'Specialties']
2025-06-12 17:00:20,379 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348026314159', 'type': 'interactive', 'interactive': {'type': 'list', 'body': {'text': '🍽️ *Our Menu*\n\nChoose a category to browse items:'}, 'action': {'button': 'Categories', 'sections': [{'title': 'Menu Categories', 'rows': [{'id': 'main dishes', 'title': 'Main Dishes'}, {'id': 'soups & stews', 'title': 'Soups & Stews'}, {'id': 'sides', 'title': 'Sides'}, {'id': 'snacks', 'title': 'Snacks'}, {'id': 'drinks', 'title': 'Drinks'}, {'id': 'desserts', 'title': 'Desserts'}, {'id': 'specialties', 'title': 'Specialties'}]}]}}}
2025-06-12 17:00:21,184 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348026314159","wa_id":"2348026314159"}],"messages":[{"id":"wamid.HBgNMjM0ODAyNjMxNDE1ORUCABEYEkNCOTkyNjczRDcxODRCOTQxMgA="}]}
2025-06-12 17:00:21,185 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348026314159', 'wa_id': '2348026314159'}], 'messages': [{'id': 'wamid.HBgNMjM0ODAyNjMxNDE1ORUCABEYEkNCOTkyNjczRDcxODRCOTQxMgA='}]}
2025-06-12 17:00:21,185 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:00:21] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:00:21,481 - handlers.webhook_handler - INFO - List reply received: id='Moi Moi', title='Moi Moi (₦500)'
2025-06-12 17:00:21,481 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': 'Moi Moi'}
2025-06-12 17:00:21,485 - handlers.base_handler - INFO - MenuHandler: Handling item selection 'Moi Moi' for session 2349030918492
2025-06-12 17:00:21,485 - handlers.base_handler - INFO - Item 'Moi Moi' selected for session 2349030918492, redirecting to order handler
2025-06-12 17:00:21,485 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'text', 'text': {'body': '🛒 *Moi Moi*\nPrice: ₦500\n\nHow many would you like to order?\n\nPlease enter a number (e.g., 1, 2, 3...):'}}
2025-06-12 17:00:22,111 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:00:22] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:00:22,237 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjI1NTczMkM1OEIxNkVGRUFGQwA="}]}
2025-06-12 17:00:22,245 - services.lead_tracker - INFO - Cart addition tracked for 2349030918492: ₦2,500.0 (2 items)
2025-06-12 17:00:22,245 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2349030918492 - ₦2,500.00
2025-06-12 17:00:22,246 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjI1NTczMkM1OEIxNkVGRUFGQwA='}]}
2025-06-12 17:00:22,246 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:00:22] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:00:22,755 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:00:22] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:00:22,979 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:00:22] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:00:23,182 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:00:23] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:00:25,287 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': '5'}
2025-06-12 17:00:25,295 - handlers.order_handler - INFO - Item 'Moi Moi' added to cart for session 2349030918492. Cart: {'Suya-Spiced Chicken Platter': {'item_id': 'Suya-Spiced Chicken Platter', 'quantity': 1, 'price': 1600.0, 'total_price': 1600.0, 'variations': {}}, 'Meat Pie': {'item_id': 'Meat Pie', 'quantity': 3, 'price': 300.0, 'total_price': 900.0, 'variations': {}}, 'Moi Moi': {'item_id': 'Moi Moi', 'quantity': 5, 'price': 500.0, 'total_price': 2500.0, 'variations': {}}}
2025-06-12 17:00:25,303 - services.lead_tracker - INFO - Cart addition tracked for 2349030918492: ₦5,000.0 (3 items)
2025-06-12 17:00:25,304 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2349030918492 - ₦5,000.00
2025-06-12 17:00:25,305 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': "🛒 *Your Cart:*\n• 1 x Suya-Spiced Chicken Platter (₦1,600.0) = ₦1,600.0\n• 3 x Meat Pie (₦300.0) = ₦900.0\n• 5 x Moi Moi (₦500.0) = ₦2,500.0\n\n💰 *Total: ₦5,000.0*\n\nWhat would you like to do next?\n\nPress 'Checkout' to finalize.\nPress 'Order More' to add more items.\nOr, press 'Other Options' for cart management."}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'checkout', 'title': 'Checkout'}}, {'type': 'reply', 'reply': {'id': 'order_more', 'title': 'Order More'}}, {'type': 'reply', 'reply': {'id': 'other_actions', 'title': 'Other Options'}}]}}}
2025-06-12 17:00:26,066 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjBENzUxNjZDNjk5Qjc0Qjg3NQA="}]}
2025-06-12 17:00:26,075 - services.lead_tracker - INFO - Cart addition tracked for 2349030918492: ₦5,000.0 (3 items)
2025-06-12 17:00:26,075 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2349030918492 - ₦5,000.00
2025-06-12 17:00:26,077 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjBENzUxNjZDNjk5Qjc0Qjg3NQA='}]}
2025-06-12 17:00:26,078 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:00:26] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:00:26,762 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:00:26] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:00:27,134 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:00:27] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:00:30,222 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': 'checkout'}
2025-06-12 17:00:30,225 - handlers.order_handler - INFO - User selected 'Checkout' for session 2349030918492.
2025-06-12 17:00:30,226 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '📋 *Confirm Delivery Details:*\n\n👤 *Name:* Benny\n📱 *Phone:* 2349030918492\n📍 *Address:* None\n\nIs this information correct?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'details_correct', 'title': '✅ Correct'}}, {'type': 'reply', 'reply': {'id': 'change_all_details', 'title': '✏️ Change Details'}}]}}}
2025-06-12 17:00:30,873 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjdDM0RFNUFDOTZDRUUzRkM2MAA="}]}
2025-06-12 17:00:30,876 - services.lead_tracker - INFO - Cart addition tracked for 2349030918492: ₦5,000.0 (3 items)
2025-06-12 17:00:30,876 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2349030918492 - ₦5,000.00
2025-06-12 17:00:30,877 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjdDM0RFNUFDOTZDRUUzRkM2MAA='}]}
2025-06-12 17:00:30,877 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:00:30] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:00:31,634 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:00:31] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:00:32,127 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:00:32] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:00:32,783 - handlers.webhook_handler - INFO - List reply received: id='main dishes', title='Main Dishes'
2025-06-12 17:00:32,784 - handlers.webhook_handler - INFO - Processing message from 2348026314159 (User: Daniel Israel): {'type': 'text', 'text': 'main dishes'}
2025-06-12 17:00:32,797 - handlers.base_handler - INFO - MenuHandler: Received message 'main dishes' (original: 'main dishes') in menu state for session 2348026314159
2025-06-12 17:00:32,799 - handlers.base_handler - INFO - Category 'Main Dishes' selected for session 2348026314159
2025-06-12 17:00:32,803 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348026314159', 'type': 'interactive', 'interactive': {'type': 'list', 'body': {'text': '🍽️ *Main Dishes*\n\nSelect an item to add to your cart:'}, 'action': {'button': 'Select Item', 'sections': [{'title': 'Main Dishes Items', 'rows': [{'id': 'Smoky Jollof Fiesta', 'title': 'Smoky Jollof Fi (₦1,500)'}, {'id': 'Egusi Pasta Primavera', 'title': 'Egusi Pasta Pri (₦1,800)'}, {'id': 'Grilled Tilapia with Herb Crust', 'title': 'Grilled Tilapia (₦2,000)'}, {'id': 'Pounded Yam with Vegetable Soup', 'title': 'Pounded Yam wit (₦1,700)'}, {'id': 'Fried Rice Fiesta', 'title': 'Fried Rice Fies (₦1,400)'}, {'id': 'Suya-Spiced Chicken Platter', 'title': 'Suya-Spiced Chi (₦1,600)'}, {'id': 'Banga Rice Delight', 'title': 'Banga Rice Deli (₦1,300)'}, {'id': 'Plantain Porridge with Fish', 'title': 'Plantain Porrid (₦1,500)'}, {'id': 'Amala with Gbegiri and Ewedu', 'title': 'Amala with Gbeg (₦1,600)'}, {'id': 'Spicy Beef Stir-Fry', 'title': 'Spicy Beef Stir (₦1,700)'}]}]}}}
2025-06-12 17:00:33,588 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348026314159","wa_id":"2348026314159"}],"messages":[{"id":"wamid.HBgNMjM0ODAyNjMxNDE1ORUCABEYEjYzOEM1NzE1MDVBRkExMjNEMgA="}]}
2025-06-12 17:00:33,588 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348026314159', 'wa_id': '2348026314159'}], 'messages': [{'id': 'wamid.HBgNMjM0ODAyNjMxNDE1ORUCABEYEjYzOEM1NzE1MDVBRkExMjNEMgA='}]}
2025-06-12 17:00:33,589 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:00:33] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:00:33,757 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': 'change_all_details'}
2025-06-12 17:00:33,761 - handlers.order_handler - INFO - User opted to change details for session 2349030918492.
2025-06-12 17:00:33,761 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'text', 'text': {'body': 'Please provide your new name and delivery address (e.g., John Doe, 123 Main St).'}}
2025-06-12 17:00:34,383 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEkI4OTJGMzA2RUY1MDU3NEMyRQA="}]}
2025-06-12 17:00:34,389 - services.lead_tracker - INFO - Cart addition tracked for 2349030918492: ₦5,000.0 (3 items)
2025-06-12 17:00:34,390 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2349030918492 - ₦5,000.00
2025-06-12 17:00:34,390 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEkI4OTJGMzA2RUY1MDU3NEMyRQA='}]}
2025-06-12 17:00:34,390 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:00:34] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:00:34,691 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:00:34] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:00:35,146 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:00:35] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:00:35,210 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:00:35] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:00:35,359 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:00:35] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:00:57,453 - handlers.webhook_handler - INFO - List reply received: id='Suya-Spiced Chicken Platter', title='Suya-Spiced Chi (₦1,600)'
2025-06-12 17:00:57,454 - handlers.webhook_handler - INFO - Processing message from 2348026314159 (User: Daniel Israel): {'type': 'text', 'text': 'Suya-Spiced Chicken Platter'}
2025-06-12 17:00:57,464 - handlers.base_handler - INFO - MenuHandler: Handling item selection 'Suya-Spiced Chicken Platter' for session 2348026314159
2025-06-12 17:00:57,465 - handlers.base_handler - INFO - Item 'Suya-Spiced Chicken Platter' selected for session 2348026314159, redirecting to order handler
2025-06-12 17:00:57,465 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348026314159', 'type': 'text', 'text': {'body': '🛒 *Suya-Spiced Chicken Platter*\nPrice: ₦1,600\n\nHow many would you like to order?\n\nPlease enter a number (e.g., 1, 2, 3...):'}}
2025-06-12 17:00:58,176 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348026314159","wa_id":"2348026314159"}],"messages":[{"id":"wamid.HBgNMjM0ODAyNjMxNDE1ORUCABEYEkZFNjgxMTMwOEYxN0ZGQjlDNgA="}]}
2025-06-12 17:00:58,177 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348026314159', 'wa_id': '2348026314159'}], 'messages': [{'id': 'wamid.HBgNMjM0ODAyNjMxNDE1ORUCABEYEkZFNjgxMTMwOEYxN0ZGQjlDNgA='}]}
2025-06-12 17:00:58,177 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:00:58] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:00:59,061 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:00:59] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:00:59,543 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:00:59] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:01:06,432 - handlers.webhook_handler - INFO - Processing message from 2348026314159 (User: Daniel Israel): {'type': 'text', 'text': '2'}
2025-06-12 17:01:06,440 - handlers.order_handler - INFO - Item 'Suya-Spiced Chicken Platter' added to cart for session 2348026314159. Cart: {'Suya-Spiced Chicken Platter': {'item_id': 'Suya-Spiced Chicken Platter', 'quantity': 2, 'price': 1600.0, 'total_price': 3200.0, 'variations': {}}}
2025-06-12 17:01:06,443 - services.lead_tracker - INFO - Cart addition tracked for 2348026314159: ₦3,200.0 (1 items)
2025-06-12 17:01:06,444 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348026314159 - ₦3,200.00
2025-06-12 17:01:06,444 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348026314159', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': "🛒 *Your Cart:*\n• 2 x Suya-Spiced Chicken Platter (₦1,600.0) = ₦3,200.0\n\n💰 *Total: ₦3,200.0*\n\nWhat would you like to do next?\n\nPress 'Checkout' to finalize.\nPress 'Order More' to add more items.\nOr, press 'Other Options' for cart management."}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'checkout', 'title': 'Checkout'}}, {'type': 'reply', 'reply': {'id': 'order_more', 'title': 'Order More'}}, {'type': 'reply', 'reply': {'id': 'other_actions', 'title': 'Other Options'}}]}}}
2025-06-12 17:01:07,574 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348026314159","wa_id":"2348026314159"}],"messages":[{"id":"wamid.HBgNMjM0ODAyNjMxNDE1ORUCABEYEkNDMzIxOUFBQjAyNzZENTc0OQA="}]}
2025-06-12 17:01:07,577 - services.lead_tracker - INFO - Cart addition tracked for 2348026314159: ₦3,200.0 (1 items)
2025-06-12 17:01:07,577 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348026314159 - ₦3,200.00
2025-06-12 17:01:07,577 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348026314159', 'wa_id': '2348026314159'}], 'messages': [{'id': 'wamid.HBgNMjM0ODAyNjMxNDE1ORUCABEYEkNDMzIxOUFBQjAyNzZENTc0OQA='}]}
2025-06-12 17:01:07,578 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:01:07] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:01:08,565 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:01:08] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:01:08,860 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:01:08] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:01:19,359 - handlers.webhook_handler - INFO - Processing message from 2348026314159 (User: Daniel Israel): {'type': 'text', 'text': 'order_more'}
2025-06-12 17:01:19,366 - handlers.order_handler - INFO - User selected 'Order More' for session 2348026314159.
2025-06-12 17:01:19,366 - handlers.message_processor - INFO - Redirecting session 2348026314159 to handler 'menu_handler' with message 'show_menu'.
2025-06-12 17:01:19,366 - handlers.message_processor - WARNING - Unhandled order_handler state 'menu' for session 2348026314159
2025-06-12 17:01:19,366 - handlers.message_processor - WARNING - No specific handler or state match for handler 'order_handler', state 'menu', message 'show_menu' for session 2348026314159. Resetting to greeting.
2025-06-12 17:01:19,367 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348026314159', 'type': 'text', 'text': {'body': "I'm sorry, I didn't quite understand that. Let's get back to the main menu."}}
2025-06-12 17:01:20,213 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348026314159","wa_id":"2348026314159"}],"messages":[{"id":"wamid.HBgNMjM0ODAyNjMxNDE1ORUCABEYEjMxMkVDRUQxODEzQ0YyQzY3OAA="}]}
2025-06-12 17:01:20,213 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348026314159', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Daniel Israel! 👋\n\nPlease choose from the options below:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order', 'title': '🛒 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_assistant', 'title': '🤖 AI Assistant'}}, {'type': 'reply', 'reply': {'id': 'others', 'title': '⚙️ Others'}}]}}}
2025-06-12 17:01:20,940 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348026314159","wa_id":"2348026314159"}],"messages":[{"id":"wamid.HBgNMjM0ODAyNjMxNDE1ORUCABEYEkUzOTVGOEU2OThEMEM4QjE5QQA="}]}
2025-06-12 17:01:20,943 - services.lead_tracker - INFO - Cart addition tracked for 2348026314159: ₦3,200.0 (1 items)
2025-06-12 17:01:20,944 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348026314159 - ₦3,200.00
2025-06-12 17:01:20,944 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348026314159', 'wa_id': '2348026314159'}], 'messages': [{'id': 'wamid.HBgNMjM0ODAyNjMxNDE1ORUCABEYEkUzOTVGOEU2OThEMEM4QjE5QQA='}]}
2025-06-12 17:01:20,945 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:01:20] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:01:21,121 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:01:21] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:01:21,675 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:01:21] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:01:21,968 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:01:21] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:01:22,530 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:01:22] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:01:42,904 - handlers.webhook_handler - INFO - Processing message from 2348026314159 (User: Daniel Israel): {'type': 'text', 'text': 'checkout'}
2025-06-12 17:01:42,945 - handlers.base_handler - INFO - GreetingHandler: Handling message 'checkout' in greeting state for session 2348026314159.
2025-06-12 17:01:42,945 - handlers.base_handler - WARNING - Session 2348026314159: Invalid option 'checkout' in greeting state.
2025-06-12 17:01:42,946 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348026314159', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Daniel Israel! 👋\n\nInvalid option. Please choose from the options below:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order', 'title': '🛒 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_assistant', 'title': '🤖 AI Assistant'}}, {'type': 'reply', 'reply': {'id': 'others', 'title': '⚙️ Others'}}]}}}
2025-06-12 17:01:43,662 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348026314159","wa_id":"2348026314159"}],"messages":[{"id":"wamid.HBgNMjM0ODAyNjMxNDE1ORUCABEYEjgxOTA1NjFCRTM5REVGRjc4MgA="}]}
2025-06-12 17:01:43,665 - services.lead_tracker - INFO - Cart addition tracked for 2348026314159: ₦3,200.0 (1 items)
2025-06-12 17:01:43,666 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348026314159 - ₦3,200.00
2025-06-12 17:01:43,666 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348026314159', 'wa_id': '2348026314159'}], 'messages': [{'id': 'wamid.HBgNMjM0ODAyNjMxNDE1ORUCABEYEjgxOTA1NjFCRTM5REVGRjc4MgA='}]}
2025-06-12 17:01:43,666 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:01:43] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:01:44,594 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:01:44] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:01:45,211 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:01:45] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:02:06,234 - handlers.webhook_handler - INFO - Processing message from 2348026314159 (User: Daniel Israel): {'type': 'text', 'text': 'other_actions'}
2025-06-12 17:02:06,238 - handlers.base_handler - INFO - GreetingHandler: Handling message 'other_actions' in greeting state for session 2348026314159.
2025-06-12 17:02:06,238 - handlers.base_handler - WARNING - Session 2348026314159: Invalid option 'other_actions' in greeting state.
2025-06-12 17:02:06,238 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348026314159', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Daniel Israel! 👋\n\nInvalid option. Please choose from the options below:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order', 'title': '🛒 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_assistant', 'title': '🤖 AI Assistant'}}, {'type': 'reply', 'reply': {'id': 'others', 'title': '⚙️ Others'}}]}}}
2025-06-12 17:02:07,067 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348026314159","wa_id":"2348026314159"}],"messages":[{"id":"wamid.HBgNMjM0ODAyNjMxNDE1ORUCABEYEjUwODRGRENDRjRCQThDNzUxNQA="}]}
2025-06-12 17:02:07,071 - services.lead_tracker - INFO - Cart addition tracked for 2348026314159: ₦3,200.0 (1 items)
2025-06-12 17:02:07,071 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348026314159 - ₦3,200.00
2025-06-12 17:02:07,071 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348026314159', 'wa_id': '2348026314159'}], 'messages': [{'id': 'wamid.HBgNMjM0ODAyNjMxNDE1ORUCABEYEjUwODRGRENDRjRCQThDNzUxNQA='}]}
2025-06-12 17:02:07,072 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:02:07] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:02:08,447 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:02:08] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:02:08,837 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:02:08] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:21:52,334 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-12 17:21:52,334 - utils.session_manager - INFO - Session 2348055614455 timed out after 4861.81 seconds (timeout limit: 600s). Resetting.
2025-06-12 17:21:52,336 - handlers.base_handler - INFO - Session 2348055614455 initialized with greeting state for user 'Ziga'.
2025-06-12 17:21:52,337 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Ziga! 👋\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order', 'title': '🛒 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_assistant', 'title': '🤖 AI Assistant'}}, {'type': 'reply', 'reply': {'id': 'others', 'title': '⚙️ Others'}}]}}}
2025-06-12 17:21:53,606 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkVCNENGOTBENzQxMjI0OTkyNQA="}]}
2025-06-12 17:21:53,606 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkVCNENGOTBENzQxMjI0OTkyNQA='}]}
2025-06-12 17:21:53,607 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:21:53] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:21:54,429 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:21:54] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:21:55,112 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:21:55] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:21:56,970 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_assistant'}
2025-06-12 17:21:56,972 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_assistant' in greeting state for session 2348055614455.
2025-06-12 17:21:56,973 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI menu.
2025-06-12 17:21:56,973 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'initial_entry'.
2025-06-12 17:21:56,974 - handlers.base_handler - INFO - AIHandler: Handling message 'initial_entry' in AI menu state for session 2348055614455. Original: 'ai_assistant'
2025-06-12 17:21:56,974 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🤖 *AI Assistant Options*\n\n🤖 *Lola Chatbot* - Chat with our AI assistant\n🛒 *AI Bulk Order* - Order multiple items at once\n\nPlease select an AI option:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'lola_chatbot', 'title': '🤖 Lola Chatbot'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order', 'title': '🛒 AI Bulk Order'}}, {'type': 'reply', 'reply': {'id': 'back_to_main', 'title': '🔙 Back to Main'}}]}}}
2025-06-12 17:21:57,692 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjc4QjcxNzEwNTU3N0NGN0E5NQA="}]}
2025-06-12 17:21:57,693 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjc4QjcxNzEwNTU3N0NGN0E5NQA='}]}
2025-06-12 17:21:57,694 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:21:57] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:21:58,592 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:21:58] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:21:58,886 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:21:58] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:21:59,098 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:21:59] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:22:00,036 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order'}
2025-06-12 17:22:00,039 - handlers.base_handler - INFO - AIHandler: Handling message 'ai_bulk_order' in AI menu state for session 2348055614455. Original: 'ai_bulk_order'
2025-06-12 17:22:00,039 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': '🛒 *AI Bulk Order Assistant*\n\nTell me everything you want to order in one message! For example:\n\n_"2 chief burgers with drinks, 3 jollof rice with chicken, large fries and 4 cokes"_\n\nI\'ll understand your order and help you confirm it! 🚀\n\n_Type \'menu\' to go back to the main menu_'}}
2025-06-12 17:22:00,911 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjg0MTcxOENGRjAwMzk3OEEzOAA="}]}
2025-06-12 17:22:00,911 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjg0MTcxOENGRjAwMzk3OEEzOAA='}]}
2025-06-12 17:22:00,912 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:22:00] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:22:02,012 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:22:02] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:22:02,248 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:22:02] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:22:02,274 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:22:02] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:22:10,945 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': '3 jellof rice'}
2025-06-12 17:22:10,947 - handlers.base_handler - INFO - AIHandler: Handling message '3 jellof rice' in AI bulk order state for session 2348055614455. Original: '3 jellof rice'
2025-06-12 17:22:13,324 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-12 17:22:13,326 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🛒 *Order Summary:*\n\n✅ 3x Smoky Jollof Fiesta - ₦4,500\n\n*Total: ₦4,500.00*\n\nWould you like to proceed with this order?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'confirm_ai_order', 'title': '✅ Confirm Order'}}, {'type': 'reply', 'reply': {'id': 'modify_ai_order', 'title': '✏️ Modify Order'}}, {'type': 'reply', 'reply': {'id': 'cancel_ai_order', 'title': '❌ Cancel'}}]}}}
2025-06-12 17:22:14,094 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjBFNkRFNTRGODlFQTYzNjRCNQA="}]}
2025-06-12 17:22:14,095 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjBFNkRFNTRGODlFQTYzNjRCNQA='}]}
2025-06-12 17:22:14,095 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:22:14] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:22:14,826 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:22:14] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:22:15,529 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:22:15] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:22:17,603 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-06-12 17:22:17,605 - handlers.base_handler - INFO - AI order confirmed. Cart: {'Smoky Jollof Fiesta': {'item_id': 'Smoky Jollof Fiesta', 'quantity': 3, 'price': 1500, 'total_price': 4500, 'variations': {}}}. Redirecting to order handler.
2025-06-12 17:22:17,605 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'order_handler' with message 'process_final_order'.
2025-06-12 17:22:17,606 - handlers.order_handler - INFO - AI initiated order processing for session 2348055614455.
2025-06-12 17:22:17,606 - handlers.order_handler - INFO - Address set, proceeding to confirm order for AI-initiated session 2348055614455.
2025-06-12 17:22:17,607 - handlers.order_handler - INFO - Showing final order confirmation for session 2348055614455. Total: ₦4,500.00
2025-06-12 17:22:17,607 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🛒 *Final Order Confirmation*\n\n📋 *Items Ordered:*\n• 3x Smoky Jollof Fiesta - ₦4,500.00\n\n📍 *Delivery Details:*\n👤 Name: Ziga\n📱 Phone: 2348055614455\n🏠 Address: Howson Wright\n\n💰 *Total Amount: ₦4,500.00*\n\nPlease confirm to proceed with payment.'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'final_confirm', 'title': '✅ Confirm & Pay'}}, {'type': 'reply', 'reply': {'id': 'edit_order', 'title': '✏️ Edit Order'}}, {'type': 'reply', 'reply': {'id': 'cancel_order', 'title': '❌ Cancel Order'}}]}}}
2025-06-12 17:22:18,311 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjc4QzhFMEU1MDVEMjNERDZEMwA="}]}
2025-06-12 17:22:18,315 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦4,500 (1 items)
2025-06-12 17:22:18,315 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦4,500.00
2025-06-12 17:22:18,315 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjc4QzhFMEU1MDVEMjNERDZEMwA='}]}
2025-06-12 17:22:18,316 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:22:18] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:22:19,394 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:22:19] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:22:19,514 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:22:19] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:22:19,698 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:22:19] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:22:49,478 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'final_confirm'}
2025-06-12 17:22:49,481 - handlers.order_handler - INFO - Order ORDER_20250612_172249_d09ad0db confirmed for session 2348055614455. Amount: ₦4,500.00
2025-06-12 17:22:49,485 - services.lead_tracker - INFO - Order completion tracked for 2348055614455: ORDER_20250612_172249_d09ad0db (₦4,500)
2025-06-12 17:22:49,485 - handlers.lead_tracking_handler - INFO - 💰 Conversion tracked: 2348055614455 - ORDER_20250612_172249_d09ad0db (₦4,500)
2025-06-12 17:22:49,485 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'payment_handler' with message 'initiate_payment'.
2025-06-12 17:22:49,486 - handlers.base_handler - INFO - Handling payment processing for session 2348055614455, message: initiate_payment
2025-06-12 17:22:49,486 - handlers.base_handler - INFO - Creating payment link for session 2348055614455
2025-06-12 17:22:49,512 - utils.data_manager - INFO - Order details saved to data\orders.json
2025-06-12 17:22:49,514 - services.payment_service - INFO - Attempting to create payment link for reference: PAY-ORDER-20250612172249-9831 with amount: 450000, email: ziga4455@foodorder.com
2025-06-12 17:22:50,557 - services.payment_service - INFO - Payment link created for Ziga Ziga (2348055614455), URL: https://checkout.paystack.com/1qq4osleg9cnjpt
2025-06-12 17:22:50,558 - handlers.base_handler - INFO - Starting payment monitoring for order ORDER-20250612172249-9831, reference PAY-ORDER-20250612172249-9831
2025-06-12 17:22:50,559 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-ORDER-20250612172249-9831
2025-06-12 17:22:51,829 - services.payment_service - WARNING - Payment not successful for reference PAY-ORDER-20250612172249-9831. Paystack status: abandoned. Response: {'status': True, 'message': 'Verification successful', 'data': {'id': 5051296252, 'domain': 'test', 'status': 'abandoned', 'reference': 'PAY-ORDER-20250612172249-9831', 'receipt_number': None, 'amount': 450000, 'message': None, 'gateway_response': 'The transaction was not completed', 'paid_at': None, 'created_at': '2025-06-12T16:22:50.000Z', 'channel': 'card', 'currency': 'NGN', 'ip_address': '197.211.59.126, 172.68.192.233, 172.31.63.81', 'metadata': {'customer_name': 'Ziga', 'customer_phone': '2348055614455', 'first_name': 'Ziga', 'last_name': 'Ziga', 'order_id': 'ORDER-20250612172249-9831', 'delivery_address': 'Howson Wright'}, 'log': None, 'fees': None, 'fees_split': None, 'authorization': {}, 'customer': {'id': 276711440, 'first_name': None, 'last_name': None, 'email': 'ziga4455@foodorder.com', 'customer_code': 'CUS_bhkdpnbvcjqt55g', 'phone': None, 'metadata': None, 'risk_action': 'default', 'international_format_phone': None}, 'plan': None, 'split': {}, 'order_id': None, 'paidAt': None, 'createdAt': '2025-06-12T16:22:50.000Z', 'requested_amount': 450000, 'pos_transaction_data': None, 'source': None, 'fees_breakdown': None, 'connect': None, 'transaction_date': '2025-06-12T16:22:50.000Z', 'plan_object': {}, 'subaccount': {}}}
2025-06-12 17:22:51,830 - handlers.base_handler - INFO - Payment not yet verified for order ORDER-20250612172249-9831, attempt 1/15
2025-06-12 17:22:51,832 - handlers.base_handler - INFO - Payment link created successfully for order ORDER-20250612172249-9831
2025-06-12 17:22:51,832 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "🛒 *Order Created Successfully!*\n\n📋 *Order ID:* ORDER-20250612172249-9831\n💰 *Total:* ₦4,500\n\n💳 *Complete Payment:*\nhttps://checkout.paystack.com/1qq4osleg9cnjpt\n\n✅ We'll automatically confirm your order once payment is received!\n💬 You can also send 'paid' after payment to check status immediately.\n\n⏰ Payment link expires in 15 minutes."}}
2025-06-12 17:22:52,650 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjIxNjZCNjFFODM4NkExNTg2RQA="}]}
2025-06-12 17:22:52,653 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦4,500 (1 items)
2025-06-12 17:22:52,654 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦4,500.00
2025-06-12 17:22:52,654 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjIxNjZCNjFFODM4NkExNTg2RQA='}]}
2025-06-12 17:22:52,654 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:22:52] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:22:53,593 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:22:53] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:22:54,277 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:22:54] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:23:44,203 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Paid'}
2025-06-12 17:23:44,205 - handlers.base_handler - INFO - Received 'paid' command for session 2348055614455, attempting manual verification for ref: PAY-ORDER-20250612172249-9831
2025-06-12 17:23:44,205 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-ORDER-20250612172249-9831
2025-06-12 17:23:44,881 - services.payment_service - INFO - Payment verified successfully for reference PAY-ORDER-20250612172249-9831. Status: success
2025-06-12 17:23:44,883 - handlers.base_handler - INFO - Manual payment verification successful for order ORDER-20250612172249-9831
2025-06-12 17:23:44,884 - handlers.base_handler - INFO - Payment monitoring stopped for session 2348055614455
2025-06-12 17:23:44,900 - utils.data_manager - INFO - Order details saved to data\orders.json
2025-06-12 17:23:44,902 - services.lead_tracker - INFO - Order completion tracked for 2348055614455: ORDER-20250612172249-9831 (₦4,500)
2025-06-12 17:23:44,903 - handlers.lead_tracking_handler - INFO - 💰 Conversion tracked: 2348055614455 - ORDER-20250612172249-9831 (₦4,500)
2025-06-12 17:23:44,903 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "🎉 *Payment Confirmed!*\n\n📋 *Order ID:* ORDER-20250612172249-9831\n💰 *Amount Paid:* ₦4,500\n🛒 *Items:* 🛒 *Your Cart:*\n• 3 x Smoky Jollof Fiesta (₦1,500) = ₦4,500\n\n💰 *Total: ₦4,500*\n🚚 *Delivery to:* Howson Wright\n\n✅ Your order is confirmed and being processed!\n📱 You'll receive delivery updates soon.\n\n🙏 Thank you for your purchase! 😊"}}
2025-06-12 17:23:45,890 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkE0QjVEQjdENDA3MUY4NjI5QgA="}]}
2025-06-12 17:23:45,891 - handlers.feedback_handler - INFO - Initiated feedback collection for order ORDER-20250612172249-9831, session 2348055614455
2025-06-12 17:23:45,892 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🎉 *Thank you for your order!*\n\n📋 Order ID: ORDER-20250612172249-9831\n\n💬 *How was your ordering experience?*\nYour feedback helps us improve our service!'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'excellent', 'title': '🤩 Excellent'}}, {'type': 'reply', 'reply': {'id': 'good', 'title': '😊 Good'}}, {'type': 'reply', 'reply': {'id': 'bad', 'title': '😞 Bad'}}]}}}
2025-06-12 17:23:46,540 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjA2NTExQTkzMTVDMEREQzVFRgA="}]}
2025-06-12 17:23:46,542 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'message': 'Payment confirmed and feedback initiated'}
2025-06-12 17:23:46,543 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:23:46] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:23:46,783 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:23:46] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:23:47,233 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:23:47] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:23:47,532 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:23:47] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:23:47,896 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:23:47] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:24:52,011 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'excellent'}
2025-06-12 17:24:52,013 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "🤩 *Thank you for the excellent rating!*\n\n💬 Would you like to share any specific comments about your experience?\n\nType your message or 'skip' to finish."}}
2025-06-12 17:24:52,739 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjZEQjFBRDEyMTlBMkNBRjE0RgA="}]}
2025-06-12 17:24:52,739 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjZEQjFBRDEyMTlBMkNBRjE0RgA='}]}
2025-06-12 17:24:52,740 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:24:52] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:24:53,790 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:24:53] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:24:54,270 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:24:54] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:39:41,934 - handlers.webhook_handler - INFO - Processing message from 2348026820400 (User: ibrahimabubakarabubakar20): {'type': 'text', 'text': 'Aslm'}
2025-06-12 17:39:41,935 - utils.session_manager - INFO - New session 2348026820400 initialized.
2025-06-12 17:39:41,937 - services.lead_tracker - INFO - New lead tracked: 2348026820400 (ibrahimabubakarabubakar20)
2025-06-12 17:39:41,938 - handlers.lead_tracking_handler - INFO - 🆕 New lead detected: 2348026820400 (ibrahimabubakarabubakar20)
2025-06-12 17:39:41,940 - handlers.base_handler - INFO - Session 2348026820400 initialized with greeting state for user 'ibrahimabubakarabubakar20'.
2025-06-12 17:39:41,940 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348026820400', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello ibrahimabubakarabubakar20! 👋\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order', 'title': '🛒 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_assistant', 'title': '🤖 AI Assistant'}}, {'type': 'reply', 'reply': {'id': 'others', 'title': '⚙️ Others'}}]}}}
2025-06-12 17:39:43,055 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348026820400","wa_id":"2348026820400"}],"messages":[{"id":"wamid.HBgNMjM0ODAyNjgyMDQwMBUCABEYEjcwOTY2MkI4ODhCMDI0MkQ1NAA="}]}
2025-06-12 17:39:43,056 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348026820400', 'wa_id': '2348026820400'}], 'messages': [{'id': 'wamid.HBgNMjM0ODAyNjgyMDQwMBUCABEYEjcwOTY2MkI4ODhCMDI0MkQ1NAA='}]}
2025-06-12 17:39:43,056 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:39:43] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:39:46,406 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:39:46] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:45:58,349 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-12 17:45:58,349 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-12 17:45:58,350 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-12 17:45:58,350 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-12 17:45:58,351 - services.payment_service - INFO - PaymentService initialized
2025-06-12 17:45:58,351 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-12 17:45:58,351 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-12 17:45:58,352 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-12 17:45:58,352 - services.payment_service - INFO - PaymentService initialized
2025-06-12 17:45:58,352 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-12 17:45:58,353 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-12 17:45:58,354 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-12 17:45:58,354 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-12 17:45:58,354 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-12 17:45:58,354 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-12 17:45:58,721 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-12 17:45:58,722 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-12 17:45:58,722 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-12 17:45:58,722 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-12 17:45:58,759 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-12 17:45:58,759 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-12 17:46:08,271 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-12 17:46:08,272 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-12 17:46:08,276 - handlers.base_handler - INFO - Session 2348055614455 initialized with greeting state for user 'Ziga'.
2025-06-12 17:46:08,276 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Ziga! How can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': 'Order off the menu🍔'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': 'Let Lola take your order! 👩🏼\u200d🍳'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': 'Enquiry or Complaint? '}}]}}}
2025-06-12 17:46:09,100 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 400 Client Error: Bad Request for url: https://graph.facebook.com/v17.0/608867502309431/messages - {"error":{"message":"(#131009) Parameter value is not valid","type":"OAuthException","code":131009,"error_data":{"messaging_product":"whatsapp","details":"Button title length invalid. Min length: 1, Max length: 20"},"fbtrace_id":"AlHyDS173RRSZs056ijSUF6"}}
2025-06-12 17:46:09,100 - handlers.message_processor - WARNING - No specific handler or state match for handler 'greeting_handler', state 'start', message 'hello' for session 2348055614455. Resetting to greeting.
2025-06-12 17:46:09,101 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "I'm sorry, I didn't quite understand that. Let's get back to the main menu."}}
2025-06-12 17:46:09,849 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjVEMENEQTlCMzE1RUFBOTZBNQA="}]}
2025-06-12 17:46:09,850 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Ziga! Please choose from the options below:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': 'Order off the menu🍔'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': 'Let Lola take your order! 👩🏼\u200d🍳'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': 'Enquiry or Complaint? '}}]}}}
2025-06-12 17:46:10,406 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 400 Client Error: Bad Request for url: https://graph.facebook.com/v17.0/608867502309431/messages - {"error":{"message":"(#131009) Parameter value is not valid","type":"OAuthException","code":131009,"error_data":{"messaging_product":"whatsapp","details":"Button title length invalid. Min length: 1, Max length: 20"},"fbtrace_id":"AsHFKgPIoV6k25kJ1ANuFgQ"}}
2025-06-12 17:46:10,407 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:46:10] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:46:10,762 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:46:10] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:46:10,842 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:46:10] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:46:11,294 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:46:11] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:48:25,502 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-12 17:48:25,502 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-12 17:48:25,503 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-12 17:48:25,503 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-12 17:48:25,504 - services.payment_service - INFO - PaymentService initialized
2025-06-12 17:48:25,504 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-12 17:48:25,504 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-12 17:48:25,505 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-12 17:48:25,505 - services.payment_service - INFO - PaymentService initialized
2025-06-12 17:48:25,505 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-12 17:48:25,505 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-12 17:48:25,506 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-12 17:48:25,506 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-12 17:48:25,506 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-12 17:48:25,506 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-12 17:48:25,860 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-12 17:48:25,860 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-12 17:48:25,861 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-12 17:48:25,861 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-12 17:48:25,874 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-12 17:48:25,874 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-12 17:48:30,224 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-12 17:48:30,225 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-12 17:48:30,229 - handlers.base_handler - INFO - Session 2348055614455 initialized with greeting state for user 'Ziga'.
2025-06-12 17:48:30,230 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Ziga! How can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': 'Order off the menu🍔'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': 'Let Lola take your order! 👩🏼\u200d🍳'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': 'Others '}}]}}}
2025-06-12 17:48:30,853 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 400 Client Error: Bad Request for url: https://graph.facebook.com/v17.0/608867502309431/messages - {"error":{"message":"(#131009) Parameter value is not valid","type":"OAuthException","code":131009,"error_data":{"messaging_product":"whatsapp","details":"Button title length invalid. Min length: 1, Max length: 20"},"fbtrace_id":"Azu4HZsNHi2fy-lXghsdY6j"}}
2025-06-12 17:48:30,853 - handlers.message_processor - WARNING - No specific handler or state match for handler 'greeting_handler', state 'start', message 'hello' for session 2348055614455. Resetting to greeting.
2025-06-12 17:48:30,854 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "I'm sorry, I didn't quite understand that. Let's get back to the main menu."}}
2025-06-12 17:48:31,591 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjYzQUE1OUY5OTBCREJBNkQyRQA="}]}
2025-06-12 17:48:31,592 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Ziga! Please choose from the options below:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': 'Order off the menu🍔'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': 'Let Lola take your order! 👩🏼\u200d🍳'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': 'Others '}}]}}}
2025-06-12 17:48:32,115 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 400 Client Error: Bad Request for url: https://graph.facebook.com/v17.0/608867502309431/messages - {"error":{"message":"(#131009) Parameter value is not valid","type":"OAuthException","code":131009,"error_data":{"messaging_product":"whatsapp","details":"Button title length invalid. Min length: 1, Max length: 20"},"fbtrace_id":"A-JwihWtPuFN9oa5m6UdO4z"}}
2025-06-12 17:48:32,116 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:48:32] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:48:32,621 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:48:32] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:48:32,861 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:48:32] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:48:33,235 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:48:33] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:50:31,777 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-12 17:50:31,777 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-12 17:50:31,778 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-12 17:50:31,779 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-12 17:50:31,779 - services.payment_service - INFO - PaymentService initialized
2025-06-12 17:50:31,779 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-12 17:50:31,780 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-12 17:50:31,780 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-12 17:50:31,781 - services.payment_service - INFO - PaymentService initialized
2025-06-12 17:50:31,781 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-12 17:50:31,782 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-12 17:50:31,783 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-12 17:50:31,783 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-12 17:50:31,783 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-12 17:50:31,784 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-12 17:50:32,368 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-12 17:50:32,369 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-12 17:50:32,369 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-12 17:50:32,369 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-12 17:50:32,386 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-12 17:50:32,386 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-12 17:50:38,600 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-12 17:50:38,601 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-12 17:50:38,607 - handlers.base_handler - INFO - Session 2348055614455 initialized with greeting state for user 'Ziga'.
2025-06-12 17:50:38,607 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Ziga! 👋\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-12 17:50:39,545 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjhEQUIwQzczNjY0NzMxMjRCRgA="}]}
2025-06-12 17:50:39,546 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjhEQUIwQzczNjY0NzMxMjRCRgA='}]}
2025-06-12 17:50:39,546 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:50:39] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:50:40,207 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:50:40] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:50:40,566 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:50:40] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:50:41,225 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:50:41] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:50:42,342 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-12 17:50:42,344 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-06-12 17:50:42,344 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-06-12 17:50:42,345 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-06-12 17:50:42,345 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-06-12 17:50:42,346 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': '🛒 *AI Bulk Order Assistant*\n\nTell me everything you want to order in one message! For example:\n\n_"2 chief burgers with drinks, 3 jollof rice with chicken, large fries and 4 cokes"_\n\nI\'ll understand your order and help you confirm it! 🚀\n\n_Type \'menu\' to go back to the main menu_'}}
2025-06-12 17:50:43,080 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkZFRUEwNTc0OENGMEZCM0Y0MQA="}]}
2025-06-12 17:50:43,080 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkZFRUEwNTc0OENGMEZCM0Y0MQA='}]}
2025-06-12 17:50:43,081 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:50:43] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:50:43,879 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:50:43] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:50:44,060 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:50:44] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:50:44,636 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:50:44] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:56:13,005 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-12 17:56:13,006 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-12 17:56:13,007 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-12 17:56:13,007 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-12 17:56:13,007 - services.payment_service - INFO - PaymentService initialized
2025-06-12 17:56:13,008 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-12 17:56:13,008 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-12 17:56:13,009 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-12 17:56:13,009 - services.payment_service - INFO - PaymentService initialized
2025-06-12 17:56:13,009 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-12 17:56:13,010 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-12 17:56:13,010 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-12 17:56:13,011 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-12 17:56:13,011 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-12 17:56:13,011 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-12 17:56:13,426 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-12 17:56:13,427 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-12 17:56:13,427 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-12 17:56:13,427 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-12 17:56:13,439 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-12 17:56:13,440 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-12 17:56:17,895 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-12 17:56:17,895 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-12 17:56:17,899 - handlers.base_handler - INFO - Session 2348055614455 initialized with greeting state for user 'Ziga'.
2025-06-12 17:56:17,899 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Ziga! 👋\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-12 17:56:18,740 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjNEMUMyNkE4QTQxRTRFOTQwOQA="}]}
2025-06-12 17:56:18,741 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjNEMUMyNkE4QTQxRTRFOTQwOQA='}]}
2025-06-12 17:56:18,742 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:56:18] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:56:19,464 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:56:19] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:56:19,740 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:56:19] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:56:20,128 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:56:20] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:56:24,579 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-12 17:56:24,581 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-06-12 17:56:24,582 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-06-12 17:56:24,582 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-06-12 17:56:24,582 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-06-12 17:56:24,583 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Just send me your full order in one message! \n\nLike this: 'Two plates of jollof rice, 2 Cokes, and asun.'\n\nWant to go back again? Type ‘menu’ to return. "}}
2025-06-12 17:56:25,404 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjJCNzNCNTVDNUQwQTI2N0Y2NAA="}]}
2025-06-12 17:56:25,404 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjJCNzNCNTVDNUQwQTI2N0Y2NAA='}]}
2025-06-12 17:56:25,405 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:56:25] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:56:26,351 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:56:26] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:56:26,369 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:56:26] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:56:26,902 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:56:26] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:56:42,378 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': '2 jellof rice, 2 cokes'}
2025-06-12 17:56:42,380 - handlers.base_handler - INFO - AIHandler: Handling message '2 jellof rice, 2 cokes' in AI bulk order state for session 2348055614455. Original: '2 jellof rice, 2 cokes'
2025-06-12 17:56:46,163 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-12 17:56:46,166 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🛒 *Order Summary:*\n\n✅ 2x Fried Rice Fiesta - ₦2,800\n✅ 2x Coca-Cola (50cl) - ₦500\n\n*Total: ₦3,300.00*\n\nWould you like to proceed with this order?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'confirm_ai_order', 'title': '✅ Confirm Order'}}, {'type': 'reply', 'reply': {'id': 'modify_ai_order', 'title': '✏️ Modify Order'}}, {'type': 'reply', 'reply': {'id': 'cancel_ai_order', 'title': '❌ Cancel'}}]}}}
2025-06-12 17:56:46,969 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjM4MDhCRDZDMjNFNDU3NDk4NQA="}]}
2025-06-12 17:56:46,970 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjM4MDhCRDZDMjNFNDU3NDk4NQA='}]}
2025-06-12 17:56:46,970 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:56:46] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:56:47,628 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:56:47] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:56:47,860 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:56:47] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:56:48,247 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:56:48] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:56:50,530 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-06-12 17:56:50,532 - handlers.base_handler - INFO - AI order confirmed. Cart: {'Fried Rice Fiesta': {'item_id': 'Fried Rice Fiesta', 'quantity': 2, 'price': 1400, 'total_price': 2800, 'variations': {}}, 'Coca-Cola (50cl)': {'item_id': 'Coca-Cola (50cl)', 'quantity': 2, 'price': 250, 'total_price': 500, 'variations': {}}}. Redirecting to order handler.
2025-06-12 17:56:50,532 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'order_handler' with message 'process_final_order'.
2025-06-12 17:56:50,533 - handlers.message_processor - ERROR - Error in message routing for handler 'order_handler', state 'confirm_details' for session 2348055614455: 'OrderHandler' object has no attribute 'handle_confirm_details_state'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\app\handlers\message_processor.py", line 225, in _route_to_handler
    response = self.order_handler.handle_confirm_details_state(state, message, session_id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'OrderHandler' object has no attribute 'handle_confirm_details_state'. Did you mean: 'handle_confirm_order_state'?
2025-06-12 17:56:50,536 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "⚠️ Something went wrong. Let's start fresh. Please try again."}}
2025-06-12 17:56:51,269 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQ0NDlBOEY3RkIwNzg1MzNCMgA="}]}
2025-06-12 17:56:51,272 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦3,300 (2 items)
2025-06-12 17:56:51,273 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦3,300.00
2025-06-12 17:56:51,273 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQ0NDlBOEY3RkIwNzg1MzNCMgA='}]}
2025-06-12 17:56:51,273 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:56:51] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:56:51,958 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:56:51] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:56:52,431 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:56:52] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:56:52,961 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:56:52] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:57:51,827 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-12 17:57:51,827 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-12 17:57:51,827 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-12 17:57:51,828 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-12 17:57:51,828 - services.payment_service - INFO - PaymentService initialized
2025-06-12 17:57:51,828 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-12 17:57:51,829 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-12 17:57:51,829 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-12 17:57:51,829 - services.payment_service - INFO - PaymentService initialized
2025-06-12 17:57:51,830 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-12 17:57:51,830 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-12 17:57:51,830 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-12 17:57:51,831 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-12 17:57:51,831 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-12 17:57:51,831 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-12 17:57:52,186 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-12 17:57:52,186 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-12 17:57:52,186 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-12 17:57:52,187 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-12 17:57:52,200 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-12 17:57:52,200 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-12 17:57:57,514 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-12 17:57:57,514 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-12 17:57:57,518 - handlers.base_handler - INFO - Session 2348055614455 initialized with greeting state for user 'Ziga'.
2025-06-12 17:57:57,519 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Ziga! 👋\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-12 17:57:58,264 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjFEMjNBQzk4QTQ0OEExNUQ4NgA="}]}
2025-06-12 17:57:58,265 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjFEMjNBQzk4QTQ0OEExNUQ4NgA='}]}
2025-06-12 17:57:58,266 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:57:58] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:57:59,222 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:57:59] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:57:59,373 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:57:59] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:57:59,776 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:57:59] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:58:00,770 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-12 17:58:00,772 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-06-12 17:58:00,773 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-06-12 17:58:00,773 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-06-12 17:58:00,773 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-06-12 17:58:00,774 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Just send me your full order in one message! \n\nLike this: 'Two plates of jollof rice, 2 Cokes, and asun.'\n\nWant to go back again? Type ‘menu’ to return. "}}
2025-06-12 17:58:01,418 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjgyMTY2RUFFQzZGMjMyNDRFQgA="}]}
2025-06-12 17:58:01,419 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjgyMTY2RUFFQzZGMjMyNDRFQgA='}]}
2025-06-12 17:58:01,419 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:58:01] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:58:02,378 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:58:02] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:58:02,535 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:58:02] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:58:02,936 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:58:02] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:58:05,331 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Jellof rice'}
2025-06-12 17:58:05,333 - handlers.base_handler - INFO - AIHandler: Handling message 'jellof rice' in AI bulk order state for session 2348055614455. Original: 'Jellof rice'
2025-06-12 17:58:08,162 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-12 17:58:08,164 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🛒 *Order Summary:*\n\n✅ 1x Smoky Jollof Fiesta - ₦1,500\n\n*Total: ₦1,500.00*\n\nWould you like to proceed with this order?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'confirm_ai_order', 'title': '✅ Confirm Order'}}, {'type': 'reply', 'reply': {'id': 'modify_ai_order', 'title': '✏️ Modify Order'}}, {'type': 'reply', 'reply': {'id': 'cancel_ai_order', 'title': '❌ Cancel'}}]}}}
2025-06-12 17:58:08,850 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjEyNzM2MTAxNDZCRjBGN0Q1NwA="}]}
2025-06-12 17:58:08,850 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjEyNzM2MTAxNDZCRjBGN0Q1NwA='}]}
2025-06-12 17:58:08,851 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:58:08] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:58:09,573 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:58:09] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:58:10,056 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:58:10] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:58:10,399 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:58:10] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:58:11,474 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-06-12 17:58:11,476 - handlers.base_handler - INFO - AI order confirmed. Cart: {'Smoky Jollof Fiesta': {'item_id': 'Smoky Jollof Fiesta', 'quantity': 1, 'price': 1500, 'total_price': 1500, 'variations': {}}}. Redirecting to order handler.
2025-06-12 17:58:11,476 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'order_handler' with message 'process_final_order'.
2025-06-12 17:58:11,476 - handlers.message_processor - ERROR - Error in message routing for handler 'order_handler', state 'confirm_details' for session 2348055614455: 'OrderHandler' object has no attribute 'handle_confirm_details_state'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\app\handlers\message_processor.py", line 225, in _route_to_handler
    response = self.order_handler.handle_confirm_details_state(state, message, session_id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'OrderHandler' object has no attribute 'handle_confirm_details_state'. Did you mean: 'handle_confirm_and_pay_state'?
2025-06-12 17:58:11,478 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "⚠️ Something went wrong. Let's start fresh. Please try again."}}
2025-06-12 17:58:12,225 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkQxREREQ0E3MjJGMzk3MjlENQA="}]}
2025-06-12 17:58:12,228 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦1,500 (1 items)
2025-06-12 17:58:12,228 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦1,500.00
2025-06-12 17:58:12,228 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkQxREREQ0E3MjJGMzk3MjlENQA='}]}
2025-06-12 17:58:12,229 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:58:12] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:58:12,954 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:58:12] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:58:13,180 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:58:13] "POST /webhook HTTP/1.1" 200 -
2025-06-12 17:58:13,657 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 17:58:13] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:00:43,041 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-12 18:00:43,041 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-12 18:00:43,042 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-12 18:00:43,042 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-12 18:00:43,042 - services.payment_service - INFO - PaymentService initialized
2025-06-12 18:00:43,043 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-12 18:00:43,043 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-12 18:00:43,044 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-12 18:00:43,044 - services.payment_service - INFO - PaymentService initialized
2025-06-12 18:00:43,044 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-12 18:00:43,045 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-12 18:00:43,046 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-12 18:00:43,046 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-12 18:00:43,046 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-12 18:00:43,046 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-12 18:00:43,411 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-12 18:00:43,412 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-12 18:00:43,412 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-12 18:00:43,412 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-12 18:00:43,425 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-12 18:00:43,426 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-12 18:00:49,964 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-12 18:00:49,964 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-12 18:00:49,968 - handlers.base_handler - INFO - Session 2348055614455 initialized with greeting state for user 'Ziga'.
2025-06-12 18:00:49,969 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Ziga! 👋\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-12 18:00:50,780 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjM0MkExQTY2QTUyQjkwRDYxQwA="}]}
2025-06-12 18:00:50,781 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjM0MkExQTY2QTUyQjkwRDYxQwA='}]}
2025-06-12 18:00:50,781 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:00:50] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:00:51,461 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:00:51] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:00:51,899 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:00:51] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:00:52,275 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:00:52] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:00:53,419 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-12 18:00:53,421 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-06-12 18:00:53,421 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-06-12 18:00:53,422 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-06-12 18:00:53,422 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-06-12 18:00:53,422 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Just send me your full order in one message! \n\nLike this: 'Two plates of jollof rice, 2 Cokes, and asun.'\n\nWant to go back again? Type ‘menu’ to return. "}}
2025-06-12 18:00:54,310 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQ0OEIwNEI2MDA3NDA3NDkxNAA="}]}
2025-06-12 18:00:54,310 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQ0OEIwNEI2MDA3NDA3NDkxNAA='}]}
2025-06-12 18:00:54,311 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:00:54] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:00:55,095 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:00:55] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:00:55,770 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:00:55] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:00:55,940 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:00:55] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:00:59,995 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Jellof rice'}
2025-06-12 18:00:59,998 - handlers.base_handler - INFO - AIHandler: Handling message 'jellof rice' in AI bulk order state for session 2348055614455. Original: 'Jellof rice'
2025-06-12 18:01:02,586 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-12 18:01:02,588 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🛒 *Order Summary:*\n\n✅ 1x Smoky Jollof Fiesta - ₦1,500\n\n*Total: ₦1,500.00*\n\nWould you like to proceed with this order?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'confirm_ai_order', 'title': '✅ Confirm Order'}}, {'type': 'reply', 'reply': {'id': 'modify_ai_order', 'title': '✏️ Modify Order'}}, {'type': 'reply', 'reply': {'id': 'cancel_ai_order', 'title': '❌ Cancel'}}]}}}
2025-06-12 18:01:03,308 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjNEQTJFNzc2RUM4RjlBNEVBMwA="}]}
2025-06-12 18:01:03,309 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjNEQTJFNzc2RUM4RjlBNEVBMwA='}]}
2025-06-12 18:01:03,309 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:01:03] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:01:04,348 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:01:04] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:01:04,480 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:01:04] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:01:04,816 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:01:04] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:01:05,936 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-06-12 18:01:05,938 - handlers.base_handler - INFO - AI order confirmed. Cart: {'Smoky Jollof Fiesta': {'item_id': 'Smoky Jollof Fiesta', 'quantity': 1, 'price': 1500, 'total_price': 1500, 'variations': {}}}. Redirecting to order handler.
2025-06-12 18:01:05,939 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'order_handler' with message 'process_final_order'.
2025-06-12 18:01:05,939 - handlers.order_handler - INFO - AI initiated order processing for session 2348055614455.
2025-06-12 18:01:05,940 - handlers.order_handler - INFO - Showing combined confirmation for session 2348055614455. Total: ₦1,500.00
2025-06-12 18:01:05,940 - services.whatsapp_service - ERROR - Invalid buttons format or too many buttons: [{'type': 'reply', 'reply': {'id': 'confirm_and_pay', 'title': '✅ Confirm & Pay'}}, {'type': 'reply', 'reply': {'id': 'edit_details', 'title': '✏️ Edit Details'}}, {'type': 'reply', 'reply': {'id': 'edit_order', 'title': '🛒 Edit Order'}}, {'type': 'reply', 'reply': {'id': 'cancel_order', 'title': '❌ Cancel'}}]
2025-06-12 18:01:05,940 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': '🛒 *ORDER CONFIRMATION & PAYMENT*\n\n📋 *Items Ordered:*\n• 1x Smoky Jollof Fiesta - ₦1,500.00\n\n📍 *Delivery Details:*\n👤 Name: Ziga\n📱 Phone: 2348055614455\n🏠 Address: Howson Wright\n\n💰 *Total Amount: ₦1,500.00*\n\nPlease review your order and delivery details, then confirm to proceed with payment.'}}
2025-06-12 18:01:06,639 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjYyQzhFMkI3MUFFMDY3MzlBMwA="}]}
2025-06-12 18:01:06,642 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦1,500 (1 items)
2025-06-12 18:01:06,643 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦1,500.00
2025-06-12 18:01:06,643 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjYyQzhFMkI3MUFFMDY3MzlBMwA='}]}
2025-06-12 18:01:06,643 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:01:06] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:01:07,468 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:01:07] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:01:07,726 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:01:07] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:01:08,101 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:01:08] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:08:27,353 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-12 18:08:27,354 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-12 18:08:27,354 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-12 18:08:27,355 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-12 18:08:27,355 - services.payment_service - INFO - PaymentService initialized
2025-06-12 18:08:27,355 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-12 18:08:27,356 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-12 18:08:27,356 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-12 18:08:27,357 - services.payment_service - INFO - PaymentService initialized
2025-06-12 18:08:27,357 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-12 18:08:27,357 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-12 18:08:27,358 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-12 18:08:27,358 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-12 18:08:27,358 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-12 18:08:27,358 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-12 18:08:27,796 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-12 18:08:27,797 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-12 18:08:27,797 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-12 18:08:27,798 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-12 18:08:27,815 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-12 18:08:27,816 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-12 18:08:35,715 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-12 18:08:35,716 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-12 18:08:35,720 - handlers.base_handler - INFO - Session 2348055614455 initialized with greeting state for user 'Ziga'.
2025-06-12 18:08:35,721 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Ziga! 👋\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-12 18:08:36,613 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkZGRTVEOEREODlGMkZGRjI4MgA="}]}
2025-06-12 18:08:36,614 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkZGRTVEOEREODlGMkZGRjI4MgA='}]}
2025-06-12 18:08:36,614 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:08:36] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:08:37,438 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:08:37] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:08:37,609 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:08:37] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:08:38,098 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:08:38] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:08:39,869 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-12 18:08:39,874 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-06-12 18:08:39,875 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-06-12 18:08:39,876 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-06-12 18:08:39,876 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-06-12 18:08:39,876 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Just send me your full order in one message! \n\nLike this: 'Two plates of jollof rice, 2 Cokes, and asun.'\n\nWant to go back again? Type ‘menu’ to return. "}}
2025-06-12 18:08:40,666 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjE3M0Q2QTA1RkVFNzc5QUYxNQA="}]}
2025-06-12 18:08:40,667 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjE3M0Q2QTA1RkVFNzc5QUYxNQA='}]}
2025-06-12 18:08:40,667 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:08:40] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:08:41,427 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:08:41] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:08:41,644 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:08:41] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:08:42,063 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:08:42] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:08:45,216 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Jellof rice'}
2025-06-12 18:08:45,218 - handlers.base_handler - INFO - AIHandler: Handling message 'jellof rice' in AI bulk order state for session 2348055614455. Original: 'Jellof rice'
2025-06-12 18:08:47,878 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-12 18:08:47,880 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🛒 *Order Summary:*\n\n✅ 1x Smoky Jollof Fiesta - ₦1,500\n\n*Total: ₦1,500.00*\n\nWould you like to proceed with this order?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'confirm_ai_order', 'title': '✅ Confirm Order'}}, {'type': 'reply', 'reply': {'id': 'modify_ai_order', 'title': '✏️ Modify Order'}}, {'type': 'reply', 'reply': {'id': 'cancel_ai_order', 'title': '❌ Cancel'}}]}}}
2025-06-12 18:08:48,760 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjNCNjQzRUE5QUNCOTg3NTA5NQA="}]}
2025-06-12 18:08:48,761 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjNCNjQzRUE5QUNCOTg3NTA5NQA='}]}
2025-06-12 18:08:48,761 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:08:48] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:08:49,483 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:08:49] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:08:49,986 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:08:49] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:08:50,304 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:08:50] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:08:51,983 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-06-12 18:08:51,986 - handlers.base_handler - INFO - AI order confirmed. Cart: {'Smoky Jollof Fiesta': {'item_id': 'Smoky Jollof Fiesta', 'quantity': 1, 'price': 1500, 'total_price': 1500, 'variations': {}}}. Redirecting to order handler.
2025-06-12 18:08:51,986 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'order_handler' with message 'process_final_order'.
2025-06-12 18:08:51,986 - handlers.order_handler - INFO - AI initiated order processing for session 2348055614455.
2025-06-12 18:08:51,987 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🛒 *ORDER SUMMARY*\n\n📋 *Items Ordered:*\n• 1x Smoky Jollof Fiesta - ₦1,500.00\n\n📍 *Delivery Details:*\n👤 Name: Ziga\n📱 Phone: 2348055614455\n🏠 Address: Howson Wright\n\n💰 *Total Amount: ₦1,500.00*\n\nPlease review your order and delivery details:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'confirm_order', 'title': '✅ Confirm Order'}}, {'type': 'reply', 'reply': {'id': 'modify_order', 'title': '✏️ Modify Order'}}, {'type': 'reply', 'reply': {'id': 'change_address', 'title': '📍 Change Address'}}]}}}
2025-06-12 18:08:52,687 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkQyRTlCRkM5MkQwRkVFM0U2NgA="}]}
2025-06-12 18:08:52,693 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦1,500 (1 items)
2025-06-12 18:08:52,693 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦1,500.00
2025-06-12 18:08:52,693 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkQyRTlCRkM5MkQwRkVFM0U2NgA='}]}
2025-06-12 18:08:52,694 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:08:52] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:08:53,365 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:08:53] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:08:53,685 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:08:53] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:08:54,493 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:08:54] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:14:23,077 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-12 18:14:23,077 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-12 18:14:23,078 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-12 18:14:23,079 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-12 18:14:23,079 - services.payment_service - INFO - PaymentService initialized
2025-06-12 18:14:23,079 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-12 18:14:23,079 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-12 18:14:23,080 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-12 18:14:23,080 - services.payment_service - INFO - PaymentService initialized
2025-06-12 18:14:23,081 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-12 18:14:23,081 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-12 18:14:23,081 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-12 18:14:23,082 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-12 18:14:23,082 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-12 18:14:23,082 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-12 18:14:23,547 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-12 18:14:23,548 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-12 18:14:23,548 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-12 18:14:23,548 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-12 18:14:23,563 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-12 18:14:23,564 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-12 18:14:28,328 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-12 18:14:28,328 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-12 18:14:28,332 - handlers.base_handler - INFO - Session 2348055614455 initialized with greeting state for user 'Ziga'.
2025-06-12 18:14:28,333 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Ziga! 👋\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-12 18:14:29,111 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjBEOEYzQTlDNTM2RkEwQjU5RgA="}]}
2025-06-12 18:14:29,112 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjBEOEYzQTlDNTM2RkEwQjU5RgA='}]}
2025-06-12 18:14:29,113 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:14:29] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:14:29,780 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:14:29] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:14:30,339 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:14:30] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:14:30,688 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:14:30] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:14:31,999 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-12 18:14:32,002 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-06-12 18:14:32,003 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-06-12 18:14:32,003 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-06-12 18:14:32,003 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-06-12 18:14:32,004 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Just send me your full order in one message! \n\nLike this: 'Two plates of jollof rice, 2 Cokes, and asun.'\n\nWant to go back again? Type ‘menu’ to return. "}}
2025-06-12 18:14:32,813 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkM4QUFBMEFGODk0RUZFNUQwQQA="}]}
2025-06-12 18:14:32,814 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkM4QUFBMEFGODk0RUZFNUQwQQA='}]}
2025-06-12 18:14:32,814 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:14:32] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:14:33,426 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:14:33] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:14:33,690 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:14:33] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:14:34,144 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:14:34] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:14:40,497 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Jellof rice'}
2025-06-12 18:14:40,499 - handlers.base_handler - INFO - AIHandler: Handling message 'jellof rice' in AI bulk order state for session 2348055614455. Original: 'Jellof rice'
2025-06-12 18:14:43,384 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-12 18:14:43,386 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🛒 *Order Summary:*\n\n✅ 1x Smoky Jollof Fiesta - ₦1,500\n\n*Total: ₦1,500.00*\n\nWould you like to proceed with this order?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'confirm_ai_order', 'title': '✅ Confirm Order'}}, {'type': 'reply', 'reply': {'id': 'modify_ai_order', 'title': '✏️ Modify Order'}}, {'type': 'reply', 'reply': {'id': 'cancel_ai_order', 'title': '❌ Cancel'}}]}}}
2025-06-12 18:14:44,136 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkM1QzhCRTQyQUI5Njg0MDNFNgA="}]}
2025-06-12 18:14:44,137 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkM1QzhCRTQyQUI5Njg0MDNFNgA='}]}
2025-06-12 18:14:44,138 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:14:44] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:14:44,988 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:14:44] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:14:45,264 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:14:45] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:14:45,553 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:14:45] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:14:46,557 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-06-12 18:14:46,560 - handlers.base_handler - INFO - AI order confirmed. Cart: {'Smoky Jollof Fiesta': {'item_id': 'Smoky Jollof Fiesta', 'quantity': 1, 'price': 1500, 'total_price': 1500, 'variations': {}}}. Redirecting to order handler.
2025-06-12 18:14:46,561 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'order_handler' with message 'process_final_order'.
2025-06-12 18:14:46,561 - handlers.message_processor - ERROR - Error in message routing for handler 'order_handler', state 'confirm_details' for session 2348055614455: 'OrderHandler' object has no attribute 'handle_ai_order_processing'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\app\handlers\message_processor.py", line 228, in _route_to_handler
    response = self.order_handler.handle_ai_order_processing(state, message, session_id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'OrderHandler' object has no attribute 'handle_ai_order_processing'
2025-06-12 18:14:46,565 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "⚠️ Something went wrong. Let's start fresh. Please try again."}}
2025-06-12 18:14:47,242 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQ3MDIzRkRGQzQyREEzMTY0RgA="}]}
2025-06-12 18:14:47,246 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦1,500 (1 items)
2025-06-12 18:14:47,246 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦1,500.00
2025-06-12 18:14:47,246 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQ3MDIzRkRGQzQyREEzMTY0RgA='}]}
2025-06-12 18:14:47,247 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:14:47] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:14:47,943 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:14:47] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:14:48,503 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:14:48] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:14:48,633 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:14:48] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:15:43,967 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-12 18:15:43,967 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-12 18:15:43,968 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-12 18:15:43,968 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-12 18:15:43,969 - services.payment_service - INFO - PaymentService initialized
2025-06-12 18:15:43,969 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-12 18:15:43,969 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-12 18:15:43,970 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-12 18:15:43,970 - services.payment_service - INFO - PaymentService initialized
2025-06-12 18:15:43,971 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-12 18:15:43,971 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-12 18:15:43,971 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-12 18:15:43,972 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-12 18:15:43,972 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-12 18:15:43,972 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-12 18:15:44,327 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-12 18:15:44,328 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-12 18:15:44,328 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-12 18:15:44,328 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-12 18:15:44,340 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-12 18:15:44,341 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-12 18:15:48,083 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-12 18:15:48,083 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-12 18:15:48,086 - handlers.webhook_handler - ERROR - Error processing webhook: 'str' object has no attribute 'get'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\app\handlers\webhook_handler.py", line 80, in handle_webhook
    response_payload = self.message_processor.process_message(message_data, phone_number, user_name)
  File "C:\Users\zigam\Documents\Lola\app\handlers\message_processor.py", line 93, in process_message
    message = message_data.get("text", {}).get("body")
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'get'
2025-06-12 18:15:48,089 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:15:48] "[35m[1mPOST /webhook HTTP/1.1[0m" 500 -
2025-06-12 18:15:48,858 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-12 18:15:48,860 - handlers.webhook_handler - ERROR - Error processing webhook: 'str' object has no attribute 'get'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\app\handlers\webhook_handler.py", line 80, in handle_webhook
    response_payload = self.message_processor.process_message(message_data, phone_number, user_name)
  File "C:\Users\zigam\Documents\Lola\app\handlers\message_processor.py", line 93, in process_message
    message = message_data.get("text", {}).get("body")
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'get'
2025-06-12 18:15:48,862 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:15:48] "[35m[1mPOST /webhook HTTP/1.1[0m" 500 -
2025-06-12 18:15:49,613 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-12 18:15:49,615 - handlers.webhook_handler - ERROR - Error processing webhook: 'str' object has no attribute 'get'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\app\handlers\webhook_handler.py", line 80, in handle_webhook
    response_payload = self.message_processor.process_message(message_data, phone_number, user_name)
  File "C:\Users\zigam\Documents\Lola\app\handlers\message_processor.py", line 93, in process_message
    message = message_data.get("text", {}).get("body")
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'get'
2025-06-12 18:15:49,617 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:15:49] "[35m[1mPOST /webhook HTTP/1.1[0m" 500 -
2025-06-12 18:15:51,883 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-12 18:15:51,885 - handlers.webhook_handler - ERROR - Error processing webhook: 'str' object has no attribute 'get'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\app\handlers\webhook_handler.py", line 80, in handle_webhook
    response_payload = self.message_processor.process_message(message_data, phone_number, user_name)
  File "C:\Users\zigam\Documents\Lola\app\handlers\message_processor.py", line 93, in process_message
    message = message_data.get("text", {}).get("body")
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'get'
2025-06-12 18:15:51,887 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:15:51] "[35m[1mPOST /webhook HTTP/1.1[0m" 500 -
2025-06-12 18:16:17,251 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-12 18:16:17,254 - handlers.webhook_handler - ERROR - Error processing webhook: 'str' object has no attribute 'get'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\app\handlers\webhook_handler.py", line 80, in handle_webhook
    response_payload = self.message_processor.process_message(message_data, phone_number, user_name)
  File "C:\Users\zigam\Documents\Lola\app\handlers\message_processor.py", line 93, in process_message
    else:
    
AttributeError: 'str' object has no attribute 'get'
2025-06-12 18:16:17,257 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:16:17] "[35m[1mPOST /webhook HTTP/1.1[0m" 500 -
2025-06-12 18:22:06,251 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-12 18:22:06,251 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-12 18:22:06,252 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-12 18:22:06,252 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-12 18:22:06,253 - services.payment_service - INFO - PaymentService initialized
2025-06-12 18:22:06,253 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-12 18:22:06,253 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-12 18:22:06,254 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-12 18:22:06,254 - services.payment_service - INFO - PaymentService initialized
2025-06-12 18:22:06,254 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-12 18:22:06,254 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-12 18:22:06,255 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-12 18:22:06,256 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-12 18:22:06,256 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-12 18:22:06,256 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-12 18:22:06,741 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-12 18:22:06,741 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-12 18:22:06,742 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-12 18:22:06,742 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-12 18:22:06,764 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-12 18:22:06,764 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-12 18:22:12,419 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-12 18:22:12,420 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-12 18:22:12,427 - handlers.base_handler - INFO - Session 2348055614455 initialized with greeting state for user 'Ziga'.
2025-06-12 18:22:12,429 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Ziga! 👋\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-12 18:22:13,895 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjhGRjI5QkZBQTJGQkQ1MzNCRAA="}]}
2025-06-12 18:22:13,896 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjhGRjI5QkZBQTJGQkQ1MzNCRAA='}]}
2025-06-12 18:22:13,898 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:22:13] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:22:14,746 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:22:14] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:22:14,943 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:22:14] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:22:15,254 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:22:15] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:22:16,371 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-12 18:22:16,374 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-06-12 18:22:16,374 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-06-12 18:22:16,375 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-06-12 18:22:16,375 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-06-12 18:22:16,375 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Just send me your full order in one message! \n\nLike this: 'Two plates of jollof rice, 2 Cokes, and asun.'\n\nWant to go back again? Type ‘menu’ to return. "}}
2025-06-12 18:22:17,027 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkY3QjE0MEU5QkE1NjVDRDcwMQA="}]}
2025-06-12 18:22:17,028 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkY3QjE0MEU5QkE1NjVDRDcwMQA='}]}
2025-06-12 18:22:17,028 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:22:17] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:22:18,063 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:22:18] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:22:18,200 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:22:18] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:22:18,733 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:22:18] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:22:23,078 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Jellof rice'}
2025-06-12 18:22:23,081 - handlers.base_handler - INFO - AIHandler: Handling message 'jellof rice' in AI bulk order state for session 2348055614455. Original: 'Jellof rice'
2025-06-12 18:22:26,036 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-12 18:22:26,046 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🛒 *Order Summary:*\n\n✅ 1x Smoky Jollof Fiesta - ₦1,500\n\n*Total: ₦1,500.00*\n\nWould you like to proceed with this order?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'confirm_ai_order', 'title': '✅ Confirm Order'}}, {'type': 'reply', 'reply': {'id': 'modify_ai_order', 'title': '✏️ Modify Order'}}, {'type': 'reply', 'reply': {'id': 'cancel_ai_order', 'title': '❌ Cancel'}}]}}}
2025-06-12 18:22:26,759 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkQ0QjM2Rjk5QTU2MTYzNzU0RAA="}]}
2025-06-12 18:22:26,760 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkQ0QjM2Rjk5QTU2MTYzNzU0RAA='}]}
2025-06-12 18:22:26,760 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:22:26] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:22:27,506 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:22:27] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:22:27,944 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:22:27] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:22:28,216 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:22:28] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:22:30,178 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-06-12 18:22:30,180 - handlers.base_handler - INFO - AI order confirmed. Cart: {'Smoky Jollof Fiesta': {'item_id': 'Smoky Jollof Fiesta', 'quantity': 1, 'price': 1500, 'total_price': 1500, 'variations': {}}}. Redirecting to order handler.
2025-06-12 18:22:30,181 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'order_handler' with message 'process_final_order'.
2025-06-12 18:22:30,181 - handlers.order_handler - INFO - AI initiated order processing for session 2348055614455.
2025-06-12 18:22:30,182 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🛒 *ORDER CONFIRMATION*\n\n📋 *Items Ordered:*\n• 1x Smoky Jollof Fiesta - ₦1,500.00\n\n📍 *Delivery Details:*\n👤 Name: Ziga\n📱 Phone: 2348055614455\n🏠 Address: Howson Wright\n\n💰 *Total Amount: ₦1,500.00*\n\nPlease review your order and delivery details:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'confirm_order', 'title': '✅ Confirm Order'}}, {'type': 'reply', 'reply': {'id': 'modify_order', 'title': '✏️ Modify Order'}}, {'type': 'reply', 'reply': {'id': 'change_address', 'title': '📍 Change Address'}}]}}}
2025-06-12 18:22:30,822 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjUyOEE3RjRDRDdEMTE3QjJGMwA="}]}
2025-06-12 18:22:30,826 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦1,500 (1 items)
2025-06-12 18:22:30,827 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦1,500.00
2025-06-12 18:22:30,827 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjUyOEE3RjRDRDdEMTE3QjJGMwA='}]}
2025-06-12 18:22:30,827 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:22:30] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:22:31,716 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:22:31] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:22:32,089 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:22:32] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:22:32,338 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:22:32] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:23:18,572 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-12 18:23:18,574 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': 'Please use the buttons to confirm your order, modify it, or change your address.'}}
2025-06-12 18:23:19,486 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkYyOTJBOUFCQjUwRjM5MTM4MgA="}]}
2025-06-12 18:23:19,489 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦1,500 (1 items)
2025-06-12 18:23:19,489 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦1,500.00
2025-06-12 18:23:19,489 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkYyOTJBOUFCQjUwRjM5MTM4MgA='}]}
2025-06-12 18:23:19,490 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:23:19] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:23:20,241 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:23:20] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:23:20,485 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:23:20] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:23:21,118 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:23:21] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:25:11,554 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-12 18:25:11,555 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-12 18:25:11,555 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-12 18:25:11,556 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-12 18:25:11,556 - services.payment_service - INFO - PaymentService initialized
2025-06-12 18:25:11,557 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-12 18:25:11,557 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-12 18:25:11,558 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-12 18:25:11,558 - services.payment_service - INFO - PaymentService initialized
2025-06-12 18:25:11,559 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-12 18:25:11,559 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-12 18:25:11,560 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-12 18:25:11,561 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-12 18:25:11,561 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-12 18:25:11,561 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-12 18:25:12,100 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-12 18:25:12,100 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-12 18:25:12,100 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-12 18:25:12,101 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-12 18:25:12,121 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-12 18:25:12,121 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-12 18:25:16,927 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-12 18:25:16,928 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-12 18:25:16,932 - handlers.base_handler - INFO - Session 2348055614455 initialized with greeting state for user 'Ziga'.
2025-06-12 18:25:16,933 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Ziga! 👋\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-12 18:25:17,792 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkNCMUY3QTlBMzk1OTA1OTdENgA="}]}
2025-06-12 18:25:17,792 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkNCMUY3QTlBMzk1OTA1OTdENgA='}]}
2025-06-12 18:25:17,793 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:25:17] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:25:18,417 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:25:18] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:25:18,897 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:25:18] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:25:19,321 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:25:19] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:25:20,257 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'order_menu_categories'}
2025-06-12 18:25:20,259 - handlers.base_handler - INFO - GreetingHandler: Handling message 'order_menu_categories' in greeting state for session 2348055614455.
2025-06-12 18:25:20,259 - handlers.base_handler - INFO - Session 2348055614455 redirecting to menu_handler for classic menu.
2025-06-12 18:25:20,260 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'menu_handler' with message 'show_menu'.
2025-06-12 18:25:20,260 - handlers.base_handler - INFO - MenuHandler: Received message 'show_menu' (original: 'order_menu_categories') in menu state for session 2348055614455
2025-06-12 18:25:20,260 - handlers.base_handler - INFO - Showing menu categories for session 2348055614455
2025-06-12 18:25:20,261 - handlers.base_handler - INFO - Available categories: ['Main Dishes', 'Soups & Stews', 'Sides', 'Snacks', 'Drinks', 'Desserts', 'Specialties']
2025-06-12 18:25:20,261 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'list', 'body': {'text': '🍽️ *Our Menu*\n\nChoose a category to browse items:'}, 'action': {'button': 'Categories', 'sections': [{'title': 'Menu Categories', 'rows': [{'id': 'main dishes', 'title': 'Main Dishes'}, {'id': 'soups & stews', 'title': 'Soups & Stews'}, {'id': 'sides', 'title': 'Sides'}, {'id': 'snacks', 'title': 'Snacks'}, {'id': 'drinks', 'title': 'Drinks'}, {'id': 'desserts', 'title': 'Desserts'}, {'id': 'specialties', 'title': 'Specialties'}]}]}}}
2025-06-12 18:25:21,068 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQxMTdCRUZBMEEwMzk1N0M4RQA="}]}
2025-06-12 18:25:21,069 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQxMTdCRUZBMEEwMzk1N0M4RQA='}]}
2025-06-12 18:25:21,069 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:25:21] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:25:21,878 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:25:21] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:25:22,286 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:25:22] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:25:22,553 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:25:22] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:25:43,181 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'Hello'}
2025-06-12 18:25:43,181 - utils.session_manager - INFO - New session 2347082345056 initialized.
2025-06-12 18:25:43,190 - handlers.base_handler - INFO - Session 2347082345056 initialized with greeting state for user 'Olumayowa Oyaleke'.
2025-06-12 18:25:43,191 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Olumayowa Oyaleke! 👋\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-12 18:25:44,160 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjE2RjI5N0Q0OEVEMUEzRTRBMgA="}]}
2025-06-12 18:25:44,161 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjE2RjI5N0Q0OEVEMUEzRTRBMgA='}]}
2025-06-12 18:25:44,161 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:25:44] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:25:44,796 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': 'Hi'}
2025-06-12 18:25:44,797 - utils.session_manager - INFO - New session 2349030918492 initialized.
2025-06-12 18:25:44,801 - handlers.base_handler - INFO - Session 2349030918492 initialized with greeting state for user 'Benny'.
2025-06-12 18:25:44,801 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Benny! 👋\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-12 18:25:44,947 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:25:44] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:25:45,527 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:25:45] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:25:45,611 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEkVEMzU5RkUzRDJBNERCQjE1MgA="}]}
2025-06-12 18:25:45,611 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEkVEMzU5RkUzRDJBNERCQjE1MgA='}]}
2025-06-12 18:25:45,612 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:25:45] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:25:45,676 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:25:45] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:25:46,363 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:25:46] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:25:46,930 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:25:46] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:25:49,862 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'order_menu_categories'}
2025-06-12 18:25:49,866 - handlers.base_handler - INFO - GreetingHandler: Handling message 'order_menu_categories' in greeting state for session 2347082345056.
2025-06-12 18:25:49,867 - handlers.base_handler - INFO - Session 2347082345056 redirecting to menu_handler for classic menu.
2025-06-12 18:25:49,867 - handlers.message_processor - INFO - Redirecting session 2347082345056 to handler 'menu_handler' with message 'show_menu'.
2025-06-12 18:25:49,868 - handlers.base_handler - INFO - MenuHandler: Received message 'show_menu' (original: 'order_menu_categories') in menu state for session 2347082345056
2025-06-12 18:25:49,869 - handlers.base_handler - INFO - Showing menu categories for session 2347082345056
2025-06-12 18:25:49,869 - handlers.base_handler - INFO - Available categories: ['Main Dishes', 'Soups & Stews', 'Sides', 'Snacks', 'Drinks', 'Desserts', 'Specialties']
2025-06-12 18:25:49,869 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'list', 'body': {'text': '🍽️ *Our Menu*\n\nChoose a category to browse items:'}, 'action': {'button': 'Categories', 'sections': [{'title': 'Menu Categories', 'rows': [{'id': 'main dishes', 'title': 'Main Dishes'}, {'id': 'soups & stews', 'title': 'Soups & Stews'}, {'id': 'sides', 'title': 'Sides'}, {'id': 'snacks', 'title': 'Snacks'}, {'id': 'drinks', 'title': 'Drinks'}, {'id': 'desserts', 'title': 'Desserts'}, {'id': 'specialties', 'title': 'Specialties'}]}]}}}
2025-06-12 18:25:51,186 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjk3OTkzQjdEOTdDNzhGOEZFMwA="}]}
2025-06-12 18:25:51,187 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjk3OTkzQjdEOTdDNzhGOEZFMwA='}]}
2025-06-12 18:25:51,187 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:25:51] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:25:51,923 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:25:51] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:25:52,196 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': 'order_menu_categories'}
2025-06-12 18:25:52,199 - handlers.base_handler - INFO - GreetingHandler: Handling message 'order_menu_categories' in greeting state for session 2349030918492.
2025-06-12 18:25:52,200 - handlers.base_handler - INFO - Session 2349030918492 redirecting to menu_handler for classic menu.
2025-06-12 18:25:52,201 - handlers.message_processor - INFO - Redirecting session 2349030918492 to handler 'menu_handler' with message 'show_menu'.
2025-06-12 18:25:52,201 - handlers.base_handler - INFO - MenuHandler: Received message 'show_menu' (original: 'order_menu_categories') in menu state for session 2349030918492
2025-06-12 18:25:52,202 - handlers.base_handler - INFO - Showing menu categories for session 2349030918492
2025-06-12 18:25:52,202 - handlers.base_handler - INFO - Available categories: ['Main Dishes', 'Soups & Stews', 'Sides', 'Snacks', 'Drinks', 'Desserts', 'Specialties']
2025-06-12 18:25:52,203 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'interactive', 'interactive': {'type': 'list', 'body': {'text': '🍽️ *Our Menu*\n\nChoose a category to browse items:'}, 'action': {'button': 'Categories', 'sections': [{'title': 'Menu Categories', 'rows': [{'id': 'main dishes', 'title': 'Main Dishes'}, {'id': 'soups & stews', 'title': 'Soups & Stews'}, {'id': 'sides', 'title': 'Sides'}, {'id': 'snacks', 'title': 'Snacks'}, {'id': 'drinks', 'title': 'Drinks'}, {'id': 'desserts', 'title': 'Desserts'}, {'id': 'specialties', 'title': 'Specialties'}]}]}}}
2025-06-12 18:25:52,462 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:25:52] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:25:52,464 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:25:52] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:25:52,895 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjUyQzUxOTYwMzc2QUJBNzgzRgA="}]}
2025-06-12 18:25:52,896 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjUyQzUxOTYwMzc2QUJBNzgzRgA='}]}
2025-06-12 18:25:52,896 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:25:52] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:25:53,552 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:25:53] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:25:53,794 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:25:53] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:25:57,458 - handlers.webhook_handler - INFO - List reply received: id='main dishes', title='Main Dishes'
2025-06-12 18:25:57,459 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'main dishes'}
2025-06-12 18:25:57,462 - handlers.base_handler - INFO - MenuHandler: Received message 'main dishes' (original: 'main dishes') in menu state for session 2347082345056
2025-06-12 18:25:57,463 - handlers.base_handler - INFO - Category 'Main Dishes' selected for session 2347082345056
2025-06-12 18:25:57,463 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'list', 'body': {'text': '🍽️ *Main Dishes*\n\nSelect an item to add to your cart:'}, 'action': {'button': 'Select Item', 'sections': [{'title': 'Main Dishes Items', 'rows': [{'id': 'Smoky Jollof Fiesta', 'title': 'Smoky Jollof Fi (₦1,500)'}, {'id': 'Egusi Pasta Primavera', 'title': 'Egusi Pasta Pri (₦1,800)'}, {'id': 'Grilled Tilapia with Herb Crust', 'title': 'Grilled Tilapia (₦2,000)'}, {'id': 'Pounded Yam with Vegetable Soup', 'title': 'Pounded Yam wit (₦1,700)'}, {'id': 'Fried Rice Fiesta', 'title': 'Fried Rice Fies (₦1,400)'}, {'id': 'Suya-Spiced Chicken Platter', 'title': 'Suya-Spiced Chi (₦1,600)'}, {'id': 'Banga Rice Delight', 'title': 'Banga Rice Deli (₦1,300)'}, {'id': 'Plantain Porridge with Fish', 'title': 'Plantain Porrid (₦1,500)'}, {'id': 'Amala with Gbegiri and Ewedu', 'title': 'Amala with Gbeg (₦1,600)'}, {'id': 'Spicy Beef Stir-Fry', 'title': 'Spicy Beef Stir (₦1,700)'}]}]}}}
2025-06-12 18:25:58,381 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkQ4Qjg1NzdFQTlEREI2RkUxMAA="}]}
2025-06-12 18:25:58,382 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkQ4Qjg1NzdFQTlEREI2RkUxMAA='}]}
2025-06-12 18:25:58,383 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:25:58] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:25:59,182 - handlers.webhook_handler - INFO - List reply received: id='main dishes', title='Main Dishes'
2025-06-12 18:25:59,183 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': 'main dishes'}
2025-06-12 18:25:59,187 - handlers.base_handler - INFO - MenuHandler: Received message 'main dishes' (original: 'main dishes') in menu state for session 2349030918492
2025-06-12 18:25:59,188 - handlers.base_handler - INFO - Category 'Main Dishes' selected for session 2349030918492
2025-06-12 18:25:59,189 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'interactive', 'interactive': {'type': 'list', 'body': {'text': '🍽️ *Main Dishes*\n\nSelect an item to add to your cart:'}, 'action': {'button': 'Select Item', 'sections': [{'title': 'Main Dishes Items', 'rows': [{'id': 'Smoky Jollof Fiesta', 'title': 'Smoky Jollof Fi (₦1,500)'}, {'id': 'Egusi Pasta Primavera', 'title': 'Egusi Pasta Pri (₦1,800)'}, {'id': 'Grilled Tilapia with Herb Crust', 'title': 'Grilled Tilapia (₦2,000)'}, {'id': 'Pounded Yam with Vegetable Soup', 'title': 'Pounded Yam wit (₦1,700)'}, {'id': 'Fried Rice Fiesta', 'title': 'Fried Rice Fies (₦1,400)'}, {'id': 'Suya-Spiced Chicken Platter', 'title': 'Suya-Spiced Chi (₦1,600)'}, {'id': 'Banga Rice Delight', 'title': 'Banga Rice Deli (₦1,300)'}, {'id': 'Plantain Porridge with Fish', 'title': 'Plantain Porrid (₦1,500)'}, {'id': 'Amala with Gbegiri and Ewedu', 'title': 'Amala with Gbeg (₦1,600)'}, {'id': 'Spicy Beef Stir-Fry', 'title': 'Spicy Beef Stir (₦1,700)'}]}]}}}
2025-06-12 18:25:59,328 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:25:59] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:25:59,647 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:25:59] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:25:59,803 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:25:59] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:25:59,895 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEkMwNzU5NEQwQkM0NDZDQ0Y3NQA="}]}
2025-06-12 18:25:59,895 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEkMwNzU5NEQwQkM0NDZDQ0Y3NQA='}]}
2025-06-12 18:25:59,896 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:25:59] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:26:00,724 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:26:00] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:26:00,868 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:26:00] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:26:03,100 - handlers.webhook_handler - INFO - List reply received: id='Pounded Yam with Vegetable Soup', title='Pounded Yam wit (₦1,700)'
2025-06-12 18:26:03,101 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'Pounded Yam with Vegetable Soup'}
2025-06-12 18:26:03,104 - handlers.base_handler - INFO - MenuHandler: Handling item selection 'Pounded Yam with Vegetable Soup' for session 2347082345056
2025-06-12 18:26:03,104 - handlers.base_handler - INFO - Item 'Pounded Yam with Vegetable Soup' selected for session 2347082345056, redirecting to order handler
2025-06-12 18:26:03,105 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'text', 'text': {'body': '🛒 *Pounded Yam with Vegetable Soup*\nPrice: ₦1,700\n\nHow many would you like to order?\n\nPlease enter a number (e.g., 1, 2, 3...):'}}
2025-06-12 18:26:03,982 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjVFREZBRjdFOTFFN0MyNjVGNwA="}]}
2025-06-12 18:26:03,983 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjVFREZBRjdFOTFFN0MyNjVGNwA='}]}
2025-06-12 18:26:03,983 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:26:03] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:26:04,690 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:26:04] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:26:05,248 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:26:05] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:26:05,250 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:26:05] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:26:05,526 - handlers.webhook_handler - INFO - List reply received: id='Smoky Jollof Fiesta', title='Smoky Jollof Fi (₦1,500)'
2025-06-12 18:26:05,526 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': 'Smoky Jollof Fiesta'}
2025-06-12 18:26:05,533 - handlers.base_handler - INFO - MenuHandler: Handling item selection 'Smoky Jollof Fiesta' for session 2349030918492
2025-06-12 18:26:05,533 - handlers.base_handler - INFO - Item 'Smoky Jollof Fiesta' selected for session 2349030918492, redirecting to order handler
2025-06-12 18:26:05,533 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'text', 'text': {'body': '🛒 *Smoky Jollof Fiesta*\nPrice: ₦1,500\n\nHow many would you like to order?\n\nPlease enter a number (e.g., 1, 2, 3...):'}}
2025-06-12 18:26:06,647 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjBCNkUwMjE1MDc0MjU4MjAxRgA="}]}
2025-06-12 18:26:06,648 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjBCNkUwMjE1MDc0MjU4MjAxRgA='}]}
2025-06-12 18:26:06,648 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:26:06] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:26:07,379 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:26:07] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:26:08,017 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:26:08] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:26:11,167 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': '2'}
2025-06-12 18:26:11,170 - handlers.order_handler - INFO - Item 'Pounded Yam with Vegetable Soup' added to cart for session 2347082345056. Cart: {'Pounded Yam with Vegetable Soup': {'item_id': 'Pounded Yam with Vegetable Soup', 'quantity': 2, 'price': 1700.0, 'total_price': 3400.0, 'variations': {}}}
2025-06-12 18:26:11,175 - services.lead_tracker - INFO - Cart addition tracked for 2347082345056: ₦3,400.0 (1 items)
2025-06-12 18:26:11,175 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2347082345056 - ₦3,400.00
2025-06-12 18:26:11,176 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': "🛒 *Your Cart:*\n• 2 x Pounded Yam with Vegetable Soup (₦1,700.0) = ₦3,400.0\n\n💰 *Total: ₦3,400.0*\n\nWhat would you like to do next?\n\nPress 'Checkout' to finalize.\nPress 'Order More' to add more items.\nOr, press 'Other Options' for cart management."}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'checkout', 'title': 'Checkout'}}, {'type': 'reply', 'reply': {'id': 'order_more', 'title': 'Order More'}}, {'type': 'reply', 'reply': {'id': 'other_actions', 'title': 'Other Options'}}]}}}
2025-06-12 18:26:11,375 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': '4'}
2025-06-12 18:26:11,379 - handlers.order_handler - INFO - Item 'Smoky Jollof Fiesta' added to cart for session 2349030918492. Cart: {'Smoky Jollof Fiesta': {'item_id': 'Smoky Jollof Fiesta', 'quantity': 4, 'price': 1500.0, 'total_price': 6000.0, 'variations': {}}}
2025-06-12 18:26:11,384 - services.lead_tracker - INFO - Cart addition tracked for 2349030918492: ₦6,000.0 (1 items)
2025-06-12 18:26:11,385 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2349030918492 - ₦6,000.00
2025-06-12 18:26:11,385 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': "🛒 *Your Cart:*\n• 4 x Smoky Jollof Fiesta (₦1,500.0) = ₦6,000.0\n\n💰 *Total: ₦6,000.0*\n\nWhat would you like to do next?\n\nPress 'Checkout' to finalize.\nPress 'Order More' to add more items.\nOr, press 'Other Options' for cart management."}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'checkout', 'title': 'Checkout'}}, {'type': 'reply', 'reply': {'id': 'order_more', 'title': 'Order More'}}, {'type': 'reply', 'reply': {'id': 'other_actions', 'title': 'Other Options'}}]}}}
2025-06-12 18:26:11,968 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkE4RTkwN0I5QTI4NzMxMkQ1QQA="}]}
2025-06-12 18:26:11,971 - services.lead_tracker - INFO - Cart addition tracked for 2347082345056: ₦3,400.0 (1 items)
2025-06-12 18:26:11,971 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2347082345056 - ₦3,400.00
2025-06-12 18:26:11,971 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkE4RTkwN0I5QTI4NzMxMkQ1QQA='}]}
2025-06-12 18:26:11,972 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:26:11] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:26:12,031 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEkZCNjBBNzY5ODIyNDc5MEREOQA="}]}
2025-06-12 18:26:12,034 - services.lead_tracker - INFO - Cart addition tracked for 2349030918492: ₦6,000.0 (1 items)
2025-06-12 18:26:12,035 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2349030918492 - ₦6,000.00
2025-06-12 18:26:12,035 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEkZCNjBBNzY5ODIyNDc5MEREOQA='}]}
2025-06-12 18:26:12,035 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:26:12] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:26:12,987 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:26:12] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:26:13,144 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:26:13] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:26:13,145 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:26:13] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:26:13,260 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:26:13] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:26:13,286 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:26:13] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:26:18,094 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'order_more'}
2025-06-12 18:26:18,096 - handlers.order_handler - INFO - User selected 'Order More' for session 2347082345056.
2025-06-12 18:26:18,097 - handlers.message_processor - INFO - Redirecting session 2347082345056 to handler 'menu_handler' with message 'show_menu'.
2025-06-12 18:26:18,097 - handlers.message_processor - WARNING - Unhandled order_handler state 'menu' for session 2347082345056
2025-06-12 18:26:18,097 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'text', 'text': {'body': "Please select 'Checkout', 'Order More', 'Other Options', or type 'remove' or 'cancel'."}}
2025-06-12 18:26:18,912 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjc1NEI5MUY5QzNCMTk0NTBBNAA="}]}
2025-06-12 18:26:18,915 - services.lead_tracker - INFO - Cart addition tracked for 2347082345056: ₦3,400.0 (1 items)
2025-06-12 18:26:18,916 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2347082345056 - ₦3,400.00
2025-06-12 18:26:18,916 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjc1NEI5MUY5QzNCMTk0NTBBNAA='}]}
2025-06-12 18:26:18,916 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:26:18] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:26:19,796 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:26:19] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:26:20,102 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:26:20] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:26:20,166 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:26:20] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:26:21,712 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': 'other_actions'}
2025-06-12 18:26:21,715 - handlers.order_handler - INFO - User selected 'Other Options' for session 2349030918492.
2025-06-12 18:26:21,716 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'text', 'text': {'body': "You can:\n- Type *'remove'* to remove an item from your cart.\n- Type *'cancel'* to cancel your entire order."}}
2025-06-12 18:26:22,489 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjRFQzZBNDQyRjMxNzVGOEY2OAA="}]}
2025-06-12 18:26:22,499 - services.lead_tracker - INFO - Cart addition tracked for 2349030918492: ₦6,000.0 (1 items)
2025-06-12 18:26:22,500 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2349030918492 - ₦6,000.00
2025-06-12 18:26:22,500 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjRFQzZBNDQyRjMxNzVGOEY2OAA='}]}
2025-06-12 18:26:22,500 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:26:22] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:26:23,244 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:26:23] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:26:23,413 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:26:23] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:26:43,287 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': 'Remove'}
2025-06-12 18:26:43,295 - handlers.order_handler - INFO - User typed 'remove' for session 2349030918492.
2025-06-12 18:26:43,296 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'text', 'text': {'body': "Which item would you like to remove? Please type the *exact name* of the item from the list below:\n\n*1. Smoky Jollof Fiesta*\n\nType 'back' to go back to the order summary."}}
2025-06-12 18:26:44,032 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEkExQkJFNTdFQTVDQkU3MkJCQgA="}]}
2025-06-12 18:26:44,035 - services.lead_tracker - INFO - Cart addition tracked for 2349030918492: ₦6,000.0 (1 items)
2025-06-12 18:26:44,036 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2349030918492 - ₦6,000.00
2025-06-12 18:26:44,036 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEkExQkJFNTdFQTVDQkU3MkJCQgA='}]}
2025-06-12 18:26:44,037 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:26:44] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:26:44,943 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:26:44] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:26:45,490 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:26:45] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:26:52,422 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': 'Back'}
2025-06-12 18:26:52,427 - handlers.order_handler - INFO - User typed 'back' from remove item selection for session 2349030918492.
2025-06-12 18:26:52,427 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': "🛒 *Your Cart:*\n• 4 x Smoky Jollof Fiesta (₦1,500.0) = ₦6,000.0\n\n💰 *Total: ₦6,000.0*\n\nWhat would you like to do next?\n\nPress 'Checkout' to finalize.\nPress 'Order More' to add more items.\nOr, press 'Other Options' for cart management."}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'checkout', 'title': 'Checkout'}}, {'type': 'reply', 'reply': {'id': 'order_more', 'title': 'Order More'}}, {'type': 'reply', 'reply': {'id': 'other_actions', 'title': 'Other Options'}}]}}}
2025-06-12 18:26:53,287 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjc5MjZGOTQ0QTUzRkQzQzFEQwA="}]}
2025-06-12 18:26:53,291 - services.lead_tracker - INFO - Cart addition tracked for 2349030918492: ₦6,000.0 (1 items)
2025-06-12 18:26:53,291 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2349030918492 - ₦6,000.00
2025-06-12 18:26:53,291 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjc5MjZGOTQ0QTUzRkQzQzFEQwA='}]}
2025-06-12 18:26:53,292 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:26:53] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:26:54,064 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:26:54] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:26:54,174 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:26:54] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:27:00,449 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': 'checkout'}
2025-06-12 18:27:00,456 - handlers.order_handler - INFO - User selected 'Checkout' for session 2349030918492.
2025-06-12 18:27:00,457 - handlers.order_handler - INFO - Address not set, redirecting to location handler for session 2349030918492.
2025-06-12 18:27:00,457 - handlers.message_processor - INFO - Redirecting session 2349030918492 to handler 'location_handler' with message 'initiate_address_collection'.
2025-06-12 18:27:00,461 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'text', 'text': {'body': 'Please choose a valid option from the menu.'}}
2025-06-12 18:27:01,326 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjU1NjkwRDg0MUE0REFGQUVEMQA="}]}
2025-06-12 18:27:01,327 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '📍 *How would you like to provide your delivery address?*\n\nChoose the most convenient option:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'share_current_location', 'title': '📍 Share Current Location'}}, {'type': 'reply', 'reply': {'id': 'type_address_manually', 'title': '✏️ Type Address Manually'}}]}}}
2025-06-12 18:27:01,817 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 400 Client Error: Bad Request for url: https://graph.facebook.com/v17.0/608867502309431/messages - {"error":{"message":"(#131009) Parameter value is not valid","type":"OAuthException","code":131009,"error_data":{"messaging_product":"whatsapp","details":"Button title length invalid. Min length: 1, Max length: 20"},"fbtrace_id":"ADreQ9xhwOWKxqpaahzpNWZ"}}
2025-06-12 18:27:01,818 - handlers.message_processor - WARNING - No specific handler or state match for handler 'location_handler', state 'address_collection_menu', message 'initiate_address_collection' for session 2349030918492. Resetting to greeting.
2025-06-12 18:27:01,818 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'text', 'text': {'body': "I'm sorry, I didn't quite understand that. Let's get back to the main menu."}}
2025-06-12 18:27:02,354 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:27:02] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:27:02,496 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:27:02] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:27:02,528 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjVCMzE3NkE4NDNEMjk4QTU2NgA="}]}
2025-06-12 18:27:02,529 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Benny! 👋\n\nPlease choose from the options below:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-12 18:27:03,177 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjQ3NDhCOUU1MkQ2RkZFMEVDNQA="}]}
2025-06-12 18:27:03,180 - services.lead_tracker - INFO - Cart addition tracked for 2349030918492: ₦6,000.0 (1 items)
2025-06-12 18:27:03,181 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2349030918492 - ₦6,000.00
2025-06-12 18:27:03,181 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjQ3NDhCOUU1MkQ2RkZFMEVDNQA='}]}
2025-06-12 18:27:03,181 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:27:03] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:27:03,265 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:27:03] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:27:03,638 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:27:03] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:27:03,859 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:27:03] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:27:04,217 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:27:04] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:27:16,810 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': 'order_menu_categories'}
2025-06-12 18:27:16,814 - handlers.base_handler - INFO - GreetingHandler: Handling message 'order_menu_categories' in greeting state for session 2349030918492.
2025-06-12 18:27:16,815 - handlers.base_handler - INFO - Session 2349030918492 redirecting to menu_handler for classic menu.
2025-06-12 18:27:16,815 - handlers.message_processor - INFO - Redirecting session 2349030918492 to handler 'menu_handler' with message 'show_menu'.
2025-06-12 18:27:16,815 - handlers.base_handler - INFO - MenuHandler: Received message 'show_menu' (original: 'order_menu_categories') in menu state for session 2349030918492
2025-06-12 18:27:16,816 - handlers.base_handler - INFO - Showing menu categories for session 2349030918492
2025-06-12 18:27:16,816 - handlers.base_handler - INFO - Available categories: ['Main Dishes', 'Soups & Stews', 'Sides', 'Snacks', 'Drinks', 'Desserts', 'Specialties']
2025-06-12 18:27:16,817 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'interactive', 'interactive': {'type': 'list', 'body': {'text': '🍽️ *Our Menu*\n\nChoose a category to browse items:'}, 'action': {'button': 'Categories', 'sections': [{'title': 'Menu Categories', 'rows': [{'id': 'main dishes', 'title': 'Main Dishes'}, {'id': 'soups & stews', 'title': 'Soups & Stews'}, {'id': 'sides', 'title': 'Sides'}, {'id': 'snacks', 'title': 'Snacks'}, {'id': 'drinks', 'title': 'Drinks'}, {'id': 'desserts', 'title': 'Desserts'}, {'id': 'specialties', 'title': 'Specialties'}]}]}}}
2025-06-12 18:27:17,577 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjNCQjdDMTM4QTk0NUE5NDg4NAA="}]}
2025-06-12 18:27:17,586 - services.lead_tracker - INFO - Cart addition tracked for 2349030918492: ₦6,000.0 (1 items)
2025-06-12 18:27:17,587 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2349030918492 - ₦6,000.00
2025-06-12 18:27:17,588 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjNCQjdDMTM4QTk0NUE5NDg4NAA='}]}
2025-06-12 18:27:17,589 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:27:17] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:27:18,233 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:27:18] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:27:18,885 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:27:18] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:28:09,538 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-12 18:28:09,538 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-12 18:28:09,539 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-12 18:28:09,539 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-12 18:28:09,540 - services.payment_service - INFO - PaymentService initialized
2025-06-12 18:28:09,540 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-12 18:28:09,540 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-12 18:28:09,541 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-12 18:28:09,541 - services.payment_service - INFO - PaymentService initialized
2025-06-12 18:28:09,541 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-12 18:28:09,542 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-12 18:28:09,542 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-12 18:28:09,542 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-12 18:28:09,543 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-12 18:28:09,543 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-12 18:28:09,908 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-12 18:28:09,909 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-12 18:28:09,909 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-12 18:28:09,909 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-12 18:28:09,922 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-12 18:28:09,923 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-12 18:28:11,392 - handlers.webhook_handler - INFO - List reply received: id='snacks', title='Snacks'
2025-06-12 18:28:11,392 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': 'snacks'}
2025-06-12 18:28:11,393 - utils.session_manager - INFO - New session 2349030918492 initialized.
2025-06-12 18:28:11,397 - handlers.base_handler - INFO - Session 2349030918492 initialized with greeting state for user 'Benny'.
2025-06-12 18:28:11,398 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Benny! 👋\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-12 18:28:12,416 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjVFMDAxNEU1QjA5QzZDMzdDOQA="}]}
2025-06-12 18:28:12,417 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjVFMDAxNEU1QjA5QzZDMzdDOQA='}]}
2025-06-12 18:28:12,417 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:28:12] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:28:13,355 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:28:13] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:28:14,543 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:28:14] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:28:20,934 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-12 18:28:20,935 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-12 18:28:20,943 - handlers.base_handler - INFO - Session 2348055614455 initialized with greeting state for user 'Ziga'.
2025-06-12 18:28:20,944 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Ziga! 👋\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-12 18:28:21,901 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkQ2MTNDRjFGMzQ5RUM0RDk4MgA="}]}
2025-06-12 18:28:21,901 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkQ2MTNDRjFGMzQ5RUM0RDk4MgA='}]}
2025-06-12 18:28:21,902 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:28:21] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:28:22,712 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:28:22] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:28:23,176 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:28:23] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:28:23,477 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:28:23] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:28:24,637 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-12 18:28:24,639 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-06-12 18:28:24,640 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-06-12 18:28:24,640 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-06-12 18:28:24,641 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-06-12 18:28:24,642 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Just send me your full order in one message! \n\nLike this: 'Two plates of jollof rice, 2 Cokes, and asun.'\n\nWant to go back again? Type ‘menu’ to return. "}}
2025-06-12 18:28:25,560 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjdERjgzNUYyMDdGRUQwQzBCMAA="}]}
2025-06-12 18:28:25,561 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjdERjgzNUYyMDdGRUQwQzBCMAA='}]}
2025-06-12 18:28:25,561 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:28:25] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:28:26,443 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:28:26] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:28:26,765 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:28:26] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:28:27,108 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:28:27] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:28:32,608 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Jellof rice'}
2025-06-12 18:28:32,610 - handlers.base_handler - INFO - AIHandler: Handling message 'jellof rice' in AI bulk order state for session 2348055614455. Original: 'Jellof rice'
2025-06-12 18:28:35,472 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-12 18:28:35,474 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🛒 *Order Summary:*\n\n✅ 1x Smoky Jollof Fiesta - ₦1,500\n\n*Total: ₦1,500.00*\n\nWould you like to proceed with this order?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'confirm_ai_order', 'title': '✅ Confirm Order'}}, {'type': 'reply', 'reply': {'id': 'modify_ai_order', 'title': '✏️ Modify Order'}}, {'type': 'reply', 'reply': {'id': 'cancel_ai_order', 'title': '❌ Cancel'}}]}}}
2025-06-12 18:28:36,453 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjEyNTM2MDY1OTIwOTJCNDk5MAA="}]}
2025-06-12 18:28:36,453 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjEyNTM2MDY1OTIwOTJCNDk5MAA='}]}
2025-06-12 18:28:36,454 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:28:36] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:28:37,327 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:28:37] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:28:37,638 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:28:37] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:28:38,025 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:28:38] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:28:39,368 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-12 18:28:39,371 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2349030918492.
2025-06-12 18:28:39,372 - handlers.base_handler - INFO - Session 2349030918492 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-06-12 18:28:39,372 - handlers.message_processor - INFO - Redirecting session 2349030918492 to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-06-12 18:28:39,373 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2349030918492. Original: 'ai_bulk_order_direct'
2025-06-12 18:28:39,373 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'text', 'text': {'body': "Just send me your full order in one message! \n\nLike this: 'Two plates of jollof rice, 2 Cokes, and asun.'\n\nWant to go back again? Type ‘menu’ to return. "}}
2025-06-12 18:28:40,215 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjNCRTIxQTc0M0ZEMUYyRDRENgA="}]}
2025-06-12 18:28:40,216 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjNCRTIxQTc0M0ZEMUYyRDRENgA='}]}
2025-06-12 18:28:40,216 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:28:40] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:28:40,460 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': 'others_menu'}
2025-06-12 18:28:40,465 - handlers.base_handler - INFO - AIHandler: Handling message 'others_menu' in AI bulk order state for session 2349030918492. Original: 'others_menu'
2025-06-12 18:28:40,876 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:28:40] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:28:41,488 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:28:41] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:28:41,530 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-12 18:28:41,531 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'text', 'text': {'body': "❌ No items were recognized in the order.\n\nPlease try rephrasing your order or type 'menu' to return to main menu."}}
2025-06-12 18:28:42,340 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjRERjA1REZGMDQ0M0UzNkJBMQA="}]}
2025-06-12 18:28:42,341 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjRERjA1REZGMDQ0M0UzNkJBMQA='}]}
2025-06-12 18:28:42,341 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:28:42] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:28:43,135 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:28:43] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:28:43,451 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:28:43] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:28:46,922 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': 'Menu'}
2025-06-12 18:28:46,925 - handlers.base_handler - INFO - AIHandler: Handling message 'menu' in AI bulk order state for session 2349030918492. Original: 'Menu'
2025-06-12 18:28:46,925 - handlers.base_handler - INFO - Session 2349030918492 returned to main menu (greeting state).
2025-06-12 18:28:46,926 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Benny! 👋\n\nWelcome back! How can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-12 18:28:47,373 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-06-12 18:28:47,375 - handlers.base_handler - INFO - AI order confirmed. Cart: {'Smoky Jollof Fiesta': {'item_id': 'Smoky Jollof Fiesta', 'quantity': 1, 'price': 1500, 'total_price': 1500, 'variations': {}}}. Redirecting to order handler.
2025-06-12 18:28:47,375 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'order_handler' with message 'process_final_order'.
2025-06-12 18:28:47,376 - handlers.order_handler - INFO - AI initiated order processing for session 2348055614455.
2025-06-12 18:28:47,376 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🛒 *ORDER CONFIRMATION*\n\n📋 *Items Ordered:*\n• 1x Smoky Jollof Fiesta - ₦1,500.00\n\n📍 *Delivery Details:*\n👤 Name: Ziga\n📱 Phone: 2348055614455\n🏠 Address: Howson Wright\n\n💰 *Total Amount: ₦1,500.00*\n\nPlease review your order and delivery details:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'confirm_order', 'title': '✅ Confirm Order'}}, {'type': 'reply', 'reply': {'id': 'modify_order', 'title': '✏️ Modify Order'}}, {'type': 'reply', 'reply': {'id': 'change_address', 'title': '📍 Change Address'}}]}}}
2025-06-12 18:28:47,845 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjcxNENGQUNFNkNFMjdDRjU5OAA="}]}
2025-06-12 18:28:47,846 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Benny! 👋\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-12 18:28:48,435 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjkwM0Q5MEM1OUIzOEVBRjE5QgA="}]}
2025-06-12 18:28:48,438 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦1,500 (1 items)
2025-06-12 18:28:48,438 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦1,500.00
2025-06-12 18:28:48,439 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjkwM0Q5MEM1OUIzOEVBRjE5QgA='}]}
2025-06-12 18:28:48,439 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:28:48] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:28:48,519 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:28:48] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:28:48,808 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:28:48] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:28:49,120 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjRBOUI1QUZFODdFOUM1QTlFQwA="}]}
2025-06-12 18:28:49,121 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjRBOUI1QUZFODdFOUM1QTlFQwA='}]}
2025-06-12 18:28:49,121 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:28:49] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:28:49,326 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:28:49] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:28:49,365 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:28:49] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:28:49,916 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:28:49] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:28:50,022 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:28:50] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:28:50,164 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:28:50] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:28:51,653 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': 'order_menu_categories'}
2025-06-12 18:28:51,656 - handlers.base_handler - INFO - GreetingHandler: Handling message 'order_menu_categories' in greeting state for session 2349030918492.
2025-06-12 18:28:51,657 - handlers.base_handler - INFO - Session 2349030918492 redirecting to menu_handler for classic menu.
2025-06-12 18:28:51,657 - handlers.message_processor - INFO - Redirecting session 2349030918492 to handler 'menu_handler' with message 'show_menu'.
2025-06-12 18:28:51,657 - handlers.base_handler - INFO - MenuHandler: Received message 'show_menu' (original: 'order_menu_categories') in menu state for session 2349030918492
2025-06-12 18:28:51,658 - handlers.base_handler - INFO - Showing menu categories for session 2349030918492
2025-06-12 18:28:51,658 - handlers.base_handler - INFO - Available categories: ['Main Dishes', 'Soups & Stews', 'Sides', 'Snacks', 'Drinks', 'Desserts', 'Specialties']
2025-06-12 18:28:51,658 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'interactive', 'interactive': {'type': 'list', 'body': {'text': '🍽️ *Our Menu*\n\nChoose a category to browse items:'}, 'action': {'button': 'Categories', 'sections': [{'title': 'Menu Categories', 'rows': [{'id': 'main dishes', 'title': 'Main Dishes'}, {'id': 'soups & stews', 'title': 'Soups & Stews'}, {'id': 'sides', 'title': 'Sides'}, {'id': 'snacks', 'title': 'Snacks'}, {'id': 'drinks', 'title': 'Drinks'}, {'id': 'desserts', 'title': 'Desserts'}, {'id': 'specialties', 'title': 'Specialties'}]}]}}}
2025-06-12 18:28:52,530 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjBGMjQxRjc3Nzk1QkEzNEEyMgA="}]}
2025-06-12 18:28:52,530 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjBGMjQxRjc3Nzk1QkEzNEEyMgA='}]}
2025-06-12 18:28:52,531 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:28:52] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:28:53,226 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:28:53] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:28:54,518 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:28:54] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:29:05,329 - handlers.webhook_handler - INFO - List reply received: id='sides', title='Sides'
2025-06-12 18:29:05,330 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': 'sides'}
2025-06-12 18:29:05,333 - handlers.base_handler - INFO - MenuHandler: Received message 'sides' (original: 'sides') in menu state for session 2349030918492
2025-06-12 18:29:05,333 - handlers.base_handler - INFO - Category 'Sides' selected for session 2349030918492
2025-06-12 18:29:05,334 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'interactive', 'interactive': {'type': 'list', 'body': {'text': '🍽️ *Sides*\n\nSelect an item to add to your cart:'}, 'action': {'button': 'Select Item', 'sections': [{'title': 'Sides Items', 'rows': [{'id': 'Fried Plantain', 'title': 'Fried Plantain (₦500)'}, {'id': 'Yam Fries with Pepper Dip', 'title': 'Yam Fries with Pe (₦600)'}, {'id': 'Coleslaw', 'title': 'Coleslaw (₦400)'}, {'id': 'Moi Moi', 'title': 'Moi Moi (₦500)'}, {'id': 'Boiled Yam Slices', 'title': 'Boiled Yam Slices (₦400)'}, {'id': 'Vegetable Salad', 'title': 'Vegetable Salad (₦500)'}, {'id': 'Spicy Gizdodo', 'title': 'Spicy Gizdodo (₦700)'}, {'id': 'Jollof Beans', 'title': 'Jollof Beans (₦600)'}, {'id': 'Sweet Potato Wedges', 'title': 'Sweet Potato Wedg (₦500)'}, {'id': 'Garlic Bread Rolls', 'title': 'Garlic Bread Roll (₦400)'}]}]}}}
2025-06-12 18:29:06,352 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEkM2NDkxN0Q5NjExRTQxODkzMQA="}]}
2025-06-12 18:29:06,353 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEkM2NDkxN0Q5NjExRTQxODkzMQA='}]}
2025-06-12 18:29:06,354 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:29:06] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:29:07,064 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:29:07] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:29:07,587 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:29:07] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:29:55,709 - handlers.webhook_handler - INFO - List reply received: id='Moi Moi', title='Moi Moi (₦500)'
2025-06-12 18:29:55,709 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': 'Moi Moi'}
2025-06-12 18:29:55,712 - handlers.base_handler - INFO - MenuHandler: Handling item selection 'Moi Moi' for session 2349030918492
2025-06-12 18:29:55,712 - handlers.base_handler - INFO - Item 'Moi Moi' selected for session 2349030918492, redirecting to order handler
2025-06-12 18:29:55,713 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'text', 'text': {'body': '🛒 *Moi Moi*\nPrice: ₦500\n\nHow many would you like to order?\n\nPlease enter a number (e.g., 1, 2, 3...):'}}
2025-06-12 18:29:56,747 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEkJCNDA2MkUwQkI2MkNEQjkxMgA="}]}
2025-06-12 18:29:56,747 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEkJCNDA2MkUwQkI2MkNEQjkxMgA='}]}
2025-06-12 18:29:56,748 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:29:56] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:29:57,515 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:29:57] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:29:58,205 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:29:58] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:30:36,093 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': '2'}
2025-06-12 18:30:36,098 - handlers.order_handler - INFO - Item 'Moi Moi' added to cart for session 2349030918492. Cart: {'Moi Moi': {'item_id': 'Moi Moi', 'quantity': 2, 'price': 500.0, 'total_price': 1000.0, 'variations': {}}}
2025-06-12 18:30:36,105 - services.lead_tracker - INFO - Cart addition tracked for 2349030918492: ₦1,000.0 (1 items)
2025-06-12 18:30:36,105 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2349030918492 - ₦1,000.00
2025-06-12 18:30:36,106 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': "🛒 *Your Cart:*\n• 2 x Moi Moi (₦500.0) = ₦1,000.0\n\n💰 *Total: ₦1,000.0*\n\nWhat would you like to do next?\n\nPress 'Checkout' to finalize.\nPress 'Order More' to add more items.\nOr, press 'Other Options' for cart management."}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'checkout', 'title': 'Checkout'}}, {'type': 'reply', 'reply': {'id': 'order_more', 'title': 'Order More'}}, {'type': 'reply', 'reply': {'id': 'other_actions', 'title': 'Other Options'}}]}}}
2025-06-12 18:30:37,158 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEkY0RDVFMkE3MDJEM0FGRkVCMAA="}]}
2025-06-12 18:30:37,160 - services.lead_tracker - INFO - Cart addition tracked for 2349030918492: ₦1,000.0 (1 items)
2025-06-12 18:30:37,161 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2349030918492 - ₦1,000.00
2025-06-12 18:30:37,161 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEkY0RDVFMkE3MDJEM0FGRkVCMAA='}]}
2025-06-12 18:30:37,161 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:30:37] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:30:37,942 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:30:37] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:30:38,457 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:30:38] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:31:24,892 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-12 18:31:24,893 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-12 18:31:24,893 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-12 18:31:24,894 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-12 18:31:24,894 - services.payment_service - INFO - PaymentService initialized
2025-06-12 18:31:24,895 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-12 18:31:24,895 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-12 18:31:24,896 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-12 18:31:24,896 - services.payment_service - INFO - PaymentService initialized
2025-06-12 18:31:24,897 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-12 18:31:24,897 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-12 18:31:24,898 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-12 18:31:24,898 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-12 18:31:24,898 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-12 18:31:24,899 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-12 18:31:25,255 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-12 18:31:25,255 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-12 18:31:25,255 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-12 18:31:25,256 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-12 18:31:25,269 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-12 18:31:25,269 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-12 18:31:30,043 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-12 18:31:30,043 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-12 18:31:30,046 - handlers.base_handler - INFO - Session 2348055614455 initialized with greeting state for user 'Ziga'.
2025-06-12 18:31:30,047 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Ziga! 👋\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-12 18:31:30,980 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjIxREFGNDkyQ0YwREI4NUY1OAA="}]}
2025-06-12 18:31:30,980 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjIxREFGNDkyQ0YwREI4NUY1OAA='}]}
2025-06-12 18:31:30,981 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:31:30] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:31:31,668 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:31:31] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:31:31,977 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:31:31] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:31:32,454 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:31:32] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:31:38,981 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-12 18:31:38,984 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-06-12 18:31:38,984 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-06-12 18:31:38,984 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-06-12 18:31:38,985 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-06-12 18:31:38,985 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Just send me your full order in one message! \n\nLike this: 'Two plates of jollof rice, 2 Cokes, and asun.'\n\nWant to go back again? Type ‘menu’ to return. "}}
2025-06-12 18:31:39,687 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjE5MzlCOEM4RDdBOUZCNzQzQQA="}]}
2025-06-12 18:31:39,688 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjE5MzlCOEM4RDdBOUZCNzQzQQA='}]}
2025-06-12 18:31:39,688 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:31:39] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:31:40,428 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:31:40] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:31:40,670 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:31:40] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:31:41,054 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:31:41] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:31:45,054 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'Order More'}
2025-06-12 18:31:45,054 - utils.session_manager - INFO - New session 2347082345056 initialized.
2025-06-12 18:31:45,063 - handlers.base_handler - INFO - Session 2347082345056 initialized with greeting state for user 'Olumayowa Oyaleke'.
2025-06-12 18:31:45,063 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Olumayowa Oyaleke! 👋\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-12 18:31:45,797 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkJBNzM2MEMwMEI3RkREMkQ1MwA="}]}
2025-06-12 18:31:45,797 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkJBNzM2MEMwMEI3RkREMkQ1MwA='}]}
2025-06-12 18:31:45,798 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:31:45] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:31:46,761 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:31:46] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:31:47,048 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:31:47] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:31:47,275 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:31:47] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:31:47,614 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': '2 jellof rice'}
2025-06-12 18:31:47,616 - handlers.base_handler - INFO - AIHandler: Handling message '2 jellof rice' in AI bulk order state for session 2348055614455. Original: '2 jellof rice'
2025-06-12 18:31:50,553 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-12 18:31:50,555 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🛒 *Order Summary:*\n\n✅ 2x Smoky Jollof Fiesta - ₦3,000\n\n*Total: ₦3,000.00*\n\nWould you like to proceed with this order?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'confirm_ai_order', 'title': '✅ Confirm Order'}}, {'type': 'reply', 'reply': {'id': 'modify_ai_order', 'title': '✏️ Modify Order'}}, {'type': 'reply', 'reply': {'id': 'cancel_ai_order', 'title': '❌ Cancel'}}]}}}
2025-06-12 18:31:51,347 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkIwRjg1NkFCOTU2NTdEM0MwRQA="}]}
2025-06-12 18:31:51,347 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkIwRjg1NkFCOTU2NTdEM0MwRQA='}]}
2025-06-12 18:31:51,348 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:31:51] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:31:52,313 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:31:52] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:31:52,314 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:31:52] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:31:52,915 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:31:52] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:32:01,585 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'modify_ai_order'}
2025-06-12 18:32:01,588 - handlers.base_handler - INFO - User chose to modify AI order for session 2348055614455.
2025-06-12 18:32:01,588 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': 'Please tell me your updated order:'}}
2025-06-12 18:32:02,348 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQyMTEyNjdCRkJEQjcwNTJERAA="}]}
2025-06-12 18:32:02,349 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQyMTEyNjdCRkJEQjcwNTJERAA='}]}
2025-06-12 18:32:02,349 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:32:02] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:32:02,998 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:32:02] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:32:03,497 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:32:03] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:32:04,129 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:32:04] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:32:07,752 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'other_actions'}
2025-06-12 18:32:07,756 - handlers.base_handler - INFO - GreetingHandler: Handling message 'other_actions' in greeting state for session 2347082345056.
2025-06-12 18:32:07,756 - handlers.base_handler - WARNING - Session 2347082345056: Invalid option 'other_actions' in greeting state.
2025-06-12 18:32:07,757 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Olumayowa Oyaleke! 👋\n\nInvalid option. Please choose from the options below:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-12 18:32:08,596 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Fried rice'}
2025-06-12 18:32:08,598 - handlers.base_handler - INFO - AIHandler: Handling message 'fried rice' in AI bulk order state for session 2348055614455. Original: 'Fried rice'
2025-06-12 18:32:08,770 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjZFRjczOTg3N0RGRDNEMTQ0RgA="}]}
2025-06-12 18:32:08,771 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjZFRjczOTg3N0RGRDNEMTQ0RgA='}]}
2025-06-12 18:32:08,771 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:32:08] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:32:09,590 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:32:09] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:32:10,065 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:32:10] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:32:10,209 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:32:10] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:32:10,617 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-12 18:32:10,618 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🛒 *Order Summary:*\n\n✅ 1x Fried Rice Fiesta - ₦1,400\n\n*Total: ₦1,400.00*\n\nWould you like to proceed with this order?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'confirm_ai_order', 'title': '✅ Confirm Order'}}, {'type': 'reply', 'reply': {'id': 'modify_ai_order', 'title': '✏️ Modify Order'}}, {'type': 'reply', 'reply': {'id': 'cancel_ai_order', 'title': '❌ Cancel'}}]}}}
2025-06-12 18:32:11,349 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkY1RTRFMjRCQzk4NDUyQUU1OAA="}]}
2025-06-12 18:32:11,350 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkY1RTRFMjRCQzk4NDUyQUU1OAA='}]}
2025-06-12 18:32:11,351 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:32:11] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:32:11,928 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:32:11] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:32:11,979 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'order_menu_categories'}
2025-06-12 18:32:11,984 - handlers.base_handler - INFO - GreetingHandler: Handling message 'order_menu_categories' in greeting state for session 2347082345056.
2025-06-12 18:32:11,985 - handlers.base_handler - INFO - Session 2347082345056 redirecting to menu_handler for classic menu.
2025-06-12 18:32:11,985 - handlers.message_processor - INFO - Redirecting session 2347082345056 to handler 'menu_handler' with message 'show_menu'.
2025-06-12 18:32:11,986 - handlers.base_handler - INFO - MenuHandler: Received message 'show_menu' (original: 'order_menu_categories') in menu state for session 2347082345056
2025-06-12 18:32:11,986 - handlers.base_handler - INFO - Showing menu categories for session 2347082345056
2025-06-12 18:32:11,986 - handlers.base_handler - INFO - Available categories: ['Main Dishes', 'Soups & Stews', 'Sides', 'Snacks', 'Drinks', 'Desserts', 'Specialties']
2025-06-12 18:32:11,987 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'list', 'body': {'text': '🍽️ *Our Menu*\n\nChoose a category to browse items:'}, 'action': {'button': 'Categories', 'sections': [{'title': 'Menu Categories', 'rows': [{'id': 'main dishes', 'title': 'Main Dishes'}, {'id': 'soups & stews', 'title': 'Soups & Stews'}, {'id': 'sides', 'title': 'Sides'}, {'id': 'snacks', 'title': 'Snacks'}, {'id': 'drinks', 'title': 'Drinks'}, {'id': 'desserts', 'title': 'Desserts'}, {'id': 'specialties', 'title': 'Specialties'}]}]}}}
2025-06-12 18:32:12,235 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:32:12] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:32:12,725 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjg0QzM2OTQxNDdGMDExODk0MQA="}]}
2025-06-12 18:32:12,725 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjg0QzM2OTQxNDdGMDExODk0MQA='}]}
2025-06-12 18:32:12,726 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:32:12] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:32:13,094 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:32:13] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:32:13,482 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:32:13] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:32:13,485 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': 'other_actions'}
2025-06-12 18:32:13,486 - utils.session_manager - INFO - New session 2349030918492 initialized.
2025-06-12 18:32:13,490 - handlers.base_handler - INFO - Session 2349030918492 initialized with greeting state for user 'Benny'.
2025-06-12 18:32:13,491 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Benny! 👋\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-12 18:32:14,121 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:32:14] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:32:14,172 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:32:14] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:32:14,200 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjAwRUFEQzk0QjAyQkQ5OUJGQwA="}]}
2025-06-12 18:32:14,201 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjAwRUFEQzk0QjAyQkQ5OUJGQwA='}]}
2025-06-12 18:32:14,202 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:32:14] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:32:15,203 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:32:15] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:32:15,997 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-06-12 18:32:15,999 - handlers.base_handler - INFO - AI order confirmed. Cart: {'Fried Rice Fiesta': {'item_id': 'Fried Rice Fiesta', 'quantity': 1, 'price': 1400, 'total_price': 1400, 'variations': {}}}. Redirecting to order handler.
2025-06-12 18:32:16,000 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'order_handler' with message 'process_final_order'.
2025-06-12 18:32:16,000 - handlers.order_handler - INFO - AI initiated order processing for session 2348055614455.
2025-06-12 18:32:16,001 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🛒 *ORDER SUMMARY*\n\n📋 *Items Ordered:*\n• 1x Fried Rice Fiesta - ₦1,400.00\n\n📍 *Delivery Details:*\n👤 Name: Ziga\n📱 Phone: 2348055614455\n🏠 Address: Howson Wright\n\n💰 *Total Amount: ₦1,400.00*\n\nPlease review your order and delivery details:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'confirm_order', 'title': '✅ Confirm Order'}}, {'type': 'reply', 'reply': {'id': 'modify_order', 'title': '✏️ Modify Order'}}, {'type': 'reply', 'reply': {'id': 'change_address', 'title': '📍 Change Address'}}]}}}
2025-06-12 18:32:16,177 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:32:16] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:32:16,708 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjVDQThDNTVDQjMwOTlBQTYzMAA="}]}
2025-06-12 18:32:16,711 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦1,400 (1 items)
2025-06-12 18:32:16,711 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦1,400.00
2025-06-12 18:32:16,711 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjVDQThDNTVDQjMwOTlBQTYzMAA='}]}
2025-06-12 18:32:16,712 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:32:16] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:32:17,424 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:32:17] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:32:17,703 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:32:17] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:32:18,319 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:32:18] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:32:18,908 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_order'}
2025-06-12 18:32:18,910 - handlers.order_handler - INFO - User confirmed order for session 2348055614455.
2025-06-12 18:32:18,910 - handlers.order_handler - INFO - Order ORDER_20250612_183218_606356b4 confirmed for session 2348055614455. Amount: ₦1,400.00
2025-06-12 18:32:18,912 - services.lead_tracker - INFO - Order completion tracked for 2348055614455: ORDER_20250612_183218_606356b4 (₦1,400)
2025-06-12 18:32:18,913 - handlers.lead_tracking_handler - INFO - 💰 Conversion tracked: 2348055614455 - ORDER_20250612_183218_606356b4 (₦1,400)
2025-06-12 18:32:18,913 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'payment_handler' with message 'initiate_payment'.
2025-06-12 18:32:18,913 - handlers.base_handler - INFO - Handling payment processing for session 2348055614455, message: initiate_payment
2025-06-12 18:32:18,913 - handlers.base_handler - INFO - Creating payment link for session 2348055614455
2025-06-12 18:32:18,926 - utils.data_manager - INFO - Order details saved to data\orders.json
2025-06-12 18:32:18,926 - services.payment_service - INFO - Attempting to create payment link for reference: PAY-ORDER-20250612183218-4853 with amount: 140000, email: ziga4455@foodorder.com
2025-06-12 18:32:19,137 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': 'order_menu_categories'}
2025-06-12 18:32:19,141 - handlers.base_handler - INFO - GreetingHandler: Handling message 'order_menu_categories' in greeting state for session 2349030918492.
2025-06-12 18:32:19,142 - handlers.base_handler - INFO - Session 2349030918492 redirecting to menu_handler for classic menu.
2025-06-12 18:32:19,142 - handlers.message_processor - INFO - Redirecting session 2349030918492 to handler 'menu_handler' with message 'show_menu'.
2025-06-12 18:32:19,142 - handlers.base_handler - INFO - MenuHandler: Received message 'show_menu' (original: 'order_menu_categories') in menu state for session 2349030918492
2025-06-12 18:32:19,143 - handlers.base_handler - INFO - Showing menu categories for session 2349030918492
2025-06-12 18:32:19,144 - handlers.base_handler - INFO - Available categories: ['Main Dishes', 'Soups & Stews', 'Sides', 'Snacks', 'Drinks', 'Desserts', 'Specialties']
2025-06-12 18:32:19,145 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'interactive', 'interactive': {'type': 'list', 'body': {'text': '🍽️ *Our Menu*\n\nChoose a category to browse items:'}, 'action': {'button': 'Categories', 'sections': [{'title': 'Menu Categories', 'rows': [{'id': 'main dishes', 'title': 'Main Dishes'}, {'id': 'soups & stews', 'title': 'Soups & Stews'}, {'id': 'sides', 'title': 'Sides'}, {'id': 'snacks', 'title': 'Snacks'}, {'id': 'drinks', 'title': 'Drinks'}, {'id': 'desserts', 'title': 'Desserts'}, {'id': 'specialties', 'title': 'Specialties'}]}]}}}
2025-06-12 18:32:19,703 - services.payment_service - INFO - Payment link created for Ziga Ziga (2348055614455), URL: https://checkout.paystack.com/oo4t7v5d6u1g7u9
2025-06-12 18:32:19,703 - handlers.base_handler - INFO - Starting payment monitoring for order ORDER-20250612183218-4853, reference PAY-ORDER-20250612183218-4853
2025-06-12 18:32:19,704 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-ORDER-20250612183218-4853
2025-06-12 18:32:19,856 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjI0OTg3MTY5RTQ0QTk2MkQyMwA="}]}
2025-06-12 18:32:19,856 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjI0OTg3MTY5RTQ0QTk2MkQyMwA='}]}
2025-06-12 18:32:19,857 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:32:19] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:32:20,364 - services.payment_service - WARNING - Payment not successful for reference PAY-ORDER-20250612183218-4853. Paystack status: abandoned. Response: {'status': True, 'message': 'Verification successful', 'data': {'id': 5051430813, 'domain': 'test', 'status': 'abandoned', 'reference': 'PAY-ORDER-20250612183218-4853', 'receipt_number': None, 'amount': 140000, 'message': None, 'gateway_response': 'The transaction was not completed', 'paid_at': None, 'created_at': '2025-06-12T17:32:19.000Z', 'channel': 'card', 'currency': 'NGN', 'ip_address': '197.211.59.126, 172.71.250.161, 172.31.62.52', 'metadata': {'customer_name': 'Ziga', 'customer_phone': '2348055614455', 'first_name': 'Ziga', 'last_name': 'Ziga', 'order_id': 'ORDER-20250612183218-4853', 'delivery_address': 'Howson Wright'}, 'log': None, 'fees': None, 'fees_split': None, 'authorization': {}, 'customer': {'id': 276711440, 'first_name': None, 'last_name': None, 'email': 'ziga4455@foodorder.com', 'customer_code': 'CUS_bhkdpnbvcjqt55g', 'phone': None, 'metadata': None, 'risk_action': 'default', 'international_format_phone': None}, 'plan': None, 'split': {}, 'order_id': None, 'paidAt': None, 'createdAt': '2025-06-12T17:32:19.000Z', 'requested_amount': 140000, 'pos_transaction_data': None, 'source': None, 'fees_breakdown': None, 'connect': None, 'transaction_date': '2025-06-12T17:32:19.000Z', 'plan_object': {}, 'subaccount': {}}}
2025-06-12 18:32:20,364 - handlers.base_handler - INFO - Payment not yet verified for order ORDER-20250612183218-4853, attempt 1/15
2025-06-12 18:32:20,365 - handlers.base_handler - INFO - Payment link created successfully for order ORDER-20250612183218-4853
2025-06-12 18:32:20,365 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "🛒 *Order Created Successfully!*\n\n📋 *Order ID:* ORDER-20250612183218-4853\n💰 *Total:* ₦1,400\n\n💳 *Complete Payment:*\nhttps://checkout.paystack.com/oo4t7v5d6u1g7u9\n\n✅ We'll automatically confirm your order once payment is received!\n💬 You can also send 'paid' after payment to check status immediately.\n\n⏰ Payment link expires in 15 minutes."}}
2025-06-12 18:32:20,714 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:32:20] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:32:20,870 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:32:20] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:32:21,108 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkRDOTNBODA2MTFFNTU2RDlENQA="}]}
2025-06-12 18:32:21,111 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦1,400 (1 items)
2025-06-12 18:32:21,112 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦1,400.00
2025-06-12 18:32:21,112 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkRDOTNBODA2MTFFNTU2RDlENQA='}]}
2025-06-12 18:32:21,112 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:32:21] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:32:21,751 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:32:21] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:32:22,085 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:32:22] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:32:22,649 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:32:22] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:32:23,662 - handlers.webhook_handler - INFO - List reply received: id='soups & stews', title='Soups & Stews'
2025-06-12 18:32:23,663 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'soups & stews'}
2025-06-12 18:32:23,666 - handlers.base_handler - INFO - MenuHandler: Received message 'soups & stews' (original: 'soups & stews') in menu state for session 2347082345056
2025-06-12 18:32:23,667 - handlers.base_handler - INFO - Category 'Soups & Stews' selected for session 2347082345056
2025-06-12 18:32:23,667 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'list', 'body': {'text': '🍽️ *Soups & Stews*\n\nSelect an item to add to your cart:'}, 'action': {'button': 'Select Item', 'sections': [{'title': 'Soups & Stews Items', 'rows': [{'id': 'Egusi Soup', 'title': 'Egusi Soup (₦1,200)'}, {'id': 'Ogbono Soup with Uziza', 'title': 'Ogbono Soup wit (₦1,200)'}, {'id': 'Seafood Pepper Soup', 'title': 'Seafood Pepper (₦2,000)'}, {'id': 'Vegetable Soup (Edikang Ikong)', 'title': 'Vegetable Soup (₦1,500)'}, {'id': 'Bitterleaf Soup', 'title': 'Bitterleaf Soup (₦1,000)'}, {'id': 'Okra Soup with Spinach', 'title': 'Okra Soup with (₦1,300)'}, {'id': 'Afang Soup', 'title': 'Afang Soup (₦1,400)'}, {'id': 'Oha Soup', 'title': 'Oha Soup (₦1,300)'}, {'id': 'Nsala Soup (White Soup)', 'title': 'Nsala Soup (Whi (₦1,500)'}, {'id': 'Chicken Curry Stew', 'title': 'Chicken Curry S (₦1,400)'}]}]}}}
2025-06-12 18:32:24,140 - handlers.webhook_handler - INFO - List reply received: id='sides', title='Sides'
2025-06-12 18:32:24,140 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': 'sides'}
2025-06-12 18:32:24,143 - handlers.base_handler - INFO - MenuHandler: Received message 'sides' (original: 'sides') in menu state for session 2349030918492
2025-06-12 18:32:24,144 - handlers.base_handler - INFO - Category 'Sides' selected for session 2349030918492
2025-06-12 18:32:24,144 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'interactive', 'interactive': {'type': 'list', 'body': {'text': '🍽️ *Sides*\n\nSelect an item to add to your cart:'}, 'action': {'button': 'Select Item', 'sections': [{'title': 'Sides Items', 'rows': [{'id': 'Fried Plantain', 'title': 'Fried Plantain (₦500)'}, {'id': 'Yam Fries with Pepper Dip', 'title': 'Yam Fries with Pe (₦600)'}, {'id': 'Coleslaw', 'title': 'Coleslaw (₦400)'}, {'id': 'Moi Moi', 'title': 'Moi Moi (₦500)'}, {'id': 'Boiled Yam Slices', 'title': 'Boiled Yam Slices (₦400)'}, {'id': 'Vegetable Salad', 'title': 'Vegetable Salad (₦500)'}, {'id': 'Spicy Gizdodo', 'title': 'Spicy Gizdodo (₦700)'}, {'id': 'Jollof Beans', 'title': 'Jollof Beans (₦600)'}, {'id': 'Sweet Potato Wedges', 'title': 'Sweet Potato Wedg (₦500)'}, {'id': 'Garlic Bread Rolls', 'title': 'Garlic Bread Roll (₦400)'}]}]}}}
2025-06-12 18:32:24,573 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkYyM0E3NzY3RDVBRDc0RTZCQwA="}]}
2025-06-12 18:32:24,574 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkYyM0E3NzY3RDVBRDc0RTZCQwA='}]}
2025-06-12 18:32:24,574 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:32:24] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:32:24,818 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjY3MzU1QzkyNzMyMUMxRjIzOAA="}]}
2025-06-12 18:32:24,818 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjY3MzU1QzkyNzMyMUMxRjIzOAA='}]}
2025-06-12 18:32:24,819 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:32:24] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:32:25,583 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:32:25] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:32:25,728 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:32:25] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:32:25,946 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:32:25] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:32:25,955 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:32:25] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:32:25,997 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:32:25] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:32:29,691 - handlers.webhook_handler - INFO - List reply received: id='Boiled Yam Slices', title='Boiled Yam Slices (₦400)'
2025-06-12 18:32:29,692 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': 'Boiled Yam Slices'}
2025-06-12 18:32:29,695 - handlers.base_handler - INFO - MenuHandler: Handling item selection 'Boiled Yam Slices' for session 2349030918492
2025-06-12 18:32:29,696 - handlers.base_handler - INFO - Item 'Boiled Yam Slices' selected for session 2349030918492, redirecting to order handler
2025-06-12 18:32:29,696 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'text', 'text': {'body': '🛒 *Boiled Yam Slices*\nPrice: ₦400\n\nHow many would you like to order?\n\nPlease enter a number (e.g., 1, 2, 3...):'}}
2025-06-12 18:32:30,107 - handlers.webhook_handler - INFO - List reply received: id='Vegetable Soup (Edikang Ikong)', title='Vegetable Soup (₦1,500)'
2025-06-12 18:32:30,108 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'Vegetable Soup (Edikang Ikong)'}
2025-06-12 18:32:30,115 - handlers.base_handler - INFO - MenuHandler: Handling item selection 'Vegetable Soup (Edikang Ikong)' for session 2347082345056
2025-06-12 18:32:30,115 - handlers.base_handler - INFO - Item 'Vegetable Soup (Edikang Ikong)' selected for session 2347082345056, redirecting to order handler
2025-06-12 18:32:30,116 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'text', 'text': {'body': '🛒 *Vegetable Soup (Edikang Ikong)*\nPrice: ₦1,500\n\nHow many would you like to order?\n\nPlease enter a number (e.g., 1, 2, 3...):'}}
2025-06-12 18:32:30,592 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjIxNUFGNUU5NjBGMDcyRjcwOQA="}]}
2025-06-12 18:32:30,593 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjIxNUFGNUU5NjBGMDcyRjcwOQA='}]}
2025-06-12 18:32:30,593 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:32:30] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:32:30,891 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjM2NzVENkRGNkQxMDU2NkU2OAA="}]}
2025-06-12 18:32:30,891 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjM2NzVENkRGNkQxMDU2NkU2OAA='}]}
2025-06-12 18:32:30,892 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:32:30] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:32:31,244 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:32:31] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:32:31,696 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:32:31] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:32:31,825 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:32:31] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:32:32,262 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:32:32] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:32:32,363 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:32:32] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:32:34,876 - handlers.webhook_handler - INFO - Processing message from 2349030918492 (User: Benny): {'type': 'text', 'text': '4'}
2025-06-12 18:32:34,880 - handlers.order_handler - INFO - Item 'Boiled Yam Slices' added to cart for session 2349030918492. Cart: {'Boiled Yam Slices': {'item_id': 'Boiled Yam Slices', 'quantity': 4, 'price': 400.0, 'total_price': 1600.0, 'variations': {}}}
2025-06-12 18:32:34,883 - services.lead_tracker - INFO - Cart addition tracked for 2349030918492: ₦1,600.0 (1 items)
2025-06-12 18:32:34,884 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2349030918492 - ₦1,600.00
2025-06-12 18:32:34,884 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2349030918492', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🛒 *ORDER SUMMARY*\n\n📋 *Items Ordered:*\n• 4x Boiled Yam Slices - ₦1,600.00\n\n📍 *Delivery Details:*\n👤 Name: Benny\n📱 Phone: 2349030918492\n🏠 Address: None\n\n💰 *Total Amount: ₦1,600.00*\n\nPlease review your order and delivery details:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'confirm_order', 'title': '✅ Confirm Order'}}, {'type': 'reply', 'reply': {'id': 'modify_order', 'title': '✏️ Modify Order'}}, {'type': 'reply', 'reply': {'id': 'change_address', 'title': '📍 Change Address'}}]}}}
2025-06-12 18:32:35,672 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349030918492","wa_id":"2349030918492"}],"messages":[{"id":"wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjdDNDFBMUU5MzJFQUY4NzRFMAA="}]}
2025-06-12 18:32:35,677 - services.lead_tracker - INFO - Cart addition tracked for 2349030918492: ₦1,600.0 (1 items)
2025-06-12 18:32:35,677 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2349030918492 - ₦1,600.00
2025-06-12 18:32:35,677 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349030918492', 'wa_id': '2349030918492'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzMDkxODQ5MhUCABEYEjdDNDFBMUU5MzJFQUY4NzRFMAA='}]}
2025-06-12 18:32:35,678 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:32:35] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:32:36,263 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': '2'}
2025-06-12 18:32:36,267 - handlers.order_handler - INFO - Item 'Vegetable Soup (Edikang Ikong)' added to cart for session 2347082345056. Cart: {'Vegetable Soup (Edikang Ikong)': {'item_id': 'Vegetable Soup (Edikang Ikong)', 'quantity': 2, 'price': 1500.0, 'total_price': 3000.0, 'variations': {}}}
2025-06-12 18:32:36,271 - services.lead_tracker - INFO - Cart addition tracked for 2347082345056: ₦3,000.0 (1 items)
2025-06-12 18:32:36,271 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2347082345056 - ₦3,000.00
2025-06-12 18:32:36,272 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🛒 *ORDER SUMMARY*\n\n📋 *Items Ordered:*\n• 2x Vegetable Soup (Edikang Ikong) - ₦3,000.00\n\n📍 *Delivery Details:*\n👤 Name: Olumayowa Oyaleke\n📱 Phone: 2347082345056\n🏠 Address: None\n\n💰 *Total Amount: ₦3,000.00*\n\nPlease review your order and delivery details:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'confirm_order', 'title': '✅ Confirm Order'}}, {'type': 'reply', 'reply': {'id': 'modify_order', 'title': '✏️ Modify Order'}}, {'type': 'reply', 'reply': {'id': 'change_address', 'title': '📍 Change Address'}}]}}}
2025-06-12 18:32:36,336 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:32:36] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:32:36,765 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:32:36] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:32:37,052 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjBBODcyNjI5NUEwMjIzNkRCNQA="}]}
2025-06-12 18:32:37,056 - services.lead_tracker - INFO - Cart addition tracked for 2347082345056: ₦3,000.0 (1 items)
2025-06-12 18:32:37,056 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2347082345056 - ₦3,000.00
2025-06-12 18:32:37,056 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjBBODcyNjI5NUEwMjIzNkRCNQA='}]}
2025-06-12 18:32:37,057 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:32:37] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:32:37,824 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:32:37] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:32:38,276 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:32:38] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:32:38,334 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:32:38] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:33:20,375 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-ORDER-20250612183218-4853
2025-06-12 18:33:21,007 - services.payment_service - WARNING - Payment not successful for reference PAY-ORDER-20250612183218-4853. Paystack status: abandoned. Response: {'status': True, 'message': 'Verification successful', 'data': {'id': 5051430813, 'domain': 'test', 'status': 'abandoned', 'reference': 'PAY-ORDER-20250612183218-4853', 'receipt_number': None, 'amount': 140000, 'message': None, 'gateway_response': 'The transaction was not completed', 'paid_at': None, 'created_at': '2025-06-12T17:32:19.000Z', 'channel': 'card', 'currency': 'NGN', 'ip_address': '197.211.59.126, 172.71.250.161, 172.31.62.52', 'metadata': {'customer_name': 'Ziga', 'customer_phone': '2348055614455', 'first_name': 'Ziga', 'last_name': 'Ziga', 'order_id': 'ORDER-20250612183218-4853', 'delivery_address': 'Howson Wright'}, 'log': None, 'fees': None, 'fees_split': None, 'authorization': {}, 'customer': {'id': 276711440, 'first_name': None, 'last_name': None, 'email': 'ziga4455@foodorder.com', 'customer_code': 'CUS_bhkdpnbvcjqt55g', 'phone': None, 'metadata': None, 'risk_action': 'default', 'international_format_phone': None}, 'plan': None, 'split': {}, 'order_id': None, 'paidAt': None, 'createdAt': '2025-06-12T17:32:19.000Z', 'requested_amount': 140000, 'pos_transaction_data': None, 'source': None, 'fees_breakdown': None, 'connect': None, 'transaction_date': '2025-06-12T17:32:19.000Z', 'plan_object': {}, 'subaccount': {}}}
2025-06-12 18:33:21,010 - handlers.base_handler - INFO - Payment not yet verified for order ORDER-20250612183218-4853, attempt 2/15
2025-06-12 18:34:21,023 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-ORDER-20250612183218-4853
2025-06-12 18:34:21,675 - services.payment_service - WARNING - Payment not successful for reference PAY-ORDER-20250612183218-4853. Paystack status: abandoned. Response: {'status': True, 'message': 'Verification successful', 'data': {'id': 5051430813, 'domain': 'test', 'status': 'abandoned', 'reference': 'PAY-ORDER-20250612183218-4853', 'receipt_number': None, 'amount': 140000, 'message': None, 'gateway_response': 'The transaction was not completed', 'paid_at': None, 'created_at': '2025-06-12T17:32:19.000Z', 'channel': 'card', 'currency': 'NGN', 'ip_address': '197.211.59.126, 172.71.250.161, 172.31.62.52', 'metadata': {'customer_name': 'Ziga', 'customer_phone': '2348055614455', 'first_name': 'Ziga', 'last_name': 'Ziga', 'order_id': 'ORDER-20250612183218-4853', 'delivery_address': 'Howson Wright'}, 'log': None, 'fees': None, 'fees_split': None, 'authorization': {}, 'customer': {'id': 276711440, 'first_name': None, 'last_name': None, 'email': 'ziga4455@foodorder.com', 'customer_code': 'CUS_bhkdpnbvcjqt55g', 'phone': None, 'metadata': None, 'risk_action': 'default', 'international_format_phone': None}, 'plan': None, 'split': {}, 'order_id': None, 'paidAt': None, 'createdAt': '2025-06-12T17:32:19.000Z', 'requested_amount': 140000, 'pos_transaction_data': None, 'source': None, 'fees_breakdown': None, 'connect': None, 'transaction_date': '2025-06-12T17:32:19.000Z', 'plan_object': {}, 'subaccount': {}}}
2025-06-12 18:34:21,676 - handlers.base_handler - INFO - Payment not yet verified for order ORDER-20250612183218-4853, attempt 3/15
2025-06-12 18:35:21,689 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-ORDER-20250612183218-4853
2025-06-12 18:35:22,389 - services.payment_service - WARNING - Payment not successful for reference PAY-ORDER-20250612183218-4853. Paystack status: abandoned. Response: {'status': True, 'message': 'Verification successful', 'data': {'id': 5051430813, 'domain': 'test', 'status': 'abandoned', 'reference': 'PAY-ORDER-20250612183218-4853', 'receipt_number': None, 'amount': 140000, 'message': None, 'gateway_response': 'The transaction was not completed', 'paid_at': None, 'created_at': '2025-06-12T17:32:19.000Z', 'channel': 'card', 'currency': 'NGN', 'ip_address': '197.211.59.126, 172.71.250.161, 172.31.62.52', 'metadata': {'customer_name': 'Ziga', 'customer_phone': '2348055614455', 'first_name': 'Ziga', 'last_name': 'Ziga', 'order_id': 'ORDER-20250612183218-4853', 'delivery_address': 'Howson Wright'}, 'log': None, 'fees': None, 'fees_split': None, 'authorization': {}, 'customer': {'id': 276711440, 'first_name': None, 'last_name': None, 'email': 'ziga4455@foodorder.com', 'customer_code': 'CUS_bhkdpnbvcjqt55g', 'phone': None, 'metadata': None, 'risk_action': 'default', 'international_format_phone': None}, 'plan': None, 'split': {}, 'order_id': None, 'paidAt': None, 'createdAt': '2025-06-12T17:32:19.000Z', 'requested_amount': 140000, 'pos_transaction_data': None, 'source': None, 'fees_breakdown': None, 'connect': None, 'transaction_date': '2025-06-12T17:32:19.000Z', 'plan_object': {}, 'subaccount': {}}}
2025-06-12 18:35:22,389 - handlers.base_handler - INFO - Payment not yet verified for order ORDER-20250612183218-4853, attempt 4/15
2025-06-12 18:36:22,396 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-ORDER-20250612183218-4853
2025-06-12 18:36:23,066 - services.payment_service - WARNING - Payment not successful for reference PAY-ORDER-20250612183218-4853. Paystack status: abandoned. Response: {'status': True, 'message': 'Verification successful', 'data': {'id': 5051430813, 'domain': 'test', 'status': 'abandoned', 'reference': 'PAY-ORDER-20250612183218-4853', 'receipt_number': None, 'amount': 140000, 'message': None, 'gateway_response': 'The transaction was not completed', 'paid_at': None, 'created_at': '2025-06-12T17:32:19.000Z', 'channel': 'card', 'currency': 'NGN', 'ip_address': '197.211.59.126, 172.71.250.161, 172.31.62.52', 'metadata': {'customer_name': 'Ziga', 'customer_phone': '2348055614455', 'first_name': 'Ziga', 'last_name': 'Ziga', 'order_id': 'ORDER-20250612183218-4853', 'delivery_address': 'Howson Wright'}, 'log': None, 'fees': None, 'fees_split': None, 'authorization': {}, 'customer': {'id': 276711440, 'first_name': None, 'last_name': None, 'email': 'ziga4455@foodorder.com', 'customer_code': 'CUS_bhkdpnbvcjqt55g', 'phone': None, 'metadata': None, 'risk_action': 'default', 'international_format_phone': None}, 'plan': None, 'split': {}, 'order_id': None, 'paidAt': None, 'createdAt': '2025-06-12T17:32:19.000Z', 'requested_amount': 140000, 'pos_transaction_data': None, 'source': None, 'fees_breakdown': None, 'connect': None, 'transaction_date': '2025-06-12T17:32:19.000Z', 'plan_object': {}, 'subaccount': {}}}
2025-06-12 18:36:23,067 - handlers.base_handler - INFO - Payment not yet verified for order ORDER-20250612183218-4853, attempt 5/15
2025-06-12 18:36:23,069 - services.payment_service - INFO - Attempting to create payment link for reference: PAY-ORDER-20250612183218-4853 with amount: 140000, email: ziga4455@foodorder.com
2025-06-12 18:36:23,926 - services.payment_service - ERROR - HTTP error creating Paystack payment link for PAY-ORDER-20250612183218-4853: 400 Client Error: Bad Request for url: https://api.paystack.co/transaction/initialize. Response: {"status":false,"message":"Duplicate Transaction Reference","meta":{"nextStep":"Try and create the Transaction or Charge with a new reference"},"type":"validation_error","code":"duplicate_reference"}
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\app\services\payment_service.py", line 79, in create_payment_link
    response.raise_for_status() # Raise HTTPError for bad responses (4xx or 5xx)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\zigam\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://api.paystack.co/transaction/initialize
2025-06-12 18:36:23,939 - handlers.base_handler - WARNING - Could not generate new payment link for reminder for order ORDER-20250612183218-4853.
2025-06-12 18:37:23,941 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-ORDER-20250612183218-4853
2025-06-12 18:37:25,321 - services.payment_service - WARNING - Payment not successful for reference PAY-ORDER-20250612183218-4853. Paystack status: abandoned. Response: {'status': True, 'message': 'Verification successful', 'data': {'id': 5051430813, 'domain': 'test', 'status': 'abandoned', 'reference': 'PAY-ORDER-20250612183218-4853', 'receipt_number': None, 'amount': 140000, 'message': None, 'gateway_response': 'The transaction was not completed', 'paid_at': None, 'created_at': '2025-06-12T17:32:19.000Z', 'channel': 'card', 'currency': 'NGN', 'ip_address': '197.211.59.126, 172.71.250.161, 172.31.62.52', 'metadata': {'customer_name': 'Ziga', 'customer_phone': '2348055614455', 'first_name': 'Ziga', 'last_name': 'Ziga', 'order_id': 'ORDER-20250612183218-4853', 'delivery_address': 'Howson Wright'}, 'log': None, 'fees': None, 'fees_split': None, 'authorization': {}, 'customer': {'id': 276711440, 'first_name': None, 'last_name': None, 'email': 'ziga4455@foodorder.com', 'customer_code': 'CUS_bhkdpnbvcjqt55g', 'phone': None, 'metadata': None, 'risk_action': 'default', 'international_format_phone': None}, 'plan': None, 'split': {}, 'order_id': None, 'paidAt': None, 'createdAt': '2025-06-12T17:32:19.000Z', 'requested_amount': 140000, 'pos_transaction_data': None, 'source': None, 'fees_breakdown': None, 'connect': None, 'transaction_date': '2025-06-12T17:32:19.000Z', 'plan_object': {}, 'subaccount': {}}}
2025-06-12 18:37:25,321 - handlers.base_handler - INFO - Payment not yet verified for order ORDER-20250612183218-4853, attempt 6/15
2025-06-12 18:38:25,322 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-ORDER-20250612183218-4853
2025-06-12 18:38:26,001 - services.payment_service - WARNING - Payment not successful for reference PAY-ORDER-20250612183218-4853. Paystack status: abandoned. Response: {'status': True, 'message': 'Verification successful', 'data': {'id': 5051430813, 'domain': 'test', 'status': 'abandoned', 'reference': 'PAY-ORDER-20250612183218-4853', 'receipt_number': None, 'amount': 140000, 'message': None, 'gateway_response': 'The transaction was not completed', 'paid_at': None, 'created_at': '2025-06-12T17:32:19.000Z', 'channel': 'card', 'currency': 'NGN', 'ip_address': '197.211.59.126, 172.71.250.161, 172.31.62.52', 'metadata': {'customer_name': 'Ziga', 'customer_phone': '2348055614455', 'first_name': 'Ziga', 'last_name': 'Ziga', 'order_id': 'ORDER-20250612183218-4853', 'delivery_address': 'Howson Wright'}, 'log': None, 'fees': None, 'fees_split': None, 'authorization': {}, 'customer': {'id': 276711440, 'first_name': None, 'last_name': None, 'email': 'ziga4455@foodorder.com', 'customer_code': 'CUS_bhkdpnbvcjqt55g', 'phone': None, 'metadata': None, 'risk_action': 'default', 'international_format_phone': None}, 'plan': None, 'split': {}, 'order_id': None, 'paidAt': None, 'createdAt': '2025-06-12T17:32:19.000Z', 'requested_amount': 140000, 'pos_transaction_data': None, 'source': None, 'fees_breakdown': None, 'connect': None, 'transaction_date': '2025-06-12T17:32:19.000Z', 'plan_object': {}, 'subaccount': {}}}
2025-06-12 18:38:26,002 - handlers.base_handler - INFO - Payment not yet verified for order ORDER-20250612183218-4853, attempt 7/15
2025-06-12 18:39:26,006 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-ORDER-20250612183218-4853
2025-06-12 18:39:26,645 - services.payment_service - WARNING - Payment not successful for reference PAY-ORDER-20250612183218-4853. Paystack status: abandoned. Response: {'status': True, 'message': 'Verification successful', 'data': {'id': 5051430813, 'domain': 'test', 'status': 'abandoned', 'reference': 'PAY-ORDER-20250612183218-4853', 'receipt_number': None, 'amount': 140000, 'message': None, 'gateway_response': 'The transaction was not completed', 'paid_at': None, 'created_at': '2025-06-12T17:32:19.000Z', 'channel': 'card', 'currency': 'NGN', 'ip_address': '197.211.59.126, 172.71.250.161, 172.31.62.52', 'metadata': {'customer_name': 'Ziga', 'customer_phone': '2348055614455', 'first_name': 'Ziga', 'last_name': 'Ziga', 'order_id': 'ORDER-20250612183218-4853', 'delivery_address': 'Howson Wright'}, 'log': None, 'fees': None, 'fees_split': None, 'authorization': {}, 'customer': {'id': 276711440, 'first_name': None, 'last_name': None, 'email': 'ziga4455@foodorder.com', 'customer_code': 'CUS_bhkdpnbvcjqt55g', 'phone': None, 'metadata': None, 'risk_action': 'default', 'international_format_phone': None}, 'plan': None, 'split': {}, 'order_id': None, 'paidAt': None, 'createdAt': '2025-06-12T17:32:19.000Z', 'requested_amount': 140000, 'pos_transaction_data': None, 'source': None, 'fees_breakdown': None, 'connect': None, 'transaction_date': '2025-06-12T17:32:19.000Z', 'plan_object': {}, 'subaccount': {}}}
2025-06-12 18:39:26,646 - handlers.base_handler - INFO - Payment not yet verified for order ORDER-20250612183218-4853, attempt 8/15
2025-06-12 18:40:26,652 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-ORDER-20250612183218-4853
2025-06-12 18:40:27,371 - services.payment_service - WARNING - Payment not successful for reference PAY-ORDER-20250612183218-4853. Paystack status: abandoned. Response: {'status': True, 'message': 'Verification successful', 'data': {'id': 5051430813, 'domain': 'test', 'status': 'abandoned', 'reference': 'PAY-ORDER-20250612183218-4853', 'receipt_number': None, 'amount': 140000, 'message': None, 'gateway_response': 'The transaction was not completed', 'paid_at': None, 'created_at': '2025-06-12T17:32:19.000Z', 'channel': 'card', 'currency': 'NGN', 'ip_address': '197.211.59.126, 172.71.250.161, 172.31.62.52', 'metadata': {'customer_name': 'Ziga', 'customer_phone': '2348055614455', 'first_name': 'Ziga', 'last_name': 'Ziga', 'order_id': 'ORDER-20250612183218-4853', 'delivery_address': 'Howson Wright'}, 'log': None, 'fees': None, 'fees_split': None, 'authorization': {}, 'customer': {'id': 276711440, 'first_name': None, 'last_name': None, 'email': 'ziga4455@foodorder.com', 'customer_code': 'CUS_bhkdpnbvcjqt55g', 'phone': None, 'metadata': None, 'risk_action': 'default', 'international_format_phone': None}, 'plan': None, 'split': {}, 'order_id': None, 'paidAt': None, 'createdAt': '2025-06-12T17:32:19.000Z', 'requested_amount': 140000, 'pos_transaction_data': None, 'source': None, 'fees_breakdown': None, 'connect': None, 'transaction_date': '2025-06-12T17:32:19.000Z', 'plan_object': {}, 'subaccount': {}}}
2025-06-12 18:40:27,372 - handlers.base_handler - INFO - Payment not yet verified for order ORDER-20250612183218-4853, attempt 9/15
2025-06-12 18:48:22,099 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-12 18:48:22,099 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-12 18:48:22,100 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-12 18:48:22,100 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-12 18:48:22,100 - services.payment_service - INFO - PaymentService initialized
2025-06-12 18:48:22,101 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-12 18:48:22,101 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-12 18:48:22,101 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-12 18:48:22,102 - services.payment_service - INFO - PaymentService initialized
2025-06-12 18:48:22,102 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-12 18:48:22,102 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-12 18:48:22,102 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-12 18:48:22,103 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-12 18:48:22,103 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-12 18:48:22,103 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-12 18:48:22,513 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-12 18:48:22,514 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-12 18:48:22,514 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-12 18:48:22,514 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-12 18:48:22,532 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-12 18:48:22,533 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-12 18:48:42,696 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-12 18:48:42,697 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-12 18:48:42,697 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-12 18:48:42,698 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-12 18:48:42,698 - services.payment_service - INFO - PaymentService initialized
2025-06-12 18:48:42,698 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-12 18:48:42,699 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-12 18:48:42,699 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-12 18:48:42,700 - services.payment_service - INFO - PaymentService initialized
2025-06-12 18:48:42,700 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-12 18:48:42,700 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-12 18:48:42,701 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-12 18:48:42,701 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-12 18:48:42,701 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-12 18:48:42,702 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-12 18:48:43,074 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-12 18:48:43,074 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-12 18:48:43,075 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-12 18:48:43,075 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-12 18:48:43,088 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-12 18:48:43,089 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-12 18:48:47,057 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-12 18:48:47,057 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-12 18:48:47,061 - handlers.base_handler - INFO - Session 2348055614455 initialized with greeting state for user 'Ziga'.
2025-06-12 18:48:47,061 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Ziga! 👋\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-12 18:48:48,066 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjlENkQ2NzZFMjRBQTFBRjUzMAA="}]}
2025-06-12 18:48:48,067 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjlENkQ2NzZFMjRBQTFBRjUzMAA='}]}
2025-06-12 18:48:48,068 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:48:48] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:48:49,085 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:48:49] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:48:49,252 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:48:49] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:48:49,424 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:48:49] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:48:52,075 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-12 18:48:52,077 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-06-12 18:48:52,077 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-06-12 18:48:52,078 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-06-12 18:48:52,078 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-06-12 18:48:52,078 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Just send me your full order in one message! \n\nLike this: 'Two plates of jollof rice, 2 Cokes, and asun.'\n\nWant to go back again? Type 'menu' to return. "}}
2025-06-12 18:48:53,180 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkMyMEI2OERBQTNFNjc2MjQwRAA="}]}
2025-06-12 18:48:53,180 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkMyMEI2OERBQTNFNjc2MjQwRAA='}]}
2025-06-12 18:48:53,181 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:48:53] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:48:54,251 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:48:54] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:48:54,445 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:48:54] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:48:54,864 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:48:54] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:49:02,029 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': '2 jellof rice'}
2025-06-12 18:49:02,031 - handlers.base_handler - INFO - AIHandler: Handling message '2 jellof rice' in AI bulk order state for session 2348055614455. Original: '2 jellof rice'
2025-06-12 18:49:04,445 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-12 18:49:04,448 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🛒 *Order Summary:*\n\n✅ 2x Smoky Jollof Fiesta - ₦3,000\n\n*Total: ₦3,000.00*\n\nWould you like to proceed with this order?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'confirm_ai_order', 'title': '✅ Confirm Order'}}, {'type': 'reply', 'reply': {'id': 'modify_ai_order', 'title': '✏️ Modify Order'}}, {'type': 'reply', 'reply': {'id': 'cancel_ai_order', 'title': '❌ Cancel'}}]}}}
2025-06-12 18:49:05,173 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjBCNTIxMDM0QTBBQTQxOUREOQA="}]}
2025-06-12 18:49:05,174 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjBCNTIxMDM0QTBBQTQxOUREOQA='}]}
2025-06-12 18:49:05,174 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:49:05] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:49:06,137 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:49:06] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:49:06,325 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:49:06] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:49:06,761 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:49:06] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:55:05,776 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-12 18:55:05,776 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-12 18:55:05,777 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-12 18:55:05,777 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-12 18:55:05,777 - services.payment_service - INFO - PaymentService initialized
2025-06-12 18:55:05,778 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-12 18:55:05,778 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-12 18:55:05,779 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-12 18:55:05,779 - services.payment_service - INFO - PaymentService initialized
2025-06-12 18:55:05,779 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-12 18:55:05,779 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-12 18:55:05,780 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-12 18:55:05,781 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-12 18:55:05,781 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-12 18:55:05,781 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-12 18:55:06,175 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-12 18:55:06,176 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-12 18:55:06,176 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-12 18:55:06,177 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-12 18:55:06,190 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-12 18:55:06,190 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-12 18:55:15,224 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-12 18:55:15,224 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-12 18:55:15,228 - handlers.base_handler - INFO - Session 2348055614455 initialized with greeting state for user 'Ziga'.
2025-06-12 18:55:15,229 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Ziga! 👋\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-12 18:55:15,984 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkNDRDZCQzIyMDIxNzVFRDU0RgA="}]}
2025-06-12 18:55:15,985 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkNDRDZCQzIyMDIxNzVFRDU0RgA='}]}
2025-06-12 18:55:15,985 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:55:15] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:55:16,813 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:55:16] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:55:17,320 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:55:17] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:55:18,389 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-12 18:55:18,391 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-06-12 18:55:18,392 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-06-12 18:55:18,392 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-06-12 18:55:18,393 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-06-12 18:55:18,393 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Just send me your full order in one message! \n\nLike this: 'Two plates of jollof rice, 2 Cokes, and asun.'\n\nWant to go back again? Type 'menu' to return. "}}
2025-06-12 18:55:19,131 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkNCQ0U0MUY4RUI3MTcxNTg0NQA="}]}
2025-06-12 18:55:19,131 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkNCQ0U0MUY4RUI3MTcxNTg0NQA='}]}
2025-06-12 18:55:19,132 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:55:19] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:55:20,090 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:55:20] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:55:20,233 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:55:20] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:55:20,318 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:55:20] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:55:24,347 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': '2 cokes'}
2025-06-12 18:55:24,350 - handlers.base_handler - INFO - AIHandler: Handling message '2 cokes' in AI bulk order state for session 2348055614455. Original: '2 cokes'
2025-06-12 18:55:27,068 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-12 18:55:27,070 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🛒 *Order Summary:*\n\n✅ 2x Coca-Cola - ₦500\n\n*Total: ₦500.00*\n\nWould you like to proceed with this order?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'confirm_ai_order', 'title': '✅ Confirm Order'}}, {'type': 'reply', 'reply': {'id': 'modify_ai_order', 'title': '✏️ Modify Order'}}, {'type': 'reply', 'reply': {'id': 'cancel_ai_order', 'title': '❌ Cancel'}}]}}}
2025-06-12 18:55:27,821 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjYwN0JENEJCNjVGRTQ1RDhDRgA="}]}
2025-06-12 18:55:27,822 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjYwN0JENEJCNjVGRTQ1RDhDRgA='}]}
2025-06-12 18:55:27,822 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:55:27] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:55:28,479 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:55:28] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:55:28,991 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:55:28] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:55:29,161 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:55:29] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:58:49,161 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-12 18:58:49,161 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-12 18:58:49,162 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-12 18:58:49,162 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-12 18:58:49,162 - services.payment_service - INFO - PaymentService initialized
2025-06-12 18:58:49,163 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-12 18:58:49,163 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-12 18:58:49,164 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-12 18:58:49,164 - services.payment_service - INFO - PaymentService initialized
2025-06-12 18:58:49,164 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-12 18:58:49,165 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-12 18:58:49,165 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-12 18:58:49,166 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-12 18:58:49,166 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-12 18:58:49,166 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-12 18:58:49,522 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-12 18:58:49,522 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-12 18:58:49,523 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-12 18:58:49,523 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-12 18:58:49,537 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-12 18:58:49,538 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-12 18:58:56,358 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-12 18:58:56,358 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-12 18:58:56,362 - handlers.base_handler - INFO - Session 2348055614455 initialized with greeting state for user 'Ziga'.
2025-06-12 18:58:56,363 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Ziga! 👋\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-12 18:58:57,273 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjJDNzMyN0UxMzBFRkRFQjJFRAA="}]}
2025-06-12 18:58:57,273 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjJDNzMyN0UxMzBFRkRFQjJFRAA='}]}
2025-06-12 18:58:57,274 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:58:57] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:58:57,943 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:58:57] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:58:58,565 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:58:58] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:58:59,184 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-12 18:58:59,186 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-06-12 18:58:59,186 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-06-12 18:58:59,186 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-06-12 18:58:59,187 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-06-12 18:58:59,187 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Just send me your full order in one message! \n\nLike this: 'Two plates of jollof rice, 2 Cokes, and asun.'\n\nWant to go back again? Type 'menu' to return. "}}
2025-06-12 18:58:59,940 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjBBMTcxREUyQzk1OTc4RTc1QQA="}]}
2025-06-12 18:58:59,941 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjBBMTcxREUyQzk1OTc4RTc1QQA='}]}
2025-06-12 18:58:59,941 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:58:59] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:59:00,933 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:59:00] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:59:01,075 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:59:01] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:59:01,077 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:59:01] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:59:04,333 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': '2 cokes'}
2025-06-12 18:59:04,335 - handlers.base_handler - INFO - AIHandler: Handling message '2 cokes' in AI bulk order state for session 2348055614455. Original: '2 cokes'
2025-06-12 18:59:06,714 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-12 18:59:06,717 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🛒 *Order Summary:*\n\n✅ 2x Coca-Cola - ₦500\n\n*Total: ₦500.00*\n\n🚚 *Delivery Address:*\nNot provided (Please update your profile or specify!)\n\nDoes everything look correct?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'confirm_ai_order', 'title': '✅ Confirm Order'}}, {'type': 'reply', 'reply': {'id': 'modify_ai_order', 'title': '✏️ Modify Order'}}, {'type': 'reply', 'reply': {'id': 'change_delivery_address', 'title': '🏠 Change Address'}}]}}}
2025-06-12 18:59:07,411 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkYxNjRDREI1MjUzMjAxOUJGMQA="}]}
2025-06-12 18:59:07,411 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkYxNjRDREI1MjUzMjAxOUJGMQA='}]}
2025-06-12 18:59:07,412 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:59:07] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:59:08,111 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:59:08] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:59:08,274 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:59:08] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:59:08,424 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:59:08] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:59:13,906 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'change_delivery_address'}
2025-06-12 18:59:13,909 - handlers.message_processor - WARNING - Unhandled AI state 'ai_final_confirmation' for session 2348055614455. Resetting to AI menu.
2025-06-12 18:59:13,909 - handlers.base_handler - INFO - AIHandler: Handling message 'initial_entry' in AI menu state for session 2348055614455. Original: 'change_delivery_address'
2025-06-12 18:59:13,910 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🤖 *AI Assistant Options*\n\n🤖 *Lola Chatbot* - Chat with our AI assistant\n🛒 *AI Bulk Order* - Order multiple items at once\n\nPlease select an AI option:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'lola_chatbot', 'title': '🤖 Lola Chatbot'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order', 'title': '🛒 AI Bulk Order'}}, {'type': 'reply', 'reply': {'id': 'back_to_main', 'title': '🔙 Back to Main'}}]}}}
2025-06-12 18:59:14,633 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkI4NTY4RTRCMUQ4MzFEQjAyMwA="}]}
2025-06-12 18:59:14,634 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkI4NTY4RTRCMUQ4MzFEQjAyMwA='}]}
2025-06-12 18:59:14,635 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:59:14] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:59:15,315 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:59:15] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:59:15,735 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:59:15] "POST /webhook HTTP/1.1" 200 -
2025-06-12 18:59:15,868 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 18:59:15] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:00:00,532 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'back_to_main'}
2025-06-12 19:00:00,534 - handlers.base_handler - INFO - AIHandler: Handling message 'back_to_main' in AI menu state for session 2348055614455. Original: 'back_to_main'
2025-06-12 19:00:00,534 - handlers.base_handler - INFO - Session 2348055614455 returned to main menu (greeting state).
2025-06-12 19:00:00,535 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Ziga! 👋\n\nWelcome back! How can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-12 19:00:01,262 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkM5RURCODc0Q0VDNEVBMzY3NQA="}]}
2025-06-12 19:00:01,263 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkM5RURCODc0Q0VDNEVBMzY3NQA='}]}
2025-06-12 19:00:01,264 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:00:01] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:00:02,029 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:00:02] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:00:02,577 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:00:02] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:01:13,713 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-12 19:01:13,713 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-12 19:01:13,714 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-12 19:01:13,714 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-12 19:01:13,715 - services.payment_service - INFO - PaymentService initialized
2025-06-12 19:01:13,715 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-12 19:01:13,715 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-12 19:01:13,716 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-12 19:01:13,716 - services.payment_service - INFO - PaymentService initialized
2025-06-12 19:01:13,716 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-12 19:01:13,716 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-12 19:01:13,717 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-12 19:01:13,717 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-12 19:01:13,717 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-12 19:01:13,717 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-12 19:01:14,095 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-12 19:01:14,095 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-12 19:01:14,096 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-12 19:01:14,096 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-12 19:01:14,113 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-12 19:01:14,113 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-12 19:01:18,774 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-12 19:01:18,775 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-12 19:01:18,780 - handlers.base_handler - INFO - Session 2348055614455 initialized with greeting state for user 'Ziga'.
2025-06-12 19:01:18,780 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Ziga! 👋\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-12 19:01:19,566 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkQwQzA0OTg5MUUxQzhBNTRENQA="}]}
2025-06-12 19:01:19,566 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkQwQzA0OTg5MUUxQzhBNTRENQA='}]}
2025-06-12 19:01:19,567 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:01:19] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:01:20,416 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:01:20] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:01:20,648 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:01:20] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:01:22,333 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-12 19:01:22,335 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-06-12 19:01:22,336 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-06-12 19:01:22,336 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-06-12 19:01:22,336 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-06-12 19:01:24,667 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-12 19:01:24,669 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "❌ No items recognized in the order\n\nPlease try rephrasing your order or type 'menu' to return to main menu."}}
2025-06-12 19:01:25,486 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjNFNkUyNjQ1Q0I4MDBENjk3NwA="}]}
2025-06-12 19:01:25,486 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjNFNkUyNjQ1Q0I4MDBENjk3NwA='}]}
2025-06-12 19:01:25,487 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:01:25] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:01:26,101 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:01:26] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:01:26,593 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:01:26] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:01:26,732 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:01:26] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:04:29,170 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-12 19:04:29,171 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-12 19:04:29,171 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-12 19:04:29,172 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-12 19:04:29,172 - services.payment_service - INFO - PaymentService initialized
2025-06-12 19:04:29,172 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-12 19:04:29,173 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-12 19:04:29,173 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-12 19:04:29,173 - services.payment_service - INFO - PaymentService initialized
2025-06-12 19:04:29,173 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-12 19:04:29,174 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-12 19:04:29,174 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-12 19:04:29,174 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-12 19:04:29,175 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-12 19:04:29,175 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-12 19:04:29,629 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-12 19:04:29,629 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-12 19:04:29,630 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-12 19:04:29,630 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-12 19:04:29,650 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-12 19:04:29,650 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-12 19:04:37,419 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-12 19:04:37,420 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-12 19:04:37,424 - handlers.base_handler - INFO - Session 2348055614455 initialized with greeting state for user 'Ziga'.
2025-06-12 19:04:37,425 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Ziga! 👋\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-12 19:04:38,264 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjZCQTVEMzA4NjU0QjAxNjk2RAA="}]}
2025-06-12 19:04:38,265 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjZCQTVEMzA4NjU0QjAxNjk2RAA='}]}
2025-06-12 19:04:38,265 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:04:38] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:04:39,039 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:04:39] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:04:39,237 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:04:39] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:04:40,909 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-12 19:04:40,911 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-06-12 19:04:40,912 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-06-12 19:04:40,912 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-06-12 19:04:40,912 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-06-12 19:04:43,978 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-12 19:04:43,980 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "❌ None\n\nPlease try rephrasing your order or type 'menu' to return to main menu."}}
2025-06-12 19:04:44,682 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkIwNDIzQTM1Mjk1NjA1MTQ1NAA="}]}
2025-06-12 19:04:44,683 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkIwNDIzQTM1Mjk1NjA1MTQ1NAA='}]}
2025-06-12 19:04:44,683 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:04:44] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:04:45,391 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:04:45] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:04:45,660 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:04:45] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:04:45,768 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:04:45] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:05:10,126 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-12 19:05:10,126 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-12 19:05:10,127 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-12 19:05:10,128 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-12 19:05:10,128 - services.payment_service - INFO - PaymentService initialized
2025-06-12 19:05:10,128 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-12 19:05:10,129 - utils.data_manager - INFO - Successfully loaded user details from data\user_details.json
2025-06-12 19:05:10,129 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-12 19:05:10,130 - services.payment_service - INFO - PaymentService initialized
2025-06-12 19:05:10,130 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-12 19:05:10,130 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-12 19:05:10,131 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-12 19:05:10,131 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-12 19:05:10,132 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-12 19:05:10,132 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-12 19:05:10,634 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-12 19:05:10,635 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-12 19:05:10,635 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-12 19:05:10,635 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-12 19:05:10,651 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-12 19:05:10,652 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-12 19:05:13,567 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-12 19:05:13,567 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-12 19:05:13,571 - handlers.base_handler - INFO - Session 2348055614455 initialized with greeting state for user 'Ziga'.
2025-06-12 19:05:13,572 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Ziga! 👋\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-12 19:05:14,360 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjYzNTQwOUY0NTRCRkU3RUVBRQA="}]}
2025-06-12 19:05:14,361 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjYzNTQwOUY0NTRCRkU3RUVBRQA='}]}
2025-06-12 19:05:14,362 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:05:14] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:05:15,004 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:05:15] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:05:15,288 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:05:15] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:05:16,672 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-12 19:05:16,676 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-06-12 19:05:16,676 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-06-12 19:05:16,677 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-06-12 19:05:16,677 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-06-12 19:05:16,677 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Just send me your full order in one message! \n\nLike this: 'Two plates of jollof rice, 2 Cokes, and asun.'\n\nWant to go back again? Type ‘menu’ to return. "}}
2025-06-12 19:05:17,445 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjc5QTMyRUNBNUEwM0U0MUJCOAA="}]}
2025-06-12 19:05:17,446 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjc5QTMyRUNBNUEwM0U0MUJCOAA='}]}
2025-06-12 19:05:17,447 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:05:17] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:05:18,166 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:05:18] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:05:18,359 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:05:18] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:05:18,634 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:05:18] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:05:22,627 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': '3 cokes'}
2025-06-12 19:05:22,630 - handlers.base_handler - INFO - AIHandler: Handling message '3 cokes' in AI bulk order state for session 2348055614455. Original: '3 cokes'
2025-06-12 19:05:24,933 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-12 19:05:24,935 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🛒 *Order Summary:*\n\n✅ 3x Coca-Cola - ₦750\n\n*Total: ₦750.00*\n\nWould you like to proceed with this order?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'confirm_ai_order', 'title': '✅ Confirm Order'}}, {'type': 'reply', 'reply': {'id': 'modify_ai_order', 'title': '✏️ Modify Order'}}, {'type': 'reply', 'reply': {'id': 'cancel_ai_order', 'title': '❌ Cancel'}}]}}}
2025-06-12 19:05:25,690 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjc1QjJCOUI2OTc3MjQ2N0REMgA="}]}
2025-06-12 19:05:25,690 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjc1QjJCOUI2OTc3MjQ2N0REMgA='}]}
2025-06-12 19:05:25,691 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:05:25] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:05:26,467 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:05:26] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:05:26,597 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:05:26] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:05:27,125 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:05:27] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:05:33,048 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-12 19:05:33,051 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': 'Please choose from the available options.'}}
2025-06-12 19:05:34,393 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjZCNENFNEM4RTI1NjNCRUQyQgA="}]}
2025-06-12 19:05:34,394 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjZCNENFNEM4RTI1NjNCRUQyQgA='}]}
2025-06-12 19:05:34,394 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:05:34] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:05:34,854 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:05:34] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:05:35,305 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:05:35] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:05:35,375 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:05:35] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:05:50,817 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'cancel_ai_order'}
2025-06-12 19:05:50,820 - handlers.base_handler - INFO - User cancelled AI order for session 2348055614455.
2025-06-12 19:05:50,820 - handlers.base_handler - INFO - Session 2348055614455 returned to main menu (greeting state).
2025-06-12 19:05:50,821 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Hello Ziga! 👋\n\nOrder cancelled. How can I help you?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-12 19:05:51,536 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkYxQ0UzMTZCQjlGMTg1NjVBQwA="}]}
2025-06-12 19:05:51,537 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkYxQ0UzMTZCQjlGMTg1NjVBQwA='}]}
2025-06-12 19:05:51,537 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:05:51] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:05:52,308 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:05:52] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:05:52,483 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:05:52] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:05:52,559 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:05:52] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:10:06,120 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-12 19:10:06,120 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-12 19:10:06,121 - utils.data_manager - ERROR - Error decoding data\user_details.json. Starting with empty user details.
2025-06-12 19:10:06,121 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-12 19:10:06,122 - services.payment_service - INFO - PaymentService initialized
2025-06-12 19:10:06,122 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-12 19:10:06,122 - utils.data_manager - ERROR - Error decoding data\user_details.json. Starting with empty user details.
2025-06-12 19:10:06,123 - utils.data_manager - INFO - Successfully loaded menu data from data\menu.json
2025-06-12 19:10:06,123 - services.payment_service - INFO - PaymentService initialized
2025-06-12 19:10:06,123 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-12 19:10:06,124 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-12 19:10:06,124 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-12 19:10:06,124 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-12 19:10:06,125 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-12 19:10:06,125 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-12 19:10:06,464 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-12 19:10:06,464 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-12 19:10:06,465 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-12 19:10:06,465 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-12 19:10:06,485 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-12 19:10:06,485 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-12 19:10:10,122 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-12 19:10:10,122 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-12 19:10:10,127 - utils.data_manager - INFO - User details saved to data\user_details.json
2025-06-12 19:10:10,127 - handlers.message_processor - ERROR - Error in message routing for handler 'greeting_handler', state 'start' for session 2348055614455: 'DataManager' object has no attribute 'get_user_data'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\app\handlers\message_processor.py", line 172, in _route_to_handler
    response = self.greeting_handler.generate_initial_greeting(state, session_id, user_name)
  File "C:\Users\zigam\Documents\Lola\app\handlers\greeting_handler.py", line 137, in generate_initial_greeting
    user_data = self.data_manager.get_user_data(session_id)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'DataManager' object has no attribute 'get_user_data'
2025-06-12 19:10:10,130 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "⚠️ Something went wrong. Let's start fresh. Please try again."}}
2025-06-12 19:10:11,123 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkY4NzQzOTgxOEFDQzk0OTk0OQA="}]}
2025-06-12 19:10:11,124 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkY4NzQzOTgxOEFDQzk0OTk0OQA='}]}
2025-06-12 19:10:11,124 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:10:11] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:10:12,079 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:10:12] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:10:12,282 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:10:12] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:12:27,893 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-12 19:12:27,893 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-12 19:12:27,894 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-12 19:12:27,894 - services.payment_service - INFO - PaymentService initialized
2025-06-12 19:12:27,895 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-12 19:12:27,895 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-12 19:12:27,896 - services.payment_service - INFO - PaymentService initialized
2025-06-12 19:12:27,896 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-12 19:12:27,896 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-12 19:12:27,897 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-12 19:12:27,897 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-12 19:12:27,897 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-12 19:12:27,897 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-12 19:12:28,329 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-12 19:12:28,329 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-12 19:12:28,329 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-12 19:12:28,330 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-12 19:12:28,342 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-12 19:12:28,342 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-12 19:12:35,356 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-12 19:12:35,357 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-12 19:12:35,360 - handlers.base_handler - INFO - Session 2348055614455 recognized user 'Ziga'.
2025-06-12 19:12:35,361 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Welcome Ziga! 👋🏼\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-12 19:12:36,288 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQwNTU5RDlGOEYxNDkyRURDRQA="}]}
2025-06-12 19:12:36,289 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQwNTU5RDlGOEYxNDkyRURDRQA='}]}
2025-06-12 19:12:36,290 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:12:36] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:12:37,347 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:12:37] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:12:37,490 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:12:37] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:13:10,311 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'others_menu'}
2025-06-12 19:13:10,314 - handlers.base_handler - INFO - GreetingHandler: Handling message 'others_menu' in greeting state for session 2348055614455.
2025-06-12 19:13:10,314 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🔧 *Other Options*\n\nHere are other ways I can help you:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'enquiry', 'title': '❓ Enquiry'}}, {'type': 'reply', 'reply': {'id': 'complain', 'title': '📝 Complain'}}, {'type': 'reply', 'reply': {'id': 'back_to_main', 'title': '🔙 Back'}}]}}}
2025-06-12 19:13:11,060 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjZEODE3OUFDRjAyQTJDOEMzRAA="}]}
2025-06-12 19:13:11,061 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjZEODE3OUFDRjAyQTJDOEMzRAA='}]}
2025-06-12 19:13:11,061 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:13:11] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:13:11,883 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:13:11] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:13:12,436 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:13:12] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:13:13,224 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'enquiry'}
2025-06-12 19:13:13,226 - handlers.message_processor - WARNING - No specific handler or state match for handler 'greeting_handler', state 'others_menu_selection', message 'enquiry' for session 2348055614455. Resetting to greeting.
2025-06-12 19:13:13,227 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "I'm sorry, I didn't quite understand that. Let's get back to the main menu."}}
2025-06-12 19:13:14,045 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkFFMzcxQzM3RTZDMzEzRTcwMQA="}]}
2025-06-12 19:13:14,046 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Please choose from the options below:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-12 19:13:14,746 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkQ0OUIwNUJDMTA1QTBFMDQ4MAA="}]}
2025-06-12 19:13:14,747 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkQ0OUIwNUJDMTA1QTBFMDQ4MAA='}]}
2025-06-12 19:13:14,747 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:13:14] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:13:14,809 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:13:14] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:13:14,923 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:13:14] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:13:15,031 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:13:15] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:13:15,547 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:13:15] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:13:15,824 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:13:15] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:13:15,893 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:13:15] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:17:12,349 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-12 19:17:12,349 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-12 19:17:12,350 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-12 19:17:12,350 - services.payment_service - INFO - PaymentService initialized
2025-06-12 19:17:12,350 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-12 19:17:12,351 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-12 19:17:12,351 - services.payment_service - INFO - PaymentService initialized
2025-06-12 19:17:12,352 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-12 19:17:12,352 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-12 19:17:12,352 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-12 19:17:12,352 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-12 19:17:12,353 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-12 19:17:12,353 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-12 19:17:12,722 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-12 19:17:12,722 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-12 19:17:12,722 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-12 19:17:12,723 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-12 19:17:12,737 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-12 19:17:12,738 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-12 19:17:18,655 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-12 19:17:18,655 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-12 19:17:18,659 - handlers.base_handler - INFO - Session 2348055614455 recognized user 'Ziga'.
2025-06-12 19:17:18,659 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Welcome Ziga! 👋🏼\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-12 19:17:19,429 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjczQzJEMDQxQzE4MzZDMThENQA="}]}
2025-06-12 19:17:19,430 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjczQzJEMDQxQzE4MzZDMThENQA='}]}
2025-06-12 19:17:19,431 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:17:19] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:17:20,233 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:17:20] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:17:20,442 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:17:20] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:17:22,220 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'others_menu'}
2025-06-12 19:17:22,222 - handlers.base_handler - INFO - GreetingHandler: Handling message 'others_menu' in greeting state for session 2348055614455.
2025-06-12 19:17:22,223 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🔧 *Other Options*\n\nHere are other ways I can help you:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'enquiry', 'title': '❓ Enquiry'}}, {'type': 'reply', 'reply': {'id': 'complain', 'title': '📝 Complain'}}, {'type': 'reply', 'reply': {'id': 'back_to_main', 'title': '🔙 Back'}}]}}}
2025-06-12 19:17:22,981 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkNFQzA4NEUzRUU4NzMxMEFCOQA="}]}
2025-06-12 19:17:22,981 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkNFQzA4NEUzRUU4NzMxMEFCOQA='}]}
2025-06-12 19:17:22,982 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:17:22] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:17:23,956 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:17:23] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:17:24,101 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:17:24] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:17:24,103 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:17:24] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:17:24,967 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'complain'}
2025-06-12 19:17:24,969 - handlers.base_handler - INFO - GreetingHandler: Handling message 'complain' in greeting state for session 2348055614455.
2025-06-12 19:17:24,969 - handlers.base_handler - INFO - Session 2348055614455 entering complaint state.
2025-06-12 19:17:24,970 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "We're sorry to hear you're having an issue. Please tell us about your complaint and we'll address it promptly."}}
2025-06-12 19:17:25,887 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjgzQzY1Qjg2Mjc3Q0QyMTc3OQA="}]}
2025-06-12 19:17:25,888 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjgzQzY1Qjg2Mjc3Q0QyMTc3OQA='}]}
2025-06-12 19:17:25,888 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:17:25] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:17:26,467 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:17:26] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:17:27,028 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:17:27] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:17:27,500 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:17:27] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:17:36,895 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'The delivery was slow'}
2025-06-12 19:17:36,897 - utils.data_manager - WARNING - File not found or empty: data\complaints.json
2025-06-12 19:17:36,898 - utils.data_manager - INFO - Data saved to data\complaints.json
2025-06-12 19:17:36,898 - utils.data_manager - INFO - Complaint details saved to data\complaints.json
2025-06-12 19:17:36,898 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "😔 We sincerely apologize for the inconvenience you've experienced, Ziga.\n\n*Complaint ID:* 4eb88343-65f5-477d-b123-b52c9687ce6b\n\nYour complaint has been received and is very important to us. We take all feedback seriously and will investigate this matter promptly.\n\nOur management team will review your concern and work to resolve it as quickly as possible. If needed, we may contact you for additional details.\n\n*Next Steps:*\n• Investigation within 24 hours\n• Resolution timeline communicated\n• Follow-up to ensure satisfaction\n\nThank you for bringing this to our attention. We're committed to improving our service and making this right. 🙏\n\n*You can reference complaint ID 4eb88343-65f5-477d-b123-b52c9687ce6b in future communications.*"}}
2025-06-12 19:17:37,727 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjMyQkU0MzVFQkQ3RjFCQzU4NwA="}]}
2025-06-12 19:17:37,727 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjMyQkU0MzVFQkQ3RjFCQzU4NwA='}]}
2025-06-12 19:17:37,728 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:17:37] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:17:38,312 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:17:38] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:17:38,573 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:17:38] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:17:38,767 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:17:38] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:17:51,372 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-12 19:17:51,374 - handlers.message_processor - WARNING - Unhandled complaint_handler state 'end' for session 2348055614455. Prompting for complaint.
2025-06-12 19:17:51,374 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "We're sorry to hear you're having an issue. Please tell us about your complaint and we'll address it promptly."}}
2025-06-12 19:17:52,101 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjhGNjI4NTVCQ0FCNkMxODI1QwA="}]}
2025-06-12 19:17:52,102 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjhGNjI4NTVCQ0FCNkMxODI1QwA='}]}
2025-06-12 19:17:52,103 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:17:52] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:17:52,980 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:17:52] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:17:53,274 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:17:53] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:19:32,442 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-12 19:19:32,445 - utils.data_manager - INFO - Data saved to data\complaints.json
2025-06-12 19:19:32,445 - utils.data_manager - INFO - Complaint details saved to data\complaints.json
2025-06-12 19:19:32,445 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "😔 We sincerely apologize for the inconvenience you've experienced, Ziga.\n\n*Complaint ID:* 0a22ed4c-ea56-4a9c-8060-0a660f245385\n\nYour complaint has been received and is very important to us. We take all feedback seriously and will investigate this matter promptly.\n\nOur management team will review your concern and work to resolve it as quickly as possible. If needed, we may contact you for additional details.\n\n*Next Steps:*\n• Investigation within 24 hours\n• Resolution timeline communicated\n• Follow-up to ensure satisfaction\n\nThank you for bringing this to our attention. We're committed to improving our service and making this right. 🙏\n\n*You can reference complaint ID 0a22ed4c-ea56-4a9c-8060-0a660f245385 in future communications.*"}}
2025-06-12 19:19:33,177 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQ3OEI2M0E5MjEzNDg1OUNDNAA="}]}
2025-06-12 19:19:33,178 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQ3OEI2M0E5MjEzNDg1OUNDNAA='}]}
2025-06-12 19:19:33,178 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:19:33] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:19:34,221 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:19:34] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:19:34,375 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:19:34] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:19:42,511 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-12 19:19:42,511 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-12 19:19:42,512 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-12 19:19:42,512 - services.payment_service - INFO - PaymentService initialized
2025-06-12 19:19:42,513 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-12 19:19:42,513 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-12 19:19:42,514 - services.payment_service - INFO - PaymentService initialized
2025-06-12 19:19:42,514 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-12 19:19:42,514 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-12 19:19:42,515 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-12 19:19:42,515 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-12 19:19:42,515 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-12 19:19:42,516 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-12 19:19:42,891 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-12 19:19:42,892 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-12 19:19:42,892 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-12 19:19:42,892 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-12 19:19:42,912 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-12 19:19:42,913 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-12 19:19:45,329 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-12 19:19:45,329 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-12 19:19:45,333 - handlers.base_handler - INFO - Session 2348055614455 recognized user 'Ziga'.
2025-06-12 19:19:45,333 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Welcome Ziga! 👋🏼\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-12 19:19:46,147 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkM5ODREREMwMzBEMDQ0MUZBMgA="}]}
2025-06-12 19:19:46,147 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkM5ODREREMwMzBEMDQ0MUZBMgA='}]}
2025-06-12 19:19:46,148 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:19:46] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:19:47,093 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:19:47] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:19:47,237 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:19:47] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:19:47,238 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:19:47] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:19:50,392 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'others_menu'}
2025-06-12 19:19:50,395 - handlers.base_handler - INFO - GreetingHandler: Handling message 'others_menu' in greeting state for session 2348055614455.
2025-06-12 19:19:50,395 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🔧 *Other Options*\n\nHere are other ways I can help you:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'enquiry', 'title': '❓ Enquiry'}}, {'type': 'reply', 'reply': {'id': 'complain', 'title': '📝 Complain'}}, {'type': 'reply', 'reply': {'id': 'back_to_main', 'title': '🔙 Back'}}]}}}
2025-06-12 19:19:51,450 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjZEMkRCOUI4ODg1QTQzQjk4OQA="}]}
2025-06-12 19:19:51,451 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjZEMkRCOUI4ODg1QTQzQjk4OQA='}]}
2025-06-12 19:19:51,451 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:19:51] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:19:52,167 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:19:52] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:19:52,389 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:19:52] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:19:52,524 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:19:52] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:19:57,708 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'complain'}
2025-06-12 19:19:57,710 - handlers.base_handler - INFO - GreetingHandler: Handling message 'complain' in greeting state for session 2348055614455.
2025-06-12 19:19:57,710 - handlers.base_handler - INFO - Session 2348055614455 entering complaint state.
2025-06-12 19:19:57,711 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "We're sorry to hear you're having an issue. Please tell us about your complaint and we'll address it promptly."}}
2025-06-12 19:19:58,526 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjJDMDZDQzc1RDE1NkU2NTk0RgA="}]}
2025-06-12 19:19:58,527 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjJDMDZDQzc1RDE1NkU2NTk0RgA='}]}
2025-06-12 19:19:58,527 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:19:58] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:19:59,296 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:19:59] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:19:59,580 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:19:59] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:20:05,439 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Wrong delivery'}
2025-06-12 19:20:05,441 - handlers.complaint_handler - INFO - ComplaintHandler: Handling complaint submission for session 2348055614455.
2025-06-12 19:20:05,444 - utils.data_manager - INFO - Data saved to data\complaints.json
2025-06-12 19:20:05,444 - utils.data_manager - INFO - Complaint details saved to data\complaints.json
2025-06-12 19:20:05,444 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "😔 We sincerely apologize for the inconvenience you've experienced, Ziga.\n\n*Complaint ID:* d6b6428c-e523-48cf-886d-360252ebc219\n\nYour complaint has been received and is very important to us. We take all feedback seriously and will investigate this matter promptly.\n\nOur management team will review your concern and work to resolve it as quickly as possible. If needed, we may contact you for additional details.\n\nThank you for bringing this to our attention. We're committed to improving our service and making this right. 🙏\n\n*You can reference complaint ID d6b6428c-e523-48cf-886d-360252ebc219 in future communications.*"}}
2025-06-12 19:20:06,198 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjVGNjRDNjgzODIxQjVDRUQ1QQA="}]}
2025-06-12 19:20:06,198 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjVGNjRDNjgzODIxQjVDRUQ1QQA='}]}
2025-06-12 19:20:06,199 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:20:06] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:20:06,841 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:20:06] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:20:07,027 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:20:07] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:20:07,159 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:20:07] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:20:10,356 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-12 19:20:10,359 - handlers.message_processor - WARNING - Unhandled complaint_handler state 'end' for session 2348055614455. Prompting for complaint.
2025-06-12 19:20:10,359 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "We're sorry to hear you're having an issue. Please tell us about your complaint and we'll address it promptly."}}
2025-06-12 19:20:11,062 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjcyMzdERDhFNDEzRDhGMkRCRAA="}]}
2025-06-12 19:20:11,063 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjcyMzdERDhFNDEzRDhGMkRCRAA='}]}
2025-06-12 19:20:11,064 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:20:11] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:20:11,776 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:20:11] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:20:12,145 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:20:12] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:20:12,177 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:20:12] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:20:18,312 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-12 19:20:18,315 - handlers.complaint_handler - INFO - ComplaintHandler: Handling complaint submission for session 2348055614455.
2025-06-12 19:20:18,318 - utils.data_manager - INFO - Data saved to data\complaints.json
2025-06-12 19:20:18,318 - utils.data_manager - INFO - Complaint details saved to data\complaints.json
2025-06-12 19:20:18,318 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "😔 We sincerely apologize for the inconvenience you've experienced, Ziga.\n\n*Complaint ID:* 60dc4ee2-54ec-42a1-b2a0-0dae68e0a5fa\n\nYour complaint has been received and is very important to us. We take all feedback seriously and will investigate this matter promptly.\n\nOur management team will review your concern and work to resolve it as quickly as possible. If needed, we may contact you for additional details.\n\nThank you for bringing this to our attention. We're committed to improving our service and making this right. 🙏\n\n*You can reference complaint ID 60dc4ee2-54ec-42a1-b2a0-0dae68e0a5fa in future communications.*"}}
2025-06-12 19:20:18,987 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkFFNzM0NUI3QTRCRkU1NDNGNQA="}]}
2025-06-12 19:20:18,988 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkFFNzM0NUI3QTRCRkU1NDNGNQA='}]}
2025-06-12 19:20:18,988 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:20:18] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:20:19,650 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:20:19] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:20:19,997 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:20:19] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:21:11,141 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-12 19:21:11,141 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-12 19:21:11,142 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-12 19:21:11,143 - services.payment_service - INFO - PaymentService initialized
2025-06-12 19:21:11,143 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-12 19:21:11,144 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-12 19:21:11,144 - services.payment_service - INFO - PaymentService initialized
2025-06-12 19:21:11,145 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-12 19:21:11,145 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-12 19:21:11,146 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-12 19:21:11,146 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-12 19:21:11,146 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-12 19:21:11,147 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-12 19:21:11,527 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-12 19:21:11,528 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-12 19:21:11,528 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-12 19:21:11,528 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-12 19:21:11,542 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-12 19:21:11,543 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-12 19:21:14,981 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-12 19:21:14,981 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-12 19:21:14,985 - handlers.base_handler - INFO - Session 2348055614455 recognized user 'Ziga'.
2025-06-12 19:21:14,985 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Welcome Ziga! 👋🏼\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-12 19:21:15,992 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjVGQzY0NEQyN0EzNzA3MzEwOQA="}]}
2025-06-12 19:21:15,992 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjVGQzY0NEQyN0EzNzA3MzEwOQA='}]}
2025-06-12 19:21:15,993 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:21:15] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:21:16,983 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:21:16] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:21:17,088 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:21:17] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:21:17,119 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:21:17] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:21:17,724 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'others_menu'}
2025-06-12 19:21:17,727 - handlers.base_handler - INFO - GreetingHandler: Handling message 'others_menu' in greeting state for session 2348055614455.
2025-06-12 19:21:17,727 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🔧 *Other Options*\n\nHere are other ways I can help you:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'enquiry', 'title': '❓ Enquiry'}}, {'type': 'reply', 'reply': {'id': 'complain', 'title': '📝 Complain'}}, {'type': 'reply', 'reply': {'id': 'back_to_main', 'title': '🔙 Back'}}]}}}
2025-06-12 19:21:18,453 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjgyQ0RFREVDQTJBQzg3QTU4RQA="}]}
2025-06-12 19:21:18,454 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjgyQ0RFREVDQTJBQzg3QTU4RQA='}]}
2025-06-12 19:21:18,454 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:21:18] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:21:19,343 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:21:19] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:21:19,481 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:21:19] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:21:19,600 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:21:19] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:21:20,499 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'back_to_main'}
2025-06-12 19:21:20,508 - handlers.base_handler - INFO - GreetingHandler: Handling message 'back_to_main' in greeting state for session 2348055614455.
2025-06-12 19:21:20,508 - handlers.base_handler - WARNING - Session 2348055614455: Invalid option 'back_to_main' in greeting state.
2025-06-12 19:21:20,509 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Invalid option. Please choose from the options below:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-12 19:21:21,306 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjBFMDZBNUU1RjkxNDM3MDZENQA="}]}
2025-06-12 19:21:21,307 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjBFMDZBNUU1RjkxNDM3MDZENQA='}]}
2025-06-12 19:21:21,307 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:21:21] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:21:22,060 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:21:22] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:21:22,203 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:21:22] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:21:22,406 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:21:22] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:21:22,879 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'others_menu'}
2025-06-12 19:21:22,882 - handlers.base_handler - INFO - GreetingHandler: Handling message 'others_menu' in greeting state for session 2348055614455.
2025-06-12 19:21:22,882 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🔧 *Other Options*\n\nHere are other ways I can help you:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'enquiry', 'title': '❓ Enquiry'}}, {'type': 'reply', 'reply': {'id': 'complain', 'title': '📝 Complain'}}, {'type': 'reply', 'reply': {'id': 'back_to_main', 'title': '🔙 Back'}}]}}}
2025-06-12 19:21:23,824 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjBDMzUzNkI3MzhDMTMzQTQ4NQA="}]}
2025-06-12 19:21:23,825 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjBDMzUzNkI3MzhDMTMzQTQ4NQA='}]}
2025-06-12 19:21:23,825 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:21:23] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:21:25,111 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:21:25] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:21:25,115 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:21:25] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:21:25,457 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:21:25] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:21:26,126 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'complain'}
2025-06-12 19:21:26,128 - handlers.base_handler - INFO - GreetingHandler: Handling message 'complain' in greeting state for session 2348055614455.
2025-06-12 19:21:26,129 - handlers.base_handler - INFO - Session 2348055614455 entering complaint state.
2025-06-12 19:21:26,129 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "We're sorry to hear you're having an issue. Please tell us about your complaint and we'll address it promptly."}}
2025-06-12 19:21:27,054 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkExQTRBNTJBMkU2NzlGRDJDRgA="}]}
2025-06-12 19:21:27,055 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkExQTRBNTJBMkU2NzlGRDJDRgA='}]}
2025-06-12 19:21:27,055 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:21:27] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:21:27,770 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:21:27] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:21:27,906 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:21:27] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:21:28,362 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:21:28] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:21:33,713 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Wrong complaints'}
2025-06-12 19:21:33,715 - handlers.complaint_handler - INFO - ComplaintHandler: Handling complaint submission for session 2348055614455.
2025-06-12 19:21:33,717 - utils.data_manager - INFO - Data saved to data\complaints.json
2025-06-12 19:21:33,718 - utils.data_manager - INFO - Complaint details saved to data\complaints.json
2025-06-12 19:21:33,718 - handlers.complaint_handler - INFO - Complaint b9a6582e-8219-4d7f-ad0b-888d96d3fb56 saved for session 2348055614455.
2025-06-12 19:21:33,719 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "😔 We sincerely apologize for the inconvenience you've experienced, Ziga.\n\n*Complaint ID:* b9a6582e-8219-4d7f-ad0b-888d96d3fb56\n\nYour complaint has been received and is very important to us. We take all feedback seriously and will investigate this matter promptly.\n\nOur management team will review your concern and work to resolve it as quickly as possible. If needed, we may contact you for additional details.\n\nThank you for bringing this to our attention. We're committed to improving our service and making this right. 🙏\n\n*You can reference complaint ID b9a6582e-8219-4d7f-ad0b-888d96d3fb56 in future communications.*"}}
2025-06-12 19:21:35,875 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjdBRDNDRUVEMzQxRjRGODY4RQA="}]}
2025-06-12 19:21:35,878 - handlers.complaint_handler - INFO - Complaint handled for 2348055614455. Redirecting to main menu.
2025-06-12 19:21:35,878 - handlers.base_handler - INFO - Session 2348055614455 returned to main menu (greeting state).
2025-06-12 19:21:35,879 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'What would you like to do next?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-12 19:21:36,526 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkQzM0QxQzYzRjRENEYyQjU4NAA="}]}
2025-06-12 19:21:36,527 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkQzM0QxQzYzRjRENEYyQjU4NAA='}]}
2025-06-12 19:21:36,527 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:21:36] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:21:36,635 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:21:36] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:21:36,945 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:21:36] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:21:37,473 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:21:37] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:21:37,491 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:21:37] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:21:37,615 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:21:37] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:22:47,410 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-12 19:22:47,410 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-12 19:22:47,411 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-12 19:22:47,411 - services.payment_service - INFO - PaymentService initialized
2025-06-12 19:22:47,411 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-12 19:22:47,412 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-12 19:22:47,412 - services.payment_service - INFO - PaymentService initialized
2025-06-12 19:22:47,413 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-12 19:22:47,413 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-12 19:22:47,413 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-12 19:22:47,414 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-12 19:22:47,414 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-12 19:22:47,414 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-12 19:22:47,782 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-12 19:22:47,782 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-12 19:22:47,783 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-12 19:22:47,783 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-12 19:22:47,797 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-12 19:22:47,798 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-12 19:22:53,590 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-12 19:22:53,591 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-12 19:22:53,593 - handlers.base_handler - INFO - Session 2348055614455 recognized user 'Ziga'.
2025-06-12 19:22:53,594 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Welcome Ziga! 👋🏼\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-12 19:22:54,481 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjg3Q0M4QTFGQUJCMzA5MjU1QQA="}]}
2025-06-12 19:22:54,482 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjg3Q0M4QTFGQUJCMzA5MjU1QQA='}]}
2025-06-12 19:22:54,483 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:22:54] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:22:55,436 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:22:55] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:22:55,586 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:22:55] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:22:55,588 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:22:55] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:22:56,455 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'others_menu'}
2025-06-12 19:22:56,457 - handlers.base_handler - INFO - GreetingHandler: Handling message 'others_menu' in greeting state for session 2348055614455.
2025-06-12 19:22:56,458 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🔧 *Other Options*\n\nHere are other ways I can help you:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'enquiry', 'title': '❓ Enquiry'}}, {'type': 'reply', 'reply': {'id': 'complain', 'title': '📝 Complain'}}, {'type': 'reply', 'reply': {'id': 'back_to_main', 'title': '🔙 Back'}}]}}}
2025-06-12 19:22:57,183 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkRCOUExRDVCMEU5RDcxQUQ3NwA="}]}
2025-06-12 19:22:57,184 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkRCOUExRDVCMEU5RDcxQUQ3NwA='}]}
2025-06-12 19:22:57,184 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:22:57] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:22:58,018 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:22:58] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:22:58,115 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:22:58] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:22:58,232 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:22:58] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:22:58,908 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'complain'}
2025-06-12 19:22:58,910 - handlers.base_handler - INFO - GreetingHandler: Handling message 'complain' in greeting state for session 2348055614455.
2025-06-12 19:22:58,910 - handlers.base_handler - INFO - Session 2348055614455 entering complaint state.
2025-06-12 19:22:58,911 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "We're sorry to hear you're having an issue. Please tell us about your complaint and we'll address it promptly."}}
2025-06-12 19:22:59,666 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjAwRjZBODk3QzczOEU0QTM4OAA="}]}
2025-06-12 19:22:59,667 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjAwRjZBODk3QzczOEU0QTM4OAA='}]}
2025-06-12 19:22:59,667 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:22:59] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:23:00,430 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:23:00] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:23:00,528 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:23:00] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:23:00,778 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:23:00] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:23:05,590 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Failed delivery'}
2025-06-12 19:23:05,593 - handlers.complaint_handler - INFO - ComplaintHandler: Handling complaint submission for session 2348055614455.
2025-06-12 19:23:05,595 - utils.data_manager - INFO - Data saved to data\complaints.json
2025-06-12 19:23:05,596 - utils.data_manager - INFO - Complaint details saved to data\complaints.json
2025-06-12 19:23:05,596 - handlers.complaint_handler - INFO - Complaint 52f93ec5-6d0c-4ea2-ad9e-050a17a13ef6 saved for session 2348055614455.
2025-06-12 19:23:05,596 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "😔 We sincerely apologize for the inconvenience you've experienced, Ziga.\n\n*Complaint ID:* 52f93ec5-6d0c-4ea2-ad9e-050a17a13ef6\n\nYour complaint has been received and is very important to us. We take all feedback seriously and will investigate this matter promptly.\n\nOur management team will review your concern and work to resolve it as quickly as possible. If needed, we may contact you for additional details.\n\nThank you for bringing this to our attention. We're committed to improving our service and making this right. 🙏\n\n*You can reference complaint ID 52f93ec5-6d0c-4ea2-ad9e-050a17a13ef6 in future communications.*"}}
2025-06-12 19:23:06,473 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjdDRENCRDYwQ0JFQ0NDNjY5OQA="}]}
2025-06-12 19:23:06,473 - handlers.complaint_handler - INFO - Complaint handled for 2348055614455. Session state reset to 'greeting'.
2025-06-12 19:23:06,474 - handlers.message_processor - WARNING - No specific handler or state match for handler 'complaint_handler', state 'complain', message 'failed delivery' for session 2348055614455. Resetting to greeting.
2025-06-12 19:23:06,474 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "I'm sorry, I didn't quite understand that. Let's get back to the main menu."}}
2025-06-12 19:23:07,133 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:23:07] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:23:07,266 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:23:07] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:23:07,302 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjBFOUFGNEUzNzYzMjEyNjUxNQA="}]}
2025-06-12 19:23:07,303 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Please choose from the options below:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-12 19:23:07,487 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:23:07] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:23:08,020 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkM1MzgwNkUwNEJFM0IzOTcxMQA="}]}
2025-06-12 19:23:08,021 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkM1MzgwNkUwNEJFM0IzOTcxMQA='}]}
2025-06-12 19:23:08,021 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:23:08] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:23:08,040 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:23:08] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:23:08,377 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:23:08] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:23:08,379 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:23:08] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:23:09,339 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:23:09] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:23:09,369 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:23:09] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:23:09,483 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:23:09] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:25:29,854 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-12 19:25:29,854 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-12 19:25:29,855 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-12 19:25:29,855 - services.payment_service - INFO - PaymentService initialized
2025-06-12 19:25:29,855 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-12 19:25:29,856 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-12 19:25:29,856 - services.payment_service - INFO - PaymentService initialized
2025-06-12 19:25:29,857 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-12 19:25:29,857 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-12 19:25:29,857 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-12 19:25:29,858 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-12 19:25:29,858 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-12 19:25:29,858 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-12 19:25:30,270 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-12 19:25:30,270 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-12 19:25:30,270 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-12 19:25:30,270 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-12 19:25:30,283 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-12 19:25:30,284 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-12 19:25:38,703 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-12 19:25:38,704 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-12 19:25:38,707 - handlers.base_handler - INFO - Session 2348055614455 recognized user 'Ziga'.
2025-06-12 19:25:38,708 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Welcome Ziga! 👋🏼\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-12 19:25:39,537 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjJGMUEzREI3MUM5ODhCNzM3RQA="}]}
2025-06-12 19:25:39,537 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjJGMUEzREI3MUM5ODhCNzM3RQA='}]}
2025-06-12 19:25:39,538 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:25:39] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:25:40,299 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:25:40] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:25:40,749 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:25:40] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:25:43,357 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'others_menu'}
2025-06-12 19:25:43,360 - handlers.base_handler - INFO - GreetingHandler: Handling message 'others_menu' in greeting state for session 2348055614455.
2025-06-12 19:25:43,360 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🔧 *Other Options*\n\nHere are other ways I can help you:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'enquiry', 'title': '❓ Enquiry'}}, {'type': 'reply', 'reply': {'id': 'complain', 'title': '📝 Complain'}}, {'type': 'reply', 'reply': {'id': 'back_to_main', 'title': '🔙 Back'}}]}}}
2025-06-12 19:25:44,256 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkVGQ0U5REM1Rjg2MjQzNTYyOAA="}]}
2025-06-12 19:25:44,257 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkVGQ0U5REM1Rjg2MjQzNTYyOAA='}]}
2025-06-12 19:25:44,258 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:25:44] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:25:45,122 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:25:45] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:25:45,303 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:25:45] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:25:45,532 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:25:45] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:25:46,756 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'complain'}
2025-06-12 19:25:46,759 - handlers.message_processor - ERROR - Error in message routing for handler 'greeting_handler', state 'others_menu_selection' for session 2348055614455: 'GreetingHandler' object has no attribute 'handle_others_menu_state'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\app\handlers\message_processor.py", line 186, in _route_to_handler
    response = self.greeting_handler.handle_others_menu_state(state, message, session_id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'GreetingHandler' object has no attribute 'handle_others_menu_state'. Did you mean: 'handle_others_menu_selection_state'?
2025-06-12 19:25:46,760 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "⚠️ Something went wrong. Let's start fresh. Please try again."}}
2025-06-12 19:25:47,693 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkU4MTUxOTJBMkI1RjY0QzRGQQA="}]}
2025-06-12 19:25:47,694 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkU4MTUxOTJBMkI1RjY0QzRGQQA='}]}
2025-06-12 19:25:47,695 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:25:47] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:25:48,656 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:25:48] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:25:48,750 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:25:48] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:25:48,792 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:25:48] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:30:00,542 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-12 19:30:00,543 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-12 19:30:00,543 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-12 19:30:00,544 - services.payment_service - INFO - PaymentService initialized
2025-06-12 19:30:00,544 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-12 19:30:00,544 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-12 19:30:00,545 - services.payment_service - INFO - PaymentService initialized
2025-06-12 19:30:00,545 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-12 19:30:00,545 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-12 19:30:00,546 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-12 19:30:00,546 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-12 19:30:00,546 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-12 19:30:00,546 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-12 19:30:00,909 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-12 19:30:00,909 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-12 19:30:00,909 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-12 19:30:00,910 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-12 19:30:00,923 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-12 19:30:00,924 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-12 19:30:06,726 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-12 19:30:06,726 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-12 19:30:06,733 - handlers.base_handler - INFO - Session 2348055614455 recognized user 'Ziga'.
2025-06-12 19:30:06,734 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Welcome Ziga! 👋🏼\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-12 19:30:07,557 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjA0MjA2QTA4RkFBQzNCRkJBMwA="}]}
2025-06-12 19:30:07,558 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjA0MjA2QTA4RkFBQzNCRkJBMwA='}]}
2025-06-12 19:30:07,559 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:30:07] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:30:08,639 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:30:08] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:30:08,797 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:30:08] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:30:10,364 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'others_menu'}
2025-06-12 19:30:10,367 - handlers.base_handler - INFO - GreetingHandler: Handling message 'others_menu' in greeting state for session 2348055614455.
2025-06-12 19:30:10,367 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🔧 *Other Options*\n\nHere are other ways I can help you:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'enquiry', 'title': '❓ Enquiry'}}, {'type': 'reply', 'reply': {'id': 'complain', 'title': '📝 Complain'}}, {'type': 'reply', 'reply': {'id': 'back_to_main', 'title': '🔙 Back'}}]}}}
2025-06-12 19:30:11,223 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjA3RjFGOTQ2NzJFNjI2MTQzMwA="}]}
2025-06-12 19:30:11,224 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjA3RjFGOTQ2NzJFNjI2MTQzMwA='}]}
2025-06-12 19:30:11,224 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:30:11] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:30:12,148 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:30:12] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:30:12,330 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:30:12] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:30:12,343 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:30:12] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:30:13,285 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'complain'}
2025-06-12 19:30:13,288 - handlers.base_handler - INFO - GreetingHandler: Handling message 'complain' in 'others_menu_selection' state for session 2348055614455.
2025-06-12 19:30:13,288 - handlers.base_handler - INFO - Session 2348055614455 entering complaint state.
2025-06-12 19:30:13,288 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "We're sorry to hear you're having an issue. Please tell us about your complaint and we'll address it promptly."}}
2025-06-12 19:30:14,055 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjg5NTc3OUU3NzNGNkRFREMwNAA="}]}
2025-06-12 19:30:14,056 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjg5NTc3OUU3NzNGNkRFREMwNAA='}]}
2025-06-12 19:30:14,057 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:30:14] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:30:14,833 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:30:14] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:30:14,995 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:30:14] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:30:14,997 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:30:14] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:30:22,693 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Wrong delivery'}
2025-06-12 19:30:22,695 - handlers.complaint_handler - INFO - Complaint received from 2348055614455: Wrong delivery
2025-06-12 19:30:22,695 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': '✅ Thank you for your complaint! We have received it and will look into this issue promptly. We appreciate your patience.'}}
2025-06-12 19:30:23,435 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkEwQTA5QUFCNDE3ODM3QUFFOAA="}]}
2025-06-12 19:30:23,436 - handlers.message_processor - WARNING - No specific handler or state match for handler 'complaint_handler', state 'complain', message 'wrong delivery' for session 2348055614455. Resetting to greeting and sending menu.
2025-06-12 19:30:23,436 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "I'm sorry, I didn't quite understand that. Let's get back to the main menu."}}
2025-06-12 19:30:24,126 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkQwQTI3MzdCRDFEMjRBOEZDNgA="}]}
2025-06-12 19:30:24,127 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Please choose from the options below:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-12 19:30:24,251 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:30:24] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:30:24,351 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:30:24] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:30:24,490 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:30:24] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:30:24,747 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjc1MkFFQTA5RkQ1RTU2NjE5RgA="}]}
2025-06-12 19:30:24,747 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjc1MkFFQTA5RkQ1RTU2NjE5RgA='}]}
2025-06-12 19:30:24,748 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:30:24] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:30:24,862 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:30:24] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:30:25,348 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:30:25] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:30:25,379 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:30:25] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:30:25,494 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:30:25] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:30:25,833 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:30:25] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:30:25,850 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:30:25] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:31:36,599 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-12 19:31:36,599 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-12 19:31:36,600 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-12 19:31:36,601 - services.payment_service - INFO - PaymentService initialized
2025-06-12 19:31:36,601 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-12 19:31:36,601 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-12 19:31:36,602 - services.payment_service - INFO - PaymentService initialized
2025-06-12 19:31:36,602 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-12 19:31:36,603 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-12 19:31:36,603 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-12 19:31:36,603 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-12 19:31:36,604 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-12 19:31:36,604 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-12 19:31:36,954 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-12 19:31:36,954 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-12 19:31:36,955 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-12 19:31:36,955 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-12 19:31:36,969 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-12 19:31:36,969 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-12 19:31:40,017 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'others_menu'}
2025-06-12 19:31:40,017 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-12 19:31:40,021 - handlers.base_handler - INFO - Session 2348055614455 recognized user 'Ziga'.
2025-06-12 19:31:40,021 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Welcome Ziga! 👋🏼\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-12 19:31:40,883 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjY0QThCNjI2NkNFN0FDQUQ2NAA="}]}
2025-06-12 19:31:40,884 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjY0QThCNjI2NkNFN0FDQUQ2NAA='}]}
2025-06-12 19:31:40,885 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:31:40] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:31:41,637 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:31:41] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:31:42,065 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:31:42] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:31:43,020 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'others_menu'}
2025-06-12 19:31:43,022 - handlers.base_handler - INFO - GreetingHandler: Handling message 'others_menu' in greeting state for session 2348055614455.
2025-06-12 19:31:43,023 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🔧 *Other Options*\n\nHere are other ways I can help you:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'enquiry', 'title': '❓ Enquiry'}}, {'type': 'reply', 'reply': {'id': 'complain', 'title': '📝 Complain'}}, {'type': 'reply', 'reply': {'id': 'back_to_main', 'title': '🔙 Back'}}]}}}
2025-06-12 19:31:44,089 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjZGMDkwMUVDRERGN0U2MTJCQwA="}]}
2025-06-12 19:31:44,090 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjZGMDkwMUVDRERGN0U2MTJCQwA='}]}
2025-06-12 19:31:44,090 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:31:44] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:31:44,837 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:31:44] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:31:45,115 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:31:45] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:31:45,250 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:31:45] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:31:46,528 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'complain'}
2025-06-12 19:31:46,530 - handlers.base_handler - INFO - GreetingHandler: Handling message 'complain' in 'others_menu_selection' state for session 2348055614455.
2025-06-12 19:31:46,530 - handlers.base_handler - INFO - Session 2348055614455 entering complaint state.
2025-06-12 19:31:46,531 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "We're sorry to hear you're having an issue. Please tell us about your complaint and we'll address it promptly."}}
2025-06-12 19:31:47,383 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjlBODQyNjZCOTFDMDZBNDMxQgA="}]}
2025-06-12 19:31:47,383 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjlBODQyNjZCOTFDMDZBNDMxQgA='}]}
2025-06-12 19:31:47,384 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:31:47] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:31:48,387 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:31:48] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:31:48,528 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:31:48] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:31:48,551 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:31:48] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:31:51,272 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Wrong delivery'}
2025-06-12 19:31:51,274 - handlers.complaint_handler - INFO - Complaint received from 2348055614455: Wrong delivery
2025-06-12 19:31:51,275 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': '✅ Thank you for your complaint! We have received it and will look into this issue promptly. We appreciate your patience.'}}
2025-06-12 19:31:52,161 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjBBRUU3RDczRkFGOTVFNDY4QQA="}]}
2025-06-12 19:31:52,162 - handlers.message_processor - WARNING - No specific handler or state match for handler 'complaint_handler', state 'complain', message 'wrong delivery' for session 2348055614455. Resetting to greeting and sending menu.
2025-06-12 19:31:52,162 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "I'm sorry, I didn't quite understand that. Let's get back to the main menu."}}
2025-06-12 19:31:52,895 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQwRUQ4M0RDN0YyNjRCRjAyOAA="}]}
2025-06-12 19:31:52,896 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Please choose from the options below:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-12 19:31:53,076 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:31:53] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:31:53,167 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:31:53] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:31:53,266 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:31:53] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:31:53,628 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkNBRkYzMkVGNDE0QkMzRTNENQA="}]}
2025-06-12 19:31:53,628 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkNBRkYzMkVGNDE0QkMzRTNENQA='}]}
2025-06-12 19:31:53,629 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:31:53] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:31:53,630 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:31:53] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:31:53,806 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:31:53] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:31:53,854 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:31:53] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:31:54,535 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:31:54] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:31:54,718 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:31:54] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:31:54,853 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:31:54] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:33:16,473 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': '4 puff puff'}
2025-06-12 19:33:16,476 - handlers.base_handler - INFO - GreetingHandler: Handling message '4 puff puff' in greeting state for session 2348055614455.
2025-06-12 19:33:16,477 - handlers.base_handler - WARNING - Session 2348055614455: Invalid option '4 puff puff' in greeting state.
2025-06-12 19:33:16,477 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Invalid option. Please choose from the options below:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-12 19:33:17,284 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkM4NUNCQjJBQ0M3REE0MUExOAA="}]}
2025-06-12 19:33:17,285 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkM4NUNCQjJBQ0M3REE0MUExOAA='}]}
2025-06-12 19:33:17,286 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:33:17] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:33:18,010 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:33:18] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:33:19,110 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:33:19] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:35:15,717 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-12 19:35:15,718 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-12 19:35:15,718 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-12 19:35:15,719 - services.payment_service - INFO - PaymentService initialized
2025-06-12 19:35:15,719 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-12 19:35:15,720 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-12 19:35:15,720 - services.payment_service - INFO - PaymentService initialized
2025-06-12 19:35:15,721 - __main__ - ERROR - Unexpected error: MessageProcessor.__init__() missing 4 required positional arguments: 'payment_handler', 'complaint_handler', 'enquiry_handler', and 'ai_handler'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\app\run.py", line 151, in main
    from app import app
  File "C:\Users\zigam\Documents\Lola\app\app.py", line 64, in <module>
    webhook_handler = WebhookHandler(config) # WebhookHandler was modified to initialize its own services
  File "C:\Users\zigam\Documents\Lola\app\handlers\webhook_handler.py", line 22, in __init__
    self.message_processor = MessageProcessor(
                             ~~~~~~~~~~~~~~~~^
        config,
        ^^^^^^^
    ...<4 lines>...
        self.location_service
        ^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: MessageProcessor.__init__() missing 4 required positional arguments: 'payment_handler', 'complaint_handler', 'enquiry_handler', and 'ai_handler'
2025-06-12 19:38:35,952 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-12 19:38:35,953 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-12 19:38:35,953 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-12 19:38:35,954 - services.payment_service - INFO - PaymentService initialized
2025-06-12 19:38:35,954 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-12 19:38:35,954 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-12 19:38:35,955 - services.payment_service - INFO - PaymentService initialized
2025-06-12 19:38:35,955 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-12 19:38:35,955 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-12 19:38:35,956 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-12 19:38:35,956 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-12 19:38:35,956 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-12 19:38:35,956 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-12 19:38:36,389 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-12 19:38:36,389 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-12 19:38:36,390 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-12 19:38:36,390 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-12 19:38:36,403 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-12 19:38:36,404 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-12 19:38:43,214 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:38:43] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:38:45,452 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-12 19:38:45,452 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-12 19:38:45,455 - handlers.base_handler - INFO - Session 2348055614455 recognized user 'Ziga'.
2025-06-12 19:38:45,456 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Welcome Ziga! 👋🏼\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-12 19:38:46,244 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjg5QTNBMzIzQzhBOTkzMzM3MgA="}]}
2025-06-12 19:38:46,245 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjg5QTNBMzIzQzhBOTkzMzM3MgA='}]}
2025-06-12 19:38:46,246 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:38:46] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:38:47,016 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:38:47] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:38:47,199 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:38:47] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:38:47,315 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:38:47] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:38:48,401 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'others_menu'}
2025-06-12 19:38:48,404 - handlers.message_processor - ERROR - Error in message routing for handler 'greeting_handler', state 'greeting' for session 2348055614455: 'SessionManager' object has no attribute 'is_freshly_reset'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\app\handlers\message_processor.py", line 163, in _route_to_handler
    if self.session_manager.is_freshly_reset(session_id):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'SessionManager' object has no attribute 'is_freshly_reset'
2025-06-12 19:38:48,407 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "⚠️ Oops! Something went wrong. Let's get back to the main menu. Please try again."}}
2025-06-12 19:38:49,123 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjA0RDFERThEMkVBQTY1QTcxRgA="}]}
2025-06-12 19:38:49,124 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjA0RDFERThEMkVBQTY1QTcxRgA='}]}
2025-06-12 19:38:49,124 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:38:49] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:38:50,056 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:38:50] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:38:50,192 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:38:50] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:38:50,216 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:38:50] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:42:37,300 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-12 19:42:37,301 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-12 19:42:37,302 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-12 19:42:37,302 - services.payment_service - INFO - PaymentService initialized
2025-06-12 19:42:37,303 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-12 19:42:37,303 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-12 19:42:37,304 - services.payment_service - INFO - PaymentService initialized
2025-06-12 19:42:37,304 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-12 19:42:37,305 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-12 19:42:37,305 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-12 19:42:37,306 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-12 19:42:37,306 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-12 19:42:37,306 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-12 19:42:37,662 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-12 19:42:37,662 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-12 19:42:37,663 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-12 19:42:37,663 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-12 19:42:37,675 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-12 19:42:37,676 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-12 19:43:54,337 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-12 19:43:54,337 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-12 19:43:54,337 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-12 19:43:54,338 - services.payment_service - INFO - PaymentService initialized
2025-06-12 19:43:54,338 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-12 19:43:54,339 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-12 19:43:54,339 - services.payment_service - INFO - PaymentService initialized
2025-06-12 19:43:54,339 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-12 19:43:54,340 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-12 19:43:54,340 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-12 19:43:54,340 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-12 19:43:54,341 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-12 19:43:54,341 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-12 19:43:54,678 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-12 19:43:54,679 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-12 19:43:54,679 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-12 19:43:54,679 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-12 19:43:54,696 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-12 19:43:54,696 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-12 19:44:03,446 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-12 19:44:03,447 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-12 19:44:03,450 - handlers.base_handler - INFO - Session 2348055614455 recognized user 'Ziga'.
2025-06-12 19:44:03,450 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Welcome Ziga! 👋🏼\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-12 19:44:04,627 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjAzMzQ0N0E3OENBODhBN0QxOQA="}]}
2025-06-12 19:44:04,628 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjAzMzQ0N0E3OENBODhBN0QxOQA='}]}
2025-06-12 19:44:04,628 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:44:04] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:44:05,317 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:44:05] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:44:05,969 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:44:05] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:44:07,122 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'others_menu'}
2025-06-12 19:44:07,124 - handlers.base_handler - INFO - GreetingHandler: Handling message 'others_menu' in greeting state for session 2348055614455.
2025-06-12 19:44:07,124 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🔧 *Other Options*\n\nHere are other ways I can help you:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'enquiry', 'title': '❓ Enquiry'}}, {'type': 'reply', 'reply': {'id': 'complain', 'title': '📝 Complain'}}, {'type': 'reply', 'reply': {'id': 'back_to_main', 'title': '🔙 Back'}}]}}}
2025-06-12 19:44:07,786 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjY5NDc4RDIxODU0MUE5MDcyRAA="}]}
2025-06-12 19:44:07,787 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjY5NDc4RDIxODU0MUE5MDcyRAA='}]}
2025-06-12 19:44:07,788 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:44:07] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:44:08,541 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:44:08] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:44:08,773 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:44:08] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:44:08,917 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:44:08] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:44:10,072 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'complain'}
2025-06-12 19:44:10,075 - handlers.base_handler - INFO - GreetingHandler: Handling message 'complain' in 'others_menu_selection' state for session 2348055614455.
2025-06-12 19:44:10,075 - handlers.base_handler - INFO - Session 2348055614455 entering complaint state.
2025-06-12 19:44:10,076 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "We're sorry to hear you're having an issue. Please tell us about your complaint and we'll address it promptly."}}
2025-06-12 19:44:10,940 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjM2OTRGQ0UyNzMyNDM1NDZBMQA="}]}
2025-06-12 19:44:10,941 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjM2OTRGQ0UyNzMyNDM1NDZBMQA='}]}
2025-06-12 19:44:10,941 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:44:10] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:44:11,870 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:44:11] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:44:12,174 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:44:12] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:44:12,241 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:44:12] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:44:15,191 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Back delivery'}
2025-06-12 19:44:15,193 - handlers.complaint_handler - INFO - Complaint received from 2348055614455: Back delivery
2025-06-12 19:44:15,193 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': '✅ Thank you for your complaint! We have received it and will look into this issue promptly. We appreciate your patience.'}}
2025-06-12 19:44:15,871 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjBBRDY5REEzNkUxRjBGOEE1OQA="}]}
2025-06-12 19:44:15,872 - handlers.message_processor - WARNING - No specific handler or state match for handler 'complaint_handler', state 'complain', message 'back delivery' for session 2348055614455. Resetting to greeting and sending menu.
2025-06-12 19:44:15,872 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "I'm sorry, I didn't quite understand that. Let's get back to the main menu."}}
2025-06-12 19:44:16,548 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjAyNjlFNzkwNUZFMzVEQUEwNQA="}]}
2025-06-12 19:44:16,549 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Please choose from the options below:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-12 19:44:16,740 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:44:16] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:44:16,753 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:44:16] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:44:16,883 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:44:16] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:44:17,360 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:44:17] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:44:17,536 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:44:17] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:44:17,752 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:44:17] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:44:29,595 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkZDNDM4QkQ5QTg2Q0NGQzcwRgA="}]}
2025-06-12 19:44:29,595 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkZDNDM4QkQ5QTg2Q0NGQzcwRgA='}]}
2025-06-12 19:44:29,596 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:44:29] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:44:30,163 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:44:30] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:44:30,540 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:44:30] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:46:40,105 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-12 19:46:40,108 - handlers.base_handler - INFO - GreetingHandler: Handling message 'hello' in greeting state for session 2348055614455.
2025-06-12 19:46:40,108 - handlers.base_handler - WARNING - Session 2348055614455: Invalid option 'hello' in greeting state.
2025-06-12 19:46:40,109 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Invalid option. Please choose from the options below:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-12 19:46:40,862 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjc3RDVBQTkxRkI1QzMwQzA4NQA="}]}
2025-06-12 19:46:40,862 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjc3RDVBQTkxRkI1QzMwQzA4NQA='}]}
2025-06-12 19:46:40,863 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:46:40] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:46:41,639 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:46:41] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:46:42,560 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:46:42] "POST /webhook HTTP/1.1" 200 -
2025-06-12 19:47:03,077 - werkzeug - INFO - 127.0.0.1 - - [12/Jun/2025 19:47:03] "POST /webhook HTTP/1.1" 200 -
2025-06-19 10:44:14,084 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-19 10:44:14,084 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 10:44:14,085 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 10:44:14,086 - services.payment_service - INFO - PaymentService initialized
2025-06-19 10:44:14,086 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 10:44:14,086 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 10:44:14,087 - services.payment_service - INFO - PaymentService initialized
2025-06-19 10:44:14,087 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-19 10:44:14,088 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-19 10:44:14,089 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-19 10:44:14,089 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 10:44:14,090 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-19 10:44:14,090 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-19 10:44:14,497 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-19 10:44:14,498 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-19 10:44:14,498 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-19 10:44:14,498 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 10:44:14,532 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-19 10:44:14,533 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-19 11:14:11,947 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 11:14:11] "POST /webhook HTTP/1.1" 200 -
2025-06-19 11:20:16,411 - handlers.webhook_handler - INFO - Processing message from 2348100187907 (User: olamak2): {'type': 'text', 'text': 'Can you check Ibom Air'}
2025-06-19 11:20:16,411 - utils.session_manager - INFO - New session 2348100187907 initialized.
2025-06-19 11:20:16,466 - services.lead_tracker - INFO - New lead tracked: 2348100187907 (olamak2)
2025-06-19 11:20:16,467 - handlers.lead_tracking_handler - INFO - 🆕 New lead detected: 2348100187907 (olamak2)
2025-06-19 11:20:16,474 - handlers.base_handler - INFO - Session 2348100187907 identified as guest, prompting for name and address.
2025-06-19 11:20:16,475 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348100187907', 'type': 'text', 'text': {'body': 'Hello Guest, welcome to Lola! 👋🏼\n\nWhat is your preferred name and address?'}}
2025-06-19 11:20:18,906 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348100187907","wa_id":"2348100187907"}],"messages":[{"id":"wamid.HBgNMjM0ODEwMDE4NzkwNxUCABEYEkU2RjNCQkNBRjYzNURFQzYxOAA="}]}
2025-06-19 11:20:18,909 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348100187907', 'wa_id': '2348100187907'}], 'messages': [{'id': 'wamid.HBgNMjM0ODEwMDE4NzkwNxUCABEYEkU2RjNCQkNBRjYzNURFQzYxOAA='}]}
2025-06-19 11:20:18,910 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 11:20:18] "POST /webhook HTTP/1.1" 200 -
2025-06-19 11:20:21,680 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 11:20:21] "POST /webhook HTTP/1.1" 200 -
2025-06-19 11:32:02,828 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 11:32:02] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:08:20,786 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-19 13:08:20,787 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-19 13:08:20,839 - handlers.base_handler - INFO - Session 2348055614455 recognized user 'Ziga'.
2025-06-19 13:08:20,841 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Welcome Ziga! 👋🏼\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-19 13:08:23,277 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkM5RTI1MkU5MzRCNUQxREI1QQA="}]}
2025-06-19 13:08:23,278 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkM5RTI1MkU5MzRCNUQxREI1QQA='}]}
2025-06-19 13:08:23,279 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:08:23] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:08:25,778 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:08:25] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:08:26,296 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:08:26] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:08:31,342 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-19 13:08:31,345 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-06-19 13:08:31,345 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-06-19 13:08:31,346 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with initial message 'start_ai_bulk_order'.
2025-06-19 13:08:31,346 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-06-19 13:08:31,347 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Just send me your full order in one message! \n\nLike this: 'Two plates of jollof rice, 2 Cokes, and asun.'\n\nWant to go back again? Type ‘menu’ to return. "}}
2025-06-19 13:08:33,192 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjlCMEJBRjU4MURDM0RCNkE4NgA="}]}
2025-06-19 13:08:33,193 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjlCMEJBRjU4MURDM0RCNkE4NgA='}]}
2025-06-19 13:08:33,193 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:08:33] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:08:34,216 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:08:34] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:08:34,219 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:08:34] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:08:34,461 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:08:34] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:08:41,094 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': '2 fried rice'}
2025-06-19 13:08:41,097 - handlers.base_handler - INFO - AIHandler: Handling message '2 fried rice' in AI bulk order state for session 2348055614455. Original: '2 fried rice'
2025-06-19 13:08:46,073 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-19 13:08:46,083 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🛒 *Order Summary:*\n\n✅ 2x Fried Rice Fiesta - ₦2,800\n\n*Total: ₦2,800.00*\n\nWould you like to proceed with this order?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'confirm_ai_order', 'title': '✅ Confirm Order'}}, {'type': 'reply', 'reply': {'id': 'modify_ai_order', 'title': '✏️ Modify Order'}}, {'type': 'reply', 'reply': {'id': 'cancel_ai_order', 'title': '❌ Cancel'}}]}}}
2025-06-19 13:09:06,468 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': '2 fried rice'}
2025-06-19 13:09:06,470 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': 'Please choose from the available options.'}}
2025-06-19 13:09:07,519 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkFCNjdGQUQ2RUU0NDZCNzU5RgA="}]}
2025-06-19 13:09:07,519 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkFCNjdGQUQ2RUU0NDZCNzU5RgA='}]}
2025-06-19 13:09:07,520 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:09:07] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:09:08,823 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:09:08] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:09:09,072 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:09:09] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:09:14,386 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjNDQjI2REQxMENDODFGQzk3RgA="}]}
2025-06-19 13:09:14,387 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjNDQjI2REQxMENDODFGQzk3RgA='}]}
2025-06-19 13:09:14,387 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:09:14] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:09:15,729 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:09:15] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:09:15,731 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:09:15] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:09:15,733 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:09:15] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:09:18,453 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-06-19 13:09:18,455 - handlers.base_handler - INFO - AI order confirmed. Cart: {'Fried Rice Fiesta': {'item_id': 'Fried Rice Fiesta', 'quantity': 2, 'price': 1400, 'total_price': 2800, 'variations': {}}}. Redirecting to order handler.
2025-06-19 13:09:18,456 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'order_handler' with initial message 'process_final_order'.
2025-06-19 13:09:18,456 - handlers.message_processor - ERROR - Error in message routing for handler 'order_handler', state 'confirm_details' for session 2348055614455: 'OrderHandler' object has no attribute 'handle_confirm_details_state'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\app\handlers\message_processor.py", line 235, in _route_to_handler
    response = self.order_handler.handle_confirm_details_state(state, message, original_message, session_id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'OrderHandler' object has no attribute 'handle_confirm_details_state'
2025-06-19 13:09:18,473 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "⚠️ Oops! Something went wrong. Let's get back to the main menu. Please try again."}}
2025-06-19 13:09:21,301 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjUwMTk5QzdEMTJDREIxRTk2QwA="}]}
2025-06-19 13:09:21,307 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦2,800 (1 items)
2025-06-19 13:09:21,307 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦2,800.00
2025-06-19 13:09:21,307 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjUwMTk5QzdEMTJDREIxRTk2QwA='}]}
2025-06-19 13:09:21,308 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:09:21] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:09:22,690 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:09:22] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:09:22,692 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:09:22] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:09:22,694 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:09:22] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:14:19,436 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-19 13:14:19,436 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 13:14:19,436 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 13:14:19,437 - services.payment_service - INFO - PaymentService initialized
2025-06-19 13:14:19,437 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 13:14:19,438 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 13:14:19,438 - services.payment_service - INFO - PaymentService initialized
2025-06-19 13:14:19,438 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-19 13:14:19,439 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-19 13:14:19,440 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-19 13:14:19,440 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 13:14:19,440 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-19 13:14:19,440 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-19 13:14:19,834 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-19 13:14:19,834 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-19 13:14:19,835 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-19 13:14:19,835 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 13:14:19,873 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-19 13:14:19,873 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-19 13:14:28,848 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-19 13:14:28,848 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-19 13:14:28,851 - handlers.base_handler - INFO - Session 2348055614455 recognized user 'Ziga'.
2025-06-19 13:14:28,852 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Welcome Ziga! 👋🏼\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-19 13:14:30,031 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjZCODcxMEJGQTlGREQyMzQwNQA="}]}
2025-06-19 13:14:30,031 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjZCODcxMEJGQTlGREQyMzQwNQA='}]}
2025-06-19 13:14:30,032 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:14:30] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:14:31,070 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:14:31] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:14:31,858 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:14:31] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:14:33,046 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-19 13:14:33,048 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-06-19 13:14:33,049 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-06-19 13:14:33,049 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with initial message 'start_ai_bulk_order'.
2025-06-19 13:14:33,049 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-06-19 13:14:33,050 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Just send me your full order in one message! \n\nLike this: 'Two plates of jollof rice, 2 Cokes, and asun.'\n\nWant to go back again? Type ‘menu’ to return. "}}
2025-06-19 13:14:34,082 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjJDQ0RCOTdGODRGQUI3RjU4OQA="}]}
2025-06-19 13:14:34,082 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjJDQ0RCOTdGODRGQUI3RjU4OQA='}]}
2025-06-19 13:14:34,083 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:14:34] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:14:35,162 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:14:35] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:14:35,253 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:14:35] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:14:40,857 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': '2 fried rice'}
2025-06-19 13:14:40,860 - handlers.base_handler - INFO - AIHandler: Handling message '2 fried rice' in AI bulk order state for session 2348055614455. Original: '2 fried rice'
2025-06-19 13:14:43,110 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-19 13:14:43,112 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🛒 *Order Summary:*\n\n✅ 2x Fried Rice Fiesta - ₦2,800\n\n*Total: ₦2,800.00*\n\nWould you like to proceed with this order?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'confirm_ai_order', 'title': '✅ Confirm Order'}}, {'type': 'reply', 'reply': {'id': 'modify_ai_order', 'title': '✏️ Modify Order'}}, {'type': 'reply', 'reply': {'id': 'cancel_ai_order', 'title': '❌ Cancel'}}]}}}
2025-06-19 13:14:44,053 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkUzRUE1RUIxM0ZCMzFCMTdDNAA="}]}
2025-06-19 13:14:44,054 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkUzRUE1RUIxM0ZCMzFCMTdDNAA='}]}
2025-06-19 13:14:44,055 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:14:44] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:14:45,124 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:14:45] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:14:45,168 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:14:45] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:14:46,781 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-06-19 13:14:46,784 - handlers.base_handler - INFO - AI order confirmed. Cart: {'Fried Rice Fiesta': {'item_id': 'Fried Rice Fiesta', 'quantity': 2, 'price': 1400, 'total_price': 2800, 'variations': {}}}. Redirecting to order handler.
2025-06-19 13:14:46,784 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'order_handler' with initial message 'process_final_order'.
2025-06-19 13:14:46,785 - handlers.message_processor - ERROR - Error in message routing for handler 'order_handler', state 'confirm_details' for session 2348055614455: OrderHandler.handle_confirm_details_state() takes 4 positional arguments but 5 were given
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\app\handlers\message_processor.py", line 235, in _route_to_handler
    response = self.order_handler.handle_confirm_details_state(state, message, original_message, session_id)
TypeError: OrderHandler.handle_confirm_details_state() takes 4 positional arguments but 5 were given
2025-06-19 13:14:46,786 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "⚠️ Oops! Something went wrong. Let's get back to the main menu. Please try again."}}
2025-06-19 13:14:47,913 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjU2MjI4NEE5OEYwMjJCNTA4MAA="}]}
2025-06-19 13:14:47,916 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦2,800 (1 items)
2025-06-19 13:14:47,916 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦2,800.00
2025-06-19 13:14:47,917 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjU2MjI4NEE5OEYwMjJCNTA4MAA='}]}
2025-06-19 13:14:47,917 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:14:47] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:14:48,974 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:14:48] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:14:48,994 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:14:48] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:16:18,304 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-19 13:16:18,304 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 13:16:18,305 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 13:16:18,306 - services.payment_service - INFO - PaymentService initialized
2025-06-19 13:16:18,306 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 13:16:18,307 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 13:16:18,307 - services.payment_service - INFO - PaymentService initialized
2025-06-19 13:16:18,307 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-19 13:16:18,308 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-19 13:16:18,308 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-19 13:16:18,308 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 13:16:18,309 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-19 13:16:18,309 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-19 13:16:18,671 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-19 13:16:18,672 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-19 13:16:18,672 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-19 13:16:18,672 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 13:16:18,684 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-19 13:16:18,685 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-19 13:16:27,243 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Heklo'}
2025-06-19 13:16:27,243 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-19 13:16:27,247 - handlers.base_handler - INFO - Session 2348055614455 recognized user 'Ziga'.
2025-06-19 13:16:27,248 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Welcome Ziga! 👋🏼\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-19 13:16:28,233 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQ5MEI3REZGNEM2REEyNkUwMAA="}]}
2025-06-19 13:16:28,234 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQ5MEI3REZGNEM2REEyNkUwMAA='}]}
2025-06-19 13:16:28,235 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:16:28] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:16:29,231 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:16:29] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:16:29,534 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:16:29] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:16:30,455 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-19 13:16:30,457 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-06-19 13:16:30,458 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-06-19 13:16:30,458 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with initial message 'start_ai_bulk_order'.
2025-06-19 13:16:30,458 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-06-19 13:16:30,459 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Just send me your full order in one message! \n\nLike this: 'Two plates of jollof rice, 2 Cokes, and asun.'\n\nWant to go back again? Type ‘menu’ to return. "}}
2025-06-19 13:16:31,386 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjk0RUE4RUUwNzY0M0IyMDY0RQA="}]}
2025-06-19 13:16:31,387 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjk0RUE4RUUwNzY0M0IyMDY0RQA='}]}
2025-06-19 13:16:31,387 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:16:31] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:16:32,212 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:16:32] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:16:32,496 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:16:32] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:16:36,473 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': '2 fried rice'}
2025-06-19 13:16:36,475 - handlers.base_handler - INFO - AIHandler: Handling message '2 fried rice' in AI bulk order state for session 2348055614455. Original: '2 fried rice'
2025-06-19 13:16:38,850 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-19 13:16:38,853 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🛒 *Order Summary:*\n\n✅ 2x Fried Rice Fiesta - ₦2,800\n\n*Total: ₦2,800.00*\n\nWould you like to proceed with this order?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'confirm_ai_order', 'title': '✅ Confirm Order'}}, {'type': 'reply', 'reply': {'id': 'modify_ai_order', 'title': '✏️ Modify Order'}}, {'type': 'reply', 'reply': {'id': 'cancel_ai_order', 'title': '❌ Cancel'}}]}}}
2025-06-19 13:16:39,912 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjRENEVGQzU1MEU2OTg0NTg1QwA="}]}
2025-06-19 13:16:39,913 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjRENEVGQzU1MEU2OTg0NTg1QwA='}]}
2025-06-19 13:16:39,913 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:16:39] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:16:41,479 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:16:41] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:16:41,849 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:16:41] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:16:41,862 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:16:41] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:16:43,673 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-06-19 13:16:43,675 - handlers.base_handler - INFO - AI order confirmed. Cart: {'Fried Rice Fiesta': {'item_id': 'Fried Rice Fiesta', 'quantity': 2, 'price': 1400, 'total_price': 2800, 'variations': {}}}. Redirecting to order handler.
2025-06-19 13:16:43,676 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'order_handler' with initial message 'process_final_order'.
2025-06-19 13:16:43,676 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🛒 *ORDER SUMMARY*\n\n📋 *Items Ordered:*\n• 2x Fried Rice Fiesta - ₦2,800.00\n\n📍 *Delivery Details:*\n👤 Name: Ziga\n📱 Phone: 2348055614455\n🏠 Address: Howson Wright\n\n💰 *Total Amount: ₦2,800.00*\n\nPlease review your order and delivery details:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'confirm_order', 'title': '✅ Confirm Order'}}, {'type': 'reply', 'reply': {'id': 'modify_order', 'title': '✏️ Modify Order'}}, {'type': 'reply', 'reply': {'id': 'change_address', 'title': '📍 Change Address'}}]}}}
2025-06-19 13:16:44,615 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkM5QTkzOUEwNUE2MDQxNTk1RgA="}]}
2025-06-19 13:16:44,629 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦2,800 (1 items)
2025-06-19 13:16:44,630 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦2,800.00
2025-06-19 13:16:44,630 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkM5QTkzOUEwNUE2MDQxNTk1RgA='}]}
2025-06-19 13:16:44,631 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:16:44] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:16:45,463 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:16:45] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:16:45,543 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:16:45] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:16:46,023 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:16:46] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:16:49,820 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_order'}
2025-06-19 13:16:49,823 - handlers.order_handler - INFO - User confirmed order for session 2348055614455.
2025-06-19 13:16:49,823 - handlers.order_handler - INFO - Order ORDER_20250619_131649_e85d2e1c confirmed for session 2348055614455. Amount: ₦2,800.00
2025-06-19 13:16:49,827 - services.lead_tracker - INFO - Order completion tracked for 2348055614455: ORDER_20250619_131649_e85d2e1c (₦2,800)
2025-06-19 13:16:49,827 - handlers.lead_tracking_handler - INFO - 💰 Conversion tracked: 2348055614455 - ORDER_20250619_131649_e85d2e1c (₦2,800)
2025-06-19 13:16:49,828 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'payment_handler' with initial message 'initiate_payment'.
2025-06-19 13:16:49,828 - handlers.message_processor - ERROR - Error in message routing for handler 'payment_handler', state 'payment_processing' for session 2348055614455: PaymentHandler.handle_payment_processing_state() takes 4 positional arguments but 5 were given
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\app\handlers\message_processor.py", line 251, in _route_to_handler
    response = self.payment_handler.handle_payment_processing_state(state, message, original_message, session_id)
TypeError: PaymentHandler.handle_payment_processing_state() takes 4 positional arguments but 5 were given
2025-06-19 13:16:49,830 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "⚠️ Oops! Something went wrong. Let's get back to the main menu. Please try again."}}
2025-06-19 13:16:50,772 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjkxRUFBMDRCMDUwRDUxOTEyRgA="}]}
2025-06-19 13:16:50,775 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦2,800 (1 items)
2025-06-19 13:16:50,775 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦2,800.00
2025-06-19 13:16:50,776 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjkxRUFBMDRCMDUwRDUxOTEyRgA='}]}
2025-06-19 13:16:50,776 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:16:50] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:16:51,743 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:16:51] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:16:51,820 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:16:51] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:16:52,003 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:16:52] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:18:26,079 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-19 13:18:26,080 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 13:18:26,080 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 13:18:26,081 - services.payment_service - INFO - PaymentService initialized
2025-06-19 13:18:26,081 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 13:18:26,081 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 13:18:26,082 - services.payment_service - INFO - PaymentService initialized
2025-06-19 13:18:26,082 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-19 13:18:26,082 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-19 13:18:26,083 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-19 13:18:26,083 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 13:18:26,083 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-19 13:18:26,084 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-19 13:18:26,442 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-19 13:18:26,442 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-19 13:18:26,443 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-19 13:18:26,443 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 13:18:26,455 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-19 13:18:26,456 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-19 13:18:30,542 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-19 13:18:30,542 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-19 13:18:30,546 - handlers.base_handler - INFO - Session 2348055614455 recognized user 'Ziga'.
2025-06-19 13:18:30,546 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Welcome Ziga! 👋🏼\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-19 13:18:31,656 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjY3MDEyRjA3MjU5NTY4OUJBRgA="}]}
2025-06-19 13:18:31,657 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjY3MDEyRjA3MjU5NTY4OUJBRgA='}]}
2025-06-19 13:18:31,658 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:18:31] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:18:32,688 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:18:32] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:18:32,814 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:18:32] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:18:33,570 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-19 13:18:33,572 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-06-19 13:18:33,573 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-06-19 13:18:33,573 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-06-19 13:18:33,573 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-06-19 13:18:33,574 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Just send me your full order in one message! \n\nLike this: 'Two plates of jollof rice, 2 Cokes, and asun.'\n\nWant to go back again? Type ‘menu’ to return. "}}
2025-06-19 13:18:34,545 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkIyNzkxQTlBNEY1NDkwRkNCNAA="}]}
2025-06-19 13:18:34,546 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkIyNzkxQTlBNEY1NDkwRkNCNAA='}]}
2025-06-19 13:18:34,546 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:18:34] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:18:35,513 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:18:35] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:18:35,572 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:18:35] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:18:35,965 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:18:35] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:18:42,177 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': '2 fried rice'}
2025-06-19 13:18:42,180 - handlers.base_handler - INFO - AIHandler: Handling message '2 fried rice' in AI bulk order state for session 2348055614455. Original: '2 fried rice'
2025-06-19 13:18:44,424 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-19 13:18:44,426 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🛒 *Order Summary:*\n\n✅ 2x Fried Rice Fiesta - ₦2,800\n\n*Total: ₦2,800.00*\n\nWould you like to proceed with this order?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'confirm_ai_order', 'title': '✅ Confirm Order'}}, {'type': 'reply', 'reply': {'id': 'modify_ai_order', 'title': '✏️ Modify Order'}}, {'type': 'reply', 'reply': {'id': 'cancel_ai_order', 'title': '❌ Cancel'}}]}}}
2025-06-19 13:18:45,663 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjhBODlEMDM1NEZFRTZFOTcxQQA="}]}
2025-06-19 13:18:45,663 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjhBODlEMDM1NEZFRTZFOTcxQQA='}]}
2025-06-19 13:18:45,664 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:18:45] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:18:46,673 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:18:46] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:18:46,844 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:18:46] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:18:46,846 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:18:46] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:18:47,808 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-06-19 13:18:47,810 - handlers.base_handler - INFO - AI order confirmed. Cart: {'Fried Rice Fiesta': {'item_id': 'Fried Rice Fiesta', 'quantity': 2, 'price': 1400, 'total_price': 2800, 'variations': {}}}. Redirecting to order handler.
2025-06-19 13:18:47,811 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'order_handler' with message 'process_final_order'.
2025-06-19 13:18:47,811 - handlers.order_handler - INFO - AI initiated order processing for session 2348055614455.
2025-06-19 13:18:47,812 - handlers.order_handler - INFO - Address set, proceeding to confirm order for AI-initiated session 2348055614455.
2025-06-19 13:18:47,812 - handlers.order_handler - INFO - Showing final order confirmation for session 2348055614455. Total: ₦2,800.00
2025-06-19 13:18:47,813 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🛒 *Final Order Confirmation*\n\n📋 *Items Ordered:*\n• 2x Fried Rice Fiesta - ₦2,800.00\n\n📍 *Delivery Details:*\n👤 Name: Ziga\n📱 Phone: 2348055614455\n🏠 Address: Howson Wright\n\n💰 *Total Amount: ₦2,800.00*\n\nPlease confirm to proceed with payment.'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'final_confirm', 'title': '✅ Confirm & Pay'}}, {'type': 'reply', 'reply': {'id': 'edit_order', 'title': '✏️ Edit Order'}}, {'type': 'reply', 'reply': {'id': 'cancel_order', 'title': '❌ Cancel Order'}}]}}}
2025-06-19 13:18:49,183 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjcyQ0Q0REI5QjRGMTIzODk1MQA="}]}
2025-06-19 13:18:49,186 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦2,800 (1 items)
2025-06-19 13:18:49,187 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦2,800.00
2025-06-19 13:18:49,187 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjcyQ0Q0REI5QjRGMTIzODk1MQA='}]}
2025-06-19 13:18:49,187 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:18:49] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:18:50,004 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:18:50] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:18:50,023 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:18:50] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:18:50,107 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:18:50] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:18:54,830 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'final_confirm'}
2025-06-19 13:18:54,832 - handlers.order_handler - INFO - Order ORDER_20250619_131854_4fcff3ab confirmed for session 2348055614455. Amount: ₦2,800.00
2025-06-19 13:18:54,838 - services.lead_tracker - INFO - Order completion tracked for 2348055614455: ORDER_20250619_131854_4fcff3ab (₦2,800)
2025-06-19 13:18:54,838 - handlers.lead_tracking_handler - INFO - 💰 Conversion tracked: 2348055614455 - ORDER_20250619_131854_4fcff3ab (₦2,800)
2025-06-19 13:18:54,839 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'payment_handler' with message 'initiate_payment'.
2025-06-19 13:18:54,839 - handlers.base_handler - INFO - Handling payment processing for session 2348055614455, message: initiate_payment
2025-06-19 13:18:54,839 - handlers.base_handler - INFO - Creating payment link for session 2348055614455
2025-06-19 13:18:54,850 - utils.data_manager - INFO - Data saved to data\orders.json
2025-06-19 13:18:54,851 - utils.data_manager - INFO - Order details saved to data\orders.json
2025-06-19 13:18:54,852 - services.payment_service - INFO - Attempting to create payment link for reference: PAY-ORDER-20250619131854-1427 with amount: 280000, email: ziga4455@foodorder.com
2025-06-19 13:18:55,543 - services.payment_service - INFO - Payment link created for Ziga Ziga (2348055614455), URL: https://checkout.paystack.com/5hsapgd8gf6grfn
2025-06-19 13:18:55,543 - handlers.base_handler - INFO - Starting payment monitoring for order ORDER-20250619131854-1427, reference PAY-ORDER-20250619131854-1427
2025-06-19 13:18:55,544 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-ORDER-20250619131854-1427
2025-06-19 13:18:56,054 - services.payment_service - WARNING - Payment not successful for reference PAY-ORDER-20250619131854-1427. Paystack status: abandoned. Response: {'status': True, 'message': 'Verification successful', 'data': {'id': 5070795075, 'domain': 'test', 'status': 'abandoned', 'reference': 'PAY-ORDER-20250619131854-1427', 'receipt_number': None, 'amount': 280000, 'message': None, 'gateway_response': 'The transaction was not completed', 'paid_at': None, 'created_at': '2025-06-19T12:18:55.000Z', 'channel': 'card', 'currency': 'NGN', 'ip_address': '102.67.12.153, 172.70.86.27, 172.31.62.52', 'metadata': {'customer_name': 'Ziga', 'customer_phone': '2348055614455', 'first_name': 'Ziga', 'last_name': 'Ziga', 'order_id': 'ORDER-20250619131854-1427', 'delivery_address': 'Howson Wright'}, 'log': None, 'fees': None, 'fees_split': None, 'authorization': {}, 'customer': {'id': 276711440, 'first_name': None, 'last_name': None, 'email': 'ziga4455@foodorder.com', 'customer_code': 'CUS_bhkdpnbvcjqt55g', 'phone': None, 'metadata': None, 'risk_action': 'default', 'international_format_phone': None}, 'plan': None, 'split': {}, 'order_id': None, 'paidAt': None, 'createdAt': '2025-06-19T12:18:55.000Z', 'requested_amount': 280000, 'pos_transaction_data': None, 'source': None, 'fees_breakdown': None, 'connect': None, 'transaction_date': '2025-06-19T12:18:55.000Z', 'plan_object': {}, 'subaccount': {}}}
2025-06-19 13:18:56,055 - handlers.base_handler - INFO - Payment not yet verified for order ORDER-20250619131854-1427, attempt 1/15
2025-06-19 13:18:56,056 - handlers.base_handler - INFO - Payment link created successfully for order ORDER-20250619131854-1427
2025-06-19 13:18:56,056 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "🛒 **Order Created Successfully!**\n\n📋 **Order ID:** ORDER-20250619131854-1427\n💰 **Total:** ₦2,800\n\n💳 **Complete Payment:**\nhttps://checkout.paystack.com/5hsapgd8gf6grfn\n\n✅ We'll automatically confirm your order once payment is received!\n💬 You can also send 'paid' after payment to check status immediately.\n\n⏰ Payment link expires in 15 minutes."}}
2025-06-19 13:18:57,101 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkRGMTUzMzk2MDM3QUUyN0I1RgA="}]}
2025-06-19 13:18:57,105 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦2,800 (1 items)
2025-06-19 13:18:57,105 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦2,800.00
2025-06-19 13:18:57,105 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkRGMTUzMzk2MDM3QUUyN0I1RgA='}]}
2025-06-19 13:18:57,106 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:18:57] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:18:58,145 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:18:58] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:18:58,427 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:18:58] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:19:20,802 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Paid'}
2025-06-19 13:19:20,804 - handlers.base_handler - INFO - Received 'paid' command for session 2348055614455, attempting manual verification for ref: PAY-ORDER-20250619131854-1427
2025-06-19 13:19:20,805 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-ORDER-20250619131854-1427
2025-06-19 13:19:21,333 - services.payment_service - INFO - Payment verified successfully for reference PAY-ORDER-20250619131854-1427. Status: success
2025-06-19 13:19:21,335 - handlers.base_handler - INFO - Manual payment verification successful for order ORDER-20250619131854-1427
2025-06-19 13:19:21,335 - handlers.base_handler - INFO - Payment monitoring stopped for session 2348055614455
2025-06-19 13:19:21,341 - utils.data_manager - INFO - Data saved to data\orders.json
2025-06-19 13:19:21,342 - utils.data_manager - INFO - Order details saved to data\orders.json
2025-06-19 13:19:21,345 - services.lead_tracker - INFO - Order completion tracked for 2348055614455: ORDER-20250619131854-1427 (₦2,800)
2025-06-19 13:19:21,346 - handlers.lead_tracking_handler - INFO - 💰 Conversion tracked: 2348055614455 - ORDER-20250619131854-1427 (₦2,800)
2025-06-19 13:19:21,346 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "🎉 **Payment Confirmed!**\n\n📋 **Order ID:** ORDER-20250619131854-1427\n💰 **Amount Paid:** ₦2,800\n🛒 **Items:** 🛒 *Your Cart:*\n• 2 x Fried Rice Fiesta (₦1,400) = ₦2,800\n\n💰 *Total: ₦2,800*\n🚚 **Delivery to:** Howson Wright\n\n✅ Your order is confirmed and being processed!\n📱 You'll receive delivery updates soon.\n\n🙏 Thank you for your purchase! 😊"}}
2025-06-19 13:19:22,371 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkRBNzdBOEZEQThCOTYwMUFFNQA="}]}
2025-06-19 13:19:22,373 - handlers.feedback_handler - INFO - Initiated feedback collection for order ORDER-20250619131854-1427, session 2348055614455
2025-06-19 13:19:22,373 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🎉 *Thank you for your order!*\n\n📋 Order ID: ORDER-20250619131854-1427\n\n💬 *How was your ordering experience?*\nYour feedback helps us improve our service!'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'excellent', 'title': '🤩 Excellent'}}, {'type': 'reply', 'reply': {'id': 'good', 'title': '😊 Good'}}, {'type': 'reply', 'reply': {'id': 'bad', 'title': '😞 Bad'}}]}}}
2025-06-19 13:19:23,200 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:19:23] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:19:23,320 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjZGMDcwNzhGRTM4MzY1Mjg3MAA="}]}
2025-06-19 13:19:23,321 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'message': 'Payment confirmed and feedback initiated'}
2025-06-19 13:19:23,322 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:19:23] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:19:23,388 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:19:23] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:19:24,202 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:19:24] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:19:24,360 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:19:24] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:19:24,518 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:19:24] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:19:26,032 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'good'}
2025-06-19 13:19:26,034 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "👍 *Thank you for the good rating!*\n\n💬 Would you like to share any specific comments about your experience?\n\nType your message or 'skip' to finish."}}
2025-06-19 13:19:26,913 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjE2MTgzRTFBNzU2MDI0MEQwRQA="}]}
2025-06-19 13:19:26,913 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjE2MTgzRTFBNzU2MDI0MEQwRQA='}]}
2025-06-19 13:19:26,914 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:19:26] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:19:27,682 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:19:27] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:19:27,971 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:19:27] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:19:28,272 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:19:28] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:19:36,250 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Skip'}
2025-06-19 13:19:36,254 - handlers.feedback_handler - INFO - Feedback saved to data/feedback.json
2025-06-19 13:19:36,255 - handlers.feedback_handler - INFO - Feedback saved for order ORDER-20250619131854-1427: good
2025-06-19 13:19:36,255 - handlers.base_handler - INFO - Session 2348055614455 returned to main menu (greeting state).
2025-06-19 13:19:36,255 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🙏 *Thank you for your Good feedback!*\n\nWe appreciate you choosing us! 😊'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-19 13:19:37,331 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQ5QTA1OThDNzNBM0Y0NTdDQgA="}]}
2025-06-19 13:19:37,331 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQ5QTA1OThDNzNBM0Y0NTdDQgA='}]}
2025-06-19 13:19:37,332 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:19:37] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:19:38,091 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:19:38] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:19:38,252 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:19:38] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:19:38,372 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:19:38] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:24:32,843 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-19 13:24:32,843 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 13:24:32,844 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 13:24:32,844 - services.payment_service - INFO - PaymentService initialized
2025-06-19 13:24:32,844 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 13:24:32,845 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 13:24:32,845 - services.payment_service - INFO - PaymentService initialized
2025-06-19 13:24:32,846 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-19 13:24:32,846 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-19 13:24:32,846 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-19 13:24:32,847 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 13:24:32,847 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-19 13:24:32,847 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-19 13:24:33,203 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-19 13:24:33,204 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-19 13:24:33,204 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-19 13:24:33,204 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 13:24:33,221 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-19 13:24:33,221 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-19 13:24:37,230 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-19 13:24:37,231 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-19 13:24:37,235 - handlers.base_handler - INFO - Session 2348055614455 recognized user 'Ziga'.
2025-06-19 13:24:37,235 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Welcome Ziga! 👋🏼\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-19 13:24:38,259 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkI3NzIyMUQ3MTkzMDVEMzVEMQA="}]}
2025-06-19 13:24:38,260 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkI3NzIyMUQ3MTkzMDVEMzVEMQA='}]}
2025-06-19 13:24:38,260 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:24:38] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:24:39,141 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:24:39] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:24:39,252 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:24:39] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:24:39,360 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:24:39] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:24:40,132 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-19 13:24:40,134 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-06-19 13:24:40,135 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-06-19 13:24:40,135 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-06-19 13:24:40,135 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-06-19 13:24:40,136 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Just send me your full order in one message! \n\nLike this: 'Two plates of jollof rice, 2 Cokes, and asun.'\n\nWant to go back again? Type ‘menu’ to return. "}}
2025-06-19 13:24:41,250 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjNCQzI2QzJERjEwODFGQ0YyNQA="}]}
2025-06-19 13:24:41,251 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjNCQzI2QzJERjEwODFGQ0YyNQA='}]}
2025-06-19 13:24:41,251 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:24:41] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:24:42,153 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:24:42] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:24:42,279 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:24:42] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:24:42,521 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:24:42] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:24:45,901 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Puff puff'}
2025-06-19 13:24:45,904 - handlers.base_handler - INFO - AIHandler: Handling message 'puff puff' in AI bulk order state for session 2348055614455. Original: 'Puff puff'
2025-06-19 13:24:48,273 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-19 13:24:48,275 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🛒 *Order Summary:*\n\n✅ 1x Puff Puff - ₦200\n\n*Total: ₦200.00*\n\nWould you like to proceed with this order?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'confirm_ai_order', 'title': '✅ Confirm Order'}}, {'type': 'reply', 'reply': {'id': 'modify_ai_order', 'title': '✏️ Modify Order'}}, {'type': 'reply', 'reply': {'id': 'cancel_ai_order', 'title': '❌ Cancel'}}]}}}
2025-06-19 13:24:49,092 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjFCN0U2MkExMjQxQTZGNzc2RAA="}]}
2025-06-19 13:24:49,093 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjFCN0U2MkExMjQxQTZGNzc2RAA='}]}
2025-06-19 13:24:49,094 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:24:49] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:24:49,833 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:24:49] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:24:50,292 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:24:50] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:24:50,429 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:24:50] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:24:51,482 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-06-19 13:24:51,484 - handlers.base_handler - INFO - AI order confirmed. Cart: {'Puff Puff': {'item_id': 'Puff Puff', 'quantity': 1, 'price': 200, 'total_price': 200, 'variations': {}}}. Redirecting to order handler.
2025-06-19 13:24:51,485 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'order_handler' with message 'process_final_order'.
2025-06-19 13:24:51,485 - handlers.order_handler - INFO - AI initiated order processing for session 2348055614455.
2025-06-19 13:24:51,486 - handlers.order_handler - INFO - Address set, proceeding to confirm order for AI-initiated session 2348055614455.
2025-06-19 13:24:51,486 - handlers.order_handler - INFO - Showing final order confirmation for session 2348055614455. Total: ₦200.00
2025-06-19 13:24:51,487 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🛒 *Final Order Confirmation*\n\n📋 *Items Ordered:*\n• 1x Puff Puff - ₦200.00\n\n📍 *Delivery Details:*\n👤 Name: Ziga\n📱 Phone: 2348055614455\n🏠 Address: Howson Wright\n\n💰 *Total Amount: ₦200.00*\n\nPlease confirm to proceed with payment.'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'final_confirm', 'title': '✅ Confirm & Pay'}}, {'type': 'reply', 'reply': {'id': 'edit_order', 'title': '✏️ Edit Order'}}, {'type': 'reply', 'reply': {'id': 'cancel_order', 'title': '❌ Cancel Order'}}]}}}
2025-06-19 13:24:52,314 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjBFQ0IwOTU4RkIyQTdDRDVFNAA="}]}
2025-06-19 13:24:52,317 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦200 (1 items)
2025-06-19 13:24:52,318 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦200.00
2025-06-19 13:24:52,318 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjBFQ0IwOTU4RkIyQTdDRDVFNAA='}]}
2025-06-19 13:24:52,319 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:24:52] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:24:53,092 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:24:53] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:24:53,313 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:24:53] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:24:53,485 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:24:53] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:24:54,220 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'final_confirm'}
2025-06-19 13:24:54,222 - handlers.order_handler - INFO - Order ORDER_20250619_132454_95f225a7 confirmed for session 2348055614455. Amount: ₦200.00
2025-06-19 13:24:54,226 - services.lead_tracker - INFO - Order completion tracked for 2348055614455: ORDER_20250619_132454_95f225a7 (₦200)
2025-06-19 13:24:54,226 - handlers.lead_tracking_handler - INFO - 💰 Conversion tracked: 2348055614455 - ORDER_20250619_132454_95f225a7 (₦200)
2025-06-19 13:24:54,227 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'payment_handler' with message 'initiate_payment'.
2025-06-19 13:24:54,227 - handlers.base_handler - INFO - Handling payment processing for session 2348055614455, message: initiate_payment
2025-06-19 13:24:54,227 - handlers.base_handler - INFO - Creating payment link for session 2348055614455
2025-06-19 13:24:54,236 - utils.data_manager - INFO - Data saved to data\orders.json
2025-06-19 13:24:54,236 - utils.data_manager - INFO - Order details saved to data\orders.json
2025-06-19 13:24:54,237 - services.payment_service - INFO - Attempting to create payment link for reference: PAY-ORDER-20250619132454-9291 with amount: 20000, email: ziga4455@foodorder.com
2025-06-19 13:24:54,951 - services.payment_service - INFO - Payment link created for Ziga Ziga (2348055614455), URL: https://checkout.paystack.com/53u7bgby8oec23x
2025-06-19 13:24:54,951 - handlers.base_handler - INFO - Starting payment monitoring for order ORDER-20250619132454-9291, reference PAY-ORDER-20250619132454-9291
2025-06-19 13:24:54,952 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-ORDER-20250619132454-9291
2025-06-19 13:24:55,464 - services.payment_service - WARNING - Payment not successful for reference PAY-ORDER-20250619132454-9291. Paystack status: abandoned. Response: {'status': True, 'message': 'Verification successful', 'data': {'id': 5070813814, 'domain': 'test', 'status': 'abandoned', 'reference': 'PAY-ORDER-20250619132454-9291', 'receipt_number': None, 'amount': 20000, 'message': None, 'gateway_response': 'The transaction was not completed', 'paid_at': None, 'created_at': '2025-06-19T12:24:55.000Z', 'channel': 'card', 'currency': 'NGN', 'ip_address': '102.67.12.153, 141.101.99.4, 172.31.62.52', 'metadata': {'customer_name': 'Ziga', 'customer_phone': '2348055614455', 'first_name': 'Ziga', 'last_name': 'Ziga', 'order_id': 'ORDER-20250619132454-9291', 'delivery_address': 'Howson Wright'}, 'log': None, 'fees': None, 'fees_split': None, 'authorization': {}, 'customer': {'id': 276711440, 'first_name': None, 'last_name': None, 'email': 'ziga4455@foodorder.com', 'customer_code': 'CUS_bhkdpnbvcjqt55g', 'phone': None, 'metadata': None, 'risk_action': 'default', 'international_format_phone': None}, 'plan': None, 'split': {}, 'order_id': None, 'paidAt': None, 'createdAt': '2025-06-19T12:24:55.000Z', 'requested_amount': 20000, 'pos_transaction_data': None, 'source': None, 'fees_breakdown': None, 'connect': None, 'transaction_date': '2025-06-19T12:24:55.000Z', 'plan_object': {}, 'subaccount': {}}}
2025-06-19 13:24:55,465 - handlers.base_handler - INFO - Payment not yet verified for order ORDER-20250619132454-9291, attempt 1/15
2025-06-19 13:24:55,466 - handlers.base_handler - INFO - Payment link created successfully for order ORDER-20250619132454-9291
2025-06-19 13:24:55,466 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "🛒 **Order Created Successfully!**\n\n📋 **Order ID:** ORDER-20250619132454-9291\n💰 **Total:** ₦200\n\n💳 **Complete Payment:**\nhttps://checkout.paystack.com/53u7bgby8oec23x\n\n✅ We'll automatically confirm your order once payment is received!\n💬 You can also send 'paid' after payment to check status immediately.\n\n⏰ Payment link expires in 15 minutes."}}
2025-06-19 13:24:56,547 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkMzOEZEMDIyMjhDMzE4RTcwRAA="}]}
2025-06-19 13:24:56,551 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦200 (1 items)
2025-06-19 13:24:56,551 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦200.00
2025-06-19 13:24:56,551 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkMzOEZEMDIyMjhDMzE4RTcwRAA='}]}
2025-06-19 13:24:56,552 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:24:56] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:24:57,189 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:24:57] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:24:57,554 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-19 13:24:57,557 - handlers.base_handler - INFO - User sent message while still awaiting payment for order ORDER-20250619132454-9291.
2025-06-19 13:24:57,558 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "🔄 **Payment Monitoring Active**\n\nWe're automatically checking your payment status every minute.\n\n📋 **Order ID:** ORDER-20250619132454-9291\n\n✅ Once payment is confirmed, you'll receive an automatic confirmation.\n💬 Send 'paid' to check status immediately.\n❌ Send 'cancel' to cancel this order."}}
2025-06-19 13:24:57,653 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:24:57] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:24:58,757 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjY5Njk4QTJGNDU3MzlDQTkxMgA="}]}
2025-06-19 13:24:58,761 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦200 (1 items)
2025-06-19 13:24:58,761 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦200.00
2025-06-19 13:24:58,762 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjY5Njk4QTJGNDU3MzlDQTkxMgA='}]}
2025-06-19 13:24:58,762 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:24:58] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:24:59,569 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:24:59] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:24:59,700 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:24:59] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:24:59,793 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:24:59] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:25:07,740 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:25:07] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:25:20,451 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Paid'}
2025-06-19 13:25:20,453 - handlers.base_handler - INFO - Received 'paid' command for session 2348055614455, attempting manual verification for ref: PAY-ORDER-20250619132454-9291
2025-06-19 13:25:20,454 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-ORDER-20250619132454-9291
2025-06-19 13:25:20,996 - services.payment_service - INFO - Payment verified successfully for reference PAY-ORDER-20250619132454-9291. Status: success
2025-06-19 13:25:20,997 - handlers.base_handler - INFO - Manual payment verification successful for order ORDER-20250619132454-9291
2025-06-19 13:25:20,998 - handlers.base_handler - INFO - Payment monitoring stopped for session 2348055614455
2025-06-19 13:25:21,004 - utils.data_manager - INFO - Data saved to data\orders.json
2025-06-19 13:25:21,004 - utils.data_manager - INFO - Order details saved to data\orders.json
2025-06-19 13:25:21,007 - services.lead_tracker - INFO - Order completion tracked for 2348055614455: ORDER-20250619132454-9291 (₦200)
2025-06-19 13:25:21,007 - handlers.lead_tracking_handler - INFO - 💰 Conversion tracked: 2348055614455 - ORDER-20250619132454-9291 (₦200)
2025-06-19 13:25:21,008 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "🎉 **Payment Confirmed!**\n\n📋 **Order ID:** ORDER-20250619132454-9291\n💰 **Amount Paid:** ₦200\n🛒 **Items:** 🛒 *Your Cart:*\n• 1 x Puff Puff (₦200) = ₦200\n\n💰 *Total: ₦200*\n🚚 **Delivery to:** Howson Wright\n\n✅ Your order is confirmed and being processed!\n📱 You'll receive delivery updates soon.\n\n🙏 Thank you for your purchase! 😊"}}
2025-06-19 13:25:22,021 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjgxMTE3OUU5MDM0OTNBRjdDQwA="}]}
2025-06-19 13:25:22,021 - handlers.feedback_handler - INFO - Initiated feedback collection for order ORDER-20250619132454-9291, session 2348055614455
2025-06-19 13:25:22,022 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🎉 *Thank you for your order!*\n\n📋 Order ID: ORDER-20250619132454-9291\n\n💬 *How was your ordering experience?*\nYour feedback helps us improve our service!'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'excellent', 'title': '🤩 Excellent'}}, {'type': 'reply', 'reply': {'id': 'good', 'title': '😊 Good'}}, {'type': 'reply', 'reply': {'id': 'bad', 'title': '😞 Bad'}}]}}}
2025-06-19 13:25:23,080 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjIyNzg0MkFCMUQwMEJFQjFERAA="}]}
2025-06-19 13:25:23,081 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'message': 'Payment confirmed and feedback initiated'}
2025-06-19 13:25:23,081 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:25:23] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:25:23,082 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:25:23] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:25:23,109 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:25:23] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:25:23,780 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:25:23] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:25:24,107 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:25:24] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:25:24,245 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:25:24] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:25:27,338 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'good'}
2025-06-19 13:25:27,341 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "👍 *Thank you for the good rating!*\n\n💬 Would you like to share any specific comments about your experience?\n\nType your message or 'skip' to finish."}}
2025-06-19 13:25:28,300 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjVBNzQ3Q0REQTBDMjc5MTlDOQA="}]}
2025-06-19 13:25:28,301 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjVBNzQ3Q0REQTBDMjc5MTlDOQA='}]}
2025-06-19 13:25:28,301 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:25:28] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:25:29,009 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:25:29] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:25:29,285 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:25:29] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:25:29,330 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:25:29] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:25:32,945 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Skip'}
2025-06-19 13:25:32,948 - handlers.feedback_handler - INFO - Feedback saved to data/feedback.json
2025-06-19 13:25:32,949 - handlers.feedback_handler - INFO - Feedback saved for order ORDER-20250619132454-9291: good
2025-06-19 13:25:32,949 - handlers.base_handler - INFO - Session 2348055614455 returned to main menu (greeting state).
2025-06-19 13:25:32,949 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🙏 *Thank you for your Good feedback!*\n\n'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-19 13:25:34,027 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjBDNjVCRjJBRjNFRDE0QzBERQA="}]}
2025-06-19 13:25:34,027 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjBDNjVCRjJBRjNFRDE0QzBERQA='}]}
2025-06-19 13:25:34,028 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:25:34] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:25:34,785 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:25:34] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:25:34,909 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:25:34] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:25:35,086 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:25:35] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:28:47,670 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-19 13:28:47,670 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 13:28:47,671 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 13:28:47,671 - services.payment_service - INFO - PaymentService initialized
2025-06-19 13:28:47,671 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 13:28:47,672 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 13:28:47,672 - services.payment_service - INFO - PaymentService initialized
2025-06-19 13:28:47,673 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-19 13:28:47,673 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-19 13:28:47,673 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-19 13:28:47,674 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 13:28:47,674 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-19 13:28:47,674 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-19 13:28:48,132 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-19 13:28:48,133 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-19 13:28:48,133 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-19 13:28:48,133 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 13:28:48,148 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-19 13:28:48,149 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-19 13:28:53,815 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-19 13:28:53,815 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-19 13:28:53,819 - handlers.base_handler - INFO - Session 2348055614455 recognized user 'Ziga'.
2025-06-19 13:28:53,820 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Welcome Ziga! 👋🏼\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-19 13:28:55,018 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjM3QjE0NUMzRjc0Qjg5RDUwNAA="}]}
2025-06-19 13:28:55,019 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjM3QjE0NUMzRjc0Qjg5RDUwNAA='}]}
2025-06-19 13:28:55,019 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:28:55] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:28:55,908 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:28:55] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:28:56,311 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:28:56] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:28:58,579 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-19 13:28:58,584 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-06-19 13:28:58,585 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-06-19 13:28:58,585 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-06-19 13:28:58,586 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-06-19 13:28:58,587 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Just send me your full order in one message! \n\nLike this: 'Two plates of jollof rice, 2 Cokes, and asun.'\n\nWant to go back again? Type ‘menu’ to return. "}}
2025-06-19 13:28:59,548 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjYxQzBGRDQ1N0Y1NDJGOTA3MAA="}]}
2025-06-19 13:28:59,549 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjYxQzBGRDQ1N0Y1NDJGOTA3MAA='}]}
2025-06-19 13:28:59,549 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:28:59] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:29:00,488 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:29:00] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:29:00,788 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:29:00] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:29:01,305 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:29:01] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:29:08,200 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Puff puff'}
2025-06-19 13:29:08,208 - handlers.base_handler - INFO - AIHandler: Handling message 'puff puff' in AI bulk order state for session 2348055614455. Original: 'Puff puff'
2025-06-19 13:29:10,942 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-19 13:29:10,945 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🛒 *Order Summary:*\n\n✅ 1x Puff Puff - ₦200\n\n*Total: ₦200.00*\n\nWould you like to proceed with this order?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'confirm_ai_order', 'title': '✅ Confirm Order'}}, {'type': 'reply', 'reply': {'id': 'modify_ai_order', 'title': '✏️ Modify Order'}}, {'type': 'reply', 'reply': {'id': 'cancel_ai_order', 'title': '❌ Cancel'}}]}}}
2025-06-19 13:29:11,938 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjUyOEU5OERBMkVDNEQ0OEMwNgA="}]}
2025-06-19 13:29:11,939 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjUyOEU5OERBMkVDNEQ0OEMwNgA='}]}
2025-06-19 13:29:11,941 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:29:11] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:29:12,923 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:29:12] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:29:13,093 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:29:13] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:29:13,120 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:29:13] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:29:14,559 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-06-19 13:29:14,572 - handlers.base_handler - INFO - AI order confirmed. Cart: {'Puff Puff': {'item_id': 'Puff Puff', 'quantity': 1, 'price': 200, 'total_price': 200, 'variations': {}}}. Redirecting to order handler.
2025-06-19 13:29:14,572 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'order_handler' with message 'process_final_order'.
2025-06-19 13:29:14,573 - handlers.order_handler - INFO - AI initiated order processing for session 2348055614455.
2025-06-19 13:29:14,573 - handlers.order_handler - INFO - Address set, proceeding to confirm order for AI-initiated session 2348055614455.
2025-06-19 13:29:14,575 - handlers.order_handler - INFO - Showing final order confirmation for session 2348055614455. Total: ₦200.00
2025-06-19 13:29:14,578 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🛒 *Final Order Confirmation*\n\n📋 *Items Ordered:*\n• 1x Puff Puff - ₦200.00\n\n📍 *Delivery Details:*\n👤 Name: Ziga\n📱 Phone: 2348055614455\n🏠 Address: Howson Wright\n\n💰 *Total Amount: ₦200.00*\n\nPlease confirm to proceed with payment.'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'final_confirm', 'title': '✅ Confirm & Pay'}}, {'type': 'reply', 'reply': {'id': 'edit_order', 'title': '✏️ Edit Order'}}, {'type': 'reply', 'reply': {'id': 'cancel_order', 'title': '❌ Cancel Order'}}]}}}
2025-06-19 13:29:15,667 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjcwRjdEMTA2M0RGMTlDMTkzQwA="}]}
2025-06-19 13:29:15,674 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦200 (1 items)
2025-06-19 13:29:15,675 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦200.00
2025-06-19 13:29:15,675 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjcwRjdEMTA2M0RGMTlDMTkzQwA='}]}
2025-06-19 13:29:15,676 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:29:15] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:29:16,562 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:29:16] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:29:16,839 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:29:16] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:29:18,125 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'final_confirm'}
2025-06-19 13:29:18,130 - handlers.order_handler - INFO - Order ORDER_20250619_132918_3214ae87 confirmed for session 2348055614455. Amount: ₦200.00
2025-06-19 13:29:18,139 - services.lead_tracker - INFO - Order completion tracked for 2348055614455: ORDER_20250619_132918_3214ae87 (₦200)
2025-06-19 13:29:18,139 - handlers.lead_tracking_handler - INFO - 💰 Conversion tracked: 2348055614455 - ORDER_20250619_132918_3214ae87 (₦200)
2025-06-19 13:29:18,139 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'payment_handler' with message 'initiate_payment'.
2025-06-19 13:29:18,140 - handlers.base_handler - INFO - Handling payment processing for session 2348055614455, message: initiate_payment
2025-06-19 13:29:18,140 - handlers.base_handler - INFO - Creating payment link for session 2348055614455
2025-06-19 13:29:18,154 - utils.data_manager - INFO - Data saved to data\orders.json
2025-06-19 13:29:18,155 - utils.data_manager - INFO - Order details saved to data\orders.json
2025-06-19 13:29:18,155 - services.payment_service - INFO - Attempting to create payment link for reference: PAY-ORDER-20250619132918-7214 with amount: 20000, email: ziga4455@foodorder.com
2025-06-19 13:29:19,267 - services.payment_service - INFO - Payment link created for Ziga Ziga (2348055614455), URL: https://checkout.paystack.com/zzw68i2sresjjks
2025-06-19 13:29:19,269 - handlers.base_handler - INFO - Starting payment monitoring for order ORDER-20250619132918-7214, reference PAY-ORDER-20250619132918-7214
2025-06-19 13:29:19,269 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-ORDER-20250619132918-7214
2025-06-19 13:29:19,901 - services.payment_service - WARNING - Payment not successful for reference PAY-ORDER-20250619132918-7214. Paystack status: abandoned. Response: {'status': True, 'message': 'Verification successful', 'data': {'id': 5070827368, 'domain': 'test', 'status': 'abandoned', 'reference': 'PAY-ORDER-20250619132918-7214', 'receipt_number': None, 'amount': 20000, 'message': None, 'gateway_response': 'The transaction was not completed', 'paid_at': None, 'created_at': '2025-06-19T12:29:19.000Z', 'channel': 'card', 'currency': 'NGN', 'ip_address': '102.67.12.153, 172.68.229.170, 172.31.62.52', 'metadata': {'customer_name': 'Ziga', 'customer_phone': '2348055614455', 'first_name': 'Ziga', 'last_name': 'Ziga', 'order_id': 'ORDER-20250619132918-7214', 'delivery_address': 'Howson Wright'}, 'log': None, 'fees': None, 'fees_split': None, 'authorization': {}, 'customer': {'id': 276711440, 'first_name': None, 'last_name': None, 'email': 'ziga4455@foodorder.com', 'customer_code': 'CUS_bhkdpnbvcjqt55g', 'phone': None, 'metadata': None, 'risk_action': 'default', 'international_format_phone': None}, 'plan': None, 'split': {}, 'order_id': None, 'paidAt': None, 'createdAt': '2025-06-19T12:29:19.000Z', 'requested_amount': 20000, 'pos_transaction_data': None, 'source': None, 'fees_breakdown': None, 'connect': None, 'transaction_date': '2025-06-19T12:29:19.000Z', 'plan_object': {}, 'subaccount': {}}}
2025-06-19 13:29:19,902 - handlers.base_handler - INFO - Payment not yet verified for order ORDER-20250619132918-7214, attempt 1/15
2025-06-19 13:29:19,902 - handlers.base_handler - INFO - Payment link created successfully for order ORDER-20250619132918-7214
2025-06-19 13:29:19,903 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "🛒 **Order Created Successfully!**\n\n📋 **Order ID:** ORDER-20250619132918-7214\n💰 **Total:** ₦200\n\n💳 **Complete Payment:**\nhttps://checkout.paystack.com/zzw68i2sresjjks\n\n✅ We'll automatically confirm your order once payment is received!\n💬 You can also send 'paid' after payment to check status immediately.\n\n⏰ Payment link expires in 15 minutes."}}
2025-06-19 13:29:20,878 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjVGMDg1Mzk2NEUwRTdBODA3NAA="}]}
2025-06-19 13:29:20,884 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦200 (1 items)
2025-06-19 13:29:20,884 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦200.00
2025-06-19 13:29:20,884 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjVGMDg1Mzk2NEUwRTdBODA3NAA='}]}
2025-06-19 13:29:20,885 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:29:20] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:29:21,660 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:29:21] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:29:21,898 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:29:21] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:29:22,185 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:29:22] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:29:32,590 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Paid'}
2025-06-19 13:29:32,593 - handlers.base_handler - INFO - Received 'paid' command for session 2348055614455, attempting manual verification for ref: PAY-ORDER-20250619132918-7214
2025-06-19 13:29:32,593 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-ORDER-20250619132918-7214
2025-06-19 13:29:33,229 - services.payment_service - INFO - Payment verified successfully for reference PAY-ORDER-20250619132918-7214. Status: success
2025-06-19 13:29:33,230 - handlers.base_handler - INFO - Manual payment verification successful for order ORDER-20250619132918-7214
2025-06-19 13:29:33,231 - handlers.base_handler - INFO - Payment monitoring stopped for session 2348055614455
2025-06-19 13:29:33,237 - utils.data_manager - INFO - Data saved to data\orders.json
2025-06-19 13:29:33,238 - utils.data_manager - INFO - Order details saved to data\orders.json
2025-06-19 13:29:33,240 - services.lead_tracker - INFO - Order completion tracked for 2348055614455: ORDER-20250619132918-7214 (₦200)
2025-06-19 13:29:33,241 - handlers.lead_tracking_handler - INFO - 💰 Conversion tracked: 2348055614455 - ORDER-20250619132918-7214 (₦200)
2025-06-19 13:29:33,241 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "🎉 **Payment Confirmed!**\n\n📋 **Order ID:** ORDER-20250619132918-7214\n💰 **Amount Paid:** ₦200\n🛒 **Items:** 🛒 *Your Cart:*\n• 1 x Puff Puff (₦200) = ₦200\n\n💰 *Total: ₦200*\n🚚 **Delivery to:** Howson Wright\n\n✅ Your order is confirmed and being processed!\n📱 You'll receive delivery updates soon.\n\n🙏 Thank you for your purchase! 😊"}}
2025-06-19 13:29:34,218 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkI5ODk4MTJCM0IxMjRFNDYxRQA="}]}
2025-06-19 13:29:34,219 - handlers.feedback_handler - INFO - Initiated feedback collection for order ORDER-20250619132918-7214, session 2348055614455
2025-06-19 13:29:34,219 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🎉 *Thank you for your order!*\n\n📋 Order ID: ORDER-20250619132918-7214\n\n💬 *How was your ordering experience?*\nYour feedback helps us improve our service!'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'excellent', 'title': '🤩 Excellent'}}, {'type': 'reply', 'reply': {'id': 'good', 'title': '😊 Good'}}, {'type': 'reply', 'reply': {'id': 'bad', 'title': '😞 Bad'}}]}}}
2025-06-19 13:29:35,161 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:29:35] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:29:35,202 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjNBMDU1QkI1M0E3N0ZFQTg3OAA="}]}
2025-06-19 13:29:35,203 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'message': 'Payment confirmed and feedback initiated'}
2025-06-19 13:29:35,203 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:29:35] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:29:35,288 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:29:35] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:29:35,376 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:29:35] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:29:36,221 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:29:36] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:29:36,460 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:29:36] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:29:36,603 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:29:36] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:29:38,099 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'excellent'}
2025-06-19 13:29:38,101 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "🤩 *Thank you for the excellent rating!*\n\n💬 Would you like to share any specific comments about your experience?\n\nType your message or 'skip' to finish."}}
2025-06-19 13:29:39,103 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjM5QjFEOEFCMjE0OTk5RURCMAA="}]}
2025-06-19 13:29:39,104 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjM5QjFEOEFCMjE0OTk5RURCMAA='}]}
2025-06-19 13:29:39,104 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:29:39] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:29:39,870 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:29:39] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:29:40,375 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:29:40] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:29:42,002 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Skip'}
2025-06-19 13:29:42,006 - handlers.feedback_handler - INFO - Feedback saved to data/feedback.json
2025-06-19 13:29:42,006 - handlers.feedback_handler - INFO - Feedback saved for order ORDER-20250619132918-7214: excellent
2025-06-19 13:29:42,007 - handlers.feedback_handler - ERROR - Error saving feedback for session 2348055614455: 'SessionManager' object has no attribute 'clear_session'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\app\handlers\feedback_handler.py", line 191, in _save_feedback_and_complete
    self.session_manager.clear_session(session_id)
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'SessionManager' object has no attribute 'clear_session'. Did you mean: 'clear_full_session'?
2025-06-19 13:29:42,009 - handlers.message_processor - ERROR - Error in message routing for handler 'feedback_handler', state 'feedback_comment' for session 2348055614455: 'SessionManager' object has no attribute 'clear_session'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\app\handlers\feedback_handler.py", line 191, in _save_feedback_and_complete
    self.session_manager.clear_session(session_id)
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'SessionManager' object has no attribute 'clear_session'. Did you mean: 'clear_full_session'?

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\app\handlers\message_processor.py", line 256, in _route_to_handler
    response = self.feedback_handler.handle_feedback_comment_state(state, message, session_id)
  File "C:\Users\zigam\Documents\Lola\app\handlers\feedback_handler.py", line 101, in handle_feedback_comment_state
    return self._save_feedback_and_complete(state, session_id, "")
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Lola\app\handlers\feedback_handler.py", line 198, in _save_feedback_and_complete
    self.session_manager.clear_session(session_id)
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'SessionManager' object has no attribute 'clear_session'. Did you mean: 'clear_full_session'?
2025-06-19 13:29:42,014 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "⚠️ Something went wrong. Let's start fresh. Please try again."}}
2025-06-19 13:29:43,028 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkUxN0Y5RDg4MTE0RDEzODBCRAA="}]}
2025-06-19 13:29:43,028 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkUxN0Y5RDg4MTE0RDEzODBCRAA='}]}
2025-06-19 13:29:43,029 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:29:43] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:29:43,778 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:29:43] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:29:43,932 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:29:43] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:29:44,365 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:29:44] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:35:23,225 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-19 13:35:23,226 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 13:35:23,226 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 13:35:23,227 - services.payment_service - INFO - PaymentService initialized
2025-06-19 13:35:23,227 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 13:35:23,228 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 13:35:23,228 - services.payment_service - INFO - PaymentService initialized
2025-06-19 13:35:23,229 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-19 13:35:23,229 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-19 13:35:23,230 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-19 13:35:23,230 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 13:35:23,230 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-19 13:35:23,231 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-19 13:35:23,692 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-19 13:35:23,692 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-19 13:35:23,693 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-19 13:35:23,693 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 13:35:23,709 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-19 13:35:23,709 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-19 13:35:43,237 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:35:43] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:35:48,991 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-19 13:35:48,991 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-19 13:35:48,995 - handlers.base_handler - INFO - Session 2348055614455 recognized user 'Ziga'.
2025-06-19 13:35:48,995 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Welcome Ziga! 👋🏼\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-19 13:35:50,277 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjBDRENCRkVDOUY0RkMzOUQ3MgA="}]}
2025-06-19 13:35:50,278 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjBDRENCRkVDOUY0RkMzOUQ3MgA='}]}
2025-06-19 13:35:50,279 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:35:50] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:35:51,529 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:35:51] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:35:51,649 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:35:51] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:35:53,108 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-19 13:35:53,111 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-06-19 13:35:53,111 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-06-19 13:35:53,112 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-06-19 13:35:53,112 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-06-19 13:35:53,112 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Just send me your full order in one message! \n\nLike this: 'Two plates of jollof rice, 2 Cokes, and asun.'\n\nWant to go back again? Type ‘menu’ to return. "}}
2025-06-19 13:35:54,167 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjIzQ0NDRDExNzBDMjIwNzRENAA="}]}
2025-06-19 13:35:54,167 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjIzQ0NDRDExNzBDMjIwNzRENAA='}]}
2025-06-19 13:35:54,168 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:35:54] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:35:55,043 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:35:55] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:35:55,179 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:35:55] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:35:55,307 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:35:55] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:35:59,380 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Fried rice'}
2025-06-19 13:35:59,383 - handlers.base_handler - INFO - AIHandler: Handling message 'fried rice' in AI bulk order state for session 2348055614455. Original: 'Fried rice'
2025-06-19 13:36:01,709 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-19 13:36:01,711 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🛒 *Order Summary:*\n\n✅ 1x Fried Rice Fiesta - ₦1,400\n\n*Total: ₦1,400.00*\n\nWould you like to proceed with this order?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'confirm_ai_order', 'title': '✅ Confirm Order'}}, {'type': 'reply', 'reply': {'id': 'modify_ai_order', 'title': '✏️ Modify Order'}}, {'type': 'reply', 'reply': {'id': 'cancel_ai_order', 'title': '❌ Cancel'}}]}}}
2025-06-19 13:36:02,730 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkJERENCNDgyM0ZCOTk3ODlDOQA="}]}
2025-06-19 13:36:02,731 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkJERENCNDgyM0ZCOTk3ODlDOQA='}]}
2025-06-19 13:36:02,731 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:36:02] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:36:03,728 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:36:03] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:36:03,857 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:36:03] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:36:03,908 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:36:03] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:36:04,751 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'modify_ai_order'}
2025-06-19 13:36:04,754 - handlers.base_handler - INFO - User chose to modify AI order for session 2348055614455.
2025-06-19 13:36:04,755 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': 'Please tell me your updated order:'}}
2025-06-19 13:36:05,788 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkJCNTlGOTVCRUIyRjJDQTlCMgA="}]}
2025-06-19 13:36:05,789 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkJCNTlGOTVCRUIyRjJDQTlCMgA='}]}
2025-06-19 13:36:05,789 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:36:05] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:36:06,582 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:36:06] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:36:06,929 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:36:06] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:36:07,049 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:36:07] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:36:10,088 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Puff puff'}
2025-06-19 13:36:10,090 - handlers.base_handler - INFO - AIHandler: Handling message 'puff puff' in AI bulk order state for session 2348055614455. Original: 'Puff puff'
2025-06-19 13:36:12,017 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-19 13:36:12,018 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🛒 *Order Summary:*\n\n✅ 1x Puff Puff - ₦200\n\n*Total: ₦200.00*\n\nWould you like to proceed with this order?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'confirm_ai_order', 'title': '✅ Confirm Order'}}, {'type': 'reply', 'reply': {'id': 'modify_ai_order', 'title': '✏️ Modify Order'}}, {'type': 'reply', 'reply': {'id': 'cancel_ai_order', 'title': '❌ Cancel'}}]}}}
2025-06-19 13:36:13,059 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjU4MjA1RjVBRTdBMTE4M0NGRQA="}]}
2025-06-19 13:36:13,060 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjU4MjA1RjVBRTdBMTE4M0NGRQA='}]}
2025-06-19 13:36:13,060 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:36:13] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:36:13,918 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:36:13] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:36:14,114 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:36:14] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:36:15,491 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-06-19 13:36:15,493 - handlers.base_handler - INFO - AI order confirmed. Cart: {'Puff Puff': {'item_id': 'Puff Puff', 'quantity': 1, 'price': 200, 'total_price': 200, 'variations': {}}}. Redirecting to order handler.
2025-06-19 13:36:15,494 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'order_handler' with message 'process_final_order'.
2025-06-19 13:36:15,494 - handlers.order_handler - INFO - AI initiated order processing for session 2348055614455.
2025-06-19 13:36:15,494 - handlers.order_handler - INFO - Address set, proceeding to confirm order for AI-initiated session 2348055614455.
2025-06-19 13:36:15,495 - handlers.order_handler - INFO - Showing final order confirmation for session 2348055614455. Total: ₦200.00
2025-06-19 13:36:15,495 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🛒 *Final Order Confirmation*\n\n📋 *Items Ordered:*\n• 1x Puff Puff - ₦200.00\n\n📍 *Delivery Details:*\n👤 Name: Ziga\n📱 Phone: 2348055614455\n🏠 Address: Howson Wright\n\n💰 *Total Amount: ₦200.00*\n\nPlease confirm to proceed with payment.'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'final_confirm', 'title': '✅ Confirm & Pay'}}, {'type': 'reply', 'reply': {'id': 'edit_order', 'title': '✏️ Edit Order'}}, {'type': 'reply', 'reply': {'id': 'cancel_order', 'title': '❌ Cancel Order'}}]}}}
2025-06-19 13:36:16,737 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjRGMzU3Qjc4MzFFMTgyODgwNwA="}]}
2025-06-19 13:36:16,744 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦200 (1 items)
2025-06-19 13:36:16,745 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦200.00
2025-06-19 13:36:16,745 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjRGMzU3Qjc4MzFFMTgyODgwNwA='}]}
2025-06-19 13:36:16,746 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:36:16] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:36:17,518 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:36:17] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:36:17,678 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:36:17] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:36:17,718 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:36:17] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:36:18,919 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'final_confirm'}
2025-06-19 13:36:18,921 - handlers.order_handler - INFO - Order ORDER_20250619_133618_0e9be51d confirmed for session 2348055614455. Amount: ₦200.00
2025-06-19 13:36:18,925 - services.lead_tracker - INFO - Order completion tracked for 2348055614455: ORDER_20250619_133618_0e9be51d (₦200)
2025-06-19 13:36:18,925 - handlers.lead_tracking_handler - INFO - 💰 Conversion tracked: 2348055614455 - ORDER_20250619_133618_0e9be51d (₦200)
2025-06-19 13:36:18,926 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'payment_handler' with message 'initiate_payment'.
2025-06-19 13:36:18,926 - handlers.base_handler - INFO - Handling payment processing for session 2348055614455, message: initiate_payment
2025-06-19 13:36:18,926 - handlers.base_handler - INFO - Creating payment link for session 2348055614455
2025-06-19 13:36:18,938 - utils.data_manager - INFO - Data saved to data\orders.json
2025-06-19 13:36:18,938 - utils.data_manager - INFO - Order details saved to data\orders.json
2025-06-19 13:36:18,939 - services.payment_service - INFO - Attempting to create payment link for reference: PAY-ORDER-20250619133618-7422 with amount: 20000, email: ziga4455@foodorder.com
2025-06-19 13:36:19,591 - services.payment_service - INFO - Payment link created for Ziga Ziga (2348055614455), URL: https://checkout.paystack.com/cb7wyqrqv3do9am
2025-06-19 13:36:19,592 - handlers.base_handler - INFO - Starting payment monitoring for order ORDER-20250619133618-7422, reference PAY-ORDER-20250619133618-7422
2025-06-19 13:36:19,592 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-ORDER-20250619133618-7422
2025-06-19 13:36:20,117 - services.payment_service - WARNING - Payment not successful for reference PAY-ORDER-20250619133618-7422. Paystack status: abandoned. Response: {'status': True, 'message': 'Verification successful', 'data': {'id': 5070852992, 'domain': 'test', 'status': 'abandoned', 'reference': 'PAY-ORDER-20250619133618-7422', 'receipt_number': None, 'amount': 20000, 'message': None, 'gateway_response': 'The transaction was not completed', 'paid_at': None, 'created_at': '2025-06-19T12:36:19.000Z', 'channel': 'card', 'currency': 'NGN', 'ip_address': '102.67.12.153, 172.68.229.66, 172.31.68.120', 'metadata': {'customer_name': 'Ziga', 'customer_phone': '2348055614455', 'first_name': 'Ziga', 'last_name': 'Ziga', 'order_id': 'ORDER-20250619133618-7422', 'delivery_address': 'Howson Wright'}, 'log': None, 'fees': None, 'fees_split': None, 'authorization': {}, 'customer': {'id': 276711440, 'first_name': None, 'last_name': None, 'email': 'ziga4455@foodorder.com', 'customer_code': 'CUS_bhkdpnbvcjqt55g', 'phone': None, 'metadata': None, 'risk_action': 'default', 'international_format_phone': None}, 'plan': None, 'split': {}, 'order_id': None, 'paidAt': None, 'createdAt': '2025-06-19T12:36:19.000Z', 'requested_amount': 20000, 'pos_transaction_data': None, 'source': None, 'fees_breakdown': None, 'connect': None, 'transaction_date': '2025-06-19T12:36:19.000Z', 'plan_object': {}, 'subaccount': {}}}
2025-06-19 13:36:20,117 - handlers.base_handler - INFO - Payment not yet verified for order ORDER-20250619133618-7422, attempt 1/15
2025-06-19 13:36:20,118 - handlers.base_handler - INFO - Payment link created successfully for order ORDER-20250619133618-7422
2025-06-19 13:36:20,119 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "🛒 **Order Created Successfully!**\n\n📋 **Order ID:** ORDER-20250619133618-7422\n💰 **Total:** ₦200\n\n💳 **Complete Payment:**\nhttps://checkout.paystack.com/cb7wyqrqv3do9am\n\n✅ We'll automatically confirm your order once payment is received!\n💬 You can also send 'paid' after payment to check status immediately.\n\n⏰ Payment link expires in 15 minutes."}}
2025-06-19 13:36:21,097 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjVEM0ExNjhFRjA5REQwRTk2OQA="}]}
2025-06-19 13:36:21,101 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦200 (1 items)
2025-06-19 13:36:21,101 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦200.00
2025-06-19 13:36:21,101 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjVEM0ExNjhFRjA5REQwRTk2OQA='}]}
2025-06-19 13:36:21,102 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:36:21] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:36:21,965 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:36:21] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:36:22,123 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:36:22] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:36:22,249 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:36:22] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:36:34,298 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Paid'}
2025-06-19 13:36:34,301 - handlers.base_handler - INFO - Received 'paid' command for session 2348055614455, attempting manual verification for ref: PAY-ORDER-20250619133618-7422
2025-06-19 13:36:34,301 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-ORDER-20250619133618-7422
2025-06-19 13:36:34,868 - services.payment_service - INFO - Payment verified successfully for reference PAY-ORDER-20250619133618-7422. Status: success
2025-06-19 13:36:34,870 - handlers.base_handler - INFO - Manual payment verification successful for order ORDER-20250619133618-7422
2025-06-19 13:36:34,870 - handlers.base_handler - INFO - Payment monitoring stopped for session 2348055614455
2025-06-19 13:36:34,878 - utils.data_manager - INFO - Data saved to data\orders.json
2025-06-19 13:36:34,879 - utils.data_manager - INFO - Order details saved to data\orders.json
2025-06-19 13:36:34,881 - services.lead_tracker - INFO - Order completion tracked for 2348055614455: ORDER-20250619133618-7422 (₦200)
2025-06-19 13:36:34,882 - handlers.lead_tracking_handler - INFO - 💰 Conversion tracked: 2348055614455 - ORDER-20250619133618-7422 (₦200)
2025-06-19 13:36:34,882 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "🎉 **Payment Confirmed!**\n\n📋 **Order ID:** ORDER-20250619133618-7422\n💰 **Amount Paid:** ₦200\n🛒 **Items:** 🛒 *Your Cart:*\n• 1 x Puff Puff (₦200) = ₦200\n\n💰 *Total: ₦200*\n🚚 **Delivery to:** Howson Wright\n\n✅ Your order is confirmed and being processed!\n📱 You'll receive delivery updates soon.\n\n🙏 Thank you for your purchase! 😊"}}
2025-06-19 13:36:35,908 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjM2QTU1OUE5OEQxN0ZBOTg0MgA="}]}
2025-06-19 13:36:35,908 - handlers.feedback_handler - INFO - Initiated feedback collection for order ORDER-20250619133618-7422, session 2348055614455
2025-06-19 13:36:35,909 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🎉 *Thank you for your order!*\n\n📋 Order ID: ORDER-20250619133618-7422\n\n💬 *How was your ordering experience?*\nYour feedback helps us improve our service!'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'excellent', 'title': '🤩 Excellent'}}, {'type': 'reply', 'reply': {'id': 'good', 'title': '😊 Good'}}, {'type': 'reply', 'reply': {'id': 'bad', 'title': '😞 Bad'}}]}}}
2025-06-19 13:36:36,563 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:36:36] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:36:36,886 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjA2MjM5MDNCNTZBNDAxNEJGOAA="}]}
2025-06-19 13:36:36,887 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'message': 'Payment confirmed and feedback initiated'}
2025-06-19 13:36:36,888 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:36:36] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:36:37,040 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:36:37] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:36:37,737 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:36:37] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:36:37,867 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:36:37] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:36:37,975 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:36:37] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:36:38,929 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'good'}
2025-06-19 13:36:38,932 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "👍 *Thank you for the good rating!*\n\n💬 Would you like to share any specific comments about your experience?\n\nType your message or 'skip' to finish."}}
2025-06-19 13:36:39,897 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkI5NUQ2MDQ4M0VCMjkwOEI3QgA="}]}
2025-06-19 13:36:39,898 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkI5NUQ2MDQ4M0VCMjkwOEI3QgA='}]}
2025-06-19 13:36:39,898 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:36:39] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:36:40,892 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:36:40] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:36:41,077 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:36:41] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:36:41,370 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:36:41] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:36:43,648 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Skip'}
2025-06-19 13:36:43,652 - handlers.feedback_handler - INFO - Feedback saved to data/feedback.json
2025-06-19 13:36:43,653 - handlers.feedback_handler - INFO - Feedback saved for order ORDER-20250619133618-7422: good
2025-06-19 13:36:43,653 - utils.session_manager - INFO - Full session 2348055614455 cleared.
2025-06-19 13:36:43,653 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': '🙏 *Thank you for your Good feedback!*\n\n'}}
2025-06-19 13:36:44,650 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkVGNDAwNjc3Rjc3QjYzNTUyMAA="}]}
2025-06-19 13:36:44,651 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkVGNDAwNjc3Rjc3QjYzNTUyMAA='}]}
2025-06-19 13:36:44,652 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:36:44] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:36:45,348 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:36:45] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:36:45,557 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:36:45] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:36:45,692 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:36:45] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:37:08,526 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-19 13:37:08,526 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-19 13:37:08,530 - handlers.base_handler - INFO - Session 2348055614455 recognized user 'Ziga'.
2025-06-19 13:37:08,531 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Welcome Ziga! 👋🏼\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-19 13:37:09,507 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjAwNUE0OTlGNkIwMTEwRjgzMAA="}]}
2025-06-19 13:37:09,508 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjAwNUE0OTlGNkIwMTEwRjgzMAA='}]}
2025-06-19 13:37:09,508 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:37:09] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:37:10,297 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:37:10] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:37:10,648 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:37:10] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:37:11,724 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'others_menu'}
2025-06-19 13:37:11,728 - handlers.base_handler - INFO - GreetingHandler: Handling message 'others_menu' in greeting state for session 2348055614455.
2025-06-19 13:37:11,728 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🔧 *Other Options*\n\nHere are other ways I can help you:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'enquiry', 'title': '❓ Enquiry'}}, {'type': 'reply', 'reply': {'id': 'complain', 'title': '📝 Complain'}}, {'type': 'reply', 'reply': {'id': 'back_to_main', 'title': '🔙 Back'}}]}}}
2025-06-19 13:37:12,648 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkMzNzQ5NjFDMDA2RkJERUMxMgA="}]}
2025-06-19 13:37:12,649 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkMzNzQ5NjFDMDA2RkJERUMxMgA='}]}
2025-06-19 13:37:12,650 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:37:12] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:37:13,479 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:37:13] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:37:13,553 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:37:13] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:37:13,647 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:37:13] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:37:14,649 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'enquiry'}
2025-06-19 13:37:14,651 - handlers.message_processor - WARNING - No specific handler or state match for handler 'greeting_handler', state 'others_menu_selection', message 'enquiry' for session 2348055614455. Resetting to greeting.
2025-06-19 13:37:14,651 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "I'm sorry, I didn't quite understand that. Let's get back to the main menu."}}
2025-06-19 13:37:15,688 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjI3Njk4MDdGQjhFOTc5M0IwNgA="}]}
2025-06-19 13:37:15,689 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Please choose from the options below:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-19 13:37:16,569 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:37:16] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:37:16,687 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjZGMEFCMjE4QjRGQUYxOUQ1MwA="}]}
2025-06-19 13:37:16,688 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjZGMEFCMjE4QjRGQUYxOUQ1MwA='}]}
2025-06-19 13:37:16,689 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:37:16] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:37:16,718 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:37:16] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:37:17,186 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:37:17] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:37:17,752 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:37:17] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:37:18,162 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:37:18] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:37:18,333 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:37:18] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:37:22,089 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'others_menu'}
2025-06-19 13:37:22,092 - handlers.base_handler - INFO - GreetingHandler: Handling message 'others_menu' in greeting state for session 2348055614455.
2025-06-19 13:37:22,093 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🔧 *Other Options*\n\nHere are other ways I can help you:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'enquiry', 'title': '❓ Enquiry'}}, {'type': 'reply', 'reply': {'id': 'complain', 'title': '📝 Complain'}}, {'type': 'reply', 'reply': {'id': 'back_to_main', 'title': '🔙 Back'}}]}}}
2025-06-19 13:37:23,138 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjYwNkQzQjkyOUUxREJENDA3NwA="}]}
2025-06-19 13:37:23,139 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjYwNkQzQjkyOUUxREJENDA3NwA='}]}
2025-06-19 13:37:23,139 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:37:23] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:37:23,946 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:37:23] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:37:24,130 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:37:24] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:37:24,221 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:37:24] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:37:26,533 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'complain'}
2025-06-19 13:37:26,535 - handlers.message_processor - WARNING - No specific handler or state match for handler 'greeting_handler', state 'others_menu_selection', message 'complain' for session 2348055614455. Resetting to greeting.
2025-06-19 13:37:26,536 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "I'm sorry, I didn't quite understand that. Let's get back to the main menu."}}
2025-06-19 13:37:27,546 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkI4OEM0MDEwMEM0QUMzN0Q5MQA="}]}
2025-06-19 13:37:27,547 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Please choose from the options below:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-19 13:37:28,341 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:37:28] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:37:28,519 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:37:28] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:37:28,611 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjc3QTY3QjAwRDk2OUM2RjQyOQA="}]}
2025-06-19 13:37:28,612 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjc3QTY3QjAwRDk2OUM2RjQyOQA='}]}
2025-06-19 13:37:28,612 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:37:28] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:37:28,613 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:37:28] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:37:29,638 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:37:29] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:37:29,851 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:37:29] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:37:30,026 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:37:30] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:40:42,385 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:40:42] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:43:01,844 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-19 13:43:01,844 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 13:43:01,845 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 13:43:01,845 - services.payment_service - INFO - PaymentService initialized
2025-06-19 13:43:01,845 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 13:43:01,846 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 13:43:01,846 - services.payment_service - INFO - PaymentService initialized
2025-06-19 13:43:01,847 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-19 13:43:01,847 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-19 13:43:01,847 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-19 13:43:01,848 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 13:43:01,848 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-19 13:43:01,848 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-19 13:43:02,206 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-19 13:43:02,206 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-19 13:43:02,206 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-19 13:43:02,207 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 13:43:02,220 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-19 13:43:02,221 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-19 13:43:12,384 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-19 13:43:12,385 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-19 13:43:12,392 - handlers.base_handler - INFO - Session 2348055614455 recognized user 'Ziga'.
2025-06-19 13:43:12,392 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Welcome Ziga! 👋🏼\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-19 13:43:13,464 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjBGRkNDRTM5M0M1OTEwMjI2MQA="}]}
2025-06-19 13:43:13,465 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjBGRkNDRTM5M0M1OTEwMjI2MQA='}]}
2025-06-19 13:43:13,466 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:43:13] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:43:14,456 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:43:14] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:43:14,727 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:43:14] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:43:16,947 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'others_menu'}
2025-06-19 13:43:16,951 - handlers.base_handler - INFO - GreetingHandler: Handling message 'others_menu' in greeting state for session 2348055614455.
2025-06-19 13:43:16,952 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🔧 *Other Options*\n\nHere are other ways I can help you:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'enquiry', 'title': '❓ Enquiry'}}, {'type': 'reply', 'reply': {'id': 'complain', 'title': '📝 Complain'}}, {'type': 'reply', 'reply': {'id': 'back_to_main', 'title': '🔙 Back'}}]}}}
2025-06-19 13:43:17,920 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkU4NjlEN0MyRTc0N0FBRjFGRQA="}]}
2025-06-19 13:43:17,921 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkU4NjlEN0MyRTc0N0FBRjFGRQA='}]}
2025-06-19 13:43:17,921 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:43:17] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:43:18,673 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:43:18] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:43:19,137 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:43:19] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:43:19,179 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:43:19] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:43:20,135 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'enquiry'}
2025-06-19 13:43:20,138 - handlers.message_processor - WARNING - No specific handler or state match for handler 'greeting_handler', state 'others_menu_selection', message 'enquiry' for session 2348055614455. Resetting to greeting.
2025-06-19 13:43:20,138 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "I'm sorry, I didn't quite understand that. Let's get back to the main menu."}}
2025-06-19 13:43:21,145 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkJGNTJDMjgxNkZCMTY3RDc1NQA="}]}
2025-06-19 13:43:21,146 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Please choose from the options below:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-19 13:43:22,071 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:43:22] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:43:22,100 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjk4NkZCNkFGQTlBMjkzQzU0RgA="}]}
2025-06-19 13:43:22,101 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjk4NkZCNkFGQTlBMjkzQzU0RgA='}]}
2025-06-19 13:43:22,101 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:43:22] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:43:22,118 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:43:22] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:43:22,179 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:43:22] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:43:22,886 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:43:22] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:43:23,343 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:43:23] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:43:23,346 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:43:23] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:48:48,310 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-19 13:48:48,311 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 13:48:48,312 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 13:48:48,312 - services.payment_service - INFO - PaymentService initialized
2025-06-19 13:48:48,312 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 13:48:48,313 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 13:48:48,314 - services.payment_service - INFO - PaymentService initialized
2025-06-19 13:48:48,314 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-19 13:48:48,315 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-19 13:48:48,315 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-19 13:48:48,316 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 13:48:48,316 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-19 13:48:48,317 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-19 13:48:48,688 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-19 13:48:48,688 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-19 13:48:48,688 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-19 13:48:48,689 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 13:48:48,703 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-19 13:48:48,704 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-19 13:48:54,884 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-19 13:48:54,884 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-19 13:48:54,889 - handlers.base_handler - INFO - Session 2348055614455 recognized user 'Ziga'.
2025-06-19 13:48:54,890 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Welcome Ziga! 👋🏼\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-19 13:48:56,044 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkJCQTcxOTU5ODA1QkY5RTMyMwA="}]}
2025-06-19 13:48:56,045 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkJCQTcxOTU5ODA1QkY5RTMyMwA='}]}
2025-06-19 13:48:56,046 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:48:56] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:48:56,897 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:48:56] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:48:57,316 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:48:57] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:48:57,429 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:48:57] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:48:59,037 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'others_menu'}
2025-06-19 13:48:59,039 - handlers.base_handler - INFO - GreetingHandler: Handling message 'others_menu' in greeting state for session 2348055614455.
2025-06-19 13:48:59,040 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🔧 *Other Options*\n\nHere are other ways I can help you:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'enquiry', 'title': '❓ Enquiry'}}, {'type': 'reply', 'reply': {'id': 'complain', 'title': '📝 Complain'}}, {'type': 'reply', 'reply': {'id': 'back_to_main', 'title': '🔙 Back'}}]}}}
2025-06-19 13:49:00,085 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkRGQTY3NUFBRTQ4QThCNjkwRAA="}]}
2025-06-19 13:49:00,087 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkRGQTY3NUFBRTQ4QThCNjkwRAA='}]}
2025-06-19 13:49:00,088 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:49:00] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:49:01,074 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:49:01] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:49:01,194 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:49:01] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:49:01,196 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:49:01] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:49:02,265 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'enquiry'}
2025-06-19 13:49:02,267 - handlers.base_handler - INFO - GreetingHandler: Handling message 'enquiry' in 'others_menu_selection' state for session 2348055614455.
2025-06-19 13:49:02,268 - handlers.base_handler - INFO - Session 2348055614455 redirecting to EnquiryHandler for enquiry menu.
2025-06-19 13:49:02,268 - handlers.message_processor - INFO - Session 2348055614455: REDIRECTING to handler 'enquiry_handler' with instruction 'show_enquiry_menu'.
2025-06-19 13:49:02,269 - handlers.base_handler - INFO - Session 2348055614455 entering enquiry menu.
2025-06-19 13:49:02,269 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'How can we help you today?\n\n📚 *FAQ* - Get instant answers to common questions\n❓ *Ask Question* - Send us your specific question'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'faq', 'title': '📚 FAQ'}}, {'type': 'reply', 'reply': {'id': 'ask_question', 'title': '❓ Ask Question'}}, {'type': 'reply', 'reply': {'id': 'back_to_main', 'title': '🔙 Back'}}]}}}
2025-06-19 13:49:03,266 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkQwMTY4QThEMDZDN0ZFOTgyQgA="}]}
2025-06-19 13:49:03,267 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkQwMTY4QThEMDZDN0ZFOTgyQgA='}]}
2025-06-19 13:49:03,267 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:49:03] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:49:04,065 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:49:04] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:49:04,325 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:49:04] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:49:04,444 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:49:04] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:49:05,484 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'faq'}
2025-06-19 13:49:05,488 - handlers.message_processor - INFO - Session 2348055614455: REDIRECTING to handler 'faq_handler' with instruction 'faq'.
2025-06-19 13:49:05,488 - handlers.message_processor - WARNING - Redirect message 'faq' not explicitly handled for 'faq_handler'. Attempting generic fallback.
2025-06-19 13:49:05,489 - handlers.message_processor - WARNING - EnquiryHandler: Unhandled state 'faq_categories' for message 'faq'. Showing enquiry menu.
2025-06-19 13:49:05,489 - handlers.base_handler - INFO - Session 2348055614455 entering enquiry menu.
2025-06-19 13:49:05,490 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'How can we help you today?\n\n📚 *FAQ* - Get instant answers to common questions\n❓ *Ask Question* - Send us your specific question'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'faq', 'title': '📚 FAQ'}}, {'type': 'reply', 'reply': {'id': 'ask_question', 'title': '❓ Ask Question'}}, {'type': 'reply', 'reply': {'id': 'back_to_main', 'title': '🔙 Back'}}]}}}
2025-06-19 13:49:06,484 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkU4NUFDRDJCMURGRDk3Qzk3QwA="}]}
2025-06-19 13:49:06,484 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkU4NUFDRDJCMURGRDk3Qzk3QwA='}]}
2025-06-19 13:49:06,485 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:49:06] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:49:07,303 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:49:07] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:49:07,335 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:49:07] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:49:07,632 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:49:07] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:49:11,304 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ask_question'}
2025-06-19 13:49:11,308 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "❓ What would you like to know? Please type your question and we'll get back to you soon!"}}
2025-06-19 13:49:12,547 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjMxNzVERDhGRjlDNTU3RDExQwA="}]}
2025-06-19 13:49:12,548 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjMxNzVERDhGRjlDNTU3RDExQwA='}]}
2025-06-19 13:49:12,549 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:49:12] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:49:13,330 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:49:13] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:49:13,760 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:49:13] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:49:13,835 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:49:13] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:49:19,825 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Your delivery time'}
2025-06-19 13:49:19,828 - utils.data_manager - WARNING - File not found or empty: data\enquiries.json
2025-06-19 13:49:19,830 - utils.data_manager - INFO - Data saved to data\enquiries.json
2025-06-19 13:49:19,831 - utils.data_manager - INFO - Enquiry details saved to data\enquiries.json
2025-06-19 13:49:19,831 - utils.session_manager - INFO - Full session 2348055614455 cleared.
2025-06-19 13:49:19,832 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': '✅ Thank you for your enquiry!\n\n*Enquiry ID:* 1f479677-3c69-4d24-9dbc-fde74e400b5b\n\nWe\'ve received your question: "Your delivery time"\n\nOur team will review it and get back to you within 24 hours. We appreciate your patience! 😊\n\n*You can reference enquiry ID 1f479677-3c69-4d24-9dbc-fde74e400b5b in future communications.*'}}
2025-06-19 13:49:20,877 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjVGOTRBMkM1MjkzNTQ5NUM3QwA="}]}
2025-06-19 13:49:20,878 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjVGOTRBMkM1MjkzNTQ5NUM3QwA='}]}
2025-06-19 13:49:20,878 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:49:20] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:49:21,761 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:49:21] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:49:21,775 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:49:21] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:49:21,886 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:49:21] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:49:40,624 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-19 13:49:40,625 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-19 13:49:40,630 - handlers.base_handler - INFO - Session 2348055614455 recognized user 'Ziga'.
2025-06-19 13:49:40,630 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Welcome Ziga! 👋🏼\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-19 13:49:41,801 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjA1RTkwNTJDMDBFQUY3QUNFNAA="}]}
2025-06-19 13:49:41,802 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjA1RTkwNTJDMDBFQUY3QUNFNAA='}]}
2025-06-19 13:49:41,802 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:49:41] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:49:42,587 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:49:42] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:49:42,729 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:49:42] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:49:42,877 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:49:42] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:49:44,103 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'others_menu'}
2025-06-19 13:49:44,105 - handlers.base_handler - INFO - GreetingHandler: Handling message 'others_menu' in greeting state for session 2348055614455.
2025-06-19 13:49:44,105 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🔧 *Other Options*\n\nHere are other ways I can help you:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'enquiry', 'title': '❓ Enquiry'}}, {'type': 'reply', 'reply': {'id': 'complain', 'title': '📝 Complain'}}, {'type': 'reply', 'reply': {'id': 'back_to_main', 'title': '🔙 Back'}}]}}}
2025-06-19 13:49:45,148 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjExQ0E3MEY4RjMwRTUxRUE5MgA="}]}
2025-06-19 13:49:45,149 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjExQ0E3MEY4RjMwRTUxRUE5MgA='}]}
2025-06-19 13:49:45,150 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:49:45] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:49:45,972 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:49:45] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:49:46,005 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:49:46] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:49:46,307 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:49:46] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:49:47,235 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'complain'}
2025-06-19 13:49:47,238 - handlers.base_handler - INFO - GreetingHandler: Handling message 'complain' in 'others_menu_selection' state for session 2348055614455.
2025-06-19 13:49:47,238 - handlers.base_handler - INFO - Session 2348055614455 entering complaint state.
2025-06-19 13:49:47,239 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "We're sorry to hear you're having an issue. Please tell us about your complaint and we'll address it promptly."}}
2025-06-19 13:49:48,229 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkVEQzA5NzIyNzMwQjE5REEwMgA="}]}
2025-06-19 13:49:48,230 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkVEQzA5NzIyNzMwQjE5REEwMgA='}]}
2025-06-19 13:49:48,230 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:49:48] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:49:48,992 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:49:48] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:49:49,250 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:49:49] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:49:49,351 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:49:49] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:51:22,992 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-19 13:51:22,992 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 13:51:22,993 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 13:51:22,994 - services.payment_service - INFO - PaymentService initialized
2025-06-19 13:51:22,994 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 13:51:22,994 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 13:51:22,995 - services.payment_service - INFO - PaymentService initialized
2025-06-19 13:51:22,995 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-19 13:51:22,995 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-19 13:51:22,996 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-19 13:51:22,996 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 13:51:22,997 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-19 13:51:22,997 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-19 13:51:23,365 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-19 13:51:23,365 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-19 13:51:23,366 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-19 13:51:23,366 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 13:51:23,379 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-19 13:51:23,379 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-19 13:51:26,743 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-19 13:51:26,743 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-19 13:51:26,747 - handlers.base_handler - INFO - Session 2348055614455 recognized user 'Ziga'.
2025-06-19 13:51:26,747 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Welcome Ziga! 👋🏼\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-19 13:51:27,754 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjVEMzk0RUY4ODlGQkE1MDk5MAA="}]}
2025-06-19 13:51:27,755 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjVEMzk0RUY4ODlGQkE1MDk5MAA='}]}
2025-06-19 13:51:27,755 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:51:27] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:51:28,564 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:51:28] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:51:28,740 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:51:28] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:51:28,854 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:51:28] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:51:29,702 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'others_menu'}
2025-06-19 13:51:29,705 - handlers.base_handler - INFO - GreetingHandler: Handling message 'others_menu' in greeting state for session 2348055614455.
2025-06-19 13:51:29,705 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🔧 *Other Options*\n\nHere are other ways I can help you:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'enquiry', 'title': '❓ Enquiry'}}, {'type': 'reply', 'reply': {'id': 'complain', 'title': '📝 Complain'}}, {'type': 'reply', 'reply': {'id': 'back_to_main', 'title': '🔙 Back'}}]}}}
2025-06-19 13:51:30,671 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjE0MzNFNTlGOEE4NDc1QkY4NwA="}]}
2025-06-19 13:51:30,672 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjE0MzNFNTlGOEE4NDc1QkY4NwA='}]}
2025-06-19 13:51:30,672 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:51:30] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:51:31,748 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:51:31] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:51:31,806 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:51:31] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:51:31,873 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:51:31] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:51:33,196 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'complain'}
2025-06-19 13:51:33,198 - handlers.base_handler - INFO - GreetingHandler: Handling message 'complain' in 'others_menu_selection' state for session 2348055614455.
2025-06-19 13:51:33,199 - handlers.base_handler - INFO - Session 2348055614455 entering complaint state.
2025-06-19 13:51:33,199 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "We're sorry to hear you're having an issue. Please tell us about your complaint and we'll address it promptly."}}
2025-06-19 13:51:34,192 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjZBNzIwNkQ3NzhCMUEwNDVGRAA="}]}
2025-06-19 13:51:34,193 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjZBNzIwNkQ3NzhCMUEwNDVGRAA='}]}
2025-06-19 13:51:34,194 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:51:34] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:51:35,185 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:51:35] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:51:35,317 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:51:35] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:51:35,319 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:51:35] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:51:44,329 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Your delivery was late'}
2025-06-19 13:51:44,332 - handlers.complaint_handler - INFO - Complaint received from 2348055614455: Your delivery was late
2025-06-19 13:51:44,333 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': '✅ Thank you for your complaint! We have received it and will look into this issue promptly. We appreciate your patience.'}}
2025-06-19 13:51:45,487 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkI5MTAxODA4RDgyRTVCRjkyOQA="}]}
2025-06-19 13:51:45,488 - handlers.message_processor - INFO - Handler 'complaint_handler' returned None for session 2348055614455. Assuming message already sent. Sending main menu as next step.
2025-06-19 13:51:45,488 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Is there anything else I can help you with?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-19 13:51:46,135 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:51:46] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:51:46,388 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:51:46] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:51:46,452 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjg3RjE0ODNDRTE0NDRCQTcyRgA="}]}
2025-06-19 13:51:46,453 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjg3RjE0ODNDRTE0NDRCQTcyRgA='}]}
2025-06-19 13:51:46,454 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:51:46] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:51:46,707 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:51:46] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:51:47,568 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:51:47] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:51:47,655 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:51:47] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:51:47,848 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:51:47] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:53:02,657 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-19 13:53:02,657 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 13:53:02,658 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 13:53:02,658 - services.payment_service - INFO - PaymentService initialized
2025-06-19 13:53:02,659 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 13:53:02,659 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 13:53:02,660 - services.payment_service - INFO - PaymentService initialized
2025-06-19 13:53:02,660 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-19 13:53:02,660 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-19 13:53:02,661 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-19 13:53:02,661 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 13:53:02,662 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-19 13:53:02,662 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-19 13:53:03,020 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-19 13:53:03,021 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-19 13:53:03,021 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-19 13:53:03,021 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 13:53:03,035 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-19 13:53:03,035 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-19 13:53:06,778 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-19 13:53:06,778 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-19 13:53:06,782 - handlers.base_handler - INFO - Session 2348055614455 recognized user 'Ziga'.
2025-06-19 13:53:06,783 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Welcome Ziga! 👋🏼\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-19 13:53:08,385 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkI0NzlGMjA2RjVDMTM4REY1QQA="}]}
2025-06-19 13:53:08,386 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkI0NzlGMjA2RjVDMTM4REY1QQA='}]}
2025-06-19 13:53:08,387 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:53:08] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:53:09,791 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:53:09] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:53:09,798 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:53:09] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:53:09,799 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:53:09] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:53:10,912 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'others_menu'}
2025-06-19 13:53:10,914 - handlers.base_handler - INFO - GreetingHandler: Handling message 'others_menu' in greeting state for session 2348055614455.
2025-06-19 13:53:10,915 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🔧 *Other Options*\n\nHere are other ways I can help you:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'enquiry', 'title': '❓ Enquiry'}}, {'type': 'reply', 'reply': {'id': 'complain', 'title': '📝 Complain'}}, {'type': 'reply', 'reply': {'id': 'back_to_main', 'title': '🔙 Back'}}]}}}
2025-06-19 13:53:11,902 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkI2NDlGMTM4ODFBMkEwODEzOQA="}]}
2025-06-19 13:53:11,903 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkI2NDlGMTM4ODFBMkEwODEzOQA='}]}
2025-06-19 13:53:11,903 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:53:11] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:53:12,906 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:53:12] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:53:13,021 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:53:13] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:53:13,123 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:53:13] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:53:14,244 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'complain'}
2025-06-19 13:53:14,246 - handlers.base_handler - INFO - GreetingHandler: Handling message 'complain' in 'others_menu_selection' state for session 2348055614455.
2025-06-19 13:53:14,247 - handlers.base_handler - INFO - Session 2348055614455 entering complaint state.
2025-06-19 13:53:14,247 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "We're sorry to hear you're having an issue. Please tell us about your complaint and we'll address it promptly."}}
2025-06-19 13:53:15,278 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjVCNkU5RjUyOTAyRkVFNUY4MAA="}]}
2025-06-19 13:53:15,278 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjVCNkU5RjUyOTAyRkVFNUY4MAA='}]}
2025-06-19 13:53:15,279 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:53:15] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:53:16,095 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:53:16] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:53:16,183 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:53:16] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:53:16,403 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:53:16] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:53:31,934 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Your customer care is terrible'}
2025-06-19 13:53:31,936 - handlers.complaint_handler - INFO - Complaint received from 2348055614455: Your customer care is terrible
2025-06-19 13:53:31,937 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': '✅ Thank you for your complaint! We have received it and will look into this issue promptly. We appreciate your patience.'}}
2025-06-19 13:53:32,952 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkZBRUU5NzFBQTBBNzdCREFCNwA="}]}
2025-06-19 13:53:32,953 - handlers.message_processor - INFO - Handler 'complaint_handler' returned None for session 2348055614455. Assuming message already sent. Sending main menu as next step.
2025-06-19 13:53:32,953 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Is there anything else I can help you with?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-19 13:53:33,764 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:53:33] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:53:33,943 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:53:33] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:53:34,011 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjdEQTNFOTlEOTMxMjc3Q0M3OAA="}]}
2025-06-19 13:53:34,012 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjdEQTNFOTlEOTMxMjc3Q0M3OAA='}]}
2025-06-19 13:53:34,012 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:53:34] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:53:34,153 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:53:34] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:53:34,813 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:53:34] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:53:34,942 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:53:34] "POST /webhook HTTP/1.1" 200 -
2025-06-19 13:53:35,122 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 13:53:35] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:05:37,276 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-19 14:05:37,276 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 14:05:37,277 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 14:05:37,277 - services.payment_service - INFO - PaymentService initialized
2025-06-19 14:05:37,278 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 14:05:37,278 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 14:05:37,278 - services.payment_service - INFO - PaymentService initialized
2025-06-19 14:05:37,279 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-19 14:05:37,279 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-19 14:05:37,279 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-19 14:05:37,280 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 14:05:37,280 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-19 14:05:37,280 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-19 14:05:37,647 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-19 14:05:37,648 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-19 14:05:37,648 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-19 14:05:37,648 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 14:05:37,662 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-19 14:05:37,662 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-19 14:05:44,176 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-19 14:05:44,176 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-19 14:05:44,180 - handlers.base_handler - INFO - Session 2348055614455 recognized user 'Ziga'.
2025-06-19 14:05:44,181 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Welcome Ziga! 👋🏼\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-19 14:05:45,222 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjVDRUU2NjFFQ0E0Nzk2NDEwQgA="}]}
2025-06-19 14:05:45,223 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjVDRUU2NjFFQ0E0Nzk2NDEwQgA='}]}
2025-06-19 14:05:45,224 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:05:45] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:05:46,129 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:05:46] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:05:46,239 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:05:46] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:05:46,681 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:05:46] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:05:47,363 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'others_menu'}
2025-06-19 14:05:47,366 - handlers.base_handler - INFO - GreetingHandler: Handling message 'others_menu' in greeting state for session 2348055614455.
2025-06-19 14:05:47,366 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🔧 *Other Options*\n\nHere are other ways I can help you:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'enquiry', 'title': '❓ Enquiry'}}, {'type': 'reply', 'reply': {'id': 'complain', 'title': '📝 Complain'}}, {'type': 'reply', 'reply': {'id': 'back_to_main', 'title': '🔙 Back'}}]}}}
2025-06-19 14:05:48,331 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjY3MTkzODk0N0I3MDhCNzZCMQA="}]}
2025-06-19 14:05:48,332 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjY3MTkzODk0N0I3MDhCNzZCMQA='}]}
2025-06-19 14:05:48,332 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:05:48] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:05:49,092 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:05:49] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:05:49,391 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:05:49] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:05:49,608 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:05:49] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:05:51,271 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'complain'}
2025-06-19 14:05:51,273 - handlers.base_handler - INFO - GreetingHandler: Handling message 'complain' in 'others_menu_selection' state for session 2348055614455.
2025-06-19 14:05:51,274 - handlers.base_handler - INFO - Session 2348055614455 entering complaint state.
2025-06-19 14:05:51,274 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "We're sorry to hear you're having an issue. Please tell us about your complaint and we'll address it promptly."}}
2025-06-19 14:05:52,209 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjRBMTI3NjhFNjVFNDc5OEZFQQA="}]}
2025-06-19 14:05:52,210 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjRBMTI3NjhFNjVFNDc5OEZFQQA='}]}
2025-06-19 14:05:52,210 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:05:52] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:05:53,072 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:05:53] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:05:53,130 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:05:53] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:05:53,442 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:05:53] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:06:04,126 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Theres was an issue with your customer care'}
2025-06-19 14:06:04,131 - utils.data_manager - INFO - Data saved to data\complaints.json
2025-06-19 14:06:04,131 - utils.data_manager - INFO - Complaint details saved to data\complaints.json
2025-06-19 14:06:04,132 - handlers.complaint_handler - INFO - Complaint saved for session 2348055614455: 1fca8da7-f602-4636-94ac-bb17ca8cdb5c
2025-06-19 14:06:04,132 - utils.session_manager - INFO - Full session 2348055614455 cleared.
2025-06-19 14:06:04,132 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': '✅ Thank you for your complaint!\n\n*Complaint ID:* 1fca8da7-f602-4636-94ac-bb17ca8cdb5c\n\nWe\'ve received your issue: "Theres was an issue with your customer care"\n\nOur team will review it and get back to you within 24 hours. We appreciate your patience! 😊\n\n*You can reference complaint ID 1fca8da7-f602-4636-94ac-bb17ca8cdb5c in future communications.*'}}
2025-06-19 14:06:05,069 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjk1MDk5NkI1OThGNDFCRjU4RgA="}]}
2025-06-19 14:06:05,070 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjk1MDk5NkI1OThGNDFCRjU4RgA='}]}
2025-06-19 14:06:05,070 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:06:05] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:06:05,942 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:06:05] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:06:06,102 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:06:06] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:06:06,266 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:06:06] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:16:50,345 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:16:50] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:25:10,476 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:25:10] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:32:30,966 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-19 14:32:30,966 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 14:32:30,967 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 14:32:30,969 - services.payment_service - INFO - PaymentService initialized
2025-06-19 14:32:30,969 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 14:32:30,969 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 14:32:30,970 - services.payment_service - INFO - PaymentService initialized
2025-06-19 14:32:30,971 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-19 14:32:30,971 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-19 14:32:30,972 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-19 14:32:30,973 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 14:32:30,973 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-19 14:32:30,973 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-19 14:32:31,367 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-19 14:32:31,367 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-19 14:32:31,368 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-19 14:32:31,368 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 14:32:31,399 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-19 14:32:31,399 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-19 14:32:47,761 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-19 14:32:47,761 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-19 14:32:47,777 - handlers.base_handler - INFO - Session 2348055614455 recognized user 'Ziga'.
2025-06-19 14:32:47,778 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Welcome Ziga! 👋🏼\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-19 14:32:48,974 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkZGNjI3N0RDRkM0NDhBNjc0NwA="}]}
2025-06-19 14:32:48,975 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkZGNjI3N0RDRkM0NDhBNjc0NwA='}]}
2025-06-19 14:32:48,976 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:32:48] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:32:49,923 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:32:49] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:32:50,148 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:32:50] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:32:50,382 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:32:50] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:32:53,263 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-19 14:32:53,265 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-06-19 14:32:53,266 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-06-19 14:32:53,266 - handlers.message_processor - INFO - Session 2348055614455: REDIRECTING to handler 'ai_handler' with instruction 'start_ai_bulk_order'.
2025-06-19 14:32:53,266 - handlers.message_processor - ERROR - Redirect target method missing: ai_handler.start_ai_bulk_order. Error: 'AIHandler' object has no attribute 'start_ai_bulk_order'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\app\handlers\message_processor.py", line 355, in _dispatch_message_to_handler
    return next_handler.start_ai_bulk_order(state, session_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'AIHandler' object has no attribute 'start_ai_bulk_order'
2025-06-19 14:32:53,280 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "I hit a snag trying to find the right information. Let's try again from the main menu."}}
2025-06-19 14:32:54,227 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkNGNzYzMDYzRDJBRUQzMDVGOAA="}]}
2025-06-19 14:32:54,228 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkNGNzYzMDYzRDJBRUQzMDVGOAA='}]}
2025-06-19 14:32:54,228 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:32:54] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:32:55,037 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:32:55] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:32:55,213 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:32:55] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:32:55,350 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:32:55] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:33:34,718 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-19 14:33:34,719 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 14:33:34,719 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 14:33:34,720 - services.payment_service - INFO - PaymentService initialized
2025-06-19 14:33:34,720 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 14:33:34,721 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 14:33:34,721 - services.payment_service - INFO - PaymentService initialized
2025-06-19 14:33:34,721 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-19 14:33:34,722 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-19 14:33:34,722 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-19 14:33:34,722 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 14:33:34,723 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-19 14:33:34,723 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-19 14:33:35,097 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-19 14:33:35,097 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-19 14:33:35,097 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-19 14:33:35,098 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 14:33:35,111 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-19 14:33:35,112 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-19 14:33:37,941 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-19 14:33:37,941 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-19 14:33:37,945 - handlers.base_handler - INFO - Session 2348055614455 recognized user 'Ziga'.
2025-06-19 14:33:37,945 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Welcome Ziga! 👋🏼\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-19 14:33:39,043 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjY5RDU0REJCQTY4OTRDMjRBRAA="}]}
2025-06-19 14:33:39,043 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjY5RDU0REJCQTY4OTRDMjRBRAA='}]}
2025-06-19 14:33:39,044 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:33:39] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:33:39,964 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:33:39] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:33:39,992 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:33:39] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:33:40,194 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:33:40] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:33:42,871 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-19 14:33:42,874 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-06-19 14:33:42,874 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-06-19 14:33:42,875 - handlers.message_processor - INFO - Session 2348055614455: REDIRECTING to handler 'ai_handler' with instruction 'start_ai_bulk_order'.
2025-06-19 14:33:42,875 - handlers.message_processor - ERROR - Redirect target method missing: ai_handler.start_ai_bulk_order. Error: 'AIHandler' object has no attribute 'start_ai_bulk_order'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\app\handlers\message_processor.py", line 360, in _dispatch_message_to_handler
    return next_handler.start_ai_bulk_order(state, session_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'AIHandler' object has no attribute 'start_ai_bulk_order'
2025-06-19 14:33:42,878 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "I hit a snag trying to find the right information. Let's try again from the main menu."}}
2025-06-19 14:33:43,882 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkYyNUNBQTAyRkEzQ0Q4M0ZENAA="}]}
2025-06-19 14:33:43,883 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkYyNUNBQTAyRkEzQ0Q4M0ZENAA='}]}
2025-06-19 14:33:43,883 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:33:43] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:33:44,696 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:33:44] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:33:44,892 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:33:44] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:33:44,954 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:33:44] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:39:05,256 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-19 14:39:05,256 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 14:39:05,257 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 14:39:05,257 - services.payment_service - INFO - PaymentService initialized
2025-06-19 14:39:05,258 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 14:39:05,258 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 14:39:05,259 - services.payment_service - INFO - PaymentService initialized
2025-06-19 14:39:05,259 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-19 14:39:05,259 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-19 14:39:05,260 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-19 14:39:05,261 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 14:39:05,261 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-19 14:39:05,261 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-19 14:39:05,761 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-19 14:39:05,761 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-19 14:39:05,761 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-19 14:39:05,762 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 14:39:05,778 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-19 14:39:05,778 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-19 14:39:12,440 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-19 14:39:12,441 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-19 14:39:12,445 - handlers.base_handler - INFO - Session 2348055614455 recognized user 'Ziga'.
2025-06-19 14:39:12,445 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Welcome Ziga! 👋🏼\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-19 14:39:13,537 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkFBRDE3NENEQTM1RTBFMjE4OQA="}]}
2025-06-19 14:39:13,538 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkFBRDE3NENEQTM1RTBFMjE4OQA='}]}
2025-06-19 14:39:13,539 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:39:13] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:39:14,543 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:39:14] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:39:14,664 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:39:14] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:39:14,832 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:39:14] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:39:15,826 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-19 14:39:15,829 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-06-19 14:39:15,829 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-06-19 14:39:15,829 - handlers.message_processor - INFO - Session 2348055614455: REDIRECTING to handler 'ai_handler' with instruction 'start_ai_bulk_order'.
2025-06-19 14:39:15,830 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Just send me your full order in one message! \n\nLike this: 'Two plates of jollof rice, 2 Cokes, and asun.'\n\nWant to go back again? Type ‘menu’ to return. "}}
2025-06-19 14:39:16,781 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjZFQkE0MUVFM0JEODA3Q0YzRAA="}]}
2025-06-19 14:39:16,782 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjZFQkE0MUVFM0JEODA3Q0YzRAA='}]}
2025-06-19 14:39:16,783 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:39:16] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:39:17,561 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:39:17] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:39:17,725 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:39:17] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:39:17,991 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:39:17] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:39:23,661 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Puff puff'}
2025-06-19 14:39:23,664 - handlers.base_handler - INFO - AIHandler: Handling message 'puff puff' in AI bulk order state for session 2348055614455. Original: 'Puff puff'
2025-06-19 14:39:26,092 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-19 14:39:26,099 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🛒 *Order Summary:*\n\n✅ 1x Puff Puff - ₦200\n\n*Total: ₦200.00*\n\nWould you like to proceed with this order?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'confirm_ai_order', 'title': '✅ Confirm Order'}}, {'type': 'reply', 'reply': {'id': 'modify_ai_order', 'title': '✏️ Modify Order'}}, {'type': 'reply', 'reply': {'id': 'cancel_ai_order', 'title': '❌ Cancel'}}]}}}
2025-06-19 14:39:27,069 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjI5ODAxNTI2RDQzRjg4QTI2OQA="}]}
2025-06-19 14:39:27,070 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjI5ODAxNTI2RDQzRjg4QTI2OQA='}]}
2025-06-19 14:39:27,070 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:39:27] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:39:27,822 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:39:27] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:39:28,074 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:39:28] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:39:28,282 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:39:28] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:39:29,915 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:39:29] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:39:31,812 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-06-19 14:39:31,815 - handlers.base_handler - INFO - AI order confirmed. Cart: {'Puff Puff': {'item_id': 'Puff Puff', 'quantity': 1, 'price': 200, 'total_price': 200, 'variations': {}}}. Redirecting to order handler.
2025-06-19 14:39:31,816 - handlers.message_processor - INFO - Session 2348055614455: REDIRECTING to handler 'order_handler' with instruction 'process_final_order'.
2025-06-19 14:39:31,816 - handlers.message_processor - WARNING - Redirect message 'process_final_order' not explicitly handled for 'order_handler'. Attempting generic fallback.
2025-06-19 14:39:31,817 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': "I didn't understand that. Please use the buttons to confirm your details or change them.\n\n📋 **Confirm Delivery Details:**\n\n👤 **Name:** Ziga\n📱 **Phone:** 2348055614455\n📍 **Address:** Howson Wright\n\nIs this information correct?"}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'details_correct', 'title': '✅ Correct'}}, {'type': 'reply', 'reply': {'id': 'change_all_details', 'title': '✏️ Change Details'}}]}}}
2025-06-19 14:39:32,781 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjIyNkNFNzE2QTRGQTNFQjhCMgA="}]}
2025-06-19 14:39:32,797 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦200 (1 items)
2025-06-19 14:39:32,797 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦200.00
2025-06-19 14:39:32,797 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjIyNkNFNzE2QTRGQTNFQjhCMgA='}]}
2025-06-19 14:39:32,798 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:39:32] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:39:33,592 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:39:33] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:39:33,771 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:39:33] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:39:33,872 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:39:33] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:39:50,586 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'details_correct'}
2025-06-19 14:39:50,589 - handlers.order_handler - INFO - User confirmed details are correct for session 2348055614455.
2025-06-19 14:39:50,589 - handlers.order_handler - INFO - Address set, proceeding to confirm order for manual session 2348055614455.
2025-06-19 14:39:50,590 - handlers.order_handler - INFO - Showing final order confirmation for session 2348055614455. Total: ₦200.00
2025-06-19 14:39:50,591 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🛒 *Final Order Confirmation*\n\n📋 *Items Ordered:*\n• 1x Puff Puff - ₦200.00\n\n📍 *Delivery Details:*\n👤 Name: Ziga\n📱 Phone: 2348055614455\n🏠 Address: Howson Wright\n\n💰 *Total Amount: ₦200.00*\n\nPlease confirm to proceed with payment.'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'final_confirm', 'title': '✅ Confirm & Pay'}}, {'type': 'reply', 'reply': {'id': 'edit_order', 'title': '✏️ Edit Order'}}, {'type': 'reply', 'reply': {'id': 'cancel_order', 'title': '❌ Cancel Order'}}]}}}
2025-06-19 14:39:51,542 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkJGMURCQjUyQzBCQ0UwNEJDNwA="}]}
2025-06-19 14:39:51,545 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦200 (1 items)
2025-06-19 14:39:51,545 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦200.00
2025-06-19 14:39:51,546 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkJGMURCQjUyQzBCQ0UwNEJDNwA='}]}
2025-06-19 14:39:51,546 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:39:51] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:39:52,296 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:39:52] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:39:52,529 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:39:52] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:39:52,882 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:39:52] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:39:54,390 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'final_confirm'}
2025-06-19 14:39:54,393 - handlers.order_handler - INFO - Order ORDER_20250619_143954_8f1f98db confirmed for session 2348055614455. Amount: ₦200.00
2025-06-19 14:39:54,396 - services.lead_tracker - INFO - Order completion tracked for 2348055614455: ORDER_20250619_143954_8f1f98db (₦200)
2025-06-19 14:39:54,396 - handlers.lead_tracking_handler - INFO - 💰 Conversion tracked: 2348055614455 - ORDER_20250619_143954_8f1f98db (₦200)
2025-06-19 14:39:54,397 - handlers.message_processor - INFO - Session 2348055614455: REDIRECTING to handler 'payment_handler' with instruction 'initiate_payment'.
2025-06-19 14:39:54,397 - handlers.message_processor - WARNING - Redirect message 'initiate_payment' not explicitly handled for 'payment_handler'. Attempting generic fallback.
2025-06-19 14:39:54,397 - handlers.base_handler - INFO - Handling payment processing for session 2348055614455, message: final_confirm
2025-06-19 14:39:54,397 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': '🔄 Processing your payment request. Please wait...'}}
2025-06-19 14:39:55,404 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkQwN0ExNjkzQTEyREY2OEM1NwA="}]}
2025-06-19 14:39:55,408 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦200 (1 items)
2025-06-19 14:39:55,408 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦200.00
2025-06-19 14:39:55,408 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkQwN0ExNjkzQTEyREY2OEM1NwA='}]}
2025-06-19 14:39:55,409 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:39:55] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:39:56,251 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:39:56] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:39:56,433 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:39:56] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:39:56,511 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:39:56] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:41:01,566 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-19 14:41:01,566 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 14:41:01,567 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 14:41:01,567 - services.payment_service - INFO - PaymentService initialized
2025-06-19 14:41:01,568 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 14:41:01,568 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 14:41:01,569 - services.payment_service - INFO - PaymentService initialized
2025-06-19 14:41:01,569 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-19 14:41:01,569 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-19 14:41:01,570 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-19 14:41:01,570 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 14:41:01,570 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-19 14:41:01,570 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-19 14:41:01,952 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-19 14:41:01,953 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-19 14:41:01,953 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-19 14:41:01,953 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 14:41:01,967 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-19 14:41:01,968 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-19 14:41:08,703 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-19 14:41:08,703 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-19 14:41:08,709 - handlers.base_handler - INFO - Session 2348055614455 recognized user 'Ziga'.
2025-06-19 14:41:08,710 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Welcome Ziga! 👋🏼\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-19 14:41:09,730 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjM4QTZDRTc2QTE2QzVCRDBBQgA="}]}
2025-06-19 14:41:09,731 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjM4QTZDRTc2QTE2QzVCRDBBQgA='}]}
2025-06-19 14:41:09,731 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:41:09] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:41:10,663 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:41:10] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:41:10,801 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:41:10] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:41:10,929 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:41:10] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:41:14,877 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-19 14:41:14,880 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-06-19 14:41:14,880 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-06-19 14:41:14,881 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with initial message 'start_ai_bulk_order'.
2025-06-19 14:41:14,881 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-06-19 14:41:16,959 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-19 14:41:16,961 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "❌ None\n\nPlease try rephrasing your order or type 'menu' to return to main menu."}}
2025-06-19 14:41:17,969 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQ4MkRGRTFCRkZCNDZCRDMwMwA="}]}
2025-06-19 14:41:17,970 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQ4MkRGRTFCRkZCNDZCRDMwMwA='}]}
2025-06-19 14:41:17,971 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:41:17] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:41:18,763 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:41:18] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:41:18,902 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:41:18] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:41:19,217 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:41:19] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:45:37,487 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-19 14:45:37,488 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 14:45:37,489 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 14:45:37,489 - services.payment_service - INFO - PaymentService initialized
2025-06-19 14:45:37,490 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 14:45:37,490 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 14:45:37,491 - services.payment_service - INFO - PaymentService initialized
2025-06-19 14:45:37,491 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-19 14:45:37,491 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-19 14:45:37,492 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-19 14:45:37,493 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 14:45:37,493 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-19 14:45:37,493 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-19 14:45:37,882 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-19 14:45:37,882 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-19 14:45:37,883 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-19 14:45:37,883 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 14:45:37,904 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-19 14:45:37,904 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-19 14:45:47,859 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-19 14:45:47,859 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-19 14:45:47,862 - handlers.base_handler - INFO - Session 2348055614455 recognized user 'Ziga'.
2025-06-19 14:45:47,863 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Welcome Ziga! 👋🏼\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-19 14:45:50,297 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjNDNkVCRUEzRjQ3REI0QjY1OQA="}]}
2025-06-19 14:45:50,298 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjNDNkVCRUEzRjQ3REI0QjY1OQA='}]}
2025-06-19 14:45:50,299 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:45:50] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:45:51,110 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:45:51] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:45:51,480 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:45:51] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:45:51,610 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:45:51] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:45:52,878 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-19 14:45:52,881 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-06-19 14:45:52,881 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-06-19 14:45:52,882 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with initial message 'start_ai_bulk_order'.
2025-06-19 14:45:52,882 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-06-19 14:45:52,883 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Just send me your full order in one message! \n\nLike this: 'Two plates of jollof rice, 2 Cokes, and asun.'\n\nWant to go back again? Type ‘menu’ to return. "}}
2025-06-19 14:45:58,218 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjBFRkRBNTE3NzdFMUIyN0RBNgA="}]}
2025-06-19 14:45:58,219 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjBFRkRBNTE3NzdFMUIyN0RBNgA='}]}
2025-06-19 14:45:58,219 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:45:58] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:45:58,954 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:45:58] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:45:59,295 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:45:59] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:46:00,368 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:46:00] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:46:35,339 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Fried rice'}
2025-06-19 14:46:35,342 - handlers.base_handler - INFO - AIHandler: Handling message 'fried rice' in AI bulk order state for session 2348055614455. Original: 'Fried rice'
2025-06-19 14:46:37,798 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-19 14:46:37,800 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🛒 *Order Summary:*\n\n✅ 1x Fried Rice Fiesta - ₦1,400\n\n*Total: ₦1,400.00*\n\nWould you like to proceed with this order?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'confirm_ai_order', 'title': '✅ Confirm Order'}}, {'type': 'reply', 'reply': {'id': 'modify_ai_order', 'title': '✏️ Modify Order'}}, {'type': 'reply', 'reply': {'id': 'cancel_ai_order', 'title': '❌ Cancel'}}]}}}
2025-06-19 14:46:38,479 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjBBM0NGQzQ3NjFCNzFBQTM5NAA="}]}
2025-06-19 14:46:38,480 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjBBM0NGQzQ3NjFCNzFBQTM5NAA='}]}
2025-06-19 14:46:38,480 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:46:38] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:46:39,465 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:46:39] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:46:40,023 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:46:40] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:46:55,942 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:46:55] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:46:57,687 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-06-19 14:46:57,690 - handlers.base_handler - INFO - AI order confirmed. Cart: {'Fried Rice Fiesta': {'item_id': 'Fried Rice Fiesta', 'quantity': 1, 'price': 1400, 'total_price': 1400, 'variations': {}}}. Redirecting to order handler.
2025-06-19 14:46:57,691 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'order_handler' with initial message 'process_final_order'.
2025-06-19 14:46:57,691 - handlers.message_processor - ERROR - Error in message routing for handler 'order_handler', state 'confirm_details' for session 2348055614455: OrderHandler.handle_confirm_details_state() takes 4 positional arguments but 5 were given
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\app\handlers\message_processor.py", line 235, in _route_to_handler
    response = self.order_handler.handle_confirm_details_state(state, message, original_message, session_id)
TypeError: OrderHandler.handle_confirm_details_state() takes 4 positional arguments but 5 were given
2025-06-19 14:46:57,693 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "⚠️ Oops! Something went wrong. Let's get back to the main menu. Please try again."}}
2025-06-19 14:46:58,347 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkQzRThBQTVDRUFFRjNEMjUwRgA="}]}
2025-06-19 14:46:58,351 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦1,400 (1 items)
2025-06-19 14:46:58,351 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦1,400.00
2025-06-19 14:46:58,351 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkQzRThBQTVDRUFFRjNEMjUwRgA='}]}
2025-06-19 14:46:58,352 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:46:58] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:46:59,176 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:46:59] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:46:59,702 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:46:59] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:47:40,888 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-19 14:47:40,888 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 14:47:40,889 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 14:47:40,890 - services.payment_service - INFO - PaymentService initialized
2025-06-19 14:47:40,890 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 14:47:40,891 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 14:47:40,892 - services.payment_service - INFO - PaymentService initialized
2025-06-19 14:47:40,892 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-19 14:47:40,893 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-19 14:47:40,893 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-19 14:47:40,893 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 14:47:40,894 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-19 14:47:40,894 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-19 14:47:41,273 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-19 14:47:41,273 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-19 14:47:41,274 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-19 14:47:41,274 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 14:47:41,291 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-19 14:47:41,291 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-19 14:47:44,825 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-19 14:47:44,825 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-19 14:47:44,830 - handlers.base_handler - INFO - Session 2348055614455 recognized user 'Ziga'.
2025-06-19 14:47:44,831 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Welcome Ziga! 👋🏼\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-19 14:47:45,506 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjNDRjAxRjU0RTRFMDVBMTMzNgA="}]}
2025-06-19 14:47:45,507 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjNDRjAxRjU0RTRFMDVBMTMzNgA='}]}
2025-06-19 14:47:45,508 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:47:45] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:47:46,445 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:47:46] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:47:47,147 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:47:47] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:47:48,297 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-19 14:47:48,301 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-06-19 14:47:48,302 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-06-19 14:47:48,302 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with initial message 'start_ai_bulk_order'.
2025-06-19 14:47:48,302 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-06-19 14:47:48,303 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Just send me your full order in one message! \n\nLike this: 'Two plates of jollof rice, 2 Cokes, and asun.'\n\nWant to go back again? Type ‘menu’ to return. "}}
2025-06-19 14:47:49,000 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkVDQjI0MzQ2NzhDM0VCNkFDQQA="}]}
2025-06-19 14:47:49,000 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkVDQjI0MzQ2NzhDM0VCNkFDQQA='}]}
2025-06-19 14:47:49,001 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:47:49] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:47:49,765 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:47:49] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:47:50,630 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:47:50] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:47:55,147 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Jellof rice'}
2025-06-19 14:47:55,150 - handlers.base_handler - INFO - AIHandler: Handling message 'jellof rice' in AI bulk order state for session 2348055614455. Original: 'Jellof rice'
2025-06-19 14:47:57,539 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-19 14:47:57,541 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🛒 *Order Summary:*\n\n✅ 1x Smoky Jollof Fiesta - ₦1,500\n\n*Total: ₦1,500.00*\n\nWould you like to proceed with this order?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'confirm_ai_order', 'title': '✅ Confirm Order'}}, {'type': 'reply', 'reply': {'id': 'modify_ai_order', 'title': '✏️ Modify Order'}}, {'type': 'reply', 'reply': {'id': 'cancel_ai_order', 'title': '❌ Cancel'}}]}}}
2025-06-19 14:47:58,229 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjdFQkZCMjdCM0YyOEFBRTQ5NgA="}]}
2025-06-19 14:47:58,230 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjdFQkZCMjdCM0YyOEFBRTQ5NgA='}]}
2025-06-19 14:47:58,230 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:47:58] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:47:59,263 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:47:59] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:47:59,285 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:47:59] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:47:59,812 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:47:59] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:48:00,878 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-06-19 14:48:00,881 - handlers.base_handler - INFO - AI order confirmed. Cart: {'Smoky Jollof Fiesta': {'item_id': 'Smoky Jollof Fiesta', 'quantity': 1, 'price': 1500, 'total_price': 1500, 'variations': {}}}. Redirecting to order handler.
2025-06-19 14:48:00,881 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'order_handler' with initial message 'process_final_order'.
2025-06-19 14:48:00,882 - handlers.message_processor - ERROR - Error in message routing for handler 'order_handler', state 'confirm_details' for session 2348055614455: 'OrderHandler' object has no attribute 'handle_confirm_details_state'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\app\handlers\message_processor.py", line 235, in _route_to_handler
    response = self.order_handler.handle_confirm_details_state(state, message, original_message, session_id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'OrderHandler' object has no attribute 'handle_confirm_details_state'
2025-06-19 14:48:00,885 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "⚠️ Oops! Something went wrong. Let's get back to the main menu. Please try again."}}
2025-06-19 14:48:01,522 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjU1MTI0QTMyMjU1MzZFOTIzQwA="}]}
2025-06-19 14:48:01,525 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦1,500 (1 items)
2025-06-19 14:48:01,525 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦1,500.00
2025-06-19 14:48:01,526 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjU1MTI0QTMyMjU1MzZFOTIzQwA='}]}
2025-06-19 14:48:01,527 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:48:01] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:48:02,319 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:48:02] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:48:02,403 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:48:02] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:48:03,074 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:48:03] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:48:18,309 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-19 14:48:18,309 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 14:48:18,310 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 14:48:18,311 - services.payment_service - INFO - PaymentService initialized
2025-06-19 14:48:18,311 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 14:48:18,311 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 14:48:18,312 - services.payment_service - INFO - PaymentService initialized
2025-06-19 14:48:18,312 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-19 14:48:18,313 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-19 14:48:18,313 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-19 14:48:18,314 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 14:48:18,314 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-19 14:48:18,314 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-19 14:48:18,676 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-19 14:48:18,676 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-19 14:48:18,676 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-19 14:48:18,677 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 14:48:18,696 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-19 14:48:18,696 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-19 14:48:32,343 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-19 14:48:32,344 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-19 14:48:32,348 - handlers.base_handler - INFO - Session 2348055614455 recognized user 'Ziga'.
2025-06-19 14:48:32,349 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Welcome Ziga! 👋🏼\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-19 14:48:33,012 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjEzODYyRTM5RDdENUQzNzM2MgA="}]}
2025-06-19 14:48:33,012 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjEzODYyRTM5RDdENUQzNzM2MgA='}]}
2025-06-19 14:48:33,013 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:48:33] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:48:33,946 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:48:33] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:48:34,103 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:48:34] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:48:34,842 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:48:34] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:48:35,591 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-19 14:48:35,594 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-06-19 14:48:35,594 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-06-19 14:48:35,595 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with initial message 'start_ai_bulk_order'.
2025-06-19 14:48:35,595 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-06-19 14:48:35,596 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Just send me your full order in one message! \n\nLike this: 'Two plates of jollof rice, 2 Cokes, and asun.'\n\nWant to go back again? Type ‘menu’ to return. "}}
2025-06-19 14:48:36,263 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjg1NDMxRDU4MEU1RTc1QjFCNwA="}]}
2025-06-19 14:48:36,263 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjg1NDMxRDU4MEU1RTc1QjFCNwA='}]}
2025-06-19 14:48:36,264 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:48:36] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:48:37,073 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:48:37] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:48:37,204 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:48:37] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:48:37,799 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:48:37] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:48:45,214 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Fried rice'}
2025-06-19 14:48:45,217 - handlers.base_handler - INFO - AIHandler: Handling message 'fried rice' in AI bulk order state for session 2348055614455. Original: 'Fried rice'
2025-06-19 14:48:47,524 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-19 14:48:47,527 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🛒 *Order Summary:*\n\n✅ 1x Fried Rice Fiesta - ₦1,400\n\n*Total: ₦1,400.00*\n\nWould you like to proceed with this order?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'confirm_ai_order', 'title': '✅ Confirm Order'}}, {'type': 'reply', 'reply': {'id': 'modify_ai_order', 'title': '✏️ Modify Order'}}, {'type': 'reply', 'reply': {'id': 'cancel_ai_order', 'title': '❌ Cancel'}}]}}}
2025-06-19 14:48:48,199 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQ0OEY1QzlEQUNBNzIxREYzOAA="}]}
2025-06-19 14:48:48,199 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQ0OEY1QzlEQUNBNzIxREYzOAA='}]}
2025-06-19 14:48:48,200 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:48:48] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:48:49,064 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:48:49] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:48:49,203 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:48:49] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:48:49,859 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:48:49] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:48:50,883 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-06-19 14:48:50,886 - handlers.base_handler - INFO - AI order confirmed. Cart: {'Fried Rice Fiesta': {'item_id': 'Fried Rice Fiesta', 'quantity': 1, 'price': 1400, 'total_price': 1400, 'variations': {}}}. Redirecting to order handler.
2025-06-19 14:48:50,887 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'order_handler' with initial message 'process_final_order'.
2025-06-19 14:48:50,887 - handlers.message_processor - ERROR - Error in message routing for handler 'order_handler', state 'confirm_details' for session 2348055614455: OrderHandler.handle_confirm_details_state() takes 4 positional arguments but 5 were given
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\app\handlers\message_processor.py", line 235, in _route_to_handler
    response = self.order_handler.handle_confirm_details_state(state, message, original_message, session_id)
TypeError: OrderHandler.handle_confirm_details_state() takes 4 positional arguments but 5 were given
2025-06-19 14:48:50,892 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "⚠️ Oops! Something went wrong. Let's get back to the main menu. Please try again."}}
2025-06-19 14:48:51,645 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjg2MEMwOTcxRDEzMkU4RkI3NwA="}]}
2025-06-19 14:48:51,650 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦1,400 (1 items)
2025-06-19 14:48:51,651 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦1,400.00
2025-06-19 14:48:51,651 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjg2MEMwOTcxRDEzMkU4RkI3NwA='}]}
2025-06-19 14:48:51,652 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:48:51] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:48:52,711 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:48:52] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:48:52,826 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:48:52] "POST /webhook HTTP/1.1" 200 -
2025-06-19 14:48:53,198 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 14:48:53] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:06:05,563 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-19 15:06:05,564 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 15:06:05,564 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 15:06:05,565 - services.payment_service - INFO - PaymentService initialized
2025-06-19 15:06:05,566 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 15:06:05,566 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 15:06:05,567 - services.payment_service - INFO - PaymentService initialized
2025-06-19 15:06:05,567 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-19 15:06:05,567 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-19 15:06:05,569 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-19 15:06:05,569 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 15:06:05,570 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-19 15:06:05,570 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-19 15:06:06,133 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-19 15:06:06,133 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-19 15:06:06,133 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-19 15:06:06,133 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 15:06:06,154 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-19 15:06:06,155 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-19 15:06:25,064 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-19 15:06:25,064 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-19 15:06:25,070 - handlers.base_handler - INFO - Session 2348055614455 recognized user 'Ziga'.
2025-06-19 15:06:25,070 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Welcome Ziga! 👋🏼\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-19 15:06:25,874 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjY0QjkxOTUyMjdFNjE3RjBBNgA="}]}
2025-06-19 15:06:25,874 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjY0QjkxOTUyMjdFNjE3RjBBNgA='}]}
2025-06-19 15:06:25,875 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:06:25] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:06:26,822 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:06:26] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:06:26,849 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:06:26] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:06:27,642 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:06:27] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:06:31,014 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-19 15:06:31,017 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-06-19 15:06:31,017 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-06-19 15:06:31,018 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with initial message 'start_ai_bulk_order'.
2025-06-19 15:06:31,018 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-06-19 15:06:31,018 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Just send me your full order in one message! \n\nLike this: 'Two plates of jollof rice, 2 Cokes, and asun.'\n\nWant to go back again? Type ‘menu’ to return. "}}
2025-06-19 15:06:31,907 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjMxNTgyNjQ0Q0ZBODY2RTQ4MAA="}]}
2025-06-19 15:06:31,908 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjMxNTgyNjQ0Q0ZBODY2RTQ4MAA='}]}
2025-06-19 15:06:31,909 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:06:31] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:06:32,903 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:06:32] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:06:33,034 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:06:33] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:06:33,608 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:06:33] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:06:37,790 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Jellof rice'}
2025-06-19 15:06:37,792 - handlers.base_handler - INFO - AIHandler: Handling message 'jellof rice' in AI bulk order state for session 2348055614455. Original: 'Jellof rice'
2025-06-19 15:06:40,533 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-19 15:06:40,536 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🛒 *Order Summary:*\n\n✅ 1x Smoky Jollof Fiesta - ₦1,500\n\n*Total: ₦1,500.00*\n\nWould you like to proceed with this order?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'confirm_ai_order', 'title': '✅ Confirm Order'}}, {'type': 'reply', 'reply': {'id': 'modify_ai_order', 'title': '✏️ Modify Order'}}, {'type': 'reply', 'reply': {'id': 'cancel_ai_order', 'title': '❌ Cancel'}}]}}}
2025-06-19 15:06:41,168 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjM1QTIzODkxNjVDNDdCMDcwNAA="}]}
2025-06-19 15:06:41,169 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjM1QTIzODkxNjVDNDdCMDcwNAA='}]}
2025-06-19 15:06:41,169 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:06:41] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:06:41,977 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:06:41] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:06:42,176 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:06:42] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:06:42,466 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:06:42] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:06:45,980 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-06-19 15:06:45,983 - handlers.base_handler - INFO - AI order confirmed. Cart: {'Smoky Jollof Fiesta': {'item_id': 'Smoky Jollof Fiesta', 'quantity': 1, 'price': 1500, 'total_price': 1500, 'variations': {}}}. Redirecting to order handler.
2025-06-19 15:06:45,983 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'order_handler' with initial message 'process_final_order'.
2025-06-19 15:06:45,983 - handlers.message_processor - ERROR - Error in message routing for handler 'order_handler', state 'confirm_details' for session 2348055614455: OrderHandler.handle_confirm_details_state() takes 4 positional arguments but 5 were given
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\app\handlers\message_processor.py", line 236, in _route_to_handler
    response = self.order_handler.handle_confirm_details_state(state, message, original_message, session_id)
TypeError: OrderHandler.handle_confirm_details_state() takes 4 positional arguments but 5 were given
2025-06-19 15:06:45,985 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "⚠️ Oops! Something went wrong. Let's get back to the main menu. Please try again."}}
2025-06-19 15:06:46,584 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjlGQUE4N0VBOEQ5OEJGNjAxRgA="}]}
2025-06-19 15:06:46,598 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦1,500 (1 items)
2025-06-19 15:06:46,598 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦1,500.00
2025-06-19 15:06:46,598 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjlGQUE4N0VBOEQ5OEJGNjAxRgA='}]}
2025-06-19 15:06:46,599 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:06:46] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:06:47,376 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:06:47] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:06:47,505 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:06:47] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:06:48,175 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:06:48] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:09:16,541 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-19 15:09:16,541 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 15:09:16,542 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 15:09:16,543 - services.payment_service - INFO - PaymentService initialized
2025-06-19 15:09:16,543 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 15:09:16,543 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 15:09:16,544 - services.payment_service - INFO - PaymentService initialized
2025-06-19 15:09:16,544 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-19 15:09:16,544 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-19 15:09:16,545 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-19 15:09:16,545 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 15:09:16,546 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-19 15:09:16,546 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-19 15:09:16,952 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-19 15:09:16,952 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-19 15:09:16,953 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-19 15:09:16,953 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 15:09:16,966 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-19 15:09:16,967 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-19 15:09:25,396 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-19 15:09:25,396 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-19 15:09:25,400 - handlers.base_handler - INFO - Session 2348055614455 recognized user 'Ziga'.
2025-06-19 15:09:25,401 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Welcome Ziga! 👋🏼\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-19 15:09:26,094 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjY3NDQ5N0ZCQTNFMEYzMTIxNwA="}]}
2025-06-19 15:09:26,095 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjY3NDQ5N0ZCQTNFMEYzMTIxNwA='}]}
2025-06-19 15:09:26,095 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:09:26] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:09:26,982 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:09:26] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:09:27,016 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:09:27] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:09:27,471 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:09:27] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:09:28,622 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-19 15:09:28,624 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-06-19 15:09:28,625 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-06-19 15:09:28,625 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with initial message 'start_ai_bulk_order'.
2025-06-19 15:09:28,626 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-06-19 15:09:28,626 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Just send me your full order in one message! \n\nLike this: 'Two plates of jollof rice, 2 Cokes, and asun.'\n\nWant to go back again? Type ‘menu’ to return. "}}
2025-06-19 15:09:29,374 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjYxNTc1MjhGREFCMEE3NURGMQA="}]}
2025-06-19 15:09:29,375 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjYxNTc1MjhGREFCMEE3NURGMQA='}]}
2025-06-19 15:09:29,375 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:09:29] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:09:30,186 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:09:30] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:09:30,445 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:09:30] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:09:31,022 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:09:31] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:09:34,794 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Fried rice'}
2025-06-19 15:09:34,796 - handlers.base_handler - INFO - AIHandler: Handling message 'fried rice' in AI bulk order state for session 2348055614455. Original: 'Fried rice'
2025-06-19 15:09:36,988 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-19 15:09:36,991 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🛒 *Order Summary:*\n\n✅ 1x Fried Rice Fiesta - ₦1,400\n\n*Total: ₦1,400.00*\n\nWould you like to proceed with this order?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'confirm_ai_order', 'title': '✅ Confirm Order'}}, {'type': 'reply', 'reply': {'id': 'modify_ai_order', 'title': '✏️ Modify Order'}}, {'type': 'reply', 'reply': {'id': 'cancel_ai_order', 'title': '❌ Cancel'}}]}}}
2025-06-19 15:09:37,674 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjUyRTczRDE1MTg0QTNBNjUxOQA="}]}
2025-06-19 15:09:37,675 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjUyRTczRDE1MTg0QTNBNjUxOQA='}]}
2025-06-19 15:09:37,675 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:09:37] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:09:38,598 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:09:38] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:09:38,687 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:09:38] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:09:39,007 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:09:39] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:09:40,146 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-06-19 15:09:40,149 - handlers.base_handler - INFO - AI order confirmed. Cart: {'Fried Rice Fiesta': {'item_id': 'Fried Rice Fiesta', 'quantity': 1, 'price': 1400, 'total_price': 1400, 'variations': {}}}. Redirecting to order handler.
2025-06-19 15:09:40,149 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'order_handler' with initial message 'process_final_order'.
2025-06-19 15:09:40,150 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': "🛒 *ORDER SUMMARY*\n\n📋 *Items Ordered:*\n• 1x Fried Rice Fiesta - ₦1,400.00\n\n📍 *Delivery Details:*\n👤 Name: Ziga\n📱 Phone: 2348055614455\n🏠 Address: Howson Wright\n\n💰 *Total Amount: ₦1,400.00*\n\nPlease review your order and delivery details:\n\nIs this information correct?\n1. Yes (Confirm and proceed to payment)\n2. No (Change name and address)\nOr type 'menu' to go back."}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'confirm_details_yes', 'title': '✅ Yes'}}, {'type': 'reply', 'reply': {'id': 'confirm_details_no', 'title': '✏️ No (Change)'}}]}}}
2025-06-19 15:09:40,752 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkQ1NTgwNzY3NEEzNENGRTdEOAA="}]}
2025-06-19 15:09:40,755 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦1,400 (1 items)
2025-06-19 15:09:40,755 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦1,400.00
2025-06-19 15:09:40,756 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkQ1NTgwNzY3NEEzNENGRTdEOAA='}]}
2025-06-19 15:09:40,756 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:09:40] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:09:41,600 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:09:41] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:09:41,752 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:09:41] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:09:42,297 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:09:42] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:09:44,902 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_details_yes'}
2025-06-19 15:09:44,904 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Please use the buttons to confirm your order, modify it, or change your address. You can also type 'add', 'remove', 'cancel', or 'back'."}}
2025-06-19 15:09:45,488 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkQ5MjYyMTcyQzhENjVCMTJCNQA="}]}
2025-06-19 15:09:45,491 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦1,400 (1 items)
2025-06-19 15:09:45,491 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦1,400.00
2025-06-19 15:09:45,492 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkQ5MjYyMTcyQzhENjVCMTJCNQA='}]}
2025-06-19 15:09:45,492 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:09:45] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:09:46,345 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:09:46] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:09:46,432 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:09:46] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:09:47,039 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:09:47] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:10:36,461 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-19 15:10:36,461 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 15:10:36,462 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 15:10:36,462 - services.payment_service - INFO - PaymentService initialized
2025-06-19 15:10:36,463 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 15:10:36,463 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 15:10:36,464 - services.payment_service - INFO - PaymentService initialized
2025-06-19 15:10:36,464 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-19 15:10:36,465 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-19 15:10:36,465 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-19 15:10:36,466 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 15:10:36,466 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-19 15:10:36,466 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-19 15:10:36,820 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-19 15:10:36,821 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-19 15:10:36,821 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-19 15:10:36,821 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 15:10:36,835 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-19 15:10:36,835 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-19 15:10:40,515 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-19 15:10:40,515 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-19 15:10:40,520 - handlers.base_handler - INFO - Session 2348055614455 recognized user 'Ziga'.
2025-06-19 15:10:40,521 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Welcome Ziga! 👋🏼\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-19 15:10:41,172 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjIzODQ4NTREOTdGNkNCNzVCNAA="}]}
2025-06-19 15:10:41,173 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjIzODQ4NTREOTdGNkNCNzVCNAA='}]}
2025-06-19 15:10:41,173 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:10:41] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:10:42,080 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:10:42] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:10:42,370 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:10:42] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:10:43,127 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:10:43] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:10:44,038 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-19 15:10:44,043 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-06-19 15:10:44,044 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-06-19 15:10:44,044 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with initial message 'start_ai_bulk_order'.
2025-06-19 15:10:44,045 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-06-19 15:10:44,045 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Just send me your full order in one message! \n\nLike this: 'Two plates of jollof rice, 2 Cokes, and asun.'\n\nWant to go back again? Type ‘menu’ to return. "}}
2025-06-19 15:10:44,682 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjA1QUEzQTg4QTg5Q0Y2RjQyQwA="}]}
2025-06-19 15:10:44,682 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjA1QUEzQTg4QTg5Q0Y2RjQyQwA='}]}
2025-06-19 15:10:44,683 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:10:44] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:10:45,558 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:10:45] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:10:45,859 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:10:45] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:10:46,112 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:10:46] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:10:49,522 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Fried rice'}
2025-06-19 15:10:49,525 - handlers.base_handler - INFO - AIHandler: Handling message 'fried rice' in AI bulk order state for session 2348055614455. Original: 'Fried rice'
2025-06-19 15:10:51,776 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-19 15:10:51,778 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🛒 *Order Summary:*\n\n✅ 1x Fried Rice Fiesta - ₦1,400\n\n*Total: ₦1,400.00*\n\nWould you like to proceed with this order?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'confirm_ai_order', 'title': '✅ Confirm Order'}}, {'type': 'reply', 'reply': {'id': 'modify_ai_order', 'title': '✏️ Modify Order'}}, {'type': 'reply', 'reply': {'id': 'cancel_ai_order', 'title': '❌ Cancel'}}]}}}
2025-06-19 15:10:52,527 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkEzOUFEQkVEN0JDOEU2QUY0QQA="}]}
2025-06-19 15:10:52,527 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkEzOUFEQkVEN0JDOEU2QUY0QQA='}]}
2025-06-19 15:10:52,528 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:10:52] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:10:53,474 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:10:53] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:10:53,499 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:10:53] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:10:53,953 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:10:53] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:10:54,898 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-06-19 15:10:54,900 - handlers.base_handler - INFO - AI order confirmed. Cart: {'Fried Rice Fiesta': {'item_id': 'Fried Rice Fiesta', 'quantity': 1, 'price': 1400, 'total_price': 1400, 'variations': {}}}. Redirecting to order handler.
2025-06-19 15:10:54,900 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'order_handler' with initial message 'process_final_order'.
2025-06-19 15:10:54,901 - handlers.message_processor - ERROR - Error in message routing for handler 'order_handler', state 'confirm_details' for session 2348055614455: OrderHandler.handle_confirm_details_state() takes 4 positional arguments but 5 were given
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\app\handlers\message_processor.py", line 236, in _route_to_handler
    response = self.order_handler.handle_confirm_details_state(state, message, original_message, session_id)
TypeError: OrderHandler.handle_confirm_details_state() takes 4 positional arguments but 5 were given
2025-06-19 15:10:54,902 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "⚠️ Oops! Something went wrong. Let's get back to the main menu. Please try again."}}
2025-06-19 15:10:55,498 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkFFNUQyOUM3MzdGM0E1OEJBMgA="}]}
2025-06-19 15:10:55,512 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦1,400 (1 items)
2025-06-19 15:10:55,513 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦1,400.00
2025-06-19 15:10:55,513 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkFFNUQyOUM3MzdGM0E1OEJBMgA='}]}
2025-06-19 15:10:55,514 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:10:55] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:10:56,388 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:10:56] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:10:56,576 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:10:56] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:10:56,835 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:10:56] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:15:15,435 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-19 15:15:15,435 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 15:15:15,436 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 15:15:15,436 - services.payment_service - INFO - PaymentService initialized
2025-06-19 15:15:15,437 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 15:15:15,437 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 15:15:15,438 - services.payment_service - INFO - PaymentService initialized
2025-06-19 15:15:15,438 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-19 15:15:15,439 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-19 15:15:15,439 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-19 15:15:15,440 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 15:15:15,440 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-19 15:15:15,441 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-19 15:15:16,027 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-19 15:15:16,027 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-19 15:15:16,028 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-19 15:15:16,028 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 15:15:16,053 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-19 15:15:16,053 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-19 15:15:23,908 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-19 15:15:23,909 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-19 15:15:23,912 - handlers.base_handler - INFO - Session 2348055614455 recognized user 'Ziga'.
2025-06-19 15:15:23,913 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Welcome Ziga! 👋🏼\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-19 15:15:24,597 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjhCM0E3Qzk5NjNGRDE2QUQyRQA="}]}
2025-06-19 15:15:24,598 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjhCM0E3Qzk5NjNGRDE2QUQyRQA='}]}
2025-06-19 15:15:24,599 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:15:24] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:15:25,442 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:15:25] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:15:25,572 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:15:25] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:15:25,912 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:15:25] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:15:26,884 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-19 15:15:26,887 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-06-19 15:15:26,887 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-06-19 15:15:26,888 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with initial message 'start_ai_bulk_order'.
2025-06-19 15:15:26,888 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-06-19 15:15:26,889 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Just send me your full order in one message! \n\nLike this: 'Two plates of jollof rice, 2 Cokes, and asun.'\n\nWant to go back again? Type ‘menu’ to return. "}}
2025-06-19 15:15:27,534 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjU1QzQ0NjU3MjA0Mzk3QTU1NAA="}]}
2025-06-19 15:15:27,534 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjU1QzQ0NjU3MjA0Mzk3QTU1NAA='}]}
2025-06-19 15:15:27,535 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:15:27] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:15:28,522 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:15:28] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:15:28,525 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:15:28] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:15:28,604 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:15:28] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:15:32,727 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Fried rice'}
2025-06-19 15:15:32,730 - handlers.base_handler - INFO - AIHandler: Handling message 'fried rice' in AI bulk order state for session 2348055614455. Original: 'Fried rice'
2025-06-19 15:15:35,069 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-19 15:15:35,072 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🛒 *Order Summary:*\n\n✅ 1x Fried Rice Fiesta - ₦1,400\n\n*Total: ₦1,400.00*\n\nWould you like to proceed with this order?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'confirm_ai_order', 'title': '✅ Confirm Order'}}, {'type': 'reply', 'reply': {'id': 'modify_ai_order', 'title': '✏️ Modify Order'}}, {'type': 'reply', 'reply': {'id': 'cancel_ai_order', 'title': '❌ Cancel'}}]}}}
2025-06-19 15:15:35,656 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjZBNjY4QTkxRTYzMUJERDJFRAA="}]}
2025-06-19 15:15:35,656 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjZBNjY4QTkxRTYzMUJERDJFRAA='}]}
2025-06-19 15:15:35,657 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:15:35] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:15:36,649 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:15:36] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:15:36,697 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:15:36] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:15:37,029 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:15:37] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:15:37,710 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-06-19 15:15:37,713 - handlers.base_handler - INFO - AI order confirmed. Cart: {'Fried Rice Fiesta': {'item_id': 'Fried Rice Fiesta', 'quantity': 1, 'price': 1400, 'total_price': 1400, 'variations': {}}}. Redirecting to order handler.
2025-06-19 15:15:37,713 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'order_handler' with initial message 'process_final_order'.
2025-06-19 15:15:37,714 - handlers.order_handler - INFO - AI initiated order processing for session confirm_ai_order.
2025-06-19 15:15:37,714 - handlers.order_handler - INFO - Address set, proceeding to confirm order for AI-initiated session confirm_ai_order.
2025-06-19 15:15:37,715 - handlers.order_handler - INFO - Showing final order confirmation for session confirm_ai_order. Total: ₦1,400.00
2025-06-19 15:15:37,715 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': 'confirm_ai_order', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🛒 *Final Order Confirmation*\n\n📋 *Items Ordered:*\n• 1x Fried Rice Fiesta - ₦1,400.00\n\n📍 *Delivery Details:*\n👤 Name: Ziga\n📱 Phone: 2348055614455\n🏠 Address: Howson Wright\n\n💰 *Total Amount: ₦1,400.00*\n\nPlease confirm to proceed with payment.'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'final_confirm', 'title': '✅ Confirm & Pay'}}, {'type': 'reply', 'reply': {'id': 'edit_order', 'title': '✏️ Edit Order'}}, {'type': 'reply', 'reply': {'id': 'cancel_order', 'title': '❌ Cancel Order'}}]}}}
2025-06-19 15:15:38,174 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 400 Client Error: Bad Request for url: https://graph.facebook.com/v17.0/608867502309431/messages - {"error":{"message":"(#100) Invalid parameter","type":"OAuthException","code":100,"error_data":{"messaging_product":"whatsapp","details":"Parameter Invalid"},"fbtrace_id":"AEsSJZz2Ld4am-IKFluSZC-"}}
2025-06-19 15:15:38,174 - handlers.message_processor - WARNING - No specific handler or state match for handler 'order_handler', state 'confirm_details', message 'process_final_order' for session 2348055614455. Resetting to greeting and sending menu.
2025-06-19 15:15:38,175 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "I'm sorry, I didn't quite understand that. Let's get back to the main menu."}}
2025-06-19 15:15:38,905 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjRBMjQ1RjEyQUE2N0Q3MTk4RQA="}]}
2025-06-19 15:15:38,906 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Please choose from the options below:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-19 15:15:39,692 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkU3RDEwQUUyNzlFQUY4NzEzRQA="}]}
2025-06-19 15:15:39,696 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦1,400 (1 items)
2025-06-19 15:15:39,696 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦1,400.00
2025-06-19 15:15:39,696 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkU3RDEwQUUyNzlFQUY4NzEzRQA='}]}
2025-06-19 15:15:39,697 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:15:39] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:15:39,759 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:15:39] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:15:39,774 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:15:39] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:15:39,915 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:15:39] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:15:40,776 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:15:40] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:15:40,992 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:15:40] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:15:41,035 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:15:41] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:17:14,537 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-19 15:17:14,537 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 15:17:14,538 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 15:17:14,538 - services.payment_service - INFO - PaymentService initialized
2025-06-19 15:17:14,539 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 15:17:14,539 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 15:17:14,540 - services.payment_service - INFO - PaymentService initialized
2025-06-19 15:17:14,540 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-19 15:17:14,540 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-19 15:17:14,541 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-19 15:17:14,541 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 15:17:14,541 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-19 15:17:15,087 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-19 15:17:15,088 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-19 15:17:15,088 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking and AI support.
2025-06-19 15:17:15,088 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 15:17:15,103 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-19 15:17:15,103 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-19 15:17:18,953 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-19 15:17:18,954 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-19 15:17:18,961 - handlers.base_handler - INFO - Session 2348055614455 recognized user 'Ziga'.
2025-06-19 15:17:18,962 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Welcome Ziga! 👋🏼\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-19 15:17:19,627 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjg3MDQ5MjQ4Q0UzMTE2Nzk1QgA="}]}
2025-06-19 15:17:19,627 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjg3MDQ5MjQ4Q0UzMTE2Nzk1QgA='}]}
2025-06-19 15:17:19,628 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:17:19] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:17:20,549 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:17:20] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:17:20,844 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:17:20] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:17:20,927 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:17:20] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:17:25,710 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-19 15:17:25,714 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-06-19 15:17:25,714 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-06-19 15:17:25,714 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-06-19 15:17:25,715 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-06-19 15:17:25,715 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Just send me your full order in one message! \n\nLike this: 'Two plates of jollof rice, 2 Cokes, and asun.'\n\nWant to go back again? Type ‘menu’ to return. "}}
2025-06-19 15:17:26,431 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkI5NDU4MEE1MUVCMkM5QUY2QQA="}]}
2025-06-19 15:17:26,432 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkI5NDU4MEE1MUVCMkM5QUY2QQA='}]}
2025-06-19 15:17:26,432 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:17:26] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:17:27,237 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:17:27] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:17:27,513 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:17:27] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:17:27,599 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:17:27] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:17:39,576 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Fried rice'}
2025-06-19 15:17:39,579 - handlers.base_handler - INFO - AIHandler: Handling message 'fried rice' in AI bulk order state for session 2348055614455. Original: 'Fried rice'
2025-06-19 15:17:41,910 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-19 15:17:41,912 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🛒 *Order Summary:*\n\n✅ 1x Fried Rice Fiesta - ₦1,400\n\n*Total: ₦1,400.00*\n\nWould you like to proceed with this order?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'confirm_ai_order', 'title': '✅ Confirm Order'}}, {'type': 'reply', 'reply': {'id': 'modify_ai_order', 'title': '✏️ Modify Order'}}, {'type': 'reply', 'reply': {'id': 'cancel_ai_order', 'title': '❌ Cancel'}}]}}}
2025-06-19 15:17:42,486 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjIzQkYzMkY3MDI1OEQ0QzUzNAA="}]}
2025-06-19 15:17:42,486 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjIzQkYzMkY3MDI1OEQ0QzUzNAA='}]}
2025-06-19 15:17:42,487 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:17:42] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:17:43,503 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:17:43] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:17:43,587 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:17:43] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:17:43,604 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:17:43] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:17:48,317 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-06-19 15:17:48,319 - handlers.base_handler - INFO - AI order confirmed. Cart: {'Fried Rice Fiesta': {'item_id': 'Fried Rice Fiesta', 'quantity': 1, 'price': 1400, 'total_price': 1400, 'variations': {}}}. Redirecting to order handler.
2025-06-19 15:17:48,320 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'order_handler' with message 'process_final_order'.
2025-06-19 15:17:48,320 - handlers.order_handler - INFO - AI initiated order processing for session 2348055614455.
2025-06-19 15:17:48,320 - handlers.order_handler - INFO - Address set, proceeding to confirm order for AI-initiated session 2348055614455.
2025-06-19 15:17:48,320 - handlers.order_handler - INFO - Showing final order confirmation for session 2348055614455. Total: ₦1,400.00
2025-06-19 15:17:48,321 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🛒 *Final Order Confirmation*\n\n📋 *Items Ordered:*\n• 1x Fried Rice Fiesta - ₦1,400.00\n\n📍 *Delivery Details:*\n👤 Name: Ziga\n📱 Phone: 2348055614455\n🏠 Address: Howson Wright\n\n💰 *Total Amount: ₦1,400.00*\n\nPlease confirm to proceed with payment.'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'final_confirm', 'title': '✅ Confirm & Pay'}}, {'type': 'reply', 'reply': {'id': 'edit_order', 'title': '✏️ Edit Order'}}, {'type': 'reply', 'reply': {'id': 'cancel_order', 'title': '❌ Cancel Order'}}]}}}
2025-06-19 15:17:48,948 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjlCNzhERkNFRkQwRUYzNkZBQgA="}]}
2025-06-19 15:17:48,952 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦1,400 (1 items)
2025-06-19 15:17:48,953 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦1,400.00
2025-06-19 15:17:48,953 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjlCNzhERkNFRkQwRUYzNkZBQgA='}]}
2025-06-19 15:17:48,953 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:17:48] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:17:49,851 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:17:49] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:17:50,077 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:17:50] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:17:50,189 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:17:50] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:17:51,469 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'final_confirm'}
2025-06-19 15:17:51,471 - handlers.order_handler - INFO - Order ORDER_20250619_151751_69bb2104 confirmed for session 2348055614455. Amount: ₦1,400.00
2025-06-19 15:17:51,474 - services.lead_tracker - INFO - Order completion tracked for 2348055614455: ORDER_20250619_151751_69bb2104 (₦1,400)
2025-06-19 15:17:51,474 - handlers.lead_tracking_handler - INFO - 💰 Conversion tracked: 2348055614455 - ORDER_20250619_151751_69bb2104 (₦1,400)
2025-06-19 15:17:51,474 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'payment_handler' with message 'initiate_payment'.
2025-06-19 15:17:51,475 - handlers.base_handler - INFO - Handling payment processing for session 2348055614455, message: initiate_payment
2025-06-19 15:17:51,475 - handlers.base_handler - INFO - Creating payment link for session 2348055614455
2025-06-19 15:17:51,491 - utils.data_manager - INFO - Data saved to data\orders.json
2025-06-19 15:17:51,492 - utils.data_manager - INFO - Order details saved to data\orders.json
2025-06-19 15:17:51,492 - services.payment_service - INFO - Attempting to create payment link for reference: PAY-ORDER-20250619151751-9539 with amount: 140000, email: ziga4455@foodorder.com
2025-06-19 15:17:52,188 - services.payment_service - INFO - Payment link created for Ziga Ziga (2348055614455), URL: https://checkout.paystack.com/d34vzf0uucatae5
2025-06-19 15:17:52,188 - handlers.base_handler - INFO - Starting payment monitoring for order ORDER-20250619151751-9539, reference PAY-ORDER-20250619151751-9539
2025-06-19 15:17:52,189 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-ORDER-20250619151751-9539
2025-06-19 15:17:52,784 - services.payment_service - WARNING - Payment not successful for reference PAY-ORDER-20250619151751-9539. Paystack status: abandoned. Response: {'status': True, 'message': 'Verification successful', 'data': {'id': 5071113377, 'domain': 'test', 'status': 'abandoned', 'reference': 'PAY-ORDER-20250619151751-9539', 'receipt_number': None, 'amount': 140000, 'message': None, 'gateway_response': 'The transaction was not completed', 'paid_at': None, 'created_at': '2025-06-19T14:17:52.000Z', 'channel': 'card', 'currency': 'NGN', 'ip_address': '102.89.47.50, 172.71.26.39, 172.31.62.52', 'metadata': {'customer_name': 'Ziga', 'customer_phone': '2348055614455', 'first_name': 'Ziga', 'last_name': 'Ziga', 'order_id': 'ORDER-20250619151751-9539', 'delivery_address': 'Howson Wright'}, 'log': None, 'fees': None, 'fees_split': None, 'authorization': {}, 'customer': {'id': 276711440, 'first_name': None, 'last_name': None, 'email': 'ziga4455@foodorder.com', 'customer_code': 'CUS_bhkdpnbvcjqt55g', 'phone': None, 'metadata': None, 'risk_action': 'default', 'international_format_phone': None}, 'plan': None, 'split': {}, 'order_id': None, 'paidAt': None, 'createdAt': '2025-06-19T14:17:52.000Z', 'requested_amount': 140000, 'pos_transaction_data': None, 'source': None, 'fees_breakdown': None, 'connect': None, 'transaction_date': '2025-06-19T14:17:52.000Z', 'plan_object': {}, 'subaccount': {}}}
2025-06-19 15:17:52,785 - handlers.base_handler - INFO - Payment not yet verified for order ORDER-20250619151751-9539, attempt 1/15
2025-06-19 15:17:52,786 - handlers.base_handler - INFO - Payment link created successfully for order ORDER-20250619151751-9539
2025-06-19 15:17:52,786 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "🛒 *Order Created Successfully!*\n\n📋 *Order ID:* ORDER-20250619151751-9539\n💰 *Total:* ₦1,400\n\n💳 *Complete Payment:*\nhttps://checkout.paystack.com/d34vzf0uucatae5\n\n✅ We'll automatically confirm your order once payment is received!\n💬 You can also send 'paid' after payment to check status immediately.\n\n⏰ Payment link expires in 15 minutes."}}
2025-06-19 15:17:53,492 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQ0ODVCQTFGMDg3NTc3MjgzRAA="}]}
2025-06-19 15:17:53,499 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦1,400 (1 items)
2025-06-19 15:17:53,499 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦1,400.00
2025-06-19 15:17:53,499 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQ0ODVCQTFGMDg3NTc3MjgzRAA='}]}
2025-06-19 15:17:53,500 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:17:53] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:17:54,352 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:17:54] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:17:54,368 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:17:54] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:17:54,600 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:17:54] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:18:06,427 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Paid'}
2025-06-19 15:18:06,429 - handlers.base_handler - INFO - Received 'paid' command for session 2348055614455, attempting manual verification for ref: PAY-ORDER-20250619151751-9539
2025-06-19 15:18:06,429 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-ORDER-20250619151751-9539
2025-06-19 15:18:07,036 - services.payment_service - INFO - Payment verified successfully for reference PAY-ORDER-20250619151751-9539. Status: success
2025-06-19 15:18:07,038 - handlers.base_handler - INFO - Manual payment verification successful for order ORDER-20250619151751-9539
2025-06-19 15:18:07,039 - handlers.base_handler - INFO - Payment monitoring stopped for session 2348055614455
2025-06-19 15:18:07,047 - utils.data_manager - INFO - Data saved to data\orders.json
2025-06-19 15:18:07,048 - utils.data_manager - INFO - Order details saved to data\orders.json
2025-06-19 15:18:07,050 - services.lead_tracker - INFO - Order completion tracked for 2348055614455: ORDER-20250619151751-9539 (₦1,400)
2025-06-19 15:18:07,051 - handlers.lead_tracking_handler - INFO - 💰 Conversion tracked: 2348055614455 - ORDER-20250619151751-9539 (₦1,400)
2025-06-19 15:18:07,051 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "🎉 *Payment Confirmed!*\n\n📋 *Order ID:* ORDER-20250619151751-9539\n💰 *Amount Paid:* ₦1,400\n🛒 *Items:* 🛒 *Your Cart:*\n• 1 x Fried Rice Fiesta (₦1,400) = ₦1,400\n\n💰 *Total: ₦1,400*\n🚚 *Delivery to:* Howson Wright\n\n✅ Your order is confirmed and being processed!\n📱 You'll receive delivery updates soon.\n\n🙏 Thank you for your purchase! 😊"}}
2025-06-19 15:18:07,665 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjcwOTNDOEE4ODhERkNFQkFCQgA="}]}
2025-06-19 15:18:07,666 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'message': 'Payment confirmed and feedback initiated'}
2025-06-19 15:18:07,667 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:18:07] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:18:08,541 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:18:08] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:18:08,916 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:18:08] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:18:08,999 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:18:08] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:22:51,269 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-19 15:22:51,269 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 15:22:51,270 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 15:22:51,270 - services.payment_service - INFO - PaymentService initialized
2025-06-19 15:22:51,270 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 15:22:51,271 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 15:22:51,271 - services.payment_service - INFO - PaymentService initialized
2025-06-19 15:22:51,271 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-19 15:22:51,272 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-19 15:22:51,272 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-19 15:22:51,272 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 15:22:51,273 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-19 15:22:51,694 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-19 15:22:51,694 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-19 15:22:51,694 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-19 15:22:51,695 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI, and Feedback support.
2025-06-19 15:22:51,695 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 15:22:51,711 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-19 15:22:51,712 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-19 15:22:57,264 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-19 15:22:57,264 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-19 15:22:57,268 - handlers.base_handler - INFO - Session 2348055614455 recognized user 'Ziga'.
2025-06-19 15:22:57,269 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Welcome Ziga! 👋🏼\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-19 15:22:57,903 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkNCNDgxNTgzOTY5MzVCODAxOQA="}]}
2025-06-19 15:22:57,903 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkNCNDgxNTgzOTY5MzVCODAxOQA='}]}
2025-06-19 15:22:57,904 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:22:57] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:22:59,061 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:22:59] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:22:59,118 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:22:59] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:22:59,446 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:22:59] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:23:00,206 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-19 15:23:00,208 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-06-19 15:23:00,209 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-06-19 15:23:00,209 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-06-19 15:23:00,210 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-06-19 15:23:00,210 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Just send me your full order in one message! \n\nLike this: 'Two plates of jollof rice, 2 Cokes, and asun.'\n\nWant to go back again? Type ‘menu’ to return. "}}
2025-06-19 15:23:00,826 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQ2MTUyM0IzM0YwMERBN0FFMQA="}]}
2025-06-19 15:23:00,827 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQ2MTUyM0IzM0YwMERBN0FFMQA='}]}
2025-06-19 15:23:00,827 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:23:00] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:23:01,732 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:23:01] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:23:01,867 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:23:01] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:23:02,211 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:23:02] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:23:06,415 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Jellof rice'}
2025-06-19 15:23:06,417 - handlers.base_handler - INFO - AIHandler: Handling message 'jellof rice' in AI bulk order state for session 2348055614455. Original: 'Jellof rice'
2025-06-19 15:23:10,052 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-19 15:23:10,054 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🛒 *Order Summary:*\n\n✅ 1x Smoky Jollof Fiesta - ₦1,500\n\n*Total: ₦1,500.00*\n\nWould you like to proceed with this order?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'confirm_ai_order', 'title': '✅ Confirm Order'}}, {'type': 'reply', 'reply': {'id': 'modify_ai_order', 'title': '✏️ Modify Order'}}, {'type': 'reply', 'reply': {'id': 'cancel_ai_order', 'title': '❌ Cancel'}}]}}}
2025-06-19 15:23:10,651 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjhFQTQ0RUYyRDA1RjVBNkJGMwA="}]}
2025-06-19 15:23:10,651 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjhFQTQ0RUYyRDA1RjVBNkJGMwA='}]}
2025-06-19 15:23:10,652 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:23:10] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:23:11,542 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:23:11] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:23:11,637 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:23:11] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:23:12,067 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:23:12] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:23:13,279 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-06-19 15:23:13,281 - handlers.base_handler - INFO - AI order confirmed. Cart: {'Smoky Jollof Fiesta': {'item_id': 'Smoky Jollof Fiesta', 'quantity': 1, 'price': 1500, 'total_price': 1500, 'variations': {}}}. Redirecting to order handler.
2025-06-19 15:23:13,282 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'order_handler' with message 'process_final_order'.
2025-06-19 15:23:13,282 - handlers.order_handler - INFO - AI initiated order processing for session 2348055614455.
2025-06-19 15:23:13,282 - handlers.order_handler - INFO - Address set, proceeding to confirm order for AI-initiated session 2348055614455.
2025-06-19 15:23:13,283 - handlers.order_handler - INFO - Showing final order confirmation for session 2348055614455. Total: ₦1,500.00
2025-06-19 15:23:13,283 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🛒 *Final Order Confirmation*\n\n📋 *Items Ordered:*\n• 1x Smoky Jollof Fiesta - ₦1,500.00\n\n📍 *Delivery Details:*\n👤 Name: Ziga\n📱 Phone: 2348055614455\n🏠 Address: Howson Wright\n\n💰 *Total Amount: ₦1,500.00*\n\nPlease confirm to proceed with payment.'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'final_confirm', 'title': '✅ Confirm & Pay'}}, {'type': 'reply', 'reply': {'id': 'edit_order', 'title': '✏️ Edit Order'}}, {'type': 'reply', 'reply': {'id': 'cancel_order', 'title': '❌ Cancel Order'}}]}}}
2025-06-19 15:23:14,007 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkY0MzBCNzRFNUY2RTM5MkMwMwA="}]}
2025-06-19 15:23:14,010 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦1,500 (1 items)
2025-06-19 15:23:14,010 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦1,500.00
2025-06-19 15:23:14,010 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkY0MzBCNzRFNUY2RTM5MkMwMwA='}]}
2025-06-19 15:23:14,011 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:23:14] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:23:14,784 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:23:14] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:23:14,913 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:23:14] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:23:15,393 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:23:15] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:23:18,899 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'final_confirm'}
2025-06-19 15:23:18,901 - handlers.order_handler - INFO - Order ORDER_20250619_152318_fdf540ea confirmed for session 2348055614455. Amount: ₦1,500.00
2025-06-19 15:23:18,905 - services.lead_tracker - INFO - Order completion tracked for 2348055614455: ORDER_20250619_152318_fdf540ea (₦1,500)
2025-06-19 15:23:18,905 - handlers.lead_tracking_handler - INFO - 💰 Conversion tracked: 2348055614455 - ORDER_20250619_152318_fdf540ea (₦1,500)
2025-06-19 15:23:18,905 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'payment_handler' with message 'initiate_payment'.
2025-06-19 15:23:18,906 - handlers.base_handler - INFO - Handling payment processing for session 2348055614455, message: initiate_payment
2025-06-19 15:23:18,906 - handlers.base_handler - INFO - Creating payment link for session 2348055614455
2025-06-19 15:23:18,920 - utils.data_manager - INFO - Data saved to data\orders.json
2025-06-19 15:23:18,920 - utils.data_manager - INFO - Order details saved to data\orders.json
2025-06-19 15:23:18,921 - services.payment_service - INFO - Attempting to create payment link for reference: PAY-ORDER-20250619152318-9416 with amount: 150000, email: ziga4455@foodorder.com
2025-06-19 15:23:19,684 - services.payment_service - INFO - Payment link created for Ziga Ziga (2348055614455), URL: https://checkout.paystack.com/v7ywwx0e90w9bi9
2025-06-19 15:23:19,685 - handlers.base_handler - INFO - Starting payment monitoring for order ORDER-20250619152318-9416, reference PAY-ORDER-20250619152318-9416
2025-06-19 15:23:19,685 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-ORDER-20250619152318-9416
2025-06-19 15:23:20,242 - services.payment_service - WARNING - Payment not successful for reference PAY-ORDER-20250619152318-9416. Paystack status: abandoned. Response: {'status': True, 'message': 'Verification successful', 'data': {'id': 5071122474, 'domain': 'test', 'status': 'abandoned', 'reference': 'PAY-ORDER-20250619152318-9416', 'receipt_number': None, 'amount': 150000, 'message': None, 'gateway_response': 'The transaction was not completed', 'paid_at': None, 'created_at': '2025-06-19T14:23:20.000Z', 'channel': 'card', 'currency': 'NGN', 'ip_address': '102.89.47.50, 172.70.162.95, 172.31.63.81', 'metadata': {'customer_name': 'Ziga', 'customer_phone': '2348055614455', 'first_name': 'Ziga', 'last_name': 'Ziga', 'order_id': 'ORDER-20250619152318-9416', 'delivery_address': 'Howson Wright'}, 'log': None, 'fees': None, 'fees_split': None, 'authorization': {}, 'customer': {'id': 276711440, 'first_name': None, 'last_name': None, 'email': 'ziga4455@foodorder.com', 'customer_code': 'CUS_bhkdpnbvcjqt55g', 'phone': None, 'metadata': None, 'risk_action': 'default', 'international_format_phone': None}, 'plan': None, 'split': {}, 'order_id': None, 'paidAt': None, 'createdAt': '2025-06-19T14:23:20.000Z', 'requested_amount': 150000, 'pos_transaction_data': None, 'source': None, 'fees_breakdown': None, 'connect': None, 'transaction_date': '2025-06-19T14:23:20.000Z', 'plan_object': {}, 'subaccount': {}}}
2025-06-19 15:23:20,242 - handlers.base_handler - INFO - Payment not yet verified for order ORDER-20250619152318-9416, attempt 1/15
2025-06-19 15:23:20,243 - handlers.base_handler - INFO - Payment link created successfully for order ORDER-20250619152318-9416
2025-06-19 15:23:20,243 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "🛒 *Order Created Successfully!*\n\n📋 *Order ID:* ORDER-20250619152318-9416\n💰 *Total:* ₦1,500\n\n💳 *Complete Payment:*\nhttps://checkout.paystack.com/v7ywwx0e90w9bi9\n\n✅ We'll automatically confirm your order once payment is received!\n💬 You can also send 'paid' after payment to check status immediately.\n\n⏰ Payment link expires in 15 minutes."}}
2025-06-19 15:23:20,798 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjVCOENGOTA0Q0M0OTY5OTIyMAA="}]}
2025-06-19 15:23:20,801 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦1,500 (1 items)
2025-06-19 15:23:20,802 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦1,500.00
2025-06-19 15:23:20,802 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjVCOENGOTA0Q0M0OTY5OTIyMAA='}]}
2025-06-19 15:23:20,803 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:23:20] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:23:21,607 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:23:21] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:23:21,737 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:23:21] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:23:22,241 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:23:22] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:23:36,036 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Paid'}
2025-06-19 15:23:36,039 - handlers.base_handler - INFO - Received 'paid' command for session 2348055614455, attempting manual verification for ref: PAY-ORDER-20250619152318-9416
2025-06-19 15:23:36,040 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-ORDER-20250619152318-9416
2025-06-19 15:23:36,637 - services.payment_service - INFO - Payment verified successfully for reference PAY-ORDER-20250619152318-9416. Status: success
2025-06-19 15:23:36,639 - handlers.base_handler - INFO - Manual payment verification successful for order ORDER-20250619152318-9416
2025-06-19 15:23:36,639 - handlers.base_handler - INFO - Payment monitoring stopped for session 2348055614455
2025-06-19 15:23:36,647 - utils.data_manager - INFO - Data saved to data\orders.json
2025-06-19 15:23:36,647 - utils.data_manager - INFO - Order details saved to data\orders.json
2025-06-19 15:23:36,651 - services.lead_tracker - INFO - Order completion tracked for 2348055614455: ORDER-20250619152318-9416 (₦1,500)
2025-06-19 15:23:36,651 - handlers.lead_tracking_handler - INFO - 💰 Conversion tracked: 2348055614455 - ORDER-20250619152318-9416 (₦1,500)
2025-06-19 15:23:36,652 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "🎉 *Payment Confirmed!*\n\n📋 *Order ID:* ORDER-20250619152318-9416\n💰 *Amount Paid:* ₦1,500\n🛒 *Items:* 🛒 *Your Cart:*\n• 1 x Smoky Jollof Fiesta (₦1,500) = ₦1,500\n\n💰 *Total: ₦1,500*\n🚚 *Delivery to:* Howson Wright\n\n✅ Your order is confirmed and being processed!\n📱 You'll receive delivery updates soon.\n\n🙏 Thank you for your purchase! 😊"}}
2025-06-19 15:23:37,279 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjNENDk4RkIwMTVFNEUwRDA1NAA="}]}
2025-06-19 15:23:37,280 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'message': 'Payment confirmed and feedback initiated'}
2025-06-19 15:23:37,281 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:23:37] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:23:38,167 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:23:38] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:23:38,388 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:23:38] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:23:38,870 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:23:38] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:24:06,163 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-19 15:24:06,163 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 15:24:06,163 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 15:24:06,164 - services.payment_service - INFO - PaymentService initialized
2025-06-19 15:24:06,164 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 15:24:06,164 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 15:24:06,165 - services.payment_service - INFO - PaymentService initialized
2025-06-19 15:24:06,165 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-19 15:24:06,165 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-19 15:24:06,166 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-19 15:24:06,166 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-19 15:24:06,166 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 15:24:06,167 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-19 15:24:06,598 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-19 15:24:06,598 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-19 15:24:06,599 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-06-19 15:24:06,599 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 15:24:06,611 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-19 15:24:06,611 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-19 15:24:09,810 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-19 15:24:09,810 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-19 15:24:09,814 - handlers.base_handler - INFO - Session 2348055614455 recognized user 'Ziga'.
2025-06-19 15:24:09,815 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Welcome Ziga! 👋🏼\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-19 15:24:10,404 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjYwQ0JCOTc0QTBCMzE3ODE2MAA="}]}
2025-06-19 15:24:10,404 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjYwQ0JCOTc0QTBCMzE3ODE2MAA='}]}
2025-06-19 15:24:10,405 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:24:10] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:24:11,263 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:24:11] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:24:11,512 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:24:11] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:24:11,828 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:24:11] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:24:12,805 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-19 15:24:12,808 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-06-19 15:24:12,808 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-06-19 15:24:12,809 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-06-19 15:24:12,809 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-06-19 15:24:12,810 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Just send me your full order in one message! \n\nLike this: 'Two plates of jollof rice, 2 Cokes, and asun.'\n\nWant to go back again? Type ‘menu’ to return. "}}
2025-06-19 15:24:13,342 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjREMTM5NDFGQkY5QzVDNDc3NgA="}]}
2025-06-19 15:24:13,343 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjREMTM5NDFGQkY5QzVDNDc3NgA='}]}
2025-06-19 15:24:13,344 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:24:13] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:24:14,233 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:24:14] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:24:14,440 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:24:14] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:24:14,927 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:24:14] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:24:19,332 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Puff puff'}
2025-06-19 15:24:19,334 - handlers.base_handler - INFO - AIHandler: Handling message 'puff puff' in AI bulk order state for session 2348055614455. Original: 'Puff puff'
2025-06-19 15:24:21,799 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-19 15:24:21,801 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🛒 *Order Summary:*\n\n✅ 1x Puff Puff - ₦200\n\n*Total: ₦200.00*\n\nWould you like to proceed with this order?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'confirm_ai_order', 'title': '✅ Confirm Order'}}, {'type': 'reply', 'reply': {'id': 'modify_ai_order', 'title': '✏️ Modify Order'}}, {'type': 'reply', 'reply': {'id': 'cancel_ai_order', 'title': '❌ Cancel'}}]}}}
2025-06-19 15:24:22,573 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjYyMTFCRjNEQzVFN0ZENjk3RAA="}]}
2025-06-19 15:24:22,573 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjYyMTFCRjNEQzVFN0ZENjk3RAA='}]}
2025-06-19 15:24:22,574 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:24:22] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:24:23,432 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:24:23] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:24:23,469 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:24:23] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:24:24,227 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:24:24] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:24:25,491 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-06-19 15:24:25,493 - handlers.base_handler - INFO - AI order confirmed. Cart: {'Puff Puff': {'item_id': 'Puff Puff', 'quantity': 1, 'price': 200, 'total_price': 200, 'variations': {}}}. Redirecting to order handler.
2025-06-19 15:24:25,494 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'order_handler' with message 'process_final_order'.
2025-06-19 15:24:25,494 - handlers.order_handler - INFO - AI initiated order processing for session 2348055614455.
2025-06-19 15:24:25,495 - handlers.order_handler - INFO - Address set, proceeding to confirm order for AI-initiated session 2348055614455.
2025-06-19 15:24:25,495 - handlers.order_handler - INFO - Showing final order confirmation for session 2348055614455. Total: ₦200.00
2025-06-19 15:24:25,495 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🛒 *Final Order Confirmation*\n\n📋 *Items Ordered:*\n• 1x Puff Puff - ₦200.00\n\n📍 *Delivery Details:*\n👤 Name: Ziga\n📱 Phone: 2348055614455\n🏠 Address: Howson Wright\n\n💰 *Total Amount: ₦200.00*\n\nPlease confirm to proceed with payment.'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'final_confirm', 'title': '✅ Confirm & Pay'}}, {'type': 'reply', 'reply': {'id': 'edit_order', 'title': '✏️ Edit Order'}}, {'type': 'reply', 'reply': {'id': 'cancel_order', 'title': '❌ Cancel Order'}}]}}}
2025-06-19 15:24:26,071 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjNEQjVCQTkwNTQ3QzQzQTMxNgA="}]}
2025-06-19 15:24:26,075 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦200 (1 items)
2025-06-19 15:24:26,076 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦200.00
2025-06-19 15:24:26,076 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjNEQjVCQTkwNTQ3QzQzQTMxNgA='}]}
2025-06-19 15:24:26,076 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:24:26] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:24:26,791 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:24:26] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:24:26,904 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:24:26] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:24:27,344 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:24:27] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:24:28,492 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'final_confirm'}
2025-06-19 15:24:28,495 - handlers.order_handler - INFO - Order ORDER_20250619_152428_b834a8bd confirmed for session 2348055614455. Amount: ₦200.00
2025-06-19 15:24:28,499 - services.lead_tracker - INFO - Order completion tracked for 2348055614455: ORDER_20250619_152428_b834a8bd (₦200)
2025-06-19 15:24:28,499 - handlers.lead_tracking_handler - INFO - 💰 Conversion tracked: 2348055614455 - ORDER_20250619_152428_b834a8bd (₦200)
2025-06-19 15:24:28,500 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'payment_handler' with message 'initiate_payment'.
2025-06-19 15:24:28,500 - handlers.base_handler - INFO - Handling payment processing for session 2348055614455, message: initiate_payment
2025-06-19 15:24:28,500 - handlers.base_handler - INFO - Creating payment link for session 2348055614455
2025-06-19 15:24:28,512 - utils.data_manager - INFO - Data saved to data\orders.json
2025-06-19 15:24:28,512 - utils.data_manager - INFO - Order details saved to data\orders.json
2025-06-19 15:24:28,512 - services.payment_service - INFO - Attempting to create payment link for reference: PAY-ORDER-20250619152428-1353 with amount: 20000, email: ziga4455@foodorder.com
2025-06-19 15:24:29,171 - services.payment_service - INFO - Payment link created for Ziga Ziga (2348055614455), URL: https://checkout.paystack.com/3hn9v6g370i9qjj
2025-06-19 15:24:29,172 - handlers.base_handler - INFO - Starting payment monitoring for order ORDER-20250619152428-1353, reference PAY-ORDER-20250619152428-1353
2025-06-19 15:24:29,172 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-ORDER-20250619152428-1353
2025-06-19 15:24:29,985 - services.payment_service - WARNING - Payment not successful for reference PAY-ORDER-20250619152428-1353. Paystack status: abandoned. Response: {'status': True, 'message': 'Verification successful', 'data': {'id': 5071124420, 'domain': 'test', 'status': 'abandoned', 'reference': 'PAY-ORDER-20250619152428-1353', 'receipt_number': None, 'amount': 20000, 'message': None, 'gateway_response': 'The transaction was not completed', 'paid_at': None, 'created_at': '2025-06-19T14:24:29.000Z', 'channel': 'card', 'currency': 'NGN', 'ip_address': '102.89.47.50, 141.101.98.64, 172.31.63.81', 'metadata': {'customer_name': 'Ziga', 'customer_phone': '2348055614455', 'first_name': 'Ziga', 'last_name': 'Ziga', 'order_id': 'ORDER-20250619152428-1353', 'delivery_address': 'Howson Wright'}, 'log': None, 'fees': None, 'fees_split': None, 'authorization': {}, 'customer': {'id': 276711440, 'first_name': None, 'last_name': None, 'email': 'ziga4455@foodorder.com', 'customer_code': 'CUS_bhkdpnbvcjqt55g', 'phone': None, 'metadata': None, 'risk_action': 'default', 'international_format_phone': None}, 'plan': None, 'split': {}, 'order_id': None, 'paidAt': None, 'createdAt': '2025-06-19T14:24:29.000Z', 'requested_amount': 20000, 'pos_transaction_data': None, 'source': None, 'fees_breakdown': None, 'connect': None, 'transaction_date': '2025-06-19T14:24:29.000Z', 'plan_object': {}, 'subaccount': {}}}
2025-06-19 15:24:29,986 - handlers.base_handler - INFO - Payment not yet verified for order ORDER-20250619152428-1353, attempt 1/15
2025-06-19 15:24:29,987 - handlers.base_handler - INFO - Payment link created successfully for order ORDER-20250619152428-1353
2025-06-19 15:24:29,988 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "🛒 *Order Created Successfully!*\n\n📋 *Order ID:* ORDER-20250619152428-1353\n💰 *Total:* ₦200\n\n💳 *Complete Payment:*\nhttps://checkout.paystack.com/3hn9v6g370i9qjj\n\n✅ We'll automatically confirm your order once payment is received!\n💬 You can also send 'paid' after payment to check status immediately.\n\n⏰ Payment link expires in 15 minutes."}}
2025-06-19 15:24:30,526 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkI3M0VFMjQyODlCMjBCRDAxRAA="}]}
2025-06-19 15:24:30,530 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦200 (1 items)
2025-06-19 15:24:30,530 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦200.00
2025-06-19 15:24:30,530 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkI3M0VFMjQyODlCMjBCRDAxRAA='}]}
2025-06-19 15:24:30,531 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:24:30] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:24:31,375 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:24:31] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:24:31,618 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:24:31] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:24:31,863 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:24:31] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:24:44,099 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Paid'}
2025-06-19 15:24:44,102 - handlers.base_handler - INFO - Received 'paid' command for session 2348055614455, attempting manual verification for ref: PAY-ORDER-20250619152428-1353
2025-06-19 15:24:44,103 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-ORDER-20250619152428-1353
2025-06-19 15:24:44,669 - services.payment_service - INFO - Payment verified successfully for reference PAY-ORDER-20250619152428-1353. Status: success
2025-06-19 15:24:44,672 - handlers.base_handler - INFO - Manual payment verification successful for order ORDER-20250619152428-1353
2025-06-19 15:24:44,672 - handlers.base_handler - INFO - Payment monitoring stopped for session 2348055614455
2025-06-19 15:24:44,682 - utils.data_manager - INFO - Data saved to data\orders.json
2025-06-19 15:24:44,683 - utils.data_manager - INFO - Order details saved to data\orders.json
2025-06-19 15:24:44,686 - services.lead_tracker - INFO - Order completion tracked for 2348055614455: ORDER-20250619152428-1353 (₦200)
2025-06-19 15:24:44,686 - handlers.lead_tracking_handler - INFO - 💰 Conversion tracked: 2348055614455 - ORDER-20250619152428-1353 (₦200)
2025-06-19 15:24:44,686 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "🎉 *Payment Confirmed!*\n\n📋 *Order ID:* ORDER-20250619152428-1353\n💰 *Amount Paid:* ₦200\n🛒 *Items:* 🛒 *Your Cart:*\n• 1 x Puff Puff (₦200) = ₦200\n\n💰 *Total: ₦200*\n🚚 *Delivery to:* Howson Wright\n\n✅ Your order is confirmed and being processed!\n📱 You'll receive delivery updates soon.\n\n🙏 Thank you for your purchase! 😊"}}
2025-06-19 15:24:45,207 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjI2N0VCNTQwRjk2RTczMUFDMwA="}]}
2025-06-19 15:24:45,207 - handlers.feedback_handler - INFO - Initiated feedback collection for order ORDER-20250619152428-1353, session 2348055614455
2025-06-19 15:24:45,208 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🎉 *Thank you for your order!*\n\n📋 Order ID: ORDER-20250619152428-1353\n\n💬 *How was your ordering experience?*\nYour feedback helps us improve our service!'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'excellent', 'title': '🤩 Excellent'}}, {'type': 'reply', 'reply': {'id': 'good', 'title': '😊 Good'}}, {'type': 'reply', 'reply': {'id': 'bad', 'title': '😞 Bad'}}]}}}
2025-06-19 15:24:45,889 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjFDRTU5RDBEMjI3MTFDNjE3QgA="}]}
2025-06-19 15:24:45,889 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'message': 'Payment confirmed and feedback initiated'}
2025-06-19 15:24:45,890 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:24:45] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:24:45,978 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:24:45] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:24:46,107 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:24:46] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:24:46,650 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:24:46] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:24:46,706 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:24:46] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:24:46,880 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:24:46] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:24:47,399 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:24:47] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:24:48,711 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'good'}
2025-06-19 15:24:48,714 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "👍 *Thank you for the good rating!*\n\n💬 Would you like to share any specific comments about your experience?\n\nType your message or 'skip' to finish."}}
2025-06-19 15:24:49,359 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjlCQTZBRjg3QjAyNURBOTExNAA="}]}
2025-06-19 15:24:49,360 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjlCQTZBRjg3QjAyNURBOTExNAA='}]}
2025-06-19 15:24:49,360 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:24:49] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:24:50,129 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:24:50] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:24:50,150 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:24:50] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:24:50,663 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:24:50] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:24:53,202 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Skip'}
2025-06-19 15:24:53,207 - handlers.feedback_handler - INFO - Feedback saved to data/feedback.json
2025-06-19 15:24:53,207 - handlers.feedback_handler - INFO - Feedback saved for order ORDER-20250619152428-1353: good
2025-06-19 15:24:53,207 - utils.session_manager - INFO - Full session 2348055614455 cleared.
2025-06-19 15:24:53,208 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': '🙏 *Thank you for your Good feedback!*\n\n'}}
2025-06-19 15:24:53,829 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkJEQTU4ODA5MkEyNjAyMkNFQwA="}]}
2025-06-19 15:24:53,830 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkJEQTU4ODA5MkEyNjAyMkNFQwA='}]}
2025-06-19 15:24:53,830 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:24:53] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:24:54,572 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:24:54] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:24:54,734 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:24:54] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:24:55,167 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:24:55] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:28:11,527 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-19 15:28:11,528 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 15:28:11,528 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 15:28:11,528 - services.payment_service - INFO - PaymentService initialized
2025-06-19 15:28:11,529 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 15:28:11,529 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 15:28:11,529 - services.payment_service - INFO - PaymentService initialized
2025-06-19 15:28:11,530 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-19 15:28:11,530 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-19 15:28:11,530 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-19 15:28:11,531 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-19 15:28:11,531 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 15:28:11,531 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-19 15:28:11,912 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-19 15:28:11,913 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-19 15:28:11,913 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-06-19 15:28:11,913 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 15:28:11,927 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-19 15:28:11,927 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-19 15:28:17,609 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-19 15:28:17,610 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-19 15:28:17,615 - handlers.base_handler - INFO - Session 2348055614455 recognized user 'Ziga'.
2025-06-19 15:28:17,615 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Welcome Ziga! 👋🏼\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-19 15:28:18,397 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjA0NEIwNzlFQ0VCQUE1QzM0RgA="}]}
2025-06-19 15:28:18,398 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjA0NEIwNzlFQ0VCQUE1QzM0RgA='}]}
2025-06-19 15:28:18,398 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:28:18] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:28:19,256 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:28:19] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:28:19,306 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:28:19] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:28:19,872 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:28:19] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:28:20,689 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-19 15:28:20,692 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-06-19 15:28:20,693 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-06-19 15:28:20,693 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-06-19 15:28:20,694 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-06-19 15:28:20,694 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Just send me your full order in one message! \n\nLike this: 'Two plates of jollof rice, 2 Cokes, and asun.'\n\nWant to go back again? Type ‘menu’ to return. "}}
2025-06-19 15:28:21,325 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjAzMjZDRTBEM0RFMzNERjk1QwA="}]}
2025-06-19 15:28:21,326 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjAzMjZDRTBEM0RFMzNERjk1QwA='}]}
2025-06-19 15:28:21,326 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:28:21] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:28:22,204 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:28:22] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:28:22,347 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:28:22] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:28:22,885 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:28:22] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:28:27,154 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Jellof rice'}
2025-06-19 15:28:27,157 - handlers.base_handler - INFO - AIHandler: Handling message 'jellof rice' in AI bulk order state for session 2348055614455. Original: 'Jellof rice'
2025-06-19 15:28:29,395 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-19 15:28:29,397 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🛒 *Order Summary:*\n\n✅ 1x Smoky Jollof Fiesta - ₦1,500\n\n*Total: ₦1,500.00*\n\nWould you like to proceed with this order?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'confirm_ai_order', 'title': '✅ Confirm Order'}}, {'type': 'reply', 'reply': {'id': 'modify_ai_order', 'title': '✏️ Modify Order'}}, {'type': 'reply', 'reply': {'id': 'cancel_ai_order', 'title': '❌ Cancel'}}]}}}
2025-06-19 15:28:30,039 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkQyQkI2QzcwN0Q1MzhCQTIwRgA="}]}
2025-06-19 15:28:30,040 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkQyQkI2QzcwN0Q1MzhCQTIwRgA='}]}
2025-06-19 15:28:30,040 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:28:30] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:28:30,911 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:28:30] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:28:31,042 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:28:31] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:28:31,337 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:28:31] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:28:32,536 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-06-19 15:28:32,547 - handlers.base_handler - INFO - AI order confirmed. Cart: {'Smoky Jollof Fiesta': {'item_id': 'Smoky Jollof Fiesta', 'quantity': 1, 'price': 1500, 'total_price': 1500, 'variations': {}}}. Redirecting to order handler.
2025-06-19 15:28:32,548 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'order_handler' with message 'process_final_order'.
2025-06-19 15:28:32,549 - handlers.order_handler - INFO - AI initiated order processing for session 2348055614455.
2025-06-19 15:28:32,549 - handlers.order_handler - INFO - Address set, proceeding to confirm order for AI-initiated session 2348055614455.
2025-06-19 15:28:32,550 - handlers.order_handler - INFO - Showing final order confirmation for session 2348055614455. Total: ₦1,500.00
2025-06-19 15:28:32,550 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🛒 *Final Order Confirmation*\n\n📋 *Items Ordered:*\n• 1x Smoky Jollof Fiesta - ₦1,500.00\n\n📍 *Delivery Details:*\n👤 Name: Ziga\n📱 Phone: 2348055614455\n🏠 Address: Howson Wright\n\n💰 *Total Amount: ₦1,500.00*\n\nPlease confirm to proceed with payment.'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'final_confirm', 'title': '✅ Confirm & Pay'}}, {'type': 'reply', 'reply': {'id': 'edit_order', 'title': '✏️ Edit Order'}}, {'type': 'reply', 'reply': {'id': 'cancel_order', 'title': '❌ Cancel Order'}}]}}}
2025-06-19 15:28:33,194 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjRDMjIyMDUxN0RDQkQ1NUQ2MAA="}]}
2025-06-19 15:28:33,198 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦1,500 (1 items)
2025-06-19 15:28:33,198 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦1,500.00
2025-06-19 15:28:33,199 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjRDMjIyMDUxN0RDQkQ1NUQ2MAA='}]}
2025-06-19 15:28:33,199 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:28:33] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:28:34,113 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:28:34] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:28:34,217 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:28:34] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:28:34,457 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:28:34] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:28:37,954 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'final_confirm'}
2025-06-19 15:28:37,959 - handlers.order_handler - INFO - Order ORDER_20250619_152837_1f5b98a9 confirmed for session 2348055614455. Amount: ₦1,500.00
2025-06-19 15:28:37,966 - services.lead_tracker - INFO - Order completion tracked for 2348055614455: ORDER_20250619_152837_1f5b98a9 (₦1,500)
2025-06-19 15:28:37,967 - handlers.lead_tracking_handler - INFO - 💰 Conversion tracked: 2348055614455 - ORDER_20250619_152837_1f5b98a9 (₦1,500)
2025-06-19 15:28:37,967 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'payment_handler' with message 'initiate_payment'.
2025-06-19 15:28:37,968 - handlers.base_handler - INFO - Handling payment processing for session 2348055614455, message: initiate_payment
2025-06-19 15:28:37,968 - handlers.base_handler - INFO - Creating payment link for session 2348055614455
2025-06-19 15:28:37,988 - utils.data_manager - INFO - Data saved to data\orders.json
2025-06-19 15:28:37,989 - utils.data_manager - INFO - Order details saved to data\orders.json
2025-06-19 15:28:37,990 - services.payment_service - INFO - Attempting to create payment link for reference: PAY-ORDER-20250619152837-1886 with amount: 150000, email: ziga4455@foodorder.com
2025-06-19 15:28:38,678 - services.payment_service - INFO - Payment link created for Ziga Ziga (2348055614455), URL: https://checkout.paystack.com/bb21aj352v2erzc
2025-06-19 15:28:38,679 - handlers.base_handler - INFO - Starting payment monitoring for order ORDER-20250619152837-1886, reference PAY-ORDER-20250619152837-1886
2025-06-19 15:28:38,680 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-ORDER-20250619152837-1886
2025-06-19 15:28:39,337 - services.payment_service - WARNING - Payment not successful for reference PAY-ORDER-20250619152837-1886. Paystack status: abandoned. Response: {'status': True, 'message': 'Verification successful', 'data': {'id': 5071131064, 'domain': 'test', 'status': 'abandoned', 'reference': 'PAY-ORDER-20250619152837-1886', 'receipt_number': None, 'amount': 150000, 'message': None, 'gateway_response': 'The transaction was not completed', 'paid_at': None, 'created_at': '2025-06-19T14:28:39.000Z', 'channel': 'card', 'currency': 'NGN', 'ip_address': '102.89.47.50, 172.69.224.191, 172.31.62.52', 'metadata': {'customer_name': 'Ziga', 'customer_phone': '2348055614455', 'first_name': 'Ziga', 'last_name': 'Ziga', 'order_id': 'ORDER-20250619152837-1886', 'delivery_address': 'Howson Wright'}, 'log': None, 'fees': None, 'fees_split': None, 'authorization': {}, 'customer': {'id': 276711440, 'first_name': None, 'last_name': None, 'email': 'ziga4455@foodorder.com', 'customer_code': 'CUS_bhkdpnbvcjqt55g', 'phone': None, 'metadata': None, 'risk_action': 'default', 'international_format_phone': None}, 'plan': None, 'split': {}, 'order_id': None, 'paidAt': None, 'createdAt': '2025-06-19T14:28:39.000Z', 'requested_amount': 150000, 'pos_transaction_data': None, 'source': None, 'fees_breakdown': None, 'connect': None, 'transaction_date': '2025-06-19T14:28:39.000Z', 'plan_object': {}, 'subaccount': {}}}
2025-06-19 15:28:39,340 - handlers.base_handler - INFO - Payment not yet verified for order ORDER-20250619152837-1886, attempt 1/15
2025-06-19 15:28:39,341 - handlers.base_handler - INFO - Payment link created successfully for order ORDER-20250619152837-1886
2025-06-19 15:28:39,341 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "🛒 **Order Created Successfully!**\n\n📋 **Order ID:** ORDER-20250619152837-1886\n💰 **Total:** ₦1,500\n\n💳 **Complete Payment:**\nhttps://checkout.paystack.com/bb21aj352v2erzc\n\n✅ We'll automatically confirm your order once payment is received!\n💬 You can also send 'paid' after payment to check status immediately.\n\n⏰ Payment link expires in 15 minutes."}}
2025-06-19 15:28:39,975 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjg3OTE5RDhCMTlEQTdDMTY4QwA="}]}
2025-06-19 15:28:39,979 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦1,500 (1 items)
2025-06-19 15:28:39,979 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦1,500.00
2025-06-19 15:28:39,980 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjg3OTE5RDhCMTlEQTdDMTY4QwA='}]}
2025-06-19 15:28:39,980 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:28:39] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:28:40,813 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:28:40] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:28:40,868 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:28:40] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:28:41,248 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:28:41] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:29:39,343 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-ORDER-20250619152837-1886
2025-06-19 15:29:39,920 - services.payment_service - INFO - Payment verified successfully for reference PAY-ORDER-20250619152837-1886. Status: success
2025-06-19 15:29:39,921 - handlers.base_handler - INFO - Payment verified for order ORDER-20250619152837-1886 on attempt 2
2025-06-19 15:29:39,921 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-ORDER-20250619152837-1886
2025-06-19 15:29:40,484 - services.payment_service - INFO - Payment verified successfully for reference PAY-ORDER-20250619152837-1886. Status: success
2025-06-19 15:29:40,495 - utils.data_manager - INFO - Data saved to data\orders.json
2025-06-19 15:29:40,495 - utils.data_manager - INFO - Order details saved to data\orders.json
2025-06-19 15:29:40,500 - services.lead_tracker - INFO - Order completion tracked for 2348055614455: ORDER-20250619152837-1886 (₦1,500)
2025-06-19 15:29:40,500 - handlers.lead_tracking_handler - INFO - 💰 Conversion tracked: 2348055614455 - ORDER-20250619152837-1886 (₦1,500)
2025-06-19 15:29:40,500 - handlers.base_handler - ERROR - Error handling successful auto payment for order ORDER-20250619152837-1886: 'Config' object has no attribute 'get'
2025-06-19 15:36:08,448 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-19 15:36:08,448 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 15:36:08,449 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 15:36:08,449 - services.payment_service - INFO - PaymentService initialized
2025-06-19 15:36:08,449 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 15:36:08,450 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 15:36:08,450 - services.payment_service - INFO - PaymentService initialized
2025-06-19 15:36:08,451 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-19 15:36:08,451 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-19 15:36:08,452 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-19 15:36:08,452 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-19 15:36:08,452 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 15:36:08,452 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-19 15:36:08,943 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-19 15:36:08,944 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-19 15:36:08,944 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-06-19 15:36:08,944 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 15:36:08,960 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-19 15:36:08,960 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-19 15:36:14,873 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-19 15:36:14,873 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-19 15:36:14,878 - handlers.base_handler - INFO - Session 2348055614455 recognized user 'Ziga'.
2025-06-19 15:36:14,879 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Welcome Ziga! 👋🏼\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-19 15:36:15,673 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkFFRThCNTYzRTVERjhGNzc1NAA="}]}
2025-06-19 15:36:15,674 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkFFRThCNTYzRTVERjhGNzc1NAA='}]}
2025-06-19 15:36:15,674 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:36:15] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:36:16,598 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:36:16] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:36:16,882 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:36:16] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:36:17,361 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:36:17] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:36:18,057 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-19 15:36:18,059 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-06-19 15:36:18,060 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-06-19 15:36:18,060 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-06-19 15:36:18,060 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-06-19 15:36:18,061 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Just send me your full order in one message! \n\nLike this: 'Two plates of jollof rice, 2 Cokes, and asun.'\n\nWant to go back again? Type ‘menu’ to return. "}}
2025-06-19 15:36:18,696 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjZCMkIyRjNFODMxNDFGRURBRAA="}]}
2025-06-19 15:36:18,697 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjZCMkIyRjNFODMxNDFGRURBRAA='}]}
2025-06-19 15:36:18,697 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:36:18] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:36:19,572 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:36:19] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:36:19,746 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:36:19] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:36:20,034 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:36:20] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:36:23,302 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Fried rice'}
2025-06-19 15:36:23,306 - handlers.base_handler - INFO - AIHandler: Handling message 'fried rice' in AI bulk order state for session 2348055614455. Original: 'Fried rice'
2025-06-19 15:36:25,788 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-19 15:36:25,791 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🛒 *Order Summary:*\n\n✅ 1x Fried Rice Fiesta - ₦1,400\n\n*Total: ₦1,400.00*\n\nWould you like to proceed with this order?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'confirm_ai_order', 'title': '✅ Confirm Order'}}, {'type': 'reply', 'reply': {'id': 'modify_ai_order', 'title': '✏️ Modify Order'}}, {'type': 'reply', 'reply': {'id': 'cancel_ai_order', 'title': '❌ Cancel'}}]}}}
2025-06-19 15:36:26,371 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkZCODEwRkI2OEU1MjE2QzQ0MwA="}]}
2025-06-19 15:36:26,372 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkZCODEwRkI2OEU1MjE2QzQ0MwA='}]}
2025-06-19 15:36:26,372 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:36:26] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:36:27,349 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:36:27] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:36:27,427 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:36:27] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:36:27,703 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:36:27] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:36:28,828 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-06-19 15:36:28,831 - handlers.base_handler - INFO - AI order confirmed. Cart: {'Fried Rice Fiesta': {'item_id': 'Fried Rice Fiesta', 'quantity': 1, 'price': 1400, 'total_price': 1400, 'variations': {}}}. Redirecting to order handler.
2025-06-19 15:36:28,832 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'order_handler' with message 'process_final_order'.
2025-06-19 15:36:28,832 - handlers.order_handler - INFO - AI initiated order processing for session 2348055614455.
2025-06-19 15:36:28,833 - handlers.order_handler - INFO - Address set, proceeding to confirm order for AI-initiated session 2348055614455.
2025-06-19 15:36:28,834 - handlers.order_handler - INFO - Showing final order confirmation for session 2348055614455. Total: ₦1,400.00
2025-06-19 15:36:28,834 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🛒 *Final Order Confirmation*\n\n📋 *Items Ordered:*\n• 1x Fried Rice Fiesta - ₦1,400.00\n\n📍 *Delivery Details:*\n👤 Name: Ziga\n📱 Phone: 2348055614455\n🏠 Address: Howson Wright\n\n💰 *Total Amount: ₦1,400.00*\n\nPlease confirm to proceed with payment.'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'final_confirm', 'title': '✅ Confirm & Pay'}}, {'type': 'reply', 'reply': {'id': 'edit_order', 'title': '✏️ Edit Order'}}, {'type': 'reply', 'reply': {'id': 'cancel_order', 'title': '❌ Cancel Order'}}]}}}
2025-06-19 15:36:29,472 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjI5NzVFMTgzODlENzdFRTA2OAA="}]}
2025-06-19 15:36:29,477 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦1,400 (1 items)
2025-06-19 15:36:29,477 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦1,400.00
2025-06-19 15:36:29,478 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjI5NzVFMTgzODlENzdFRTA2OAA='}]}
2025-06-19 15:36:29,478 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:36:29] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:36:30,333 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:36:30] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:36:30,467 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:36:30] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:36:30,734 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:36:30] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:36:31,825 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'final_confirm'}
2025-06-19 15:36:31,827 - handlers.order_handler - INFO - Order ORDER_20250619_153631_d1455fa5 confirmed for session 2348055614455. Amount: ₦1,400.00
2025-06-19 15:36:31,832 - services.lead_tracker - INFO - Order completion tracked for 2348055614455: ORDER_20250619_153631_d1455fa5 (₦1,400)
2025-06-19 15:36:31,833 - handlers.lead_tracking_handler - INFO - 💰 Conversion tracked: 2348055614455 - ORDER_20250619_153631_d1455fa5 (₦1,400)
2025-06-19 15:36:31,833 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'payment_handler' with message 'initiate_payment'.
2025-06-19 15:36:31,833 - handlers.base_handler - INFO - Handling payment processing for session 2348055614455, message: initiate_payment
2025-06-19 15:36:31,834 - handlers.base_handler - INFO - Creating payment link for session 2348055614455
2025-06-19 15:36:31,851 - utils.data_manager - INFO - Data saved to data\orders.json
2025-06-19 15:36:31,852 - utils.data_manager - INFO - Order details saved to data\orders.json
2025-06-19 15:36:31,852 - services.payment_service - INFO - Attempting to create payment link for reference: PAY-ORDER-20250619153631-4751 with amount: 140000, email: ziga4455@foodorder.com
2025-06-19 15:36:32,528 - services.payment_service - INFO - Payment link created for Ziga Ziga (2348055614455), URL: https://checkout.paystack.com/jn1yhin4mlrpyzb
2025-06-19 15:36:32,529 - handlers.base_handler - INFO - Starting payment monitoring for order ORDER-20250619153631-4751, reference PAY-ORDER-20250619153631-4751
2025-06-19 15:36:32,529 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-ORDER-20250619153631-4751
2025-06-19 15:36:33,657 - services.payment_service - WARNING - Payment not successful for reference PAY-ORDER-20250619153631-4751. Paystack status: abandoned. Response: {'status': True, 'message': 'Verification successful', 'data': {'id': 5071144901, 'domain': 'test', 'status': 'abandoned', 'reference': 'PAY-ORDER-20250619153631-4751', 'receipt_number': None, 'amount': 140000, 'message': None, 'gateway_response': 'The transaction was not completed', 'paid_at': None, 'created_at': '2025-06-19T14:36:32.000Z', 'channel': 'card', 'currency': 'NGN', 'ip_address': '102.89.47.50, 172.68.186.151, 172.31.68.120', 'metadata': {'customer_name': 'Ziga', 'customer_phone': '2348055614455', 'first_name': 'Ziga', 'last_name': 'Ziga', 'order_id': 'ORDER-20250619153631-4751', 'delivery_address': 'Howson Wright'}, 'log': None, 'fees': None, 'fees_split': None, 'authorization': {}, 'customer': {'id': 276711440, 'first_name': None, 'last_name': None, 'email': 'ziga4455@foodorder.com', 'customer_code': 'CUS_bhkdpnbvcjqt55g', 'phone': None, 'metadata': None, 'risk_action': 'default', 'international_format_phone': None}, 'plan': None, 'split': {}, 'order_id': None, 'paidAt': None, 'createdAt': '2025-06-19T14:36:32.000Z', 'requested_amount': 140000, 'pos_transaction_data': None, 'source': None, 'fees_breakdown': None, 'connect': None, 'transaction_date': '2025-06-19T14:36:32.000Z', 'plan_object': {}, 'subaccount': {}}}
2025-06-19 15:36:33,658 - handlers.base_handler - INFO - Payment not yet verified for order ORDER-20250619153631-4751, attempt 1/15
2025-06-19 15:36:33,659 - handlers.base_handler - INFO - Payment link created successfully for order ORDER-20250619153631-4751
2025-06-19 15:36:33,659 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "🛒 **Order Created Successfully!**\n\n📋 **Order ID:** ORDER-20250619153631-4751\n💰 **Total:** ₦1,400\n\n💳 **Complete Payment:**\nhttps://checkout.paystack.com/jn1yhin4mlrpyzb\n\n✅ We'll automatically confirm your order once payment is received!\n💬 You can also send 'paid' after payment to check status immediately.\n\n⏰ Payment link expires in 15 minutes."}}
2025-06-19 15:36:34,316 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkVDQTM5OEQzOTU1MkFFMEFDRQA="}]}
2025-06-19 15:36:34,320 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦1,400 (1 items)
2025-06-19 15:36:34,320 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦1,400.00
2025-06-19 15:36:34,320 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkVDQTM5OEQzOTU1MkFFMEFDRQA='}]}
2025-06-19 15:36:34,321 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:36:34] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:36:35,264 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:36:35] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:36:35,325 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:36:35] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:36:35,610 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:36:35] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:37:33,672 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-ORDER-20250619153631-4751
2025-06-19 15:37:34,339 - services.payment_service - INFO - Payment verified successfully for reference PAY-ORDER-20250619153631-4751. Status: success
2025-06-19 15:37:34,340 - handlers.base_handler - INFO - Payment verified for order ORDER-20250619153631-4751 on attempt 2
2025-06-19 15:37:34,340 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-ORDER-20250619153631-4751
2025-06-19 15:37:34,923 - services.payment_service - INFO - Payment verified successfully for reference PAY-ORDER-20250619153631-4751. Status: success
2025-06-19 15:37:34,957 - utils.data_manager - INFO - Data saved to data\orders.json
2025-06-19 15:37:34,958 - utils.data_manager - INFO - Order details saved to data\orders.json
2025-06-19 15:37:34,964 - services.lead_tracker - INFO - Order completion tracked for 2348055614455: ORDER-20250619153631-4751 (₦1,400)
2025-06-19 15:37:34,964 - handlers.lead_tracking_handler - INFO - 💰 Conversion tracked: 2348055614455 - ORDER-20250619153631-4751 (₦1,400)
2025-06-19 15:37:34,965 - handlers.base_handler - ERROR - Error handling successful auto payment for order ORDER-20250619153631-4751: 'Config' object has no attribute 'get'
2025-06-19 15:43:47,591 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Paid'}
2025-06-19 15:43:47,596 - handlers.base_handler - WARNING - handle_order_confirmation_state called but order ORDER-20250619153631-4751 not found or not confirmed. Status: pending_payment
2025-06-19 15:43:47,596 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': 'We are having trouble finding your order details. Please start a new order.'}}
2025-06-19 15:43:48,877 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjVFQ0QxNkVBOThGMkJGOUM2OAA="}]}
2025-06-19 15:43:48,878 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjVFQ0QxNkVBOThGMkJGOUM2OAA='}]}
2025-06-19 15:43:48,878 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:43:48] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:43:50,077 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:43:50] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:44:15,266 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:44:15] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:46:22,163 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-19 15:46:22,163 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 15:46:22,163 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 15:46:22,164 - services.payment_service - INFO - PaymentService initialized
2025-06-19 15:46:22,164 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 15:46:22,165 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 15:46:22,165 - services.payment_service - INFO - PaymentService initialized
2025-06-19 15:46:22,166 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-19 15:46:22,166 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-19 15:46:22,167 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-19 15:46:22,167 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-19 15:46:22,167 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 15:46:22,167 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-19 15:46:22,555 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-19 15:46:22,555 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-19 15:46:22,556 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-06-19 15:46:22,556 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 15:46:22,569 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-19 15:46:22,570 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-19 15:46:25,816 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-19 15:46:25,817 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-19 15:46:25,824 - handlers.base_handler - INFO - Session 2348055614455 recognized user 'Ziga'.
2025-06-19 15:46:25,824 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Welcome Ziga! 👋🏼\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-19 15:46:27,315 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjFDMDlENTI2QzhFNURGNDk3QwA="}]}
2025-06-19 15:46:27,316 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjFDMDlENTI2QzhFNURGNDk3QwA='}]}
2025-06-19 15:46:27,316 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:46:27] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:46:28,141 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:46:28] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:46:28,497 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:46:28] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:46:29,566 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-19 15:46:29,569 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-06-19 15:46:29,569 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-06-19 15:46:29,570 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-06-19 15:46:29,570 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-06-19 15:46:29,570 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Just send me your full order in one message! \n\nLike this: 'Two plates of jollof rice, 2 Cokes, and asun.'\n\nWant to go back again? Type ‘menu’ to return. "}}
2025-06-19 15:46:30,546 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjhFNkJEOTlCNUQzNTQ1NkZBNQA="}]}
2025-06-19 15:46:30,546 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjhFNkJEOTlCNUQzNTQ1NkZBNQA='}]}
2025-06-19 15:46:30,547 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:46:30] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:46:31,435 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:46:31] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:46:31,814 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:46:31] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:46:31,816 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:46:31] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:46:34,959 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Fried rice'}
2025-06-19 15:46:34,962 - handlers.base_handler - INFO - AIHandler: Handling message 'fried rice' in AI bulk order state for session 2348055614455. Original: 'Fried rice'
2025-06-19 15:46:37,365 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-19 15:46:37,367 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🛒 *Order Summary:*\n\n✅ 1x Fried Rice Fiesta - ₦1,400\n\n*Total: ₦1,400.00*\n\nWould you like to proceed with this order?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'confirm_ai_order', 'title': '✅ Confirm Order'}}, {'type': 'reply', 'reply': {'id': 'modify_ai_order', 'title': '✏️ Modify Order'}}, {'type': 'reply', 'reply': {'id': 'cancel_ai_order', 'title': '❌ Cancel'}}]}}}
2025-06-19 15:46:38,306 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkQ1MzNEOTdENjVBQTJBQjVCMQA="}]}
2025-06-19 15:46:38,306 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkQ1MzNEOTdENjVBQTJBQjVCMQA='}]}
2025-06-19 15:46:38,307 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:46:38] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:46:39,085 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:46:39] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:46:39,488 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:46:39] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:46:39,585 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:46:39] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:46:40,672 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'confirm_ai_order'}
2025-06-19 15:46:40,674 - handlers.base_handler - INFO - AI order confirmed. Cart: {'Fried Rice Fiesta': {'item_id': 'Fried Rice Fiesta', 'quantity': 1, 'price': 1400, 'total_price': 1400, 'variations': {}}}. Redirecting to order handler.
2025-06-19 15:46:40,674 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'order_handler' with message 'process_final_order'.
2025-06-19 15:46:40,675 - handlers.order_handler - INFO - AI initiated order processing for session 2348055614455.
2025-06-19 15:46:40,675 - handlers.order_handler - INFO - Address set, proceeding to confirm order for AI-initiated session 2348055614455.
2025-06-19 15:46:40,675 - handlers.order_handler - INFO - Showing final order confirmation for session 2348055614455. Total: ₦1,400.00
2025-06-19 15:46:40,676 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🛒 *Final Order Confirmation*\n\n📋 *Items Ordered:*\n• 1x Fried Rice Fiesta - ₦1,400.00\n\n📍 *Delivery Details:*\n👤 Name: Ziga\n📱 Phone: 2348055614455\n🏠 Address: Howson Wright\n\n💰 *Total Amount: ₦1,400.00*\n\nPlease confirm to proceed with payment.'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'final_confirm', 'title': '✅ Confirm & Pay'}}, {'type': 'reply', 'reply': {'id': 'edit_order', 'title': '✏️ Edit Order'}}, {'type': 'reply', 'reply': {'id': 'cancel_order', 'title': '❌ Cancel Order'}}]}}}
2025-06-19 15:46:41,905 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjhGNzUwOEVFOTgxOUNFM0NCOAA="}]}
2025-06-19 15:46:41,909 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦1,400 (1 items)
2025-06-19 15:46:41,909 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦1,400.00
2025-06-19 15:46:41,909 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjhGNzUwOEVFOTgxOUNFM0NCOAA='}]}
2025-06-19 15:46:41,910 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:46:41] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:46:42,666 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:46:42] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:46:43,166 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:46:43] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:46:43,267 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:46:43] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:46:44,136 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'final_confirm'}
2025-06-19 15:46:44,139 - handlers.order_handler - INFO - Order ORDER_20250619_154644_978f6dd2 confirmed for session 2348055614455. Amount: ₦1,400.00
2025-06-19 15:46:44,143 - services.lead_tracker - INFO - Order completion tracked for 2348055614455: ORDER_20250619_154644_978f6dd2 (₦1,400)
2025-06-19 15:46:44,143 - handlers.lead_tracking_handler - INFO - 💰 Conversion tracked: 2348055614455 - ORDER_20250619_154644_978f6dd2 (₦1,400)
2025-06-19 15:46:44,144 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'payment_handler' with message 'initiate_payment'.
2025-06-19 15:46:44,144 - handlers.base_handler - INFO - Handling payment processing for session 2348055614455, message: initiate_payment
2025-06-19 15:46:44,144 - handlers.base_handler - INFO - Creating payment link for session 2348055614455
2025-06-19 15:46:44,157 - utils.data_manager - INFO - Data saved to data\orders.json
2025-06-19 15:46:44,157 - utils.data_manager - INFO - Order details saved to data\orders.json
2025-06-19 15:46:44,157 - services.payment_service - INFO - Attempting to create payment link for reference: PAY-ORDER-20250619154644-3217 with amount: 140000, email: ziga4455@foodorder.com
2025-06-19 15:46:44,886 - services.payment_service - INFO - Payment link created for Ziga Ziga (2348055614455), URL: https://checkout.paystack.com/7h2dn213d3l2182
2025-06-19 15:46:44,887 - handlers.base_handler - INFO - Starting payment monitoring for order ORDER-20250619154644-3217, reference PAY-ORDER-20250619154644-3217
2025-06-19 15:46:44,887 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-ORDER-20250619154644-3217
2025-06-19 15:46:45,396 - services.payment_service - WARNING - Payment not successful for reference PAY-ORDER-20250619154644-3217. Paystack status: abandoned. Response: {'status': True, 'message': 'Verification successful', 'data': {'id': 5071169017, 'domain': 'test', 'status': 'abandoned', 'reference': 'PAY-ORDER-20250619154644-3217', 'receipt_number': None, 'amount': 140000, 'message': None, 'gateway_response': 'The transaction was not completed', 'paid_at': None, 'created_at': '2025-06-19T14:46:45.000Z', 'channel': 'card', 'currency': 'NGN', 'ip_address': '102.67.12.153, 172.69.195.50, 172.31.62.52', 'metadata': {'customer_name': 'Ziga', 'customer_phone': '2348055614455', 'first_name': 'Ziga', 'last_name': 'Ziga', 'order_id': 'ORDER-20250619154644-3217', 'delivery_address': 'Howson Wright'}, 'log': None, 'fees': None, 'fees_split': None, 'authorization': {}, 'customer': {'id': 276711440, 'first_name': None, 'last_name': None, 'email': 'ziga4455@foodorder.com', 'customer_code': 'CUS_bhkdpnbvcjqt55g', 'phone': None, 'metadata': None, 'risk_action': 'default', 'international_format_phone': None}, 'plan': None, 'split': {}, 'order_id': None, 'paidAt': None, 'createdAt': '2025-06-19T14:46:45.000Z', 'requested_amount': 140000, 'pos_transaction_data': None, 'source': None, 'fees_breakdown': None, 'connect': None, 'transaction_date': '2025-06-19T14:46:45.000Z', 'plan_object': {}, 'subaccount': {}}}
2025-06-19 15:46:45,397 - handlers.base_handler - INFO - Payment not yet verified for order ORDER-20250619154644-3217, attempt 1/15
2025-06-19 15:46:45,397 - handlers.base_handler - INFO - Payment link created successfully for order ORDER-20250619154644-3217
2025-06-19 15:46:45,398 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "🛒 **Order Created Successfully!**\n\n📋 **Order ID:** ORDER-20250619154644-3217\n💰 **Total:** ₦1,400\n\n💳 **Complete Payment:**\nhttps://checkout.paystack.com/7h2dn213d3l2182\n\n✅ We'll automatically confirm your order once payment is received!\n💬 You can also send 'paid' after payment to check status immediately.\n\n⏰ Payment link expires in 15 minutes."}}
2025-06-19 15:46:46,356 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjRBQjA0RDA2MkVFOUU0MDUwRgA="}]}
2025-06-19 15:46:46,359 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦1,400 (1 items)
2025-06-19 15:46:46,359 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦1,400.00
2025-06-19 15:46:46,359 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjRBQjA0RDA2MkVFOUU0MDUwRgA='}]}
2025-06-19 15:46:46,360 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:46:46] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:46:47,082 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-19 15:46:47,087 - handlers.base_handler - INFO - User sent message while still awaiting payment for order ORDER-20250619154644-3217.
2025-06-19 15:46:47,087 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "🔄 *Payment Monitoring Active*\n\nWe're automatically checking your payment status every minute.\n\n📋 **Order ID:** ORDER-20250619154644-3217\n\n✅ Once payment is confirmed, you'll receive an automatic confirmation.\n💬 Send 'paid' to check status immediately.\n❌ Send 'cancel' to cancel this order."}}
2025-06-19 15:46:47,207 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:46:47] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:46:47,532 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:46:47] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:46:47,534 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:46:47] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:46:48,108 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkIwNEJGRkJGQTFDQkM5QkEyNAA="}]}
2025-06-19 15:46:48,112 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦1,400 (1 items)
2025-06-19 15:46:48,112 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦1,400.00
2025-06-19 15:46:48,112 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkIwNEJGRkJGQTFDQkM5QkEyNAA='}]}
2025-06-19 15:46:48,113 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:46:48] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:46:48,939 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:46:48] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:46:49,175 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:46:49] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:46:57,273 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:46:57] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:47:45,408 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-ORDER-20250619154644-3217
2025-06-19 15:47:46,021 - services.payment_service - INFO - Payment verified successfully for reference PAY-ORDER-20250619154644-3217. Status: success
2025-06-19 15:47:46,022 - handlers.base_handler - INFO - Payment verified for order ORDER-20250619154644-3217 on attempt 2
2025-06-19 15:47:46,022 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-ORDER-20250619154644-3217
2025-06-19 15:47:46,569 - services.payment_service - INFO - Payment verified successfully for reference PAY-ORDER-20250619154644-3217. Status: success
2025-06-19 15:47:46,583 - utils.data_manager - INFO - Data saved to data\orders.json
2025-06-19 15:47:46,583 - utils.data_manager - INFO - Order details saved to data\orders.json
2025-06-19 15:47:46,586 - services.lead_tracker - INFO - Order completion tracked for 2348055614455: ORDER-20250619154644-3217 (₦1,400)
2025-06-19 15:47:46,586 - handlers.lead_tracking_handler - INFO - 💰 Conversion tracked: 2348055614455 - ORDER-20250619154644-3217 (₦1,400)
2025-06-19 15:47:46,586 - handlers.base_handler - ERROR - Error handling successful auto payment for order ORDER-20250619154644-3217: 'Config' object has no attribute 'get'
2025-06-19 15:48:03,400 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Paid'}
2025-06-19 15:48:03,407 - handlers.base_handler - WARNING - handle_order_confirmation_state called but order ORDER-20250619154644-3217 not found or not confirmed. Status: pending_payment
2025-06-19 15:48:03,408 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': '⚠️ Order not found or not confirmed. Please start a new order.'}}
2025-06-19 15:48:04,459 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQzMjM2QzFCNUU3QjdFOTlFMQA="}]}
2025-06-19 15:48:04,460 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQzMjM2QzFCNUU3QjdFOTlFMQA='}]}
2025-06-19 15:48:04,461 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:48:04] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:48:05,626 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:48:05] "POST /webhook HTTP/1.1" 200 -
2025-06-19 15:48:05,650 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 15:48:05] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:17:15,723 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-19 16:17:15,723 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 16:17:15,724 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 16:17:15,725 - services.payment_service - INFO - PaymentService initialized
2025-06-19 16:17:15,725 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 16:17:15,726 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 16:17:15,728 - services.payment_service - INFO - PaymentService initialized
2025-06-19 16:17:15,728 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-19 16:17:15,729 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-19 16:17:15,731 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-19 16:17:15,731 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-19 16:17:15,732 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 16:17:15,732 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-19 16:17:16,494 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-19 16:17:16,495 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-19 16:17:16,496 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-06-19 16:17:16,497 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 16:17:16,547 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-19 16:17:16,548 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-19 16:17:26,615 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-19 16:17:26,616 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-19 16:17:26,630 - handlers.base_handler - INFO - Session 2348055614455 recognized user 'Ziga'.
2025-06-19 16:17:26,631 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Welcome Ziga! 👋🏼\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-19 16:17:27,850 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjI1RDA1N0NENjJBMTlFM0FFOQA="}]}
2025-06-19 16:17:27,851 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjI1RDA1N0NENjJBMTlFM0FFOQA='}]}
2025-06-19 16:17:27,852 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:17:27] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:17:28,719 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:17:28] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:17:29,009 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:17:29] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:17:29,156 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:17:29] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:17:31,957 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-19 16:17:31,962 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-06-19 16:17:31,962 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-06-19 16:17:31,963 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-06-19 16:17:31,964 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-06-19 16:17:31,965 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Just send me your full order in one message! \n\nLike this: 'Two plates of jollof rice, 2 Cokes, and asun.'\n\nWant to go back again? Type ‘menu’ to return. "}}
2025-06-19 16:17:32,876 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkY2ODI5ODA5OTUwQzQzMTM3OQA="}]}
2025-06-19 16:17:32,878 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkY2ODI5ODA5OTUwQzQzMTM3OQA='}]}
2025-06-19 16:17:32,880 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:17:32] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:17:33,956 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:17:33] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:17:34,061 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:17:34] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:17:34,502 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:17:34] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:17:44,190 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Fried rice'}
2025-06-19 16:17:44,194 - handlers.base_handler - INFO - AIHandler: Handling message 'fried rice' in AI bulk order state for session 2348055614455. Original: 'Fried rice'
2025-06-19 16:17:46,042 - httpx - INFO - HTTP Request: POST https://pentanative-lola-resource.cognitiveservices.azure.com/openai/deployments/gpt-4.1-mini/chat/completions?api-version=2025-01-01-preview "HTTP/1.1 401 PermissionDenied"
2025-06-19 16:17:46,087 - services.ai_service - ERROR - Azure OpenAI API error parsing order: Error code: 401 - {'error': {'code': '401', 'message': 'Access denied due to invalid subscription key or wrong API endpoint. Make sure to provide a valid key for an active subscription and use a correct regional API endpoint for your resource.'}}
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\app\services\ai_service.py", line 196, in parse_order_with_llm
    response = self.azure_client.chat.completions.create(
        model=self.deployment_name,
    ...<6 lines>...
        # response_format={"type": "json_object"} # Use this if your Azure deployment supports it
    )
  File "C:\Users\zigam\AppData\Local\Programs\Python\Python313\Lib\site-packages\openai\_utils\_utils.py", line 287, in wrapper
    return func(*args, **kwargs)
  File "C:\Users\zigam\AppData\Local\Programs\Python\Python313\Lib\site-packages\openai\resources\chat\completions\completions.py", line 925, in create
    return self._post(
           ~~~~~~~~~~^
        "/chat/completions",
        ^^^^^^^^^^^^^^^^^^^^
    ...<43 lines>...
        stream_cls=Stream[ChatCompletionChunk],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\zigam\AppData\Local\Programs\Python\Python313\Lib\site-packages\openai\_base_client.py", line 1239, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\AppData\Local\Programs\Python\Python313\Lib\site-packages\openai\_base_client.py", line 1034, in request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'code': '401', 'message': 'Access denied due to invalid subscription key or wrong API endpoint. Make sure to provide a valid key for an active subscription and use a correct regional API endpoint for your resource.'}}
2025-06-19 16:17:46,104 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "❌ AI processing temporarily unavailable. Please try again.\n\nPlease try rephrasing your order or type 'menu' to return to main menu."}}
2025-06-19 16:17:47,125 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkJENjhCNkFFMzczMzQ0QjNEMQA="}]}
2025-06-19 16:17:47,126 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkJENjhCNkFFMzczMzQ0QjNEMQA='}]}
2025-06-19 16:17:47,127 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:17:47] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:17:48,087 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:17:48] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:17:48,508 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:17:48] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:17:48,510 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:17:48] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:17:58,174 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'Hello'}
2025-06-19 16:17:58,174 - utils.session_manager - INFO - New session 2347082345056 initialized.
2025-06-19 16:17:58,188 - handlers.base_handler - INFO - Session 2347082345056 identified as guest, prompting for name and address.
2025-06-19 16:17:58,188 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'text', 'text': {'body': 'Hello Guest, welcome to Lola! 👋🏼\n\nWhat is your preferred name and address?'}}
2025-06-19 16:17:59,369 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkNENkM5MDkyOEE0RTIyMDAyOQA="}]}
2025-06-19 16:17:59,371 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkNENkM5MDkyOEE0RTIyMDAyOQA='}]}
2025-06-19 16:17:59,373 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:17:59] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:18:00,616 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:18:00] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:18:01,300 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:18:01] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:18:01,543 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:18:01] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:20:15,232 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'Olumayowa, Ikeja'}
2025-06-19 16:20:15,250 - handlers.message_processor - WARNING - No specific handler or state match for handler 'greeting_handler', state 'guest_info_prompt', message 'olumayowa, ikeja' for session 2347082345056. Resetting to greeting.
2025-06-19 16:20:15,251 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'text', 'text': {'body': "I'm sorry, I didn't quite understand that. Let's get back to the main menu."}}
2025-06-19 16:20:16,312 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjlGQkU4Mjk2MzQ2NjRENEIxMQA="}]}
2025-06-19 16:20:16,312 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Please choose from the options below:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-19 16:20:17,214 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:20:17] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:20:17,295 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkNENzI2MjFCNjEzQUJCNkYwMgA="}]}
2025-06-19 16:20:17,296 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkNENzI2MjFCNjEzQUJCNkYwMgA='}]}
2025-06-19 16:20:17,297 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:20:17] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:20:17,900 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:20:17] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:20:18,014 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:20:18] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:20:18,386 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:20:18] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:20:18,838 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:20:18] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:20:18,986 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:20:18] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:20:31,887 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'order_menu_categories'}
2025-06-19 16:20:31,899 - handlers.base_handler - INFO - GreetingHandler: Handling message 'order_menu_categories' in greeting state for session 2347082345056.
2025-06-19 16:20:31,916 - handlers.base_handler - INFO - Session 2347082345056 redirecting to menu_handler for classic menu.
2025-06-19 16:20:31,917 - handlers.message_processor - INFO - Redirecting session 2347082345056 to handler 'menu_handler' with message 'show_menu'.
2025-06-19 16:20:31,918 - handlers.base_handler - INFO - MenuHandler: Received message 'show_menu' (original: 'order_menu_categories') in menu state for session 2347082345056
2025-06-19 16:20:31,918 - handlers.base_handler - INFO - Showing menu categories for session 2347082345056
2025-06-19 16:20:31,919 - handlers.base_handler - INFO - Available categories: ['Main Dishes', 'Soups & Stews', 'Sides', 'Snacks', 'Drinks', 'Desserts', 'Specialties']
2025-06-19 16:20:31,920 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'list', 'body': {'text': '🍽️ *Our Menu*\n\nChoose a category to browse items:'}, 'action': {'button': 'Categories', 'sections': [{'title': 'Menu Categories', 'rows': [{'id': 'main dishes', 'title': 'Main Dishes'}, {'id': 'soups & stews', 'title': 'Soups & Stews'}, {'id': 'sides', 'title': 'Sides'}, {'id': 'snacks', 'title': 'Snacks'}, {'id': 'drinks', 'title': 'Drinks'}, {'id': 'desserts', 'title': 'Desserts'}, {'id': 'specialties', 'title': 'Specialties'}]}]}}}
2025-06-19 16:20:33,064 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkU2MERFMkY5QjE3NjMyRkUzMAA="}]}
2025-06-19 16:20:33,065 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkU2MERFMkY5QjE3NjMyRkUzMAA='}]}
2025-06-19 16:20:33,066 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:20:33] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:20:34,006 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:20:34] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:20:34,624 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:20:34] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:20:34,948 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:20:34] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:20:39,299 - handlers.webhook_handler - INFO - List reply received: id='main dishes', title='Main Dishes'
2025-06-19 16:20:39,300 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'main dishes'}
2025-06-19 16:20:39,311 - handlers.base_handler - INFO - MenuHandler: Received message 'main dishes' (original: 'main dishes') in menu state for session 2347082345056
2025-06-19 16:20:39,311 - handlers.base_handler - INFO - Category 'Main Dishes' selected for session 2347082345056
2025-06-19 16:20:39,312 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'list', 'body': {'text': '🍽️ *Main Dishes*\n\nSelect an item to add to your cart:'}, 'action': {'button': 'Select Item', 'sections': [{'title': 'Main Dishes Items', 'rows': [{'id': 'Smoky Jollof Fiesta', 'title': 'Smoky Jollof Fi (₦1,500)'}, {'id': 'Egusi Pasta Primavera', 'title': 'Egusi Pasta Pri (₦1,800)'}, {'id': 'Grilled Tilapia with Herb Crust', 'title': 'Grilled Tilapia (₦2,000)'}, {'id': 'Pounded Yam with Vegetable Soup', 'title': 'Pounded Yam wit (₦1,700)'}, {'id': 'Fried Rice Fiesta', 'title': 'Fried Rice Fies (₦1,400)'}, {'id': 'Suya-Spiced Chicken Platter', 'title': 'Suya-Spiced Chi (₦1,600)'}, {'id': 'Banga Rice Delight', 'title': 'Banga Rice Deli (₦1,300)'}, {'id': 'Plantain Porridge with Fish', 'title': 'Plantain Porrid (₦1,500)'}, {'id': 'Amala with Gbegiri and Ewedu', 'title': 'Amala with Gbeg (₦1,600)'}, {'id': 'Spicy Beef Stir-Fry', 'title': 'Spicy Beef Stir (₦1,700)'}]}]}}}
2025-06-19 16:20:40,325 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjcyRTkzNkI1MzM4NzE0OEFEMgA="}]}
2025-06-19 16:20:40,364 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjcyRTkzNkI1MzM4NzE0OEFEMgA='}]}
2025-06-19 16:20:40,369 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:20:40] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:20:41,208 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:20:41] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:20:41,707 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:20:41] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:20:41,742 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:20:41] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:20:45,490 - handlers.webhook_handler - INFO - List reply received: id='Fried Rice Fiesta', title='Fried Rice Fies (₦1,400)'
2025-06-19 16:20:45,491 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'Fried Rice Fiesta'}
2025-06-19 16:20:45,501 - handlers.base_handler - INFO - MenuHandler: Handling item selection 'Fried Rice Fiesta' for session 2347082345056
2025-06-19 16:20:45,501 - handlers.base_handler - INFO - Item 'Fried Rice Fiesta' selected for session 2347082345056, redirecting to order handler
2025-06-19 16:20:45,502 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'text', 'text': {'body': '🛒 *Fried Rice Fiesta*\nPrice: ₦1,400\n\nHow many would you like to order?\n\nPlease enter a number (e.g., 1, 2, 3...):'}}
2025-06-19 16:20:46,644 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjg1NzhBMzE5QThBMzBCQTFEMQA="}]}
2025-06-19 16:20:46,645 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjg1NzhBMzE5QThBMzBCQTFEMQA='}]}
2025-06-19 16:20:46,646 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:20:46] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:20:47,502 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:20:47] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:20:48,227 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:20:48] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:20:48,451 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:20:48] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:20:51,750 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': '4'}
2025-06-19 16:20:51,760 - handlers.order_handler - INFO - Item 'Fried Rice Fiesta' added to cart for session 2347082345056. Cart: {'Fried Rice Fiesta': {'item_id': 'Fried Rice Fiesta', 'quantity': 4, 'price': 1400.0, 'total_price': 5600.0, 'variations': {}}}
2025-06-19 16:20:51,773 - services.lead_tracker - INFO - Cart addition tracked for 2347082345056: ₦5,600.0 (1 items)
2025-06-19 16:20:51,776 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2347082345056 - ₦5,600.00
2025-06-19 16:20:51,777 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': "🛒 *Your Cart:*\n• 4 x Fried Rice Fiesta (₦1,400.0) = ₦5,600.0\n\n💰 *Total: ₦5,600.0*\n\nWhat would you like to do next?\n\nPress 'Checkout' to finalize.\nPress 'Order More' to add more items.\nOr, press 'Other Options' for cart management."}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'checkout', 'title': 'Checkout'}}, {'type': 'reply', 'reply': {'id': 'order_more', 'title': 'Order More'}}, {'type': 'reply', 'reply': {'id': 'other_actions', 'title': 'Other Options'}}]}}}
2025-06-19 16:20:52,806 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjY2NUZENUQyMzk0ODU2QjFFQQA="}]}
2025-06-19 16:20:52,817 - services.lead_tracker - INFO - Cart addition tracked for 2347082345056: ₦5,600.0 (1 items)
2025-06-19 16:20:52,818 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2347082345056 - ₦5,600.00
2025-06-19 16:20:52,819 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjY2NUZENUQyMzk0ODU2QjFFQQA='}]}
2025-06-19 16:20:52,820 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:20:52] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:20:53,712 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:20:53] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:20:54,144 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:20:54] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:20:54,179 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:20:54] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:21:00,437 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'order_more'}
2025-06-19 16:21:00,450 - handlers.order_handler - INFO - User selected 'Order More' for session 2347082345056.
2025-06-19 16:21:00,451 - handlers.message_processor - INFO - Redirecting session 2347082345056 to handler 'menu_handler' with message 'show_menu'.
2025-06-19 16:21:00,452 - handlers.message_processor - WARNING - Unhandled order_handler state 'menu' for session 2347082345056
2025-06-19 16:21:00,453 - handlers.message_processor - WARNING - No specific handler or state match for handler 'order_handler', state 'menu', message 'show_menu' for session 2347082345056. Resetting to greeting.
2025-06-19 16:21:00,454 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'text', 'text': {'body': "I'm sorry, I didn't quite understand that. Let's get back to the main menu."}}
2025-06-19 16:21:01,538 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkY3RTFGN0VERjkwMDJBNEVFQgA="}]}
2025-06-19 16:21:01,539 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Please choose from the options below:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-19 16:21:02,329 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:21:02] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:21:02,594 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjBBNzVBRkZFOEJEMTkyMUU0NgA="}]}
2025-06-19 16:21:02,602 - services.lead_tracker - INFO - Cart addition tracked for 2347082345056: ₦5,600.0 (1 items)
2025-06-19 16:21:02,602 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2347082345056 - ₦5,600.00
2025-06-19 16:21:02,603 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjBBNzVBRkZFOEJEMTkyMUU0NgA='}]}
2025-06-19 16:21:02,604 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:21:02] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:21:03,392 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:21:03] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:21:03,556 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:21:03] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:21:03,658 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:21:03] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:21:03,807 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:21:03] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:21:03,906 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:21:03] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:21:30,793 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-19 16:21:30,794 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 16:21:30,795 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 16:21:30,796 - services.payment_service - INFO - PaymentService initialized
2025-06-19 16:21:30,797 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 16:21:30,798 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 16:21:30,800 - services.payment_service - INFO - PaymentService initialized
2025-06-19 16:21:30,800 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-19 16:21:30,801 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-19 16:21:30,802 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-19 16:21:30,803 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-19 16:21:30,803 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 16:21:30,804 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-19 16:21:31,600 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-19 16:21:31,600 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-19 16:21:31,601 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-06-19 16:21:31,601 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 16:21:31,626 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-19 16:21:31,628 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-19 16:21:39,777 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-19 16:21:39,778 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-19 16:21:39,789 - handlers.base_handler - INFO - Session 2348055614455 recognized user 'Ziga'.
2025-06-19 16:21:39,790 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Welcome Ziga! 👋🏼\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-19 16:21:40,781 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkNDNTBGNzI2MUIxODZCNjk0RAA="}]}
2025-06-19 16:21:40,782 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkNDNTBGNzI2MUIxODZCNjk0RAA='}]}
2025-06-19 16:21:40,783 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:21:40] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:21:41,685 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:21:41] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:21:41,938 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:21:41] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:21:42,508 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:21:42] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:21:43,826 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-19 16:21:43,830 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-06-19 16:21:43,831 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-06-19 16:21:43,832 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-06-19 16:21:43,832 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-06-19 16:21:43,833 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Just send me your full order in one message! \n\nLike this: 'Two plates of jollof rice, 2 Cokes, and asun.'\n\nWant to go back again? Type ‘menu’ to return. "}}
2025-06-19 16:21:44,865 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjZFREE2QjRCRUUxODU1MkRFNwA="}]}
2025-06-19 16:21:44,866 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjZFREE2QjRCRUUxODU1MkRFNwA='}]}
2025-06-19 16:21:44,867 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:21:44] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:21:45,876 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:21:45] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:21:46,022 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:21:46] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:21:46,608 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:21:46] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:21:49,627 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Fried rice'}
2025-06-19 16:21:49,632 - handlers.base_handler - INFO - AIHandler: Handling message 'fried rice' in AI bulk order state for session 2348055614455. Original: 'Fried rice'
2025-06-19 16:21:51,334 - httpx - INFO - HTTP Request: POST https://pentanative-lola-resource.cognitiveservices.azure.com/openai/deployments/gpt-4.1-mini/chat/completions?api-version=2025-01-01-preview "HTTP/1.1 401 PermissionDenied"
2025-06-19 16:21:51,336 - services.ai_service - ERROR - Azure OpenAI API error parsing order: Error code: 401 - {'error': {'code': '401', 'message': 'Access denied due to invalid subscription key or wrong API endpoint. Make sure to provide a valid key for an active subscription and use a correct regional API endpoint for your resource.'}}
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\app\services\ai_service.py", line 196, in parse_order_with_llm
    response = self.azure_client.chat.completions.create(
        model=self.deployment_name,
    ...<6 lines>...
        # response_format={"type": "json_object"} # Use this if your Azure deployment supports it
    )
  File "C:\Users\zigam\AppData\Local\Programs\Python\Python313\Lib\site-packages\openai\_utils\_utils.py", line 287, in wrapper
    return func(*args, **kwargs)
  File "C:\Users\zigam\AppData\Local\Programs\Python\Python313\Lib\site-packages\openai\resources\chat\completions\completions.py", line 925, in create
    return self._post(
           ~~~~~~~~~~^
        "/chat/completions",
        ^^^^^^^^^^^^^^^^^^^^
    ...<43 lines>...
        stream_cls=Stream[ChatCompletionChunk],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\zigam\AppData\Local\Programs\Python\Python313\Lib\site-packages\openai\_base_client.py", line 1239, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\AppData\Local\Programs\Python\Python313\Lib\site-packages\openai\_base_client.py", line 1034, in request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'code': '401', 'message': 'Access denied due to invalid subscription key or wrong API endpoint. Make sure to provide a valid key for an active subscription and use a correct regional API endpoint for your resource.'}}
2025-06-19 16:21:51,344 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "❌ AI processing temporarily unavailable. Please try again.\n\nPlease try rephrasing your order or type 'menu' to return to main menu."}}
2025-06-19 16:21:52,301 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjEwOUE4QkJDM0UzNjI4REJGRgA="}]}
2025-06-19 16:21:52,303 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjEwOUE4QkJDM0UzNjI4REJGRgA='}]}
2025-06-19 16:21:52,303 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:21:52] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:21:53,172 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:21:53] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:21:53,296 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:21:53] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:21:53,737 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:21:53] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:22:37,526 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-19 16:22:37,526 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 16:22:37,528 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 16:22:37,529 - services.payment_service - INFO - PaymentService initialized
2025-06-19 16:22:37,529 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 16:22:37,531 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 16:22:37,532 - services.payment_service - INFO - PaymentService initialized
2025-06-19 16:22:37,532 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-19 16:22:37,533 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-19 16:22:37,534 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-19 16:22:37,535 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-19 16:22:37,537 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 16:22:37,537 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-19 16:22:38,312 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-19 16:22:38,313 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-19 16:22:38,313 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-06-19 16:22:38,314 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 16:22:38,342 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-19 16:22:38,343 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-19 16:22:39,762 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-19 16:22:39,763 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-19 16:22:39,772 - handlers.base_handler - INFO - Session 2348055614455 recognized user 'Ziga'.
2025-06-19 16:22:39,773 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Welcome Ziga! 👋🏼\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-19 16:22:41,033 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjg3RTBEMUNGQTUwRDk5OEQzNwA="}]}
2025-06-19 16:22:41,034 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjg3RTBEMUNGQTUwRDk5OEQzNwA='}]}
2025-06-19 16:22:41,035 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:22:41] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:22:42,219 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:22:42] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:22:42,221 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:22:42] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:22:42,277 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:22:42] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:22:43,242 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-19 16:22:43,246 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-06-19 16:22:43,247 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-06-19 16:22:43,247 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-06-19 16:22:43,248 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-06-19 16:22:43,249 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Just send me your full order in one message! \n\nLike this: 'Two plates of jollof rice, 2 Cokes, and asun.'\n\nWant to go back again? Type ‘menu’ to return. "}}
2025-06-19 16:22:44,240 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjE2Q0Y0MEIxQTlCMEU4NjM2QQA="}]}
2025-06-19 16:22:44,241 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjE2Q0Y0MEIxQTlCMEU4NjM2QQA='}]}
2025-06-19 16:22:44,242 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:22:44] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:22:45,057 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:22:45] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:22:45,286 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:22:45] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:22:45,830 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:22:45] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:22:48,667 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Fried rice'}
2025-06-19 16:22:48,671 - handlers.base_handler - INFO - AIHandler: Handling message 'fried rice' in AI bulk order state for session 2348055614455. Original: 'Fried rice'
2025-06-19 16:22:50,437 - httpx - INFO - HTTP Request: POST https://pentanative-lola-resource.cognitiveservices.azure.com/openai/deployments/gpt-4.1-mini/chat/completions?api-version=2025-01-01-preview "HTTP/1.1 401 PermissionDenied"
2025-06-19 16:22:50,438 - services.ai_service - ERROR - Azure OpenAI API error parsing order: Error code: 401 - {'error': {'code': '401', 'message': 'Access denied due to invalid subscription key or wrong API endpoint. Make sure to provide a valid key for an active subscription and use a correct regional API endpoint for your resource.'}}
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\app\services\ai_service.py", line 196, in parse_order_with_llm
    response = self.azure_client.chat.completions.create(
        model=self.deployment_name,
    ...<6 lines>...
        # response_format={"type": "json_object"} # Use this if your Azure deployment supports it
    )
  File "C:\Users\zigam\AppData\Local\Programs\Python\Python313\Lib\site-packages\openai\_utils\_utils.py", line 287, in wrapper
    return func(*args, **kwargs)
  File "C:\Users\zigam\AppData\Local\Programs\Python\Python313\Lib\site-packages\openai\resources\chat\completions\completions.py", line 925, in create
    return self._post(
           ~~~~~~~~~~^
        "/chat/completions",
        ^^^^^^^^^^^^^^^^^^^^
    ...<43 lines>...
        stream_cls=Stream[ChatCompletionChunk],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\zigam\AppData\Local\Programs\Python\Python313\Lib\site-packages\openai\_base_client.py", line 1239, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\AppData\Local\Programs\Python\Python313\Lib\site-packages\openai\_base_client.py", line 1034, in request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'code': '401', 'message': 'Access denied due to invalid subscription key or wrong API endpoint. Make sure to provide a valid key for an active subscription and use a correct regional API endpoint for your resource.'}}
2025-06-19 16:22:50,447 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "❌ AI processing temporarily unavailable. Please try again.\n\nPlease try rephrasing your order or type 'menu' to return to main menu."}}
2025-06-19 16:22:51,656 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjc1NTEzRTc3MTE3MTQ3MjAyMQA="}]}
2025-06-19 16:22:51,657 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjc1NTEzRTc3MTE3MTQ3MjAyMQA='}]}
2025-06-19 16:22:51,658 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:22:51] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:22:52,379 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:22:52] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:22:52,784 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:22:52] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:22:53,102 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:22:53] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:24:02,557 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-19 16:24:02,557 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 16:24:02,558 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 16:24:02,559 - services.payment_service - INFO - PaymentService initialized
2025-06-19 16:24:02,560 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 16:24:02,560 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 16:24:02,561 - services.payment_service - INFO - PaymentService initialized
2025-06-19 16:24:02,562 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-19 16:24:02,562 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-19 16:24:02,564 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-19 16:24:02,565 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-19 16:24:02,566 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 16:24:02,567 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-19 16:24:03,243 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-19 16:24:03,244 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-19 16:24:03,244 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-06-19 16:24:03,245 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 16:24:03,269 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-19 16:24:03,270 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-19 16:24:07,768 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-19 16:24:07,769 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-19 16:24:07,777 - handlers.base_handler - INFO - Session 2348055614455 recognized user 'Ziga'.
2025-06-19 16:24:07,778 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Welcome Ziga! 👋🏼\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-19 16:24:08,764 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjNDMjcyNTkwRjJDOTVDNTQwNAA="}]}
2025-06-19 16:24:08,765 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjNDMjcyNTkwRjJDOTVDNTQwNAA='}]}
2025-06-19 16:24:08,766 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:24:08] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:24:09,780 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:24:09] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:24:09,839 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:24:09] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:24:10,351 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:24:10] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:24:11,216 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-19 16:24:11,221 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-06-19 16:24:11,221 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-06-19 16:24:11,222 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-06-19 16:24:11,223 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-06-19 16:24:11,224 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Just send me your full order in one message! \n\nLike this: 'Two plates of jollof rice, 2 Cokes, and asun.'\n\nWant to go back again? Type ‘menu’ to return. "}}
2025-06-19 16:24:12,143 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjhBMUU2RDQxMUVDNEM1QUE2QQA="}]}
2025-06-19 16:24:12,144 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjhBMUU2RDQxMUVDNEM1QUE2QQA='}]}
2025-06-19 16:24:12,145 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:24:12] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:24:13,215 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:24:13] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:24:13,289 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:24:13] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:24:13,788 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:24:13] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:24:15,289 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Puff puff'}
2025-06-19 16:24:15,298 - handlers.base_handler - INFO - AIHandler: Handling message 'puff puff' in AI bulk order state for session 2348055614455. Original: 'Puff puff'
2025-06-19 16:24:16,847 - httpx - INFO - HTTP Request: POST https://pentanative-lola-resource.cognitiveservices.azure.com/openai/deployments/gpt-4.1-mini/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 401 PermissionDenied"
2025-06-19 16:24:16,849 - services.ai_service - ERROR - Azure OpenAI API error parsing order: Error code: 401 - {'error': {'code': '401', 'message': 'Access denied due to invalid subscription key or wrong API endpoint. Make sure to provide a valid key for an active subscription and use a correct regional API endpoint for your resource.'}}
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\app\services\ai_service.py", line 196, in parse_order_with_llm
    response = self.azure_client.chat.completions.create(
        model=self.deployment_name,
    ...<6 lines>...
        # response_format={"type": "json_object"} # Use this if your Azure deployment supports it
    )
  File "C:\Users\zigam\AppData\Local\Programs\Python\Python313\Lib\site-packages\openai\_utils\_utils.py", line 287, in wrapper
    return func(*args, **kwargs)
  File "C:\Users\zigam\AppData\Local\Programs\Python\Python313\Lib\site-packages\openai\resources\chat\completions\completions.py", line 925, in create
    return self._post(
           ~~~~~~~~~~^
        "/chat/completions",
        ^^^^^^^^^^^^^^^^^^^^
    ...<43 lines>...
        stream_cls=Stream[ChatCompletionChunk],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\zigam\AppData\Local\Programs\Python\Python313\Lib\site-packages\openai\_base_client.py", line 1239, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\AppData\Local\Programs\Python\Python313\Lib\site-packages\openai\_base_client.py", line 1034, in request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'code': '401', 'message': 'Access denied due to invalid subscription key or wrong API endpoint. Make sure to provide a valid key for an active subscription and use a correct regional API endpoint for your resource.'}}
2025-06-19 16:24:16,863 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "❌ AI processing temporarily unavailable. Please try again.\n\nPlease try rephrasing your order or type 'menu' to return to main menu."}}
2025-06-19 16:24:17,755 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjFEMDhBM0YxQ0U5NEQwQUU4NAA="}]}
2025-06-19 16:24:17,756 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjFEMDhBM0YxQ0U5NEQwQUU4NAA='}]}
2025-06-19 16:24:17,757 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:24:17] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:24:18,605 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:24:18] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:24:18,984 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:24:18] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:24:19,163 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:24:19] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:25:05,573 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-19 16:25:05,573 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 16:25:05,575 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 16:25:05,576 - services.payment_service - INFO - PaymentService initialized
2025-06-19 16:25:05,576 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 16:25:05,579 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 16:25:05,582 - services.payment_service - INFO - PaymentService initialized
2025-06-19 16:25:05,584 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-19 16:25:05,585 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-19 16:25:05,587 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-19 16:25:05,588 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-19 16:25:05,588 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 16:25:05,589 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-19 16:25:06,425 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-19 16:25:06,426 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-19 16:25:06,426 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-06-19 16:25:06,427 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 16:25:06,452 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-19 16:25:06,452 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-19 16:25:07,596 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-19 16:25:07,596 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-19 16:25:07,605 - handlers.base_handler - INFO - Session 2348055614455 recognized user 'Ziga'.
2025-06-19 16:25:07,606 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Welcome Ziga! 👋🏼\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-19 16:25:08,626 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkU5MjQ3NzRBQkY2QTA5OUQzQQA="}]}
2025-06-19 16:25:08,627 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkU5MjQ3NzRBQkY2QTA5OUQzQQA='}]}
2025-06-19 16:25:08,629 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:25:08] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:25:09,538 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:25:09] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:25:09,843 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:25:09] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:25:10,919 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-19 16:25:10,924 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-06-19 16:25:10,925 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-06-19 16:25:10,925 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-06-19 16:25:10,926 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-06-19 16:25:10,927 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Just send me your full order in one message! \n\nLike this: 'Two plates of jollof rice, 2 Cokes, and asun.'\n\nWant to go back again? Type ‘menu’ to return. "}}
2025-06-19 16:25:11,897 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjkxMEY4MUNCQUE1NDYxNTY0RQA="}]}
2025-06-19 16:25:11,898 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjkxMEY4MUNCQUE1NDYxNTY0RQA='}]}
2025-06-19 16:25:11,899 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:25:11] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:25:12,835 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:25:12] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:25:13,012 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:25:13] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:25:14,217 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Puff puff'}
2025-06-19 16:25:14,222 - handlers.base_handler - INFO - AIHandler: Handling message 'puff puff' in AI bulk order state for session 2348055614455. Original: 'Puff puff'
2025-06-19 16:25:15,753 - httpx - INFO - HTTP Request: POST https://pentanative-lola-resource.cognitiveservices.azure.com/openai/deployments/gpt-4.1-mini/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 401 PermissionDenied"
2025-06-19 16:25:15,755 - services.ai_service - ERROR - Azure OpenAI API error parsing order: Error code: 401 - {'error': {'code': '401', 'message': 'Access denied due to invalid subscription key or wrong API endpoint. Make sure to provide a valid key for an active subscription and use a correct regional API endpoint for your resource.'}}
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\app\services\ai_service.py", line 196, in parse_order_with_llm
    response = self.azure_client.chat.completions.create(
        model=self.deployment_name,
    ...<6 lines>...
        # response_format={"type": "json_object"} # Use this if your Azure deployment supports it
    )
  File "C:\Users\zigam\AppData\Local\Programs\Python\Python313\Lib\site-packages\openai\_utils\_utils.py", line 287, in wrapper
    return func(*args, **kwargs)
  File "C:\Users\zigam\AppData\Local\Programs\Python\Python313\Lib\site-packages\openai\resources\chat\completions\completions.py", line 925, in create
    return self._post(
           ~~~~~~~~~~^
        "/chat/completions",
        ^^^^^^^^^^^^^^^^^^^^
    ...<43 lines>...
        stream_cls=Stream[ChatCompletionChunk],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\zigam\AppData\Local\Programs\Python\Python313\Lib\site-packages\openai\_base_client.py", line 1239, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\AppData\Local\Programs\Python\Python313\Lib\site-packages\openai\_base_client.py", line 1034, in request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'code': '401', 'message': 'Access denied due to invalid subscription key or wrong API endpoint. Make sure to provide a valid key for an active subscription and use a correct regional API endpoint for your resource.'}}
2025-06-19 16:25:15,764 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "❌ AI processing temporarily unavailable. Please try again.\n\nPlease try rephrasing your order or type 'menu' to return to main menu."}}
2025-06-19 16:25:16,740 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjIwMTUwRjM1RTk2QzUyNzFBRAA="}]}
2025-06-19 16:25:16,742 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjIwMTUwRjM1RTk2QzUyNzFBRAA='}]}
2025-06-19 16:25:16,744 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:25:16] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:25:17,554 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:25:17] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:25:17,707 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:25:17] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:25:17,926 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:25:17] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:28:10,140 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'order_menu_categories'}
2025-06-19 16:28:10,141 - utils.session_manager - INFO - New session 2347082345056 initialized.
2025-06-19 16:28:10,154 - handlers.base_handler - INFO - Session 2347082345056 identified as guest, prompting for name and address.
2025-06-19 16:28:10,155 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'text', 'text': {'body': 'Hello Guest, welcome to Lola! 👋🏼\n\nWhat is your preferred name and address?'}}
2025-06-19 16:28:11,422 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkU1OEZDRDRDNDEyQzIzQjRBMgA="}]}
2025-06-19 16:28:11,423 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkU1OEZDRDRDNDEyQzIzQjRBMgA='}]}
2025-06-19 16:28:11,424 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:28:11] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:28:12,646 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:28:12] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:28:12,817 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:28:12] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:28:13,085 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:28:13] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:32:45,526 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-19 16:32:45,526 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 16:32:45,528 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 16:32:45,529 - services.payment_service - INFO - PaymentService initialized
2025-06-19 16:32:45,529 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 16:32:45,530 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 16:32:45,531 - services.payment_service - INFO - PaymentService initialized
2025-06-19 16:32:45,532 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-19 16:32:45,532 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-19 16:32:45,534 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-19 16:32:45,535 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-19 16:32:45,535 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 16:32:45,536 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-19 16:32:46,228 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-19 16:32:46,228 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-19 16:32:46,229 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-06-19 16:32:46,229 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 16:32:46,255 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-19 16:32:46,255 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-19 16:32:56,554 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-19 16:32:56,555 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-19 16:32:56,562 - handlers.base_handler - INFO - Session 2348055614455 recognized user 'Ziga'.
2025-06-19 16:32:56,562 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Welcome Ziga! 👋🏼\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-19 16:32:57,633 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjgzRTFCMzJBQTk5QjlDRTM2OQA="}]}
2025-06-19 16:32:57,634 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjgzRTFCMzJBQTk5QjlDRTM2OQA='}]}
2025-06-19 16:32:57,635 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:32:57] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:32:58,594 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:32:58] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:32:59,279 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:32:59] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:33:01,276 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-19 16:33:01,281 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-06-19 16:33:01,282 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-06-19 16:33:01,283 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-06-19 16:33:01,283 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-06-19 16:33:01,284 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Just send me your full order in one message! \n\nLike this: 'Two plates of jollof rice, 2 Cokes, and asun.'\n\nWant to go back again? Type ‘menu’ to return. "}}
2025-06-19 16:33:02,285 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkZCOTBCNUQ5OUUzQkYyOEQxNgA="}]}
2025-06-19 16:33:02,286 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkZCOTBCNUQ5OUUzQkYyOEQxNgA='}]}
2025-06-19 16:33:02,287 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:33:02] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:33:03,364 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:33:03] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:33:03,472 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:33:03] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:33:03,896 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:33:03] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:33:07,532 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Puff puff'}
2025-06-19 16:33:07,539 - handlers.base_handler - INFO - AIHandler: Handling message 'puff puff' in AI bulk order state for session 2348055614455. Original: 'Puff puff'
2025-06-19 16:33:09,352 - httpx - INFO - HTTP Request: POST https://benny-mc3ioz1j-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-4.1-mini/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 400 Bad Request"
2025-06-19 16:33:09,354 - services.ai_service - ERROR - Azure OpenAI API error parsing order: Error code: 400 - {'error': {'code': 'OperationNotSupported', 'message': 'The chatCompletion operation does not work with the specified model, gpt-4.1-mini. Please choose different model and try again. You can learn more about which models can be used with each operation here: https://go.microsoft.com/fwlink/?linkid=2197993.'}}
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\app\services\ai_service.py", line 196, in parse_order_with_llm
    response = self.azure_client.chat.completions.create(
        model=self.deployment_name,
    ...<6 lines>...
        # response_format={"type": "json_object"} # Use this if your Azure deployment supports it
    )
  File "C:\Users\zigam\AppData\Local\Programs\Python\Python313\Lib\site-packages\openai\_utils\_utils.py", line 287, in wrapper
    return func(*args, **kwargs)
  File "C:\Users\zigam\AppData\Local\Programs\Python\Python313\Lib\site-packages\openai\resources\chat\completions\completions.py", line 925, in create
    return self._post(
           ~~~~~~~~~~^
        "/chat/completions",
        ^^^^^^^^^^^^^^^^^^^^
    ...<43 lines>...
        stream_cls=Stream[ChatCompletionChunk],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\zigam\AppData\Local\Programs\Python\Python313\Lib\site-packages\openai\_base_client.py", line 1239, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\AppData\Local\Programs\Python\Python313\Lib\site-packages\openai\_base_client.py", line 1034, in request
    raise self._make_status_error_from_response(err.response) from None
openai.BadRequestError: Error code: 400 - {'error': {'code': 'OperationNotSupported', 'message': 'The chatCompletion operation does not work with the specified model, gpt-4.1-mini. Please choose different model and try again. You can learn more about which models can be used with each operation here: https://go.microsoft.com/fwlink/?linkid=2197993.'}}
2025-06-19 16:33:09,366 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "❌ AI processing temporarily unavailable. Please try again.\n\nPlease try rephrasing your order or type 'menu' to return to main menu."}}
2025-06-19 16:33:10,392 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjE5MDJENzg3NTdFOTREQ0QyQQA="}]}
2025-06-19 16:33:10,393 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjE5MDJENzg3NTdFOTREQ0QyQQA='}]}
2025-06-19 16:33:10,395 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:33:10] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:33:11,375 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:33:11] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:33:11,644 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:33:11] "POST /webhook HTTP/1.1" 200 -
2025-06-19 16:33:11,674 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 16:33:11] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:04:19,147 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-19 17:04:19,148 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 17:04:19,149 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 17:04:19,151 - services.payment_service - INFO - PaymentService initialized
2025-06-19 17:04:19,151 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 17:04:19,152 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 17:04:19,153 - services.payment_service - INFO - PaymentService initialized
2025-06-19 17:04:19,154 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-19 17:04:19,155 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-19 17:04:19,157 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-19 17:04:19,157 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-19 17:04:19,158 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 17:04:19,158 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-19 17:04:19,828 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-19 17:04:19,829 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-19 17:04:19,829 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-06-19 17:04:19,830 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 17:04:19,918 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-19 17:04:19,918 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-19 17:04:28,564 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-19 17:04:28,565 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-19 17:04:28,575 - handlers.base_handler - INFO - Session 2348055614455 recognized user 'Ziga'.
2025-06-19 17:04:28,576 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Welcome Ziga! 👋🏼\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-19 17:04:30,026 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQwMTlENkVBQjg0ODM4NjExMQA="}]}
2025-06-19 17:04:30,027 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQwMTlENkVBQjg0ODM4NjExMQA='}]}
2025-06-19 17:04:30,028 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:04:30] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:04:30,858 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:04:30] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:04:31,665 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:04:31] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:04:33,748 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-19 17:04:33,752 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-06-19 17:04:33,753 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-06-19 17:04:33,753 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-06-19 17:04:33,754 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-06-19 17:04:33,755 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Just send me your full order in one message! \n\nLike this: 'Two plates of jollof rice, 2 Cokes, and asun.'\n\nWant to go back again? Type ‘menu’ to return. "}}
2025-06-19 17:04:35,000 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkY1QjNCMUEwNUM1RDVBQ0I5RAA="}]}
2025-06-19 17:04:35,002 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkY1QjNCMUEwNUM1RDVBQ0I5RAA='}]}
2025-06-19 17:04:35,003 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:04:35] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:04:35,835 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:04:35] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:04:35,957 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:04:35] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:04:36,550 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:04:36] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:04:39,554 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Fried rice'}
2025-06-19 17:04:39,557 - handlers.base_handler - INFO - AIHandler: Handling message 'fried rice' in AI bulk order state for session 2348055614455. Original: 'Fried rice'
2025-06-19 17:04:41,935 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-19 17:04:41,992 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🛒 *Order Summary:*\n\n✅ 1x Fried Rice Fiesta - ₦1,400\n\n*Total: ₦1,400.00*\n\nWould you like to proceed with this order?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'confirm_ai_order', 'title': '✅ Confirm Order'}}, {'type': 'reply', 'reply': {'id': 'modify_ai_order', 'title': '✏️ Modify Order'}}, {'type': 'reply', 'reply': {'id': 'cancel_ai_order', 'title': '❌ Cancel'}}]}}}
2025-06-19 17:04:43,017 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkM3OTI5MUE1NDJEM0IyREQ3MwA="}]}
2025-06-19 17:04:43,018 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkM3OTI5MUE1NDJEM0IyREQ3MwA='}]}
2025-06-19 17:04:43,019 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:04:43] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:04:43,809 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:04:43] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:04:44,147 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:04:44] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:04:44,559 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:04:44] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:05:25,604 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'Hello'}
2025-06-19 17:05:25,604 - utils.session_manager - INFO - New session 2347082345056 initialized.
2025-06-19 17:05:25,613 - handlers.base_handler - INFO - Session 2347082345056 identified as guest, prompting for name and address.
2025-06-19 17:05:25,614 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'text', 'text': {'body': 'Hello Guest, welcome to Lola! 👋🏼\n\nWhat is your preferred name and address?'}}
2025-06-19 17:05:27,656 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjU4NzE1MjY1N0NEMDdCMDBGNQA="}]}
2025-06-19 17:05:27,657 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjU4NzE1MjY1N0NEMDdCMDBGNQA='}]}
2025-06-19 17:05:27,658 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:05:27] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:05:28,903 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:05:28] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:05:29,108 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:05:29] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:06:16,597 - handlers.webhook_handler - INFO - Processing message from 2348100187907 (User: olamak2): {'type': 'text', 'text': "It's They did not respond not they did not responded. It's someone saying they didn't went instead of of they didn't go. Take note because of public speaking."}
2025-06-19 17:06:16,598 - utils.session_manager - INFO - New session 2348100187907 initialized.
2025-06-19 17:06:16,607 - handlers.base_handler - INFO - Session 2348100187907 identified as guest, prompting for name and address.
2025-06-19 17:06:16,608 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348100187907', 'type': 'text', 'text': {'body': 'Hello Guest, welcome to Lola! 👋🏼\n\nWhat is your preferred name and address?'}}
2025-06-19 17:06:17,955 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348100187907","wa_id":"2348100187907"}],"messages":[{"id":"wamid.HBgNMjM0ODEwMDE4NzkwNxUCABEYEkY3NzJEOEE4NjY4QTM3RDYzQgA="}]}
2025-06-19 17:06:17,956 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348100187907', 'wa_id': '2348100187907'}], 'messages': [{'id': 'wamid.HBgNMjM0ODEwMDE4NzkwNxUCABEYEkY3NzJEOEE4NjY4QTM3RDYzQgA='}]}
2025-06-19 17:06:17,957 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:06:17] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:06:20,368 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:06:20] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:06:56,419 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:06:56] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:07:06,387 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'Olumayowa, Ikeja'}
2025-06-19 17:07:06,395 - handlers.message_processor - WARNING - No specific handler or state match for handler 'greeting_handler', state 'guest_info_prompt', message 'olumayowa, ikeja' for session 2347082345056. Resetting to greeting.
2025-06-19 17:07:06,396 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'text', 'text': {'body': "I'm sorry, I didn't quite understand that. Let's get back to the main menu."}}
2025-06-19 17:07:07,617 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjRGRjE1QTU5MURBMTI0QTBFRQA="}]}
2025-06-19 17:07:07,619 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Please choose from the options below:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-19 17:07:08,549 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:07:08] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:07:08,636 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjU5MkY1NkQxNzA3MzdCODk1MAA="}]}
2025-06-19 17:07:08,638 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjU5MkY1NkQxNzA3MzdCODk1MAA='}]}
2025-06-19 17:07:08,639 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:07:08] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:07:08,866 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:07:08] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:07:08,928 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:07:08] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:07:09,938 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:07:09] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:07:10,206 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:07:10] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:07:10,418 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:07:10] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:07:40,849 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'order_menu_categories'}
2025-06-19 17:07:40,858 - handlers.base_handler - INFO - GreetingHandler: Handling message 'order_menu_categories' in greeting state for session 2347082345056.
2025-06-19 17:07:40,858 - handlers.base_handler - INFO - Session 2347082345056 redirecting to menu_handler for classic menu.
2025-06-19 17:07:40,859 - handlers.message_processor - INFO - Redirecting session 2347082345056 to handler 'menu_handler' with message 'show_menu'.
2025-06-19 17:07:40,860 - handlers.base_handler - INFO - MenuHandler: Received message 'show_menu' (original: 'order_menu_categories') in menu state for session 2347082345056
2025-06-19 17:07:40,860 - handlers.base_handler - INFO - Showing menu categories for session 2347082345056
2025-06-19 17:07:40,861 - handlers.base_handler - INFO - Available categories: ['Main Dishes', 'Soups & Stews', 'Sides', 'Snacks', 'Drinks', 'Desserts', 'Specialties']
2025-06-19 17:07:40,862 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'list', 'body': {'text': '🍽️ *Our Menu*\n\nChoose a category to browse items:'}, 'action': {'button': 'Categories', 'sections': [{'title': 'Menu Categories', 'rows': [{'id': 'main dishes', 'title': 'Main Dishes'}, {'id': 'soups & stews', 'title': 'Soups & Stews'}, {'id': 'sides', 'title': 'Sides'}, {'id': 'snacks', 'title': 'Snacks'}, {'id': 'drinks', 'title': 'Drinks'}, {'id': 'desserts', 'title': 'Desserts'}, {'id': 'specialties', 'title': 'Specialties'}]}]}}}
2025-06-19 17:07:41,898 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjBBNTJERUJBOEQ4N0NEQTM1QQA="}]}
2025-06-19 17:07:41,899 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjBBNTJERUJBOEQ4N0NEQTM1QQA='}]}
2025-06-19 17:07:41,900 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:07:41] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:07:42,747 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:07:42] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:07:43,239 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:07:43] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:07:43,425 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:07:43] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:07:50,461 - handlers.webhook_handler - INFO - List reply received: id='soups & stews', title='Soups & Stews'
2025-06-19 17:07:50,462 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'soups & stews'}
2025-06-19 17:07:50,469 - handlers.base_handler - INFO - MenuHandler: Received message 'soups & stews' (original: 'soups & stews') in menu state for session 2347082345056
2025-06-19 17:07:50,470 - handlers.base_handler - INFO - Category 'Soups & Stews' selected for session 2347082345056
2025-06-19 17:07:50,471 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'list', 'body': {'text': '🍽️ *Soups & Stews*\n\nSelect an item to add to your cart:'}, 'action': {'button': 'Select Item', 'sections': [{'title': 'Soups & Stews Items', 'rows': [{'id': 'Egusi Soup', 'title': 'Egusi Soup (₦1,200)'}, {'id': 'Ogbono Soup with Uziza', 'title': 'Ogbono Soup wit (₦1,200)'}, {'id': 'Seafood Pepper Soup', 'title': 'Seafood Pepper (₦2,000)'}, {'id': 'Vegetable Soup (Edikang Ikong)', 'title': 'Vegetable Soup (₦1,500)'}, {'id': 'Bitterleaf Soup', 'title': 'Bitterleaf Soup (₦1,000)'}, {'id': 'Okra Soup with Spinach', 'title': 'Okra Soup with (₦1,300)'}, {'id': 'Afang Soup', 'title': 'Afang Soup (₦1,400)'}, {'id': 'Oha Soup', 'title': 'Oha Soup (₦1,300)'}, {'id': 'Nsala Soup (White Soup)', 'title': 'Nsala Soup (Whi (₦1,500)'}, {'id': 'Chicken Curry Stew', 'title': 'Chicken Curry S (₦1,400)'}]}]}}}
2025-06-19 17:07:51,510 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkEyOUNDRkVGQjNFMTVGNDlDNAA="}]}
2025-06-19 17:07:51,554 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkEyOUNDRkVGQjNFMTVGNDlDNAA='}]}
2025-06-19 17:07:51,556 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:07:51] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:07:52,277 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:07:52] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:07:52,639 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:07:52] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:07:52,831 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:07:52] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:07:56,244 - handlers.webhook_handler - INFO - List reply received: id='Bitterleaf Soup', title='Bitterleaf Soup (₦1,000)'
2025-06-19 17:07:56,245 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'Bitterleaf Soup'}
2025-06-19 17:07:56,254 - handlers.base_handler - INFO - MenuHandler: Handling item selection 'Bitterleaf Soup' for session 2347082345056
2025-06-19 17:07:56,254 - handlers.base_handler - INFO - Item 'Bitterleaf Soup' selected for session 2347082345056, redirecting to order handler
2025-06-19 17:07:56,254 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'text', 'text': {'body': '🛒 *Bitterleaf Soup*\nPrice: ₦1,000\n\nHow many would you like to order?\n\nPlease enter a number (e.g., 1, 2, 3...):'}}
2025-06-19 17:07:57,265 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkM3MURDQzkwMTdEQTBFMzNGQwA="}]}
2025-06-19 17:07:57,266 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkM3MURDQzkwMTdEQTBFMzNGQwA='}]}
2025-06-19 17:07:57,267 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:07:57] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:07:58,102 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:07:58] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:07:58,554 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:07:58] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:07:58,694 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:07:58] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:08:01,863 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': '2'}
2025-06-19 17:08:01,871 - handlers.order_handler - INFO - Item 'Bitterleaf Soup' added to cart for session 2347082345056. Cart: {'Bitterleaf Soup': {'item_id': 'Bitterleaf Soup', 'quantity': 2, 'price': 1000.0, 'total_price': 2000.0, 'variations': {}}}
2025-06-19 17:08:01,930 - services.lead_tracker - INFO - Cart addition tracked for 2347082345056: ₦2,000.0 (1 items)
2025-06-19 17:08:01,930 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2347082345056 - ₦2,000.00
2025-06-19 17:08:01,931 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': "🛒 *Your Cart:*\n• 2 x Bitterleaf Soup (₦1,000.0) = ₦2,000.0\n\n💰 *Total: ₦2,000.0*\n\nWhat would you like to do next?\n\nPress 'Checkout' to finalize.\nPress 'Order More' to add more items.\nOr, press 'Other Options' for cart management."}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'checkout', 'title': 'Checkout'}}, {'type': 'reply', 'reply': {'id': 'order_more', 'title': 'Order More'}}, {'type': 'reply', 'reply': {'id': 'other_actions', 'title': 'Other Options'}}]}}}
2025-06-19 17:08:02,977 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjBFRjU5MTZDQjdDMjQ2QkY4QQA="}]}
2025-06-19 17:08:02,982 - services.lead_tracker - INFO - Cart addition tracked for 2347082345056: ₦2,000.0 (1 items)
2025-06-19 17:08:02,983 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2347082345056 - ₦2,000.00
2025-06-19 17:08:02,983 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjBFRjU5MTZDQjdDMjQ2QkY4QQA='}]}
2025-06-19 17:08:02,984 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:08:02] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:08:03,866 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:08:03] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:08:04,327 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:08:04] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:08:04,467 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:08:04] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:08:10,315 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'other_actions'}
2025-06-19 17:08:10,326 - handlers.order_handler - INFO - User selected 'Other Options' for session 2347082345056.
2025-06-19 17:08:10,326 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'text', 'text': {'body': "You can:\n- Type *'remove'* to remove an item from your cart.\n- Type *'cancel'* to cancel your entire order."}}
2025-06-19 17:08:11,354 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkY1QkZCNUVGOTk2RjAyNzBBOQA="}]}
2025-06-19 17:08:11,361 - services.lead_tracker - INFO - Cart addition tracked for 2347082345056: ₦2,000.0 (1 items)
2025-06-19 17:08:11,361 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2347082345056 - ₦2,000.00
2025-06-19 17:08:11,362 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkY1QkZCNUVGOTk2RjAyNzBBOQA='}]}
2025-06-19 17:08:11,362 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:08:11] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:08:12,444 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:08:12] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:08:12,711 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:08:12] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:08:12,736 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:08:12] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:08:27,037 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'Remove'}
2025-06-19 17:08:27,046 - handlers.order_handler - INFO - User typed 'remove' for session 2347082345056.
2025-06-19 17:08:27,046 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'text', 'text': {'body': "Which item would you like to remove? Please type the *exact name* of the item from the list below:\n\n*1. Bitterleaf Soup*\n\nType 'back' to go back to the order summary."}}
2025-06-19 17:08:28,094 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjJGQTFGODY2NURCM0Y0ODY0MQA="}]}
2025-06-19 17:08:28,101 - services.lead_tracker - INFO - Cart addition tracked for 2347082345056: ₦2,000.0 (1 items)
2025-06-19 17:08:28,101 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2347082345056 - ₦2,000.00
2025-06-19 17:08:28,103 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjJGQTFGODY2NURCM0Y0ODY0MQA='}]}
2025-06-19 17:08:28,104 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:08:28] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:08:29,106 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:08:29] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:08:29,330 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:08:29] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:08:29,605 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:08:29] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:09:01,313 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': '1'}
2025-06-19 17:09:01,321 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'text', 'text': {'body': "❌ '1' is not in your cart. Please type the *exact name* of an item from the list to remove it, or 'back' to return."}}
2025-06-19 17:09:02,418 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjUwMjVGREVFNjI3QUFBRjc2RgA="}]}
2025-06-19 17:09:02,427 - services.lead_tracker - INFO - Cart addition tracked for 2347082345056: ₦2,000.0 (1 items)
2025-06-19 17:09:02,427 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2347082345056 - ₦2,000.00
2025-06-19 17:09:02,428 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjUwMjVGREVFNjI3QUFBRjc2RgA='}]}
2025-06-19 17:09:02,429 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:09:02] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:09:03,424 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:09:03] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:09:03,617 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:09:03] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:09:03,726 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:09:03] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:09:18,202 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'Bitter leaf Soup'}
2025-06-19 17:09:18,218 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'text', 'text': {'body': "❌ 'bitter leaf soup' is not in your cart. Please type the *exact name* of an item from the list to remove it, or 'back' to return."}}
2025-06-19 17:09:19,365 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjQwODgzRDFDRDVBQjY1RDgyQwA="}]}
2025-06-19 17:09:19,372 - services.lead_tracker - INFO - Cart addition tracked for 2347082345056: ₦2,000.0 (1 items)
2025-06-19 17:09:19,372 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2347082345056 - ₦2,000.00
2025-06-19 17:09:19,373 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjQwODgzRDFDRDVBQjY1RDgyQwA='}]}
2025-06-19 17:09:19,374 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:09:19] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:09:20,407 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:09:20] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:09:20,610 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:09:20] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:09:20,833 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:09:20] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:09:36,528 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'Bitterleaf Soup'}
2025-06-19 17:09:36,540 - handlers.order_handler - INFO - Item 'Bitterleaf Soup' removed from cart for session 2347082345056.
2025-06-19 17:09:36,541 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'text', 'text': {'body': "'Bitterleaf Soup' has been removed from your cart. Your cart is now empty. What would you like to do next? You can type 'menu' to see our items."}}
2025-06-19 17:09:37,590 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjVEOTI4MzAyNzkxQThCQ0ZEMAA="}]}
2025-06-19 17:09:37,600 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjVEOTI4MzAyNzkxQThCQ0ZEMAA='}]}
2025-06-19 17:09:37,601 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:09:37] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:09:38,452 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:09:38] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:09:38,816 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:09:38] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:09:38,854 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:09:38] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:09:48,183 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'Menu'}
2025-06-19 17:09:48,205 - handlers.base_handler - INFO - GreetingHandler: Handling message 'menu' in greeting state for session 2347082345056.
2025-06-19 17:09:48,208 - handlers.base_handler - WARNING - Session 2347082345056: Invalid option 'menu' in greeting state.
2025-06-19 17:09:48,213 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Invalid option. Please choose from the options below:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-19 17:09:49,236 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjMzREMxRkZDNTczMjlEODkyNAA="}]}
2025-06-19 17:09:49,238 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjMzREMxRkZDNTczMjlEODkyNAA='}]}
2025-06-19 17:09:49,239 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:09:49] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:09:50,144 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:09:50] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:09:50,409 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:09:50] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:09:50,549 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:09:50] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:09:55,456 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'order_menu_categories'}
2025-06-19 17:09:55,466 - handlers.base_handler - INFO - GreetingHandler: Handling message 'order_menu_categories' in greeting state for session 2347082345056.
2025-06-19 17:09:55,468 - handlers.base_handler - INFO - Session 2347082345056 redirecting to menu_handler for classic menu.
2025-06-19 17:09:55,468 - handlers.message_processor - INFO - Redirecting session 2347082345056 to handler 'menu_handler' with message 'show_menu'.
2025-06-19 17:09:55,469 - handlers.base_handler - INFO - MenuHandler: Received message 'show_menu' (original: 'order_menu_categories') in menu state for session 2347082345056
2025-06-19 17:09:55,469 - handlers.base_handler - INFO - Showing menu categories for session 2347082345056
2025-06-19 17:09:55,470 - handlers.base_handler - INFO - Available categories: ['Main Dishes', 'Soups & Stews', 'Sides', 'Snacks', 'Drinks', 'Desserts', 'Specialties']
2025-06-19 17:09:55,471 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'list', 'body': {'text': '🍽️ *Our Menu*\n\nChoose a category to browse items:'}, 'action': {'button': 'Categories', 'sections': [{'title': 'Menu Categories', 'rows': [{'id': 'main dishes', 'title': 'Main Dishes'}, {'id': 'soups & stews', 'title': 'Soups & Stews'}, {'id': 'sides', 'title': 'Sides'}, {'id': 'snacks', 'title': 'Snacks'}, {'id': 'drinks', 'title': 'Drinks'}, {'id': 'desserts', 'title': 'Desserts'}, {'id': 'specialties', 'title': 'Specialties'}]}]}}}
2025-06-19 17:09:56,555 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjRDNjUzQ0YyRjU0QzNDOUU3OQA="}]}
2025-06-19 17:09:56,555 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjRDNjUzQ0YyRjU0QzNDOUU3OQA='}]}
2025-06-19 17:09:56,556 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:09:56] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:09:57,293 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:09:57] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:09:57,818 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:09:57] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:09:57,976 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:09:57] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:10:04,106 - handlers.webhook_handler - INFO - List reply received: id='main dishes', title='Main Dishes'
2025-06-19 17:10:04,107 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'main dishes'}
2025-06-19 17:10:04,116 - handlers.base_handler - INFO - MenuHandler: Received message 'main dishes' (original: 'main dishes') in menu state for session 2347082345056
2025-06-19 17:10:04,117 - handlers.base_handler - INFO - Category 'Main Dishes' selected for session 2347082345056
2025-06-19 17:10:04,118 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'list', 'body': {'text': '🍽️ *Main Dishes*\n\nSelect an item to add to your cart:'}, 'action': {'button': 'Select Item', 'sections': [{'title': 'Main Dishes Items', 'rows': [{'id': 'Smoky Jollof Fiesta', 'title': 'Smoky Jollof Fi (₦1,500)'}, {'id': 'Egusi Pasta Primavera', 'title': 'Egusi Pasta Pri (₦1,800)'}, {'id': 'Grilled Tilapia with Herb Crust', 'title': 'Grilled Tilapia (₦2,000)'}, {'id': 'Pounded Yam with Vegetable Soup', 'title': 'Pounded Yam wit (₦1,700)'}, {'id': 'Fried Rice Fiesta', 'title': 'Fried Rice Fies (₦1,400)'}, {'id': 'Suya-Spiced Chicken Platter', 'title': 'Suya-Spiced Chi (₦1,600)'}, {'id': 'Banga Rice Delight', 'title': 'Banga Rice Deli (₦1,300)'}, {'id': 'Plantain Porridge with Fish', 'title': 'Plantain Porrid (₦1,500)'}, {'id': 'Amala with Gbegiri and Ewedu', 'title': 'Amala with Gbeg (₦1,600)'}, {'id': 'Spicy Beef Stir-Fry', 'title': 'Spicy Beef Stir (₦1,700)'}]}]}}}
2025-06-19 17:10:05,155 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjdCNkJBMUE1QTRDNkE0RjlCRAA="}]}
2025-06-19 17:10:05,199 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjdCNkJBMUE1QTRDNkE0RjlCRAA='}]}
2025-06-19 17:10:05,200 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:10:05] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:10:06,191 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:10:06] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:10:06,358 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:10:06] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:10:06,627 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:10:06] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:10:10,370 - handlers.webhook_handler - INFO - List reply received: id='Smoky Jollof Fiesta', title='Smoky Jollof Fi (₦1,500)'
2025-06-19 17:10:10,370 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'Smoky Jollof Fiesta'}
2025-06-19 17:10:10,381 - handlers.base_handler - INFO - MenuHandler: Handling item selection 'Smoky Jollof Fiesta' for session 2347082345056
2025-06-19 17:10:10,382 - handlers.base_handler - INFO - Item 'Smoky Jollof Fiesta' selected for session 2347082345056, redirecting to order handler
2025-06-19 17:10:10,382 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'text', 'text': {'body': '🛒 *Smoky Jollof Fiesta*\nPrice: ₦1,500\n\nHow many would you like to order?\n\nPlease enter a number (e.g., 1, 2, 3...):'}}
2025-06-19 17:10:11,426 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkU4MjJDQzhGQjYwQzg0N0ZCMgA="}]}
2025-06-19 17:10:11,427 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkU4MjJDQzhGQjYwQzg0N0ZCMgA='}]}
2025-06-19 17:10:11,428 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:10:11] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:10:12,306 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:10:12] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:10:12,658 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:10:12] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:10:12,942 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:10:12] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:10:16,188 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': '1'}
2025-06-19 17:10:16,199 - handlers.order_handler - INFO - Item 'Smoky Jollof Fiesta' added to cart for session 2347082345056. Cart: {'Smoky Jollof Fiesta': {'item_id': 'Smoky Jollof Fiesta', 'quantity': 1, 'price': 1500.0, 'total_price': 1500.0, 'variations': {}}}
2025-06-19 17:10:16,205 - services.lead_tracker - INFO - Cart addition tracked for 2347082345056: ₦1,500.0 (1 items)
2025-06-19 17:10:16,206 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2347082345056 - ₦1,500.00
2025-06-19 17:10:16,206 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': "🛒 *Your Cart:*\n• 1 x Smoky Jollof Fiesta (₦1,500.0) = ₦1,500.0\n\n💰 *Total: ₦1,500.0*\n\nWhat would you like to do next?\n\nPress 'Checkout' to finalize.\nPress 'Order More' to add more items.\nOr, press 'Other Options' for cart management."}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'checkout', 'title': 'Checkout'}}, {'type': 'reply', 'reply': {'id': 'order_more', 'title': 'Order More'}}, {'type': 'reply', 'reply': {'id': 'other_actions', 'title': 'Other Options'}}]}}}
2025-06-19 17:10:17,343 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjlCQjE4OTU4MTlBRTg5QTg1MgA="}]}
2025-06-19 17:10:17,351 - services.lead_tracker - INFO - Cart addition tracked for 2347082345056: ₦1,500.0 (1 items)
2025-06-19 17:10:17,352 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2347082345056 - ₦1,500.00
2025-06-19 17:10:17,352 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjlCQjE4OTU4MTlBRTg5QTg1MgA='}]}
2025-06-19 17:10:17,353 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:10:17] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:10:18,130 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:10:18] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:10:18,566 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:10:18] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:10:18,776 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:10:18] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:10:23,853 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'order_more'}
2025-06-19 17:10:23,863 - handlers.order_handler - INFO - User selected 'Order More' for session 2347082345056.
2025-06-19 17:10:23,864 - handlers.message_processor - INFO - Redirecting session 2347082345056 to handler 'menu_handler' with message 'show_menu'.
2025-06-19 17:10:23,865 - handlers.message_processor - WARNING - Unhandled order_handler state 'menu' for session 2347082345056
2025-06-19 17:10:23,865 - handlers.message_processor - WARNING - No specific handler or state match for handler 'order_handler', state 'menu', message 'show_menu' for session 2347082345056. Resetting to greeting.
2025-06-19 17:10:23,866 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'text', 'text': {'body': "I'm sorry, I didn't quite understand that. Let's get back to the main menu."}}
2025-06-19 17:10:24,924 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjg0MDM2NzhEMENCODc2QTNCRgA="}]}
2025-06-19 17:10:24,925 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Please choose from the options below:'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-19 17:10:25,704 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:10:25] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:10:26,023 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjlEMUY0QzNFQzZGMUZDQUNCRgA="}]}
2025-06-19 17:10:26,031 - services.lead_tracker - INFO - Cart addition tracked for 2347082345056: ₦1,500.0 (1 items)
2025-06-19 17:10:26,031 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2347082345056 - ₦1,500.00
2025-06-19 17:10:26,032 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjlEMUY0QzNFQzZGMUZDQUNCRgA='}]}
2025-06-19 17:10:26,033 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:10:26] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:10:26,477 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:10:26] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:10:26,586 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:10:26] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:10:27,209 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:10:27] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:10:27,542 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:10:27] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:10:27,884 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:10:27] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:10:30,255 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'order_menu_categories'}
2025-06-19 17:10:30,263 - handlers.base_handler - INFO - GreetingHandler: Handling message 'order_menu_categories' in greeting state for session 2347082345056.
2025-06-19 17:10:30,263 - handlers.base_handler - INFO - Session 2347082345056 redirecting to menu_handler for classic menu.
2025-06-19 17:10:30,263 - handlers.message_processor - INFO - Redirecting session 2347082345056 to handler 'menu_handler' with message 'show_menu'.
2025-06-19 17:10:30,264 - handlers.base_handler - INFO - MenuHandler: Received message 'show_menu' (original: 'order_menu_categories') in menu state for session 2347082345056
2025-06-19 17:10:30,264 - handlers.base_handler - INFO - Showing menu categories for session 2347082345056
2025-06-19 17:10:30,265 - handlers.base_handler - INFO - Available categories: ['Main Dishes', 'Soups & Stews', 'Sides', 'Snacks', 'Drinks', 'Desserts', 'Specialties']
2025-06-19 17:10:30,265 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'list', 'body': {'text': '🍽️ *Our Menu*\n\nChoose a category to browse items:'}, 'action': {'button': 'Categories', 'sections': [{'title': 'Menu Categories', 'rows': [{'id': 'main dishes', 'title': 'Main Dishes'}, {'id': 'soups & stews', 'title': 'Soups & Stews'}, {'id': 'sides', 'title': 'Sides'}, {'id': 'snacks', 'title': 'Snacks'}, {'id': 'drinks', 'title': 'Drinks'}, {'id': 'desserts', 'title': 'Desserts'}, {'id': 'specialties', 'title': 'Specialties'}]}]}}}
2025-06-19 17:10:31,333 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjdDNUMzQUVFRkQwRkU4NDhBNwA="}]}
2025-06-19 17:10:31,343 - services.lead_tracker - INFO - Cart addition tracked for 2347082345056: ₦1,500.0 (1 items)
2025-06-19 17:10:31,344 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2347082345056 - ₦1,500.00
2025-06-19 17:10:31,344 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjdDNUMzQUVFRkQwRkU4NDhBNwA='}]}
2025-06-19 17:10:31,345 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:10:31] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:10:32,104 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:10:32] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:10:32,686 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:10:32] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:10:32,816 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:10:32] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:10:38,919 - handlers.webhook_handler - INFO - List reply received: id='main dishes', title='Main Dishes'
2025-06-19 17:10:38,919 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'main dishes'}
2025-06-19 17:10:38,928 - handlers.base_handler - INFO - MenuHandler: Received message 'main dishes' (original: 'main dishes') in menu state for session 2347082345056
2025-06-19 17:10:38,929 - handlers.base_handler - INFO - Category 'Main Dishes' selected for session 2347082345056
2025-06-19 17:10:38,930 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'list', 'body': {'text': '🍽️ *Main Dishes*\n\nSelect an item to add to your cart:'}, 'action': {'button': 'Select Item', 'sections': [{'title': 'Main Dishes Items', 'rows': [{'id': 'Smoky Jollof Fiesta', 'title': 'Smoky Jollof Fi (₦1,500)'}, {'id': 'Egusi Pasta Primavera', 'title': 'Egusi Pasta Pri (₦1,800)'}, {'id': 'Grilled Tilapia with Herb Crust', 'title': 'Grilled Tilapia (₦2,000)'}, {'id': 'Pounded Yam with Vegetable Soup', 'title': 'Pounded Yam wit (₦1,700)'}, {'id': 'Fried Rice Fiesta', 'title': 'Fried Rice Fies (₦1,400)'}, {'id': 'Suya-Spiced Chicken Platter', 'title': 'Suya-Spiced Chi (₦1,600)'}, {'id': 'Banga Rice Delight', 'title': 'Banga Rice Deli (₦1,300)'}, {'id': 'Plantain Porridge with Fish', 'title': 'Plantain Porrid (₦1,500)'}, {'id': 'Amala with Gbegiri and Ewedu', 'title': 'Amala with Gbeg (₦1,600)'}, {'id': 'Spicy Beef Stir-Fry', 'title': 'Spicy Beef Stir (₦1,700)'}]}]}}}
2025-06-19 17:10:40,037 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjM4ODk3RUQ5MDUyNTM4MDIxQwA="}]}
2025-06-19 17:10:40,046 - services.lead_tracker - INFO - Cart addition tracked for 2347082345056: ₦1,500.0 (1 items)
2025-06-19 17:10:40,046 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2347082345056 - ₦1,500.00
2025-06-19 17:10:40,047 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjM4ODk3RUQ5MDUyNTM4MDIxQwA='}]}
2025-06-19 17:10:40,051 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:10:40] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:10:41,060 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:10:41] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:10:41,189 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:10:41] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:10:41,256 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:10:41] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:10:45,198 - handlers.webhook_handler - INFO - List reply received: id='Suya-Spiced Chicken Platter', title='Suya-Spiced Chi (₦1,600)'
2025-06-19 17:10:45,199 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'Suya-Spiced Chicken Platter'}
2025-06-19 17:10:45,210 - handlers.base_handler - INFO - MenuHandler: Handling item selection 'Suya-Spiced Chicken Platter' for session 2347082345056
2025-06-19 17:10:45,211 - handlers.base_handler - INFO - Item 'Suya-Spiced Chicken Platter' selected for session 2347082345056, redirecting to order handler
2025-06-19 17:10:45,211 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'text', 'text': {'body': '🛒 *Suya-Spiced Chicken Platter*\nPrice: ₦1,600\n\nHow many would you like to order?\n\nPlease enter a number (e.g., 1, 2, 3...):'}}
2025-06-19 17:10:46,219 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjMxMTkyOUM5NzgyMERBREI5QwA="}]}
2025-06-19 17:10:46,231 - services.lead_tracker - INFO - Cart addition tracked for 2347082345056: ₦1,500.0 (1 items)
2025-06-19 17:10:46,232 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2347082345056 - ₦1,500.00
2025-06-19 17:10:46,232 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjMxMTkyOUM5NzgyMERBREI5QwA='}]}
2025-06-19 17:10:46,233 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:10:46] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:10:47,125 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:10:47] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:10:47,470 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:10:47] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:10:47,763 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:10:47] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:10:52,453 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': '1'}
2025-06-19 17:10:52,465 - handlers.order_handler - INFO - Item 'Suya-Spiced Chicken Platter' added to cart for session 2347082345056. Cart: {'Smoky Jollof Fiesta': {'item_id': 'Smoky Jollof Fiesta', 'quantity': 1, 'price': 1500.0, 'total_price': 1500.0, 'variations': {}}, 'Suya-Spiced Chicken Platter': {'item_id': 'Suya-Spiced Chicken Platter', 'quantity': 1, 'price': 1600.0, 'total_price': 1600.0, 'variations': {}}}
2025-06-19 17:10:52,472 - services.lead_tracker - INFO - Cart addition tracked for 2347082345056: ₦3,100.0 (2 items)
2025-06-19 17:10:52,472 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2347082345056 - ₦3,100.00
2025-06-19 17:10:52,473 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': "🛒 *Your Cart:*\n• 1 x Smoky Jollof Fiesta (₦1,500.0) = ₦1,500.0\n• 1 x Suya-Spiced Chicken Platter (₦1,600.0) = ₦1,600.0\n\n💰 *Total: ₦3,100.0*\n\nWhat would you like to do next?\n\nPress 'Checkout' to finalize.\nPress 'Order More' to add more items.\nOr, press 'Other Options' for cart management."}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'checkout', 'title': 'Checkout'}}, {'type': 'reply', 'reply': {'id': 'order_more', 'title': 'Order More'}}, {'type': 'reply', 'reply': {'id': 'other_actions', 'title': 'Other Options'}}]}}}
2025-06-19 17:10:53,586 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkQ0M0E3RjQ4QUVEQjE1NUZDNgA="}]}
2025-06-19 17:10:53,591 - services.lead_tracker - INFO - Cart addition tracked for 2347082345056: ₦3,100.0 (2 items)
2025-06-19 17:10:53,591 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2347082345056 - ₦3,100.00
2025-06-19 17:10:53,592 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkQ0M0E3RjQ4QUVEQjE1NUZDNgA='}]}
2025-06-19 17:10:53,594 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:10:53] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:10:54,386 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:10:54] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:10:54,907 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:10:54] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:10:55,029 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:10:55] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:10:59,421 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'checkout'}
2025-06-19 17:10:59,432 - handlers.order_handler - INFO - User selected 'Checkout' for session 2347082345056.
2025-06-19 17:10:59,432 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '📋 **Confirm Delivery Details:**\n\n👤 **Name:** Olumayowa Oyaleke\n📱 **Phone:** 2347082345056\n📍 **Address:** None\n\nIs this information correct?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'details_correct', 'title': '✅ Correct'}}, {'type': 'reply', 'reply': {'id': 'change_all_details', 'title': '✏️ Change Details'}}]}}}
2025-06-19 17:11:00,503 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjI1Q0Q4NjMwOUNCOTk5OEVEMwA="}]}
2025-06-19 17:11:00,514 - services.lead_tracker - INFO - Cart addition tracked for 2347082345056: ₦3,100.0 (2 items)
2025-06-19 17:11:00,514 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2347082345056 - ₦3,100.00
2025-06-19 17:11:00,515 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjI1Q0Q4NjMwOUNCOTk5OEVEMwA='}]}
2025-06-19 17:11:00,516 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:11:00] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:11:01,508 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:11:01] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:11:01,790 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:11:01] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:11:01,995 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:11:01] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:11:09,448 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'change_all_details'}
2025-06-19 17:11:09,455 - handlers.order_handler - INFO - User opted to change details for session 2347082345056.
2025-06-19 17:11:09,455 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'text', 'text': {'body': 'Please provide your new name and delivery address (e.g., John Doe, 123 Main St).'}}
2025-06-19 17:11:10,504 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkUzQUMxOUNEODkxMkY1MjE0NAA="}]}
2025-06-19 17:11:10,510 - services.lead_tracker - INFO - Cart addition tracked for 2347082345056: ₦3,100.0 (2 items)
2025-06-19 17:11:10,511 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2347082345056 - ₦3,100.00
2025-06-19 17:11:10,511 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkUzQUMxOUNEODkxMkY1MjE0NAA='}]}
2025-06-19 17:11:10,512 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:11:10] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:11:11,395 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:11:11] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:11:11,896 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:11:11] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:11:11,957 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:11:11] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:11:38,513 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'Mayowa, Ikeja'}
2025-06-19 17:11:38,525 - handlers.order_handler - INFO - Updated details for session 2347082345056: Name=mayowa, Address=ikeja
2025-06-19 17:11:38,525 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '📋 **Updated Delivery Details:**\n\n👤 **Name:** mayowa\n📱 **Phone:** 2347082345056\n📍 **Address:** ikeja\n\nIs this information correct?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'details_correct', 'title': '✅ Correct'}}, {'type': 'reply', 'reply': {'id': 'change_all_details', 'title': '✏️ Change Again'}}]}}}
2025-06-19 17:11:39,537 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkUyMDI4MDU1NTAxQzU1QTdFRQA="}]}
2025-06-19 17:11:39,545 - services.lead_tracker - INFO - Cart addition tracked for 2347082345056: ₦3,100.0 (2 items)
2025-06-19 17:11:39,545 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2347082345056 - ₦3,100.00
2025-06-19 17:11:39,546 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkUyMDI4MDU1NTAxQzU1QTdFRQA='}]}
2025-06-19 17:11:39,547 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:11:39] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:11:40,506 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:11:40] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:11:40,798 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:11:40] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:11:40,828 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:11:40] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:11:42,674 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'cancel_ai_order'}
2025-06-19 17:11:42,678 - handlers.base_handler - INFO - User cancelled AI order for session 2348055614455.
2025-06-19 17:11:42,678 - handlers.base_handler - INFO - Session 2348055614455 returned to main menu (greeting state).
2025-06-19 17:11:42,679 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Order cancelled. How can I help you?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-19 17:11:43,573 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjg2QjY2NzY5QUQzNDVCNTJDNgA="}]}
2025-06-19 17:11:43,574 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjg2QjY2NzY5QUQzNDVCNTJDNgA='}]}
2025-06-19 17:11:43,575 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:11:43] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:11:44,474 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:11:44] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:11:44,812 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:11:44] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:11:45,435 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'details_correct'}
2025-06-19 17:11:45,441 - handlers.order_handler - INFO - User confirmed details are correct for session 2347082345056.
2025-06-19 17:11:45,442 - handlers.order_handler - INFO - Address set, proceeding to confirm order for manual session 2347082345056.
2025-06-19 17:11:45,443 - handlers.order_handler - INFO - Showing final order confirmation for session 2347082345056. Total: ₦3,100.00
2025-06-19 17:11:45,443 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🛒 *Final Order Confirmation*\n\n📋 *Items Ordered:*\n• 1x Smoky Jollof Fiesta - ₦1,500.00\n• 1x Suya-Spiced Chicken Platter - ₦1,600.00\n\n📍 *Delivery Details:*\n👤 Name: mayowa\n📱 Phone: 2347082345056\n🏠 Address: ikeja\n\n💰 *Total Amount: ₦3,100.00*\n\nPlease confirm to proceed with payment.'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'final_confirm', 'title': '✅ Confirm & Pay'}}, {'type': 'reply', 'reply': {'id': 'edit_order', 'title': '✏️ Edit Order'}}, {'type': 'reply', 'reply': {'id': 'cancel_order', 'title': '❌ Cancel Order'}}]}}}
2025-06-19 17:11:46,569 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjkyQUFCMUU5MTg2M0UxQ0M4MAA="}]}
2025-06-19 17:11:46,575 - services.lead_tracker - INFO - Cart addition tracked for 2347082345056: ₦3,100.0 (2 items)
2025-06-19 17:11:46,576 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2347082345056 - ₦3,100.00
2025-06-19 17:11:46,577 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjkyQUFCMUU5MTg2M0UxQ0M4MAA='}]}
2025-06-19 17:11:46,578 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:11:46] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:11:47,606 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:11:47] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:11:47,914 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:11:47] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:11:48,033 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:11:48] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:11:52,249 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'final_confirm'}
2025-06-19 17:11:52,254 - handlers.order_handler - INFO - Order ORDER_20250619_171152_49642986 confirmed for session 2347082345056. Amount: ₦3,100.00
2025-06-19 17:11:52,262 - services.lead_tracker - INFO - Order completion tracked for 2347082345056: ORDER_20250619_171152_49642986 (₦3,100.0)
2025-06-19 17:11:52,263 - handlers.lead_tracking_handler - INFO - 💰 Conversion tracked: 2347082345056 - ORDER_20250619_171152_49642986 (₦3,100.0)
2025-06-19 17:11:52,263 - handlers.message_processor - INFO - Redirecting session 2347082345056 to handler 'payment_handler' with message 'initiate_payment'.
2025-06-19 17:11:52,264 - handlers.base_handler - INFO - Handling payment processing for session 2347082345056, message: initiate_payment
2025-06-19 17:11:52,264 - handlers.base_handler - INFO - Creating payment link for session 2347082345056
2025-06-19 17:11:52,296 - utils.data_manager - INFO - Data saved to data\orders.json
2025-06-19 17:11:52,296 - utils.data_manager - INFO - Order details saved to data\orders.json
2025-06-19 17:11:52,297 - services.payment_service - INFO - Attempting to create payment link for reference: PAY-ORDER-20250619171152-2313 with amount: 310000.0, email: mayowa5056@foodorder.com
2025-06-19 17:11:53,085 - services.payment_service - INFO - Payment link created for mayowa mayowa (2347082345056), URL: https://checkout.paystack.com/bctreombit6whdy
2025-06-19 17:11:53,086 - handlers.base_handler - INFO - Starting payment monitoring for order ORDER-20250619171152-2313, reference PAY-ORDER-20250619171152-2313
2025-06-19 17:11:53,087 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-ORDER-20250619171152-2313
2025-06-19 17:11:53,607 - services.payment_service - WARNING - Payment not successful for reference PAY-ORDER-20250619171152-2313. Paystack status: abandoned. Response: {'status': True, 'message': 'Verification successful', 'data': {'id': 5071338732, 'domain': 'test', 'status': 'abandoned', 'reference': 'PAY-ORDER-20250619171152-2313', 'receipt_number': None, 'amount': 310000, 'message': None, 'gateway_response': 'The transaction was not completed', 'paid_at': None, 'created_at': '2025-06-19T16:11:53.000Z', 'channel': 'card', 'currency': 'NGN', 'ip_address': '102.67.12.153, 141.101.98.238, 172.31.62.52', 'metadata': {'customer_name': 'mayowa', 'customer_phone': '2347082345056', 'first_name': 'mayowa', 'last_name': 'mayowa', 'order_id': 'ORDER-20250619171152-2313', 'delivery_address': 'ikeja'}, 'log': None, 'fees': None, 'fees_split': None, 'authorization': {}, 'customer': {'id': 285985729, 'first_name': None, 'last_name': None, 'email': 'mayowa5056@foodorder.com', 'customer_code': 'CUS_p8i3ey5iezg8d0o', 'phone': None, 'metadata': None, 'risk_action': 'default', 'international_format_phone': None}, 'plan': None, 'split': {}, 'order_id': None, 'paidAt': None, 'createdAt': '2025-06-19T16:11:53.000Z', 'requested_amount': 310000, 'pos_transaction_data': None, 'source': None, 'fees_breakdown': None, 'connect': None, 'transaction_date': '2025-06-19T16:11:53.000Z', 'plan_object': {}, 'subaccount': {}}}
2025-06-19 17:11:53,609 - handlers.base_handler - INFO - Payment not yet verified for order ORDER-20250619171152-2313, attempt 1/15
2025-06-19 17:11:53,610 - handlers.base_handler - INFO - Payment link created successfully for order ORDER-20250619171152-2313
2025-06-19 17:11:53,611 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'text', 'text': {'body': "🛒 *Order Created Successfully!*\n\n📋 *Order ID:* ORDER-20250619171152-2313\n💰 *Total:* ₦3,100.0\n\n💳 *Complete Payment:*\nhttps://checkout.paystack.com/bctreombit6whdy\n\n✅ We'll automatically confirm your order once payment is received!\n💬 You can also send 'paid' after payment to check status immediately.\n\n⏰ Payment link expires in 15 minutes."}}
2025-06-19 17:11:54,853 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjREMDMyRTVFMTVGNzVBNTcwRAA="}]}
2025-06-19 17:11:54,860 - services.lead_tracker - INFO - Cart addition tracked for 2347082345056: ₦3,100.0 (2 items)
2025-06-19 17:11:54,860 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2347082345056 - ₦3,100.00
2025-06-19 17:11:54,861 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjREMDMyRTVFMTVGNzVBNTcwRAA='}]}
2025-06-19 17:11:54,862 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:11:54] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:11:55,675 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:11:55] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:11:56,201 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:11:56] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:11:56,485 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:11:56] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:12:48,684 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'Paid'}
2025-06-19 17:12:48,689 - handlers.base_handler - INFO - Received 'paid' command for session 2347082345056, attempting manual verification for ref: PAY-ORDER-20250619171152-2313
2025-06-19 17:12:48,690 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-ORDER-20250619171152-2313
2025-06-19 17:12:49,252 - services.payment_service - INFO - Payment verified successfully for reference PAY-ORDER-20250619171152-2313. Status: success
2025-06-19 17:12:49,259 - handlers.base_handler - INFO - Manual payment verification successful for order ORDER-20250619171152-2313
2025-06-19 17:12:49,259 - handlers.base_handler - INFO - Payment monitoring stopped for session 2347082345056
2025-06-19 17:12:49,299 - utils.data_manager - INFO - Data saved to data\orders.json
2025-06-19 17:12:49,300 - utils.data_manager - INFO - Order details saved to data\orders.json
2025-06-19 17:12:49,308 - services.lead_tracker - INFO - Order completion tracked for 2347082345056: ORDER-20250619171152-2313 (₦3,100.0)
2025-06-19 17:12:49,309 - handlers.lead_tracking_handler - INFO - 💰 Conversion tracked: 2347082345056 - ORDER-20250619171152-2313 (₦3,100.0)
2025-06-19 17:12:49,310 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'text', 'text': {'body': "🎉 *Payment Confirmed!*\n\n📋 *Order ID:* ORDER-20250619171152-2313\n💰 *Amount Paid:* ₦3,100\n🛒 *Items:* 🛒 *Your Cart:*\n• 1 x Smoky Jollof Fiesta (₦1,500.0) = ₦1,500.0\n• 1 x Suya-Spiced Chicken Platter (₦1,600.0) = ₦1,600.0\n\n💰 *Total: ₦3,100.0*\n🚚 *Delivery to:* ikeja\n\n✅ Your order is confirmed and being processed!\n📱 You'll receive delivery updates soon.\n\n🙏 Thank you for your purchase! 😊"}}
2025-06-19 17:12:50,412 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkJDNjFERUEzRjc3Mjg3QjFBRgA="}]}
2025-06-19 17:12:50,414 - handlers.feedback_handler - INFO - Initiated feedback collection for order ORDER-20250619171152-2313, session 2347082345056
2025-06-19 17:12:50,415 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🎉 *Thank you for your order!*\n\n📋 Order ID: ORDER-20250619171152-2313\n\n💬 *How was your ordering experience?*\nYour feedback helps us improve our service!'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'excellent', 'title': '🤩 Excellent'}}, {'type': 'reply', 'reply': {'id': 'good', 'title': '😊 Good'}}, {'type': 'reply', 'reply': {'id': 'bad', 'title': '😞 Bad'}}]}}}
2025-06-19 17:12:51,465 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjAzMkVDMTlGMEQ2OTlBQ0QzQwA="}]}
2025-06-19 17:12:51,466 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'message': 'Payment confirmed and feedback initiated'}
2025-06-19 17:12:51,467 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:12:51] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:12:51,623 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:12:51] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:12:51,776 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:12:51] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:12:51,866 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:12:51] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:12:52,557 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:12:52] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:12:53,005 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:12:53] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:12:53,238 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:12:53] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:13:30,907 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'excellent'}
2025-06-19 17:13:30,911 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'text', 'text': {'body': "🤩 *Thank you for the excellent rating!*\n\n💬 Would you like to share any specific comments about your experience?\n\nType your message or 'skip' to finish."}}
2025-06-19 17:13:31,982 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjIzNTk0NzY0M0I3QkYxQUYxMwA="}]}
2025-06-19 17:13:31,983 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjIzNTk0NzY0M0I3QkYxQUYxMwA='}]}
2025-06-19 17:13:31,984 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:13:31] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:13:32,916 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:13:32] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:13:33,395 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:13:33] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:13:33,435 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:13:33] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:13:57,774 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'Order more button not working'}
2025-06-19 17:13:57,832 - handlers.feedback_handler - INFO - Feedback saved to data/feedback.json
2025-06-19 17:13:57,833 - handlers.feedback_handler - INFO - Feedback saved for order ORDER-20250619171152-2313: excellent
2025-06-19 17:13:57,834 - utils.session_manager - INFO - Full session 2347082345056 cleared.
2025-06-19 17:13:57,834 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'text', 'text': {'body': '🙏 *Thank you for your Excellent feedback!*\n\n'}}
2025-06-19 17:13:58,928 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjQ4QTYzN0ZEREE3MDIzNEFCRQA="}]}
2025-06-19 17:13:58,929 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjQ4QTYzN0ZEREE3MDIzNEFCRQA='}]}
2025-06-19 17:13:58,930 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:13:58] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:13:59,808 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:13:59] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:14:00,378 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:14:00] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:14:00,507 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:14:00] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:16:48,864 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'Hello'}
2025-06-19 17:16:48,865 - utils.session_manager - INFO - New session 2347082345056 initialized.
2025-06-19 17:16:48,874 - handlers.webhook_handler - ERROR - Error processing webhook: 'DataManager' object has no attribute 'save_user_details'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\app\handlers\webhook_handler.py", line 80, in handle_webhook
    response_payload = self.message_processor.process_message(message_data, phone_number, user_name)
  File "C:\Users\zigam\Documents\Lola\app\handlers\message_processor.py", line 98, in process_message
    self._update_user_info(state, session_id, user_name)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Lola\app\handlers\message_processor.py", line 161, in _update_user_info
    self.data_manager.save_user_details()
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'DataManager' object has no attribute 'save_user_details'. Did you mean: 'load_user_details'?
2025-06-19 17:16:48,878 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:16:48] "[35m[1mPOST /webhook HTTP/1.1[0m" 500 -
2025-06-19 17:16:49,681 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'Hello'}
2025-06-19 17:16:49,687 - handlers.base_handler - INFO - Session 2347082345056 recognized user 'Olumayowa Oyaleke'.
2025-06-19 17:16:49,688 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Welcome Olumayowa Oyaleke! 👋🏼\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-19 17:16:50,732 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjA2Q0Y3MjcxMEY4NkExMDJFNQA="}]}
2025-06-19 17:16:50,733 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjA2Q0Y3MjcxMEY4NkExMDJFNQA='}]}
2025-06-19 17:16:50,734 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:16:50] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:16:51,887 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:16:51] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:16:52,002 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:16:52] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:16:52,164 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:16:52] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:16:54,225 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-19 17:16:54,231 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2347082345056.
2025-06-19 17:16:54,232 - handlers.base_handler - INFO - Session 2347082345056 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-06-19 17:16:54,233 - handlers.message_processor - INFO - Redirecting session 2347082345056 to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-06-19 17:16:54,233 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2347082345056. Original: 'ai_bulk_order_direct'
2025-06-19 17:16:54,234 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'text', 'text': {'body': "Just send me your full order in one message! \n\nLike this: 'Two plates of jollof rice, 2 Cokes, and asun.'\n\nWant to go back again? Type ‘menu’ to return. "}}
2025-06-19 17:16:55,568 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjU4RDU1MTlCNUYzODk5NkNCNQA="}]}
2025-06-19 17:16:55,606 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjU4RDU1MTlCNUYzODk5NkNCNQA='}]}
2025-06-19 17:16:55,652 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:16:55] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:16:56,326 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:16:56] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:16:56,871 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:16:56] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:16:56,987 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:16:56] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:18:06,287 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': '2 plates of jollof rice, 3 cokes, 1 fried rice, and 3 suyas'}
2025-06-19 17:18:06,292 - handlers.base_handler - INFO - AIHandler: Handling message '2 plates of jollof rice, 3 cokes, 1 fried rice, and 3 suyas' in AI bulk order state for session 2347082345056. Original: '2 plates of jollof rice, 3 cokes, 1 fried rice, and 3 suyas'
2025-06-19 17:18:09,635 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-06-19 17:18:09,637 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🛒 *Order Summary:*\n\n✅ 2x Smoky Jollof Fiesta - ₦3,000\n✅ 3x Coca-Cola (50cl) - ₦750\n✅ 1x Fried Rice Fiesta - ₦1,400\n✅ 3x Suya-Spiced Chicken Platter - ₦4,800\n\n*Total: ₦9,950.00*\n\nWould you like to proceed with this order?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'confirm_ai_order', 'title': '✅ Confirm Order'}}, {'type': 'reply', 'reply': {'id': 'modify_ai_order', 'title': '✏️ Modify Order'}}, {'type': 'reply', 'reply': {'id': 'cancel_ai_order', 'title': '❌ Cancel'}}]}}}
2025-06-19 17:18:10,681 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjM4RUJBNTYxNkM2RDkyN0U3MwA="}]}
2025-06-19 17:18:10,682 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjM4RUJBNTYxNkM2RDkyN0U3MwA='}]}
2025-06-19 17:18:10,683 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:18:10] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:18:11,785 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:18:11] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:18:12,093 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:18:12] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:18:12,162 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:18:12] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:18:36,187 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'confirm_ai_order'}
2025-06-19 17:18:36,193 - handlers.base_handler - INFO - AI order confirmed. Cart: {'Smoky Jollof Fiesta': {'item_id': 'Smoky Jollof Fiesta', 'quantity': 2, 'price': 1500, 'total_price': 3000, 'variations': {}}, 'Coca-Cola (50cl)': {'item_id': 'Coca-Cola (50cl)', 'quantity': 3, 'price': 250, 'total_price': 750, 'variations': {}}, 'Fried Rice Fiesta': {'item_id': 'Fried Rice Fiesta', 'quantity': 1, 'price': 1400, 'total_price': 1400, 'variations': {}}, 'Suya-Spiced Chicken Platter': {'item_id': 'Suya-Spiced Chicken Platter', 'quantity': 3, 'price': 1600, 'total_price': 4800, 'variations': {}}}. Redirecting to order handler.
2025-06-19 17:18:36,194 - handlers.message_processor - INFO - Redirecting session 2347082345056 to handler 'order_handler' with message 'process_final_order'.
2025-06-19 17:18:36,195 - handlers.order_handler - INFO - AI initiated order processing for session 2347082345056.
2025-06-19 17:18:36,196 - handlers.order_handler - INFO - Address set, proceeding to confirm order for AI-initiated session 2347082345056.
2025-06-19 17:18:36,197 - handlers.order_handler - INFO - Showing final order confirmation for session 2347082345056. Total: ₦9,950.00
2025-06-19 17:18:36,197 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🛒 *Final Order Confirmation*\n\n📋 *Items Ordered:*\n• 2x Smoky Jollof Fiesta - ₦3,000.00\n• 3x Coca-Cola (50cl) - ₦750.00\n• 1x Fried Rice Fiesta - ₦1,400.00\n• 3x Suya-Spiced Chicken Platter - ₦4,800.00\n\n📍 *Delivery Details:*\n👤 Name: Olumayowa Oyaleke\n📱 Phone: 2347082345056\n🏠 Address: ikeja\n\n💰 *Total Amount: ₦9,950.00*\n\nPlease confirm to proceed with payment.'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'final_confirm', 'title': '✅ Confirm & Pay'}}, {'type': 'reply', 'reply': {'id': 'edit_order', 'title': '✏️ Edit Order'}}, {'type': 'reply', 'reply': {'id': 'cancel_order', 'title': '❌ Cancel Order'}}]}}}
2025-06-19 17:18:37,293 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjcxQjNCMkJGN0ZCNTU0OEZBRQA="}]}
2025-06-19 17:18:37,300 - services.lead_tracker - INFO - Cart addition tracked for 2347082345056: ₦9,950 (4 items)
2025-06-19 17:18:37,300 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2347082345056 - ₦9,950.00
2025-06-19 17:18:37,301 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjcxQjNCMkJGN0ZCNTU0OEZBRQA='}]}
2025-06-19 17:18:37,302 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:18:37] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:18:38,063 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:18:38] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:18:38,559 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:18:38] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:18:38,565 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:18:38] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:24:42,266 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-19 17:24:42,266 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 17:24:42,267 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 17:24:42,267 - services.payment_service - INFO - PaymentService initialized
2025-06-19 17:24:42,268 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 17:24:42,268 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 17:24:42,269 - services.payment_service - INFO - PaymentService initialized
2025-06-19 17:24:42,269 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-19 17:24:42,269 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-19 17:24:42,270 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-19 17:24:42,270 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-19 17:24:42,271 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 17:24:42,271 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-19 17:24:42,770 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-19 17:24:42,771 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-19 17:24:42,771 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-06-19 17:24:42,771 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 17:24:42,791 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-19 17:24:42,791 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-19 17:24:52,287 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-19 17:24:52,288 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-19 17:24:52,312 - handlers.base_handler - INFO - Session 2348055614455 recognized user 'Ziga'.
2025-06-19 17:24:52,312 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Welcome Ziga! 👋🏼\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-19 17:24:53,461 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkJGNjMxODY1QjE3MUZFQjRDQwA="}]}
2025-06-19 17:24:53,462 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkJGNjMxODY1QjE3MUZFQjRDQwA='}]}
2025-06-19 17:24:53,463 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:24:53] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:24:54,361 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:24:54] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:24:54,641 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:24:54] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:24:54,932 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:24:54] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:24:55,744 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-19 17:24:55,746 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-06-19 17:24:55,747 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-06-19 17:24:55,747 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-06-19 17:24:55,747 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-06-19 17:24:55,748 - handlers.message_processor - ERROR - Error in message routing for handler 'ai_handler', state 'ai_bulk_order' for session 2348055614455: 'WhatsAppService' object has no attribute 'send_image_message'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\app\handlers\message_processor.py", line 190, in _route_to_handler
    response = self.ai_handler.handle_ai_bulk_order_state(state, message, original_message, session_id)
  File "C:\Users\zigam\Documents\Lola\app\handlers\ai_handler.py", line 128, in handle_ai_bulk_order_state
    return self._handle_ai_bulk_order(state, session_id)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Lola\app\handlers\ai_handler.py", line 82, in _handle_ai_bulk_order
    self.whatsapp_service.send_image_message(session_id, self.menu_image_url, caption="Our Delicious Menu!")
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WhatsAppService' object has no attribute 'send_image_message'. Did you mean: 'send_timeout_message'?
2025-06-19 17:24:55,752 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "⚠️ Something went wrong. Let's start fresh. Please try again."}}
2025-06-19 17:24:56,700 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkNBQkZFQzkxRTlGOUIwRkVBOAA="}]}
2025-06-19 17:24:56,701 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkNBQkZFQzkxRTlGOUIwRkVBOAA='}]}
2025-06-19 17:24:56,702 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:24:56] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:24:57,512 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:24:57] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:24:57,871 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:24:57] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:24:58,030 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:24:58] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:26:39,184 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-19 17:26:39,184 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 17:26:39,185 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 17:26:39,185 - services.payment_service - INFO - PaymentService initialized
2025-06-19 17:26:39,186 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 17:26:39,186 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 17:26:39,187 - services.payment_service - INFO - PaymentService initialized
2025-06-19 17:26:39,187 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-19 17:26:39,187 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-19 17:26:39,188 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-19 17:26:39,188 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-19 17:26:39,189 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 17:26:39,189 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-19 17:26:39,673 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-19 17:26:39,674 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-19 17:26:39,674 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-06-19 17:26:39,674 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 17:26:39,690 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-19 17:26:39,690 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-19 17:26:44,274 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-19 17:26:44,274 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-19 17:26:44,285 - handlers.base_handler - INFO - Session 2348055614455 recognized user 'Ziga'.
2025-06-19 17:26:44,285 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Welcome Ziga! 👋🏼\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-19 17:26:45,240 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjkyMkM3RDc3NzMyQ0NFRkEyOAA="}]}
2025-06-19 17:26:45,240 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjkyMkM3RDc3NzMyQ0NFRkEyOAA='}]}
2025-06-19 17:26:45,241 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:26:45] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:26:46,100 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:26:46] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:26:46,320 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:26:46] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:26:46,680 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:26:46] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:26:47,541 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-19 17:26:47,544 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-06-19 17:26:47,544 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-06-19 17:26:47,544 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-06-19 17:26:47,544 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-06-19 17:26:47,545 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'image', 'image': {'link': 'https://test.mackennytutors.com/wp-content/uploads/2025/06/ganador.jpg', 'caption': 'Our Delicious Menu!'}}
2025-06-19 17:26:48,578 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjlFQjcwMTJGOUMwQ0Y0NTZCMgA="}]}
2025-06-19 17:26:48,579 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Just send me your full order in one message! \n\nLike this: 'Two plates of jollof rice, 2 Cokes, and asun.'\n\nWant to go back again? Type ‘menu’ to return. "}}
2025-06-19 17:26:49,519 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjU0MjYyMEQ0QURGQjJFQzc3NwA="}]}
2025-06-19 17:26:49,519 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjU0MjYyMEQ0QURGQjJFQzc3NwA='}]}
2025-06-19 17:26:49,520 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:26:49] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:26:50,342 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:26:50] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:26:50,541 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:26:50] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:26:50,764 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:26:50] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:26:51,001 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:26:51] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:26:51,034 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:26:51] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:26:51,291 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:26:51] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:27:16,274 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'Hello'}
2025-06-19 17:27:16,275 - utils.session_manager - INFO - New session 2347082345056 initialized.
2025-06-19 17:27:16,279 - handlers.webhook_handler - ERROR - Error processing webhook: 'DataManager' object has no attribute 'save_user_details'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\app\handlers\webhook_handler.py", line 80, in handle_webhook
    response_payload = self.message_processor.process_message(message_data, phone_number, user_name)
  File "C:\Users\zigam\Documents\Lola\app\handlers\message_processor.py", line 98, in process_message
    self._update_user_info(state, session_id, user_name)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Lola\app\handlers\message_processor.py", line 161, in _update_user_info
    self.data_manager.save_user_details()
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'DataManager' object has no attribute 'save_user_details'. Did you mean: 'load_user_details'?
2025-06-19 17:27:16,285 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:27:16] "[35m[1mPOST /webhook HTTP/1.1[0m" 500 -
2025-06-19 17:27:16,911 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'Hello'}
2025-06-19 17:27:16,915 - handlers.base_handler - INFO - Session 2347082345056 recognized user 'Olumayowa Oyaleke'.
2025-06-19 17:27:16,916 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Welcome Olumayowa Oyaleke! 👋🏼\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-19 17:27:18,038 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjA2MEU1NjIyRERCODI0N0I3OAA="}]}
2025-06-19 17:27:18,039 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjA2MEU1NjIyRERCODI0N0I3OAA='}]}
2025-06-19 17:27:18,040 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:27:18] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:27:18,959 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:27:18] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:27:19,621 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:27:19] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:27:19,858 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:27:19] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:27:21,667 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-19 17:27:21,669 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2347082345056.
2025-06-19 17:27:21,670 - handlers.base_handler - INFO - Session 2347082345056 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-06-19 17:27:21,670 - handlers.message_processor - INFO - Redirecting session 2347082345056 to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-06-19 17:27:21,671 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2347082345056. Original: 'ai_bulk_order_direct'
2025-06-19 17:27:21,671 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'image', 'image': {'link': 'https://test.mackennytutors.com/wp-content/uploads/2025/06/ganador.jpg', 'caption': 'Our Delicious Menu!'}}
2025-06-19 17:27:23,058 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjE0M0E5NTdCQ0QxMDUyQTc3MwA="}]}
2025-06-19 17:27:23,059 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'text', 'text': {'body': "Just send me your full order in one message! \n\nLike this: 'Two plates of jollof rice, 2 Cokes, and asun.'\n\nWant to go back again? Type ‘menu’ to return. "}}
2025-06-19 17:27:24,169 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjlENEU3NjY3NkM3NEUyNjNBNQA="}]}
2025-06-19 17:27:24,170 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjlENEU3NjY3NkM3NEUyNjNBNQA='}]}
2025-06-19 17:27:24,171 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:27:24] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:27:25,050 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:27:25] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:27:25,431 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:27:25] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:27:25,760 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:27:25] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:27:25,812 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:27:25] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:27:25,959 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:27:25] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:27:26,190 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:27:26] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:31:38,707 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-19 17:31:38,707 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 17:31:38,708 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 17:31:38,708 - services.payment_service - INFO - PaymentService initialized
2025-06-19 17:31:38,709 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 17:31:38,709 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 17:31:38,710 - services.payment_service - INFO - PaymentService initialized
2025-06-19 17:31:38,710 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-19 17:31:38,710 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-19 17:31:38,711 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-19 17:31:38,711 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-19 17:31:38,712 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 17:31:38,712 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-19 17:31:39,204 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-19 17:31:39,204 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-19 17:31:39,204 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-06-19 17:31:39,205 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 17:31:39,220 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-19 17:31:39,220 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-19 17:31:47,078 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-19 17:31:47,078 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-19 17:31:47,088 - handlers.base_handler - INFO - Session 2348055614455 recognized user 'Ziga'.
2025-06-19 17:31:47,089 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Welcome Ziga! 👋🏼\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-19 17:31:48,138 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkQwNTFBOEVERjcyQzY3QkIzNQA="}]}
2025-06-19 17:31:48,138 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkQwNTFBOEVERjcyQzY3QkIzNQA='}]}
2025-06-19 17:31:48,139 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:31:48] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:31:48,958 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:31:48] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:31:49,069 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:31:49] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:31:49,897 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:31:49] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:31:52,664 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'order_menu_categories'}
2025-06-19 17:31:52,667 - handlers.base_handler - INFO - GreetingHandler: Handling message 'order_menu_categories' in greeting state for session 2348055614455.
2025-06-19 17:31:52,667 - handlers.base_handler - INFO - Session 2348055614455 redirecting to menu_handler for classic menu.
2025-06-19 17:31:52,668 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'menu_handler' with message 'show_menu'.
2025-06-19 17:31:52,668 - handlers.base_handler - INFO - MenuHandler: Received message 'show_menu' (original: 'order_menu_categories') in menu state for session 2348055614455
2025-06-19 17:31:52,669 - handlers.base_handler - INFO - Showing menu categories for session 2348055614455
2025-06-19 17:31:52,669 - handlers.base_handler - INFO - Available categories: ['Main Dishes', 'Soups & Stews', 'Sides', 'Snacks', 'Drinks', 'Desserts', 'Specialties']
2025-06-19 17:31:52,669 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'list', 'body': {'text': '🍽️ *Our Menu*\n\nChoose a category to browse items:'}, 'action': {'button': 'Categories', 'sections': [{'title': 'Menu Categories', 'rows': [{'id': 'main dishes', 'title': 'Main Dishes'}, {'id': 'soups & stews', 'title': 'Soups & Stews'}, {'id': 'sides', 'title': 'Sides'}, {'id': 'snacks', 'title': 'Snacks'}, {'id': 'drinks', 'title': 'Drinks'}, {'id': 'desserts', 'title': 'Desserts'}, {'id': 'specialties', 'title': 'Specialties'}]}]}}}
2025-06-19 17:31:53,618 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjA1Mjg4MTcxQjgwQ0Y1MDk3NwA="}]}
2025-06-19 17:31:53,618 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjA1Mjg4MTcxQjgwQ0Y1MDk3NwA='}]}
2025-06-19 17:31:53,619 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:31:53] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:31:54,580 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:31:54] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:31:54,790 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:31:54] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:31:55,047 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:31:55] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:31:57,850 - handlers.webhook_handler - INFO - List reply received: id='sides', title='Sides'
2025-06-19 17:31:57,850 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'sides'}
2025-06-19 17:31:57,853 - handlers.base_handler - INFO - MenuHandler: Received message 'sides' (original: 'sides') in menu state for session 2348055614455
2025-06-19 17:31:57,853 - handlers.base_handler - INFO - Category 'Sides' selected for session 2348055614455
2025-06-19 17:31:57,854 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'list', 'body': {'text': '🍽️ *Sides*\n\nSelect an item to add to your cart:'}, 'action': {'button': 'Select Item', 'sections': [{'title': 'Sides Items', 'rows': [{'id': 'Fried Plantain', 'title': 'Fried Plantain (₦500)'}, {'id': 'Yam Fries with Pepper Dip', 'title': 'Yam Fries with Pe (₦600)'}, {'id': 'Coleslaw', 'title': 'Coleslaw (₦400)'}, {'id': 'Moi Moi', 'title': 'Moi Moi (₦500)'}, {'id': 'Boiled Yam Slices', 'title': 'Boiled Yam Slices (₦400)'}, {'id': 'Vegetable Salad', 'title': 'Vegetable Salad (₦500)'}, {'id': 'Spicy Gizdodo', 'title': 'Spicy Gizdodo (₦700)'}, {'id': 'Jollof Beans', 'title': 'Jollof Beans (₦600)'}, {'id': 'Sweet Potato Wedges', 'title': 'Sweet Potato Wedg (₦500)'}, {'id': 'Garlic Bread Rolls', 'title': 'Garlic Bread Roll (₦400)'}]}]}}}
2025-06-19 17:31:58,801 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjFEQURDQkE2NzQ3OUI1NTlFMwA="}]}
2025-06-19 17:31:58,802 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjFEQURDQkE2NzQ3OUI1NTlFMwA='}]}
2025-06-19 17:31:58,802 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:31:58] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:31:59,708 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:31:59] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:31:59,958 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:31:59] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:31:59,982 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:31:59] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:32:03,074 - handlers.webhook_handler - INFO - List reply received: id='Boiled Yam Slices', title='Boiled Yam Slices (₦400)'
2025-06-19 17:32:03,074 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Boiled Yam Slices'}
2025-06-19 17:32:03,076 - handlers.base_handler - INFO - MenuHandler: Handling item selection 'Boiled Yam Slices' for session 2348055614455
2025-06-19 17:32:03,077 - handlers.base_handler - INFO - Item 'Boiled Yam Slices' selected for session 2348055614455, redirecting to order handler
2025-06-19 17:32:03,077 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': '🛒 *Boiled Yam Slices*\nPrice: ₦400\n\nHow many would you like to order?\n\nPlease enter a number (e.g., 1, 2, 3...):'}}
2025-06-19 17:32:04,058 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkY3Nzg5RkQ3NDAyQzU4NjA5NgA="}]}
2025-06-19 17:32:04,059 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkY3Nzg5RkQ3NDAyQzU4NjA5NgA='}]}
2025-06-19 17:32:04,059 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:32:04] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:32:05,080 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:32:05] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:32:05,198 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:32:05] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:32:05,408 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:32:05] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:32:08,878 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': '5'}
2025-06-19 17:32:08,880 - handlers.order_handler - INFO - Item 'Boiled Yam Slices' added to cart for session 2348055614455. Cart: {'Boiled Yam Slices': {'item_id': 'Boiled Yam Slices', 'quantity': 5, 'price': 400.0, 'total_price': 2000.0, 'variations': {}}}
2025-06-19 17:32:08,885 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦2,000.0 (1 items)
2025-06-19 17:32:08,886 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦2,000.00
2025-06-19 17:32:08,887 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': "🛒 *Your Cart:*\n• 5 x Boiled Yam Slices (₦400.0) = ₦2,000.0\n\n💰 *Total: ₦2,000.0*\n\nWhat would you like to do next?\n\nPress 'Checkout' to finalize.\nPress 'Order More' to add more items.\nOr, press 'Other Options' for cart management."}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'checkout', 'title': 'Checkout'}}, {'type': 'reply', 'reply': {'id': 'order_more', 'title': 'Order More'}}, {'type': 'reply', 'reply': {'id': 'other_actions', 'title': 'Other Options'}}]}}}
2025-06-19 17:32:09,838 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkVFQ0ZFMjU2OUQ4QzIzOTBBMgA="}]}
2025-06-19 17:32:09,842 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦2,000.0 (1 items)
2025-06-19 17:32:09,842 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦2,000.00
2025-06-19 17:32:09,842 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkVFQ0ZFMjU2OUQ4QzIzOTBBMgA='}]}
2025-06-19 17:32:09,843 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:32:09] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:32:10,560 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:32:10] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:32:10,819 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:32:10] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:32:11,362 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:32:11] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:32:13,009 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'order_more'}
2025-06-19 17:32:13,011 - handlers.order_handler - INFO - User selected 'Order More' for session 2348055614455.
2025-06-19 17:32:13,012 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'menu_handler' with message 'show_menu'.
2025-06-19 17:32:13,012 - handlers.base_handler - INFO - MenuHandler: Received message 'show_menu' (original: 'order_more') in menu state for session 2348055614455
2025-06-19 17:32:13,013 - handlers.base_handler - INFO - Showing menu categories for session 2348055614455
2025-06-19 17:32:13,013 - handlers.base_handler - INFO - Available categories: ['Main Dishes', 'Soups & Stews', 'Sides', 'Snacks', 'Drinks', 'Desserts', 'Specialties']
2025-06-19 17:32:13,014 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'list', 'body': {'text': '🍽️ *Our Menu*\n\nChoose a category to browse items:'}, 'action': {'button': 'Categories', 'sections': [{'title': 'Menu Categories', 'rows': [{'id': 'main dishes', 'title': 'Main Dishes'}, {'id': 'soups & stews', 'title': 'Soups & Stews'}, {'id': 'sides', 'title': 'Sides'}, {'id': 'snacks', 'title': 'Snacks'}, {'id': 'drinks', 'title': 'Drinks'}, {'id': 'desserts', 'title': 'Desserts'}, {'id': 'specialties', 'title': 'Specialties'}]}]}}}
2025-06-19 17:32:13,998 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjlEQUVCOUMzNDhCMkMzNUVBQgA="}]}
2025-06-19 17:32:14,001 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦2,000.0 (1 items)
2025-06-19 17:32:14,002 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦2,000.00
2025-06-19 17:32:14,002 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjlEQUVCOUMzNDhCMkMzNUVBQgA='}]}
2025-06-19 17:32:14,003 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:32:14] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:32:14,802 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:32:14] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:32:15,119 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:32:15] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:32:15,158 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:32:15] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:32:18,248 - handlers.webhook_handler - INFO - List reply received: id='main dishes', title='Main Dishes'
2025-06-19 17:32:18,248 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'main dishes'}
2025-06-19 17:32:18,250 - handlers.base_handler - INFO - MenuHandler: Received message 'main dishes' (original: 'main dishes') in menu state for session 2348055614455
2025-06-19 17:32:18,251 - handlers.base_handler - INFO - Category 'Main Dishes' selected for session 2348055614455
2025-06-19 17:32:18,252 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'list', 'body': {'text': '🍽️ *Main Dishes*\n\nSelect an item to add to your cart:'}, 'action': {'button': 'Select Item', 'sections': [{'title': 'Main Dishes Items', 'rows': [{'id': 'Smoky Jollof Fiesta', 'title': 'Smoky Jollof Fi (₦1,500)'}, {'id': 'Egusi Pasta Primavera', 'title': 'Egusi Pasta Pri (₦1,800)'}, {'id': 'Grilled Tilapia with Herb Crust', 'title': 'Grilled Tilapia (₦2,000)'}, {'id': 'Pounded Yam with Vegetable Soup', 'title': 'Pounded Yam wit (₦1,700)'}, {'id': 'Fried Rice Fiesta', 'title': 'Fried Rice Fies (₦1,400)'}, {'id': 'Suya-Spiced Chicken Platter', 'title': 'Suya-Spiced Chi (₦1,600)'}, {'id': 'Banga Rice Delight', 'title': 'Banga Rice Deli (₦1,300)'}, {'id': 'Plantain Porridge with Fish', 'title': 'Plantain Porrid (₦1,500)'}, {'id': 'Amala with Gbegiri and Ewedu', 'title': 'Amala with Gbeg (₦1,600)'}, {'id': 'Spicy Beef Stir-Fry', 'title': 'Spicy Beef Stir (₦1,700)'}]}]}}}
2025-06-19 17:32:19,397 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkExQzlFRjI5NTcwRjA3NEQzNwA="}]}
2025-06-19 17:32:19,401 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦2,000.0 (1 items)
2025-06-19 17:32:19,401 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦2,000.00
2025-06-19 17:32:19,402 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkExQzlFRjI5NTcwRjA3NEQzNwA='}]}
2025-06-19 17:32:19,402 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:32:19] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:32:20,368 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:32:20] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:32:20,370 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:32:20] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:32:20,564 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:32:20] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:32:24,498 - handlers.webhook_handler - INFO - List reply received: id='Pounded Yam with Vegetable Soup', title='Pounded Yam wit (₦1,700)'
2025-06-19 17:32:24,498 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Pounded Yam with Vegetable Soup'}
2025-06-19 17:32:24,501 - handlers.base_handler - INFO - MenuHandler: Handling item selection 'Pounded Yam with Vegetable Soup' for session 2348055614455
2025-06-19 17:32:24,501 - handlers.base_handler - INFO - Item 'Pounded Yam with Vegetable Soup' selected for session 2348055614455, redirecting to order handler
2025-06-19 17:32:24,502 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': '🛒 *Pounded Yam with Vegetable Soup*\nPrice: ₦1,700\n\nHow many would you like to order?\n\nPlease enter a number (e.g., 1, 2, 3...):'}}
2025-06-19 17:32:25,498 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjcwNjE3MTY0ODRBRUIzRjNENAA="}]}
2025-06-19 17:32:25,502 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦2,000.0 (1 items)
2025-06-19 17:32:25,502 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦2,000.00
2025-06-19 17:32:25,502 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjcwNjE3MTY0ODRBRUIzRjNENAA='}]}
2025-06-19 17:32:25,503 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:32:25] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:32:26,404 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:32:26] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:32:26,578 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:32:26] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:32:26,707 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:32:26] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:32:37,898 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': '6'}
2025-06-19 17:32:37,901 - handlers.order_handler - INFO - Item 'Pounded Yam with Vegetable Soup' added to cart for session 2348055614455. Cart: {'Boiled Yam Slices': {'item_id': 'Boiled Yam Slices', 'quantity': 5, 'price': 400.0, 'total_price': 2000.0, 'variations': {}}, 'Pounded Yam with Vegetable Soup': {'item_id': 'Pounded Yam with Vegetable Soup', 'quantity': 6, 'price': 1700.0, 'total_price': 10200.0, 'variations': {}}}
2025-06-19 17:32:37,905 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦12,200.0 (2 items)
2025-06-19 17:32:37,906 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦12,200.00
2025-06-19 17:32:37,906 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': "🛒 *Your Cart:*\n• 5 x Boiled Yam Slices (₦400.0) = ₦2,000.0\n• 6 x Pounded Yam with Vegetable Soup (₦1,700.0) = ₦10,200.0\n\n💰 *Total: ₦12,200.0*\n\nWhat would you like to do next?\n\nPress 'Checkout' to finalize.\nPress 'Order More' to add more items.\nOr, press 'Other Options' for cart management."}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'checkout', 'title': 'Checkout'}}, {'type': 'reply', 'reply': {'id': 'order_more', 'title': 'Order More'}}, {'type': 'reply', 'reply': {'id': 'other_actions', 'title': 'Other Options'}}]}}}
2025-06-19 17:32:38,897 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkUwOEYwQ0ZFRjVCOEJFODI1QwA="}]}
2025-06-19 17:32:38,902 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦12,200.0 (2 items)
2025-06-19 17:32:38,902 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦12,200.00
2025-06-19 17:32:38,902 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkUwOEYwQ0ZFRjVCOEJFODI1QwA='}]}
2025-06-19 17:32:38,903 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:32:38] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:32:39,809 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:32:39] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:32:39,928 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:32:39] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:32:40,228 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:32:40] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:32:47,206 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'checkout'}
2025-06-19 17:32:47,209 - handlers.order_handler - INFO - User selected 'Checkout' for session 2348055614455.
2025-06-19 17:32:47,210 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '📋 **Confirm Delivery Details:**\n\n👤 **Name:** Ziga\n📱 **Phone:** 2348055614455\n📍 **Address:** Howson Wright\n\nIs this information correct?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'details_correct', 'title': '✅ Correct'}}, {'type': 'reply', 'reply': {'id': 'change_all_details', 'title': '✏️ Change Details'}}]}}}
2025-06-19 17:32:48,197 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkRDNkM4RDIyMDA5M0M5RkU5NAA="}]}
2025-06-19 17:32:48,202 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦12,200.0 (2 items)
2025-06-19 17:32:48,203 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦12,200.00
2025-06-19 17:32:48,203 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkRDNkM4RDIyMDA5M0M5RkU5NAA='}]}
2025-06-19 17:32:48,204 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:32:48] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:32:49,059 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:32:49] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:32:49,190 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:32:49] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:32:49,549 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:32:49] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:32:52,848 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'details_correct'}
2025-06-19 17:32:52,850 - handlers.order_handler - INFO - User confirmed details are correct for session 2348055614455.
2025-06-19 17:32:52,851 - handlers.order_handler - INFO - Address set, proceeding to confirm order for manual session 2348055614455.
2025-06-19 17:32:52,851 - handlers.order_handler - INFO - Showing final order confirmation for session 2348055614455. Total: ₦12,200.00
2025-06-19 17:32:52,851 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🛒 *Final Order Confirmation*\n\n📋 *Items Ordered:*\n• 5x Boiled Yam Slices - ₦2,000.00\n• 6x Pounded Yam with Vegetable Soup - ₦10,200.00\n\n📍 *Delivery Details:*\n👤 Name: Ziga\n📱 Phone: 2348055614455\n🏠 Address: Howson Wright\n\n💰 *Total Amount: ₦12,200.00*\n\nPlease confirm to proceed with payment.'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'final_confirm', 'title': '✅ Confirm & Pay'}}, {'type': 'reply', 'reply': {'id': 'edit_order', 'title': '✏️ Edit Order'}}, {'type': 'reply', 'reply': {'id': 'cancel_order', 'title': '❌ Cancel Order'}}]}}}
2025-06-19 17:32:53,767 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjY2MzhERjc1MjM0RDIxQjQ0QgA="}]}
2025-06-19 17:32:53,771 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦12,200.0 (2 items)
2025-06-19 17:32:53,771 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦12,200.00
2025-06-19 17:32:53,772 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjY2MzhERjc1MjM0RDIxQjQ0QgA='}]}
2025-06-19 17:32:53,772 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:32:53] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:32:54,660 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:32:54] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:32:54,977 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:32:54] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:32:55,099 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:32:55] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:32:56,518 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'final_confirm'}
2025-06-19 17:32:56,521 - handlers.order_handler - INFO - Order ORDER_20250619_173256_89a09a22 confirmed for session 2348055614455. Amount: ₦12,200.00
2025-06-19 17:32:56,524 - services.lead_tracker - INFO - Order completion tracked for 2348055614455: ORDER_20250619_173256_89a09a22 (₦12,200.0)
2025-06-19 17:32:56,525 - handlers.lead_tracking_handler - INFO - 💰 Conversion tracked: 2348055614455 - ORDER_20250619_173256_89a09a22 (₦12,200.0)
2025-06-19 17:32:56,526 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'payment_handler' with message 'initiate_payment'.
2025-06-19 17:32:56,526 - handlers.base_handler - INFO - Handling payment processing for session 2348055614455, message: initiate_payment
2025-06-19 17:32:56,527 - handlers.base_handler - INFO - Creating payment link for session 2348055614455
2025-06-19 17:32:56,551 - utils.data_manager - INFO - Data saved to data\orders.json
2025-06-19 17:32:56,552 - utils.data_manager - INFO - Order details saved to data\orders.json
2025-06-19 17:32:56,553 - services.payment_service - INFO - Attempting to create payment link for reference: PAY-ORDER-20250619173256-2012 with amount: 1220000.0, email: ziga4455@foodorder.com
2025-06-19 17:32:57,170 - services.payment_service - INFO - Payment link created for Ziga Ziga (2348055614455), URL: https://checkout.paystack.com/34rou7b4aqpbq1v
2025-06-19 17:32:57,171 - handlers.base_handler - INFO - Starting payment monitoring for order ORDER-20250619173256-2012, reference PAY-ORDER-20250619173256-2012
2025-06-19 17:32:57,171 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-ORDER-20250619173256-2012
2025-06-19 17:32:57,768 - services.payment_service - WARNING - Payment not successful for reference PAY-ORDER-20250619173256-2012. Paystack status: abandoned. Response: {'status': True, 'message': 'Verification successful', 'data': {'id': 5071373760, 'domain': 'test', 'status': 'abandoned', 'reference': 'PAY-ORDER-20250619173256-2012', 'receipt_number': None, 'amount': 1220000, 'message': None, 'gateway_response': 'The transaction was not completed', 'paid_at': None, 'created_at': '2025-06-19T16:32:57.000Z', 'channel': 'card', 'currency': 'NGN', 'ip_address': '102.67.12.153, 172.70.91.212, 172.31.63.81', 'metadata': {'customer_name': 'Ziga', 'customer_phone': '2348055614455', 'first_name': 'Ziga', 'last_name': 'Ziga', 'order_id': 'ORDER-20250619173256-2012', 'delivery_address': 'Howson Wright'}, 'log': None, 'fees': None, 'fees_split': None, 'authorization': {}, 'customer': {'id': 276711440, 'first_name': None, 'last_name': None, 'email': 'ziga4455@foodorder.com', 'customer_code': 'CUS_bhkdpnbvcjqt55g', 'phone': None, 'metadata': None, 'risk_action': 'default', 'international_format_phone': None}, 'plan': None, 'split': {}, 'order_id': None, 'paidAt': None, 'createdAt': '2025-06-19T16:32:57.000Z', 'requested_amount': 1220000, 'pos_transaction_data': None, 'source': None, 'fees_breakdown': None, 'connect': None, 'transaction_date': '2025-06-19T16:32:57.000Z', 'plan_object': {}, 'subaccount': {}}}
2025-06-19 17:32:57,769 - handlers.base_handler - INFO - Payment not yet verified for order ORDER-20250619173256-2012, attempt 1/15
2025-06-19 17:32:57,770 - handlers.base_handler - INFO - Payment link created successfully for order ORDER-20250619173256-2012
2025-06-19 17:32:57,770 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "🛒 *Order Created Successfully!*\n\n📋 *Order ID:* ORDER-20250619173256-2012\n💰 *Total:* ₦12,200.0\n\n💳 *Complete Payment:*\nhttps://checkout.paystack.com/34rou7b4aqpbq1v\n\n✅ We'll automatically confirm your order once payment is received!\n💬 You can also send 'paid' after payment to check status immediately.\n\n⏰ Payment link expires in 15 minutes."}}
2025-06-19 17:32:59,077 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjRCQUEzNTE2Mzk4OUY2QUI1NQA="}]}
2025-06-19 17:32:59,082 - services.lead_tracker - INFO - Cart addition tracked for 2348055614455: ₦12,200.0 (2 items)
2025-06-19 17:32:59,082 - handlers.lead_tracking_handler - INFO - 🛒 Cart activity tracked: 2348055614455 - ₦12,200.00
2025-06-19 17:32:59,083 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjRCQUEzNTE2Mzk4OUY2QUI1NQA='}]}
2025-06-19 17:32:59,084 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:32:59] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:32:59,799 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:32:59] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:32:59,998 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:32:59] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:33:00,339 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:33:00] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:33:14,218 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Paid'}
2025-06-19 17:33:14,221 - handlers.base_handler - INFO - Received 'paid' command for session 2348055614455, attempting manual verification for ref: PAY-ORDER-20250619173256-2012
2025-06-19 17:33:14,221 - services.payment_service - INFO - Attempting to verify payment for reference: PAY-ORDER-20250619173256-2012
2025-06-19 17:33:14,758 - services.payment_service - INFO - Payment verified successfully for reference PAY-ORDER-20250619173256-2012. Status: success
2025-06-19 17:33:14,761 - handlers.base_handler - INFO - Manual payment verification successful for order ORDER-20250619173256-2012
2025-06-19 17:33:14,761 - handlers.base_handler - INFO - Payment monitoring stopped for session 2348055614455
2025-06-19 17:33:14,771 - utils.data_manager - INFO - Data saved to data\orders.json
2025-06-19 17:33:14,772 - utils.data_manager - INFO - Order details saved to data\orders.json
2025-06-19 17:33:14,775 - services.lead_tracker - INFO - Order completion tracked for 2348055614455: ORDER-20250619173256-2012 (₦12,200.0)
2025-06-19 17:33:14,775 - handlers.lead_tracking_handler - INFO - 💰 Conversion tracked: 2348055614455 - ORDER-20250619173256-2012 (₦12,200.0)
2025-06-19 17:33:14,776 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "🎉 *Payment Confirmed!*\n\n📋 *Order ID:* ORDER-20250619173256-2012\n💰 *Amount Paid:* ₦12,200\n🛒 *Items:* 🛒 *Your Cart:*\n• 5 x Boiled Yam Slices (₦400.0) = ₦2,000.0\n• 6 x Pounded Yam with Vegetable Soup (₦1,700.0) = ₦10,200.0\n\n💰 *Total: ₦12,200.0*\n🚚 *Delivery to:* Howson Wright\n\n✅ Your order is confirmed and being processed!\n📱 You'll receive delivery updates soon.\n\n🙏 Thank you for your purchase! 😊"}}
2025-06-19 17:33:15,819 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkExQjU2N0FFOUFCQzgyQjM5RAA="}]}
2025-06-19 17:33:15,820 - handlers.feedback_handler - INFO - Initiated feedback collection for order ORDER-20250619173256-2012, session 2348055614455
2025-06-19 17:33:15,820 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': '🎉 *Thank you for your order!*\n\n📋 Order ID: ORDER-20250619173256-2012\n\n💬 *How was your ordering experience?*\nYour feedback helps us improve our service!'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'excellent', 'title': '🤩 Excellent'}}, {'type': 'reply', 'reply': {'id': 'good', 'title': '😊 Good'}}, {'type': 'reply', 'reply': {'id': 'bad', 'title': '😞 Bad'}}]}}}
2025-06-19 17:33:16,710 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:33:16] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:33:16,806 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjdDODk3RDBEMzQxNTBCMkVCQwA="}]}
2025-06-19 17:33:16,807 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'message': 'Payment confirmed and feedback initiated'}
2025-06-19 17:33:16,808 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:33:16] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:33:16,909 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:33:16] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:33:17,151 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:33:17] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:33:17,591 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:33:17] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:33:17,783 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:33:17] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:33:18,270 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:33:18] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:33:20,004 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'excellent'}
2025-06-19 17:33:20,006 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "🤩 *Thank you for the excellent rating!*\n\n💬 Would you like to share any specific comments about your experience?\n\nType your message or 'skip' to finish."}}
2025-06-19 17:33:20,990 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjRBQkMzRjNEMkQ3MzkwNUNEMgA="}]}
2025-06-19 17:33:20,991 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjRBQkMzRjNEMkQ3MzkwNUNEMgA='}]}
2025-06-19 17:33:20,991 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:33:20] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:33:21,779 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:33:21] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:33:22,042 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:33:22] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:33:22,199 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:33:22] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:33:25,553 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Skip'}
2025-06-19 17:33:25,559 - handlers.feedback_handler - INFO - Feedback saved to data/feedback.json
2025-06-19 17:33:25,561 - handlers.feedback_handler - INFO - Feedback saved for order ORDER-20250619173256-2012: excellent
2025-06-19 17:33:25,562 - utils.session_manager - INFO - Full session 2348055614455 cleared.
2025-06-19 17:33:25,562 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': '🙏 *Thank you for your Excellent feedback!*\n\n'}}
2025-06-19 17:33:26,740 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjJCMUQ4RUEwQzE2MkFBRUYwRgA="}]}
2025-06-19 17:33:26,741 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjJCMUQ4RUEwQzE2MkFBRUYwRgA='}]}
2025-06-19 17:33:26,741 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:33:26] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:33:27,574 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:33:27] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:33:27,652 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:33:27] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:33:27,938 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:33:27] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:34:38,427 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-19 17:34:38,428 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 17:34:38,429 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 17:34:38,429 - services.payment_service - INFO - PaymentService initialized
2025-06-19 17:34:38,429 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 17:34:38,430 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 17:34:38,431 - services.payment_service - INFO - PaymentService initialized
2025-06-19 17:34:38,431 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-19 17:34:38,431 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-19 17:34:38,432 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-19 17:34:38,432 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-19 17:34:38,432 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 17:34:38,433 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-19 17:34:38,843 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-19 17:34:38,843 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-19 17:34:38,844 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-06-19 17:34:38,844 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 17:34:38,862 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-19 17:34:38,863 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-19 17:34:47,583 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-19 17:34:47,584 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-19 17:34:47,594 - handlers.base_handler - INFO - Session 2348055614455 recognized user 'Ziga'.
2025-06-19 17:34:47,594 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Welcome Ziga! 👋🏼\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-19 17:34:48,546 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjdDN0QwQUIzRjEyNjgyMzVGOAA="}]}
2025-06-19 17:34:48,547 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjdDN0QwQUIzRjEyNjgyMzVGOAA='}]}
2025-06-19 17:34:48,548 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:34:48] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:34:49,625 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:34:49] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:34:49,859 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:34:49] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:34:49,861 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:34:49] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:34:51,849 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-19 17:34:51,852 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2348055614455.
2025-06-19 17:34:51,852 - handlers.base_handler - INFO - Session 2348055614455 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-06-19 17:34:51,853 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-06-19 17:34:51,853 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2348055614455. Original: 'ai_bulk_order_direct'
2025-06-19 17:34:51,854 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'image', 'image': {'link': 'https://test.mackennytutors.com/wp-content/uploads/2025/06/ganador.jpg', 'caption': 'Our Delicious Menu!'}}
2025-06-19 17:34:52,840 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkVCNjZGMkRBN0Q4MEI3QzEyNAA="}]}
2025-06-19 17:34:52,841 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Hi, I'm Lola from Ganador \n\nTake a look at the menu and type in your order'\n\n"}}
2025-06-19 17:34:53,737 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjE0M0M3MDlBQTVBMTQ2Q0U0QwA="}]}
2025-06-19 17:34:53,738 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjE0M0M3MDlBQTVBMTQ2Q0U0QwA='}]}
2025-06-19 17:34:53,738 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:34:53] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:34:54,019 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:34:54] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:34:54,021 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:34:54] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:34:54,319 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:34:54] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:34:54,617 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:34:54] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:34:54,729 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:34:54] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:34:55,039 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:34:55] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:35:23,283 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'Hello'}
2025-06-19 17:35:23,284 - utils.session_manager - INFO - New session 2347082345056 initialized.
2025-06-19 17:35:23,290 - handlers.webhook_handler - ERROR - Error processing webhook: 'DataManager' object has no attribute 'save_user_details'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\app\handlers\webhook_handler.py", line 80, in handle_webhook
    response_payload = self.message_processor.process_message(message_data, phone_number, user_name)
  File "C:\Users\zigam\Documents\Lola\app\handlers\message_processor.py", line 98, in process_message
    self._update_user_info(state, session_id, user_name)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Lola\app\handlers\message_processor.py", line 161, in _update_user_info
    self.data_manager.save_user_details()
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'DataManager' object has no attribute 'save_user_details'. Did you mean: 'load_user_details'?
2025-06-19 17:35:23,294 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:35:23] "[35m[1mPOST /webhook HTTP/1.1[0m" 500 -
2025-06-19 17:35:23,877 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'Hello'}
2025-06-19 17:35:23,880 - handlers.base_handler - INFO - Session 2347082345056 recognized user 'Olumayowa Oyaleke'.
2025-06-19 17:35:23,881 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Welcome Olumayowa Oyaleke! 👋🏼\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-19 17:35:24,977 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjBCOUU3MTc3NDEzNDM1MjBBOQA="}]}
2025-06-19 17:35:24,978 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjBCOUU3MTc3NDEzNDM1MjBBOQA='}]}
2025-06-19 17:35:24,979 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:35:24] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:35:26,082 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:35:26] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:35:26,489 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:35:26] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:35:26,611 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:35:26] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:35:28,257 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'ai_bulk_order_direct'}
2025-06-19 17:35:28,260 - handlers.base_handler - INFO - GreetingHandler: Handling message 'ai_bulk_order_direct' in greeting state for session 2347082345056.
2025-06-19 17:35:28,261 - handlers.base_handler - INFO - Session 2347082345056 redirecting to AIHandler for AI Bulk Order (Let Lola Order).
2025-06-19 17:35:28,261 - handlers.message_processor - INFO - Redirecting session 2347082345056 to handler 'ai_handler' with message 'start_ai_bulk_order'.
2025-06-19 17:35:28,261 - handlers.base_handler - INFO - AIHandler: Handling message 'start_ai_bulk_order' in AI bulk order state for session 2347082345056. Original: 'ai_bulk_order_direct'
2025-06-19 17:35:28,262 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'image', 'image': {'link': 'https://test.mackennytutors.com/wp-content/uploads/2025/06/ganador.jpg', 'caption': 'Our Delicious Menu!'}}
2025-06-19 17:35:29,627 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkRGMjkxMDc1NkI2N0NCQzM4MgA="}]}
2025-06-19 17:35:29,628 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'text', 'text': {'body': "Hi, I'm Lola from Ganador \n\nTake a look at the menu and type in your order'\n\n"}}
2025-06-19 17:35:30,678 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjZCMjg5RTAyQzMzODE5QzQ1NgA="}]}
2025-06-19 17:35:30,679 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjZCMjg5RTAyQzMzODE5QzQ1NgA='}]}
2025-06-19 17:35:30,679 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:35:30] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:35:31,113 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:35:31] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:35:31,515 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:35:31] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:35:31,530 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:35:31] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:35:31,779 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:35:31] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:35:32,058 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:35:32] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:35:32,077 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:35:32] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:38:36,533 - root - INFO - Logging configured with UTF-8 encoding for console and file output.
2025-06-19 17:38:36,534 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 17:38:36,534 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 17:38:36,535 - services.payment_service - INFO - PaymentService initialized
2025-06-19 17:38:36,535 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=600s, Paid=6000s
2025-06-19 17:38:36,536 - utils.data_manager - INFO - Successfully loaded 1 user details from data\user_details.json
2025-06-19 17:38:36,536 - services.payment_service - INFO - PaymentService initialized
2025-06-19 17:38:36,537 - services.lead_tracker - INFO - LeadTracker initialized
2025-06-19 17:38:36,537 - handlers.lead_tracking_handler - INFO - LeadTrackingHandler initialized.
2025-06-19 17:38:36,537 - handlers.feedback_handler - INFO - FeedbackHandler initialized.
2025-06-19 17:38:36,538 - handlers.order_handler - INFO - OrderHandler initialized.
2025-06-19 17:38:36,538 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 17:38:36,538 - handlers.location_address_handler - INFO - LocationAddressHandler initialized.
2025-06-19 17:38:36,912 - services.ai_service - INFO - Azure OpenAI client initialized successfully in AIService.
2025-06-19 17:38:36,912 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized.
2025-06-19 17:38:36,912 - handlers.message_processor - INFO - MessageProcessor initialized with lead tracking, AI support, and feedback collection.
2025-06-19 17:38:36,913 - handlers.base_handler - INFO - PaymentHandler initialized with dual verification system
2025-06-19 17:38:36,926 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-06-19 17:38:36,927 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-06-19 17:38:43,975 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-06-19 17:38:43,975 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-06-19 17:38:43,985 - handlers.base_handler - INFO - Session 2348055614455 recognized user 'Ziga'.
2025-06-19 17:38:43,985 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'button', 'body': {'text': 'Welcome Ziga! 👋🏼\n\nHow can I help you today?'}, 'action': {'buttons': [{'type': 'reply', 'reply': {'id': 'order_menu_categories', 'title': '🍔 Order Menu'}}, {'type': 'reply', 'reply': {'id': 'ai_bulk_order_direct', 'title': '👩🏼\u200d🍳 Let Lola Order'}}, {'type': 'reply', 'reply': {'id': 'others_menu', 'title': '❓ Others'}}]}}}
2025-06-19 17:38:44,951 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjIzOThFRkE2NDgzODNBQzlDQgA="}]}
2025-06-19 17:38:44,952 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjIzOThFRkE2NDgzODNBQzlDQgA='}]}
2025-06-19 17:38:44,953 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:38:44] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:38:45,858 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:38:45] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:38:46,167 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:38:46] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:38:46,299 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:38:46] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:38:47,802 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'order_menu_categories'}
2025-06-19 17:38:47,805 - handlers.base_handler - INFO - GreetingHandler: Handling message 'order_menu_categories' in greeting state for session 2348055614455.
2025-06-19 17:38:47,805 - handlers.base_handler - INFO - Session 2348055614455 redirecting to menu_handler for classic menu.
2025-06-19 17:38:47,805 - handlers.message_processor - INFO - Redirecting session 2348055614455 to handler 'menu_handler' with message 'show_menu'.
2025-06-19 17:38:47,806 - handlers.base_handler - INFO - MenuHandler: Received message 'show_menu' (original: 'order_menu_categories') in menu state for session 2348055614455
2025-06-19 17:38:47,806 - handlers.base_handler - INFO - Showing menu categories for session 2348055614455
2025-06-19 17:38:47,807 - handlers.base_handler - INFO - Available categories: ['Main Dishes', 'Proteins', 'Sides']
2025-06-19 17:38:47,807 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'interactive', 'interactive': {'type': 'list', 'body': {'text': '🍽️ *Our Menu*\n\nChoose a category to browse items:'}, 'action': {'button': 'Categories', 'sections': [{'title': 'Menu Categories', 'rows': [{'id': 'main dishes', 'title': 'Main Dishes'}, {'id': 'proteins', 'title': 'Proteins'}, {'id': 'sides', 'title': 'Sides'}]}]}}}
2025-06-19 17:38:48,707 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkY1MTQzMDc4RkE3QzY5NDRFMQA="}]}
2025-06-19 17:38:48,707 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkY1MTQzMDc4RkE3QzY5NDRFMQA='}]}
2025-06-19 17:38:48,708 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:38:48] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:38:49,697 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:38:49] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:38:49,819 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:38:49] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:38:50,117 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:38:50] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:38:52,906 - handlers.webhook_handler - INFO - List reply received: id='main dishes', title='Main Dishes'
2025-06-19 17:38:52,906 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'main dishes'}
2025-06-19 17:38:52,908 - handlers.base_handler - INFO - MenuHandler: Received message 'main dishes' (original: 'main dishes') in menu state for session 2348055614455
2025-06-19 17:38:52,909 - handlers.base_handler - INFO - Category 'Main Dishes' selected for session 2348055614455
2025-06-19 17:38:52,909 - handlers.message_processor - ERROR - Error in message routing for handler 'menu_handler', state 'menu' for session 2348055614455: unsupported format string passed to NoneType.__format__
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Lola\app\handlers\message_processor.py", line 220, in _route_to_handler
    response = self.menu_handler.handle_menu_state(state, message, original_message, session_id)
  File "C:\Users\zigam\Documents\Lola\app\handlers\menu_handler.py", line 33, in handle_menu_state
    {"id": item, "title": truncate_title(f"{item} (₦{price:,})")}
                                                    ^^^^^^^^^
TypeError: unsupported format string passed to NoneType.__format__
2025-06-19 17:38:52,917 - services.whatsapp_service - INFO - Sending WhatsApp payload: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "⚠️ Something went wrong. Let's start fresh. Please try again."}}
2025-06-19 17:38:53,897 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjIyMDdFQ0VENDgxMjE1Q0I0MwA="}]}
2025-06-19 17:38:53,898 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjIyMDdFQ0VENDgxMjE1Q0I0MwA='}]}
2025-06-19 17:38:53,899 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:38:53] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:38:54,812 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:38:54] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:38:54,955 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:38:54] "POST /webhook HTTP/1.1" 200 -
2025-06-19 17:38:55,165 - werkzeug - INFO - 127.0.0.1 - - [19/Jun/2025 17:38:55] "POST /webhook HTTP/1.1" 200 -
